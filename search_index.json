[["index.html", "混乱数据分析：设计的实验", " 混乱数据分析：设计的实验 Wang Zhen 2024-2-18 混乱数据分析：设计的实验 基于 Elegant Bookdown Template。 本书进度还处于早期。 尚未包括每章的练习。 "],["chap1.html", "第 1 章 最简单的情况：具有同质误差的完全随机设计结构中的单向处理结构 1.1 模型定义和假设 1.2 参数估计 1.3 线性组合的推断：检验与置信区间 1.4 示例：任务和脉搏率 1.5 几种线性组合的联合检验 1.6 示例：任务和脉搏率（续） 1.7 检验所有均值相等 1.8 示例：任务和脉搏率（续） 1.9 比较两种模型的一般方法：条件误差原理 1.10 示例：任务和脉搏率（续） 1.11 计算机分析 1.12 结束语 1.13 练习", " 第 1 章 最简单的情况：具有同质误差的完全随机设计结构中的单向处理结构 假设一名实验者想比较几种不同处理1的效应，例如不同药物对人们心率的影响或几种不同小麦品种的产量。通常，分析此类实验数据的第一步是使用一种称为单向方差分析模型的统计方法来刻画数据。单向方差分析所基于的模型是统计学领域中最有用的模型之一。许多实验情况只是该模型的特殊情况。其他看起来要复杂得多的模型通常可以被认为是单向模型。本章分为几个部分。在前两部分中，定义了单向模型，并讨论了其参数的估计。在 1.3 节和1.5节中，提供了处理效应特定线性组合的推断程序。在 1.7 节和 1.9 节中，我们介绍了开发检验统计量的两种基本方法。这两种方法在本书的其余部分被广泛使用。最后，在 1.11 中，我们讨论了使用上述技术可用的计算机分析。使用一个示例来演示每一节中描述的概念和计算。 1.1 模型定义和假设 假设含 \\(N\\) 个实验单元的样本是从可能的实验单元总体2中完全随机地选取的。实验单元被定义为施加处理并独立观察的基本单元。在第 4 章和第 5 章中可以找到对实验单元更完整的描述。 为了比较 \\(t\\) 种不同处理的效应，将 \\(N\\) 个实验单元的样本随机分为 \\(t\\) 组，使第 \\(i\\) 组中有 \\(n_i\\) 个实验单元，其中 \\(i=1,2,\\dots,t\\) 且 \\(N=\\sum_{i=1}^tn_i\\). 将实验单元随机分为 \\(t\\) 组应消除任何系统偏差。也就是说，随机性应该确保在施加处理之前，\\(t\\) 组实验单元在性质上是相似的。最后，\\(t\\) 个处理中的每个处理应随机分配到每组实验单元。等价地，可以使用一些随机化装置将实验单元随机分配到 \\(t\\) 个处理组，例如将 \\(n_1\\) 个标签置于表示处理1的碗中，将 \\(n_2\\) 个标签置于表示处理2的碗中，……，将 \\(n_t\\) 个标签置于表示处理t的碗中。混合标签，然后从碗中随机选择标签，以确定分配给每个实验单元的处理。这种在碗中使用标签的过程显然可以使用随机数生成的软件来执行。 设 \\(y_{ij}\\) 表示分配给第 \\(i\\) 种处理的第 \\(j\\) 个实验单元的反应。值 \\(y_{11},y_{12},\\dots,y_{1n_1}\\) 可以被认为是来自均值为 \\(m_1\\) 且方差为 \\(s^2_1\\) 的总体的大小为 \\(n_1\\) 的随机样本，值 \\(y_{21},y_{22},\\dots,y_{2n_1}\\) 可以被认为是来自均值为 \\(m_2\\) 且方差为 \\(s^2_2\\) 的总体的大小为 \\(n_2\\) 的随机样本，对于 \\(i = 3,4,\\dots,t\\) 也是如此。参数 \\(\\mu_i\\) 和 \\(\\sigma^2_i\\) 表示对实验单元的整个总体施加处理 \\(i\\) 时的总体均值和总体方差。 本章考虑了最简单的情况，即假设各处理之间的方差是同质的或相等的，即 \\(\\sigma^2_1= \\sigma^2_2=\\cdots = \\sigma^2_t\\). 也就是说，假设对实验单元施加第 \\(i\\) 个处理可能会影响响应的均值，但不会影响响应的方差。第 2 章讨论了等方差假设以及不等方差的方差分析。 一个好的统计分析的基本目标是估计模型的参数并对它们进行推断，推断的方法通常包括检验假设和构造置信区间。 有几种方法可以为上述情况下的数据编写模型。第一个要使用的模型称为 \\(\\mu_i\\) 模型或均值模型 (means model)。均值模型是： \\[y_{ij}=\\mu_{i}+\\varepsilon_{ij}\\quad i=1,2,\\dots,t,\\,j=1,2,\\dots,n_{i}\\] 其中假设了 \\[\\begin{equation} \\varepsilon_{ij}\\sim \\text{i.i.d.}\\,N(0,\\sigma^{2})\\quad i=1,2,\\ldots,t,\\,j=1,2,\\ldots,n_{i} \\tag{1.1} \\end{equation}\\] 记号 \\(\\varepsilon_{ij}\\sim \\text{i.i.d.}\\,N(0,\\sigma^{2})\\) 贯穿本书。它表示 \\(\\varepsilon_{ij}\\,(i=1,2,\\dots,t;\\,j=1,2,\\dots,n_i)\\) 独立同分布，每个 \\(\\varepsilon_{ij}\\) 的抽样分布是均值为 \\(0\\)，方差为 \\(s^2\\) 的正态分布。 1.2 参数估计 统计分析最重要的方面是得到每个实验单元的误差方差 \\(\\sigma^2\\) 的良好估计. 误差方差衡量实验的准确性——- \\(s^2\\) 越小，实验越准确。在任何实验或研究中，如果不了解实验误差方差，就不能做出任何在统计上有效的推论。 在上述情况下，当 \\(n_i &gt; 1\\) 时，第 \\(i(=1,2,\\dots,t)\\) 个样本提供 \\(\\sigma^2\\) 的估计。从第 \\(i\\) 种处理的数据中获得的 \\(\\sigma^2\\) 的估计值为 \\[\\hat{\\sigma}_i^2=\\sum_{j=1}^{n_j}\\frac{\\left(y_{ij}-\\overline{y}_{i\\cdot}\\right)^2}{n_i-1}\\] 这是 \\(\\sigma^2\\) 的一个无偏估计。其中 \\[\\overline{y}_{i\\cdot}=\\frac{\\sum_{j=1}^{n_i}y_{ij}}{n_i}\\] 第 \\(i\\) 个处理的 \\(\\sigma^2\\) 的估计值是 \\(\\sigma^2_i\\) ，基于 \\(n_i - 1\\) 个自由度，且 \\((n_i - 1)\\hat\\sigma_i^2/\\sigma^2\\) 的抽样分布是具有 \\(n_i - 1\\) 个自由度的卡方分布。 \\(\\sigma^2\\) 的这些 \\(t\\) 个独立估计值的加权平均提供了如下情况下 \\(\\sigma^2\\) 可能的最佳估计值：其中方差的每个估计值由其相应的自由度加权。\\(\\sigma^2\\) 的最佳估计为 \\[\\hat{\\sigma}^2=\\sum_{i=1}^t(n_i-1)\\hat{\\sigma}_i^2\\left/\\sum_{i=1}^t(n_i-1)\\right.\\] 出于计算目的，每个方差乘以其权重可以表示为 \\[(n_{i}-1)\\hat{\\sigma}_{i}^{2}=\\sum_{i=1}^{t}\\left(y_{ij}-\\overline{y}_{i\\cdot}\\right)^{2}=\\sum_{i=1}^{t}y_{ij}^{2}-n_{i}\\overline{y}_{i\\cdot}^{2}=\\sum_{i=1}^{t}y_{ij}^{2}-(y_{i.})^{2}/n_{i}=SS_{i}\\] 其中 \\(y_{i\\cdot}=\\sum_{j=1}^{n_{i}}y_{ij}\\). 则方差的合并估计 (pooled estimate) 为 \\[\\hat{\\sigma}^2=\\frac{SS_1+SS_2+\\cdots+SS_t}{(n_1-1)+(n_2-1)+\\cdots+(n_t-1)}=\\frac{\\sum_{i=1}^tSS_i}{N-t}\\] 方差 \\(\\sigma^2\\) 的合并估计值基于 \\(N-t\\) 个自由度，并且 \\((N-t)\\hat\\sigma^2/\\sigma^2\\) 的抽样分布是具有 \\(N-t\\) 个自由度的卡方分布，即，\\((N-t)\\hat\\sigma^2/\\sigma^2\\sim \\chi^2_{N-t}\\). 每个 \\(\\mu_i\\) 的最佳估计是 \\(\\hat{\\mu}_{i}=\\bar{y}_{i\\cdot},\\,i=1,2,\\dots,t\\). 在式 (1.1) 给出的假设下，\\(\\hat\\mu_i\\) 的抽样分布是正态分布，具有均值 \\(\\mu_i\\) 和方差 \\(\\sigma^2/n_i\\). 即， \\[\\begin{equation} \\hat{\\mu}_i\\sim N{\\left(\\mu_i,\\frac{\\sigma^2}{n_i}\\right)}\\quad i=1,2,\\ldots,t \\tag{1.2} \\end{equation}\\] 使用 \\(\\hat\\mu_i,\\hat\\sigma_i^2\\) 的抽样分布，那么 \\[\\begin{equation} t_{i}=\\frac{\\hat{\\mu}_{i}-\\mu_{i}}{\\sqrt{\\hat{\\sigma}^{2}/n_{i}}}\\sim t_{\\Tiny{N-t}}\\quad i=1,2,\\ldots,t \\tag{1.3} \\end{equation}\\] 也就是说，\\(t_i\\) 的抽样分布是具有 \\(N-t\\) 个自由度的 \\(t\\) 分布。此外，\\(\\mu_1,\\mu_2,\\dots,\\mu_t\\) 和 \\(\\sigma_i^2\\) 在统计上是独立的。 1.3 线性组合的推断：检验与置信区间 本节提供均值模型中参数线性函数的假设检验和置信区间。上一节中的结果可用于检验有关单个 \\(\\mu_i\\) 的假设。这些结果也可用于检验有关 \\(\\mu_i\\) 线性组合的假设或构造 \\(\\mu_i\\) 线性组合的置信区间。 对于涉及几种处理的实验，研究者选择研究中的处理是因为存在需要研究的有趣假设。这些有趣的假设形成了研究的目的。涉及处理的假设很可能涉及方法的特定线性组合。这些线性组合使研究者得以比较不同处理的效应，或者等价地，比较不同处理或总体的平均值。如下所示，其中 \\(c_1,c_2,\\dots,c_t\\) 和 \\(a\\) 为某组已知常数： \\[H_{01}{:}\\,\\sum_{i=1}^{t}c_{i}\\mu_{i}=a\\,\\mathrm{~vs.~}\\, H_{a1}{:}\\mathrm{~(not~}H_{01}{:})\\\\ H_{02}{:}\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\,\\mathrm{~vs.~}\\,H_{a2}{:}\\mathrm{~(not~}H_{02}{:})\\\\ H_{03}{:}\\,\\mu_i=\\mu_{i^\\prime}\\text{ for some }i\\neq i^{\\prime}\\mathrm{~vs.~}H_{a3}{:}\\mathrm{~(not~}H_{03}{:})\\] 对于 \\(H_{01}\\) 给出的线性组合，可以证明： \\[\\begin{equation} \\frac{\\sum_{i=1}^tc_i\\hat{\\mu}_i-\\sum_{i=1}^tc_i\\mu_i}{\\sqrt{\\hat{\\sigma}^2\\sum_{i=1}^tc_i^2/n_i}}\\thicksim t_{\\Tiny{N-t}} \\tag{1.4} \\end{equation}\\] 这个结果可以用来推断形式为 \\(\\sum_{i=1}^tc_i\\mu_i\\) 的线性组合。由于 \\(H_{03}\\) 中的假设可以写为 \\(H_{03}:\\,\\mu_i-\\mu_{i^\\prime}=0\\)，它是 \\(H_{01}\\) 的特殊情况，其中 \\(c_i=1,c_{i^\\prime}=-1\\)，且 \\(c_k=0\\) 如果 \\(k\\ne i\\) 或 \\(i^\\prime\\). \\(H_{02}\\) 的一个检验在 1.5 节给出。\\(\\sum_{i=1}^tc_i\\hat{\\mu}_i\\) 的标准误估计为 \\[\\begin{equation} \\widehat{s.e.}\\left(\\sum c_i\\hat{\\mu}_i\\right)=\\sqrt{\\hat{\\sigma}^2\\sum\\frac{c_i^2}{n_i}} \\tag{1.5} \\end{equation}\\] 为了检验 \\(H_{01}{:}\\,\\sum_{i=1}^{t}c_{i}\\mu_{i}=a\\,\\mathrm{~vs.~}\\, H_{a1}{:}\\mathrm{~(not~}H_{01}{:})\\)，计算 \\(t\\) 统计量： \\[\\begin{equation} t_c=\\frac{\\sum c_i\\hat{{\\mu}}_i-a}{\\widehat{s.e.}\\left(\\sum c_i\\hat{\\mu}_i\\right)} \\tag{1.6} \\end{equation}\\] 如果 \\(|t_{c}| &gt;t_{\\alpha/2,\\nu}\\)，其中 \\(v=N-t\\)，那么 \\(H_{01}\\) 在 \\(\\alpha100\\%\\)3显著性水平下被拒绝，其中 \\(t_{\\alpha/2,\\nu}\\) 是自由度为 \\(v\\) 的 \\(t\\) 分布的上 \\(\\alpha/2\\) 分位数4。\\(\\sum_{i=1}^{t}c_{i}\\mu_{i}\\) 的 一个 \\((1-\\alpha)100\\%\\) 置信区间为 \\[\\begin{equation} \\sum c_i\\hat{\\mu}_i\\pm t_{\\alpha/2,\\nu}\\widehat{s.e.}\\left(\\sum c_i\\hat{\\mu}_i\\right) \\tag{1.7} \\end{equation}\\] 1.4 示例：任务和脉搏率 表 1.1 中的数据来自一项实验，该实验旨在确定六种不同的工作任务如何影响工人的脉搏率。在这项实验中，\\(78\\) 名男性工人被随机分配到六个不同的组，每组 \\(13\\) 名工人。每组工人都接受了执行指定任务的培训。在培训后的选定一天，在工人完成指定任务 \\(1\\) 小时后测量他们的脉搏率。不幸的是，在训练过程中，一些个体退出实验，使得一些组包含少于 \\(13\\) 个个体。记录的数据表示 \\(20s\\) 内的心脏搏动次数，其中有 \\(N = 68\\) 个观测值，和为 \\(y = 2197\\). 表 1.1: 六项任务的脉搏数据和摘要信息 x 对于任务数据，\\(\\sigma^2\\) 的最佳估计为 \\[\\hat{\\sigma}^{2}=\\sum_{i=1}^{6}SS_{i}\\left(N-t\\right)=1,916.0761/62=30.9045\\] 基于 \\(62\\) 个自由度。\\(\\mu_i\\) 的最佳估计分别为 \\(\\hat\\mu_1 = 31.923,\\hat\\mu_2 = 31.083,\\hat\\mu_3 = 35.800,\\hat\\mu_4 = 38.000,\\hat\\mu_5 = 29.500\\) 和 \\(\\hat\\mu_6 = 28.818\\). 为了说明，假设研究者有兴趣回答以下关于任务均值线性组合的问题： 检验 \\(H_0:\\,\\mu_3=30\\,\\mathrm{~vs.~}\\,H_a:\\,\\mu_3\\ne30\\). 为 \\(\\mu_1\\) 构造 \\(95\\%\\) 置信区间。 检验 \\(H_0:\\,\\mu_4=\\mu_5\\,\\mathrm{~vs.~}\\,H_a:\\,\\mu_4\\ne\\mu_5\\). 检验 \\(H_0:\\,\\mu_1=(\\mu_2+\\mu_3+\\mu_4)/3\\,\\mathrm{~vs.~}\\,H_a:\\,\\mu_1\\ne(\\mu_2+\\mu_3+\\mu_4)/3\\). 为 \\(4\\mu_1-\\mu_3-\\mu_4-\\mu_5-\\mu_6\\) 构造 \\(90\\%\\) 置信区间。 这些问题可以通过应用本节的结果来回答。 a的结果。通过代入式 (1.6) 获得用于检验 \\(H_0:\\,\\mu_3=30\\) 的 \\(t\\) 统计量 \\[t_{c}=\\frac{\\hat{\\mu}_{3}-30}{\\widehat{s.e.}(\\hat{\\mu}_{3})}=\\frac{\\hat{\\mu}_{3}-30}{\\sqrt{\\hat{\\sigma}^{2}/n_{3}}}=\\frac{35.8-30.0}{\\sqrt{30.9045/10}}=3.30\\] 该 \\(t\\) 值的显著性概率是 \\(\\hat \\alpha = \\operatorname{Pr}\\{|t_c| &gt; 3.30\\} = 0.0016\\)，其中 \\(\\operatorname{Pr}\\{|t_c| &gt; 3.30\\}\\) 是具有 \\(62\\) 个自由度的 \\(t\\) 分布中 \\(3.30\\) 右侧的面积加上 \\(-3.30\\) 左侧的面积。上述 \\(\\hat\\alpha\\) 值是由电脑计算出来的，但也可由一些特别的手持计算器计算出来。没有电脑或计算器的读者，应比较 \\(t_c = 3.30\\) 与 \\(t_{\\alpha/2,62}\\) 来选择 \\(\\alpha\\). b的结果。\\(\\mu_1\\) 的 \\(95\\%\\) 置信区间由下式给出 \\[\\begin{aligned} \\hat{\\mu}_{1}\\pm t_{0.025,62}\\widehat{s.e.}(\\hat{\\mu}_{1})&amp; =31.923\\pm2.00\\sqrt{30.9045/13} \\\\ &amp;=31.923\\pm2.00\\times1.542 \\end{aligned}\\] 因此 \\(\\mu_1\\) 的 \\(95\\%\\) 置信区间为 \\(28.839&lt;\\mu_1&lt;35.007\\)，我们有 \\(95\\%\\) 的把握认为这个区间包含了未知的真实值 \\(\\mu_1\\). c的结果。为检验 \\(H_0:\\,\\mu_4=\\mu_5\\)，令 \\(l_1=\\mu_4-\\mu_5\\)，那么 \\(\\hat l_1=\\hat \\mu_4-\\hat\\mu_5=38.0-29.5=8.5\\)。由于 \\(c_1=c_2=c_3=c_6=0,c_4=1,c_5=-1\\)，那么 \\[\\widehat{s.e.}(\\hat{l}_{1})=\\sqrt{\\hat{\\sigma}^{2}\\sum_{i=1}^{6}c_{i}^{2}/n_{i}}=\\sqrt{30.9045{\\left(\\frac{1}{10}+\\frac{1}{12}\\right)}}=2.380\\] 用于检验 \\(H_0:\\,\\mu_4=\\mu_5\\) 的 \\(t\\) 统计量为 \\[t_c=\\frac{8.5}{2.380}=3.57\\] 该检验的显著性概率为 \\(\\hat\\alpha=0.0007\\). d的结果。检验 \\(H_0:\\,\\mu_1=(\\mu_2+\\mu_3+\\mu_4)/3\\) 等价于检验 \\(H_0:\\,\\mu_1-\\frac{1}{3}\\mu_2-\\frac{1}{3}\\mu_3-\\frac{1}{3}\\mu_4=0\\) 或检验 \\(H_0:\\,3\\mu_1-\\mu_2-\\mu_3-\\mu_4=0\\). 选择最后一个版本，计算稍微容易一些，并且 \\(t_c\\) 检验统计量的值相对于常数乘数是不变的。 令 \\(l_2=3\\mu_1-\\mu_2-\\mu_3-\\mu_4\\)，那么 \\[\\hat{l}_2=3\\hat{\\mu}_1-\\hat{\\mu}_2-\\hat{\\mu}_3-\\hat{\\mu}_4=3(31.923)-31.083-35.8-38.0=-9.114\\] \\(\\hat l_2\\) 的标准误估计为 \\[\\widehat{s.e.}(\\hat{l}_2)=\\sqrt{30.9045{\\left(\\frac9{13}+\\frac1{12}+\\frac1{10}+\\frac1{10}\\right)}}=5.491\\] 用于检验 \\(H_0:\\,3\\mu_1-\\mu_2-\\mu_3-\\mu_4=0\\) 的 \\(t\\) 统计量为 \\[t_c=\\frac{-9.114}{5.491}=-1.66\\] 该检验的显著性概率为 \\(\\hat\\alpha=0.1020\\). e的结果。令 \\(l_{3}=4\\mu_{1}-\\mu_{3}-\\mu_{4}-\\mu_{5}-\\mu_{6}\\). 那么 \\(\\hat{l}_{3}=-4.426\\) 且 \\(\\widehat{s.e.}(\\hat{l}_{3})=7.0429\\). \\(l_3\\) 的 \\(90\\%\\) 置信区间为 \\[\\hat{l}_{3}\\pm t_{0.05,62}\\widehat{s.e.}\\left(\\hat{l}_{3}\\right)=-4.426\\pm1.671\\times7.043=-4.426\\pm11.769\\] 因此 \\(90\\%\\) 置信区间为 \\(-16.195&lt;4\\mu_1-\\mu_3-\\mu_4-\\mu_5-\\mu_6&lt;7.343\\). 1.5 几种线性组合的联合检验 在许多情况下，研究人员希望检验关于处理效应或均值的几个线性组合的联合假设 (simultaneous hypothesis)。例如，涉及处理均值的 \\(k\\) 个线性独立线性组合 (linearly independent linear combinations) 的一般假设可以表示为： \\[\\begin{equation} H_0{:}\\quad\\begin{aligned}c_{11}\\mu_1+c_{12}\\mu_2+&amp;\\cdots+c_{1t}\\mu_t=a_1\\\\c_{21}\\mu_1+c_{22}\\mu_2+&amp;\\cdots+c_{2t}\\mu_t=a_2\\\\&amp;\\vdots\\\\c_{k1}\\mu_1+c_{k2}\\mu_2+&amp;\\cdots+c_{kt}\\mu_t=a_k\\end{aligned}\\quad\\mathrm{~vs.~}\\quad H_a{:}(\\operatorname{not}H_0) \\tag{1.8} \\end{equation}\\] 本节中给出的结果是用向量和矩阵来说明的。然而，对于有矩阵处理软件的读者来说，向量和矩阵的知识并不是真正必要的，因为大多数计算机甚至允许新手用户轻松地进行矩阵计算。 式 (1.8) 中的假设可以用矩阵表示法写为： \\[\\begin{equation} H_0{:}\\,\\boldsymbol{C}\\boldsymbol\\mu=\\boldsymbol a\\quad\\mathrm{~vs.~}\\quad H_a{:}\\,\\boldsymbol{C}\\boldsymbol\\mu\\neq\\boldsymbol a \\tag{1.9} \\end{equation}\\] 其中 \\[\\begin{equation} \\boldsymbol{C}=\\begin{bmatrix}c_{11}&amp;c_{12}&amp;\\cdots&amp;c_{1t}\\\\c_{21}&amp;c_{22}&amp;\\cdots&amp;c_{2t}\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\c_{k1}&amp;c_{k2}&amp;\\cdots&amp;c_{kt}\\end{bmatrix},\\quad\\boldsymbol{\\mu}=\\begin{bmatrix}\\mu_{1}\\\\\\mu_{2}\\\\\\vdots\\\\\\mu_{t}\\end{bmatrix},\\quad\\mathrm{and}\\quad\\boldsymbol{a}=\\begin{bmatrix}a_{1}\\\\a_{2}\\\\\\vdots\\\\a_{k}\\end{bmatrix} \\tag{1.10} \\end{equation}\\] 假设 \\(\\boldsymbol C\\) 中的 \\(k\\) 行是线性独立的，这意味着 \\(\\boldsymbol C\\) 中没有一行可以表示为其余行的线性组合。如果 \\(\\boldsymbol C\\) 中的 \\(k\\) 行不是线性独立的，那么总是可以选择 \\(\\boldsymbol C\\) 的子集：包含所有线性独立的行，它们包含关于所需假设的所有必要信息。 例如，假设你有三种处理，你希望检验 \\[H_0{:}\\,\\mu_1-\\mu_2=0,\\,\\mu_1-\\mu_3=0\\quad\\mathrm{and}\\quad\\mu_2-\\mu_3=0\\] 相应的 \\(\\boldsymbol C\\) 矩阵为 \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0\\\\1&amp;0&amp;-1\\\\0&amp;1&amp;-1\\end{bmatrix}\\] 但是 \\(\\boldsymbol C\\) 的第三行是第二行和第一行之间的差，因此这三行不是线性独立的。此时，一个等价的假设可以表述为 \\(H_{0}\\colon\\,\\mu_{\\mathrm{l}}-\\mu_{2}=0\\mathrm{~and~}\\mu_{\\mathrm{l}}-\\mu_{\\mathrm{3}}=0\\)，因为如果 \\(\\mu_1-\\mu_2=0\\) 且 \\(\\mu_1-\\mu_3=0\\)，那么 \\(\\mu_2-\\mu_3\\) 必为 \\(0\\). 下面的讨论使用 \\(\\boldsymbol C\\) 的行是线性独立的假设。 将样本均值向量表示为 \\(\\hat{\\boldsymbol \\mu}\\)，则 \\(\\hat{\\boldsymbol \\mu}\\) 抽样分布的矩阵表示为 \\[\\left.\\hat{\\boldsymbol{\\mu}}\\sim {N_t}(\\boldsymbol{\\mu},{\\sigma}^2\\boldsymbol{D})\\quad\\mathrm{~其中~}\\quad \\boldsymbol D=\\left[\\begin{array}{ccccc}1/n_1&amp;0&amp;\\cdots&amp;0\\\\0&amp;1/n_2&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;1/n_t\\end{array}\\right.\\right]\\] 此式读作：\\(t×1\\) 向量 \\(\\hat{\\boldsymbol \\mu}\\) 的元素的联合抽样分布为 \\(t\\) 元正态分布，其均值为 \\(\\boldsymbol \\mu\\)，方差和协方差由矩阵 \\(\\boldsymbol \\sigma^2\\boldsymbol D\\) 中的元素给出。\\(\\boldsymbol \\sigma^2\\boldsymbol D\\) 第 \\(i\\) 个对角元为 \\(\\hat\\mu_i\\) 的方差，非对角元 \\((i,\\,j)\\) 为 \\(\\hat\\mu_i,\\hat\\mu_j\\) 的协方差。 \\(\\boldsymbol C \\hat{\\boldsymbol \\mu}\\) 的抽样分布为 \\[\\boldsymbol C\\hat{\\boldsymbol{\\mu}}\\sim N_k(\\boldsymbol C\\boldsymbol{\\mu},\\sigma^2 \\boldsymbol {CDC}^{\\prime})\\] 偏离 \\(H_0\\) 的平方和或用于检验 \\(H_0{:}\\,\\boldsymbol C \\boldsymbol \\mu =\\boldsymbol a\\) 的平方和由下式给出 \\[\\begin{equation} SS_{H0}=(\\boldsymbol C\\boldsymbol{\\hat{\\mu}}-\\boldsymbol{a})^{\\prime}(\\boldsymbol{C}\\boldsymbol D\\boldsymbol{C}^{\\prime})^{-1}(\\boldsymbol{C}\\hat{\\boldsymbol{\\mu}}-\\boldsymbol{a}) \\tag{1.11} \\end{equation}\\] 基于 \\(k\\) 个自由度，即 \\(\\boldsymbol C\\) 线性无关行的数量。利用正态性假设，\\(SS_{H0}/\\sigma^2\\) 的抽样分布为自由度为 \\(k\\) 的非中心卡方分布，如果 \\(H_0\\) 为真，则 \\(SS_{H_0}/\\sigma^2\\sim\\chi^2_k\\). 用于检验 \\(H_0\\) 的统计量为 \\[F_c=\\frac{SS_{H0}/k}{\\hat{\\sigma}^2}\\] 若 \\(F_c&gt;F_{\\alpha,k,N-t}\\)，其中 \\(F_{\\alpha,k,N-t}\\) 是分子分母自由度分别为 \\(k\\) 和 \\(N-t\\) 的 \\(F\\) 分布的上 \\(\\alpha\\) 分位数，假设 \\(H_0{:}\\,\\boldsymbol C\\boldsymbol \\mu=\\boldsymbol \\alpha\\). 这里给出的结果是 Graybill (1976) 中定理 6.3.1 的特殊情况。 当 \\(H_0\\) 为真，\\(\\frac{SS_{H0}/k}{\\hat{\\sigma}^2}\\) 为 \\(\\sigma^2\\) 的无偏估计，然后将其与 \\(\\hat\\sigma^2\\) 进行比较，而无论 \\(H_0\\) 是否为真，\\(\\hat\\sigma^2\\) 又是 \\(\\sigma^2\\) 的无偏估计。因此若 \\(H_0\\) 为真，上面给出的 \\(F\\) 统计量应该接近 \\(1\\)。若 \\(H_0\\) 为假， \\(SS_{H0}/k\\) 是下式的无偏估计 \\[\\sigma^2+\\frac1k(\\boldsymbol C\\boldsymbol\\mu-\\boldsymbol a)^{\\prime}(\\boldsymbol C\\boldsymbol D\\boldsymbol C^{\\prime})^{-1}(\\boldsymbol C\\boldsymbol\\mu-\\boldsymbol a)\\] 因此，若 \\(H_0\\) 为假，则 \\(F\\) 统计量的值应大于 \\(1\\) 。若计算的 \\(F\\) 统计量显著大于 \\(1\\) ，则拒绝假设 \\(H_0\\). 1.6 示例：任务和脉搏率（续） 以下是 1.4 节示例中的信息总结，包含六项任务中每项任务的样本量和平均值。 任务 \\(i\\) \\(1\\) \\(2\\) \\(3\\) \\(4\\) \\(5\\) \\(6\\) \\(n_i\\) \\(13\\) \\(12\\) \\(10\\) \\(10\\) \\(12\\) \\(11\\) \\(\\bar y_{i\\cdot}\\) \\(31.9231\\) \\(31.0833\\) \\(35.8000\\) \\(38.0000\\) \\(29.5000\\) \\(28.8182\\) 方差的合并估计为 \\(\\hat\\sigma^2 = 30.9045\\)，基于 \\(62\\) 个自由度。与均值向量估计抽样分布相关的 \\(\\boldsymbol D\\) 矩阵为 \\[\\boldsymbol D=\\begin{bmatrix}\\frac1{13}&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;\\frac1{12}&amp;0&amp;0&amp;0&amp;0\\\\0&amp;0&amp;\\frac1{10}&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;\\frac1{10}&amp;0&amp;0\\\\0&amp;0&amp;0&amp;0&amp;\\frac1{12}&amp;0\\\\0&amp;0&amp;0&amp;0&amp;0&amp;\\frac1{11}\\end{bmatrix}\\] 假设研究者有兴趣联合检验以下假设 (simultaneously testing the following hypothesis)，该假设涉及任务均值的两个线性组合： \\[H_0{:}\\,\\mu_4-\\mu_5=4\\,\\mathrm{~and~}\\,3\\mu_1-\\mu_2-\\mu_3-\\mu_4=0\\,\\mathrm{~vs.~}\\,H_a{:}\\,(\\operatorname{not}H_0)\\] 提供 \\(SS_{H0}\\) 值所需的初步计算如下： \\[\\begin{aligned} \\boldsymbol{C\\hat{\\mu}}-\\boldsymbol{a}&amp; =\\begin{bmatrix}8.5-4\\\\-9.114-0\\end{bmatrix}=\\begin{bmatrix}4.500\\\\-9.114\\end{bmatrix} \\\\ \\boldsymbol C\\boldsymbol D \\boldsymbol C^\\prime&amp; =\\begin{bmatrix}\\dfrac{1}{10}+\\dfrac{1}{12}&amp;-\\dfrac{1}{10}\\\\-\\dfrac{1}{10}&amp;\\dfrac{9}{13}+\\dfrac{1}{12}+\\dfrac{1}{10}+\\dfrac{1}{10}\\end{bmatrix} \\\\ &amp;=\\begin{bmatrix}0.1833&amp;-0.1000\\\\-0.1000&amp;0.9756\\end{bmatrix} \\\\ (\\boldsymbol C \\boldsymbol D \\boldsymbol C^{\\prime})^{-1}&amp; =\\begin{bmatrix}5.7776&amp;0.5922\\\\0.5922&amp;1.0856\\end{bmatrix} \\end{aligned}\\] 以及 \\[SS_{H0}=(\\boldsymbol C\\hat{\\boldsymbol \\mu}-\\boldsymbol a)^{\\prime}(\\boldsymbol C\\boldsymbol D\\boldsymbol C^{\\prime})^{-1}(\\boldsymbol C\\hat{\\boldsymbol \\mu}-\\boldsymbol a)=158.602\\] 自由度为 \\(2\\). 检验统计量为 \\[F_c=\\frac{158.602/2}{30.9045}=2.566\\] 该 \\(F\\) 统计量的显著性概率为 \\(\\hat{\\alpha}=\\mathrm{Pr}\\{F&gt;2.566\\}=0.0850\\). 1.7 检验所有均值相等 大多数研究人员感兴趣的第一个假设通常是检验平均值是否同时相等。假设为 \\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\,\\mathrm{~vs.~}H_{a}{:}\\,(\\operatorname{not}H_{0})\\)。检验等均值假设可使用两个基本程序。对于本章讨论的特定情况，这两个程序给出相同的统计检验。然而，对于大多数混乱数据的情况（对于除单向外的处理结构），这两个程序可以给予不同的检验。第一个程序将在本节介绍，而第二个程序将在 1.9 节介绍。 等均值假设 \\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\) 与下列形式的假设等价：\\(H_{0}\\,\\colon\\mu_{1}-\\mu_{2}=0,\\mu_{1}-\\mu_{3}=0,\\ldots,\\mu_{1}-\\mu_{t}=0\\)，或与涉及 \\(\\mu_i\\) 的 \\(t - 1\\) 个线性独立线性组合的任何其它假设等价。对应于 \\(t - 1\\) 个成对差异集合的 \\(\\boldsymbol C\\) 矩阵和 \\(\\boldsymbol a\\) 向量为： \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0&amp;0&amp;\\cdots&amp;0\\\\1&amp;0&amp;-1&amp;0&amp;\\cdots&amp;0\\\\1&amp;0&amp;0&amp;-1&amp;\\cdots&amp;0\\\\1&amp;0&amp;0&amp;0&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\1&amp;0&amp;0&amp;0&amp;\\cdots&amp;-1\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{a}=\\begin{bmatrix}0\\\\0\\\\0\\\\0\\\\\\vdots\\\\0\\end{bmatrix}\\] 对应于 \\(\\mu_i\\) 的以下 \\(t - 1\\) 个线性无关线性组合的集合 \\(H_{0}{:}\\,\\mu_{1}-\\mu_{2}=0,\\mu_{1}+\\mu_{2}-2\\mu_{3}=0,\\mu_{1}+\\mu_{2}+\\mu_{3}-3\\mu_{4}=0,\\ldots,\\mu_{1}+\\mu_{2}+\\cdots-\\left(t-1\\right)\\mu_{t}=0\\) 的 \\(\\boldsymbol C\\) 和 \\(\\boldsymbol a\\) 向量为： \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0&amp;0&amp;\\cdots&amp;0\\\\1&amp;1&amp;-2&amp;0&amp;\\cdots&amp;0\\\\1&amp;1&amp;1&amp;-3&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;0\\\\1&amp;1&amp;1&amp;1&amp;\\cdots&amp;t-1\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{a}=\\begin{bmatrix}0\\\\0\\\\0\\\\\\vdots\\\\0\\end{bmatrix}\\] 存在许多其他矩阵使得 \\(\\boldsymbol C \\boldsymbol \\mu = \\boldsymbol 0\\) 当且仅当 \\(\\mu_1 = \\mu_2 = \\cdots = \\mu_t\\)；然而所有这些矩阵产生相同的偏离 \\(H_0\\) 的平方和以及相同的自由度 \\(t - 1\\)，因此产生相同的 \\(F\\) 统计量。对于这种特殊情况，式 (1.11) 总可以简化为： \\[\\begin{equation} SS_{H0:\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}}=\\sum_{i=1}^{t}n_{i}(\\overline{y}_{i.}-\\overline{y}_{..})^{2}=\\sum_{i=1}^{t}\\left(\\frac{y_{i.}^{2}}{n_{i}}\\right)-\\frac{y_{..}^{2}}{N} \\tag{1.12} \\end{equation}\\] 1.8 示例：任务和脉搏率（续） 对于 1.4 节中的任务和脉搏数据，使用式 (1.11) 和 (1.12) 可计算 \\(SS_{H0:\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}}\\). 使用式 (1.12) 可得到 \\[\\begin{aligned} SS_{H0}&amp; =\\frac{415^2}{13}+\\frac{373^2}{12}+\\frac{358^2}{10}+\\frac{380^2}{10}+\\frac{354^2}{12}+\\frac{317^2}{11}-\\frac{2197^2}{68} \\\\ &amp;=694.4386 \\end{aligned}\\] 自由度为 \\(t - 1 = 5\\). \\(F_c\\) 统计量的值为 \\[F_c=\\frac{694.4386/5}{30.9045}=4.49\\] 并且显著性概率为 \\(\\hat \\alpha = 0.0015\\). 然后，使用式 (1.11)，矩阵 \\(\\boldsymbol C\\)，向量 \\(\\boldsymbol a\\) 和矩阵 \\(\\boldsymbol D\\) 为 \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0&amp;0&amp;0&amp;0\\\\1&amp;0&amp;-1&amp;0&amp;0&amp;0\\\\1&amp;0&amp;0&amp;-1&amp;0&amp;0\\\\1&amp;0&amp;0&amp;0&amp;-1&amp;0\\\\1&amp;0&amp;0&amp;0&amp;0&amp;-1\\end{bmatrix},\\quad \\boldsymbol a=\\begin{bmatrix}0\\\\0\\\\0\\\\0\\\\0\\end{bmatrix}\\] \\[\\boldsymbol D=\\begin{bmatrix}\\frac{1}{13}&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;\\frac{1}{12}&amp;0&amp;0&amp;0&amp;0\\\\0&amp;0&amp;\\frac{1}{10}&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;\\frac{1}{10}&amp;0&amp;0\\\\0&amp;0&amp;0&amp;0&amp;\\frac{1}{12}&amp;0\\\\0&amp;0&amp;0&amp;0&amp;0&amp;\\frac{1}{11}\\end{bmatrix}\\] 接下来，计算式 (1.11) 中的各个量 \\[\\boldsymbol{C\\hat{\\boldsymbol{\\mu}}}-\\boldsymbol{a}=\\begin{bmatrix}0.844\\\\-3.877\\\\-6.077\\\\2.423\\\\3.105\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{C}\\boldsymbol D\\boldsymbol{C}^{\\prime}=\\begin{bmatrix}\\frac{25}{156}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}\\\\\\frac1{13}&amp;\\frac{23}{130}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}\\\\\\frac1{13}&amp;\\frac1{13}&amp;\\frac{23}{130}&amp;\\frac1{13}&amp;\\frac1{13}\\\\\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac{25}{156}&amp;\\frac1{13}\\\\\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac{24}{143}\\end{bmatrix}\\] \\(\\boldsymbol{CDC&#39;}\\) 的逆为 \\[(\\boldsymbol{CDC&#39;})^{-1}=\\begin{bmatrix}9.882&amp;-1.765&amp;-1.765&amp;-2.118&amp;-1.941\\\\-1.765&amp;8.529&amp;-1.471&amp;-1.765&amp;-1.618\\\\-1.765&amp;-1.471&amp;8.529&amp;-1.765&amp;-1.618\\\\-2.118&amp;-1.765&amp;-1.765&amp;9.882&amp;-1.941\\\\-1.941&amp;-1.618&amp;-1.618&amp;-1.941&amp;9.221\\end{bmatrix}\\] 最后，平方和的值为 \\[SS_{H0}=(\\boldsymbol C\\hat{\\boldsymbol{\\mu}}-\\boldsymbol{a})^{\\prime}(\\boldsymbol C\\boldsymbol D\\boldsymbol{C}^{\\prime})^{-1}(\\boldsymbol{C}\\hat{\\boldsymbol{\\mu}}-\\boldsymbol{a})=694.4386\\] 这与使用式 (1.12) 计算的平方和相同。 显然，如果必须手工计算，这个公式并不容易使用。然而，在许多混乱数据的情况下，为了获得检验有意义假设的统计量，像这样的公式是必要的。幸运的是，通过利用计算机，可以为特定假设构造 \\(\\boldsymbol C\\)矩阵，然后可以让计算机进行繁琐的计算。 1.9 比较两种模型的一般方法：条件误差原理 计算检验统计量的第二个过程是比较两个模型的拟合度。在本节中，比较的两个模型是 \\(y_{ij} = \\mu_i + \\varepsilon_{ij}\\)，这叫做一般 (general) 或未缩简模型 (unreduced model)，\\(y_{ij} = \\mu_i + \\varepsilon_{ij}\\)，这是如果 \\(H_0:\\,\\mu_1 = \\mu_2 = \\cdots = \\mu_t = \\mu\\)（假设）成立时得到的模型。第一个模型称为完全模型 (full model) 或无约束模型 (unrestricted model)，第二个模型称为缩简模型 (reduced model) 或约束模型 (restricted model). 条件误差原理 (principle of conditional error) 用于比较两个模型，其中一个模型是通过对另一个模型的参数施加限制而获得的。该原理非常简单，要求获得完全模型和缩简模型的残差或误差平方和。令 \\(ESS_F\\) 表示拟合完全模型得到的误差平方和，\\(ESS_R\\) 表示拟合缩减模型得到的误差平方和。则由于假设的限制而导致的，或由于偏离零假设的平方和为 \\(SS_{H0}=ESS_R-ESS_F\\). \\(ESS_R\\) 和 \\(ESS_F\\) 的自由度由数据集中的观测总数与待估计的（基本）参数数量之差给出 [基本参数 (essential parameters) 将在第 ?? 章中讨论]。分别用 \\(df_R\\) 和 \\(df_F\\) 表示与 \\(ESS_R\\) 和 \\(ESS_F\\) 对应的自由度。对应于 \\(SS_{H0}\\) 的自由度为 \\(df_{H0} = df_R - df_F\\). 用于检验 \\(H_0\\) 的 \\(F\\) 统计量由下式给出： \\[F_c=\\frac{SS_{H0}/df_{H0}}{ESS_F/df_F}\\] 若 \\(F_{c}&gt;F_{\\alpha,df_{{H0}},df_{F}}\\)，则在显著性水平下拒绝 \\(H_0\\). 对于上面讨论的情况，\\(y_{ij} = \\mu_i + \\varepsilon_{ij}\\) 是完全模型而 \\(y_{ij} = \\mu + \\varepsilon_{ij}\\) 是缩简模型。完全模型的误差平方和为 \\[ESS_{F}=\\sum_{i=1}^{t}\\sum_{j=1}^{n_{i}}(y_{ij}-\\overline{y}_{i\\cdot})^{2}=(N-t)\\hat{\\sigma}^{2}\\] 其自由度 \\(df_F=N-t\\). 缩简模型的误差平方和为 \\[ESS_{_R}=\\sum_{i=1}^{t}\\sum_{j=1}^{n_{i}}(y_{_{ij}}-\\overline{y}_{\\cdot\\cdot})^{2}\\] 其自由度 \\(df_R=N-1\\). 因此，由于偏离 \\(H_0\\) 而产生的平方和为： \\[SS_{H0{:}\\,\\mu_1=\\mu_2=\\cdots=\\mu_t}=ESS_{R}-ESS_{F}=\\sum_{i=1}^{t}n_{i}(\\overline{y}_{i\\cdot}-\\overline{y}_{\\cdot\\cdot})^{2}\\] 其自由度为 \\(t-1\\). 这与式 (1.12) 得到的平方和相同。 在检验情况下感兴趣的平方和通常被放在一个叫做方差分析 (analysis of variance, ANOVA)表的表格中，这样的表格通常有类似于表 1.2 的形式，在 “source of variation” 栏下的条目被分组为多个集合。在给定的情况下，每组只使用一个标签，选择完全由实验者决定。 表 1.2: 单向模型检验均值相等的方差分析表 x 注释: df=degrees of freedom 表示自由度, SS=sum of square 表示平方和, MS=mean square 表示均方. 这些标准缩写贯穿本书 1.10 示例：任务和脉搏率（续） 条件误差原则也被称为模型比较程序，其过程相当灵活。例如，如果对检验任务和脉搏率数据的假设感兴趣，例如 \\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\mu_{3}\\,\\mathrm{~vs.~}\\,H_{a}\\colon\\,(\\mathrm{not}\\,H_{0})\\)，那么在 \\(H_0\\) 的条件下模型有如下形式 \\[\\begin{array}{ll}y_{ij}=\\mu_0+\\varepsilon_{ij}&amp;\\mathrm{~for~}i=1,2,3\\\\y_{ij}=\\mu_i+\\varepsilon_{ij}&amp;\\mathrm{~for~}i=4,5,6\\end{array}\\] 这样的模型可以使用大多数软件包来拟合，其中包含一个定性或分类变量，当任务为 \\(1,2,3\\) ，其值为 \\(0\\)，当任务为 \\(4,5,6\\) ，其值等于任务值. 1.11 计算机分析 将条件误差原理应用于 1.4 节的任务和脉搏率数据，以提供等均值假设的检验，\\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\mu_{3}=\\mu_{4}=\\mu_{5}=\\mu_{6}\\,\\mathrm{~vs.~}\\,H_{a}\\colon(\\mathrm{not}\\,H_{0})\\). 完全模型的误差平方和为 \\(ESS_F=1916.076\\), \\(df_F=62\\). 缩简模型的误差平方和为 \\(ESS_R=73593-(2197)^2/68=2610.545\\), \\(df_R=67\\). 因此，\\(SS_{H0}=2610.545-1916.076=694.439\\), \\(df_{H0}=67-62=5\\). 汇总这些计算的方差分析表如表 1.3 所示。 表 1.3: 任务和脉搏率数据检验均值相等的方差分析表 x 本章最后介绍了一些关于使用计算机和统计计算软件包（如SAS®、BMDP®、SYSTAT®、JMP®和SPSS®）的说明。前面章节中提供的所有方法和公式都可以在大多数计算机上轻松使用。如果计算机使用 MATLAB、SAS-IML 或 APL 等编程语言，则所需的矩阵计算很容易按照前面章节中给出的矩阵公式进行。SAS、JMP、BMDP、SYSTAT 和 SPSS 每个都包含程序，使用户能够生成自己的处理的线性组合，以检验假设。此外，这些包都提供了方差分析表、处理均值及其标准误的分析。表 1.4 包含 SAS-GLM 代码，其中包含检验任务和脉搏率数据所述假设所需的 estimate 语句和 contrast 的语句。estimate 语句用于评估均值的一个线性组合，提供的结果是对比的估计、其标准误估计并生成 \\(t\\) 统计量及其相应的显著性水平。contrast 语句用于评估均值的一个或多个线性组合，提供的结果是平方和、自由度和 \\(F\\) 统计量。对于SAS-GLM中的 estimate 和 contrast 语句，假设中的 \\(\\boldsymbol a\\) 的唯一值为零，也就是说，只能检验均值的线性组合等于零。 表 1.4: Proc GLM代码，用于拟合任务和脉搏率数据，并提供文本中描述的分析所需的 estimate 和 contrast 语句 x PROC GLM DATA=EX1; CLASS TASK; MODEL PULSE20=TASK/NOINT SOLUTION E; ESTIMATE ‘Ho: M4=M5’ TASK 0 0 0 1 -1 0; ESTIMATE ‘Ho: 3M1=M2+M3+M4’ TASK 3 -1 -1 -1 0 0; ESTIMATE ‘Ho: 3M1=M2+M3+M4_mn’ TASK 3 -1 -1 -1 0 0/DIVISOR=3; ESTIMATE ‘4M1-M3-M4-M5-M6_mn’ TASK 4 0 -1 -1 -1 -1/DIVISOR=4; CONTRAST ‘4M1-M3-M4-M5-M6_mn’ TASK 4 0 -1 -1 -1 -1; CONTRAST ‘M4=M5 &amp; 3M1=M2+M3+M4’ TASK 0 0 0 1 -1 0, TASK 3 -1 -1 -1 0 0; CONTRAST ‘EQUAL MEANS 1’ TASK 1 -1 0 0 0 0, TASK 1 0 -1 0 0 0, TASK 1 0 0 -1 0 0, TASK 1 0 0 0 -1 0, TASK 1 0 0 0 0 -1; 表 1.5 包含 SAS-IML 代码，为 1.6 节中检验的假设提供计算。通过用矩阵语言构造代码，可以得到 \\(\\boldsymbol C \\boldsymbol \\mu = \\boldsymbol a\\) 形式的任何假设的检验。 表 1.5: Proc IML代码执行 1.6 节中任务和脉搏率数据的计算 x 1.12 结束语 本章对单向方差分析模型进行了分析。提供了对不同处理的效应进行统计推断的一般程序，并对同质误差的情况进行了说明。介绍了获得实验设计模型的统计分析的两个基本程序。这些程序在本书的其余部分被广泛用于描述更复杂的模型设计的实验和更混乱的数据情况。还给出了同时比较所有处理效应均值的检验。这种检验可以被认为是统计分析的初始步骤。完成数据集分析所应使用的程序取决于是否拒绝处理均值相等的假设。 1.13 练习 本文将 “treatment” 统一翻译为 “处理” ，不论语境。↩︎ 本文将 “population” 统一翻译为 “总体”，不论语境。↩︎ 原文为 \\(\\alpha=100\\%\\)，应为笔误。↩︎ 原文为critical point，后同。↩︎ "],["chap2.html", "第 2 章 具有异质误差的完全随机设计结构中的单向处理结构 2.1 模型定义和假设 2.2 参数估计 2.3 方差齐性检验 2.4 示例：药物和错误 2.5 关于线性组合的推断 2.6 示例：药物和错误（续） 2.7 自由度的一般 Satterthwaite 近似 2.8 比较所有均值 2.9 结束语 2.10 练习", " 第 2 章 具有异质误差的完全随机设计结构中的单向处理结构 在本章中，考虑分配给实验单元的处理可能影响响应的方差以及均值的情况。从单向均值模型 \\(y_{ij} = \\mu_i + \\varepsilon_{ij}\\) 开始，其中 \\(i = 1,2,\\cdots,t;\\,j =1,2,\\cdots,n_i\\). 在第 1 章中，假设实验误差都具有相同的方差；也就是说，预期处理可能会改变抽样总体的均值，但不会改变方差。当处理影响方差和均值时，本章描述了一些分析数据的方法。在这种情况下，实验者想要回答的关于平均值的问题类型与第 1 章中的类似。也就是说， 所有均值都相等吗？ 是否可以在均值之间进行成对比较？ 是否可以检验形如 \\(\\sum_{i=1}^tc_i\\mu_i=a\\) 的假设并为 \\(\\sum_{i=1}^tc_i\\mu_i\\) 构造置信区间？ 此外，关于方差还存在可能感兴趣的问题，例如 所有方差都相等吗？ 是否存在组内方差相等而组间方差不相等的处理分组？ 在回答有关模型均值的问题之前，必须获得处理方差的适当描述。 方差齐性检验 (tests of homogeneity of variances) 用于回答有关各个处理的数据方差的问题。如果有两种处理，当方差不等时比较均值的问题通常被称为 Behrens–Fisher 问题。此外，异质误差方差被忽略比数据的非正态性带来了更严重的问题5。第一章中的程序在非正态性方面是稳健的，但在异质误差方差方面不是那么稳健。在之前考虑的分析中，假设总体方差都相等，这在许多情况下是合理的假设。当方差不相等时，分析数据的一种方法是简单地忽略它们不相等的事实，并计算在方差相等的情况下计算的相同的 \\(F\\) 统计量或 \\(t\\) 检验。也许令人惊讶的是，模拟研究表明，这些通常的检验都非常好，特别是当样本量都相等或几乎相等时。此外，如果较大的样本量对应于具有较大方差的处理或总体，那么用等方差假设计算的检验也相当好。事实上，通常的检验非常好，以至于许多统计学家甚至不建议对等方差进行检验。其他人试图找到一种能稳定处理方差的变换，即通过变换数据使处理方差相等。当方差不相等时，有一些技术可以在不等方差模型的框架内对均值进行比较。 以下小节描述了单向模型的处理方差相等性的检验程序，以及当方差不相等时分析处理均值的程序。当怀疑通常的技术时，应使用这些程序。接下来描述不等方差模型。 2.1 模型定义和假设 不等方差模型为 \\[\\begin{equation} y_{ij}=\\mu_{i}+\\varepsilon_{ij}\\quad\\mathrm{for}\\quad i=1,2,\\ldots,t,\\,j=1,2,\\ldots,n_{i}\\quad\\mathrm{and}\\quad\\varepsilon_{ij}\\sim\\text{independent}\\,N(0,\\sigma_{i}^{2}) \\tag{2.1} \\end{equation}\\] 其中 \\(\\varepsilon_{ij}\\sim\\text{independent}\\,N(0,\\sigma_{i}^{2})\\) 表示误差 \\(\\varepsilon_{ij}\\) 都是独立地服从正态分布，并且每个正态分布的方差取决于 \\(i\\)，对于每个总体或处理可能不同。 2.2 参数估计 模型中参数的最佳估计值： \\[\\hat{\\mu}_i=\\sum_{j=1}^{n_i}y_{ij}/n_i=\\bar{y}_{i\\cdot},\\quad i=1,2,\\ldots,t\\] 和 \\[\\hat\\sigma_i^2=\\frac{\\sum_{j=1}^{n_i}(y_{ij}-\\overline{y}_i)^2}{n_i-1},\\quad i=1,2,\\ldots,t\\] 与参数估计相关的抽样分布为 \\[\\hat{\\mu}_i\\thicksim\\text{independent}\\,N(\\mu_i,\\sigma_i^2/n_i),\\quad i=1,2,\\ldots,t\\] 和 \\[\\frac{\\left(n_i-1\\right)\\hat\\sigma_i^2}{\\sigma_i^2}\\thicksim\\text{independent }\\,\\chi_{n_i-1}^2,\\quad i=1,2,\\ldots,t\\] 这些抽样分布被用作建立方差相等性检验的基础，并在方差不相等时提供均值分析。 2.3 方差齐性检验 本节描述了检验等方差假设的五个程序 \\[H_{0}\\colon\\,\\sigma_{1}^{2}=\\sigma_{2}^{2}=\\cdots=\\sigma_{t}^{2}\\,\\mathrm{~vs.~}\\,H_{a}\\colon(\\mathrm{not~}H_{0}:)\\] 在尝试分析均值之前，应研究等方差假设。如果没有足够的证据得出方差不相等的结论，则可以使用第 1 章中的等方差模型来研究均值。如果有足够的证据认为方差不相等，则应使用 2.5 节中描述的程序来提供不等方差框架中的均值分析。建议当不等方差假设在 \\(\\alpha\\le0.01\\) 时被拒绝时使用不等方差模型。 2.3.1 Hartley’s F-Max Test 所描述的第一个检验被称为 Hartley’s F-max检验 (Hartley, 1950). 该检验要求所有样本具有相同的大小，即 \\(n_1 = n_2 = \\cdots= n_t\\). 该检验基于统计量 \\[F_{\\max}=\\frac{\\max_i\\{\\hat\\sigma_i^2\\}}{\\min_i\\{\\hat\\sigma_i^2\\}}\\] 附表 A.1 提供了 \\(\\alpha = 0.05\\) 和 \\(0.01\\) 时 \\(F_{\\max}\\) 的百分位点。若 \\(F_{\\max} &gt; F_{\\max,\\alpha,v,k}\\)，其中 \\(v = n - 1\\) 为与 \\(k\\) 个处理方差中的每一个相关的自由度，则拒绝零假设 \\(H_0\\). 如果 \\(n_i\\) 不都相等，则可以通过取 \\(n=\\max_i\\{n_i\\}-1\\) 来获得 \\(H_0\\,\\mathrm{~vs.~} H_a\\) 的“自由” (liberal)检验。这个检验是自由的，因为它假设所有处理都有相同的（最大）样本量，所以你会比选定的显著性水平 \\(\\alpha\\) 更频繁地拒绝零假设6。当样本量相差不大7时，此程序提供了合理的检验。它还可以防止人们进行通常的方差分析，即使方差分析不合适的可能性极小。{#sec2-4} 节中有一个说明该检验使用的示例。 2.3.2 Bartlett’s Test 方差齐性检验的第二个检验是 (Bartlett, 1937) 提出的检验，其优点是不要求 \\(n_i\\) 相等。Bartlett 检验统计量为 \\[\\begin{equation} U=\\frac1C{\\left[v\\log_\\mathrm{e}(\\hat\\sigma^2)-\\sum_{i=1}^tv_i\\log_\\mathrm{e}(\\hat\\sigma_i^2)\\right]} \\tag{2.2} \\end{equation}\\] 其中 \\[v=n_i-1,\\quad v=\\sum_{i=1}^tv_i,\\quad\\hat\\sigma^2=\\sum_{i=1}^tv_i\\hat\\sigma_i^2/v \\] 且 \\[C=1+\\frac1{3(t-1)}{\\left[\\sum_{i=1}^t\\frac1{v_i}-\\frac1v\\right]}\\] 如果 \\(U&gt;\\chi_{\\alpha,t-1}^2\\)，则拒绝等方差假设。方差齐性的前两个检验的缺点之一是它们对偏离正态性以及偏离等方差假设非常敏感。 2.3.3 Levene’s Test Levene (1960) 建议对来自单向均值或效应模型的残差绝对值进行单向方差分析。残差绝对值由 \\(z_{ij}=|y_{ij}-\\overline{y}_{i\\cdot}|,i=1,2,\\ldots,t;j=1,2,\\ldots,n_{i}\\) 给出。方差分析的 \\(F\\) 检验提供残差绝对值的处理均值相等性检验。如果均值不等，则有证据表明，一种处理的残差平均而言大于另一种处理的残差。残差可以指导哪些方差不相等，多重比较检验（见第 3 章）可以用来对这些均值进行成对比较。Levene’s Test 的一个改进是在方差分析中使用残差平方。 2.3.4 Brown and Forsythe’s Test Brown and Forsythe (1974) 使用 Levene 的过程，并通过对每个处理的观察值与中位数的偏差的绝对值进行单向方差分析来对其进行修改。中位数偏差的绝对值由 \\(u_{ij}=|y_{ij}-y_{i\\mathrm{med}}|,i=1,2,\\ldots,t;j=1,2,\\ldots,n_{i}\\) 给出。方差分析的 \\(F\\) 检验提供了偏差绝对值的处理均值相等性检验。如果均值不等，则有证据表明，一种处理的偏差平均而言大于另一种处理的偏差。偏离中位数的绝对值的均值可以提供关于哪些方差不等的指导，因为多重比较检验可以用于在这些均值之间进行成对比较。当数据的分布不对称时，这种利用中位数偏差的方法提供了比 Levene’s method 更大的功效。 2.3.5 O’Brien’s Test O’Brien (1979) 计算了一种得分 \\[\\begin{equation} r_{ij}=[(w+n_i-2)n_i(y_{ij}-\\overline{y}_{i\\cdot})^2-w\\hat\\sigma_i^2(n_i-1)]/[(n_i-1)(n_i-2)] \\tag{2.3} \\end{equation}\\] 其中 \\(w\\) 为权重参数。该程序是对计算出的得分进行方差分析。当 \\(w=0.5\\) 时，得分的均值是样本方差 \\(\\hat \\sigma^2_i\\)，因此得分均值的比较是数据方差的比较。 还有其他几种程序可用于使用参数和非参数方法来检验方差相等或尺度参数相等 [如 Conover et al. (1981) 和 Olejnik &amp; Algina (1987)]。McGaughey (2003) 提出了一种使用数据深度 (data depth) 概念的检验，并将该程序应用于单变量和多变量总体。数据深度超出了本书的范围。 2.3.6 一些建议 Conover (1981) 以及 Olejnik &amp; Algina (1987) 对方差检验的同质性进行了模拟研究，其中包括上述检验以及许多其他检验。研究表明，没有一种检验对所有情况都是稳健和具有最大功效的。根据 Olejnik 和 Algina，Levene’s Test 是 Conover 等人研究的更好的检验之一。O’Brien’s Test 似乎提供了一个合适的大小检验，而不会损失太多功效。当分布具有重尾时，Brown–Forsyth’s Test 似乎更好。根据他们的结果，我们提出以下建议： 如果分布具有较重的尾部，请使用 Brown–Forsyth’s test. 如果分布有些偏斜，请使用 O’Brien’s test. 如果数据几乎是正态分布的，那么任何检验都是合适的，包括 Bartlett’s 和 Hartley’s tests. Levene’s 和 O’Brien’s tests 可以很容易地进行定制，用于涉及多个因素的设计实验，包括协方差分析 (Milliken and Johnson, 2002). Levene’s, O’Brien’s 和 Brown–Forsyth’s tests 在正态分布数据方面几乎与 Bartlett’s 和 Hartley’s tests 一样好，在非正态分布的数据方面优于它们。Conover et al. 以及 Olejnik 和 Algina 讨论了一些非参数检验，但它们更难计算，并且上述推荐的检验几乎同样有效。下面是一个示例，其中演示了用于方差相等的每个检验。 2.4 示例：药物和错误 表 2.1 中的数据来自在两种可能的药物影响下对个体8进行的配对联想学习任务 (paired-association learning task) 实验。第1组为对照组（无药物），第2组给药1，第3组给药2，第4组同时给两种药。每组数据的样本量、总和、中位数、平均值和方差见表 2.1。 表 2.1: 配对联想学习任务实验数据 x F-max 统计量为 \\(F_\\max=16.286/1.867=8.723\\). 取 \\(k=t=4,v=7\\) 的自由 \\(5\\%\\) 临界点从表 A.1 得到。临界点为 \\(8.44\\)，由于 \\(8.723&gt;8.44\\)，以 \\(0.05\\) 的显著性水平拒绝 \\(H_{0}\\colon\\,\\sigma_{1}^{2}=\\sigma_{2}^{2}=\\cdots=\\sigma_{t}^{2}\\,\\mathrm{~vs.~}\\,H_{a}\\colon(\\mathrm{not~}H_{0}:)\\)，但不能在 \\(0.01\\) 的水平拒绝。 Bartlett’s test 的计算为： \\[C=1+\\frac1{3\\times3}{\\left(\\frac16+\\frac15+\\frac17+\\frac17-\\frac1{25}\\right)}\\] 且 \\[\\hat\\sigma^2=\\frac{6(16.2857)+5(1.8667)+7(9.6964)+7(2.7860)}{25}=7.7769\\] 因此 \\[\\begin{aligned} U&amp; =\\frac1C{\\left(v\\log_e\\hat\\sigma^2-\\sum_{i=1}^4v_i\\log_e\\hat\\sigma_i^2\\right)} \\\\ &amp;=\\frac1{1.068}[25\\log_{\\mathrm{e}}(7.7769)-6\\log_{\\mathrm{e}}(16.2857)-5\\log_{\\mathrm{e}}(1.8667) \\\\ &amp;-7\\log_{\\mathrm{e}}(9.6964)-7\\log_{\\mathrm{e}}(2.7860)] \\\\ &amp;=7.8111 \\end{aligned}\\] 与 \\(U\\) 相关的渐近抽样分布是基于自由度为 \\(3\\) 的卡方分布，检验的显著性水平为 \\(0.0501\\)，可以再次得出结论，方差在大约 \\(5\\%\\) 的显著性水平上是不相等的。 Levene’s test 的计算从残差或观测值与处理均值的偏差的计算开始。接下来，如表 2.2 所示计算残差的绝对值。最后，对残差的这些绝对值进行单向方差分析。所得到的 \\(F\\) 统计量的值为 \\(6.97\\)，其基于自由度 \\(3,25\\)。观察到的 Levene’s test 的显著性水平为 \\(0.0015\\). 在进行方差分析之前，可以通过对表 2.2 中的项目进行平方来获得 Levene’s test 的平方偏差或平方残差版本。在这种情况下，\\(F\\) 统计量的值为 \\(7.36\\)，观察到的显著水平为 \\(0.0011\\)（也基于自由度 \\(3,25\\)）。 表 2.2: 计算 Levene’s test 的 \\(z_{ij} = |y_{ij}-y_{i\\cdot}|\\) 值，其中 \\(y_{ij}\\) 来自表 2.1 x Brown–Forsyth’s test 统计量是通过计算观察值与处理中位数偏差的绝对值（中位数见表 2.1）获得的。表 2.3 包含了与中位数偏差的绝对值。接下来，单向方差分析提供的 \\(F\\) 统计量为 \\(5.49\\)，并且观察到的显著性水平是 \\(0.0049\\)（也基于自由度 \\(3,25\\)）。 表 2.3: 观测结果相对于处理中位数偏差的绝对值 x 表 2.4 包含使用式 (2.3) 计算的 \\(r_{ij}\\) 值，其中 \\(w = 0.5\\). 通过进行方差分析获得 O’Brien’s test 统计量。\\(F\\) 统计量的值为 \\(6.30\\)，观察到的显著性水平为 \\(0.0025\\). 使用 \\(w = 0.7\\)（计算未显示）的 \\(F\\) 统计量值为 \\(5.90\\)，观察到的显著性水平为 \\(0.0035\\). 每个 O’Brien’s test 都基于自由度 \\(3,25\\). 表 2.4: 使用 \\(w=0.5\\) 进行 O’Brien’s Test 的得分 x 每个检验统计量表明，有足够的证据得出方差不相等的结论。残差绝对值的组均值见表 2.5。这些处理的残差绝对值均值之间的成对比较见表 2.6。无药物和药物2的残差绝对值的平均值没有差异，药物1和同时给药没有差异，但是这两组之间存在差异。可以使用具有两个方差的简单模型来继续分析治疗均值。使用简单方差模型将提高一些关于均值检验的功效。两个方差模型和相应的均值比较将遵循使用四个方差的分析的讨论。 表 2.5: 残差绝对值均值 x 表 2.6: 残差绝对值组均值的成对比较 x 2.5 关于线性组合的推断 当方差 \\(\\sigma_i^2\\) 相差很大而无法应用第 1 章中讨论的检验和置信区间时，本节讨论了处理均值的任意线性组合 \\(\\sum_{i=1}^tc_i\\mu_i\\) 的假设检验和置信区间的构造问题。如果方差相等假设在 \\(0.01\\) 或 \\(1\\%\\) 水平被拒绝，建议使用本节和下一节中的程序。如果没有足够的证据证明方差不等，则可以使用第 1 章中的结果对处理均值进行推断。 \\(\\sum_{i=1}^tc_i\\mu_i\\) 的最佳估计为 \\(\\sum_{i=1}^tc_i\\hat \\mu_i\\)，其抽样分布为 \\[\\sum_{i=1}^tc_i\\hat{\\mu}_i\\sim N{\\left(\\sum_{i=1}^tc_i\\mu_i,\\sum_{i=1}^tc_i^2\\sigma_i^2/n_i\\right)}\\] 因此 \\[z=\\frac{\\sum_{i=1}^{t}c_{i}\\hat{{\\mu}}_{i}-\\sum_{i=1}^{t}c_{i}\\mu_{i}}{\\sqrt{\\sum_{i=1}^{t}c_{i}^{2}\\sigma_{i}^{2}/n_{i}}}\\sim N(0,1)\\] 当方差未知且不等时，一个明显可用于推断 \\(\\sum_{i=1}^tc_i\\mu_i\\) 的统计量为 \\[z=\\frac{\\sum_{i=1}^tc_i\\hat{\\mu}_i-\\sum_{i=1}^tc_i{\\mu}_i}{\\sqrt{\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2/n_i}}\\] 如果非零 \\(c_i\\) 对应的 \\(n_i\\) 都非常大，则可以合理地假设 \\(Z\\) 具有近似 \\(N(0,1)\\) 分布，因此 \\(Z\\) 可以用于推断 \\(\\sum_{i=1}^tc_i\\mu_i\\). 此时 \\(\\sum_{i=1}^tc_i\\mu_i\\) 的近似 \\((1 - \\alpha)100\\%\\) 置信区间由下式提供： \\[\\sum_{i=1}^tc_i\\hat{\\mu}_i\\pm z_{\\alpha/2}\\sqrt{\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2/n_i}\\] 如果\\(|z| &gt; z_{\\alpha/2}\\)，则在显著性水平 \\(\\alpha\\) 处拒绝 \\(H_0\\). 在其他情况下，注意 \\(z\\) 可以写为 \\[z=\\frac{\\left(\\sum_{i=1}^tc_i\\hat{{\\mu}}_i-\\sum_{i=1}^tc_i\\mu_i\\right)\\Big/\\sqrt{\\sum_{i=1}^tc_i^2\\sigma_i^2/n_i}}{\\sqrt{\\sum_{i=1}^tc_i^2\\hat{\\sigma}_i^2/n_i}\\Big/\\sqrt{\\sum_{i=1}^tc_i^2\\sigma_i^2/n_i}}\\] \\(z\\) 的分子具有标准正态分布，\\(z\\) 的分子和分母独立。\\(z\\) 的分布可以近似为 \\(t(v)\\) 分布，如果 \\(v\\) 的值可以使得 \\[V=v\\times\\frac{\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2\\big/n_i}{\\sum_{i=1}^tc_i^2\\sigma_i^2\\big/n_i}\\] 近似服从 \\(\\chi^2(v)\\). 为了在方差不等时得到 \\(V\\) 的分布的良好卡方近似，选择具有与 \\(V\\) 相同的前两阶矩的卡方分布。也就是说，为了在方差不等的情况下找到 \\(v\\)，求出 \\(v\\) 使得 \\(V\\) 的矩等于 \\(\\chi^2(v)\\) 分布的前两阶矩（这就是所谓的 Satterthwaite’s method ）。这导致自由度为： \\[{v}=\\frac{\\left(\\sum_{i=1}^tc_i^2\\sigma_i^2/n_i\\right)^2}{\\sum_{i=1}^t\\left[c_i^4\\sigma_i^4/n_i^2(n_i-1)\\right]}\\] 不幸的是，由于 \\(v\\) 取决于 \\(\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_t^2\\)，因此无法精确确定。通常的程序是通过下式来估计 \\(v\\)： \\[\\begin{equation} \\hat{{v}}=\\frac{\\left(\\sum_{i=1}^tc_i^2\\hat{\\boldsymbol\\sigma}_i^2/n_i\\right)^2}{\\sum_{i=1}^t\\left[c_i^4\\hat{\\sigma}_i^4/n_i^2(n_i-1)\\right]} \\tag{2.4} \\end{equation}\\] 综上所述，拒绝 \\(H_0\\colon\\sum_{i=1}^tc_i\\mu_i=a\\,\\mathrm{~vs.~}H_a{:}\\sum_{i=1}^tc_i\\mu_i\\neq a\\)，如果 \\[\\left|t_c\\right|=\\frac{\\left|\\sum_{i=1}^tc_i\\hat{\\mu}_i-a\\right|}{\\sqrt{\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2/n_i}}&gt;t_{\\alpha/2,\\hat{v}}\\] 其中 \\(\\hat v\\) 由式 (2.4) 确定。\\(\\sum_{i=1}^tc_i\\mu_i\\) 近似 \\((1 - \\alpha)100\\%\\) 置信区间由下式给出 \\[\\sum_{i=1}^tc_i\\hat{\\mu}_i\\pm t_{\\alpha/2,\\hat{v}}\\sqrt{\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2/n_i}\\] 不幸的是，每当人们想要检验一个新的假设或构造另一个置信区间时，自由度 \\(\\hat v\\) 必须重新估计。可以证明 \\(n_*-1\\leq\\hat{v}\\leq t(n^*-1)\\) 其中 \\(n_*=\\min\\{n_1,n_2,\\ldots,n_t\\}\\) 且 \\(n^*=\\max\\{n_1,n_2,\\ldots,n_t\\}\\). 因此，如果 \\(|t_c|&gt;t_{\\alpha/2,n_*-1}\\)，则可以保证 \\(|t_c|&gt;t_{\\alpha/2,\\hat{v}}\\)；如果 \\(|t_c|&lt;t_{\\alpha/2,t(n^*-1)}\\)，则可以保证 \\(|t_c|&lt;t_{\\alpha/2,\\hat{v}}\\). 此时我们可以避免计算 \\(\\hat v\\). 当 \\(t_{\\alpha/2,t(n^*-1)}&lt;|\\left.t_c\\right|&lt;t_{\\alpha/2,n^*-1}\\)，为了确定是否应该拒绝或不拒绝被检验的零假设，必须计算 \\(\\hat v\\) 的值。为了获取置信区间，通常需要计算 \\(\\hat v\\). 接下来，用药物误差的示例来证明前面的结果。 2.6 示例：药物和错误（续） 考虑表 2.1 中的数据，假设实验者有兴趣回答以下问题： 平均而言，药物对学习有任何影响吗？ 当给予两种药物时，个体犯的错误是否比只给予一种药物时更多？ 两种药物对错误数量的影响是否不同？ 为了回答第一个问题，可以检验三个药物组的均值等于对照组均值的假设。 \\[H_{01}{:}\\,l_1=\\mu_1-\\frac{(\\mu_2+\\mu_3+\\mu_4)}3=0\\mathrm{~vs~}H_{a1}{:}\\,l_1\\neq0\\] 该线性组合的估计为 \\[\\hat{l}_1=\\hat{\\mu}_1-\\frac{\\hat{\\mu}_2+\\hat{\\mu}_3+\\hat{\\mu}_4}3=4.571-\\frac13(34.042)=-6.776\\] \\(\\hat l_1\\) 相应的标准误估计为 \\[\\begin{aligned} s.e.(\\hat{l}_1)&amp; =\\sqrt{\\sum_{i=1}^4\\left(\\frac{c_i^2\\hat\\sigma_i^2}{n_i}\\right)} \\\\ &amp;=\\sqrt{\\frac{\\hat\\sigma_1^2}7+\\frac19{\\left(\\frac{\\hat\\sigma_2^2}6\\right)}+\\frac19{\\left(\\frac{\\hat\\sigma_3^2}8\\right)}+\\frac19{\\left(\\frac{\\hat\\sigma_4^2}8\\right)}}\\\\ &amp;=\\sqrt{2.535}\\\\ &amp;=1.592 \\end{aligned}\\] 与此标准误估计相关的近似自由度通过使用 \\[\\sum_{i=1}^4\\frac{c_i^4\\hat\\sigma_i^4}{n_i^2(n_i-1)}=0.9052\\] 使得 \\[\\hat{v}=\\frac{(2.535)^2}{0.9052}=7.10\\] 检验统计量的值为 \\(t_c=-6.776/1.992=-4.256\\)，观察到的显著性水平为 \\(\\hat \\alpha= 0.0038\\). \\(l_1\\) 的 \\(95\\%\\) 置信区间为 \\[\\hat{l}_1\\pm t_{\\alpha/2,\\hat{v}}\\times\\widehat{s.e.}(\\hat{l}_1)=-6.776\\pm(2.365)(1.592)\\] 简化为 \\[-10.54&lt;\\mu_1-\\frac{\\mu_2+\\mu_3+\\mu_4}3&lt;-3.01\\] 下一个检验是看给予两种药物组的均值是否等于两种药物组的均值的均值。也就是检验 \\[H_{02}\\colon l_2=\\mu_4-\\frac{\\mu_2+\\mu_3}2=0\\,\\mathrm{~vs.~}H_{a2}{:}\\,l_2\\neq0\\] 该线性组合的估计为 \\[\\hat l_2=\\hat{\\mu}_4-\\frac{\\hat{\\mu}_2+\\hat{\\mu}_3}2=3.6042\\] 其估计标准误为 \\[\\begin{aligned} \\widehat{s.e.}(\\hat{l}_{2})&amp; =\\sqrt{\\sum_{i=1}^4\\left(\\frac{c_i^2\\hat\\sigma_i^2}{n_i}\\right)} \\\\ &amp;=\\sqrt{\\frac14\\!\\left(\\frac{\\hat\\sigma_2^2}6\\right)+\\frac14\\!\\left(\\frac{\\hat\\sigma_3^2}8\\right)+\\left(\\frac{\\hat\\sigma_4^2}8\\right)}\\\\ &amp;=\\sqrt{0.7290}\\\\ &amp;=0.8538 \\end{aligned}\\] 检验统计量的值为 \\(t_c = 3.6042/0.8538 = 4.221\\)，因为 \\(|t_c|&gt;t_{0.005,5}\\) 它在 \\(\\alpha=0.01\\) 水平下显著。此时 \\(\\hat v\\) 的值不需要用 \\(n_ *-1\\) 作为近似自由度来计算，计算出的 \\(\\hat v\\) 的值为 \\(16.8\\) ，这是构造 \\(l_2\\) 置信区间所需要的 最后，为了检验假设以查看两种药物的均值是否不同，检验 \\(H_0{:}\\,l_3 = \\mu_2 - \\mu_3 = 0 \\,\\mathrm{~vs.~} H_a{:}\\,l_3 = \\mu_2 - \\mu_3 \\ne 0\\). 该线性组合的估计值为 \\(\\hat l_3 = \\hat\\mu_2 - \\hat\\mu_3=3.042\\)，其标准误估计为 \\[\\widehat{s.e.}(\\hat{l}_3)=\\sqrt{\\sum_{i=1}^4\\left(\\frac{c_i^2\\hat\\sigma_i^2}{n_i}\\right)}=\\sqrt{\\left(\\frac{\\hat\\sigma_2^2}{6}\\right)+\\left(\\frac{\\hat\\sigma_3^2}8\\right)}=\\sqrt{1.523}=1.234\\] 近似自由度的计算通过使用： \\[\\sum_{i=1}^4\\frac{c_i^4\\hat\\sigma_i^4}{n_i^2(n_i-1)}=0.229\\] 使得 \\[\\hat{v}=\\frac{(1.523)^2}{0.229}=10.1\\] 因此，\\(t_c = 3.042/1.234 = 2.465\\)，观察到的显著性水平为 \\(\\hat\\alpha = 0.0334\\). 2.7 自由度的一般 Satterthwaite 近似 与估计标准误差相关的自由度的 Satterthwaite 近似由下式获得 \\[v=\\frac{2*(E\\{[\\widehat{s.e.}(\\hat{l})]^2\\})^2}{\\mathrm{Var}\\{[\\widehat{s.e.}(\\hat{l})]^2\\}}\\] 其中 \\([\\widehat{s.e.}(\\widehat{l})]^2\\) 用于估计 \\(E[s.e.(\\hat{l})]^2\\)，且 \\(\\mathrm{Var}[\\widehat{s.e.}(\\hat{l})]^2\\) 的值由 \\(\\sum_{i=1}^t\\left[c_i^4\\sigma_i^4/n_i^2(n_i-1)\\right]\\) 估计。对于更复杂的模型，\\(\\mathrm{Var}[\\widehat{s.e.}(\\widehat{l})]^2\\) 可以通过使用一阶泰勒级数 (Kendall and Stuart, 1952) 近似为 \\(\\boldsymbol q&#39;\\boldsymbol M \\boldsymbol q\\)，其中 \\(\\boldsymbol M\\) 是方差估计的渐近协方差矩阵估计，向量 \\(\\boldsymbol q\\) 的元素是 \\(E[s.e.(\\hat{l})]^2\\) 关于单个方差的一阶导数，即9 \\[q_{i}=\\frac{\\partial E[(s.e.(\\hat{l})]^{2}}{\\partial\\sigma_{i}^{2}},\\quad i=1,2,\\ldots,t\\] 根据各处理方差的估计值评估 \\(q_i\\) (Montgomery and Runger, 1993, 1994). 当每个样本的数据呈正态分布时，则 \\[\\frac{(n_i-1)\\hat\\sigma_i^2}{\\sigma_i^2}\\] 为中心卡方随机变量。因此 \\(E(\\hat\\sigma_i^2)=\\sigma_i^2\\) 且 \\(\\operatorname{Var}(\\hat\\sigma_i^2)=2\\sigma_i^4/(n_i-1)\\). 令感兴趣的线性组合为 \\(l=\\sum_{i=1}^{t}c_{i}\\mu_{i}\\)，其方差为 \\(\\sigma_{l}^{2}=\\sum_{i=1}^{t}c_{i}^{2}\\sigma_{i}^{2}/n_{i}\\)，则 \\(\\sigma_{l}^{2}\\) 关于 \\(\\hat \\sigma_{i}^{2}\\) 的偏导数为 \\[\\frac{\\partial\\sigma_l^2}{\\partial\\sigma_i^2}=\\frac{c_i^2}{n_i}\\] 使用泰勒级数一阶近似获得的 \\(\\sigma_{l}^{2}\\) 的近似方差为 \\[\\mathrm{Var}(\\sigma_l^2)=\\sum_{i=1}^t\\left[\\left[\\frac{c_i^2}{n_i}\\right]^2\\left[\\frac{2\\sigma_i^4}{n_i-1}\\right]\\right]^2\\] 下一步是用提供近似自由度的相应样本估计值替换总体方差 \\[\\hat{v}=\\frac{2*\\left(E\\{[\\widehat{s.e.}(\\hat{l})]^2\\}\\right)^2}{\\mathrm{Var}\\{[\\widehat{s.e.}(\\hat{l})]^2\\}}=\\frac{\\left(\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2\\right)^2}{\\sum_{i=1}^tc_i^4\\hat\\sigma_i^4/[n_i^2(n_i-1)]}\\] 与上述 Satterthwaite 近似相同。 2.8 比较所有均值 如前所述，当方差不等时，通常的 \\(F\\) 检验非常稳健，前提是样本量几乎相等，或者假设较大的样本量对应于方差差异较大的总体样本。本节提供了两个等均值假设的附加检验。等均值假设的第一个检验 \\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\,\\mathrm{~vs.~}H_{a}\\colon\\,(\\operatorname{not}H_{0}{:})\\) ，由 Welch (1951) 给出，称为 Welch’s test。定义权重 \\(W_{i}=n_{i}/\\hat\\sigma_{i}^{2}\\)，令 \\(\\bar{y}^{*}=\\sum_{i=1}^{t}W_{i}\\bar{y}_{i\\cdot}\\big/\\sum_{i=1}^{t}W_{i}\\) 为样本均值的加权平均值，令 \\[\\Lambda=\\sum_{i=1}^{t}\\frac{(1-W_{i}/W_{\\cdot})^{2}}{n_{i}-1}\\] 其中 \\(W_\\cdot=\\sum_{i=1}^tW_{i\\cdot}\\). 那么 Welch’s test 统计量为 \\[\\begin{equation} F_c=\\frac{\\sum_{i=1}^tW_i\\frac{(\\bar{y}_i.-\\bar{y}^*)}{(t-1)}}{1+2(t-1)\\Lambda/(t^2-1)} \\tag{2.5} \\end{equation}\\] 它具有近似的 \\(F\\) 分布，分子分母自由度分别为 \\(v_{1}=t-1,\\,v_{2}=(t^{2}-1)/3\\Lambda\\). 因此当 \\(F_{c}&gt;F_{\\alpha,v_{1},v_{2}}\\)，拒绝零假设 \\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\). 式 (2.5) 的分子也可以计算为：\\([\\sum_{i=1}^{t}W_{i}\\bar{y}_{i\\cdot}^{2}-\\overline{W}\\bar{y}^{*2}]/(t-1)\\). 该程序使用 2.7 节中的数据进行了演示，初步计算见表 2.7. 表 2.7: 计算 Welch’s test 的量 x 根据以上信息计算 \\(W_\\cdot=7.341,\\bar{y}^{*}=11.724\\) \\[\\Lambda=\\frac{(1-0.430/7.341)^2}6+\\frac{(1-3.214/7.341)^2}5+\\frac{(1-0.825/7.341)^2}7+\\frac{(1-2.872/7.341)^2}7=0.376\\] 且 \\(\\sum_{i=1}^{t}W_{i}\\left.\\bar{y}_{i\\cdot}^{2}-\\overline{W}\\right.\\bar{y}^{*2}=1050.8069-1009.0954=43.7114\\). Welch’s test 统计量的值为 \\[F_c=\\frac{41.7114/3}{1+2\\times2\\times0.376/15}=\\frac{13.9038}{1.1003}=12.6355\\] 自由度为 \\(v_1=3,v_2=15/(3×0.376) = 13.283\\). 观察到的 \\(F_c\\) 相应的显著性概率为 \\(\\hat \\alpha=0.00035\\). 出于比较目的，通常的 \\(F\\) 统计量 \\(F_c=14.91\\)，自由度为 \\(3,25\\). Welch’s test 可以使用 SAS®GLM 通过在 MEANS 语句中指定 Welch 选项来获得。表 2.8 包含 GLM 代码，用于提供方差相等的 BF 检验和均值相等的 Welch 检验。部分重要结果见表 2.8 的第二部分。其他方差相等的检验可以通过指定 O'Brien、Levene 或 Bartlett 来获得。 表 2.8: SAS-GLM 代码提供 Brown-Forsythe 方差齐性检验和 Welch 方差齐性检验 x 检验处理均值相等的第二个程序是将检验一组处理均值 \\(\\mu_i\\) 线性组合假设的过程加以推广。 设一个假设是由 \\(r\\) 个独立的 \\(\\mu_i\\) 的线性组合组成的，例如 \\(H_{0}\\colon\\,\\sum_{i=1}^{t}c_{1i}\\mu_{i}=0,\\sum_{i=1}^{t}c_{2i}\\mu_{i}=0,\\ldots,\\sum_{i=1}^{t}c_{ri}\\mu_{i}=0\\,\\mathrm{~vs.~}H_{a}:(\\mathrm{not}\\,H_{0})\\). 设 \\(\\boldsymbol C\\) 是一个矩阵，其第 \\(k\\) 行是第 \\(k\\) 个线性组合的系数，若假定每个总体或处理的数据均服从正态分布，则处理均值向量的联合抽样分布为 \\(\\hat{\\boldsymbol{\\mu}}\\sim N[\\boldsymbol{\\mu},\\boldsymbol V]\\)，其中 \\(\\boldsymbol V\\) 是一个对角阵，其第 \\(i\\) 个对角元素为 \\(\\sigma^2_i /n_i\\). 线性组合集 \\(\\boldsymbol C \\boldsymbol \\mu\\) 的联合抽样分布为 \\(\\boldsymbol{C\\hat{\\boldsymbol{\\mu}}}\\sim N[\\boldsymbol{C\\mu},\\boldsymbol{CV}\\boldsymbol{C}^{\\prime}]\\). 与零假设的偏差导致的平方和为 \\(SSH_{0} = [\\boldsymbol C\\hat{\\boldsymbol{\\mu}}]^{\\prime}[\\boldsymbol C\\hat{\\boldsymbol V}\\boldsymbol C^{\\prime}]^{-1}[\\boldsymbol C\\hat{\\boldsymbol{\\boldsymbol \\mu}}]\\)，其渐近分布为具有 \\(r\\) 个自由度的卡方分布。近似小样本量统计量为 \\(F_c = SSH_ 0/r\\)，近似分布为 \\(F\\)，自由度为 \\(r,v\\)，其中 \\(v\\) 需要近似 (Fai and Cornelius, 1996; SAS Institute, Inc., 1999, p. 2118). 近似自由度的计算开始于对 \\(\\boldsymbol C \\hat {\\boldsymbol V} \\boldsymbol C&#39; = \\boldsymbol Q \\boldsymbol D \\boldsymbol Q&#39;\\) 执行谱分解，其中 \\(\\boldsymbol D\\) 是具有 \\(\\boldsymbol C \\hat {\\boldsymbol V} \\boldsymbol C&#39;\\) 的特征根作为对角元素的 \\(r×r\\) 对角阵，并且 \\(\\boldsymbol Q\\) 是 \\(\\boldsymbol C \\hat {\\boldsymbol V} \\boldsymbol C&#39;\\) 的对应特征向量的 \\(r×r\\) 正交矩阵。令 \\(\\boldsymbol z_k&#39;\\) 为 \\(\\boldsymbol Q \\boldsymbol C\\) 的第 \\(k\\) 行，并令 \\[\\nu_k=\\frac{2(d_k)^2}{\\boldsymbol b_k&#39;\\boldsymbol M\\boldsymbol b_k}\\] 其中 \\(d_k\\) 是 \\(\\boldsymbol D\\) 的第 \\(k\\) 个对角元素，\\(\\boldsymbol b_k\\) 包含 \\(\\boldsymbol z_k&#39;\\boldsymbol V \\boldsymbol z_k\\) 关于 \\(\\boldsymbol V\\) 中每个方差参数的偏导数在方差估计处的值，\\(\\boldsymbol M\\) 是方差向量的渐近协方差。令 \\[S=\\sum_{k=1}^r\\frac{v_k}{v_k-2}I[v_k&gt;2]\\] 其中 \\(I[v_k&gt;2]\\) 是一个指示函数，当 \\(v_k &gt; 2\\) 时值为 \\(1\\)，否则为 \\(0\\). \\(F_c\\) 分布的近似分母自由度为 \\[v=\\begin{cases}\\frac{2S}{S-r}&amp;\\mathrm{if~}S&gt;r\\\\0&amp;\\mathrm{if~}S\\leq r&amp;\\end{cases}\\] 上述过程可用于通过选择一组 \\(t - 1\\) 个线性独立的 \\(\\mu_i\\) 的对比来提供等均值假设的检验。 SAS-Mixed 程序实现了一种对分母自由度的近似，该分母自由度与分子中具有多个自由度的近似 \\(F\\) 统计量相关。SAS-Mixed 可用于拟合每个处理组方差不等的模型，或使用 REPEATED 语句并指定 GROUP = 选项。表 2.9 中的 Mixed 代码将不等方差模型拟合至表 2.1 中的数据。REPEATED 语句用于指定要为每个处理估计不同的方差（组的每个值）。三个 Estimate 语句用于提供与 2.6 节中的三个问题相对应的计算。 表 2.9: 将不等方差模型拟合到表 2.1 中的数据的 SAS-Mixed 代码 x proc mixed cl covtest data=task; class group; model errors=group/ddfm=kr; repeated/group=group; estimate “part(1)” group -1 -1 -1 3/divisor=3 cl alpha=0.05; estimate “part(2)” group 2 -1 -1 0/divisor=2 cl alpha=0.05; estimate “part(3)” group 0 1 -1 0/cl alpha=0.05; lsmeans group/diff cl; Mixed 程序的结果见表 2.10，其中协方差参数估计值是四个处理方差的估计值，拟合统计量中的 AIC 是 Akaike Information Criteria (Akaike, 1974)，模型似然比检验提供了等方差假设的检验，固定效应的 III 型检验使用第二个统计量和分母的相应近似自由度提供了等均值假设的检验，估计值包含与 2.6 节中的三个问题对应的结果，其中提供了 \\(t\\) 统计量、近似分母自由度和 \\(95\\%\\) 置信区间。表 2.11 包含了处理均值估计及其相应的标准误估计。名义自由度是与它们各自的方差相对应的自由度。表 2.11 的第二部分包含处理均值的成对比较，包括每次比较的近似分母自由度。该模型可以通过对药物1和两种药物使用一个方差，对药物2和无药物使用一种方差来简化。这可以通过定义一个变量来实现，比如T，对于药物1和两种药物都是1，对于其他两种处理是0。然后在模型指定中将T放在class语句中，并使用 Repeated/Group=T;。两个方差的估计值分别为 \\(2.4028\\) 和 \\(12.7376\\)，\\(AIC\\) 为 \\(126.4\\)，这比四方差模型的 \\(AIC\\) 值小，表明两方差模型足以描述数据。使用在模型指定中具有较少方差的模型为相应的标准误提供了更多的自由度，从而提供了关于模型中固定效应的假设的更有效的检验。 表 2.10: 将不等方差模型拟合到表 2.1 中的数据的结果 x 表 2.11: 利用不等方差模型估计药物组均值和配对比较 x 2.9 结束语 总之，为了比较所有均值，建议采用以下方法： 如果方差齐性检验在 \\(1\\%\\) 的水平上不显著，则进行通常的方差分析检验。 如果方差齐性检验在 \\(1\\%\\) 的水平上显著，则使用 Welch’s test 或混合模型检验以及相应的近似分母自由度。 如果方差齐性检验在 \\(1\\%\\) 的水平上显著，则使用 \\(AIC\\) 来确定是否可以使用更简单或更少数量的方差来充分描述数据，以增加与均值有关检验的功效。 许多教科书和文章都写过关于对数据进行转换以实现相等的处理方差，从而可以使用通常的方差分析来比较处理。由于能够建立一个不等方差模型来提供均值的标准误估计和均值的比较，许多情况下不需要使用变换。不必使用变换来实现相等方差的一个主要好处是，平均值的单位是测量单位，从而简化了解释。 本章讨论了具有异质误差的单向方差分析模型的统计分析。讨论包括确定误差方差齐性的几个统计检验，以及何时使用每个检验的建议。讨论了在发现误差方差不齐时，对不同处理的效应进行统计推断的适当程序，还回顾了说明这些程序使用的示例。 2.10 练习 原文为: heterogeneous error variances pose a much more serious problem when ignored than non-normality of the error variances，应为笔误，此处译者做了修改。↩︎ 原文为: so you are going to reject the null hypothesis more often than specified by the choice of \\(\\alpha\\).↩︎ 原文为: not too unequal.↩︎ 本文将 “subject” 统一翻译为“个体”，不论语境。↩︎ 原文分子没有 \\(\\partial\\)，应为笔误，此处已修改。↩︎ "],["chap3.html", "第 3 章 联合推断程序和多重比较 3.1 错误率 3.2 建议 3.3 最小显著差异 3.4 Fisher’s LSD Procedure 3.5 Bonferroni’s Method 3.6 Scheffé’s Procedure 3.7 Tukey–Kramer Method 3.8 模拟方法 3.9 Šidák Procedure 3.10 示例：成对比较 3.11 Dunnett’s Procedure 3.12 示例：与对照比较 3.13 多元 \\(t\\) 3.14 示例：线性独立比较 3.15 序贯拒绝方法 3.16 示例：线性相关比较 3.17 多重极差检验 3.18 Waller–Duncan Procedure 3.19 示例：成对比较的多重极差 3.20 警示 3.21 结束语 3.22 练习 参考文献", " 第 3 章 联合推断程序和多重比较 通常实验者想在同一个实验中比较多个 \\(\\mu_i\\) 的函数，导致多重检验的情况。也就是说，他们应该试图回答所有关于处理之间关系的问题。在实验或研究中包括两种以上处理的首要原因是能够估计和/或检验关于处理均值之间几种关系的假设。通常，选择处理是为了提供感兴趣的比较结构（例如参见 2.4 节中的药物实验）。在其他时候，实验者可能对将每种处理与其他所有处理进行比较感兴趣，即，进行所有成对比较。例如，当一个人比较几种小麦的产量或任何其他一组被选择用于比较研究的处理时，就是这样的情况。 在一个实验中进行多次比较时，一个值得关注的问题是，观察到的显著性差异是由于真实的差异，还是仅仅由于进行了大量的比较。进行大量的比较增加了发现看似显著但实际上并不显著的差异的机会。例如，如果一个实验者在一个实验中进行了 \\(25\\) 次独立检验，并在 \\(0.05\\) 的水平上发现了一个显著差异，那么她不应该对结果抱有太大的信心。因为平均而言，她应该预期仅凭偶然就发现 \\((0.05)(25)= 1.25\\) 个显著差异。因此，如果实验者用一个实验回答大量问题（我们认为应该这样做），那么最好有一个程序来表明这些差异是否只是偶然的结果。Fisher (1949) 提出了受保护最小显著差异 (least significant difference, LSD）程序，解决了这一问题。从那时起，许多作者对多重检验领域做出了贡献，此领域已经开发了多种设置的程序。 在本章中，讨论并比较了几种著名且常用的多重推断程序。其中一些程序主要用于检验假设，而另一些程序也可用于获得联合置信区间 (simultaneous confidence intervals)；也就是说，对于 \\(\\mu_i\\) 的一组函数，可以导出一组置信区间。对于这些置信区间，有 \\(95\\%\\) 的把握认为所有的置信区间同时 (simultaneously) 包含它们各自的 \\(\\mu_i\\) 的函数。 3.1 错误率 评估和比较多重比较程序的主要方法之一是计算错误率 (error rates)。如果给定的置信区间不包含所估计数量的真实值，则会出现错误。类似地，如果使用假设检验，那么每当真假设被拒绝或假假设没有被拒绝时，就会出现错误。接下来定义了四种错误率。 定义 3.1 ♦ 比较错误率 (comparisonwise error rate) 等于在所有分析的实验中做出的错误推断的数量与做出的推断总数的比值。 定义 3.2 ♦ 实验误差率 (experimentwise error rate, EER) 等于至少发生一次错误的实验数与分析的实验总数的比值。它是当处理之间没有差异时，在实验中至少发生一次错误的概率。EER 也称为完全零假设下的实验误差率 (experimentwise error rate under the complete null hypothesis, EERC). 定义 3.3 ♦ 族错误率 (familywise error rate, FWER) (Westfall et al, 1999) 是对一个预定的 \\(k\\) 个比较或置信区间的集合做出至少一个错误推断的概率，此 \\(k\\) 个比较或置信区间的集合称为推断族。 定义 3.4 ♦ 错误发现率 (false discovery rate, FDR)(Benjamini and Hochberg, 1995) 是被拒绝的假设中被错误拒绝的假设的预期比例。 当零假设是所有处理都同等有效时，即处理均值之间没有差异时，EER 控制错误率。但许多实验涉及一组选定的处理，其中某些处理之间存在已知差异。可能存在一个包含 \\(k\\) 个零假设 \\(H_{01},H_{02},\\cdots,H_{0k}\\) 的集合，这些是关于 \\(t\\) 个均值的假设，而不是所有均值都相等的零假设。这 \\(k\\) 个零假设被称为部分零假设 (partial null hypothesis)，并且通过使用控制 FWER 的方法来控制错误率。例如，练习2.3中的一组处理是六种糖果类型：buttons, blue choc, red choc, small choc, chocChip 和 WchocChip。在研究开始时，人们已知溶解 small choc 所需的时间远小于溶解任何其他糖果所需要的时间。零问题 (null hypothesis) 可能是：溶解 small choc 所需的时间是否等于溶解 blue choc 和 red choc 所需平均时间的一半？在这种情况下，控制 FWER 的方法是合适的，因为使用控制 EER 的方法的条件不成立；也就是说，从一开始就已知平均时间不完全相等。FDR 在遗传学中的微阵列实验中非常有用。 为了避免在单个实验中偶然发现太多显著的比较，人们常常试图在适当的时候将整个实验的错误率或 FWER 固定在某个规定的水平上，如 \\(0.05\\). 当实验者试图用一次实验回答许多问题时，控制 FWER 是一个很好的策略。 3.2 建议 多重比较问题有五种基本类型：1) 将一组处理与一个对照或标准进行比较；2) 在一组 \\(t\\) 个均值之间进行所有成对比较；3) 构造一组联合置信区间或假设的联合检验 (simultaneous confidence intervals or simultaneous tests of hypotheses)；4) 探索性实验并进行大量检验；以及 5) 数据窥探 (data snooping)，其中比较 (comparisons) 可能是数据驱动的。在前四种情况下，在数据被分析之前，比较的数量或置信区间或推入族是已知的。在最后一种情况下，没有固定的比较数量，最终的比较数量可能很大。2本章给出的建议是基于 Westfall et al. (1999), SAS Institute, Inc. (1999), and Westfall (2002) 的信息。 如果实验是探索性或发现性研究，并且结果将用于设计随访或确证性研究，则可能不需要调整多重性，因此使用 \\(t\\) 检验或基于 \\(LSD\\) 值的未调整置信区间。 使用 Dunnett’s procedure 比较一组处理和一个对照。Dunnett’s procedure 有双侧和单侧两种版本，因此可以选择一种版本来适应所考虑的情况。 对于成对比较，如果每个处理组的观察值数量相等，则使用 Tukey’s method. 如果数据不均衡，则使用模拟 (Westfall et al., 1999) 一个百分点的方法，考虑到观察值数量不等的模式。 如果线性组合的集合是线性无关的，那么多元 \\(t\\) 可以用来构造置信区间或检验假设。如果线性组合是无关的或正交的，那么多元 \\(t\\) 可以很好地工作。如果线性组合相关，则应使用包含相关结构的模拟方法，而不是使用多元 \\(t\\) 。每个处理组观察次数不等的大多数情况提供的是相关的线性组合，应使用模拟方法。 Bonferroni method 可用于构建联合置信区间或对选定数量的均值的线性组合进行检验，但如果感兴趣的组合数量很大（比如20个或更多），则 Scheffé procedure 通常会产生较短的置信区间，因此请进行检查。对于一组假设，可以有效地使用 Šidák (1967), Holm (1979), 或 Šidák–Holm 的方法。当线性组合无关时，这些边界是相当好的，但当线性组合相关时，所实现的 FWER 可能比期望的小得多。SAS®-MULTTEST 可用于对给定的一组比较进行 bootstrap 和模拟百分点，该组比较考虑了比较之间的相关性。 对于数据窥探或数据驱动的比较或假设，使用 Scheffé procedure，因为可以进行任意多的比较，并且仍然可以控制 EER 或 FWER. 对于涉及数千次比较的遗传研究等研究，请使用控制 FDR 的方法，如 Benjamini and Hochberg (1995) 提出的方法。 对于涉及与对照或安慰剂相比评估处理的安全性以确定可能的不良反应的研究，使用不校正多重检验或比较的方法。对于安全性研究，可能不需要进行多重性调整，因为发生II类错误比发生I类错误严重得多。 确定比较类型并指定所需的错误率控制水平后，选择满足这些条件的方法，该方法提供最小 \\(p\\) 值或最小临界差异或最短置信区间。 在下面的讨论中，我们将讨论每一种推荐的多重比较方法，以及第 1 章单向处理结构中其他几种常用的方法。每一种方法也可以用于更复杂的情况。本书剩余部分使用的参数 \\(v\\) 表示与 \\(\\sigma^2\\) 估计相对应的自由度。对于第 1 章的单向情况，误差自由度为 \\(v = N-t\\). 3.3 最小显著差异 LSD (least significant difference) 多重比较法可能比其他方法使用得更多，这可能是因为它是最容易应用的方法之一。它通常用于将每个处理均值与其他处理均值进行比较，但也可以用于其他比较。用于比较 \\(\\mu_i\\) 和 \\(\\mu_j\\) 的 \\(\\alpha100\\%\\)10显著性水平的 LSD 为 \\[\\begin{equation} \\mathrm{LSD}_\\alpha=t_{\\alpha/2,v}\\hat{\\sigma}\\sqrt{\\frac1{n_i}+\\frac1{n_j}} \\tag{3.1} \\end{equation}\\] 当 $|_i-j|&gt;$ 时，结论为 \\(\\mu_i\\ne \\mu_j\\). 此程序的比较错误率等于 \\(\\alpha\\). \\(\\mu_i–\\mu_j\\) 对应的 \\(100(1-\\alpha)\\%\\) 置信区间为 \\[\\begin{equation} \\hat{\\mu}_i-\\hat{\\mu}_j\\pm t_{\\alpha/2,v}\\hat\\sigma\\sqrt{\\frac1{n_i}+\\frac1{n_j}} \\tag{3.2} \\end{equation}\\] 如果所有样本量大小都相等（例如，等于 \\(n\\) ），那么单个 LSD 值可以用于所有成对比较。此时单个 \\(\\mathrm{LSD}_{\\alpha}\\) 值由下式给出 \\[\\begin{equation} \\mathrm{LSD}_\\alpha=t_{\\alpha/2,v}\\hat\\sigma\\sqrt{\\frac2n} \\tag{3.3} \\end{equation}\\] 假设一项研究包括 \\(t\\) 种处理均值，并且将在 \\(5\\%\\) 的显著性水平上进行所有可能的成对比较。表 3.1 显示了具有不同 \\(t\\) 值的实验的比较误差率和实验误差率。表中的信息适用于所有处理均值相等的情况。表 3.1 显示，在涉及 6 种治疗的实验中，35.8% 的时间会发现至少一个显著差异，即使所有的处理均值彼此相等。显然，如果没有一些额外的保护措施，使用 LSD 程序可能会非常危险。当存在多个感兴趣的测试或参数或参数的线性组合时，意味着存在多重性问题，应考虑一些调整以避免发现错误结果。Westfall et al. (1999) 对与多重性问题和/或多重比较问题相关的所有问题进行了极好的讨论。以下讨论试图描述那些在分析和解释设计实验结果时有用或已使用的程序。 表 3.1: LSD Procedure 的模拟错误率 x 3.4 Fisher’s LSD Procedure Fisher 的建议为上一节讨论的 LSD 程序提供了一些保护。在 Fisher’s procedure 中，LSD 检验是通过使用方程 (3.1) 在 \\(\\alpha100\\%\\) 显著性水平上进行的，但前提是 \\(H_0{:}\\,\\mu_1=\\mu_2=\\cdots=\\mu_t\\) 首先被第 @(chap1) 章中讨论的 \\(F\\) 检验在该水平上拒绝。 这比直接的 LSD procedure 有了相当大的改进，因为现在实验错误率大约等于 \\(\\alpha\\). 然而有可能拒绝 \\(H_0{:}\\,\\mu_1=\\mu_2=\\cdots=\\mu_t\\) 但不拒绝任何一个 \\(H_0{:}\\,\\mu_i=\\mu_j\\)，其中 \\(i\\ne j\\). 同样地，当差异确实存在时，该程序可能无法检测到处理对之间的某些差异。换句话说，少数处理对之间可能存在差异，但其余处理的相等可能导致 \\(F\\) 检验不显著，这个过程不允许实验者在没有首先获得显著 \\(F\\) 统计量的情况下进行单个比较。此程序的另一个问题是，许多实验包含已知在处理的某些子集中存在不等均值的处理。此时预期拒绝等均值假设，LSD 将用于进行所有成对比较。如果处理的子集具有等均值，则更多的成对比较将被检测为与预期显著不同。因此，FWER 不被维持。只有当完全零假设为真时，才能推荐 Fisher’s LSD. 不建议将这两种 LSD’s procedure 用于在 \\(\\mu_i\\) 的特定对比上构建联合置信区间，因为获得的置信区间通常太窄。 上述 LSD’s procedure 中的每一个都可以推广到处理均值的几个对比。此推广为：断定 \\(\\sum_{i=1}^{t}c_{i}\\mu_{i}\\neq0\\) 如果 \\[\\begin{equation} \\left|\\sum_{i=1}^tc_i\\hat{\\mu}_i\\right|&gt;t_{\\alpha/2,v}\\hat\\sigma\\sqrt{\\sum_{i=1}^tc_i^2/n_i} \\tag{3.4} \\end{equation}\\] 示例见 3.10, 3.12, 3.14 和 3.16 节。 3.5 Bonferroni’s Method 虽然这个程序可能是最少使用的，但它往往是最好的。当实验者想要进行少量比较时，它特别好。每当需要控制 FWER 时，推荐使用这个程序进行有计划的比较。假设实验者想做 \\(p\\) 个这样的比较。能得出结论 \\(\\sum_{i=1}^tc_{iq}\\mu_i\\neq0,q=1,2,\\ldots,p\\)，如果 \\[\\begin{equation} \\left|\\sum_{i=1}^tc_{iq}\\hat{\\mu}_i\\right|&gt;t_{\\alpha/2p,v}\\hat\\sigma\\sqrt{\\sum_{i=1}^t\\frac{c_{iq}^2}{n_i}} \\tag{3.5} \\end{equation}\\] 这 \\(p\\) 个检验的 FWER \\(\\le \\alpha\\) 以及比较误差率 \\(=\\alpha/p\\). 通常 FWER 比 \\(\\alpha\\) 小得多。不幸的是，无法确定小多少。附表 A.2 中给出了选定 \\(\\alpha,p,n\\) 的 \\(t_{\\alpha/2p,v}\\) 的值。例如，如果 \\(\\alpha = 0.05,p = 5,n = 24\\)，那么从表 A.2 可以得到 \\(t_{\\alpha/2p,v}=2.80\\). 3.10, 3.12, 3.14 和 3.16 节中的示例演示了 Bonferroni’s method 的使用。表中 \\(m\\) 与这里的 \\(p\\) 是等价的。 推荐使用从 Bonferroni’s method 获得的联合置信区间，其形式为 \\[\\begin{equation} \\sum_{i=1}^tc_{iq}\\hat{\\boldsymbol{\\mu}}_i\\pm t_{\\alpha/2p,v}\\hat{\\boldsymbol\\sigma}\\sqrt{\\sum_{i=1}^t\\frac{c_{iq}^2}{n_i}},\\quad q=1,2,\\ldots,p \\tag{3.6} \\end{equation}\\] Bonferroni’s method 可应用于模型参数的任何函数集，包括方差和均值。 3.6 Scheffé’s Procedure 当实验者想要进行大量”计划外”比较时，建议使用此程序。计划外比较是实验者在计划实验时没有想到进行的比较。这些问题经常出现，因为实验结果经常建议实验者进行某些比较。当有大量计划的比较时，也可以使用该程序，但置信区间的宽度通常比其他程序宽，尽管并不总是如此。给定常数向量 \\(\\boldsymbol c\\)，考虑检验 \\(H_0{:}\\,\\sum_{i=1}^tc_i\\mu_i=0\\)。我们有 \\[\\Pr\\left\\{\\frac{\\left(\\sum_{i=1}^tc_i\\hat{{\\mu}}_i-\\sum_{i=1}^tc_i{\\mu}_i\\right)^2}{\\sum_{i=1}^tc_i^2/n_i}\\leq(t-1)F_{\\Tiny{\\alpha,t-1,v}}\\hat{\\sigma}^2\\quad\\text{ for all contrast vectors }c\\right\\}=1-\\alpha \\] 因此对于所有可能的 \\(\\mu_i\\) 与 \\(0\\) 的对比，一个 FWER \\(=\\alpha\\) 的程序如下：拒绝 \\(H_0{:}\\,\\sum_{i=1}^tc_i\\mu_i=0\\) 如果 \\[\\begin{equation} \\left|\\sum_{i=1}^tc_i\\hat{\\mu}_i\\right|&gt;\\sqrt{(t-1)F_{\\alpha,t-1,v}}\\hat\\sigma\\sqrt{\\sum_{i=1}^tc_i^2/n_i} \\tag{3.7} \\end{equation}\\] Scheffé’s procedure 仍然可以使用，但此时 FWER 通常会原小于 \\(\\alpha\\). 对于有限数量的比较，Bonferroni’s method 或多元 \\(t\\) 方法（适当时）通常优于（置信区间更窄或更有效） Scheffé’s procedure. 即，使用Bonferroni’s method 或多元 \\(t\\) 方法相比Scheffé’s procedure，较小的 \\(\\sum_{i=1}^tc_i\\hat \\mu_i\\) 更有可能得出 \\(\\sum_{i=1}^tc_i\\mu_i\\) 与零显著不同的结论11。然而，如果要在数据中”乱翻”，看看是否有什么显著的东西出现，那么应该使用 Scheffé’s procedure，因为这种比较实际上是计划外的比较，而不是计划内的比较。需注意 Scheffé’s procedure 不会显示任何与零显著不同的对比，除非第 1 章讨论的 \\(F\\) 检验拒绝了 \\(H_0\\colon\\,\\mu_1=\\mu_2=\\cdots=\\mu_t\\). Scheffé’s procedure 也可用来获得 \\(\\mu_i\\) 的对比的同时置信区间。所需的结果是，对于任何一组对比 \\(c_1,c_2,\\dots,\\)，可有至少 \\((1-\\alpha)100\\%\\) 的把握认为 \\(\\sum_{i=1}^tc_{iq}\\mu_i\\) 包含在下式给出的区间内 \\[\\begin{equation} \\sum_{i=1}^tc_{iq}\\hat{\\mu}_i\\pm\\sqrt{(t-1)F_{\\alpha,t-1,v}}\\hat\\sigma\\sqrt{\\sum_{i=1}^tc_{iq}^2/n_i}\\quad\\text{ for all }q=1,2,\\ldots \\tag{3.8} \\end{equation}\\] 如果要考虑 \\(\\mu_i\\) 所有的线性组合，而不仅仅是所有对比，则式 (3.7) 和 (3.8) 中的 \\(√[(t-1)F_{\\alpha,t-1,v}]\\) 必须替换为 \\(√[tF_{\\alpha,t,v}]\\). 示例见 3.10, 3.12 和 3.14 节。 3.7 Tukey–Kramer Method 无论 \\(n_i\\) 的值如何，都可以使用前面的程序。Tukey’s honest significant difference (HSD) procedure (Tukey, 1952, 1953; Kramer, 1956) 用于在一组均值之间进行所有成对比较。然而该程序要求相等的 \\(n_i\\). Tukey (1953) 和 Kramer (1956) 为样本量不等的情况提供了修改。Hayter (1984) 给出了 Tukey–Kramer method 提供 FWER 保护的证据，尽管如果 \\(n_i\\) 相差不大12时可以使用近似程序。对于 \\(i\\ne i&#39;\\)，Tukey–Kramer method 将拒绝 \\(H_0{:\\mu_i}=\\mu_{i&#39;}\\)，如果 \\[\\begin{equation} \\left|\\hat{\\mu}_i-\\hat{\\mu}_{i^{\\prime}}\\right|&gt;q_{\\alpha,t,v}\\sqrt{\\frac{\\hat\\sigma^2}2{\\left(\\frac1{n_i}+\\frac1{n_{i^{\\prime}}}\\right)}} \\tag{3.9} \\end{equation}\\] 其中 \\(q_{\\alpha,t,v}\\) 为学生化极差统计量分布的上分位数。选定 \\(\\alpha,t,v\\) 的 \\(q_{\\alpha,t,v}\\) 值在附表 A.4 中。 如果样本量都等于 \\(n\\)，对于一个对比，拒绝 \\(H_0\\colon\\sum_{i=1}^tc_i\\mu_i=0\\)，如果 \\[\\left|\\sum_{i=1}^tc_i\\hat{\\mu}_i\\right|&gt;q_{\\alpha,t,v}\\frac\\hat\\sigma{\\sqrt{n}}{\\left(\\frac12\\sum_{i=1}^t|c_i|\\right)}\\] 3.8 模拟方法 对于不相等的样本量问题，对于比较不是成对比较的问题，以及对于比较不是线性独立的问题，上述方法提供的 FWER 显著性水平低于所需水平。在这种情况下，可以模拟适当的一组比较的分位数。 假设对 \\(\\mu_i\\) 的 \\(p\\) 个线性组合感兴趣，例如 \\(\\sum_{i=1}^{t}c_{iq}\\mu_{i},q=1,2,\\dots,p\\). 希望有程序要么控制假设集合 \\(H_{0}\\colon\\,\\sum_{i=1}^{t}c_{iq}\\mu_{i}=0,q=1,2,\\ldots,p\\) 的 FWER，要么控制联合置信区间的 \\(\\sum_{i=1}^tc_{iq}\\mu_i\\) FWER. 这个过程是： 以与手头数据集相同的结构生成一个数据样本。如果有五个样本量为5、9、3、6和7的处理，则使用这些样本量生成数据 对生成的数据集进行分析，如同对实际数据集所做的那样，并计算 \\(p\\) 个 \\(t\\) 统计量 \\[t_q=\\frac{\\sum_{i=1}^tc_{iq}\\hat{{\\mu}}_i}{\\sqrt{\\hat{\\sigma}^2\\sum_{i=1}^tc_{iq}^2/n_i}}\\quad q=1,2,\\ldots,p\\] 计算 \\(t_q\\) 绝对值的最大值 \\(T_{s}=\\max(|t_{1}|,|t_{2}|,\\ldots,|t_{p}|)\\). 大量重复步骤 1, 2 和 3，跟踪 \\(T_s\\) 的计算值。确定 \\(T_s\\) 分布的上 \\(\\alpha100\\) 分位数，并用 \\(T_\\alpha\\) 表示该百分位数。 对于实际数据集，计算 \\(t_q,q=1,2,\\dots,p\\)，如果\\(|tq| &gt;T,q=1,2,\\dots,p\\)$则拒绝第 \\(q\\) 个假设，或者构建联合置信区间为 \\[\\sum_{i=1}^tc_{iq}\\hat{{\\mu}}_i\\pm T_\\alpha\\sqrt{\\hat\\sigma^2\\sum_{i=1}^tc_{iq}^2/n_i},\\quad q=1,2,\\ldots,p\\] 可以使用 Edwards and Berry (1987) 的方法来指定模拟的准确性。SAS-MULTTEST 可用于使用 bootstrap 方法获得联合推断 (Westfall et al., 1999). Bootstrap 方法超出了本书的范围。 3.9 Šidák Procedure Šidák (1967) 对 Bonferroni’s method 进行了修改，对每个比较使用了不同的分位数。该过程是为每个比较计算一个 \\(t\\) 统计量 \\[t_q=\\frac{\\sum_{i=1}^tc_{iq}\\hat{{\\mu}}_i}{\\sqrt{\\hat{\\sigma}^2\\sum_{i=1}^tc_{iq}^2/n_i}},\\quad q=1,2,\\ldots,p\\] 计算每次比较的显著性水平，并将显著性水平从最小到最大排序为 \\(p_1,p_2,\\dots\\p_p\\). 对于 FWER \\(=\\alpha\\)，如果 \\(p_q\\le 1-(1-\\alpha)^{1/p}\\) 或等价地 \\(\\alpha\\ge 1-(1-p_q)^p\\)，则拒绝单个比较。 3.10 示例：成对比较 1.6 节中的任务数据用于阐述上述多重比较程序的结果。表 3.2 包含 SAS-Mixed 代码，用于拟合单向均值模型，LSMeans 语句用于提取几个多重比较程序。表 3.3 包含用于提供模拟、Tukey–Kramer、Bonferroni、Šidák、Scheffé 和 \\(t\\)（未调整）方法的置信度差异或显著性差异的分位数。除了未调整的 \\(t\\)，其他方法为所有成对比较提供 \\(0.05\\) 的 I类 FWER。模拟和 Tukey–Kramer 方法 使用最小的分位数，Šidák 和 Bonferroni 方法的分位数位于中间，而 Scheffé 方法的分位数最大。表 3.4 包含了每个成对比较的关键显著性差异。任务1与4，2与4，3与4，3与5、3与6、4与5和4与6观察到的差异，\\(t\\) 或 LSD 的临界差异，这控制了比较错误率，但未控制实验错误率。只有4与5 ，4与6的比较超过了其他五种方法的临界差异，所有这些方法都提供了实验错误率的保护，未调整的 \\(t\\) 或 LSD 方法的临界差异幅度最小。模拟方法与 Tukey-Kramer 方法临界差异大小相近，但模拟方法稍小；Šidák 方法与 Bonferroni 方法临界差大小相近，但 Šidák 值稍小。正如预期的那样，Scheffé 方法临界差异最大，因为它可以控制无限次比较的 FWER，而实际仅进行了15次成对比较。用差异估计加减临界差的方法可以得到所有两两比较的联合 \\(95\\%\\) 置信区间，如 _1-_2$ 的联合 \\(95\\%\\) 置信区间为 \\(0.840 \\pm 6.526\\). 表 3.5 包含每种方法的调整的 \\(p\\) 值。\\(p\\) 值提供了与表 3.4 中 \\(5\\%\\) 差异相同的决定. 表 3.2: 使用 Proc Mixed 计算多个多重比较程序的所有成对比较 x PROC mixed DATA=EX1; CLASS TASK; MODEL PULSE20=TASK/NOINT SOLUTION; LSMEANS TASK/ DIFF CL; LSMEANS TASK/ DIFF ADJUST=TUKEY CL; LSMEANS TASK/ DIFF ADJUST=BON CL; LSMEANS TASK/ DIFF ADJUST=SCHEFFE CL; LSMEANS TASK/ DIFF ADJUST=SIDAK CL; LSMEANS TASK/ DIFF ADJUST=SIMULATE (REPORT SEED=4938371) CL; 表 3.3: 用于六个任务均值的所有成对比较的分位数 x 表 3.4: 用于比较未调整的 \\(t\\) 检验和几种多重比较程序的均值对之间差异的临界差异 x 表 3.5: 调整显著性水平以检验从六个程序中获得的 TASK 减去 _TASK 的所有成对比较的相等性，其中 \\(t\\) 对应未调整的 \\(t\\) x 3.11 Dunnett’s Procedure 一个非常有趣的例子是将所有处理与对照进行比较。这种类型的推断在安全性研究中很重要，届时将不同剂量的处理与对照或安慰剂进行比较是很有意义的。Dunnett’s test 声明处理均值 \\(\\mu_i\\) 与对照均值 \\(\\m_0\\) 存在显著差异，如果 \\[|\\hat{\\mu}_i-\\hat{\\mu}_0|&gt;d_{\\alpha,t,v}\\sqrt{\\hat\\sigma^2{\\left(\\frac1{n_i}+\\frac1{n_0}\\right)}}\\] 其中 \\(d_{\\alpha,t,v}\\) 是”多对一 \\(t\\) 统计量” (“many-to-one t-statistic”)(Miller, 1967) 的上 \\(\\alpha100\\) 分位数。Dunnett’s method 控制 FWER。如果样本大小不等，模拟程序可以考虑样本大小结构，并可能提供更短的界限。 3.12 示例：与对照比较 1.6 节中的任务数据用于演示将每个处理与对照进行比较的过程。在本研究中，假设任务2为对照任务，其他五个任务为实验任务。表 3.6 包含 SAS-Mixed 代码，使用未调整的 \\(t\\)、Bonferroni、Dunnett、Scheffé、Šidák 和 模拟方法将所有其他任务与任务2进行比较。LSMean 语句 DIFF=CONTROL('2') 选项请求将任务2视为对照，并与研究中的其他每个任务进行比较。表 3.7 包含每种方法的 \\(95\\%\\) 分位数。Dunnett 分位数小于其他分位数（除了未调整的 \\(t\\)），模拟方法与之非常接近。目前正在进行五次比较，这决定了 Bonferroni 和 Šidák 分位数的大小。Scheffé 分位数与表 3.4 中的相同，这对于无限数量的比较非常有用。观察到的差异超过临界差异的唯一比较是将任务4与对照(任务2)进行比较。将差异估计加减表 3.8 中的临界差异，可以构建一组关于处理和对照均值之间所有差异的联合置信区间。例如，使用模拟方法，\\(\\mu_1-\\mu_2\\) 的联合 \\(95\\%\\) 置信区间为 \\(0.840 \\pm 5.765\\). 表 3.9 中列出了每种方法的调整的 \\(p\\) 值。 表 3.6: 使用 Proc Mixed 计算多个多重比较程序的所有成对比较 x PROC mixed DATA=EX1; CLASS TASK; MODEL PULSE20=TASK/NOINT; LSMEANS TASK/ DIFF=CONTROL(‘2’) CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=BON CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=DUNNETT CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=SIDAK CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=SIMULATE (REPORT SEED=4938371) CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=scheffe CL; 表 3.7: 用于比较每个任务均值与任务2（对照）均值的分位数 x 表 3.8: 未调整的 \\(t\\) 检验和五个多重比较程序中各处理组与对照组比较的临界差异 x 表 3.9: 调整显著性水平以检验 \\(H_0:\\,\\mu_i = \\mu_2\\)，从六个程序中获得，其中任务2为对照，\\(t\\) 对应于未调整的 \\(t\\) x 3.13 多元 \\(t\\) 当实验者想要考虑 \\(\\mu_i\\) 线性组合的线性无关集合时，多元 \\(t\\) 方法是一种很好的方法。重要的是，该程序不能用于线性相关的线性组合集合。这种限制阻止了使用这种方法在一组处理均值之间进行所有可能的成对比较，因为均值之间所有可能的比较的集合不是线性独立的集合。关于线性相关线性组合的讨论在本节末尾给出。如果实验者想进行 \\(p\\) 个线性独立的比较，结论为第 \\(q\\) 个比较 \\(\\sum_{i=1}^tc_{iq}\\mu_i\\neq0\\) 如果 \\[\\begin{equation} \\left|\\sum_{i=1}^tc_{iq}\\hat{\\mu}_i\\right|&gt;t_{\\alpha/2,p,v}\\hat\\sigma\\sqrt{\\sum_{i=1}^t\\frac{c_{iq}^2}{n_i}} \\tag{3.10} \\end{equation}\\] 其中 \\(t_{\\alpha/2,p,v}\\) 是自由度为 \\(v\\) 且相关矩阵为 \\(\\boldsymbol I_{p}\\) 的 \\(p\\) 元 \\(t\\) 分布的上 \\(\\alpha/2\\) 分位数。选定 \\(\\alpha,p,v\\) 的 \\(t_{\\alpha/2,p,v}\\) 的值在附表 A.3 中给出。基于多元 \\(t\\) 方法的联合置信区间是合适的，并且可以推荐表 A.3 中 \\(m=p\\) 的情况。 多元 \\(t\\) 方法的 FWER \\(\\le\\alpha\\)。如果线性组合 \\(\\sum_{i=1}^tc_{iq}\\hat\\mu_i\\) 在统计上独立或不相关，则 FWER 恰好 \\(=\\alpha\\)。对于一组特定的线性独立比较，多元 \\(t\\) 方法通常会给出最佳结果。如果实验者感兴趣的一组比较是线性独立的，那么多元 \\(t\\) 方法总是比 Bonferroni method 更好，也就是说，得到的置信区间会更窄。 以下结果使我们能够将多元 \\(t\\) 程序的应用扩展到一组线性相关的比较（然而，所得到的检验或置信区间并不完全令人满意）：设 \\(l_1,l_2,\\dots,l_p\\) 是 \\(\\mu_i\\) 的线性组合的线性独立集。如果 \\(|lq|\\le cq\\)，则 \\[\\left|\\sum_{i=1}^p\\lambda_ql_q\\right|\\leq\\sum_{i=1}^p\\left|\\lambda_q\\right|c_q\\] 要利用此结果，请使用以下步骤： 令 \\(l_1,l_2,\\dots,l_p\\) 是 \\(\\mu_i\\) 的线性组合的线性独立集。这个集合被表示为实验者主要感兴趣的线性组合。对于这组比较，得出结论 \\(l_q=\\sum_{i=1}^tc_{iq}\\mu_i\\) 与零显著不同，如果 \\[\\begin{equation} \\left|\\hat{l}_q\\right|&gt;t_{\\alpha/2,p,v}\\hat\\sigma\\sqrt{\\sum_{i=1}^tc_{iq}^2/n_i} \\tag{3.11} \\end{equation}\\] 令 \\(l^*\\) 是任何具有次要重要性的比较，即 \\(l_q,q=1,2,\\dots,p\\) 的线性组合。也就是说，对于 \\(\\lambda_q\\) 的某个集合，\\(l^*=\\sum_{q=1}^p\\1ambda_ql_q\\)。称 \\(l^*\\) 与零显著不同，如果 \\[\\begin{equation} \\left|\\hat{l}^*\\right|&gt;t_{\\alpha/2,p,\\nu}\\hat{\\boldsymbol\\sigma}\\sum_{q=1}^p\\left(\\left|\\lambda_q\\right|\\sqrt{\\sum_{i=1}^tc_{iq}^2/n_i}\\right) \\tag{3.12} \\end{equation}\\] 实验者可以在不增加 FWER 的情况下根据需要进行尽可能多的 \\(l^*\\) 比较。多元 \\(t\\) 方法的这种扩展对那些具有首要重要性的比较给出了非常有效的检验，但对那些具有次要重要性的比较则不那么有效。如 3.16 节中的示例所示。 3.14 示例：线性独立比较 表 3.10 包含 SAS-Mixed 代码，用于提供任务均值的五个线性独立对比的估计、标准误和置信区间宽度。五个对比是： \\[\\begin{aligned} &amp;\\mu_1-\\frac12(\\mu_2+\\mu_3),\\,\\frac13(\\mu_1+\\mu_2+\\mu_3)-\\frac13(\\mu_4+\\mu_5+\\mu_6) \\\\ &amp;\\mu_6-\\frac12(\\mu_4+\\mu_5),\\,\\frac12(\\mu_1+\\mu_6)-\\frac12(\\mu_4+\\mu_5) \\\\ &amp;\\frac12(\\mu_1+\\mu_6)-\\frac14(\\mu_2+\\mu_3+\\mu_4+\\mu_5) \\end{aligned}\\] 表 3.10: 使用 Proc Mixed 计算多个多重比较程序的所有成对比较 x PROC mixed DATA=EX1; CLASS TASK; MODEL PULSE20=TASK/NOINT; LSMEANS TASK/ DIFF=CONTROL(‘2’) CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=BON CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=DUNNETT CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=SIDAK CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=SIMULATE (REPORT SEED=4938371) CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=scheffe CL; 表 3.11: 未调整的 \\(t\\) 和三种调整方法的置信区间宽度 x 表 3.11 包含使用多元 \\(t\\)、Bonferroni \\(t\\) 和 Scheffé 方法计算每个五个对比的置信区间宽度的结果。还提供了未调整的 \\(t\\)。置信区间的宽度由 2×Q×(stderr) 计算，其中 Q 表示相应程序的分位数。分位数如下：对于未调整的 \\(t\\)，\\(Q=t_{0.025,62}=1.999\\)，对于多元 \\(t\\)，\\(Q=t_{0.025,5,60=2.649\\)（表中使用了60个自由度，而不是62个自由度），对于 Bonferroni \\(t\\)，\\(Q＝t_{0.025,15,62}=2.657\\)，对于 Scheffé，\\(Q＝√(5F_{0.05,5,62}=3.437\\)。多元 \\(t\\) 的置信区间的宽度短于 Bonferroni 或 Scheffé 置信区间给出的宽度。Bonferroni \\(t\\) 置信区间仅比多元 \\(t\\)的置信区间略宽。随着比较次数的增加，Bonferronit 置信区间的宽度也会增加。如果比较次数 \\(\\le47\\) 次或更少，则 Bonferroni 置信区间比 Scheffé 方法的置信区间更短。对于 \\(&gt;47\\) 次的比较，Scheffé 置信区间比 Bonferroni 区间短。 3.15 序贯拒绝方法 前面的方法被称为单步方法，因为只需要一步就可以确定所有检验的合适临界值。每个单独的检验或置信水平都是在不参考其他检验或置信水平的情况下进行评估的。在逐步或序贯 (sequantial) 方法中，给定检验的结果取决于先前检验的结果 (Westfall et al., 1999). 这些方法可用于假设检验集。设有 \\(p\\) 个感兴趣的假设，\\(H_{0q}\\colon\\sum_{i=1}^{t}c_{iq}\\mu_{i}=0\\,\\mathrm{~vs.~}\\,H_{0q}\\colon\\sum_{i=1}^{t}c_{aq}\\mu_{i}\\neq0,q=1,2,\\ldots,p\\). 计算 \\(p\\) 个 \\(t\\) 统计量 \\[t_{q}=\\frac{\\sum_{i=1}^{t}c_{iq}\\hat{\\mu}_{i}}{\\sqrt{\\hat\\sigma^{2}\\sum_{i=1}^{t}c_{iq}^{2}/n_{i}}},\\quad q=1,2,\\ldots,p\\] 设 \\(p_1,p_2,\\dots,p_p\\) 表示观察到的显著性水平。接下来，将 \\(p_q\\) 从小到大排序为 \\(p_{(1)}\\le p_{(2)}\\le\\cdots p_{(p)}\\). 3.15.1 Bonferroni–Holm Method Bonferroni-Holm 方法从第一次检验的 Bonferroni 调整开始，但增加了后续检验的显著性水平 (Holm, 1979). 如果 \\(p_{(1)}&gt;\\alpha/p\\)，则无法拒绝所有假设。若 \\(p_{(1)}&lt;\\alpha/p\\)，则拒绝 \\(p_{(1)}\\) 对应的假设并将 \\(p_{(2)}\\) 与 \\(\\alpha/(p-1)\\) 比较。若 \\(p_{(2)}&gt;\\alpha/(p-1)\\)，则无法拒绝所有剩余假设。若 \\(p_{(2)}&lt;\\alpha/(p-1)\\)，则拒绝 \\(p_{(2)}\\) 对应的假设并将 \\(p_{(3)}\\) 与 \\(\\alpha/(p-2)\\) 比较。继续这个过程直到对于某个 \\(q\\)，\\(p_{(q)}&gt;\\alpha/(p-q+1)\\)，此时无法拒绝 \\(p_{(q)}\\) 对应的假设以及所有剩余假设。该方法控制 FWER，并且比 Bonferroni method 更强大，因为除了第一个比较外，有序的 \\(p\\) 值与更大的值进行比较。 3.15.2 Šidák–Holm Method Bonferroni–Holm method 中使用的 Holm 修正可以与 Šidák 方法一起使用，其中调整的 \\(p\\) 值为 \\[\\begin{aligned} \\tilde{p}_{(1)}&amp; =1-(1-p_{(1)})^k \\\\ \\tilde{p}_{(2)}&amp; =\\min[\\tilde{p}_{(1)},1-(1-p_{(2)})^{k-1}] \\\\ \\tilde{p}_{(j)}&amp; =\\min[\\tilde{p}_{(j-1)},1-(1-p_{(j)})^{k-j+1}] \\\\ \\tilde{p}_{(k)}&amp; =\\min(\\tilde{p}_{(k-1)},p_{(k)}) \\end{aligned}\\] 当比较是独立的以及涉及相关比较的大多数情况下，该方法提供了对 FWER 的控制 (Holland and Copenhaver, 1987). 3.15.3 控制 FDR 的 Benjamini 和 Hochberg Method 设感兴趣于 \\(p\\) 个比较 \\(\\sum_{i=1}^{t}c_{iq}\\mu_{i},q=1,2,\\ldots,p\\). 计算 \\(p\\) 个 \\(t\\) 统计量 \\[t_q=\\frac{\\sum_{i=1}^tc_{iq}\\hat{\\mu}_i}{\\sqrt{\\hat{\\sigma}^2\\sum_{i=1}^tc_{iq}^2/n_i}},\\quad q=1,2,\\ldots,p\\] 并令 \\(p_1,p_2,\\dots,p_p\\) 表示观察到的显著性水平。接下来，将 \\(p_q\\) 从小到大排序为 \\(p_{(1)}\\le p_{(2)}\\le\\cdots p_{(p)}\\). 控制 FDR（但不控制 FWER）的调整的 \\(p\\) 值为 \\[\\begin{aligned} \\tilde{p}_{(k)}&amp; =p_{(k)} \\\\ \\tilde{p}_{(k-1)}&amp; =\\min\\{\\tilde{p}_{(k)},[k/(k-1)]p_{(k-1)}\\} \\\\ \\tilde{p}_{(k-j)}&amp; =\\min\\{\\tilde{p}_{(k-j+1)},[k/(k-j)]p_{(k-j)}\\} \\\\ \\tilde{p}_{(1)}&amp; =\\min(\\tilde{p}_{(2)},kp_{(1)}) \\end{aligned}\\] 3.16 示例：线性相关比较 选择了八个线性相关的比较，并使用未调整的 \\(t\\)、Bonferroni \\(t\\)、Bonferroni–Holm、Šidák、Šdák–Holm 和 Benjamini–Hochberg 方法来计算调整的显著性水平。这八个比较是： \\[\\begin{aligned} &amp;\\mu_1-\\mu_2,\\mu_1-\\frac12(\\mu_2+\\mu_3),\\mu_1-\\mu_3 \\\\ &amp;\\frac13(\\mu_1+\\mu_2+\\mu_3)-\\frac13(\\mu_4+\\mu_5+\\mu_6),\\mu_4-\\mu_5 \\\\ &amp;\\mu_6-\\frac12(\\mu_4+\\mu_5),\\frac12(\\mu_1+\\mu_6)-\\frac12(\\mu_4+\\mu_5) \\\\ &amp;\\frac12(\\mu_1+\\mu_6)-\\frac14\\left(\\mu_2+\\mu_3+\\mu_4+\\mu_5\\right) \\end{aligned}\\] 表 3.12 包含 SAS-MULTTEST 代码，用于提供这些比较的调整的 \\(p\\) 值。调整的 \\(p\\) 值如表 3.13 所示。标记为 “Raw” 的列包含了未调整的 \\(p\\) 值。“Bonferroni” 列包含 Bonferronis 调整的 \\(p\\) 值。“Stepdown Bonferroni” 列包含 Bonferroni-Holm 调整的 \\(p\\) 值。“Šidák” 列包含 Šidàk 调整的 \\(p\\) 值。“StepdownŠidák”列包含 Šidèk–Holm 调整的 \\(p\\) 值。“False Discovery Rate” 列包括 Benjamini–Hochberg 调整的 \\(p\\) 值。Šidák 调整的 \\(p\\) 值通常小于 Bonferroni \\(t\\) 的 \\(p\\) 值。Stepdown Šidèk 调整的 \\(p\\) 值一般小于 stepdown Bonferronis的 \\(p\\) 值，并且小于 Šidàk 调整前的 \\(p\\) 值。Bonferroni、stepdown Bonferroni、Šidák 和 stepdown Shidák 方法提供的值大于错误发现率方法的值。错误发现率通常会在进行大量检验且对控制 FWER 不感兴趣时使用。 表 3.12: 用 Proc MULTTEST 代码同时获得八个对比的检验信息 x 表 3.13: 八个对比的原始和调整的 \\(p\\) 值 x 为了说明多元 \\(t\\) 的推广在相关比较中的应用，我们将计算关于 \\(\\mu_1 -1/2(\\mu_2 + \\mu_3)\\) 的置信区间，假定线性无关集或主要集包含 \\(\\mu_1 - \\mu_2\\) 和 \\(\\mu_1 - \\mu_3\\). 此时 \\(\\mu_1 -1/2(\\mu_2 + \\mu_3)=1/2(\\mu_1-\\mu_2)+1/2(\\mu_1-\\mu_3)\\)，而根据 3.13 节中的结果，\\(l^*=\\mu_1-1/2(\\mu_2+\\mu_3)=1/2(\\mu_1-\\mu_2)+1/2(\\mu_1-\\mu_3)\\)，且 \\(\\lambda_1=\\lambda_2=1/2\\). 用于评估 \\(l^*\\) 的临界值（根据式 (3.12)）为 \\[\\begin{aligned} t_{\\alpha/2,p,v}\\hat{\\sigma}\\sum_{q=1}^{p}\\left(\\left|\\lambda_{q}\\right|\\sqrt{\\sum_{i=1}^{t}c_{iq}^{2}/n_{i}}\\right)&amp; =(2.649)(5.559){\\left(\\left|\\frac12\\right|\\sqrt{\\frac1{13}+\\frac1{12}}+\\left|\\frac12\\right|\\sqrt{\\frac1{13}+\\frac1{10}}\\right)} \\\\ &amp;=\\frac12(5.895)+\\frac12(6.194) \\\\ &amp;\\text{=6.044} \\end{aligned}\\] 将该结果乘以 \\(2\\)，得到置信区间的宽度为 \\(12.088\\). 多元 \\(t\\)、Bonferroni \\(t\\) 和 Scheffé 方法的置信区间宽度分别为 \\(10.319,10.352\\)和 \\(13.390\\)。线性独立比较的集合称为主比较 (primary comparisonns)，主比较集合中的比较的线性函数称为次比较 (secondary comparisons). 使用式 (3.12) 为次比较提供临界差异，得到的值比作为主比较获得的值大得多，但此时宽度仍然比 Scheffé 方法提供的宽度短。因此，当使用多元 \\(t\\) 方法时，次比较远不如除 Scheffé 方法外的任何其他方法灵敏。 3.17 多重极差检验 Duncan 和 Student–Newman–Keul 的多重极差检验 (multiple range tests) 不能控制 FWER，因此不予以推荐。见 Westfall et al. (1999, p. 154) 的讨论。由于这些程序已被许多领域的研究人员广泛使用，下面将对其进行描述。 3.17.1 Student–Newman–Keul’s Method 这个方法要求 \\(n_i\\) 彼此相等；然而，只要样本量相差不大[^nottoounnequl]，就可以获得良好的近似值。此时，下列公式中的变量 \\(n\\) 被 \\(n_i\\) 的调和平均值 (harmonic mean) 所代替。调和平均值由下式给出 \\[\\tilde{n}=t\\Bigg(\\frac{1}{n_{1}}+\\frac{1}{n_{2}}+\\cdots+\\frac{1}{n_{t}}\\Bigg)^{-1}\\] 该程序在所有均值相等假设下控制 EERC，但如果某些均值相等，而某些均值不相等，则无法控制 EERC. 要应用此方法，请将 \\(t\\) 个均值按升序排列为 \\(\\bar{y}_{(1)}\\leq\\bar{y}_{(2)}\\leq\\cdots\\leq\\bar{y}_{(t)}\\). 接下来，\\(t\\) 个均值的学生化极差 (Studentized range) 为 \\[\\frac{\\overline{y}_{(t)}-\\overline{y}_{(1)}}{\\hat\\sigma/\\sqrt{n}}\\] 并将其与临界值 \\(q_{\\alpha,t,v}\\) 比较，如果 \\[\\overline{y}_{(t)}-\\overline{y}_{(1)}\\leq\\frac\\hat\\sigma{\\sqrt{n}}q_{\\alpha,t,v}\\] 则得出结论，\\(t\\) 个处理均值之间没有显著差异，也不考虑进一步的检验。如果 \\[\\overline{y}_{(t)}-\\overline{y}_{(1)}&gt;\\frac\\hat\\sigma{\\sqrt{n}}q_{\\alpha,t,v}\\] 则得出结论，\\(\\mu_{(t)}&gt;\\mu_{(1)}\\) 或，这 \\(t\\) 个均值存在显著的极差。接下来，对两个均值子集 \\(\\{\\bar{y}_{(t)},\\bar{y}_{(t-1)},\\ldots,\\bar{y}_{(2)}\\}\\) 和 \\(\\{\\bar{y}_{(t-1)},\\bar{y}_{(t-2)},\\ldots,\\bar{y}_{(1)}\\}\\) 进行比较。将每个子集的极差与 \\([\\hat\\sigma/√(n)]q_{\\alpha,t-1,v}\\) 比较，如果 \\[\\bar{y}_{(t)}-\\bar{y}_{(2)}\\leq\\frac\\hat\\sigma{\\sqrt{n}}q_{\\alpha,t-1,v}\\] 则得出结论，在子集 \\(\\{\\mu_{(t)},\\mu_{(t-1)},\\ldots,\\mu_{(2)}\\}\\) 中，处理均值之间没有显著13差异。类似地，如果 \\[\\bar{y}_{(t-1)}-\\bar{y}_{(1)}\\leq\\frac\\hat\\sigma{\\sqrt{n}}q_{\\alpha,t-1,v}\\] 则得出结论，在子集 \\(\\{\\mu_{(t-1)},\\mu_{(t-2)},\\ldots,\\mu_{(1)}\\}\\) 中，处理均值之间没有显著14差异。如果以上两个结论都成立，那么我们停止在均值之间进行比较的程序，并得出结论，两个均值子集中的均值没有显著差异。 如果 \\[\\bar{y}_{(t)}-\\bar{y}_{(2)}&gt;\\frac\\hat\\sigma{\\sqrt{n}}q_{\\alpha,t-1,v}\\] 则得出结论 \\(\\mu_{(t)}&gt;\\mu_{(2)}\\). 如果 \\[\\bar{y}_{(t-1)}-\\bar{y}_{(1)}&gt;\\frac\\hat\\sigma{\\sqrt{n}}q_{\\alpha,t-1,v}\\] 则得出结论 \\(\\mu_{(t-1)}&gt;\\mu_{(1)}\\). 如果这两个结论中的任何一个成立，那么我们将在发现显著差异的子集内进行额外的比较。例如，如果前面的两个集合都包含显著差异，那么可以考虑子集 \\(\\{\\bar{y}_{(t)},\\bar{y}_{(t-1)},\\ldots,\\bar{y}_{(3)}\\},\\{\\bar{y}_{(t-1)},\\bar{y}_{(t-2)},\\ldots,\\bar{y}_{(2)}\\}\\) 和 \\(\\{\\bar{y}_{(t-2)},\\bar{y}_{(t-2)},\\ldots,\\bar{y}_{(1)}\\}\\). 将每个子集的极差与 \\([\\hat\\sigma/√(n)]q_{\\alpha,t-2,v}\\) 进行比较。只要前一个子集具有显著的极差，则继续检查较小的均值子集。 每次得到不显著的极差时，将所涉及的均值包括在单个组中。被分在非显著组中的均值子集以后不能被视为显著；也就是说，不应对先前分组到共同子组中的均值进行进一步检验。当所有极差检验不显著时，程序结束。被分在在同一组中的任何两个均值没有显著差异；否则，它们有显著差异。 使用 1.6 节中的任务数据示例对该方法进行说明，取 \\(\\alpha=0.05\\). 由于样本大小不等，样本大小的调和平均值为 \\(11.23\\). 首先按升序排列均值： Task 6 5 2 1 3 4 Mean 28.818 29.500 31.083 31.923 35.800 38.000 Rank 1 2 3 4 5 6 第一步是对六个均值的极差进行比较，将 \\(38.000-28.818=9.182\\) 与 \\[q_{0.05,6,62}\\frac\\hat\\sigma{\\sqrt{\\tilde{n}}}=(4.16)\\sqrt{\\frac{30.9045}{11.23}}=6.900\\] 比较。由于 \\(9.819&gt;6.90\\)，需调查两个含有 \\(t-1=5\\) 个均值的子集。此时，将 \\(35.800-28.818=6.982\\) 和 \\(38.000-29.500=8.500\\) 与 \\[q_{0.05,5,62}\\frac\\hat\\sigma{\\sqrt{\\tilde{n}}}=(3.98)\\sqrt{\\frac{30.9045}{11.23}}=6.593\\] 比较。由于 \\(7.619&gt;6.60,8.5&gt;6.60\\)，接着调查含有 \\(t-2=3\\) 个均值的子集，有三个这样的子集。此时，将 \\(31.923 - 28.818 = 3.105,35.800 - 29.500 = 6.300,38.0 - 31.083 = 6.917\\) 与 \\[q_{0.05,4,62}\\frac\\hat\\sigma{\\sqrt{\\tilde{n}}}=(3.74)\\sqrt{\\frac{30.9045}{11.23}}=6.195\\] 比较。由于 \\(3.105&lt;6.195\\)，前四个均值被分为一组。由于 \\(6.300&gt;6.195,6.917&gt;6.195\\)，剩下的四个均值组都必须进一步细分为三个均值的组。在进行下一步之前，请考虑以下示意图，说明了当前的情况，其中直线表示前四个均值为一组，并且被认为没有差异。 四个均值的第一个子集 {29.500, 31.083, 31.923, 35.800} 包含已组合在一起的两组三个均值，即 \\(29.500–31.923\\) 和 \\(28.818–31.083\\). 因此，极差 \\(31.923 - 29.500 = 2.423\\) 和 \\(31.083 - 28.818 = 2.265\\) 不与临界点进行比较。仍需比较的极差是 \\(35.800 - 31.083 = 4.717\\) 和 \\(38.0 - 31.923 = 6.077\\)；这些必须与 \\[q_{0.05,3,62}\\mathrm{~}\\frac\\hat\\sigma{\\sqrt{\\tilde{n}}}=(3.40)\\sqrt{\\frac{30.9045}{11.23}}=5.635\\] 比较。由于 \\(4.717 &lt; 5.635\\)，这三个均值现在被为一个组，而由于 \\(6.077 &gt; 5.635\\)，第二组必须进一步细分为每组两个均值的组。下图说明了当前情况： 只有一个大小为 2 的子集 {35.8, 38.0} 尚未合并到一个公共组中。将极差 \\(38.0 - 35.8 = 2.2\\) 与 \\[q_{0.05,2,62}\\frac\\hat\\sigma{\\sqrt{\\tilde{n}}}=(2.83)\\sqrt{\\frac{30.9045}{11.23}}=4.691\\] 比较。由于 \\(2.2&lt;4.69\\)，最后这两个均值被分到一组。最终的示意图为： 说明此信息的另一种方法是，如果它们出现在同一组中，则用相同的字母标记均值；如果它们出现在不同的组中，则用不同的字母标记均值。因此，任务数据均值的比较可以表示为 Task Mean 1 31.923 bc 2 31.083 bc 3 35.800 ab 4 38.000 a 5 29.500 c 6 28.818 c 3.17.2 Duncan’s New Multiple Range Method 目前，这种方法通常被称为 Duncan’s method。它是更流行的方法之一，部分原因是使用该方法通常比任何其他方法更容易找到显著差异，除了 Fisher’s LSD method。但是，虽然 Duncan’s method 控制了比较错误率，但它无法控制 FWER。此过程也需要相等的 \\(n_i\\) ，并且与上一节一样，如果对于近似过程而言样本大小不太不平等，则以下公式中的变量 \\(n\\) 可以替换为 \\(\\tilde n\\). 此过程的应用类似于 Student-Newman-Keul method 的应用，不同之处在于用于比较一组 \\(p\\) 个均值的学生化极差临界点 \\(q_{\\alpha,p,v}\\) 替换为 \\(q_{\\alpha_p,p,v}\\)，其中 \\(\\alpha_p=1-(1-\\alpha)^{p-1}\\). \\(q_{\\alpha_p,p,v}\\) 的值在附表 A.5 中给出。对于上一节中的数据，此程序应用如下： 将 \\(38.000 - 28.818 = 9.182\\) 与 \\[q_{\\alpha_{6},6,62}\\frac\\hat\\sigma{\\sqrt{\\tilde{n}}}=(3.198)\\sqrt{\\frac{30.9045}{11.23}}=5.303\\] 比较，其中 \\(\\alpha_6=1-(1-0.05)^{6-1}=0.226\\). 六个均值的极差是显著的。 将 \\(35.800 - 28.818 = 6.982\\) 和 \\(38.000 - 29.500 = 8.500(3.143)(1.659) = 5.213\\) 与 \\[q_{\\alpha_5,5,62}\\frac\\hat\\sigma{\\sqrt{\\tilde{n}}}=(3.143)\\sqrt{\\frac{30.9045}{11.23}}=5.214\\] 比较，其中 \\(\\alpha_5=1-(1-0.05)^{5-1}=0.186\\). 两个极差都是显著的。 将 \\(31.923 - 28.818 = 3.105\\)，\\(35.800 - 29.500 = 6.300\\) 和 \\(38.000 - 31.083 = 6.917\\) 与 \\((3.073)(1.659) = 5.098\\) 比较。后两个极差显著，而第一个极差不显著。此时的分组为 将 \\(35.800 - 31.083 = 4.717\\)，\\(38.000 - 31.923 = 6.077\\) 与 \\((2.976)(1.659) = 4.937\\) 比较。第二个极差显著，而第一个极差不显著。现在的分组情况为： 将 \\(38.000 - 35.800 = 2.200\\) 与 \\((2.829)(1.659) = 4.693\\) 进行比较。该极差不咸猪手。最终的示意图为： 这个例子中 Student-Newman-Keul’s method 和 Duncan’s method 得出相同的图；然而，它们通常不会如此，因为他们使用学生化极差的不同分位数。Duncan’s method 使用较小的值来比较均值极差，这就是它无法控制 FWER 的原因。 3.18 Waller–Duncan Procedure 此程序不适用于大多数混乱数据的情况，因为它也需要相等的 \\(n_i\\)，但当它们不相等时，使用样本量的调和平均值来实现。包含此程序有几个原因，但主要是因为该程序不为人所知，并且因为它似乎具有一些理想的性质，Waller-Duncan procedure 使用样本数据来帮助确定是否需要保守规则（如 Tukey-Kramer）或非保守规则（如 Fisher’s LSD）来进行处理均值之间的成对比较。该程序利用 \\(F\\) 检验的计算值来检验 \\(H_{0}\\colon\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\). 如果 \\(F\\) 值很小，则样本数据往往表明均值是同质的。此时 Waller-Duncan procedure 需要样本均值的绝对差很大才能宣称显著性，从而防止太多的显著性差异。如果 \\(F\\) 值很大，则样本数据往往表明均值是不同质的。此时该程序要求样本平均值的绝对差较小来给出显著性，从而防止太少的显著性差异。Waller-Duncan procedure 要求选择一个称为错误率比 (error rate ratio) 的常数 \\(K\\)，该常数表示 I 类错误相对于 II 类错误的严重性。\\(K\\) 和 I 类错误概率之间的关系大致如下： \\(\\alpha\\) \\(K\\) 0.10 50 0.05 100 0.01 500 因此该程序的临界点取决于 \\(K,n,t\\) 和检验 \\(H_{0}\\colon\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\) 的 \\(F\\) 统计量的计算值。此处未包含表格；它们在 Ott (1988) 中给出。为了使用该程序，我们计算一个 Waller–Duncan LSD，并将所有均值对与此单个 LSD 值进行比较，就像使用 Fisher’s LSD procedure 或 Tukey–Kramer HSD procedure 对待等样本量问题一样。当用户在 SAS-GLM 中请求 Means/Waller 选项时，会计算 Waller–Duncan LSD 值，并将均值分组为类似于上两节给出的图表中。 3.19 示例：成对比较的多重极差 Duncan、Student–Newman–Keul 和 Waller–Duncan 方法可以使用 SAS-GLM 的 Means 语句来完成。表 3.14 包含为任务数据集拟合单向模型的 GLM 代码，并包含 Means 语句，以提供比较六个任务均值的三种方法。表 3.15 包含 Duncan’s 多重比较法的结果。计算并呈现临界极差值，以使人们能够查看一系列均值并确定它们是否不同。例如，当该组涉及四个均值时，将该极差与 \\(5.096\\) 进行比较。均值从大到小依次列出，字母 \\(A,B,C\\) 表示显著的分组。 表 3.14: 生成 Ducan、Student–Newman–Kuels 和 Waller–Duncan 多重比较程序的程序的 GLM 代码 x PROC GLM DATA=EX1; CLASS TASK; MODEL PULSE20=TASK; MEANS TASK/DUNCAN; MEANS TASK/SNK; MEANS TASK/WALLER; 表 3.15: 使用 Duncan’s 多重比较程序的结果 x 注释: 此检验控制 I 类比较错误率，而不是实验错误率。 表 3.16 包含 Student–Newman–Keul’s method 的类似结果。如上所述，Student–Newman–Keul’s method 的临界极差值大于 Duncan’s method 的临界极差值。临界极差值的增加使得 Student–Newman–Keul’s method 能够在完全零假设（所有均值相等）下控制实验误差率，而 Duncan’s method 无法控制实验误差率。表 3.17 包含 Waller–Duncan method 的结果。最小显著性差异为 \\(4.448\\)，该值小于表 3.4 中任何未调整的 \\(t\\) 值。最小显著性差异使用样本量的调和平均值为所有比较提供一个值。最小显著性差异较小是因为 \\(F\\) 统计量的值很大，表明均值之间可能存在差异。 表 3.16: SNK 多重比较程序的结果 x 注释: 该检验在完全零假设下控制 I 类实验误差率，但在部分零假设下无法控制。 表 3.17: Waller-Duncan 多重比较程序的结果 x 注释: 该检验在加性损失和某些其他假设下能最小化贝叶斯风险。 3.20 警示 在结束本章之前，请注意，当样本量不等时，下划线或分组程序可能不一致。考虑一个示例，其中标准差的估计值为 \\(2\\)，该值基于 \\(50\\) 个自由度。样本量和样本均值为 Treatment 1 2 3 4 \\(\\hat\\mu_i\\) 39.3 40.1 42.0 43.0 \\(n_i\\) 2 25 25 2 检验均值相等假设所需的 \\(F\\) 统计量的值为 \\(4.90\\)，显著性水平为 \\(0.005\\)。将 \\(\\mu_1\\) 与 \\(\\mu_2\\)、\\(\\mu_1\\) 与 \\(\\mu_3\\)、\\(\\mu_2\\) 与 \\(\\mu_4\\) 和 \\(\\mu_3\\) 与 \\(\\mu_4\\) 进行比较的 \\(5\\%\\) LSD值为 \\((2.008)(2)√(1/2+1/25)=2.951\\). 将 \\(\\mu_1\\) 与 \\(\\mu_4\\) 进行比较的 \\(5\\%\\) LSD值为 \\((2.008)(2)√(1/2+1/2)=4.016\\)，将 \\(\\mu_2\\) 与 \\(\\mu_3\\) 进行比较的 \\(5\\%\\) LSD值则为 \\((2.008)(2)√(1/25+1/25)=1.136\\). 因此，对于这些数据，最大均值和最小均值之间的差异 \\(\\hat\\mu_1-\\hat\\mu_4=3.7\\) 不显著，而两个中间均值之间较小的差异 \\(\\hat\\mu_2-\\hat\\mu_3=1.9\\) 是显著的。我们可以通过注意到有足够的信息（足够大的样本量）来声明 \\(\\mu_2\\) 和 \\(\\mu_3\\) 之间存在统计上显著的差异，但没有足够的信息（样本量太小）来声明任何其他均值对之间存在统计上显著的差异来解释这种明显的不一致性。 3.21 结束语 在本章中，讨论了从一个实验数据集进行许多推断的程序。这样的程序是必要的，以确保观察到的处理之间的差异是由于所比较的参数函数的实际差异，而不仅仅是由于偶然性。有些程序更适合计划的比较，而另一些程序更适合数据窥探。对于具有多个变量的研究，可以使用所有均值相等的 \\(F\\) 检验来避免对某些变量进行多重比较。如果 \\(F\\) 检验在所需的 \\(\\alpha\\) 水平上不显著，则不必进行进一步的比较，但如果 \\(F\\) 检验在所需的 \\(\\alpha\\) 水平上显著，则应使用调整多重性的多重比较方法来比较均值（这不是 Fisher’s protected LSD）。最后，所讨论的多重比较和检验程序可应用于不等方差模型（在第 2 章中讨论），通过使用 SAS-Mixed 中的 LSMeans 语句来实现，其中 REPEATED 语句用于指定不等方差结构。还给出了在给定情况下使用哪种程序的建议。 3.22 练习 参考文献 Fisher, R. A. (1949). The Design and Analysis of Experiments. Oliver and Boyd, Edinburgh, UK. Westfall, P. H., Tobias, R. D., Rom, D., Wolfi nger, R. D., and Hochberg, Y. (1999). Multiple Comparisons and Multiple Tests Using the SAS System. SAS Institute, Inc., Cary, NC. Benjamini, Y. and Hochberg, Y. (1995). Controlling the false discovery rate: A practical and powerful approach to multiple testing. J. Roy. Stat. Soc. B., Methodological, 57, 289–300. SAS Institute, Inc. (1999). SAS/STAT User’s Guide, Version 8. SAS Institute, Inc., Cary, NC. Westfall, P. H. (2002). From Farms to Pharmaceuticals: Multiple Comparisons Enter the 21st Century. Proceedings of the 13th Annual Kansas State University Conference on Applied Statistics in Agriculture, G. A. Milliken, ed. Department of Statistics, Kansas State University, Manhattan, KS. Šidák, Z. (1967). Rectangular confi dence regions for the means of multivariate normal distributions. J. Am. Stat. Assoc., 62, 626–633. Holm, S. (1979). A simple sequentially rejective multiple test procedure. Scand. J. Stat., 6, 65–70. Benjamini, Y. and Hochberg, Y. (1995). Controlling the false discovery rate: A practical and powerful approach to multiple testing. J. Roy. Stat. Soc. B., Methodological, 57, 289–300. Tukey, J. W. (1952). Allowances for various types of error rates. Unpublished IMS address, Chicago, IL. Tukey, J. W. (1953). The problem of multiple comparisons. Unpublished manuscript. Kramer, C. Y. (1956). Extension of multiple range tests to group means with unequal numbers of replications. Biometrics, 12, 307–310. Edwards, D. and Berry, J. J. (1987). The effi ciency of simulation-based multiple comparisons. Biometrics, 43, 913–928. Miller, R. G. (1967). Simultaneous Statistical Inference. McGraw-Hill Inc., New York, NY. Holland, B. S. and Copenhaver, M. D. (1987). An improved sequentially rejective Bonferroni test procedure. Biometrics, 43, 417–424. Ott, L. (1988). An Introduction to Statistical Methods and Data Analysis, 3rd ed. PWS-Kent Publishng Co., Boston, MA. 原文为 100% significance level. 应为笔误。↩︎ 原文为 That is, a smaller value of \\(\\sum_{i=1}^tc_i\\hat \\mu_i\\) can often enable one to declare that \\(\\sum_{i=1}^tc_i\\mu_i\\) is significantly different from zero using Bonferroni’s method or the multivariate t-method than can be declared significant by Scheffé’s method. 为符合中文表达，此处做了适当修改。↩︎ 原文为: not too unequal.↩︎ 原文中没有 “significant” 一词，严谨起见，译者已添加。↩︎ 原文中没有 “significant” 一词，严谨起见，译者已添加。↩︎ "],["chap4.html", "第 4 章 实验设计基础 4.1 介绍基本概念 4.2 设计实验的结构 4.3 不同设计实验的示例 4.4 结束语 4.5 练习 参考文献", " 第 4 章 实验设计基础 经过适当设计和分析的实验提供了有关所使用资源的调查条件的最大信息量。本章介绍了实验者设计和分析实验时使用的概念和方法。本章讨论的基本概念是处理结构 (treatment structure) 和设计结构 (design structure)，以及重复 (replication)、区组 (block) 和实验单元 (experimental unit) 的思想。给出了设计和处理结构相结合的实例，以说明完全区组设计和不完全区组设计的概念。这些设计涉及一种尺寸的实验单元。第五章描述了实验单元尺寸的概念，并给出了涉及多于一种实验单元尺寸的各种设计。本章提出的设计结构包括完全随机化 (completely randomized, CRD)、随机完全区组 (randomized complete block, RCBD)、不完全区组 (incomplete block, IBD)和拉丁方 (Latin square, LSD)。所考虑的处理结构包括单向、双向、双向对照、部分析因和 \\(n\\) 向结构。在本一章中，介绍了具有必要的变异源和自由度的模型和方差分析表。讨论提供了确定用于计算误差平方和的变异源的方法，以及用于计算结果自由度的算法。一般来说，误差平方和是通过对观测值或经过相同处理的观测值的线性组合 (observations that are treated alike) 的比较来获得的。其他平方和的计算将在后面的章节中讨论。本章的基本方法是通过示例来演示概念。裂区 (split-plot)、重复测量 (repeated measures)、裂条区 (strip-plot) 和交叉设计 (crossover designs ) 使用不同大小的实验单元的概念，并在第 5 章中进行了描述。涉及嵌套 (nesting) 的设计也在第 5 章中进行了讨论。 4.1 介绍基本概念 实验设计涉及计划实验，以便从可用资源中获得最多的信息。实验的设计应该从要达到的目的开始。应指定一个或多个主要响应变量，并充分描述实验目的和响应变量之间的联系。应解释用作实验单元的实体，并将其与实验目的联系起来。通常，在设计实验时，实验者可以控制某些被称为处理、总体或处理组合的因素。实验者通常控制要使用的实验单元的选择以及这些实验单元是否可以分组（称为区组）。典型的实验涉及要进行比较或要研究其效应的处理（或处理组合）。 在进行实验之前，必须回答几个问题： 实验的目的是什么？响应变量是什么？这是设计的一个非常重要的方面，因为必须了解生成数据的过程以及数据与目的的关系。 需研究多少种处理？处理的数量可能已经被指定，但有时应该讨论处理的选择如何与研究的目的相关。例如，一名营养学专业的学生想要设计一项研究，以确定在饼干产品中可以使用的大豆粉的最大量来代替小麦粉，这样所得的饼干中就没有大豆味了。该学生选择的饼干配方涉及用大豆粉替代 0、10、20、30、40、50、60、70、80、90 和 100% 的小麦粉。第一个问题是：“如果使用100%大豆粉，你能尝到大豆的味道吗？”因为如果你不能品尝到100%大豆粉的大豆味，那么就没有必要进行实验，如果你能品尝到大豆味，那么就没有必要在一组处理中包括100%大豆粉。我们认为尚不清楚用 20%、30%、40% 和 50% 大豆粉制成的产品是否可以品尝到大豆味。即，确定大豆粉含量为10％时无法品尝到大豆味，而大豆粉含量超过50％时则可品尝到大豆味。确定了不能品尝到含有10%大豆粉的大豆味，而可以品尝到含有超过50%大豆粉的大豆味，在将处理的选择与研究目的联系起来后，只需要最初11个处理中的5个（0、20、30、40和50%大豆粉）。0%作为小麦粉对照。这一过程大大减少了研究所需的样本数量。 每种处理需要观测多少次？这个问题与实现特定目的所需的样本量有关。 实验单元是什么？许多实验只涉及一个尺寸的实验单元。但其中涉及的重要思想是独立的重复。一些实验涉及多个尺寸的实验单元，这一概念在第 5 章中有所描述。研究人员通常认为一个实验只涉及一个尺寸的实验单元，而无法识别涉及多种尺寸的实验单元的情况。这个问题需要认真解决，如第 5 章所述。 实验者如何将处理应用于可用的实验单元，然后对响应进行观测？这个问题涉及使用随机化将处理分配给实验单元，以及在提供数据过程的其他部分中使用随机化。重要的是，随机化用于将处理分配给实验单元。在医学研究中，以随机顺序在实验室中运行样本或使用随机顺序评估受试者也很重要。 是否可以对最终设计进行分析或进行所需的比较？这可能是研究人员最重要的问题，但本书的一个主要目的是使读者能够使用更复杂的设计，并且仍然能够进行分析，以估计重要参数并检验所需的假设。 这些问题的答案不一定是直截了当的，也不能笼统地回答这些问题。希望这里讨论的想法和概念能帮助实验者收集足够的信息，为他们的研究提供答案。 为了继续，考虑一个涉及 \\(t\\) 个处理的实验，其中每个处理应用于 \\(r\\) 个不同的实验单元。令 \\(y_{ij}\\) 是分配给第 \\(i\\) 个处理的第 \\(j\\) 个实验单元观测到的响应，用于描述 \\(y_{ij}\\) 的数学模型为 \\[\\begin{equation} y_{ij}=\\mu_i+\\varepsilon_{ij}\\quad\\mathrm{for~}i=1,2,\\ldots,t,\\mathrm{~and~}j=1,2,\\ldots,r \\tag{4.1} \\end{equation}\\] 其中 \\(\\mu_i\\) 是第 \\(i\\) 个处理的响应均值的未知真实值，\\(\\varepsilon_{ij}\\) 是一个随机变量，表示由自然变异和其他可能的随机和非随机误差源引起的噪声。研究人员应尽力控制非随机误差源，包括模型误差、测量误差、观测误差和处理误差的错误指定。为了进行这个实验，研究人员必须选择 \\(rt\\) 个实验单元，然后将 \\(r\\) 个实验单元随机分配给每个处理。该过程的随机化部分对于防止处理分配中出现偏差非常重要。正是由于实验单元被随机分配给处理，随机化或置换分析 (permutation analysis) 可用于开发适当分析的理论 (Kempthorne, 1952). 关于随机化的使用，至少可以说，它可以防止在实验中引入系统偏差。如果实验者不使用随机化，则无法判断观测到的差异是由于实验单元对处理的反应差异造成的，还是由于用于将实验单元分配给处理的系统方法造成的。 实验的统计目的是比较在实验单元上观测到的处理响应。例如，如果研究人员想比较高血压化合物对人类血压的影响，那么在研究中使用小白鼠作为实验单元将无法对人类做出推断。只能对实验单元的总体进行推断，研究中使用的实验单元是代表性样本。对想要进行推断的实验单元的总体进行表征是非常重要的。研究中使用的实验单元样本必须从总体中随机选择，以对该总体进行推断。通常不可能从要纳入研究的实验单元总体中随机选择实验单元。但至少实验单元的样本必须能够代表总体或一个概念总体 (conceptual population)。例如，在对生产线进行抽样时，人们希望为研究选择的物品能够代表尚未生产的物品总体。如果生产过程没有改变，那么可以合理地假设所选物品将代表未来的物品。描述实验中使用的实验单元所代表的实验单元的总体是非常重要的。如果实验单元不代表要对其进行推断 (inference) 的实验单元的总体，则不能进行推断，相反，人们可以推测 (conjecture) 处理对未抽样总体的效应。例如，从一项涉及白鼠的研究中获得的关于高血压化合物的信息可以用来推测（而不是推断）高血压化合物对人类的效应。 当为研究选择实验单元时，当研究中使用的实验单元组是同质的 (homogeneous) 或非常相似时，可以获得更好的处理之间的比较。在许多实验中，不可能选择 \\(rt\\) 个相同的实验单元。不相同的实验单元通过 \\(\\varepsilon_{ij}\\) 导致数据中的噪声。当实验单元不是同质的或不相似时，有三种方法可以用来解释实验单元之间的差异，一种方法是测量描述实验单元之间差异的特征，如体重和年龄，并使用 Milliken and Johnson (2001) 中描述的协方差分析 (analysis of covariance)。第二种方法是将实验单元分成几组几乎相同的实验单元。几乎相同的实验单元称为同质的。在这种情况下，处理可以在组内的相似实验单元上进行比较，其中组与组之间的变异可以在分析中被解释。相似实验单元的组被称为区组 (block)。解释组之间的变异的第三种方法实验单元是同时使用区组和协变量分析 (covariate analysis)。假设有 \\(r\\) 个区组，每个区组有 \\(t\\) 个实验单元，每个区组中每个处理发生一次。表示第 \\(j\\) 个区组中第 \\(i\\) 个处理的观测到的响应的模型为 \\[\\begin{equation} y_{ij}=\\mu_i+b_j+\\varepsilon_{ij}^*\\quad\\mathrm{~for~}i=1,2,\\ldots,t,\\mathrm{~and~}j=1,2,\\ldots,r \\tag{4.2} \\end{equation}\\] 对于模型 (4.2)，模型 (4.1) 中的 \\(\\varepsilon_{ij}\\)s 替换为 \\(\\varepsilon_{ij} = b_j + \\varepsilon_{ij}^*\\)；也就是说，实验单元组或区组之间的变异已被识别并从 \\(\\varepsilon_{ij}^*\\) 中分离出来，它代表区组内实验单元的变异。通过将区组效应与实验单元分离，区组内变异 (within-block variation) 可用于比较处理效应，这涉及计算处理对比的标准误估计。 两种处理（或任何处理对比）可以在没有区组效应的情况下进行比较，方法是将两种处理的响应的区组内差异 (within-block differences) 视为 \\[\\begin{aligned} y_{ij}-y_{i^{\\prime}j}&amp; =(\\mu_i+b_j+\\varepsilon_{ij}^*)-(\\mu_{i^{\\prime}}+b_j+\\varepsilon_{i^{\\prime}j}^*) \\\\ &amp;=\\mu_i-\\mu_{i^{\\prime}}+\\varepsilon_{ij}^*-\\varepsilon_{i^{\\prime}j}^* \\end{aligned}\\] 这不取决于区组效应 \\(b_j\\)。这种差异的结果是，一个区组内两种处理响应差异的变异取决于实验单元之间的区组内变异，而不是区组间变异 (between-block variation)。 实验设计的目的是选择和分组实验材料，以便尽可能减少实验中各组内实验单元之间的噪声或实验误差。因此，要比较处理的实验单元应该尽可能相似，这样两种处理之间的较小差异就可以被检测为显著差异。 如果有 \\(t\\) 个处理和 \\(t\\) 个实验单元，则可以进行实验，并且可以根据观测结果估计每个处理的平均值。但无法获得误差方差的估计值。只有当部分或全部处理被重复时，才能获得误差方差的估计值（与 \\(\\varepsilon_{ij}\\) 或 \\(\\varepsilon_{ij}^*\\) 相关）。处理的重复是对处理的独立观测。因此，一种处理的两次重复必须涉及两个实验单元。实验单元是应用了处理的实体。但处理的重复必须涉及过程，以便在每个实验单元上独立应用并观测处理。因此，假设一名研究人员想比较两种饮食对兔子生长速度的影响，并且他有 \\(10\\) 只兔子可用于研究。这个过程是将五只兔子随机分配到每种处理中。但是，如果他将分配给其中一种饮食的五只兔子放在一个笼子里，而将分配给第二种饮食的五只兔子放在另一个笼子里，而同一个笼子里的兔子则从一个普通的碗里喂食这种饮食，结果会怎样呢？每只兔子被随机分配了饮食，但由于所有五只兔子都被放入一个笼子并用一个共同的碗喂食，因此不能对兔子进行独立观测。在这种情况下，实验单元是笼子而不是单个兔子。笼子之间是独立处理的，但笼子里的兔子却不是独立处理的。因此，笼子里的兔子不提供独立的饮食重复。了解进行研究的完整过程非常重要，以便能够了解何时发生独立重复以及何时不发生。必须遵守此定义以确定实验期间何时使用重复。研究人员经常使用复制 (duplicate) 或分割样本 (split samples) 来生成两个观测结果，并将它们称为重复 (replications)，而实际上，它们实际上是子样本 (sub-samples) 或重复测量 (repeated measures)。复制项肯定不会提供与独立重复项相同的信息。 假设一名研究人员想要研究某所特定大学男女学生的身高差异。假设大学有 \\(22,000\\) 名学生。一个过程可以是从大学学生中随机选择 \\(100\\) 名女学生和 \\(100\\) 名男学生。下一步是找到随机样本中的所有学生并测量他们的身高，从而产生 \\(100\\) 个女性身高测量值和 \\(100\\) 个男性身高测量值。要找到所有 \\(200\\) 名学生，工作量似乎很大。相反，假设研究人员选择一名女性和一名男性，并测量每人的身高 \\(100\\) 次。第二个过程产生 \\(100\\) 个女性身高测量值（本例中为一名女性）和 \\(100\\) 个男性身高测量值（本例中也是一名男性）。每个数据集都有 \\(200\\) 个观测值，但第一个过程中一个数据集内 \\(100\\) 个测量值之间的变异性 (variability) 提供了大学女生和男生之间的变异性的测量。在第二种情况下，一组中的 \\(100\\) 个测量值的变异性提供了对同一个人进行的 \\(100\\) 个测量值之间的差异的度量。第二种情况提供了有关测量过程变异性的信息（对同一个人的重复测量），但没有提供关于特定大学的女性或男性身高之间的变异性的信息。对一个人身高的独立测量不能提供对总体身高的真实变异的测量。对 \\(100\\) 名女性身高的测量提供了 \\(100\\) 次重复，而对同一个人的 \\(100\\) 次测量提供了对该人的重复测量。对同一人的这 \\(100\\) 项测量被称为重复测量或子样本，但不是重复测量。 一位面包师进行了一项实验，比较了三种防腐剂在某种类型的蛋糕产品中抑制霉菌生长的能力。面包师把每种防腐剂混合在一起烤了一个蛋糕。每立方厘米蛋糕的霉菌孢子数量是在储存 \\(9\\) 天后测量的。面包师想要 \\(10\\) 次重复的分析，所以他把每个蛋糕分成 \\(10\\) 片，并获得了每片上的孢子数量。然而，这 \\(10\\) 次测量并不是由 \\(10\\) 种单独使用的防腐剂产生的。他的子样品测得的变异是蛋糕内变异 (within-cake variation) 的指数，而不是防腐剂实验单元间变异 (experimental-unit-to-experimental-unit variation) 或蛋糕间变异 (cake-to-cake variation) 的指数。为了得到每种防腐剂的 \\(10\\) 次重复，面包师需要用每种防腐剂烘焙 \\(10\\) 个蛋糕。这些蛋糕需要相互混合并独立烘焙。将一大批蛋糕面团搅拌在一起，加入防腐剂，然后将混合物倒入 \\(10\\) 个蛋糕平底锅中，可能会更容易。这一过程提供了 \\(10\\) 个蛋糕，但这些蛋糕并不是相互独立地混合在一起的，因此它们不是独立的重复。面包师需要将 \\(10\\) 批面团与防腐剂混合，然后在不同的烤箱 （或在不同的时间）从每批面团中烘焙一个蛋糕，以获得 \\(10\\) 种防腐剂的重复。 另一个非重复的例子涉及一些研究人员所称的条状试验 (strip trial)。在农学中，条状试验包括在一行 (rows)（或行组，a group of rows）中种植给定品种的所有种子，每行（或行组）种植不同的品种。然后将行（或行组）划分为八个部分，这些部分称为重复。图 4.1 中的图表表示六个裂条区 (strip plot)，每个裂条区有四行15，并被分成八个部分表示为重复。用条状试验代替八次独立重复的优点是，研究人员不需要在条状试验中不断地将种子从一个播种箱位置换到另一个播种箱位置，而且种植计划非常简单。现在，如果她想进行精心设计的实验，她就必须根据特定的随机方案更换播种箱八次。进行这样的随机化将在随机完全区组设计结构 (randomized complete block design structure) 中提供八个区组。如果实验者像分析随机完全区组设计一样分析条状试验数据，那么她的分析将是错误的。事实上，条状试验不能用来推断品种差异，因为每个品种只有一次独立的观测。四行或裂条区是应用该品种的实验单元。在条状试验中，研究人员可以轻松地将裂条区划分为 \\(20\\) 个部分 (parts) 或 \\(100\\) 个部分；毕竟，有了更多的“复制”，人们可以根据两种均值较小差异检测出显著的结果。但是，在这些裂条 (strips) 中的每一条上进行的这些测量都不是真正的重复；相反，它们是裂条区的子样本或重复测量。因此，获得越来越多的部分无助于检测均值之间的差异。确定某个部分或观测是否是真实重复的一个检验如下：如果研究人员可以通过分裂同样轻松地获得更多“重复”，那么她就没有获得真正的重复，而是获得了子样本或重复测量。区分子样本和重复样本非常重要，因为从子样本之间估计的误差方差通常比从重复样本或实验单元之间估计的误差方差小得多。使用从子样本计算出的误差方差构建的 \\(F\\) 统计量将比应有的值大得多，导致实验者确定更多的差异，因为其统计显著性超过了应有的差异。 图 4.1: 裂条区设计示意图，其中四个行和六个品种排列在八个伪重复中 4.2 设计实验的结构 设计实验 (designed experiment) 由两个基本结构组成，能够识别和区分每个结构至关重要。在为特定设计构建适当的模型和分析之前，实验设计中使用的所有因素必须分类为属于处理结构或设计结构。以下定义和讨论用于帮助描述两种结构之间的差异。 定义 4.1 ♦ 设计实验的处理结构 (treatment structure) 由实验者选择用于研究和/或比较的一组处理、因素、处理组合或总体组成。 处理结构是根据那些要比较的因素或处理构建的，通过它们对给定响应变量的效应来测量。必须选择处理结构中的因素来实现既定的实验目的。处理结构可以是一组处理，称为单向处理结构，也可以是一组处理组合，例如双向因素安排 (arrangement) 或高阶因素排列，加上任何对照或标准处理。 定义 4.2 ♦ 设计实验的设计结构 (design structure) 包括将实验单元分组为同质组或区组。 设计实验的设计结构涉及用于形成实验单元组的因素，以便观测处理的条件尽可能统一。如果所有实验单元都非常同质，则只需要一组或一组观测，并且实验单元可以完全随机地分配给处理。这样的设计结构称为完全随机设计结构 (completely randomized design structure). 如果需要多于一组的实验单元，使得组内的单元比组间的实验单元更加同质，则设计结构涉及某种类型的区组设计。有多种因素可用于形成实验单元的区组，但是，如下所述，用于构建区组的一个或多个因素不得与处理结构中的因素相互作用。一旦选择了处理结构和设计结构，就通过准确描述将处理结构的处理随机分配（随机化）到设计结构中的实验单元的方法来指定设计的实验。 因此，总的设计实验包括 1）处理结构的选择，2）设计结构的选择和 3）将处理结构中的处理或处理组合随机分配给设计结构中的实验单元的方法。图 4.2 显示了设计实验的两个部分。 图 4.2: 使用随机化将处理结构与设计结构相结合以形成实验总体设计的图示 总的设计实验规定了用于获得适当分析的适当模型。在构建描述设计的模型时，对设计和处理结构进行了两个基本假设。首先，假设设计结构的组成部分是随机效应，即设计中使用的区组是来自实验单元的可能区组的总体的随机样本。这一假设意味着研究人员希望对大量的实验单元进行推断。其次，假设设计结构的组成部分（或因素）与处理结构的组成部分（或因素）之间没有交互作用。换言之，假设处理之间存在的关系从一个区组到另一个区组是一致的（随机变异除外），或者换句话说，区组因素不会影响处理之间的关系。许多教科书将区组因素描述为讨厌因素 (nuisance factors)，而没有解决讨厌因素与处理结构中的因素交互作用的可能性 (Cobb, 1997). 如果可以发生这种交互作用，则这些讨厌因素必须包括在处理结构中，或者讨厌因素的值可以被视为具有不等斜率可能性的协变量 (Milliken and Johnson, 2001). 必须仔细评估可能用于构建区组的因素的选择，以防止与处理结构中的因素可能发生交互作用。 设计结构的选择是利用实验单元的所有可用知识，并且是独立于处理结构选择的（不要让处理结构影响不良设计结构的选择）。同样，实验者应该在不了解设计结构的情况下选择处理结构（不要让设计结构妨碍选择必要的处理集合）。在指定了适当的设计结构并选择了所需的处理结构之后，可能需要在一个或两个结构中做出一些妥协，以使它们彼此兼容，并使实验者能够进行有效的实验。 4.2.1 设计结构类型 设计结构由区组类型或将实验单元分组为同质组来确定，并由用于形成区组的因素来指定。以下是对一些常见设计结构的描述。有两种基本的设计结构，它们被描述为完全区组 (complete block) 和不完全区组 (incomplete block) 设计结构。4.3 节对几种特定设计结构进行了更详细的讨论。 完全随机设计结构 (Completely randomized design structure). 在完全随机设计结构中，假设所有实验单元都是均匀的，并且实验单元完全随机地分配给处理。通常，这些处理被分配相同数量的实验单元，尽管这不是必需的。当实验单元不是同质的，并且实验者不能确定允许将它们分组到更同质的组中的因素时，也可以使用这种设计结构。当区组因素的值被用作协变量而不是使用它们来形成区组时，可以使用协方差分析 (Milliken and Johnson, 2001). 随机完全区组设计 (Randomized complete block design). 如果有 \\(t\\) 个处理，那么随机完全区组设计结构包括具有实验单元的区组，每个区组中有 \\(t\\) 个或多个实验单元。当区组大小等于或大于处理数时，有可能在每个区组内出现一组完整的处理，因此被称为随机完全区组。如果每个区组的区组尺寸恰好等于 \\(t\\)，则每个处理恰好被随机分配到每个区组内的一个实验单元。如果每个区组内有 \\(t\\) 个以上的实验单元，那么每个处理可以分配到一个实验单元，一些处理（也可能是全部）可以分配到多个实验单元。如果 \\(t=5\\) 并且区组的尺寸为 \\(8\\)，则每个处理将被分配到每个区组内的实验单元，并且其中三个处理将被分配到一个额外的实验单元以进行这些处理的总共两次重复。一种策略是制定一种区组的处理模式，其中每个处理的观测数量尽可能均衡 (balanced)。图 4.3 包含一种将五种处理分配给三个尺寸为 \\(8\\) 的区组的方法。在每个区组内，将各自的处理随机分配给该区组内的实验单元。所示的安排是一组可能的随机化。如果每个区组由 \\(c\\times t\\) 个实验单元组成，其中 \\(c\\) 是整数，则每个处理可以分配给每个区组内的 \\(c\\) 个实验单元。这也是一个随机完全区组设计结构。随机完全区组设计结构是指区组内实验单元的数量大于或等于处理数量的任何区组方案，因此可以将一整套处理分配给每个区组中的实验单元。 图 4.3: 随机完整区组设计结构，在尺寸为 \\(8\\) 的区组中包含五种处理 拉丁方设计 (Latin square design). 拉丁方设计结构由两个方向的区组组成。对于涉及 \\(t\\) 个处理的实验，\\(t^2\\) 个实验单元被安排为 \\(t\\times t\\) 的方块 (square)，其中行被称为行区组 (row blocks)，列被称为列区组 (column blocks)。因此，实验单元的这种 \\(t\\times t\\) 安排在两个方向上被分区 (blocked)：行区组和列区组。为了构建拉丁方设计结构，将处理随机分配到方块中的实验单元，使得每种处理在每一行区组中发生一次且仅发生一次，在每一行区组中发生一次且仅发生一次。参见 Cochran and Cox (1957) 以了解在行区组和列区组中的各种处理安排。两个或多个方向的区组在许多学科中很常见，特别是当实验单元出现在矩形中时（其中一个维度可能是时间），按行和列进行分区很有用。Graeco–Latin 方块可用于形成三个方向的区组 (Cochran and Cox, 1957). 不完全区组设计 (Incomplete block design)。当一个或多个区组中的处理数超过实验单元数时，即出现不完全区组设计。当这种情况发生时，每个区组中不可能出现完整的处理集，因此被称为“不完全区组”。有几种特殊的不完全区组设计结构，如均衡不完全区组 (balanced incomplete blocks) 和部分均衡不完全区组 (partially balanced incomplete blocks). 均衡不完全区组设计结构是指将处理分配给区组，使得每对处理在同一区组中出现的次数相等。当一组处理在区组内一起出现相同的次数，而其他处理在一些区组内一起出现不同的次数时，就会出现部分均衡不完全区组设计结构。第 5 章中讨论的裂区设计结构是部分不完全区组设计结构的一个示例。例 4.5 描述了一些不完全区组设计结构。 各种组合和推广 (Various combinations and generalizations). 有多种方法可以对实验单元进行分组。有时分组不满足上述定义，但仍然提供了有效的设计结构。一个例子是区组尺寸因区组而异，其中一些区组是不完全的，而另一些块是完全的。在任何情况下，这些其他的区组方案都可以为实验者提供非常可行的设计结构，以便进行有效的实验。 4.2.2 处理结构类型 处理结构由实验者希望研究的各种处理或处理组合或因素和因素组合组成。处理结构组成部分的选择应与实验目的相关，实验目的应在研究方案或描述中具体说明。接下来描述了一些常见的处理结构类型，每一种都在 4.3 节中进行了更详细的讨论。 单向处理结构 (One-way treatment structure). 单向处理结构由一组 \\(t\\) 个处理或总体组成，其中处理之间没有假定的结构。处理之间可能存在关系，例如使用四个温度，120、130、150和160°C。如果处理是通过组合两个或多个因素构建的，则这些因素不会用于表示模型中的处理。单向处理结构可用于表示任何一组处理，当一些可能的处理组合缺失时，单向处理结构通常用于表示析因 (factorial) 处理结构。第 ?? 章使用了这种方法。 双向处理结构 (Two-way treatment structure). 双向处理结构由通过组合两个不同因素的水平 (levels) 或可能性 (possibilities) 而构建的处理集组成。所得到的处理集，称为处理组合，是通过将其中一个因素的每个可能性与另一个因素的每个可能性组合而生成的。如果第一个因素有 \\(s\\) 个可能性，第二个因素有 \\(r\\) 个可能性，该组合产生 \\(sr\\) 种处理组合。图 4.4 给出了一个双向处理结构的例子，其中因子 \\(A\\) 有三种可能性，因子 \\(B\\) 有四种可能性，交叉产生 \\(12\\) 种处理组合。 图 4.4: 双向处理结构，其中因子 \\(A\\) 有三个水平，因子 \\(B\\) 有四个水平，生成 \\(12\\) 种处理组合 析因安排处理结构 (Factorial arrangement treatment structure). 析因安排处理结构由通过组合两个或多个因子的水平而构建的处理组合的集合组成。双向处理结构是双向析因安排。三向到 \\(n\\) 向处理结构也是析因安排。\\(n\\) 向处理结构是通过组合 \\(n\\) 个因子的可能性而生成的，其中，因子分别具有 \\(s_1,s_2,\\dots,s_n\\) 个可能性，从而生成 \\(s_1\\times s_2\\times\\dots\\times s_n\\) 种处理组合。析因安排处理结构的例子散布在整本书中。 部分析因安排处理结构 (Fractional factorial arrangement treatment structure). 部分析因安排处理结构仅由析因安排处理结构中可能的处理组合的一部分或一小部分组成。有许多系统的技术来选择适当的分数 (fraction)，其中大多数取决于实验者对处理结构中各种类型因素之间交互作用的假设。一个实验可能涉及 \\(8\\) 个具有两水平的不同因素，因此总共有 \\(2^8\\) 个处理组合。研究人员可能想寻找重要的主效应和两个因素的交互作用。在这种情况下，研究中可以使用四分之一分数 (one-fourth fraction) 或64个处理组合。这样的设计通常表示为 \\(2^{8-4}\\) 部分析因安排，更多细节参见 Milliken and Johnson (1989). 拉丁方排列处理结构涉及具有 \\(n\\) 行处理，\\(n\\) 列处理和 \\(n\\) 个单元格 (cells) 处理的三向析因排列。拉丁方排列由 \\(n^3\\) 种可能的处理组合中的 \\(n^2\\) 种组成，或者是\\(n^3\\) 种可能的处理组合的 \\(1/n =(n^2/n^3)\\) 部分。部分拉丁方安排的一个可能用途是，可以假设这三个因素之间没有双向或三向交互作用。 最优设计处理结构 (Optimal design treatment structures)。对于许多实验情况，处理结构中的所有因素都是定量的，研究目的是收集数据以建立特定的线性或非线性模型。使用其中一个设计准则 (St. John and Draper, 1975) 选择的处理组合形成了最优设计。这组处理组合被称为最优设计处理结构。 具有一个或多个对照的部分安排 (Factorial arrangement with one or more controls). 用于满足实验目的的期望处理结构可以包括将多种处理结构相结合。例如，实验的处理结构可以包括将 \\(c\\) 个对照的单向处理结构与双向析因安排处理结构相结合。图 4.5 包含一种这样的处理结构，其中因子安排由两个水平的因子 \\(A\\) 和三个水平的因子 \\(B\\) 以及三个对照组成。 图 4.5: 将单向和双向处理结构组合，形成九种处理组合的处理结构用于实验 出于分析目的，所有上述处理结构始终可以被视为一种单向处理结构。特别是，当处理结构是两个或多个处理结构的复杂组合时（如图 4.5 所示），在分析结果数据时通常最好将一组处理视为单向处理结构。 裂区和重复测量设计结构由不完全区组设计结构和涉及两个或多个因素的析因安排处理结构组成。实际上，裂区和重复测量设计的设计结构和处理结构的组合产生不同尺寸的实验单元，这是一个必须解决的问题，以便获得适当的分析。这样的设计将在第 5 章讨论。 4.3 不同设计实验的示例 有大量关于用于多种类型实验的各种类型设计的已发表信息，例如， Cochra and Cox(1957), Davies (1954), Federer (1955), Hicks (1993), John (1971), Kirk (1968), Cornell (1990), Anderson and McLean (1974), Box et al. (1978), Cobb (1997), Kempthorne (1952), Laundsby and Weese (1993), Lentner and Bishop (1986), Meed (1988), Montgomery (1991) and Winer (1971). 本节包含几个示例，以演示 4.2 节中描述的设计结构和处理结构。希望这一讨论将帮助读者将这些概念应用到他们自己的实验中。在大多数情况下，通过指定设计结构的类型和处理结构的类型来命名所得到的设计实验。例如，设计的实验可以由随机完全区组设计结构中的双向处理结构组成。这种描述设计实验的方法不同于文献中通常使用的方法，但作者认为使用设计结构和处理结构是识别设计实验的最好方法。此外，这一描述还有助于构建适当的模型并进行适当的分析。针对每种实验情况，给出了相应的设计结构和处理结构，并给出了相应的模型，以及带有相应的变异源及相应自由度的的方差分析表。本节不给出平方和的计算公式，但在其他章节中提供了一些有计算的例子。本章的重点是确定误差平方和的计算方法，并确立相应的自由度。 4.3.1 示例 4.1: 饮食 一位营养学家想要研究健康饮食对体重减轻的影响。本实验的处理结构是单向分类，涉及单个因素，称为饮食，具有不同水平或不同处理。许多不同的设计结构可以用来评估饮食。如果有 \\(20\\) 个同质的人，那么可以使用完全随机设计结构，其中每种饮食被随机分配给四个人。完全随机设计结构中的单向处理结构的一个模型是 \\[\\begin{equation} y_{ij}=\\mu_i+\\varepsilon_{ij}\\quad i=1,2,\\ldots,t,j=1,2,\\ldots,n_i \\tag{4.3} \\end{equation}\\] 其中 \\(\\mu_i\\) 表示第 \\(i\\) 种处理（饮食）的均值，\\(\\varepsilon_{ij}\\) 表示随机误差。模型 (4.3) 的方差分析表见表 4.1，其中假设了 \\(\\varepsilon_{ij}\\sim \\text{i.i.d.}\\,N(0,\\sigma^2)\\). 表 4.1 包含公式 (4.3) 中模型的不同变异源及其各自的自由度。实验误差的 \\(15\\) 个自由度是从经过相同处理的人之间的变异中得到的。有四个人接受了饮食 1，提供了经过相同处理的四个人，这四个人体重减轻值之间的差异为误差提供了三个自由度。每种饮食有四个人经过相同处理。因此，五种饮食中的每种饮食的数据都有三个可供误差的自由度。如果方差相等，那么这五组三个自由度可以合并为一个涉及 \\(15\\) 个自由度的误差项。第 2 章中的方法可用于评估等方差假设的合理性。 表 4.1: 完全随机设计结构中单向处理结构的方差分析表 x 假设研究者在给定时间段内只能招募并采访五个人。让时间段成为一个区组因素，并在每个时间段内将五种饮食随机分配给一个人。该设计是随机完全区组设计结构中的单向处理结构，具有四个尺寸为五的区组。可用于描述此设计中的数据的模型是 \\[\\begin{equation} y_{ij}=\\mu_i+b_j+\\varepsilon_{ij}\\quad i=1,2,3,4,5,j=1,2,3,4 \\tag{4.4} \\end{equation}\\] 其中 \\(\\mu_i\\) 表示第 \\(i\\) 个处理（饮食）的均值，\\(b_j\\) 表示第 \\(j\\) 个区组的效应，\\(\\varepsilon_{ij}\\) 表示与分配给第 \\(j\\) 个区块中第 \\(i\\) 个处理的人相关的随机误差。模型 (4.4) 的方差分析表如表 4.2 所示。误差自由度是通过使用每个区组内处理的四个正交对比来计算的，例如， \\[\\begin{array}{ll}q_{1j}=y_{1j}-y_{2j}&amp;j=1,2,3,4\\\\q_{2j}=y_{1j}+y_{2j}-2y_{3j}&amp;j=1,2,3,4\\\\q_{3j}=y_{1j}+y_{2j}+y_{3j}-3y_{4j}&amp;j=1,2,3,4\\\\q_{4j}=y_{1j}+y_{2j}+y_{3j}+y_{4j}-4y_{5j}&amp;j=1,2,3,4\\end{array}\\] 表 4.2: 随机完全区组设计结构中单向处理结构的方差分析表，每个区组中每种处理有一次重复 x 相同 \\(i\\) 值的 \\(q_{ij}\\) 值都具有相同的均值，表明它们都经相同处理。因此，每组四个 \\(q_{ij}\\) 值的方差为误差提供了三个自由度。因此，可以将四组三个自由度合并（如果方差相等）为具有 \\(12\\) 个自由度的误差平方和。然而，\\(q_{ij}\\) 的方差并不相等，必须在合并 (pooling) 之前重新缩放。对于 \\(j = 1, 2, 3, 4\\)，方差为 \\(\\text{Var}(q_{1j}) = 2\\sigma^2,\\text{Var}(q_{2j})= 6\\sigma^2,\\text{Var}(q_{3j})= 12\\sigma^2\\) 以及 \\(\\text{Var}(q_{4j})= 20\\sigma^2\\)，因此方差为在合并之前需要将 \\(q_{ij}\\) 除以 \\(\\sigma^2\\) 的系数。实际上，这些合并的平方和提供了区组与饮食交互作用的平方和。因此，获得相似处理的方差的第二种方法是使用区组与处理的交互作用 (block-by-treatmen interaction) 来获得随机完全区组设计结构的实验误差估计。 接下来，假设没有 \\(20\\) 个同质的人，但有 \\(10\\) 个同质的男性和 \\(10\\) 个同质的女性。一种策略是使用人的性别作为区组因子，其中有两个大小为 \\(10\\) 的区组。可以使用随机完全区组设计结构，其中每种饮食将随机分配给两名男性和两名女性，因此每个区组中每种饮食有两次重复。随机完全区组设计结构中单向处理结构的模型为 \\[\\begin{equation} y_{ijk}=\\mu_{i}+b_{j}+\\boldsymbol{\\varepsilon}_{ijk}\\quad i=1,2,3,4,5,j=1,2,k=1,2 \\tag{4.5} \\end{equation}\\] 其中 \\(\\mu_i\\) 表示第 \\(i\\) 个处理（饮食）效应的均值，\\(b_j\\) 表示第 \\(j\\) 个区组的效应，\\(\\varepsilon_{ijk}\\) 表示与分配给第 \\(j\\) 个区块中第 \\(i\\) 个处理第 \\(k\\) 个人相关的随机误差。模型 (4.5) 的方差分析表如表 4.3 所示。有一个与设计结构或人的性别相关的自由度已从表 4.1 的误差项中删除。随机完全区组设计结构中的单向处理结构的误差项，其中每个区组中每个处理有一个观测结果，是根据区组与处理的交互作用来计算的。这种设计包括区组和每个区组中每种处理的多次观测。区组与处理的交互作用的自由度等于 \\((2-1)×(5-1)=4\\). 每个区组内每种饮食的两个观测结果的变异性提供了一个自由度。因此，在每个区组内对经相同处理的人进行比较时，有五个误差自由度，或者在两个区组内总共有 \\(10\\) 个自由度。将区组与处理的交互作用与区组内变异合并起来共提供了 \\(14\\) 个误差自由度。 表 4.3: 随机完全区组设计结构中单向处理结构的方差分析表，每个区组中每种处理有两次重复 x 在大多数情况下，人的性别不是区组因素好的选择，因为处理（这个例子为饮食）可能会与人的性别发生交互 (interact)。如果选择用于构建区组的一个或多个因素可能与处理发生交互，则该因素需要作为分层因素或在具有可能不等斜率的协方差分析中包括在处理结构中，以进行适当的分析 (Milliken and Johnson, 2001). 在这个例子中，一个人的性别必须与五种饮食相结合，以形成双向因素安排或双向处理结构。这种双向处理结构由 \\(10\\) 种处理组合组成，通过将人的两个性别水平与五个饮食水平相结合而产生。通过将人的性别从设计结构切换到处理结构，得到的设计结构是一个完全随机的设计，每个处理组合有两次重复。随机化方案是将每种饮食随机分配给两名男性和两名女性。这是与模型 (4.5) 相同的随机化方案，但具有不同的处理和设计结构。完全随机化设计结构中的双向处理结构的一个模型是均值模型： \\[\\begin{equation} y_{ijk}=\\mu_{ij}+\\varepsilon_{ijk}\\quad i=1,2,\\ldots,5,j=1,2,k=1,2 \\tag{4.6} \\end{equation}\\] 其中 \\(\\mu_{ij}\\) 表示第 \\(ij\\) 种处理组合（人的性别与饮食）的平均值，\\(\\varepsilon_{ijk}\\) 表示随机误差。有时，均值 \\(\\mu_{ij}\\) 表示为效应模型： \\[\\mu_{ij}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij}\\] 其中 \\(\\mu\\) 是总体平均值16(overall mean)，\\(\\tau_i\\) 是第 \\(i\\) 种饮食的效应，\\(\\beta_j\\) 是人的第 \\(j\\) 种性别的效应，\\(\\gamma_{ij}\\) 是交互作用效应。表 4.4 给出了模型 (4.6) 这两种 \\(\\mu_{ij}\\) 表达式的方差分析表。 表 4.4: 完全随机设计结构中双向处理结构方差分析表，包含均值模型和效应模型 x 接下来，假设饮食结构由一个对照饮食和四个饮食组成，这四个饮食由两个蛋白质水平和两个碳水化合物水平的四个组合组成，如图 4.6 所示。饮食处理结构是一种双向析因安排，当与人的性别交叉时，对照组会产生一种三向处理结构（蛋白质×碳水化合物×性别），其中有两个对照，一个对照用于男性，一个对照用于女性。设计结构是完全随机的，每个处理组合分配给两个人。可以用来描述这些数据的模型是 \\[\\begin{equation} y_{ijk}=\\mu_{ij}+\\varepsilon_{ijk}\\quad i=0,1,2,3,4,j=1,2,k=1,2 \\tag{4.7} \\end{equation}\\] 其中 \\(\\mu_{01}\\) 和 \\(\\mu_{02}\\) 表示对照组的平均值， \\(\\mu_{ij},i = 1, 2, 3, 4, j = 1, 2\\) 表示饮食与性别处理组合的平均值。表 4.5 为模型 (4.7) 的方差分析表。其中 “Control vs 22” 表示对照饮食与四种蛋白质和碳水化合物处理组合的平均值之间的比较。完整的分析最有可能使用饮食与性别的双向处理结构，并具有适当的处理均值的对比，以提供涉及蛋白质、碳水化合物、人的性别和对照的比较。这种对比的构建将在第 ?? 章及以后进行讨论。 表 4.5: 完全随机设计结构中三向析因安排与两个对照相结合的处理结构的方差分析表 x 图 4.6: 具有双向析因安排和一个对照的处理结构的饮食结构 4.3.2 示例 4.2: 房屋油漆 一家油漆公司想要比较四种白色房屋油漆承受环境条件的能力。实验中准备了四栋方形房屋，每栋房屋的一面朝北，因此房屋可以作为区组因素。房屋的每一面都可能暴露在不同类型的天气下，因此房屋的侧面（这里用北、南、东、西方向表示）也可以用作区组因素。由于处理数量（四种涂料）与两个区组因素的水平数相同，因此可以使用拉丁方设计结构来研究油漆。在这里，油漆可以分配到房屋的侧面，其中每种油漆可以在每个房屋上发生且仅发生一次，并且在每个方向上发生且仅发生一次。存在三种基本的拉丁方安排（参见 Cochran and Cox, 1957）。随机化过程是从三种可能的安排中随机选择一种，然后将房屋随机分配给行，将方向随机分配给列，并将油漆类型随机分配给方块中的字母。表 4.6 显示了一种将油漆分配给房屋和方向的安排。 表 4.6: 将一组处理从单向处理结构分配到拉丁方设计结构 x 本实验设计的是一种单向处理结构中的拉丁方设计结构。可以用来描述该实验数据的模型是 \\[\\begin{equation} y_{ijk}=\\mu_i+h_j+d_k+\\boldsymbol{\\varepsilon}_{ijk}\\quad i=1,2,3,4,j=1,2,3,4,k=1,2,3,4 \\tag{4.8} \\end{equation}\\] 其中 \\(\\mu_i\\) 表示第 \\(i\\) 种油漆的平均耐磨性得分，\\(h_j\\) 表示第 \\(j\\) 个房屋的效应，\\(d_k\\) 表示第 \\(k\\) 个方向的效应，\\(\\varepsilon_{ijk}\\) 表示实验单元误差。表 4.7 给出了模型 (4.8) 的方差分析表。拉丁方设计结构的误差由对比组成，这些对比测量了油漆、房屋与方向的交互作用。 表 4.7: 拉丁方处理结构中单向处理结构的方差分析表 x 接下来，假设油漆具有由 1）基础油漆，2）基础油漆 + 添加剂 I，3）基础油漆 + 添加剂 II，以及 4）基础油漆 + 添加剂 I +添加剂 II。油漆的这种结构提供了双向处理结构，其中一个因素是两个水平（零和添加）的添加剂 I，第二个因素是两个水平（零和添加）的添加剂 II。由此产生的四种处理组合见表 4.8. 表 4.8: 房屋油漆的双向处理结构示例 x 拉丁方设计结构中的双向处理结构的一个模型是 \\[\\begin{equation} y_{ijkm}=\\mu+\\gamma_i+\\beta_j+(\\gamma\\beta)_{ij}+h_k+d_m+\\varepsilon_{ijkm}\\quad i=1,2,\\quad j=1,2,\\quad k=1,2,3,4,\\quad m=1,2,3,4 \\tag{4.9} \\end{equation}\\] 其中 \\(\\gamma_i\\) 表示添加剂I的效应，\\(b_j\\) 表示添加剂II的效应，\\((gb)_{ij}\\) 表示两种添加剂之间的交互作用。表 4.9 给出了模型 (4.9) 的方差分析表。分析模型 (4.8) 和 (4.9) 的唯一区别在于，在模型 (4.9) 中，油漆具有一种结构，用于将油漆效应划分为添加剂 I、添加剂 II 以及添加剂 I 和 II 的交互作用所产生的效应。即使处理结构的分析发生了变化，与设计结构相对应的分析部分仍然不受影响。 最后，假设有八栋房屋可用，以便可以使用两种不同的拉丁方设计结构进行实验。表 4.10 显示了将油漆分配给房屋-方向组合的一种可能分配。如果油漆具有表 4.8 中的双向处理结构，则模型由下式给出 \\[\\begin{align} y_{ijkmn}&amp;=\\mu+\\gamma_i+\\beta_j+(\\gamma\\beta)_{ij}+s_k+h_{n(k)}+d_m+\\varepsilon_{ijkmn}\\\\ i&amp;=1,2,\\,j=1,2,\\,k=1,2,\\,m=1,2,3,4,\\,n=1,2,3,4 \\tag{4.10} \\end{align}\\] 其中 \\(s_k\\) 表示方块 \\(k\\) 的效应，\\(h_{n(k)}\\) 表示方块 \\(k\\) 中房屋 \\(n\\) 的效应。模型 (4.10) 的方差分析表如表 4.11 所示。 表 4.9: 拉丁方处理结构中双向处理结构的方差分析表 x 表 4.10: 在重复拉丁方设计结构中显示单向处理结构的安排 x 注释: Square 1 和 Square 2 为用于重复拉丁方设计的两个房屋分组 表 4.11: 重复拉丁方设计结构中双向处理结构的方差分析表 x 注释: Square 为用于重复拉丁方设计的房屋分组 4.3.3 示例 4.3: 钢板 当需要在两个方向上分区 (block) 时，拉丁方设计结构非常有用，但是实验者使用的每个拉丁方安排都不是拉丁方设计结构。此示例用于演示使用拉丁方安排处理结构的后果。将两种油漆添加剂组合起来，对钢板涂漆。该实验的目的是研究油漆组合保护钢材免受高温影响的能力。每种油漆添加剂有五个水平和五个温度来检查保护能力。该实验适用于拉丁方，其中添加剂 I 的水平分配给行，添加剂 II 的水平分配给列，温度水平分配给方块内的单元格。这种排列产生 \\(25\\) 种处理组合。实验单元为 \\(25\\) 块厚 \\(0.2cm\\)、面积为 \\(1 m^2\\) 的钢板。随机化过程是将 \\(25\\) 种处理组合中的一种随机分配给 \\(25\\) 张钢板中的每一张。在这种情况下，处理结构是 \\(5^3\\) 析因安排的一部分（因为它由添加剂 I × 添加剂 II × 温度的 \\(125\\) 种可能的处理组合中的 \\(25\\) 种组成），称为拉丁方安排 (Latin square arrangement) 或拉丁方处理结构 (Latin square treatment structure). 该设计结构是完全随机设计，因为处理组合完全随机地分配给钢板。由于这是部分析因，因此每个主效应与其他两个因素的两因素交互作用和三因素交互作用部分混淆 (partially aliased)（参见 Cochran and Cox, 1957, p. 245）。为了正确分析该实验设计，必须对模型中的参数做出一些假设。通常的假设是不存在双向交互作用，也不存在三向交互作用。然而，人们应该非常小心，如果没有一些先验信息（可以来自其他实验、现有文献等）表明交互作用实际上可以忽略不计，就不要做出这样的假设。表 4.12 给出了一种这样的拉丁方安排，完全随机设计结构中拉丁方处理结构的模型为 \\[\\begin{align} y_{ijk}&amp;=\\mu+\\mathrm{AI}_i+\\mathrm{AII}_j+T_k+\\varepsilon_{ijk},\\quad(i,j,k)\\in\\mathrm{Index} \\tag{4.11} \\end{align}\\] 其中 \\(\\mathrm{AI}_i\\) 表示的添加剂 I 第 \\(i\\) 个水平的效应，\\(\\mathrm{AII}_j\\) 表示添加剂 II 第 \\(j\\) 个水平的效应，\\(T_k\\) 表示温度第 \\(k\\) 个水平的效应，\\(\\mathrm{Index}\\) 表示由实验中观测到的 \\(25\\) 种处理组合组成的指数集。 表 4.12: 拉丁方安排处理结构，其中 \\(T_i\\) 表示温度第 \\(i\\) 个水平 x 如果忽略温度水平的应用，则得到的数据表是完全随机设计结构中双向处理结构的数据表，如表 4.13 所示。该双向处理结构的方差分析表见表 4.14. 该设计包括每个处理组合的一个观测结果，因此没有可用的自由度来估计误差，因为没有经过相同处理的钢板。AI 水平和 AII 水平之间的交互作用与 \\(16\\) 个自由度有关。现在，当温度包括在结构中时，由于检验温度均值相等而产生的平方和是 AI 与 AII 交互作用平方和的一部分，如表 4.15 所示。这意味着 AI 与 AII 交互作用的一部分与温度效应相同，或者说，与温度相关的四个自由度与此交互作用相关的四种自由度混淆 (aliased). 同样，与 AI 效应相关联的四个自由度与 AII 和温度交互作用的四个自由度混淆，与 AII 效应相关的四个自由度与 AI 和温度交互作用的四个自由度混淆。表 4.16 中给出了使用模型 (4.11) 的拉丁方处理结构的方差分析表。使用术语“残差” (residual) 而不是“误差” (error)，因为相应的平方和涉及误差加上可能不为零的任何交互作用效应。如果零交互作用的假设不正确，那么残差均方将过大，由此产生的 \\(F\\) 检验将过小。因此，如果实验中存在交互作用，就无法发现，并且任何其他可检测的处理效应都可能被掩盖。 表 4.13: 拉丁方安排中添加剂 I 水平和添加剂 II 水平的双向处理结构，忽略了温度水平 x 表 4.14: 拉丁方安排双向处理结构部分的方差分析表 x 表 4.15: 拉丁方安排双向处理结构部分的方差分析表，从两种添加剂的交互作用中划分出温度的变异 x 表 4.16: 拉丁方安排处理结构方差分析表 x 4.3.4 示例 4.4: 氮和钾的水平 模型和结果分析由三个基本组成部分组成：i) 处理结构，ii) 设计结构，以及 iii) 误差结构。此示例演示了如何使用三个基本组件来构建模型。一位植物育种家想要研究三种水平的氮 (N) 和四种水平的钾 (K) 的组合对其新玉米品种产量的影响。他的处理结构是双向析因安排，有 \\(12\\) 种处理组合（\\(3\\) 个水平的氮 × \\(4\\) 个水平的钾）。他有三块土地用于进行实验，他将这些土地作为区组。每个区组被分为 \\(12\\) 个部分，称为“区” (plots). 每种处理组合被随机分配到每个区组内的一个区。因此，设计结构是随机完全区组设计，因为每种处理组合在每个区组中出现一次。实验的总体设计称为随机完全区组设计结构中的双向处理结构（随机完全区组设计中的区组被一些作者称为重复 (replications)；然而，我们更喜欢将它们称为区组而不是重复，以便将它们与完全随机设计结构中的重复 (replications) 区分开来。例 4.5 中的讨论描述了区组和重复之间的重要区别）。此示例的模型是 \\[\\begin{equation} y_{ijk}=\\mu_{ij}+b_{k}+\\boldsymbol{\\varepsilon}_{ijk}\\quad i=1,2,3,j=1,2,3,4,k=1,2,3 \\tag{4.12} \\end{equation}\\] 其中 \\(\\mu_{ij}\\) 是氮的第 \\(i\\) 个水平与钾的第 \\(j\\) 个水平的平均值，\\(b_k\\) 是第 \\(k\\) 个区组的效应，\\(\\varepsilon_{ijk}\\) 表示与每个区组内的区相关的随机误差。一般来说，通过将三种结构中的每一种结构的模型相加来构建一般模型 \\[\\begin{equation} Y= \\mathrm{treatment structure} + \\mathrm{design structure} + \\mathrm{error structure(s)} \\tag{4.13} \\end{equation}\\] 同样，相应的方差分析表也有三个部分。表 4.17 给出了模型 (4.13) 一般的方差分析表。表 4.18 给出了模型 (4.12) 的方差分析表。一般来说，必须考虑到可能存在一个以上的误差项。例如，裂区和重复测量模型有一个以上的误差项（见第 5 章）。 表 4.17: 一般模型的方差表分析 x 表 4.18: 随机完全区组设计结构中双向处理结构的方差分析表 x 4.3.5 示例 4.5: 区组和重复 在许多关于实验设计的教科书中，要么没有区分区组和重复，要么至少对这种区别存在混淆 (confusion)。包含这组示例是为了演示两个概念之间的差异，并说明处理结构与设计结构的组合可以产生实验的多个总体设计。假设研究人员想使用一个设计结构来研究单向处理结构中四种处理的效应，该设计结构有六个尺寸为二的区组（每个区组只有两个同质的实验单元）。在这种情况下，所需的设计结构是不完全区组设计。如果有足够的区组，使得每个处理对都可以在一个区组中同时进行相同次数，那么就可以使用均衡不完全区组设计结构 (Cochran and Cox, 1957). 例如，如表 4.19 所示，可以将四种处理方式分配给区组。在这种情况下，设计结构中有六个区组，每个处理重复三次。此示例用于指出区组和重复的概念是不同的，并强调区组和重复应始终保持分离。区组和重复仅在随机完全区组设计结构的情况下是等价的，其中每个处理在每个区组内观测一次且仅观测一次。不完全区组设计结构的随机化过程包括为区组编号分配区组，然后将分配给该区组的两个处理随机分配给该区组内的两个实验单元。对于表 4.19 中的示例，设计结构与六个区组相关联（见表 4.19 ），而不与由于分配过程恰好发生的三次重复相关联。表 4.19 安排的模型为 \\[\\begin{equation} y_{ij}=\\mu_i+b_j+\\boldsymbol{\\varepsilon}_{ij},\\quad\\mathrm{for~}(i,j)\\in\\mathrm{Index} \\tag{4.14} \\end{equation}\\] [^connected block-treatment df]: 原文：The degrees of freedom associated with this connected block–treatment arrangement are computed from the degrees of freedom associated with the block by treatment interaction as if all combinations were observed minus the number of empty cells. 其中 \\(\\mathrm{Index}=\\{(A, 1), (B, 1), (A, 2), (C, 2), (A, 3), (D, 3), (B, 4), (C, 4), (B, 5), (D, 5), (C, 6), (D, 6)\\}\\)，且对子 \\((i,j)\\) 只能取如索引集所示观测到的处理 × 区组组合的值。表 4.20 给出了模型 (4.14) 的方差分析表。与这种相连的区组-处理 (connected block-treatment) 安排相关的自由度是如此计算的：与区组处理交互作用相关的自由度（就好像观测到了所有组合）减去空单元格的数量[^connected block-treatment df]。表 4.21 显示了观测到的区组-处理组合（用 “\\(X\\)” 表示）。有六个区组和四个处理，因此如果所有组合都存在，则区组处理交互作用将基于 \\((6-1)(4-1)=15\\) 个自由度。有 \\(12\\) 个单元格缺失，因此与误差项相关的自由度为 \\(15-12=3\\). 表 4.19: 将四种处理分配到两个实验单元的六个区组的第一种分配：提供均衡不完全区组设计结构 x 表 4.20: 表 4.19 中的均衡不完全区组设计结构的方差分析表 x 表 4.21: 区组与处理的双向结构，其中 \\(X\\) 表示观测到的组合，被填充和空缺的各有 \\(12\\) 个单元格 x 表 4.22 包含第二种分配模式，用于将四种处理分配给六个尺寸为二的区组。处理 \\(A\\) 出现在所有区组中并重复六次。处理 \\(B,C,D\\) 出现在两个区组中且每个区组提供两次重复。模型（4.14）可用于描述此数据，其中索引集为 \\[\\mathrm{Index}=\\{(A, 1), (B, 1), (A, 2), (C, 2), (A, 3), (D, 3), (A, 4), (B, 4), (A, 5), (C, 5), (A, 6), (D, 6)\\}\\] 表 4.22: 将四种处理分配给两个实验单元的六个区组，第二种分配：提供不均衡不完全区组设计结构 x 表 4.20 中的方差分析表也适用于表 4.22 中的安排。如果希望将所有四种处理相互比较，即检验 \\(\\mu_A = \\mu_B = \\mu_C = \\mu_D\\)，则表 4.19 中的安排是最优的（使用 D-最优准则；St. John and Draper, 1975）。如果希望将处理 \\(A\\) 与其他三种处理进行比较，即检验 \\(\\mu_A = \\mu_B,\\mu_A = \\mu_C,\\mu_A = \\mu_D\\)，则表 4.22 中的安排是最优的。 表 4.23 给出了将四种处理分配到六个区组的第三种方法。将处理分为两组，其中 \\(A\\) 和 \\(B\\) 一起出现在三个区组中，处理 \\(C\\) 和 \\(D\\) 一起出现在三个区组中。处理 \\(A\\) 不与处理 \\(C\\) 或 \\(D\\) 的同时出现在一个区组中。处理和区组之间的结构不相连 (not connected)，因为处理分为这两组。定义一个新的变量“组” (group) 来表示两组处理。两组之间的比较是区组 \\(1,3,5\\) 的平均值与区组 \\(2,4,6\\) 的平均值之间的比较，或者说是区组间比较 (between-block comparisons). 处理 \\(A\\) 与处理 \\(B\\) 之间的比较以及处理 \\(C\\) 与处理 \\(D\\) 之间的比较属于区组内比较 (within-block comparisons). 对于处理 \\(A\\) 和处理 \\(B\\)，处理与区组交互作用的自由度为二。同样，对于处理 \\(C\\) 和处理 \\(D\\)，处理与区组交互作用的自由度也为二。误差平方和是将这两个处理与区组交互作用的平方和（及其自由度）合并得到的。表 4.23 中的安排的方差分析表见表 4.24。区组的平方和分为组的平方和和组内嵌套的区组的平方和。各组的平方和作为误差以检验假设 \\(\\mu_A + \\mu_B = \\mu_C + \\mu_D\\)），该假设具有由处理产生的一个自由度。两组处理与区组混杂 (confounded) 在一起；也就是说，如果两组均值之间存在差异，则不知道是由于处理集之间的差异还是由于两组区组之间的差异造成的。混杂的概念与混淆 (aliasing) 的概念类似，但混淆涉及两个（或多个）项无法区分，其中两个项都来自处理结构，而混杂涉及两个项无法区分，其中一项来自处理结构，另一项来自设计结构。 表 4.23: 将四种处理分配给两个实验单元的六个区组的第三种分配：提供不相连不完全区组设计结构 x 表 4.24: 表 4.23 中的不完全区组设计方差分析表 x 表 4.19、4.22 和 4.23 中三种设计之间的差异在于如何将处理分配给区组。请记住，所有三种设计的设计结构和处理结构都是相同的，因此设计结构和处理结构并不描述实验的总体设计。还必须指定将处理结构中的处理随机分配到设计结构中的实验单元的方法。 4.3.6 示例 4.6：行区组和列区组 区组可以通过多种方式出现，拉丁方设计结构是一种同时存在行区组和列区组的设计。拉丁方设计结构有多种变化，其中行比处理或多或少（或者列比处理或多或少）（Cochran and Cox, 1957）。本示例由按行和列划分的实验单元组成，其中每行和列的交集包含多个实验单元。处理结构是双向的，因子 \\(A\\) 有两个水平，因子 \\(B\\) 有两个水平，从而产生四种处理组合。共有 \\(24\\) 个实验单元，排列成三列两行，每行列组合包含 \\(4\\) 个实验单元。将四种处理组合随机分配给每个行列组内的四个实验单元。表 4.25 显示了实验单元的处理组合（非随机）的分配。该设计结构本质上由六个尺寸为四的区组组成，但评估行区组之间和列区组之间的变异性可能很有趣，因此可以构建一个模型以包含这些因素： \\[\\begin{align} y_{ijkm}&amp;=\\mu+\\alpha_i+\\beta_j+(\\alpha\\beta)_{ij}+r_k+c_m+(rc)_{km}+\\varepsilon_{ijkm}\\\\ i&amp;=1,2,j=1,2,k=1,2,m=1,2,3 \\tag{4.15} \\end{align}\\] 其中 \\(\\mu + \\alpha_i + \\beta_j + (\\alpha\\beta)_{ij}\\) 表示因子 \\(A\\) 和 \\(B\\) 的主效应和交互作用，\\(r_k\\) 表示行区组效应，\\(c_m\\) 表示列区组效应，\\((rc)_{km}\\) 表示行区组和列区组之间的交互作用，\\(\\varepsilon_{ijkm}\\) 表示实验单元误差。模型 (4.15) 对应的方差分析表见表 4.26. 分析可能只涉及六个区组，并且可以合并由于行区组、列区组及其交互作用而产生的平方和，从而为设计结构提供五个自由度。通过设计结构与处理结构的交互作用来获得误差平方和；即通过合并 \\(A\\) × 行区组、\\(A\\) × 列区组、\\(A\\) × 行区组 × 列区组、\\(B\\) × 行区组、\\(B\\) × 列区组、\\(B\\) × 行区组 × 列区组、\\(A\\) × \\(B\\) × 行区组、\\(A\\) × \\(B\\) × 列区组，以及 \\(A\\) × \\(B\\) × 行区组 × 列区组的平方和。 表 4.25: 在设计结构中使用行区组和列区组，在处理结构中使用双向安排的设计（非随机形式） x 表 4.26: 双向处理结构的行-列设计结构方差分析表 x 通过结合各种设计结构和处理结构，还有许多其他方法可以构建设计实验。希望以上例子将使实验者能够构建所需的设计实验，构建适当的模型，并进行相应的分析。 4.4 结束语 本章介绍了实验者在设计和分析实验时可以使用的概念和方法。还介绍了设计良好的实验的基本概念。所有设计的实验都包括两个基本特征：处理结构和设计结构。这些概念通常不会在许多其他统计分析书籍中使用。了解设计实验的这两个特征之间的差异将有助于数据分析师为他们的实验选择适当的分析。在必须不与处理结构中的因素发生交互的情况下讨论了区组因素的选择。最后，必须能够识别何时有真正的重复，何时只有子样本。 4.5 练习 参考文献 Kempthorne, O. (1952). Design and Analysis of Experiments. John Wiley and Sons, New York, NY. Milliken, G. A. and Johnson, D. E. (2002). Analysis of Messy Data, Vol 3: Analysis of Covariance. Chapman and Hall/CRC, Boca Raton, FL. Cobb, G. W. (1997). Introduction to Design and Analysis of Experiments. Springer, New York, NY. Cochran, W. G., and Cox, G. M. 1957. Experimental Design. 2nd ed. John Wiley and Sons, New York, NY. Davies, O. L. 1954. Design and Analysis of Industrial Experiments. Oliver and Boyd, London, UK. Federer, W. T. (1995). Experimental Design. Macmillan, New York, NY. Hicks, Charles R. (1993). Fundamental Concepts in the Design of Experiments, 4th ed. W.B. Saunders Co., Philadelphia, PA. John, P. W. M. (1971). Statistical Design and Analysis of Experiments. John Wiley and Sons, New York, NY. Kirk, R. E. (1968). Experimental Design: Procedures for the Behavioral Sciences. Brooks/Cole, Belmont, CA. Cornell, J. A. (1990). Experiments with Mixtures: Designs, Models and Analysis of Mixture Data. John Wiley and Sons, New York, NY. Anderson, V. L. and McLean, R. A. (1974). Design of Experiments: A Realistic Approach. Marcel Dekker, New York, NY. Box, G. E. P., Hunter, W. G., and Hunter, J. S. (1978). Statistics for Experimenters. John Wiley and Sons, New York, NY. Laundsby, R. G. and Weese, D. L. (1993). Straight Talk on Designing Experiments: An Introductory Design of Experiments Reference Handbook. Launsby Consulting, Colorado Springs, CO. Lentner, M. and Bishop, T. (1986). Experimental Design and Analysis. Valley Book Company, Blacksburg, VA. Meed, R. (1988). The Design of Experiments: Statistical Principles for Practical Application. Cambridge University Press, Cambridge, UK. Montgomery, D. C. (1991). Design and Analysis of Experiments, 3rd edn. John Wiley and Sons, New York, NY. Winer, B. J. (1971). Statistical Principles in Experimental Design, 2nd ed. McGraw-Hill, New York, NY. St John, R. C. and Draper, N. R. (1975). D-Optimality for regression designs: A review. Technometrics, 17, 15. 也可译作 “排”，即图 4.1 中的竖线。↩︎ 这里的 \\(\\mu\\) 还不足以称为“总体平均值”，严谨地说是“截距”，如果对模型其他参数施加约束才可称为“总体平均值”。更多的讨论详见 Stroup (2012)，例如前言的 xxi 页以及 P.54 的 Note.↩︎ "],["chap5.html", "第 5 章 多水平设计：裂区、裂条、重复测量及组合 5.1 实验单元的尺寸识别——四种基本设计结构", " 第 5 章 多水平设计：裂区、裂条、重复测量及组合 咨询统计学家并不总是有机会设计他们必须帮助构建适当分析的实验。相反，统计学家必须首先确定研究人员使用的设计实验的类型。识别过程中的第一步也是最重要的一步是确定是否使用了不止一种尺寸的实验单元，如果使用了，则识别每种尺寸的试验单元。正如在本节中显而易见的那样，每种尺寸的实验单元都将具有相关的设计结构和处理结构。在识别出不同尺寸的实验单元后，可以通过组合用于描述与每个尺寸的实验单位相对应的设计结构和处理结构的模型来构建用于进行适当分析的模型。 5.1 实验单元的尺寸识别——四种基本设计结构 涉及一种以上尺寸的实验单元的设计结构被称为多水平设计结构 (multilevel designs structures )，并且包括裂区 (split-plot) 类型的设计结构、裂条区 (strip-plot) 设计结构、重复测量 (repeated measures) 设计结构、分层 (hierarchical) 或嵌套 (nested) 类型的设计构造以及涉及上述各种组合的设计结构。重复测量和裂区类型的设计结构是相似的，尽管用于进行分析的假设可能不同。裂区和裂条区设计结构是从农业科学发展而来的，但在包括工程和制造业在内的许多其他学科中都有使用，第 ?? 章和第 ?? 章讨论了它们的分析。重复测量设计在社会科学和生物科学中广泛使用，但在大多数领域都适用，因为随着时间的推移，评估处理效应是有意义的，其分析见第 ?? - ?? 章。嵌套处理结构不同于重复测量和裂区设计使用的处理结构，嵌套处理结构在第 ?? 章中进行了描述。 有四种基本的设计结构，而最复杂的设计结构是这些结构的组合。四种基本设计结构是完全随机设计结构 (completely randomized design structure)、随机完全区组设计结构 (randomized complete block design structure)、裂区设计结构 (split-plot design structure) 和裂条区设计结构 (strip-plot design structure). 这些基本设计结构中的每一个都有自己的分析，具有计算所需误差平方和的独特过程。本节介绍了基本设计结构以及计算误差平方和所需的过程。讨论中使用了一个例子，其中处理结构是双向的，一个因素有两个水平，而另一个因素有三个水平，设计结构涉及 \\(18\\) 个实验单元。 该实验包括评估烘烤后纸杯蛋糕的体积，其中有三种配方和两种烹饪温度；因此，处理结构由三种配方和两种烹饪温度的六种组合组成。希望每种治疗组合重复 \\(3\\) 次；因此需要烘烤 \\(18\\) 个纸杯蛋糕。图 ?? 中的图用于演示使用完全随机设计结构的过程。该过程是将处理结构中的六种处理组合完全随机分配给设计结构中的 \\(18\\) 个实验单元（纸杯蛋糕）。箭头表示每个处理组合分配给三个纸杯蛋糕。通常，该过程是一次制作一个纸杯蛋糕，因此纸杯蛋糕混合和烘焙的顺序对应于实验单元。完全随机设计结构是通过混合一批给定的配方，填写一个纸杯蛋糕表格，然后在设定为特定温度的烤箱中烘烤纸杯蛋糕来完成的。每个纸杯蛋糕都必须由自己的批次制成，也就是说，每批次蛋糕配方只有一个纸杯蛋糕，每个纸杯蛋糕必须在设定的特定温度下在烤箱中自行烘焙。 该过程需要使用 \\(18\\) 批蛋糕混合物和 \\(18\\) 次使用一个或多个烤箱来烘焙纸杯蛋糕。与完全随机化设计结构相关的误差是根据相同处理的纸杯蛋糕之间的变异性计算的。根据温度组合，每个配方中有三个纸杯蛋糕，因此三个纸杯饼体积的变化提供了两个测量纸杯蛋糕误差的自由度。人们应该检验六种处理组合方差的相等性（见第 2 章），如果可能的话，将六种处理组的误差估计值汇总在一起，以提供 \\(12\\) 个误差自由度，用于测量相同处理的纸杯蛋糕之间的变异性。可用于描述纸杯蛋糕体积的模型为 \\[y_{ijk}=\\mu+\\tau_{i}+\\beta_{j}+(\\tau\\beta)_{ij}+\\varepsilon_{ijk},\\quad i=1,2,j=1,2,3,\\mathrm{and}\\,k=1,2,3\\] 其中 \\(y_{ijk}\\) 表示用第 \\(j\\) 个配方制作并在第 \\(i\\) 个温度下烘焙的第 \\(k\\) 个纸杯蛋糕的体积，\\(\\mu\\) 表示总平均值，\\(\\tau_i\\) 表示第 \\(i\\) 个温度的效应，\\(\\beta_j\\) 表示第 \\(j\\) 个配方的效应，\\((\\tau\\beta)_{ij}\\) 是配方于温度的交互作用，以及 \\(\\varepsilon_{ijk}\\) 表示与批次、批次内的纸杯蛋糕以及不同烤箱烘烤的差异性。表 ?? 包含了完全随机化设计结构中双向处理结构模型的方差分析表，其中根据实验单元或相同处理的纸杯蛋糕的变异性计算了 \\(12\\) 个自由度。与处理结构相关的自由度为五 个，与设计结构相关的自由度为 \\(12\\) 个，所有自由度均分配给误差项。表 ?? 中标有 \\(EMS\\) 的列给出了方差分析表各行的预期均方形式。函数 \\(\\phi^2(\\tau),\\phi^2(\\beta),\\phi^2(\\tau\\beta)\\) 分别表示温度主效应均值、配方主效应均值和交互作用效应的二次函数。当相应的效应不存在时，这些函数是非负的且等于零。在本章的其余部分中可以使用类似的解释。 "],["chap29.html", "第 6 章 交叉设计分析 6.1 定义，假设和模型 6.2 两时期/两处理交叉设计 6.3 具有两个以上时期的交叉设计 6.4 具有两种以上处理的交叉设计 6.5 小结", " 第 6 章 交叉设计分析 交叉设计 (crossover design) 用于比较按序列给予实验单元（如动物或人）的处理。也就是说，每个实验单元按照预定的序列进行每种处理。交叉设计的目的是通过观察应用于同一实验单元的处理，消除比较处理时实验单元之间的差异。 尽管交叉设计消除了处理比较中实验单元之间的差异，但其他问题可能会以延滞 (carryover) 或残余 (residual) 效应的形式出现。例如，当首先给予处理 \\(A\\) 并且在应用处理 \\(B\\) 时其效应尚未消失，就会出现延滞效应。如果 \\(A\\) 的延滞效应干扰了个体对处理 \\(B\\) 的响应（或正向或负向），那么处理 \\(A\\) 对处理 \\(B\\) 有延滞效应。 交叉设计模型必须包含序列效应、时期效应、处理效应、延滞效应、实验单元误差项和时间间隔误差项。第一节讨论了一般模型及其假设，最后两节分别讨论了两个时期和两个以上时期两个处理的交叉设计。 在一般的交叉设计中，比较 \\(t\\) 个处理，其中在每个实验单元上观察每个处理；也就是说，这些处理以特定的序列应用于实验单元。实验者构建 \\(t\\) 个处理的 \\(s\\) 个序列，并将实验单元随机分配给第 \\(i\\) 个序列。表 6.1 包含一组可应用于实验单元的三种处理的序列。将序列分配给个体（可能的实验单元）意味着个体是序列的实验单元；将处理分配给时间间隔意味着该时间间隔是处理的实验单元。 表 6.1: 对实验单元应用三种处理（A、B 和 C）的可能序列集 x 6.1 定义，假设和模型 描述在第 \\(i\\) 个时期内分配给第 \\(j\\) 个序列的第 \\(\\ell\\) 只动物的观测结果的响应的模型为 \\[\\begin{align} y_{ijk\\ell}&amp;=\\mu+S_i+\\delta_{i\\ell}+P_j+T_k+\\varepsilon_{ijk\\ell}\\\\i&amp;=1,2,\\ldots,s,j=1,2,\\ldots,p,k=1,2,\\ldots,t,\\mathrm{~and~}\\ell=1,2,\\ldots,n_j \\tag{6.1} \\end{align}\\] 在上述模型中，\\(S_i\\) 是第 \\(i\\) 个序列的效应，\\(P_j\\) 是第 \\(j\\) 个时期的效应，\\(T_k\\) 是第 \\(k\\) 个处理的效应，其中 \\(k\\) 的值由第 \\(i\\) 个序列和第 \\(j\\) 个时期的 \\(i,j\\) 组合确定。在理想条件下，将有 \\(\\delta_{i\\ell}\\sim i.i.d.N(0,\\sigma_{\\delta}^{2}),\\varepsilon_{ijk\\ell}\\sim i.i.d.N(0,\\sigma_{\\varepsilon}^{2})\\)，并且所有 \\(\\delta_{i\\ell}\\) 和 \\(\\varepsilon_{ijk\\ell}\\) 彼此独立。 误差项 \\(\\delta_{i\\ell}\\) 和 \\(\\varepsilon_{ijk\\ell}\\) 的理想条件对于进行适当的分析非常重要。由于实验单元是随机分配给序列的，因此适当的假设是 \\(\\delta_{i\\ell}\\sim i.i.d.N(0,\\sigma_{\\delta}^{2})\\). 由于 \\(\\varepsilon_{ijk\\ell}\\) 是时间间隔的误差，并且在某种意义上是重复测量误差，因此这些误差可能不是独立分布的。上面给出的理想条件相当于假设时间时期误差的协方差阵满足复合对称条件（参见 ?? 节）。在这种情况下，可以使用通常的独立的 \\(\\delta_{i\\ell}\\) 和 \\(\\varepsilon_{ijk\\ell}\\) 方差分析方法来分析观测数据。复合对称性假设对于两时期设计是必须满足的，对于许多三时期设计也可能是满足的。时间序列误差结构可能更适合具有三个或更多时期的交叉设计，并且应该使用第 ?? 章中讨论的方法。 两时期/两处理交叉设计 (two-period/two-treatment crossover design) 在 6.2 节中描述，具有两个以上处理或两个以上时期的设计在 6.3 和 6.4 节中描述。 6.2 两时期/两处理交叉设计 考虑具有两个处理序列（\\(AB\\) 和 \\(BA\\)）的两时期/两处理交叉设计，其中 \\(AB\\) 意味着处理 \\(A\\) 在第 \\(1\\) 时期分配到一个实验单元，处理 \\(B\\) 在第 \\(2\\) 时期分配到同一实验单元。同样，\\(BA\\) 序列意味着处理 \\(B\\) 在时期 \\(1\\) 被分配到实验单元，处理 \\(A\\) 在时期 \\(2\\) 被分配给相同的实验单元。还假设有 \\(n_1\\) 个实验单元分配给 \\(AB\\) 序列，且有 \\(n_2\\) 个实验单元分配给 \\(BA\\) 序列。令观测到的响应的模型为 \\[\\begin{align} y_{ijk\\ell}&amp;=\\mu+S_i+\\delta_{i\\ell}+P_j+T_k+\\varepsilon_{ijk\\ell}\\\\i&amp;=AB,BA,~j=1,2,~k=A,B,~\\mathrm{and}~\\ell=1,2,\\ldots,n_i \\tag{6.2} \\end{align}\\] 其中下标 \\(k\\) 的值由序列 \\(i\\) 和时期 \\(j\\) 的组合确定。令 \\[\\mu_{ij}=\\mu+S_i+P_j+T_k\\] 是对应于第 \\(i\\) 个序列和第 \\(j\\) 个时期的单元均值的模型。令 \\(\\hat \\mu_{ij}\\) 为第 \\((i,j)\\) 单元格中所有观测值的观测均值。注意到 \\[\\begin{align} \\hat \\mu_{11}=\\bar y_{11\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+P_1+T_A\\\\ \\hat \\mu_{12}=\\bar y_{12\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+P_2+T_B\\\\ \\hat \\mu_{21}=\\bar y_{21\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+P_1+T_B\\\\ \\hat \\mu_{22}=\\bar y_{22\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+P_2+T_A \\tag{6.3} \\end{align}\\] 从式 (6.3) 可看出 \\[\\begin{align} \\hat {\\bar\\mu}_{1\\cdot}&amp;=\\frac{\\bar y_{11\\cdot\\cdot}+\\bar y_{12\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+\\bar P_\\cdot+\\frac{T_A+T_B}{2}\\\\ \\hat {\\bar\\mu}_{2\\cdot}&amp;=\\frac{\\bar y_{21\\cdot\\cdot}+\\bar y_{22\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+\\bar P_\\cdot+\\frac{T_A+T_B}{2}\\\\ \\hat {\\bar\\mu}_{\\cdot 1}&amp;=\\frac{\\bar y_{11\\cdot\\cdot}+\\bar y_{21\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+\\bar S_{\\cdot}+\\bar P_1+\\frac{T_A+T_B}{2}\\\\ \\hat {\\bar\\mu}_{\\cdot 2}&amp;=\\frac{\\bar y_{12\\cdot\\cdot}+\\bar y_{22\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+\\bar S_{\\cdot}+\\bar P_2+\\frac{T_A+T_B}{2} \\tag{6.4} \\end{align}\\] 另请注意，两个序列的均值差 \\(\\hat {\\bar\\mu}_{1\\cdot}-\\hat {\\bar\\mu}_{2\\cdot}\\) 估计 \\(S_{AB} - S_{BA}\\)，即两个序列参数之差。时期 \\(1\\) 和时期 \\(2\\) 的均值差 \\(\\hat {\\bar\\mu}_{\\cdot1}-\\hat {\\bar\\mu}_{\\cdot2}\\) 估计 \\(P_1 - P_2\\). 最后，为了估计两种处理之差 \\(T_A - T_B\\)，可以使用 \\((\\hat {\\bar\\mu}_{11}-\\hat {\\bar\\mu}_{12}-\\hat {\\bar\\mu}_{21}+\\hat {\\bar\\mu}_{22})/2\\) 。在理想条件下，可以证明 \\[\\begin{equation} \\begin{bmatrix}\\hat{\\mu}_{11}\\\\\\hat{\\mu}_{12}\\\\\\hat{\\mu}_{21}\\\\\\hat{\\mu}_{22}\\end{bmatrix}\\thicksim N\\left(\\begin{bmatrix}\\mu_{11}\\\\\\mu_{12}\\\\\\mu_{21}\\\\\\mu_{22}\\end{bmatrix},\\,\\begin{bmatrix}\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\delta^2}{n_1}&amp;0&amp;0\\\\\\\\\\frac{\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\epsilon^2+\\sigma_\\delta^2}{n_1}&amp;0&amp;0\\\\\\\\0&amp;0&amp;\\frac{\\sigma_\\epsilon^2+\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\delta^2}{n_2}\\\\\\\\0&amp;0&amp;\\frac{\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\epsilon^2+\\sigma_\\delta^2}{n_2}\\end{bmatrix}\\right) \\tag{6.5} \\end{equation}\\] 从式 (6.5) 可证明 \\[\\begin{aligned}&amp;\\hat{\\bar{\\mu}}_{1\\cdot}-\\hat{\\bar{\\mu}}_{2\\cdot}\\thicksim N\\bigg[S_{AB}-S_{BA},\\bigg(\\frac{\\sigma_{\\varepsilon}^{2}+2\\sigma_{\\delta}^{2}}{2}\\bigg)\\bigg(\\frac{1}{n_{1}}+\\frac{1}{n_{2}}\\bigg)\\bigg]\\\\&amp;\\hat{\\bar{\\mu}}_{\\cdot1}-\\hat{\\bar{\\mu}}_{\\cdot2}\\thicksim N\\bigg[P_1-P_2,\\frac{\\sigma_{\\varepsilon}^{2}}{2}\\bigg(\\frac{1}{n_1}+\\frac{1}{n_2}\\bigg)\\bigg]\\\\&amp;\\frac{\\hat\\mu_{11}-\\hat\\mu_{12}-\\hat\\mu_{21}+\\hat\\mu_{22}}{2}\\thicksim N\\bigg[T_A-T_B,\\frac{\\sigma_{\\varepsilon}^{2}}{2}\\bigg(\\frac{1}{n_1}+\\frac{1}{n_2}\\bigg)\\bigg]\\end{aligned}\\] 与本节讨论的两期/两处理交叉设计相对应的方差分析表的形式如表 6.2 所示。用于检验 \\(H_0: T_A = T_B\\) 的 \\(F\\) 统计量由 \\(F = TMS/WSEMS\\) 给出，其中 \\(TMS\\) 是表 6.2 中的处理均方 (treatment mean square)，\\(WSEMS\\) 是个体内误差均方 (within subject error mea square). 若 \\(F&gt;F_{\\alpha,1,n_1+n_2-2}\\) 则拒绝 \\(H_0\\). \\(T_A-T_B\\) 的 \\((1-\\alpha)100\\%\\) 置信区间由 \\[\\frac{\\hat{\\mu}_{11}-\\hat{\\mu}_{12}-\\hat{\\mu}_{21}+\\hat{\\mu}_{22}}2\\pm t_{\\alpha,v}\\sqrt{\\frac{\\hat\\sigma_{\\varepsilon}^2}2{\\left(\\frac1{n_1}+\\frac1{n_2}\\right)}}\\] 给出。其中 \\(v=n_1+n_2-n\\) 且 \\(\\hat\\sigma_\\varepsilon^2=WSEMS\\). 作为一个例子，考虑 Grizzle (1965) 使用的数据。数据如表 6.3 所示。使用表 6.4 中所示的命令通过 SAS®-GLM 程序分析数据。 表 6.2: 两期/两处理交叉实验的方差分析表 x 表 6.3: Grizzle (1965) 数据 Seq Period Trt Person Y AB 1 A 11 0.2 AB 2 B 11 1 AB 1 A 12 0 AB 2 B 12 -0.7 AB 1 A 13 -0.8 AB 2 B 13 0.2 AB 1 A 14 0.6 AB 2 B 14 1.1 AB 1 A 15 0.3 AB 2 B 15 0.4 AB 1 A 16 1.5 AB 2 B 16 1.2 BA 1 B 21 1.3 BA 2 A 21 0.9 BA 1 B 22 -2.3 BA 2 A 22 1 BA 1 B 23 0 BA 2 A 23 0.6 BA 1 B 24 -0.8 BA 2 A 24 -0.3 BA 1 B 25 -0.4 BA 2 A 25 -1 BA 1 B 26 -2.9 BA 2 A 26 1.7 BA 1 B 27 -1.9 BA 2 A 27 -0.3 BA 1 B 28 -2.9 BA 2 A 28 0.9 表 6.4: 用于分析表 6.3 中数据的 SAS-GLM 代码 x TITLE ‘CRSOVER EXAMPLE 29.1 – A TWO PERIOD/TWO TREATMENT DESIGN’; DATA GRIZ; INPUT SEQ $ PERIOD TRT $ PERSON Y; LINES; AB 1 A 11 0.2 AB 2 B 11 1.0 AB 1 A 12 0.0 AB 2 B 12 -0.7 AB 1 A 13 -0.8 AB 2 B 13 0.2 AB 1 A 14 0.6 AB 2 B 14 1.1 AB 1 A 15 0.3 AB 2 B 15 0.4 AB 1 A 16 1.5 AB 2 B 16 1.2 BA 1 B 21 1.3 BA 2 A 21 0.9 BA 1 B 22 -2.3 BA 2 A 22 1.0 BA 1 B 23 0.0 BA 2 A 23 0.6 BA 1 B 24 -0.8 BA 2 A 24 -0.3 BA 1 B 25 -0.4 BA 2 A 25 -1.0 BA 1 B 26 -2.9 BA 2 A 26 1.7 BA 1 B 27 -1.9 BA 2 A 27 -0.3 BA 1 B 28 -2.9 BA 2 A 28 0.9 ; PROC GLM; TITLE2 ‘STATISTICAL ANALYSIS USING SAS-GLM’; CLASSES SEQ TRT PERIOD PERSON; MODEL Y=SEQ PERSON(SEQ) TRT PERIOD; LSMEANS TRT/PDIFF; RANDOM PERSON(SEQ); RUN; 表 6.5 显示了模型的方差分析，并给出了 \\(WSEMS\\) 的值 \\(\\hat \\sigma_\\varepsilon^2 = 1.245\\). 表 6.6 给出了 \\(H_0:T_A = T_B\\) 的检验： 以及个体间误差均方 \\(BSEMS = \\hat \\sigma_{\\varepsilon} ^2 + 2\\hat \\sigma_{\\delta}^2 = 1.001\\). \\(H_0\\) 观察到的显著性水平为 \\(\\hat \\alpha = 0.1165\\). 表 6.7 中显示了处理 \\(A\\) 和 \\(B\\) 的最小二乘均值，以及比较处理 \\(A\\) 和处理 \\(B\\) 时观察到的显著性水平 \\(\\hat \\alpha = 0.1165\\)。方差分析表中各行的预期均方如表 6.8 所示。如果想求出双向序列×时期的估计值，可以使用表 6.9 中的命令。双向均值如表 6.10 所示。 表 6.5: 具有个体内误差均方的模型方差分析 x 表 6.6: 表 6.3 中数据的 III 型方差分析表 x 表 6.7: 处理主效应均值 x 表 6.8: 表 6.3 中数据的预期均方表 x 表 6.9: 用于分析表 6.3 中数据的 SAS-GLM 代码 x PROC GLM; TITLE2 ‘STATISTICAL ANALYSIS USING SAS-GLM’; CLASSES SEQ TRT PERIOD PERSON; MODEL Y=SEQ PERSON(SEQ) PERIOD SEQPERIOD; LSMEANS SEQPERIOD; RANDOM PERSON(SEQ); RUN; 表 6.10: 序列×时期均值 x 表 6.3 中的数据也可以使用表 6.11 中所示的命令通过 SAS Mixed 程序进行分析。由于 GLM 分析中受试者间误差均方小于受试者内误差均方，因此结果与 GLM 分析获得的结果略有不同。因此，Mixed 程序将与个体相对应的方差分量估计为 \\(\\hat \\sigma _\\delta ^2 = 0\\)，而 GLM 将使用矩准则方法估计相同的方差分量： \\[\\hat\\sigma_\\delta^2=\\frac{BSEMS-WSEMS}2=\\frac{1.005-1.245}2=\\frac{-0.240}2=-0.120\\] 目前未给出使用表 6.11 中的代码的结果，感兴趣的读者需要运行表 6.11 中的代码。 表 6.11: 用于分析表 6.3 中数据的 SAS-Mixed 代码 x PROC MIXED; TITLE2 ‘STATISTICAL ANALYSIS USING SAS-MIXED’; CLASSES SEQ TRT PERIOD PERSON; MODEL Y=SEQ PERIOD TRT; LSMEANS TRT/PDIFF; RANDOM PERSON(SEQ); RUN; PROC MIXED; TITLE2 ‘STATISTICAL ANALYSIS USING SAS-MIXED’; CLASSES SEQ TRT PERIOD PERSON; MODEL Y=SEQ PERIOD SEQPERIOD; LSMEANS SEQPERIOD; RANDOM PERSON(SEQ); RUN; 上述分析假设第一时期的处理不会影响第二时期的观测结果。接下来考虑存在延滞的情况。当存在延滞时，可以假设 \\[\\begin{align} \\hat \\mu_{11}=\\bar y_{11\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+P_1+T_A\\\\ \\hat \\mu_{12}=\\bar y_{12\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+P_2+T_B+\\lambda_A\\\\ \\hat \\mu_{21}=\\bar y_{21\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+P_1+T_B\\\\ \\hat \\mu_{22}=\\bar y_{22\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+P_2+T_A+\\lambda_B \\tag{6.6} \\end{align}\\] 其中 \\(\\lambda_A\\) 是序列 \\(AB\\) 的参数，对应于从时期 \\(1\\) 施加的处理 \\(A\\) 到时期 \\(2\\) 的延滞，而 \\(\\lambda_B\\) 是序列 \\(BA\\) 的参数，对应于从时期 \\(1\\) 施加的处理 \\(B\\) 到时期 \\(2\\) 的延滞。 从式 (6.6) 可看出 \\[\\begin{align} \\hat {\\bar\\mu}_{1\\cdot}&amp;=\\frac{\\bar y_{11\\cdot\\cdot}+\\bar y_{12\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+\\bar P_\\cdot+\\frac{T_A+T_B}{2}+\\frac{\\lambda_A}{2}\\\\ \\hat {\\bar\\mu}_{2\\cdot}&amp;=\\frac{\\bar y_{21\\cdot\\cdot}+\\bar y_{22\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+\\bar P_\\cdot+\\frac{T_A+T_B}{2}+\\frac{\\lambda_B}{2}\\\\ \\hat {\\bar\\mu}_{\\cdot 1}&amp;=\\frac{\\bar y_{11\\cdot\\cdot}+\\bar y_{21\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+\\bar S_{\\cdot}+\\bar P_1+\\frac{T_A+T_B}{2}\\\\ \\hat {\\bar\\mu}_{\\cdot 2}&amp;=\\frac{\\bar y_{12\\cdot\\cdot}+\\bar y_{22\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+\\bar S_{\\cdot}+\\bar P_2+\\frac{T_A+T_B}{2}+\\frac{\\lambda_A+\\lambda_B}{2} \\tag{6.7} \\end{align}\\] 当 \\(\\lambda_A\\ne \\lambda_B\\) 时，延滞就存在。也就是说，在无延滞的情况下，\\(\\lambda_A\\) 和 \\(\\lambda_B\\) 实际上不必等于零，它们只需要彼此相等。在 \\(\\lambda_A= \\lambda_B\\) 的情况下，\\(\\lambda_A\\) 和 \\(\\lambda_B\\) 与时期效应混淆 (confounded)，不需要将参数包括在模型中 (6.2) 中。在存在延滞的情况下，两个序列差的均值 \\(\\hat {\\bar\\mu}_{1\\cdot}-\\hat {\\bar\\mu}_{2\\cdot}\\) 估计 \\(S_{AB}-S_{BA}+[(\\lambda_A-\\lambda_B)/2]\\)。时期 \\(1\\) 和时期 \\(2\\) 差的均值 \\(\\hat {\\bar\\mu}_{\\cdot1}-\\hat {\\bar\\mu}_{\\cdot2}\\) 估计 \\(P_1-P_2+[(\\lambda_A+\\lambda_B)/2]\\) 。最后，\\((\\hat{\\mu}_{11}-\\hat{\\mu}_{12}-\\hat{\\mu}_{21}+\\hat{\\mu}_{22})/2\\) 估计 \\(T_A-T_B+[(\\lambda_A-\\lambda_B)/2]\\) 。在存在延滞的情况下，时期 \\(2\\) 的数据无助于估计两种处理的差异。当存在延滞时，必须通过 \\(\\hat \\mu_{11}-\\hat \\mu_{21}\\) 来估计 \\(T_A-T_B\\)，并且该估计仅取决于时期 \\(1\\) 的数据。还可以注意到，如果仅使用时期 \\(1\\) 的数据来估计处理效应，则时期 \\(1\\) 的模型可以简化为 \\[\\begin{equation} y_{k\\ell}=\\mu+T_k+\\varepsilon_{k\\ell}^*,~k=A,B,~\\mathrm{and~}~\\ell=1,2,\\ldots,n_i \\tag{6.8} \\end{equation}\\] 其中 \\(\\varepsilon_{k\\ell}^{*}=\\delta_{k\\ell}+\\varepsilon_{k\\ell}\\). 而且， \\[\\mathrm{Var}(\\hat{\\mu}_{11}-\\hat{\\mu}_{21})=(\\sigma_\\varepsilon^2+\\sigma_\\delta^2){\\left(\\frac1{n_1}+\\frac1{n_2}\\right)}\\] 表 6.12 显示了当存在延滞时，与两时期/两处理交叉设计相对应的方差分析表的形式。该表与表 6.2 具有相同的形式，除了预期均方列。 表 6.12: 两时期/两处理交叉实验的方差分析表 x 如果不存在延滞，那么个体被分配到哪个序列应该无关紧要。也就是说，从哲学上讲，\\(S_{AB}-S_{BA}\\) 应该等于零。因此，\\(F=SeqMS/BSEM\\) 给出的 \\(F\\) 统计量提供了是否存在延滞的测试。如果 \\(F&gt;F_{\\alpha,1,n1+n2-2}\\)，则可以得出结论，存在显著的延滞效应。需要注意的是，延滞检验是个体间的比较，因此该检验的功效不如基于个体内的比较。如果认为可能存在延滞效应，建议不要使用两时期/两处理的交叉设计。在某些情况下，实验者可能能够在交叉设计的两个阶段之间包括所谓的“洗脱” (wash-out) 阶段。洗脱期是指一段足够长的时间，以便在对实验单元进行第二种处理之前，第一时期中给予的处理的任何延滞效应将被消除或清除。同样极其重要的是，要注意在两时期/两处理交叉设计中的延滞问题在一些具有两个以上处理和/或两个以上时期的交叉设计中减少和/或消除。此类设计将在下一节中进行考虑。 作为可能存在延滞的两时期/两处理交叉实验的示例，再次考虑表 6.3 中显示的 Grizzle (1965) 数据。将使用 SAS-Mixed 程序（使用表 6.13 中显示的命令）分析数据。 表 6.13: 用于分析表 6.3 中数据的 SAS-Mixed 代码，当存在延滞时 x PROC MIXED; TITLE2 ‘STATISTICAL ANALYSIS USING SAS-MIXED’; CLASSES SEQ TRT PERIOD PERSON; MODEL Y=SEQ PERIOD TRT; LSMEANS TRT/PDIFF; RANDOM PERSON(SEQ); RUN; PROC MIXED; TITLE2 ‘STATISTICAL ANALYSIS USING SAS-MIXED’; CLASSES SEQ TRT PERIOD PERSON; MODEL Y=SEQ PERIOD SEQ*PERIOD; LSMEANS SEQ*PERIOD; ESTIMATE ‘A-B FROM PERIOD 1’ SEQ 1 -1 SEQ*PERIOD 1 0 -1 0; RANDOM PERSON(SEQ); RUN; 第一组 Mixed 命令用于获得延滞检验和处理效应检验（如果没有任何显著的延滞）。这些命令还给出了处理主效应均值，如果没有延滞，则可以使用该均值。第二组命令使用不同的 random 语句，以获得序列×时期双向均值，包括 ESTIMATE 选项，以便从时期 \\(1\\) 数据中获得处理效应估计值。 表 6.14: 固定效应检验 x 表 6.14 给出了对表 6.13 中第一组 Mixed 命令的固定效应的检验。请注意，序列效应在 \\(0.0665\\) 水平下显著，表明存在一些延滞的证据。还请注意，处理效应仅在 \\(0.1002\\) 水平下显著。 处理主效应平均值见表 6.15，该表还比较了两种处理平均值。 表 6.15: 处理均值及两种处理均值差的检验 x 表 6.16 给出了表 6.13 中第二组 Mixed 命令的固定效应检验。请注意，序列的检验与表 6.14 中给出的检验相同。还请注意，序列×时期的检验与表 6.14 中处理的检验相同。表 6.17 给出了序列×时期均值，表 6.18 给出了仅来自时期 \\(1\\) 数据比较两种处理的检验。表 6.18 的检查显示，在表 6.7 中给出的分析中，延滞效应明显掩盖了部分处理效应，其中假设无延滞，因为处理效应不显著，而仅使用时期 \\(1\\) 数据的比较发现处理存在显著差异。 表 6.16: 固定效应的额外检验 x 表 6.17: 序列×时期双向均值 x 表 6.18: 处理 \\(A\\) 和处理 \\(B\\)，来自时期 \\(1\\) 的估计 x 6.3 具有两个以上时期的交叉设计 当没有延滞时，具有两个以上时期和/或两个以上处理的交叉设计的统计分析是简单的。当满足个体间误差和个体内误差的理想条件时，式 (6.1) 中的模型是合适的。表 6.4，6.9，和 6.11 仍然可以用来获得有用和有趣的统计量。由于没有延滞时的分析是直接的，本节集中讨论存在延滞的情况。 考虑的第一种情况是仍然有两种处理的情况，但涉及具有三个时期的序列。一种可能性是使用两个序列 \\(ABA\\) 和 \\(BAB\\). 对于 \\(ABA\\) 序列，实验单元将在时期 \\(1\\) 接受处理 \\(A\\)，在时期 \\(2\\) 接受处理 \\(B\\)，并在时期 \\(3\\)再次接受处理 \\(A\\). \\(BAB\\) 序列将进行类似处理。另一种可能性是使用两个序列 \\(ABB\\) 和 \\(BAA\\). 第三种可能性是使用所有这四个序列。也就是说，\\(ABA\\)、\\(BAB\\)、\\(ABB\\) 和 \\(BAA\\) 都将被使用。本节重点介绍使用两个序列 \\(ABA\\) 和 \\(BAB\\) 的交叉设计。其他的可能性也可以类似地分析。 表 6.19 确定了与 \\(ABA\\) 和 \\(BAB\\) 交叉设计的序列与时期组合相关的模型参数。 表 6.19: 三时期/两处理交叉设计的单元个均值参数 x 假设 \\(n_1\\) 个个体已被分配到 \\(ABA\\) 序列，\\(n2\\) 个个体已被分配到 \\(BAB\\) 序列。令 \\(y_{ij\\ell}\\) 为在从序列 \\(i\\) 时期 \\(j\\) 的个体 \\(\\ell\\) 中观察到的响应。令 \\(\\hat\\mu _{ij} = \\bar y_{ij\\cdot} , i = 1, 2; j = 1, 2, 3\\). 在式 (6.1) 中给出的模型误差项的理想条件下，可以证明： \\[\\begin{equation} \\begin{bmatrix}\\hat{\\mu}_{11}\\\\\\hat{\\mu}_{12}\\\\\\hat{\\mu}_{13}\\\\\\hat{\\mu}_{21}\\\\\\hat{\\mu}_{22}\\\\\\hat{\\mu}_{23}\\end{bmatrix}\\sim N\\left(\\begin{bmatrix}\\mu_{11}\\\\\\mu_{12}\\\\\\mu_{13}\\\\\\mu_{21}\\\\\\mu_{21}\\\\\\mu_{23}\\end{bmatrix},\\begin{bmatrix}\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\delta^2}{n_1}&amp;0&amp;0&amp;0\\\\\\frac{\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\delta^2}{n_1}&amp;0&amp;0&amp;0\\\\\\frac{\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\epsilon^2+\\sigma_\\delta^2}{n_1}&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\delta^2}{n_2}\\\\0&amp;0&amp;0&amp;\\frac{\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\delta^2}{n_2}\\\\0&amp;0&amp;0&amp;\\frac{\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_2}\\end{bmatrix}\\right) \\tag{6.9} \\end{equation}\\] 注意到对比 $$ \\[\\begin{aligned} \\begin{aligned}\\mu_{11}-\\frac12\\mu_{12}-\\frac12\\mu_{13}-\\mu_{21}+\\frac12\\mu_{22}+\\frac12\\mu_{23}\\end{aligned}&amp; =(\\mu+S_{ABA}+P_1-T_A)-\\frac12(\\mu+S_{ABA}+P_2+T_B+\\lambda_A) \\\\ &amp;-\\frac12(\\mu+S_{ABA}+P_3+T_A+\\lambda_B)-(\\mu+S_{BAB}+P_1+T_B) \\\\ &amp;+\\frac12(\\mu+S_{BAB}+P_2+T_A+\\lambda_B)+\\frac12(\\mu+S_{BAB}+P_3+T_B+\\lambda_A) \\\\ &amp;=T_{A}-T_{B} \\end{aligned}\\] $$ 因此，即使 \\(ABA\\)、\\(BAB\\) 交叉设计中存在延滞，两种处理的直接差异也可以通过下式来估计 \\[\\begin{equation} \\hat{\\mu}_{11}-\\frac12\\hat{\\mu}_{12}-\\frac12\\hat{\\mu}_{13}-\\hat{\\mu}_{21}+\\frac12\\hat{\\mu}_{22}+\\frac12\\hat{\\mu}_{23} \\tag{6.10} \\end{equation}\\] 还注意到 \\[\\begin{equation} \\mathrm{Var}\\left(\\hat{\\mu}_{11}-\\frac12\\hat{\\mu}_{12}-\\frac12\\hat{\\mu}_{13}-\\hat{\\mu}_{21}+\\frac12\\hat{\\mu}_{22}+\\frac12\\hat{\\mu}_{23}\\right)=\\frac32\\sigma_{\\varepsilon}^2\\left(\\frac1{n_1}+\\frac1{n_2}\\right) \\tag{6.11} \\end{equation}\\] 因此，式 (6.11) 中的对比是个体内对比，其方差仅取决于 \\(\\sigma^2_\\varepsilon\\). 一个可能感兴趣的问题是如何定义处理主效应均值？一种可能性是通过对表 6.19 中接受处理 \\(A\\) 的所有单元进行平均来估计 \\(A\\) 的主效应均值。也就是说，\\(A\\) 平均值为 \\((\\mu_{11} + \\mu_{22} + \\mu_{13})/3\\)，\\(B\\) 平均值为 \\((\\mu_{21} + \\mu_{12} + \\mu_{23})/3\\)。根据表 6.19 中定义的效应模型参数，这两个函数分别等于 \\[\\begin{aligned}\\mu+\\frac23S_{ABA}+\\frac13S_{BAB}+\\bar{P}_\\cdot+T_A+\\frac13(\\lambda_B+\\lambda_A)\\\\\\mu+\\frac13S_{ABA}+\\frac23S_{BAB}+\\bar{P}_\\cdot+T_B+\\frac13(\\lambda_A+\\lambda_B)\\end{aligned}\\] 这样的定义没有意义，因为这样的 \\(A\\) 均值和 \\(B\\) 均值的差等于 \\(\\frac{1}{3}S_{ABA}-\\frac{1}{3}S_{BAB}+T_A-T_B\\)，而不等于 \\(T_A-T_B\\). 也就是说，这样定义的 \\(A\\) 均值和 \\(B\\) 均值与序列效应混叠 (aliased). \\(A\\) 主效应均值的第二个定义是 \\[\\mu+\\bar{S}_\\cdot+\\bar{P}_\\cdot+T_A+\\frac13(\\lambda_B+\\lambda_A)\\] \\(B\\) 主效应均值类似地定义为 \\[\\mu+\\bar{S}_\\cdot+\\bar{P}_\\cdot+T_B+\\frac13(\\lambda_B+\\lambda_A)\\] 这样的定义是合理的，因为第一个等于表 6.19 中单元格均值的下列线性函数 \\[\\frac23\\mu_{11}-\\frac1{12}\\mu_{12}-\\frac1{12}\\mu_{13}-\\frac13\\mu_{21}+\\frac5{12}\\mu_{22}+\\frac5{12}\\mu_{23}\\] 第二个等于 \\[-\\frac13\\mu_{11}+\\frac5{12}\\mu_{12}+\\frac5{12}\\mu_{13}+\\frac23\\mu_{21}-\\frac1{12}\\mu_{22}-\\frac1{12}\\mu_{23}\\] 此外，这两个均值之差为 \\[\\mu_{11}-\\frac12\\mu_{12}-\\frac12\\mu_{13}-\\mu_{21}+\\frac12\\mu_{22}+\\frac12\\mu_{23}=T_A-T_B\\] 请注意，这与公式 (6.10) 中给出的单元格均值对比相同。单元格均值内的对比意味着延滞效应是 \\[\\begin{equation} \\mu_{11}-\\mu_{13}-\\mu_{21}+\\mu_{23}=\\lambda_A-\\lambda_B \\tag{6.12} \\end{equation}\\] 该对比估计的方差是 \\[\\begin{equation} \\mathrm{Var}(\\hat{\\mu}_{11}-\\hat{\\mu}_{13}-\\hat{\\mu}_{21}+\\hat{\\mu}_{23})=2\\sigma_{\\varepsilon}^2\\left(\\frac1{n_1}+\\frac1{n_2}\\right) \\tag{6.13} \\end{equation}\\] 且此对比也是个体内对比。 为了举例说明，请考虑表 6.20 中的数据，其中三名个体分配给 \\(ABA\\) 序列，另外三名个体分配给 \\(BAB\\) 序列。因此 \\(n_1 = n_2 = 3\\). 读取数据并计算序列×时期单元格均值的 SAS 代码如表 6.21 所示。单元平均值如表 6.22 所示。 因此，\\(A\\) 主效应平均值的估计由下式给出 \\[\\begin{aligned} \\frac23\\hat{\\mu}_{11}&amp; -\\frac1{12}\\hat{\\mu}_{12}-\\frac1{12}\\hat{\\mu}_{13}-\\frac13\\hat{\\mu}_{21}+\\frac5{12}\\hat{\\mu}_{22}+\\frac5{12}\\hat{\\mu}_{23} \\\\ &amp;=\\frac23(24.133)-\\frac1{12}(26.533)-\\frac1{12}(23.933)-\\frac13(26.367)+\\frac5{12}(26.233)+\\frac5{12}(24.833)=24.372 \\end{aligned}\\] \\(B\\) 主效应平均值的估计由下式给出 \\[\\begin{aligned}-\\frac13\\hat{\\mu}_{11}&amp;+\\frac5{12}\\hat{\\mu}_{12}+\\frac5{12}\\hat{\\mu}_{15}+\\frac23\\hat{\\mu}_{21}-\\frac1{12}\\hat{\\mu}_{22}-\\frac1{12}\\hat{\\mu}_{23}\\\\&amp;=-\\frac13(24.133)+\\frac5{12}(26.533)+\\frac5{12}(23.933)+\\frac23(26.367)-\\frac1{12}(26.233)-\\frac1{12}(24.833)=26.306\\end{aligned}\\] 表 6.20: \\(ABA/BAB\\) 交叉实验的数据 Seq Per Trt Person Y ABA 1 A 1 25.1 ABA 2 B 1 27.6 ABA 3 A 1 24.5 ABA 1 A 2 22 ABA 2 B 2 24.3 ABA 3 A 2 21.6 ABA 1 A 3 25.3 ABA 2 B 3 27.7 ABA 3 A 3 25.7 BAB 1 B 4 25.5 BAB 2 A 4 23.7 BAB 3 B 4 24.9 BAB 1 B 5 27.4 BAB 2 A 5 27.9 BAB 3 B 5 24.6 BAB 1 B 6 26.2 BAB 2 A 6 27.1 BAB 3 B 6 25 表 6.21: 用于获取表 6.20 中数据的序列×时期单元格均值的 SAS 代码 x TITLE ‘CRSOVR EXAMPLE #29.2 AN ABA/BAB DESIGN’; DATA CRS; INPUT SEQ $ PER TRT $ PERSON Y; LINES; ABA 1 A 1 25.1 ABA 2 B 1 27.6 ABA 3 A 1 24.5 ABA 1 A 2 22.0 ABA 2 B 2 24.3 ABA 3 A 2 21.6 ABA 1 A 3 25.3 ABA 2 B 3 27.7 ABA 3 A 3 25.7 BAB 1 B 4 25.5 BAB 2 A 4 23.7 BAB 3 B 4 24.9 BAB 1 B 5 27.4 BAB 2 A 5 27.9 BAB 3 B 5 24.6 BAB 1 B 6 26.2 BAB 2 A 6 27.1 BAB 3 B 6 25.0 ; PROC MEANS; CLASS SEQ PER; VAR Y; RUN; 表 6.22: 序列×时期单元格均值 x \\(A\\) 均值与 \\(B\\) 均值之差为 \\[\\hat{\\tau}_A-\\hat{\\tau}_B=24.372-26.306=-1.934\\] 人们可以使用 SAS-Mixed 程序来估计处理均值、检验处理差异、检验延滞以及估计两处理/三时期交叉设计的方差分量。例如，为了分析表 6.20 中的数据，必须定义一个新变量来标识前一时期给予的处理。为了不消除第一时期数据，还必须为第一时期数据定义这个新变量。对于 \\(ABA\\) 序列，可以将这个新变量定义为在时期 \\(1\\)、\\(2\\) 和 \\(3\\) 中分别取值为 \\(O\\)、\\(A\\) 和 \\(B\\). 对于 \\(BAB\\) 序列，新变量将分别取值 \\(O\\)、\\(B\\) 和 \\(A\\). 表 6.23 中的 SAS 代码使用了一个名为 PRIORTRT 的新变量，该变量具有前几句中给出的属性。定义了这个新变量的数据如表 6.24 所示。可用于分析表 6.20 中数据的 SAS-Mixed 命令如表 6.25 所示。结果输出如表 6.20 至 6.29 所示。表 6.26 给出了方差分量的估计。从该表中可以看出，\\(\\sigma^2_\\delta=2.1378\\) 和 \\(\\sigma^2_\\varepsilon=0.7872\\). 表 6.27 给出了处理 \\(A\\) 和处理 \\(B\\) 之差的检验。表 6.27 中标记为 Trt 的行是检验 \\(H_{01}:\\tau_A=\\tau_B\\)，标记为 PRIORTRT 的行是检验 \\(H_{02}:\\lambda_A=\\lambda_B\\). 请注意，表 6.27 中标记为 PER 的行只有一个自由度。这可能看起来很奇怪，因为有三个时期。然而，在时期 \\(1\\) 和 \\(\\lambda_0\\) 之间存在完全混淆 (completely confounding)，因此标记为 PER 的行仅比较时期 \\(2\\) 和时期 \\(3\\). 也就是说，标记为 PER 的行检验 \\(H_{03}:P_2=P_3\\). 表 6.25 中的 CONTRAST 选项给出了一个检验统计量，将所有三个时期相互比较；即该 CONTRAST 选项检验 \\(H_{03}:P_1+\\lambda_0=P_2=P_3\\) 的结果。该选项的结果附在表 6.27 的底部。 表 6.23: 为表 6.20 中的数据创建 PRIORTRT 变量的 SAS 代码 x DATA CRS2; SET CRS; IF SEQ=‘ABA’ AND PER=2 THEN PRIORTRT=‘A’; ELSE IF SEQ=‘ABA’ AND PER=3 THEN PRIORTRT=‘B’; ELSE IF SEQ=‘BAB’ AND PER=2 THEN PRIORTRT=‘B’; ELSE IF SEQ=‘BAB’ AND PER=3 THEN PRIORTRT=‘A’; ELSE PRIORTRT=‘O’; RUN; PROC PRINT; TITLE2 ‘A PRINT OF THE DATA WITH PRIORTRT VARIABLE INCLUDED’; RUN; 表 6.24: 打印定义了 PRIORTRT 变量的新数据 x 表 6.25: 分析表 6.24 中数据的 SAS 代码 x PROC MIXED; TITLE3 ‘AN ANALYSIS USING MIXED’; CLASSES SEQ PERSON TRT PER PRIORTRT; MODEL Y=SEQ TRT PER PRIORTRT/DDFM=KR; LSMEANS TRT/PDIFF; ESTIMATE ‘TRT DIFF’ TRT 1 -1; ESTIMATE ‘CARRYOVER’ PRIORTRT 1 -1; CONTRAST ‘PERIOD DIFF’ PER 0 1 -1, PER 1 -.5 -.5 PRIORTRT -.5 -.5 1; RANDOM PERSON(SEQ); RUN; 表 6.26: 方差分量估计 x 表 6.27: 固定效应检验 x 处理主效应均值的估计值如表 6.28 所示。请注意，SAS-Mixed 程序给出的值与表 6.22 中使用主效应平均值的第二定义计算的估计值相同。表 6.25 中两个 ESTIMATE 语句的结果如表 6.29 所示。这些估计的第一个 \\(\\tau_A-\\tau_B\\) 给出了估计值的标准误估计，并给出了用于检验 \\(H_{01}:\\tau_A=\\tau_B\\) 的 \\(t\\) 统计量以及检验观察到的显著性水平。第二个 ESTIMATE 语句估计 \\(\\lambda_A-\\lambda_B\\) 给出了估计值的标准误估计，并给出了用于检验 \\(H_{02}:\\lambda_A=\\lambda_B\\) 的 \\(t\\) 统计量以及检验观察到的显著性水平。读者应注意，表 6.29 中观察到的处理差异和延滞差异的显著性水平与表 6.27 中相应的观察到的显著性水平相同。处理差异估计的标准误估计可以通过将 (6.11) 中的 \\(\\sigma_\\varepsilon^2\\) 替换为 \\(\\hat\\sigma_\\varepsilon^2\\) 来计算，即 \\[\\begin{aligned} \\widehat{\\mathrm{Var}}\\left(\\hat{\\mu}_{11}-\\frac12\\hat{\\mu}_{12}-\\frac12\\hat{\\mu}_{13}-\\hat{\\mu}_{21}+\\frac12\\hat{\\mu}_{22}+\\frac12\\hat{\\mu}_{23}\\right)&amp; =\\frac32\\hat\\sigma_\\varepsilon^2\\left(\\frac1{n_1}+\\frac1{n_2}\\right) \\\\ &amp;=\\left(\\frac32\\right)(0.7872)\\left(\\frac13+\\frac13\\right)=0.7872 \\end{aligned}\\] 因此 \\(\\hat \\tau_A-\\hat \\tau_B\\) 标准误估计为 \\(√0.7872=0.8872\\). 类似地，可以通过将方程 (6.13) 中的 \\(\\sigma_\\varepsilon^2\\) 替换为 \\(\\hat\\sigma_\\varepsilon^2\\) 并取结果的平方根，来获得 \\(\\hat \\lambda_A-\\hat \\lambda_B\\) 的标准误估计。与这些的标准误估计中的每一个相关的自由度为 \\(2(n_1+n_2-2)=8\\). 表 6.28: 处理主效应均值 x 表 6.29: 从 Estimate 选项中检验处理和延滞效应 x 6.4 具有两种以上处理的交叉设计 接下来，考虑六个序列中的三处理/三时期交叉设计。设计序列为 \\(ABC,ACB,BAC,BCA,CAB,CBA\\). 所有这六个序列都是必需的，为了获得不会与延滞混叠的处理均值的直接比较。Williams (1949) 开发的设计在延滞效应方面是均衡的。Williams 交叉设计在延滞效应方面是均衡的，其特点是每次处理后都会进行完全相同次数的其他处理。 上面给出的六序列设计是 Williams 设计。在这六个序列的设计中，每个处理（字母）跟随另一个处理两次。还要注意，虽然具有序列 \\(ABC,BCA,CAB\\) 的三序列设计是拉丁方设计，但它不是 Williams 设计。在这种设计中，\\(A\\) 后面跟着 \\(B\\) 两次，但 \\(A\\) 后面永远不会跟着 \\(C\\). 同样，\\(B\\) 后面跟着 \\(C\\) 两次，但 \\(B\\) 后面从来没有跟着 \\(A\\)；\\(C\\) 后面跟着 \\(A\\) 两次，但 \\(C\\) 后面从来没有跟着 \\(B\\)。三个时期内三种处理的 Williams 设计必须使用 \\(ABC,ACB,BAC,BCA,CAB,CBA\\) 的所有六个序列。 假设有四处理和四时期，显然，24 序列设计具有处理 \\(A,B,C,D\\) 的所有 \\(24\\) 种可能的排序，这将是一个 Williams 设计。另一种四处理四时期的 Williams 设计的序列为 \\(ABCD,BDAC,CADB,DCBA\\). 设 \\(t\\) 为交叉设计中要使用的处理数和时期数。如果 \\(t\\) 是偶数，则 Williams 设计可以用一个特殊的 \\(t×t\\) 拉丁方设计来构建，如果 \\(t\\) 是奇数，Williams 设计可以通过使用两个特殊的拉丁方设计来构建。 表 6.30 给出了三时期/三处理 Williams 设计的单元格均值参数。为了表明当存在延滞时可以估计处理差异，可以证明对于表 6.30 中的单元格均值 \\[\\begin{align} &amp;(5\\mu_{11}-2\\mu_{12}-3\\mu_{13}+4\\mu_{21}+2\\mu_{22}-6\\mu_{23}-5\\mu_{31}+2\\mu_{32}+3\\mu_{33}-4\\mu_{41}-2\\mu_{41}\\\\&amp;+6\\mu_{43}-\\mu_{51}+4\\mu_{52}-3\\mu_{53}+\\mu_{61}-4\\mu_{62}+3\\mu_{63})/24=\\tau_A-\\tau_B \\tag{6.14} \\end{align}\\] 还注意到，也可以比较延滞效应， \\[\\begin{align} &amp;(\\mu_{11}+2\\mu_{12}-3\\mu_{13}+0\\mu_{21}+2\\mu_{22}-2\\mu_{23}-\\mu_{31}-2\\mu_{32}+3\\mu_{33}+0\\mu_{41}-2\\mu_{41}\\\\&amp;+2\\mu_{43}-\\mu_{51}+0\\mu_{52}+\\mu_{53}+\\mu_{61}+0\\mu_{62}-\\mu_{63})/8=\\lambda_A-\\lambda_B \\tag{6.15} \\end{align}\\] 还可以获得简化为 \\(\\tau_A-\\tau_C\\) 和 \\(\\tau_B-\\tau_C\\) 以及 \\(\\lambda_A-\\lambda_C\\) 和 \\(\\lambda_B-\\lambda_C\\) 的单元格均值参数的类似函数。 表 6.30: 六个序列的三时期/三处理交叉设计单元格均值参数 x 例如，考虑表 6.31 中的数据。这些数据来自六个序列的三时期/三处理交叉设计。有少数个体缺失数据。使用表 6.31 中的命令创建 SAS 数据集。这些命令还创建了一个延滞参数，该参数给出了上一时期的处理值。对于第一时期，该参数的值为“O”。数据最初使用 SAS-Mixed 软件进行分析，使用表 6.33 中的命令。表 6.34 给出了个体间和个体内方差分量的估计，即，\\(\\hat\\sigma^2_\\delta = 3.2278\\) 和 \\(\\hat\\sigma^2_\\varepsilon = 0.8934\\). 表 6.31: 三时期/三处理交叉设计的数据 x 表 6.32: 分析表 6.31 中数据的 SAS 代码 x 表 6.33: 分析表 6.31 中数据的 SAS 代码 x 表 6.34: 方差分量的估计 x 表 6.35 给出了固定效应的检验。对表 6.35 的检验表明，有一个很显著处理效应（\\(p &lt; 0.0001\\)）和显著的延滞效应（\\(p = 0.0306\\)）。表 6.36 和 6.37 给予 LSMEANS 选项的结果。值得注意的是，无论是处理还是先前处理的最小二乘均值都不可估 (not estimable)。原因是 SAS-Mixed 程序生成的模型参数函数是不可估的。 例如，SAS-Mixed 程序将处理 \\(A\\) 最小二乘均值定义为 \\[\\mu+\\frac{S_{ABC}+S_{ACB}+S_{BAC}+S_{BCA}+S_{CAB}+S_{CBA}}6+\\frac{P_1+P_2+P_3}3+\\tau_A+\\frac{\\lambda_A+\\lambda_B+\\lambda_C+\\lambda_O}4\\] 该函数不可估，因为 \\(P_1\\) 和 \\(\\lambda_O\\) 在模型中彼此完全混叠，因此，它们必须具有相同的乘数。在上式中，它们不具有相同的乘数，因为 \\(P_1\\) 的乘数等于 \\(1/3\\)，而 \\(\\lambda_O\\) 的乘数等于 \\(1/4\\). 处理 \\(A\\) 最小二乘均值的更好定义为 \\[\\begin{align} \\mu&amp;+\\frac{S_{ABC}+S_{ACB}+S_{BAC}+S_{BCA}+S_{CAB}+S_{CBA}}6+\\frac{P_1+P_2+P_3}3\\\\&amp;+\\tau_A+\\frac{2\\lambda_A+2\\lambda_B+2\\lambda_C+3\\lambda_O}9 \\tag{6.16} \\end{align}\\] 在该定义中，\\(P_1\\) 和 \\(\\lambda_O\\) 的乘数均等于 \\(1/3\\). 此外，由于四个延滞参数的乘数之和必须为 \\(1\\)，因此 \\(\\lambda_A,\\lambda_B,\\lambda_C\\) 的乘数必须等于 \\(2/9\\). 式 (6.16) 中的函数是可估计。以类似的方式，可以定义处理 \\(B\\) 和处理 \\(C\\) 的最小二乘均值，并且这些平均值之间的成对差异将不包括延滞参数。 表 6.35: 固定效应的检验 x 表 6.36: 处理最小二乘均值 x 表 6.37: 处理和延滞参数之间的成对比较 x 尽管在表 6.36 中处理最小二乘均值不可估，但成对差异是可估计的，处理和延滞参数之间的成对比较见表 6.37 。从表 6.37 可以看出， \\[\\hat{\\tau}_{A}-\\hat{\\tau}_{B}=0.8195,\\hat{\\tau}_{A}-\\hat{\\tau}_{C}=-3.0861,\\mathrm{and}\\,\\hat{\\tau}_{B}-\\hat{\\tau}_{C}=-3.9056\\] 相应的观察到的显著性水平为 \\(p = 0.0041\\)、\\(p &lt; 0.0001\\) 和 \\(p &lt; 0.0001\\). 因此，所有处理均值彼此之间存在显著差异。 从表 6.37 中还可以看出， \\[\\hat{\\lambda}_A-\\hat{\\lambda}_B=-0.7706,\\hat{\\lambda}_A-\\hat{\\lambda}_C=0.1842,\\mathrm{~and~}\\hat{\\lambda}_B-\\hat{\\lambda}_C=0.9548\\] 相应的观察到的显著性水平为 \\(p = 0.0557\\)、\\(p = 0.6380\\) 和 \\(p = 0.0118\\). 因此，处理 \\(A\\) 和 \\(C\\) 的延滞效应彼此相似，且均与处理 \\(B\\) 的延滞显著不同。 表 6.38 给出了额外的 SAS 代码，该代码使用与 (6.16) 中给出的处理 \\(A\\) 相似的定义计算处理最小二乘均值。表 6.38 中 SAS 命令的结果见表 6.39. 对表 6.39 的检查表明，处理 \\(C\\) 的平均值最大，其次是处理 \\(A\\) 和 \\(B\\). 还注意到，表 6.39 中给出的处理平均值和延滞效应之间的成对比较与表 6.37 中的相应比较完全相同。 表 6.38: 计算处理可估最小二乘均值的额外 SAS 代码 x 表 6.39: 表 6.38 中给出的命令的结果 x 6.5 小结 本章考虑了交叉设计，即每个个体随着时间的推移接受一系列处理。特定个体接受的一系列特殊处理被称为序列。当使用交叉设计时，需要考虑延滞问题。如果怀疑可能存在延滞，可以在进行下一次处理之前纳入洗脱期，以尽可能减少延滞的影响。当两时期/两处理交叉设计中存在延滞时，不能使用第二个时期的数据来估计处理差异。然而，当能够使用两个以上时期和/或两种以上处理时，无论是否存在延滞，都可以获得处理差异的估计。 "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
