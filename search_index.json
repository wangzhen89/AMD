[["index.html", "混乱数据分析：设计的实验 介绍 本书框架 术语规范", " 混乱数据分析：设计的实验 Wang Zhen 2024-03-11 介绍 “Statistics is the grammar of science.” - Karl Pearson 混乱数据分析：设计的实验 为 Analysis of Messy Data Volume 1: Designed Experiments, 2nd edn 的翻译。 本书/翻译基于 Elegant Bookdown Template。尚未包括每章的练习。 本书探讨了多重比较程序、随机效应模型、混合模型、裂区实验和重复测量设计的各种技术。作者使用几个统计软件包简化了这些技术，并强调了设计结构和处理结构之间的区别。他们用例子介绍每一个主题，接着进行理论讨论，最后进行案例研究。本书向您展示如何有效地分析现实世界中的非标准数据集。 本书涉及丰富且有趣的例子，如探究饮食对减肥的影响、房屋油漆承受环境条件的能力、油漆保护钢板耐高温的能力、氮和钾的组合如何影响玉米产量、豆子煮熟后的风味、磨小麦时辊缝对小麦粉的影响、温度如何影响面包烘焙后的体积、展示柜中的肉的颜色如何受温度、包装、光照类型及强度的影响……统计分析当然重要，但良好的设计是良好的分析的前提，本书在这些实例的设计和分析方面给予了连贯的解释，展示了丰富的图表，罗列了大量公式，详尽地阐明了分析步骤并给出了相应的软件代码。 本书需要读者对统计学基本概念有一定的了解，并且最好有线性模型和实验设计的基础知识。在本书阅读过程中常常需要交替往返地进行查阅（或向前或向后）以获得完整的学习过程，出于此特殊结构，本书不适合作为入门级教科书，而是适合作为学习完线性模型和实验设计后的一本进阶学习资料或案头参考书。 站在巨人的肩膀上，才有了本书。希望你喜欢。 若有帮助，欢迎转发。能力不足，水平有限，望不吝批评：1210683652@qq.com 由于公式较多，每章可能需要加载数秒。建议尽可能关闭后台程序以缩短加载时间。 本书框架 译者将本书划分为 “热身”，“磨刀” 和 “砍柴” 三个部分。第一部分主要回顾了单向方差分析作为后续内容的热身；后两部分的主题分别是 “基本理论背景” 和 “处理结构的分析”。俗话说磨刀不误砍柴工，“磨刀” 的第 4 - 5 章可能需要研究者重点关注。“砍柴” 大部分内容都是先以若干章节讨论更具体处理结构的理论分析，再以案例研究收尾。三个部分的开头章节分别为第 1 章、第 3 章和第 7 章。左上角的选项用于展开/关闭左侧的导航窗格。接下来简要介绍各章内容（各章节均标了星星 “*” ，加载时长与星星数量成正比。恭喜您成为观星师！建议尽可能关闭后台程序以缩短加载时间） “热身” 作为开篇，第 1 章***讨论了最简单的情况：具有同质误差的完全随机设计结构中的单向处理结构。在这类实验中，研究人员希望考察某种因素对响应变量的影响，并假定响应变量在该因素的不同水平中的方差相等。 第 2 章***接续第 1 章的基本结构，但将同质误差改为异质误差，即该因素可能会改变响应变量的方差。本章着重讨论了有关方差齐性检验的一系列技术。 “磨刀” 第 3 章***重点关注实验中常常出现的一个问题：如何控制多重比较中的各种错误率？本章回顾了多重比较的一系列技术并给出了建议。 第 4 章**对实验设计基本概念进行了详尽的描述。并强调了重复和复制的区别，提醒研究者勿将子样本或重复测量误认为重复。此外本章还讨论了其他实验设计教科书较少着墨甚至忽略的内容：将设计实验的结构划分为处理结构和设计结构，并列举了这两种结构常用的类型。最后结合两种结构的划分讨论了一些示例。 第 5 章***讨论了多水平设计结构这一重要概念，包括裂区设计、裂条设计、重复测量设计及这些设计的组合。本章重点介绍了当实验包含不止一种尺寸的实验单元时，如何识别每种尺寸的实验单元，这对于计算所需误差平方和的过程至关重要。通过大量的例子来阐述不同设计结构的这些过程。 第 6 章*仅供对理论背景感兴趣的人阅读，介绍了最小二乘估计程序，并讨论了可估性的重要概念。还讨论了总体边际均值的定义和估计。 “砍柴” 第 7 章*讨论了均衡双向处理结构，给出了交互作用的定义并重点讨论了交互作用假设及它们的重要性。 第 8 章**是一个均衡双向实验案例的完整分析，首先关于主效应和交互效应分别给出了对比和正交对比的定义，最后以此概念分析了一个油漆铺路示例，最后讨论了在分析定量处理因素时如何利用正交多项式考察处理主效应均值的曲线趋势。 第 9 - 15 章讨论对子类数量不等的双向处理结构的分析。 第 9 章**讨论对子类数量不等的双向处理结构的分析使用均值模型。 第 10 章***则使用效应模型来分析相同的问题，实际上效应模型和均值模型能回答相同的问题，但几乎所有的统计软件都是为了处理效应模型而不是均值模型而开发的。还讨论了 I-IV 型假设以及相应的分析，总体边际均值与最小二乘均值的概念。 第 11 章**讨论了一种关于大型均衡双向实验的分析方法，称为未加权均值法，这在计算机不发达的年代十分有用。此外，一些大型实验可能需要良好的初始起始值以便迭代算法能够收敛到合理的解，本章中的方法可以让研究人员在难以使程序收敛的情况下找到良好的初始起始值。 第 12 章*以脂肪-表面活性剂实验为例，对子类数不等的均衡双向处理结构进行了一个案例研究。 第 13 章*和第 14 章*分别使用均值模型和效应模型来分析含缺失处理组合的双向处理结构。除非可以对模型中的参数做出一些额外的假设，否则一些感兴趣的假设可能是不可检验的。对于存在缺失处理组合的数据，要做出可接受的分析需要深思熟虑。 第 15 章*回顾了第 12 章的脂肪-表面活性剂实验，说明了在未观测到某些处理组合的情况下，随机完全区组设计中双向处理结构实验的分析。 第 16 章*给出了分析三向和高阶处理结构的一般策略。尽管非常高阶的交互作用很少是有意义的，但我们都必须处理它们。 第 17 章**以营养评分研究为例，对许多处理组合缺失时的三向处理结构进行了一个案例研究。提出了 SAS-GLM 分析未回答的问题，并说明了回答这些问题的技术。 第 18 - 21 章介绍随机效应模型及其分析方法。 第 18 章***作为介绍方差分量和随机效应模型开篇章节，定义了随机效应和固定效应的概念以及随机效应模型的概念。详细介绍了用于计算期望均方的代数方法和 Hartley’s 综合法，介绍了 Henderson 提出的四种计算平方和的方法。 第 19 章***介绍了四种用于估计随机效应模型方差分量的方法：矩法、最大似然、受限或残差最大似然和 MIVQUE. 第 20 章***介绍关于方差分量和方差分量函数的假设检验和构造置信区间的方法。有多种计算置信区间的方法，对于给定的数据结构，可以通过模拟研究来评估特定置信区间方法的实用性。 第 21 章**讨论了一个工厂-地点-工人案例研究，以提供一个复杂的随机效应模型分析，其中包括方差分量估计、模型构建、假设检验和置信区间的估计。 第 22 章***给出了混合模型的一般定义，分别讨论了随机效应部分和固定效应部分的分析。介绍了 BLUE, BLUP 和混合模型方程组等重要概念。 第 23 章**通过工厂中员工操作机器的生产率得分案例讨论了均衡和不均衡混合模型的分析，其中涉及到固定效应和方差分量的各种估计和检验方法。 第 24 章****通过七个示例详细讨论了裂区型设计的分析，还讨论了样本量和功效的计算。 第 25 章**通过六个示例详细讨论了条区型设计的分析，这包括单纯的条区设计、含裂区的条区（条裂区以及条-条区。 第 26 章***在理想的假设条件（时间的裂区假设）下讨论了重复测量实验，对三个示例进行了分析。 第 27 章***接续第 26 章，考虑了在时间的裂区假设不满足的情况下分析重复测量实验数据的三种替代方法：多元方差分析法、调整 \\(p\\) 值法和混合模型法。对于混合模型法给出了关于一些流行的协方差结构的讨论。 第 28 章**讨论了几个复杂的重复测量示例及其使用混合模型程序的统计分析。 第 29 章***讨论了交叉设计的分析。 术语规范 Estimation, estimate, estimator 统一译作 “估计”，不论语境。 Treatment 统一译作 “处理”，不论语境。 Population 大多译作 “总体”。 Subject 统一译作 “个体”，不论语境。虽然 Subject 更多地译作 “受试者”、“主体”，而且 Subject 甚至没有 “个体” 这种翻译，译者如此翻译是出于统一以及特定上下文适用性的目的。对于后一个目的，例如，很难想象将农田里的作物、烘烤的面包译作 “受试者” 或 “主体”，如此翻译稍显奇怪。当然，本书原文更多地用 experimental unit 而不是 subject 来表示实验（最小）单元。 Balanced 统一译作 “均衡”，虽然可能更多地译作 “平衡”，如此翻译原因如下。考虑一个双向（两因素）实验，其设计通常以二维表格的形式呈现。现我们将其具象化为一张棋盘，两种处理的水平的每种组合代表棋盘的一个格子，我们的观测数据则是下在格子内的棋子，并假设每个棋子质量相等。现在我们的任务是在棋盘下方用竹竿顶端撑起棋盘，也就是找到一个支点使棋盘平衡。直观地想，如果每个格子中的棋子数量相等，那么这项任务最为简单：找到棋盘的中点即可。当格子中的棋子数量不等甚至有格子缺失棋子时，如此情况稍显复杂。这实际上也对应于当各处理组合观测数相等时，许多方法的功效达到最大。现将 “棋盘-棋子” 模型抽象化为数据，则最好不要用 “平衡” 而是 “均衡”，因为只有实体才会平衡，只有抽象化的数据才有 “均” 的概念。（事实上，观测数量不等时常用的逆概率加权方法，也可结合 “棋盘-棋子” 模型来解释）。 矩阵以加粗字体\\({\\Large{\\text{大写}}}\\)英文/希腊字母表示，向量以加粗字体\\({\\Tiny{\\text{小写}}}\\)英文/希腊字母表示，标量以普通字体英文/希腊字母表示，如 观测向量 \\(\\boldsymbol y\\) 设计矩阵及其转置 \\(\\boldsymbol X,\\boldsymbol X^\\prime\\) 误差向量 \\(\\boldsymbol\\varepsilon\\) 协方差阵及其逆 \\(\\boldsymbol \\Sigma,\\boldsymbol \\Sigma^{-1}\\) n 阶单位阵 \\(\\boldsymbol I_n\\) n 阶全 1 向量 \\(\\boldsymbol j_n\\) n 阶全 1 矩阵 \\(\\boldsymbol J_n\\) 总均值 \\(\\mu\\) 误差方差及其估计 \\(\\sigma^2_\\varepsilon,\\hat \\sigma^2_\\varepsilon\\) 对于具有多个维度的量 \\(x\\)，其中各维度以索引 \\(\\text{index}=i,j,k,\\ldots\\) 表示，索引的取值为 \\(1,2,\\ldots,n_\\text{index}\\). 若固定其他维度不变，而关于某维度求和，则该维度的索引替换为 “\\(\\cdot\\)”；若关于该维度求均值，则进一步为该量加上横线 \\(\\bar x\\). 例如： 对于三维样本量 \\(n_{ijk}\\)；总样本量 \\(N=\\sum_i^{n_i}\\sum_j^{n_j}\\sum_k^{n_k} n_{ijk}=n_{\\cdot\\cdot\\cdot}\\)；固定第一维和第三维，第二维的总样本量 \\(\\sum_j^{n_j}n_{ijk}=n_{i\\cdot k}\\) 对于二维均值 \\(\\mu_{ij}\\)；总均值 \\(\\frac{1}{n_i}\\sum_{i}^{n_i}\\left(\\frac{1}{n_j}\\sum_{j}^{n_j}\\mu_{ij}\\right)=\\bar \\mu_{\\cdot\\cdot}=\\mu\\)；固定第二维，第一维的均值 \\(\\frac{1}{n_i}\\sum_{i}^{n_i}\\mu_{ij}=\\bar \\mu_{\\cdot j}\\) 对于三维误差项 \\(\\varepsilon_{ijk}\\)；总误差均值 \\(\\frac{1}{n_i}\\sum_{i}^{n_i}\\left[\\frac{1}{n_j}\\sum_{j}^{n_j}\\left(\\frac{1}{n_k}\\sum_{k}^{n_k}\\varepsilon_{ijk}\\right)\\right]=\\bar\\varepsilon_{\\cdot\\cdot\\cdot}\\)；固定前两维，第三维的误差均值 \\(\\frac{1}{n_k}\\sum_{k}^{n_k}\\varepsilon_{ijk}=\\bar\\varepsilon_{ij\\cdot}\\) 未完待续…… "],["chap1.html", "第 1 章 最简单的情况：具有同质误差的完全随机设计结构中的单向处理结构 1.1 模型定义和假设 1.2 参数估计 1.3 线性组合的推断：检验与置信区间 1.4 示例：任务和脉搏率 1.5 几个线性组合的同时检验 1.6 示例：任务和脉搏率（续） 1.7 检验所有均值相等 1.8 示例：任务和脉搏率（续） 1.9 比较两种模型的一般方法：条件误差原理 1.10 示例：任务和脉搏率（续） 1.11 计算机分析 1.12 结束语 1.13 练习", " 第 1 章 最简单的情况：具有同质误差的完全随机设计结构中的单向处理结构 “Randomization is too important to be left to chance.” - J. D. Petruccelli 假设一名实验者想比较几种不同处理1的效应，例如不同药物对人们心率的影响或几种不同小麦品种的产量。通常，分析此类实验数据的第一步是使用一种称为单向方差分析模型的统计方法来刻画数据。单向方差分析所基于的模型是统计学领域中最有用的模型之一。许多实验情况只是该模型的特殊情况。其他看起来要复杂得多的模型通常可以被认为是单向模型。本章分为几个部分。在前两部分中，定义了单向模型，并讨论了其参数的估计。在 1.3 节和1.5节中，提供了处理效应特定线性组合的推断程序。在 1.7 节和 1.9 节中，我们介绍了开发检验统计量的两种基本方法。这两种方法在本书的其余部分被广泛使用。最后，在 1.11 中，我们讨论了使用上述技术可用的计算机分析。使用一个示例来演示每一节中描述的概念和计算。 1.1 模型定义和假设 假设含 \\(N\\) 个实验单元的样本是从可能的实验单元总体2中完全随机地选取的。实验单元被定义为施加处理并独立观察的基本单元。在第 4 章和第 5 章中可以找到对实验单元更完整的描述。 为了比较 \\(t\\) 种不同处理的效应，将 \\(N\\) 个实验单元的样本随机分为 \\(t\\) 组，使第 \\(i\\) 组中有 \\(n_i\\) 个实验单元，其中 \\(i=1,2,\\dots,t\\) 且 \\(N=\\sum_{i=1}^tn_i\\). 将实验单元随机分为 \\(t\\) 组应消除任何系统偏差。也就是说，随机化应该确保在施加处理之前，\\(t\\) 组实验单元在性质上是相似的。最后，\\(t\\) 个处理中的每个处理应随机分配到每组实验单元。等价地，可以使用一些随机化装置将实验单元随机分配到 \\(t\\) 个处理组，例如将 \\(n_1\\) 个标签置于表示处理 1 的碗中，将 \\(n_2\\) 个标签置于表示处理 2 的碗中，……，将 \\(n_t\\) 个标签置于表示处理 t 的碗中。混合标签，然后从碗中随机选择标签，以确定分配给每个实验单元的处理。这种在碗中使用标签的过程显然可以使用随机数生成的软件来执行。 设 \\(y_{ij}\\) 表示分配给第 \\(i\\) 种处理的第 \\(j\\) 个实验单元的反应。值 \\(y_{11},y_{12},\\dots,y_{1n_1}\\) 可以被认为是来自均值为 \\(m_1\\) 且方差为 \\(s^2_1\\) 的总体的大小为 \\(n_1\\) 的随机样本，值 \\(y_{21},y_{22},\\dots,y_{2n_1}\\) 可以被认为是来自均值为 \\(m_2\\) 且方差为 \\(s^2_2\\) 的总体的大小为 \\(n_2\\) 的随机样本，对于 \\(i = 3,4,\\dots,t\\) 也是如此。参数 \\(\\mu_i\\) 和 \\(\\sigma^2_i\\) 表示对实验单元的整个总体施加处理 \\(i\\) 时的总体均值和总体方差。 本章考虑了最简单的情况，即假设各处理之间的方差是同质的或相等的，即 \\(\\sigma^2_1= \\sigma^2_2=\\cdots = \\sigma^2_t\\). 也就是说，假设对实验单元施加第 \\(i\\) 个处理可能会影响响应的均值，但不会影响响应的方差。第 2 章讨论了等方差假设以及不等方差的方差分析。 一个好的统计分析的基本目标是估计模型的参数并对它们进行推断，推断的方法通常包括检验假设和构造置信区间。 有几种方法可以为上述情况下的数据编写模型。第一个要使用的模型称为 \\(\\mu_i\\) 模型或均值模型 (means model)。均值模型是： \\[y_{ij}=\\mu_{i}+\\varepsilon_{ij}\\quad i=1,2,\\dots,t,\\,j=1,2,\\dots,n_{i}\\] 其中假设了 \\[\\begin{equation} \\varepsilon_{ij}\\sim \\text{i.i.d.}\\,N(0,\\sigma^{2})\\quad i=1,2,\\ldots,t,\\,j=1,2,\\ldots,n_{i} \\tag{1.1} \\end{equation}\\] 记号 \\(\\varepsilon_{ij}\\sim \\text{i.i.d.}\\,N(0,\\sigma^{2})\\) 贯穿本书。它表示 \\(\\varepsilon_{ij}\\,(i=1,2,\\dots,t;\\,j=1,2,\\dots,n_i)\\) 独立同分布，每个 \\(\\varepsilon_{ij}\\) 的抽样分布是均值为 \\(0\\)，方差为 \\(s^2\\) 的正态分布。 1.2 参数估计 统计分析最重要的方面是得到每个实验单元的误差方差 \\(\\sigma^2\\) 的良好估计. 误差方差衡量实验的准确性——- \\(s^2\\) 越小，实验越准确。在任何实验或研究中，如果不了解实验误差方差，就不能做出任何在统计上有效的推论。 在上述情况下，当 \\(n_i &gt; 1\\) 时，第 \\(i(=1,2,\\dots,t)\\) 个样本提供 \\(\\sigma^2\\) 的估计。从第 \\(i\\) 种处理的数据中获得的 \\(\\sigma^2\\) 的估计值为 \\[\\hat{\\sigma}_i^2=\\sum_{j=1}^{n_j}\\frac{\\left(y_{ij}-\\overline{y}_{i\\cdot}\\right)^2}{n_i-1}\\] 这是 \\(\\sigma^2\\) 的一个无偏估计。其中 \\[\\overline{y}_{i\\cdot}=\\frac{\\sum_{j=1}^{n_i}y_{ij}}{n_i}\\] 第 \\(i\\) 个处理的 \\(\\sigma^2\\) 的估计值是 \\(\\sigma^2_i\\) ，基于 \\(n_i - 1\\) 个自由度，且 \\((n_i - 1)\\hat\\sigma_i^2/\\sigma^2\\) 的抽样分布是具有 \\(n_i - 1\\) 个自由度的卡方分布。 \\(\\sigma^2\\) 的这些 \\(t\\) 个独立估计值的加权平均提供了如下情况下 \\(\\sigma^2\\) 可能的最佳估计值：其中方差的每个估计值由其相应的自由度加权。\\(\\sigma^2\\) 的最佳估计为 \\[\\hat{\\sigma}^2=\\sum_{i=1}^t(n_i-1)\\hat{\\sigma}_i^2\\left/\\sum_{i=1}^t(n_i-1)\\right.\\] 出于计算目的，每个方差乘以其权重可以表示为 \\[(n_{i}-1)\\hat{\\sigma}_{i}^{2}=\\sum_{i=1}^{t}\\left(y_{ij}-\\overline{y}_{i\\cdot}\\right)^{2}=\\sum_{i=1}^{t}y_{ij}^{2}-n_{i}\\overline{y}_{i\\cdot}^{2}=\\sum_{i=1}^{t}y_{ij}^{2}-(y_{i.})^{2}/n_{i}=SS_{i}\\] 其中 \\(y_{i\\cdot}=\\sum_{j=1}^{n_{i}}y_{ij}\\). 则方差的合并估计 (pooled estimate) 为 \\[\\hat{\\sigma}^2=\\frac{SS_1+SS_2+\\cdots+SS_t}{(n_1-1)+(n_2-1)+\\cdots+(n_t-1)}=\\frac{\\sum_{i=1}^tSS_i}{N-t}\\] 方差 \\(\\sigma^2\\) 的合并估计值基于 \\(N-t\\) 个自由度，并且 \\((N-t)\\hat\\sigma^2/\\sigma^2\\) 的抽样分布是具有 \\(N-t\\) 个自由度的卡方分布，即，\\((N-t)\\hat\\sigma^2/\\sigma^2\\sim \\chi^2_{N-t}\\). 每个 \\(\\mu_i\\) 的最佳估计是 \\(\\hat{\\mu}_{i}=\\bar{y}_{i\\cdot},\\,i=1,2,\\dots,t\\). 在式 (1.1) 给出的假设下，\\(\\hat\\mu_i\\) 的抽样分布是正态分布，具有均值 \\(\\mu_i\\) 和方差 \\(\\sigma^2/n_i\\). 即， \\[\\begin{equation} \\hat{\\mu}_i\\sim N{\\left(\\mu_i,\\frac{\\sigma^2}{n_i}\\right)}\\quad i=1,2,\\ldots,t \\tag{1.2} \\end{equation}\\] 使用 \\(\\hat\\mu_i,\\hat\\sigma_i^2\\) 的抽样分布，那么 \\[\\begin{equation} t_{i}=\\frac{\\hat{\\mu}_{i}-\\mu_{i}}{\\sqrt{\\hat{\\sigma}^{2}/n_{i}}}\\sim t_{\\Tiny{N-t}}\\quad i=1,2,\\ldots,t \\tag{1.3} \\end{equation}\\] 也就是说，\\(t_i\\) 的抽样分布是具有 \\(N-t\\) 个自由度的 \\(t\\) 分布。此外，\\(\\mu_1,\\mu_2,\\dots,\\mu_t\\) 和 \\(\\sigma_i^2\\) 在统计上是独立的。 1.3 线性组合的推断：检验与置信区间 本节提供均值模型中参数线性函数的假设检验和置信区间。上一节中的结果可用于检验有关单个 \\(\\mu_i\\) 的假设。这些结果也可用于检验有关 \\(\\mu_i\\) 线性组合的假设或构造 \\(\\mu_i\\) 线性组合的置信区间。 对于涉及几种处理的实验，研究者选择研究中的处理是因为存在需要研究的有趣假设。这些有趣的假设形成了研究的目的。涉及处理的假设很可能涉及方法的特定线性组合。这些线性组合使研究者得以比较不同处理的效应，或者等价地，比较不同处理或总体的平均值。如下所示，其中 \\(c_1,c_2,\\dots,c_t\\) 和 \\(a\\) 为某组已知常数： \\[H_{01}{:}\\,\\sum_{i=1}^{t}c_{i}\\mu_{i}=a\\,\\mathrm{~vs.~}\\, H_{a1}{:}\\mathrm{~(not~}H_{01}{:})\\\\ H_{02}{:}\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\,\\mathrm{~vs.~}\\,H_{a2}{:}\\mathrm{~(not~}H_{02}{:})\\\\ H_{03}{:}\\,\\mu_i=\\mu_{i^\\prime}\\text{ for some }i\\neq i^{\\prime}\\mathrm{~vs.~}H_{a3}{:}\\mathrm{~(not~}H_{03}{:})\\] 对于 \\(H_{01}\\) 给出的线性组合，可以证明： \\[\\begin{equation} \\frac{\\sum_{i=1}^tc_i\\hat{\\mu}_i-\\sum_{i=1}^tc_i\\mu_i}{\\sqrt{\\hat{\\sigma}^2\\sum_{i=1}^tc_i^2/n_i}}\\thicksim t_{\\Tiny{N-t}} \\tag{1.4} \\end{equation}\\] 这个结果可以用来推断形式为 \\(\\sum_{i=1}^tc_i\\mu_i\\) 的线性组合。由于 \\(H_{03}\\) 中的假设可以写为 \\(H_{03}:\\,\\mu_i-\\mu_{i^\\prime}=0\\)，它是 \\(H_{01}\\) 的特殊情况，其中 \\(c_i=1,c_{i^\\prime}=-1\\)，且 \\(c_k=0\\) 如果 \\(k\\ne i\\) 或 \\(i^\\prime\\). \\(H_{02}\\) 的一个检验在 1.5 节给出。\\(\\sum_{i=1}^tc_i\\hat{\\mu}_i\\) 的标准误估计为 \\[\\begin{equation} \\widehat{s.e.}\\left(\\sum c_i\\hat{\\mu}_i\\right)=\\sqrt{\\hat{\\sigma}^2\\sum\\frac{c_i^2}{n_i}} \\tag{1.5} \\end{equation}\\] 为了检验 \\(H_{01}{:}\\,\\sum_{i=1}^{t}c_{i}\\mu_{i}=a\\,\\mathrm{~vs.~}\\, H_{a1}{:}\\mathrm{~(not~}H_{01}{:})\\)，计算 \\(t\\) 统计量： \\[\\begin{equation} t_c=\\frac{\\sum c_i\\hat{{\\mu}}_i-a}{\\widehat{s.e.}\\left(\\sum c_i\\hat{\\mu}_i\\right)} \\tag{1.6} \\end{equation}\\] 如果 \\(|t_{c}| &gt;t_{\\alpha/2,v}\\)，其中 \\(v=N-t\\)，那么 \\(H_{01}\\) 在 \\(\\alpha100\\%\\)3显著性水平下被拒绝，其中 \\(t_{\\alpha/2,v}\\) 是自由度为 \\(v\\) 的 \\(t\\) 分布的上 \\(\\alpha/2\\) 分位数4。\\(\\sum_{i=1}^{t}c_{i}\\mu_{i}\\) 的 一个 \\((1-\\alpha)100\\%\\) 置信区间为 \\[\\begin{equation} \\sum c_i\\hat{\\mu}_i\\pm t_{\\alpha/2,v}\\widehat{s.e.}\\left(\\sum c_i\\hat{\\mu}_i\\right) \\tag{1.7} \\end{equation}\\] 1.4 示例：任务和脉搏率 表 1.1 中的数据来自一项实验，该实验旨在确定六种不同的工作任务如何影响工人的脉搏率。在这项实验中，\\(78\\) 名男性工人被随机分配到六个不同的组，每组 \\(13\\) 名工人。每组工人都接受了执行指定任务的培训。在培训后的选定一天，在工人完成指定任务 \\(1\\) 小时后测量他们的脉搏率。不幸的是，在训练过程中，一些个体退出实验，使得一些组包含少于 \\(13\\) 个个体。记录的数据表示 \\(20s\\) 内的心脏搏动次数，其中有 \\(N = 68\\) 个观测值，和为 \\(y = 2197\\). 表 1.1: 六项任务的脉搏数据和摘要信息 x 对于任务数据，\\(\\sigma^2\\) 的最佳估计为 \\[\\hat{\\sigma}^{2}=\\sum_{i=1}^{6}SS_{i}\\left(N-t\\right)=1,916.0761/62=30.9045\\] 基于 \\(62\\) 个自由度。\\(\\mu_i\\) 的最佳估计分别为 \\(\\hat\\mu_1 = 31.923,\\hat\\mu_2 = 31.083,\\hat\\mu_3 = 35.800,\\hat\\mu_4 = 38.000,\\hat\\mu_5 = 29.500\\) 和 \\(\\hat\\mu_6 = 28.818\\). 为了说明，假设研究者有兴趣回答以下关于任务均值线性组合的问题： 检验 \\(H_0:\\,\\mu_3=30\\,\\mathrm{~vs.~}\\,H_a:\\,\\mu_3\\ne30\\). 为 \\(\\mu_1\\) 构造 \\(95\\%\\) 置信区间。 检验 \\(H_0:\\,\\mu_4=\\mu_5\\,\\mathrm{~vs.~}\\,H_a:\\,\\mu_4\\ne\\mu_5\\). 检验 \\(H_0:\\,\\mu_1=(\\mu_2+\\mu_3+\\mu_4)/3\\,\\mathrm{~vs.~}\\,H_a:\\,\\mu_1\\ne(\\mu_2+\\mu_3+\\mu_4)/3\\). 为 \\(4\\mu_1-\\mu_3-\\mu_4-\\mu_5-\\mu_6\\) 构造 \\(90\\%\\) 置信区间。 这些问题可以通过应用本节的结果来回答。 a的结果。通过代入式 (1.6) 获得用于检验 \\(H_0:\\,\\mu_3=30\\) 的 \\(t\\) 统计量 \\[t_{c}=\\frac{\\hat{\\mu}_{3}-30}{\\widehat{s.e.}(\\hat{\\mu}_{3})}=\\frac{\\hat{\\mu}_{3}-30}{\\sqrt{\\hat{\\sigma}^{2}/n_{3}}}=\\frac{35.8-30.0}{\\sqrt{30.9045/10}}=3.30\\] 该 \\(t\\) 值的显著性概率是 \\(\\hat \\alpha = \\operatorname{Pr}\\{|t_c| &gt; 3.30\\} = 0.0016\\)，其中 \\(\\operatorname{Pr}\\{|t_c| &gt; 3.30\\}\\) 是具有 \\(62\\) 个自由度的 \\(t\\) 分布中 \\(3.30\\) 右侧的面积加上 \\(-3.30\\) 左侧的面积。上述 \\(\\hat\\alpha\\) 值是由电脑计算出来的，但也可由一些特别的手持计算器计算出来。没有电脑或计算器的读者，应比较 \\(t_c = 3.30\\) 与 \\(t_{\\alpha/2,62}\\) 来选择 \\(\\alpha\\). b的结果。\\(\\mu_1\\) 的 \\(95\\%\\) 置信区间由下式给出 \\[\\begin{aligned} \\hat{\\mu}_{1}\\pm t_{0.025,62}\\widehat{s.e.}(\\hat{\\mu}_{1})&amp; =31.923\\pm2.00\\sqrt{30.9045/13} \\\\ &amp;=31.923\\pm2.00\\times1.542 \\end{aligned}\\] 因此 \\(\\mu_1\\) 的 \\(95\\%\\) 置信区间为 \\(28.839&lt;\\mu_1&lt;35.007\\)，我们有 \\(95\\%\\) 的把握认为这个区间包含了未知的真实值 \\(\\mu_1\\). c的结果。为检验 \\(H_0:\\,\\mu_4=\\mu_5\\)，令 \\(l_1=\\mu_4-\\mu_5\\)，那么 \\(\\hat l_1=\\hat \\mu_4-\\hat\\mu_5=38.0-29.5=8.5\\)。由于 \\(c_1=c_2=c_3=c_6=0,c_4=1,c_5=-1\\)，那么 \\[\\widehat{s.e.}(\\hat{l}_{1})=\\sqrt{\\hat{\\sigma}^{2}\\sum_{i=1}^{6}c_{i}^{2}/n_{i}}=\\sqrt{30.9045{\\left(\\frac{1}{10}+\\frac{1}{12}\\right)}}=2.380\\] 用于检验 \\(H_0:\\,\\mu_4=\\mu_5\\) 的 \\(t\\) 统计量为 \\[t_c=\\frac{8.5}{2.380}=3.57\\] 该检验的显著性概率为 \\(\\hat\\alpha=0.0007\\). d的结果。检验 \\(H_0:\\,\\mu_1=(\\mu_2+\\mu_3+\\mu_4)/3\\) 等价于检验 \\(H_0:\\,\\mu_1-\\frac{1}{3}\\mu_2-\\frac{1}{3}\\mu_3-\\frac{1}{3}\\mu_4=0\\) 或检验 \\(H_0:\\,3\\mu_1-\\mu_2-\\mu_3-\\mu_4=0\\). 选择最后一个版本，计算稍微容易一些，并且 \\(t_c\\) 检验统计量的值相对于常数乘数是不变的。 令 \\(l_2=3\\mu_1-\\mu_2-\\mu_3-\\mu_4\\)，那么 \\[\\hat{l}_2=3\\hat{\\mu}_1-\\hat{\\mu}_2-\\hat{\\mu}_3-\\hat{\\mu}_4=3(31.923)-31.083-35.8-38.0=-9.114\\] \\(\\hat l_2\\) 的标准误估计为 \\[\\widehat{s.e.}(\\hat{l}_2)=\\sqrt{30.9045{\\left(\\frac9{13}+\\frac1{12}+\\frac1{10}+\\frac1{10}\\right)}}=5.491\\] 用于检验 \\(H_0:\\,3\\mu_1-\\mu_2-\\mu_3-\\mu_4=0\\) 的 \\(t\\) 统计量为 \\[t_c=\\frac{-9.114}{5.491}=-1.66\\] 该检验的显著性概率为 \\(\\hat\\alpha=0.1020\\). e的结果。令 \\(l_{3}=4\\mu_{1}-\\mu_{3}-\\mu_{4}-\\mu_{5}-\\mu_{6}\\). 那么 \\(\\hat{l}_{3}=-4.426\\) 且 \\(\\widehat{s.e.}(\\hat{l}_{3})=7.0429\\). \\(l_3\\) 的 \\(90\\%\\) 置信区间为 \\[\\hat{l}_{3}\\pm t_{0.05,62}\\widehat{s.e.}\\left(\\hat{l}_{3}\\right)=-4.426\\pm1.671\\times7.043=-4.426\\pm11.769\\] 因此 \\(90\\%\\) 置信区间为 \\(-16.195&lt;4\\mu_1-\\mu_3-\\mu_4-\\mu_5-\\mu_6&lt;7.343\\). 1.5 几个线性组合的同时检验 在许多情况下，研究人员希望检验关于处理效应或均值的几个线性组合的同时假设 (simultaneous hypothesis)。例如，涉及处理均值的 \\(k\\) 个线性独立线性组合 (linearly independent linear combinations) 的一般假设可以表示为： \\[\\begin{equation} H_0{:}\\quad\\begin{aligned}c_{11}\\mu_1+c_{12}\\mu_2+&amp;\\cdots+c_{1t}\\mu_t=a_1\\\\c_{21}\\mu_1+c_{22}\\mu_2+&amp;\\cdots+c_{2t}\\mu_t=a_2\\\\&amp;\\vdots\\\\c_{k1}\\mu_1+c_{k2}\\mu_2+&amp;\\cdots+c_{kt}\\mu_t=a_k\\end{aligned}\\quad\\mathrm{~vs.~}\\quad H_a{:}(\\operatorname{not}H_0) \\tag{1.8} \\end{equation}\\] 本节中给出的结果是用向量和矩阵来说明的。然而，对于有矩阵处理软件的读者来说，向量和矩阵的知识并不是真正必要的，因为大多数计算机甚至允许新手用户轻松地进行矩阵计算。 式 (1.8) 中的假设可以用矩阵表示法写为： \\[\\begin{equation} H_0{:}\\,\\boldsymbol{C}\\boldsymbol\\mu=\\boldsymbol a\\quad\\mathrm{~vs.~}\\quad H_a{:}\\,\\boldsymbol{C}\\boldsymbol\\mu\\neq\\boldsymbol a \\tag{1.9} \\end{equation}\\] 其中 \\[\\begin{equation} \\boldsymbol{C}=\\begin{bmatrix}c_{11}&amp;c_{12}&amp;\\cdots&amp;c_{1t}\\\\c_{21}&amp;c_{22}&amp;\\cdots&amp;c_{2t}\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\c_{k1}&amp;c_{k2}&amp;\\cdots&amp;c_{kt}\\end{bmatrix},\\quad\\boldsymbol{\\mu}=\\begin{bmatrix}\\mu_{1}\\\\\\mu_{2}\\\\\\vdots\\\\\\mu_{t}\\end{bmatrix},\\quad\\mathrm{and}\\quad\\boldsymbol{a}=\\begin{bmatrix}a_{1}\\\\a_{2}\\\\\\vdots\\\\a_{k}\\end{bmatrix} \\tag{1.10} \\end{equation}\\] 假设 \\(\\boldsymbol C\\) 中的 \\(k\\) 行是线性独立的，这意味着 \\(\\boldsymbol C\\) 中没有一行可以表示为其余行的线性组合。如果 \\(\\boldsymbol C\\) 中的 \\(k\\) 行不是线性独立的，那么总是可以选择 \\(\\boldsymbol C\\) 的子集：包含所有线性独立的行，它们包含关于所需假设的所有必要信息。 例如，假设你有三种处理，你希望检验 \\[H_0{:}\\,\\mu_1-\\mu_2=0,\\,\\mu_1-\\mu_3=0\\quad\\mathrm{and}\\quad\\mu_2-\\mu_3=0\\] 相应的 \\(\\boldsymbol C\\) 矩阵为 \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0\\\\1&amp;0&amp;-1\\\\0&amp;1&amp;-1\\end{bmatrix}\\] 但是 \\(\\boldsymbol C\\) 的第三行是第二行和第一行之间的差，因此这三行不是线性独立的。此时，一个等价的假设可以表述为 \\(H_{0}\\colon\\,\\mu_{\\mathrm{l}}-\\mu_{2}=0\\mathrm{~and~}\\mu_{\\mathrm{l}}-\\mu_{\\mathrm{3}}=0\\)，因为如果 \\(\\mu_1-\\mu_2=0\\) 且 \\(\\mu_1-\\mu_3=0\\)，那么 \\(\\mu_2-\\mu_3\\) 必为 \\(0\\). 下面的讨论使用 \\(\\boldsymbol C\\) 的行是线性独立的假设。 将样本均值向量表示为 \\(\\hat{\\boldsymbol \\mu}\\)，则 \\(\\hat{\\boldsymbol \\mu}\\) 抽样分布的矩阵表示为 \\[\\left.\\hat{\\boldsymbol{\\mu}}\\sim {N_t}(\\boldsymbol{\\mu},{\\sigma}^2\\boldsymbol{D})\\quad\\mathrm{~其中~}\\quad \\boldsymbol D=\\left[\\begin{array}{ccccc}1/n_1&amp;0&amp;\\cdots&amp;0\\\\0&amp;1/n_2&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;1/n_t\\end{array}\\right.\\right]\\] 此式读作：\\(t×1\\) 向量 \\(\\hat{\\boldsymbol \\mu}\\) 的元素的联合抽样分布为 \\(t\\) 元正态分布，其均值为 \\(\\boldsymbol \\mu\\)，方差和协方差由矩阵 \\(\\boldsymbol \\sigma^2\\boldsymbol D\\) 中的元素给出。\\(\\boldsymbol \\sigma^2\\boldsymbol D\\) 第 \\(i\\) 个对角元为 \\(\\hat\\mu_i\\) 的方差，非对角元 \\((i,\\,j)\\) 为 \\(\\hat\\mu_i,\\hat\\mu_j\\) 的协方差。 \\(\\boldsymbol C \\hat{\\boldsymbol \\mu}\\) 的抽样分布为 \\[\\boldsymbol C\\hat{\\boldsymbol{\\mu}}\\sim N_k(\\boldsymbol C\\boldsymbol{\\mu},\\sigma^2 \\boldsymbol {CDC}^{\\prime})\\] 偏离 \\(H_0\\) 的平方和或用于检验 \\(H_0{:}\\,\\boldsymbol C \\boldsymbol \\mu =\\boldsymbol a\\) 的平方和由下式给出 \\[\\begin{equation} SS_{H0}=(\\boldsymbol C\\boldsymbol{\\hat{\\mu}}-\\boldsymbol{a})^{\\prime}(\\boldsymbol{C}\\boldsymbol D\\boldsymbol{C}^{\\prime})^{-1}(\\boldsymbol{C}\\hat{\\boldsymbol{\\mu}}-\\boldsymbol{a}) \\tag{1.11} \\end{equation}\\] 基于 \\(k\\) 个自由度，即 \\(\\boldsymbol C\\) 线性无关行的数量。利用正态性假设，\\(SS_{H0}/\\sigma^2\\) 的抽样分布为自由度为 \\(k\\) 的非中心卡方分布，如果 \\(H_0\\) 为真，则 \\(SS_{H_0}/\\sigma^2\\sim\\chi^2_k\\). 用于检验 \\(H_0\\) 的统计量为 \\[F_c=\\frac{SS_{H0}/k}{\\hat{\\sigma}^2}\\] 若 \\(F_c&gt;F_{\\alpha,k,N-t}\\)，其中 \\(F_{\\alpha,k,N-t}\\) 是分子分母自由度分别为 \\(k\\) 和 \\(N-t\\) 的 \\(F\\) 分布的上 \\(\\alpha\\) 分位数，假设 \\(H_0{:}\\,\\boldsymbol C\\boldsymbol \\mu=\\boldsymbol \\alpha\\). 这里给出的结果是 Graybill (1976) 中定理 6.3.1 的特殊情况。 当 \\(H_0\\) 为真，\\(\\frac{SS_{H0}/k}{\\hat{\\sigma}^2}\\) 为 \\(\\sigma^2\\) 的无偏估计，然后将其与 \\(\\hat\\sigma^2\\) 进行比较，而无论 \\(H_0\\) 是否为真，\\(\\hat\\sigma^2\\) 又是 \\(\\sigma^2\\) 的无偏估计。因此若 \\(H_0\\) 为真，上面给出的 \\(F\\) 统计量应该接近 \\(1\\)。若 \\(H_0\\) 为假， \\(SS_{H0}/k\\) 是下式的无偏估计 \\[\\sigma^2+\\frac1k(\\boldsymbol C\\boldsymbol\\mu-\\boldsymbol a)^{\\prime}(\\boldsymbol C\\boldsymbol D\\boldsymbol C^{\\prime})^{-1}(\\boldsymbol C\\boldsymbol\\mu-\\boldsymbol a)\\] 因此，若 \\(H_0\\) 为假，则 \\(F\\) 统计量的值应大于 \\(1\\) 。若计算的 \\(F\\) 统计量显著大于 \\(1\\) ，则拒绝假设 \\(H_0\\). 1.6 示例：任务和脉搏率（续） 以下是 1.4 节示例中的信息总结，包含六项任务中每项任务的样本量和平均值。 任务 \\(i\\) \\(1\\) \\(2\\) \\(3\\) \\(4\\) \\(5\\) \\(6\\) \\(n_i\\) \\(13\\) \\(12\\) \\(10\\) \\(10\\) \\(12\\) \\(11\\) \\(\\bar y_{i\\cdot}\\) \\(31.9231\\) \\(31.0833\\) \\(35.8000\\) \\(38.0000\\) \\(29.5000\\) \\(28.8182\\) 方差的合并估计为 \\(\\hat\\sigma^2 = 30.9045\\)，基于 \\(62\\) 个自由度。与均值向量估计抽样分布相关的 \\(\\boldsymbol D\\) 矩阵为 \\[\\boldsymbol D=\\begin{bmatrix}\\frac1{13}&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;\\frac1{12}&amp;0&amp;0&amp;0&amp;0\\\\0&amp;0&amp;\\frac1{10}&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;\\frac1{10}&amp;0&amp;0\\\\0&amp;0&amp;0&amp;0&amp;\\frac1{12}&amp;0\\\\0&amp;0&amp;0&amp;0&amp;0&amp;\\frac1{11}\\end{bmatrix}\\] 假设研究者有兴趣同时检验以下假设 (simultaneously testing the following hypothesis)，该假设涉及任务均值的两个线性组合： \\[H_0{:}\\,\\mu_4-\\mu_5=4\\,\\mathrm{~and~}\\,3\\mu_1-\\mu_2-\\mu_3-\\mu_4=0\\,\\mathrm{~vs.~}\\,H_a{:}\\,(\\operatorname{not}H_0)\\] 提供 \\(SS_{H0}\\) 值所需的初步计算如下： \\[\\begin{aligned} \\boldsymbol{C\\hat{\\mu}}-\\boldsymbol{a}&amp; =\\begin{bmatrix}8.5-4\\\\-9.114-0\\end{bmatrix}=\\begin{bmatrix}4.500\\\\-9.114\\end{bmatrix} \\\\ \\boldsymbol C\\boldsymbol D \\boldsymbol C^\\prime&amp; =\\begin{bmatrix}\\dfrac{1}{10}+\\dfrac{1}{12}&amp;-\\dfrac{1}{10}\\\\-\\dfrac{1}{10}&amp;\\dfrac{9}{13}+\\dfrac{1}{12}+\\dfrac{1}{10}+\\dfrac{1}{10}\\end{bmatrix} \\\\ &amp;=\\begin{bmatrix}0.1833&amp;-0.1000\\\\-0.1000&amp;0.9756\\end{bmatrix} \\\\ (\\boldsymbol C \\boldsymbol D \\boldsymbol C^{\\prime})^{-1}&amp; =\\begin{bmatrix}5.7776&amp;0.5922\\\\0.5922&amp;1.0856\\end{bmatrix} \\end{aligned}\\] 以及 \\[SS_{H0}=(\\boldsymbol C\\hat{\\boldsymbol \\mu}-\\boldsymbol a)^{\\prime}(\\boldsymbol C\\boldsymbol D\\boldsymbol C^{\\prime})^{-1}(\\boldsymbol C\\hat{\\boldsymbol \\mu}-\\boldsymbol a)=158.602\\] 自由度为 \\(2\\). 检验统计量为 \\[F_c=\\frac{158.602/2}{30.9045}=2.566\\] 该 \\(F\\) 统计量的显著性概率为 \\(\\hat{\\alpha}=\\mathrm{Pr}\\{F&gt;2.566\\}=0.0850\\). 1.7 检验所有均值相等 大多数研究人员感兴趣的第一个假设通常是检验平均值是否同时相等。假设为 \\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\,\\mathrm{~vs.~}H_{a}{:}\\,(\\operatorname{not}H_{0})\\)。检验等均值假设可使用两个基本程序。对于本章讨论的特定情况，这两个程序给出相同的统计检验。然而，对于大多数混乱数据的情况（对于除单向外的处理结构），这两个程序可以给予不同的检验。第一个程序将在本节介绍，而第二个程序将在 1.9 节介绍。 等均值假设 \\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\) 与下列形式的假设等价：\\(H_{0}\\,\\colon\\mu_{1}-\\mu_{2}=0,\\mu_{1}-\\mu_{3}=0,\\ldots,\\mu_{1}-\\mu_{t}=0\\)，或与涉及 \\(\\mu_i\\) 的 \\(t - 1\\) 个线性独立线性组合的任何其它假设等价。对应于 \\(t - 1\\) 个成对差异集合的 \\(\\boldsymbol C\\) 矩阵和 \\(\\boldsymbol a\\) 向量为： \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0&amp;0&amp;\\cdots&amp;0\\\\1&amp;0&amp;-1&amp;0&amp;\\cdots&amp;0\\\\1&amp;0&amp;0&amp;-1&amp;\\cdots&amp;0\\\\1&amp;0&amp;0&amp;0&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\1&amp;0&amp;0&amp;0&amp;\\cdots&amp;-1\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{a}=\\begin{bmatrix}0\\\\0\\\\0\\\\0\\\\\\vdots\\\\0\\end{bmatrix}\\] 对应于 \\(\\mu_i\\) 的以下 \\(t - 1\\) 个线性无关线性组合的集合 \\(H_{0}{:}\\,\\mu_{1}-\\mu_{2}=0,\\mu_{1}+\\mu_{2}-2\\mu_{3}=0,\\mu_{1}+\\mu_{2}+\\mu_{3}-3\\mu_{4}=0,\\ldots,\\mu_{1}+\\mu_{2}+\\cdots-\\left(t-1\\right)\\mu_{t}=0\\) 的 \\(\\boldsymbol C\\) 和 \\(\\boldsymbol a\\) 向量为： \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0&amp;0&amp;\\cdots&amp;0\\\\1&amp;1&amp;-2&amp;0&amp;\\cdots&amp;0\\\\1&amp;1&amp;1&amp;-3&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;0\\\\1&amp;1&amp;1&amp;1&amp;\\cdots&amp;t-1\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{a}=\\begin{bmatrix}0\\\\0\\\\0\\\\\\vdots\\\\0\\end{bmatrix}\\] 存在许多其他矩阵使得 \\(\\boldsymbol C \\boldsymbol \\mu = \\boldsymbol 0\\) 当且仅当 \\(\\mu_1 = \\mu_2 = \\cdots = \\mu_t\\)；然而所有这些矩阵产生相同的偏离 \\(H_0\\) 的平方和以及相同的自由度 \\(t - 1\\)，因此产生相同的 \\(F\\) 统计量。对于这种特殊情况，式 (1.11) 总可以简化为： \\[\\begin{equation} SS_{H0:\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}}=\\sum_{i=1}^{t}n_{i}(\\overline{y}_{i.}-\\overline{y}_{..})^{2}=\\sum_{i=1}^{t}\\left(\\frac{y_{i.}^{2}}{n_{i}}\\right)-\\frac{y_{..}^{2}}{N} \\tag{1.12} \\end{equation}\\] 1.8 示例：任务和脉搏率（续） 对于 1.4 节中的任务和脉搏数据，使用式 (1.11) 和 (1.12) 可计算 \\(SS_{H0:\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}}\\). 使用式 (1.12) 可得到 \\[\\begin{aligned} SS_{H0}&amp; =\\frac{415^2}{13}+\\frac{373^2}{12}+\\frac{358^2}{10}+\\frac{380^2}{10}+\\frac{354^2}{12}+\\frac{317^2}{11}-\\frac{2197^2}{68} \\\\ &amp;=694.4386 \\end{aligned}\\] 自由度为 \\(t - 1 = 5\\). \\(F_c\\) 统计量的值为 \\[F_c=\\frac{694.4386/5}{30.9045}=4.49\\] 并且显著性概率为 \\(\\hat \\alpha = 0.0015\\). 然后，使用式 (1.11)，矩阵 \\(\\boldsymbol C\\)，向量 \\(\\boldsymbol a\\) 和矩阵 \\(\\boldsymbol D\\) 为 \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0&amp;0&amp;0&amp;0\\\\1&amp;0&amp;-1&amp;0&amp;0&amp;0\\\\1&amp;0&amp;0&amp;-1&amp;0&amp;0\\\\1&amp;0&amp;0&amp;0&amp;-1&amp;0\\\\1&amp;0&amp;0&amp;0&amp;0&amp;-1\\end{bmatrix},\\quad \\boldsymbol a=\\begin{bmatrix}0\\\\0\\\\0\\\\0\\\\0\\end{bmatrix}\\] \\[\\boldsymbol D=\\begin{bmatrix}\\frac{1}{13}&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;\\frac{1}{12}&amp;0&amp;0&amp;0&amp;0\\\\0&amp;0&amp;\\frac{1}{10}&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;\\frac{1}{10}&amp;0&amp;0\\\\0&amp;0&amp;0&amp;0&amp;\\frac{1}{12}&amp;0\\\\0&amp;0&amp;0&amp;0&amp;0&amp;\\frac{1}{11}\\end{bmatrix}\\] 接下来，计算式 (1.11) 中的各个量 \\[\\boldsymbol{C\\hat{\\boldsymbol{\\mu}}}-\\boldsymbol{a}=\\begin{bmatrix}0.844\\\\-3.877\\\\-6.077\\\\2.423\\\\3.105\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{C}\\boldsymbol D\\boldsymbol{C}^{\\prime}=\\begin{bmatrix}\\frac{25}{156}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}\\\\\\frac1{13}&amp;\\frac{23}{130}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}\\\\\\frac1{13}&amp;\\frac1{13}&amp;\\frac{23}{130}&amp;\\frac1{13}&amp;\\frac1{13}\\\\\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac{25}{156}&amp;\\frac1{13}\\\\\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac{24}{143}\\end{bmatrix}\\] \\(\\boldsymbol{CDC&#39;}\\) 的逆为 \\[(\\boldsymbol{CDC&#39;})^{-1}=\\begin{bmatrix}9.882&amp;-1.765&amp;-1.765&amp;-2.118&amp;-1.941\\\\-1.765&amp;8.529&amp;-1.471&amp;-1.765&amp;-1.618\\\\-1.765&amp;-1.471&amp;8.529&amp;-1.765&amp;-1.618\\\\-2.118&amp;-1.765&amp;-1.765&amp;9.882&amp;-1.941\\\\-1.941&amp;-1.618&amp;-1.618&amp;-1.941&amp;9.221\\end{bmatrix}\\] 最后，平方和的值为 \\[SS_{H0}=(\\boldsymbol C\\hat{\\boldsymbol{\\mu}}-\\boldsymbol{a})^{\\prime}(\\boldsymbol C\\boldsymbol D\\boldsymbol{C}^{\\prime})^{-1}(\\boldsymbol{C}\\hat{\\boldsymbol{\\mu}}-\\boldsymbol{a})=694.4386\\] 这与使用式 (1.12) 计算的平方和相同。 显然，如果必须手工计算，这个公式并不容易使用。然而，在许多混乱数据的情况下，为了获得检验有意义假设的统计量，像这样的公式是必要的。幸运的是，通过利用计算机，可以为特定假设构造 \\(\\boldsymbol C\\)矩阵，然后可以让计算机进行繁琐的计算。 1.9 比较两种模型的一般方法：条件误差原理 计算检验统计量的第二个过程是比较两个模型的拟合度。在本节中，比较的两个模型是 \\(y_{ij} = \\mu_i + \\varepsilon_{ij}\\)，这叫做一般 (general) 或未缩减模型 (unreduced model)，\\(y_{ij} = \\mu_i + \\varepsilon_{ij}\\)，这是如果 \\(H_0:\\,\\mu_1 = \\mu_2 = \\cdots = \\mu_t = \\mu\\)（假设）成立时得到的模型。第一个模型称为完全模型 (full model) 或无约束模型 (unrestricted model)，第二个模型称为缩减模型 (reduced model) 或约束模型 (restricted model). 条件误差原理 (principle of conditional error) 用于比较两个模型，其中一个模型是通过对另一个模型的参数施加限制而获得的。该原理非常简单，要求获得完全模型和缩减模型的残差或误差平方和。令 \\(ESS_F\\) 表示拟合完全模型得到的误差平方和，\\(ESS_R\\) 表示拟合缩减模型得到的误差平方和。则由于假设的限制而导致的，或由于偏离零假设的平方和为 \\(SS_{H0}=ESS_R-ESS_F\\). \\(ESS_R\\) 和 \\(ESS_F\\) 的自由度由数据集中的观测总数与待估计的（基本）参数数量之差给出 [基本参数 (essential parameters) 将在第 6 章中讨论]。分别用 \\(df_R\\) 和 \\(df_F\\) 表示与 \\(ESS_R\\) 和 \\(ESS_F\\) 对应的自由度。对应于 \\(SS_{H0}\\) 的自由度为 \\(df_{H0} = df_R - df_F\\). 用于检验 \\(H_0\\) 的 \\(F\\) 统计量由下式给出： \\[F_c=\\frac{SS_{H0}/df_{H0}}{ESS_F/df_F}\\] 若 \\(F_{c}&gt;F_{\\alpha,df_{{H0}},df_{F}}\\)，则在显著性水平下拒绝 \\(H_0\\). 对于上面讨论的情况，\\(y_{ij} = \\mu_i + \\varepsilon_{ij}\\) 是完全模型而 \\(y_{ij} = \\mu + \\varepsilon_{ij}\\) 是缩减模型。完全模型的误差平方和为 \\[ESS_{F}=\\sum_{i=1}^{t}\\sum_{j=1}^{n_{i}}(y_{ij}-\\overline{y}_{i\\cdot})^{2}=(N-t)\\hat{\\sigma}^{2}\\] 其自由度 \\(df_F=N-t\\). 缩减模型的误差平方和为 \\[ESS_{_R}=\\sum_{i=1}^{t}\\sum_{j=1}^{n_{i}}(y_{_{ij}}-\\overline{y}_{\\cdot\\cdot})^{2}\\] 其自由度 \\(df_R=N-1\\). 因此，由于偏离 \\(H_0\\) 而产生的平方和为： \\[SS_{H0{:}\\,\\mu_1=\\mu_2=\\cdots=\\mu_t}=ESS_{R}-ESS_{F}=\\sum_{i=1}^{t}n_{i}(\\overline{y}_{i\\cdot}-\\overline{y}_{\\cdot\\cdot})^{2}\\] 其自由度为 \\(t-1\\). 这与式 (1.12) 得到的平方和相同。 在检验情况下感兴趣的平方和通常被放在一个叫做方差分析 (analysis of variance, ANOVA)表的表格中，这样的表格通常有类似于表 1.2 的形式，在 “source of variation” 栏下的条目被分组为多个集合。在给定的情况下，每组只使用一个标签，选择完全由实验者决定。 表 1.2: 单向模型检验均值相等的方差分析表 x 注释: df=degrees of freedom 表示自由度, SS=sum of square 表示平方和, MS=mean square 表示均方. 这些标准缩写贯穿本书 1.10 示例：任务和脉搏率（续） 条件误差原则也被称为模型比较程序，其过程相当灵活。例如，如果对检验任务和脉搏率数据的假设感兴趣，例如 \\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\mu_{3}\\,\\mathrm{~vs.~}\\,H_{a}\\colon\\,(\\mathrm{not}\\,H_{0})\\)，那么在 \\(H_0\\) 的条件下模型有如下形式 \\[\\begin{array}{ll}y_{ij}=\\mu_0+\\varepsilon_{ij}&amp;\\mathrm{~for~}i=1,2,3\\\\y_{ij}=\\mu_i+\\varepsilon_{ij}&amp;\\mathrm{~for~}i=4,5,6\\end{array}\\] 这样的模型可以使用大多数软件包来拟合，其中包含一个定性或分类变量，当任务为 \\(1,2,3\\) ，其值为 \\(0\\)，当任务为 \\(4,5,6\\) ，其值等于任务值. 1.11 计算机分析 将条件误差原理应用于 1.4 节的任务和脉搏率数据，以提供等均值假设的检验，\\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\mu_{3}=\\mu_{4}=\\mu_{5}=\\mu_{6}\\,\\mathrm{~vs.~}\\,H_{a}\\colon(\\mathrm{not}\\,H_{0})\\). 完全模型的误差平方和为 \\(ESS_F=1916.076\\), \\(df_F=62\\). 缩减模型的误差平方和为 \\(ESS_R=73593-(2197)^2/68=2610.545\\), \\(df_R=67\\). 因此，\\(SS_{H0}=2610.545-1916.076=694.439\\), \\(df_{H0}=67-62=5\\). 汇总这些计算的方差分析表如表 1.3 所示。 表 1.3: 任务和脉搏率数据检验均值相等的方差分析表 x 本章最后介绍了一些关于使用计算机和统计计算软件包（如SAS®、BMDP®、SYSTAT®、JMP®和SPSS®）的说明。前面章节中提供的所有方法和公式都可以在大多数计算机上轻松使用。如果计算机使用 MATLAB、SAS-IML 或 APL 等编程语言，则所需的矩阵计算很容易按照前面章节中给出的矩阵公式进行。SAS、JMP、BMDP、SYSTAT 和 SPSS 每个都包含程序，使用户能够生成自己的处理的线性组合，以检验假设。此外，这些包都提供了方差分析表、处理均值及其标准误的分析。表 1.4 包含 SAS-GLM 代码，其中包含检验任务和脉搏率数据所述假设所需的 estimate 语句和 contrast 的语句。estimate 语句用于评估均值的一个线性组合，提供的结果是对比的估计、其标准误估计并生成 \\(t\\) 统计量及其相应的显著性水平。contrast 语句用于评估均值的一个或多个线性组合，提供的结果是平方和、自由度和 \\(F\\) 统计量。对于SAS-GLM中的 estimate 和 contrast 语句，假设中的 \\(\\boldsymbol a\\) 的唯一值为零，也就是说，只能检验均值的线性组合等于零。 表 1.4: Proc GLM 代码，用于拟合任务和脉搏率数据，并提供文本中描述的分析所需的 estimate 和 contrast 语句 x 表 1.5 包含 SAS-IML 代码，为 1.6 节中检验的假设提供计算。通过用矩阵语言构造代码，可以得到 \\(\\boldsymbol C \\boldsymbol \\mu = \\boldsymbol a\\) 形式的任何假设的检验。 表 1.5: Proc IML代码执行 1.6 节中任务和脉搏率数据的计算 x 1.12 结束语 本章对单向方差分析模型进行了分析。提供了对不同处理的效应进行统计推断的一般程序，并对同质误差的情况进行了说明。介绍了获得实验设计模型的统计分析的两个基本程序。这些程序在本书的其余部分被广泛用于描述更复杂的模型设计的实验和更混乱的数据情况。还给出了同时比较所有处理效应均值的检验。这种检验可以被认为是统计分析的初始步骤。完成数据集分析所应使用的程序取决于是否拒绝处理均值相等的假设。 1.13 练习 本文将 “treatment” 统一翻译为 “处理” ，不论语境。↩︎ 本文将 “population” 统一翻译为 “总体”，不论语境。↩︎ 原文为 \\(\\alpha=100\\%\\)，应为笔误。↩︎ 原文为critical point，后同。↩︎ "],["chap2.html", "第 2 章 具有异质误差的完全随机设计结构中的单向处理结构 2.1 模型定义和假设 2.2 参数估计 2.3 方差齐性检验 2.4 示例：药物和错误 2.5 关于线性组合的推断 2.6 示例：药物和错误（续） 2.7 自由度的一般 Satterthwaite 近似 2.8 比较所有均值 2.9 结束语 2.10 练习", " 第 2 章 具有异质误差的完全随机设计结构中的单向处理结构 “Statistical thinking will one day be as necessary for efficient citizenship as the ability to read and write.” - H.G.Wells 在本章中，考虑分配给实验单元的处理可能影响响应的方差以及均值的情况。从单向均值模型 \\(y_{ij} = \\mu_i + \\varepsilon_{ij}\\) 开始，其中 \\(i = 1,2,\\cdots,t;\\,j =1,2,\\cdots,n_i\\). 在第 1 章中，假设实验误差都具有相同的方差；也就是说，预期处理可能会改变抽样总体的均值，但不会改变方差。当处理影响方差和均值时，本章描述了一些分析数据的方法。在这种情况下，实验者想要回答的关于平均值的问题类型与第 1 章中的类似。也就是说， 所有均值都相等吗？ 是否可以在均值之间进行成对比较？ 是否可以检验形如 \\(\\sum_{i=1}^tc_i\\mu_i=a\\) 的假设并为 \\(\\sum_{i=1}^tc_i\\mu_i\\) 构造置信区间？ 此外，关于方差还存在可能感兴趣的问题，例如 所有方差都相等吗？ 是否存在组内方差相等而组间方差不等的处理分组？ 在回答有关模型均值的问题之前，必须获得处理方差的适当描述。 方差齐性检验 (tests of homogeneity of variances) 用于回答有关各个处理的数据方差的问题。如果有两种处理，当方差不等时比较均值的问题通常被称为 Behrens–Fisher 问题。此外，异质误差方差被忽略比数据的非正态性带来了更严重的问题5。第一章中的程序在非正态性方面是稳健的，但在异质误差方差方面不是那么稳健。在之前考虑的分析中，假设总体方差都相等，这在许多情况下是合理的假设。当方差不等时，分析数据的一种方法是简单地忽略它们不等的事实，并计算在方差相等的情况下计算的相同的 \\(F\\) 统计量或 \\(t\\) 检验。也许令人惊讶的是，模拟研究表明，这些通常的检验都非常好，特别是当样本量都相等或几乎相等时。此外，如果较大的样本量对应于具有较大方差的处理或总体，那么用等方差假设计算的检验也相当好。事实上，通常的检验非常好，以至于许多统计学家甚至不建议对等方差进行检验。其他人试图找到一种能稳定处理方差的变换，即通过变换数据使处理方差相等。当方差不等时，有一些技术可以在不等方差模型的框架内对均值进行比较。 以下小节描述了单向模型的处理等方差的检验程序，以及当方差不等时分析处理均值的程序。当怀疑通常的技术时，应使用这些程序。接下来描述不等方差模型。 2.1 模型定义和假设 不等方差模型为 \\[\\begin{equation} y_{ij}=\\mu_{i}+\\varepsilon_{ij}\\quad\\mathrm{for}\\quad i=1,2,\\ldots,t,\\,j=1,2,\\ldots,n_{i}\\quad\\mathrm{and}\\quad\\varepsilon_{ij}\\sim\\text{independent}\\,N(0,\\sigma_{i}^{2}) \\tag{2.1} \\end{equation}\\] 其中 \\(\\varepsilon_{ij}\\sim\\text{independent}\\,N(0,\\sigma_{i}^{2})\\) 表示误差 \\(\\varepsilon_{ij}\\) 都是独立地服从正态分布，并且每个正态分布的方差取决于 \\(i\\)，对于每个总体或处理可能不同。 2.2 参数估计 模型中参数的最佳估计值： \\[\\hat{\\mu}_i=\\sum_{j=1}^{n_i}y_{ij}/n_i=\\bar{y}_{i\\cdot},\\quad i=1,2,\\ldots,t\\] 和 \\[\\hat\\sigma_i^2=\\frac{\\sum_{j=1}^{n_i}(y_{ij}-\\overline{y}_i)^2}{n_i-1},\\quad i=1,2,\\ldots,t\\] 与参数估计相关的抽样分布为 \\[\\hat{\\mu}_i\\thicksim\\text{independent}\\,N(\\mu_i,\\sigma_i^2/n_i),\\quad i=1,2,\\ldots,t\\] 和 \\[\\frac{\\left(n_i-1\\right)\\hat\\sigma_i^2}{\\sigma_i^2}\\thicksim\\text{independent }\\,\\chi_{n_i-1}^2,\\quad i=1,2,\\ldots,t\\] 这些抽样分布被用作建立等方差检验的基础，并在方差不等时提供均值分析。 2.3 方差齐性检验 本节描述了检验等方差假设的五个程序 \\[H_{0}\\colon\\,\\sigma_{1}^{2}=\\sigma_{2}^{2}=\\cdots=\\sigma_{t}^{2}\\,\\mathrm{~vs.~}\\,H_{a}\\colon(\\mathrm{not~}H_{0}:)\\] 在尝试分析均值之前，应研究等方差假设。如果没有足够的证据得出方差不等的结论，则可以使用第 1 章中的等方差模型来研究均值。如果有足够的证据认为方差不等，则应使用 2.5 节中描述的程序来提供不等方差框架中的均值分析。建议当不等方差假设在 \\(\\alpha\\le0.01\\) 时被拒绝时使用不等方差模型。 2.3.1 Hartley’s F-Max Test 所描述的第一个检验被称为 Hartley’s F-max检验 (Hartley, 1950). 该检验要求所有样本具有相同的大小，即 \\(n_1 = n_2 = \\cdots= n_t\\). 该检验基于统计量 \\[F_{\\max}=\\frac{\\max_i\\{\\hat\\sigma_i^2\\}}{\\min_i\\{\\hat\\sigma_i^2\\}}\\] 附表 A.1 提供了 \\(\\alpha = 0.05\\) 和 \\(0.01\\) 时 \\(F_{\\max}\\) 的百分位点。若 \\(F_{\\max} &gt; F_{\\max,\\alpha,v,k}\\)，其中 \\(v = n - 1\\) 为与 \\(k\\) 个处理方差中的每一个相关的自由度，则拒绝零假设 \\(H_0\\). 如果 \\(n_i\\) 不都相等，则可以通过取 \\(n=\\max_i\\{n_i\\}-1\\) 来获得 \\(H_0\\,\\mathrm{~vs.~} H_a\\) 的“自由” (liberal)检验。这个检验是自由的，因为它假设所有处理都有相同的（最大）样本量，所以你会比选定的显著性水平 \\(\\alpha\\) 更频繁地拒绝零假设6。当样本量相差不大7时，此程序提供了合理的检验。它还可以防止人们进行通常的方差分析，即使方差分析不合适的可能性极小。{#sec2-4} 节中有一个说明该检验使用的示例。 2.3.2 Bartlett’s Test 方差齐性检验的第二个检验是 (Bartlett, 1937) 提出的检验，其优点是不要求 \\(n_i\\) 相等。Bartlett 检验统计量为 \\[\\begin{equation} U=\\frac1C{\\left[v\\log_\\mathrm{e}(\\hat\\sigma^2)-\\sum_{i=1}^tv_i\\log_\\mathrm{e}(\\hat\\sigma_i^2)\\right]} \\tag{2.2} \\end{equation}\\] 其中 \\[v=n_i-1,\\quad v=\\sum_{i=1}^tv_i,\\quad\\hat\\sigma^2=\\sum_{i=1}^tv_i\\hat\\sigma_i^2/v \\] 且 \\[C=1+\\frac1{3(t-1)}{\\left[\\sum_{i=1}^t\\frac1{v_i}-\\frac1v\\right]}\\] 如果 \\(U&gt;\\chi_{\\alpha,t-1}^2\\)，则拒绝等方差假设。方差齐性的前两个检验的缺点之一是它们对偏离正态性以及偏离等方差假设非常敏感。 2.3.3 Levene’s Test Levene (1960) 建议对来自单向均值或效应模型的残差绝对值进行单向方差分析。残差绝对值由 \\(z_{ij}=|y_{ij}-\\overline{y}_{i\\cdot}|,i=1,2,\\ldots,t;j=1,2,\\ldots,n_{i}\\) 给出。方差分析的 \\(F\\) 检验提供残差绝对值的处理均值相等性检验。如果均值不等，则有证据表明，一种处理的残差平均而言大于另一种处理的残差。残差可以指导哪些方差不等，多重比较检验（见第 3 章）可以用来对这些均值进行成对比较。Levene’s Test 的一个改进是在方差分析中使用残差平方。 2.3.4 Brown and Forsythe’s Test Brown and Forsythe (1974) 使用 Levene 的过程，并通过对每个处理的观察值与中位数的偏差的绝对值进行单向方差分析来对其进行修改。中位数偏差的绝对值由 \\(u_{ij}=|y_{ij}-y_{i\\mathrm{med}}|,i=1,2,\\ldots,t;j=1,2,\\ldots,n_{i}\\) 给出。方差分析的 \\(F\\) 检验提供了偏差绝对值的处理均值相等性检验。如果均值不等，则有证据表明，一种处理的偏差平均而言大于另一种处理的偏差。偏离中位数的绝对值的均值可以提供关于哪些方差不等的指导，因为多重比较检验可以用于在这些均值之间进行成对比较。当数据的分布不对称时，这种利用中位数偏差的方法提供了比 Levene’s method 更大的功效。 2.3.5 O’Brien’s Test O’Brien (1979) 计算了一种得分 \\[\\begin{equation} r_{ij}=[(w+n_i-2)n_i(y_{ij}-\\overline{y}_{i\\cdot})^2-w\\hat\\sigma_i^2(n_i-1)]/[(n_i-1)(n_i-2)] \\tag{2.3} \\end{equation}\\] 其中 \\(w\\) 为权重参数。该程序是对计算出的得分进行方差分析。当 \\(w=0.5\\) 时，得分的均值是样本方差 \\(\\hat \\sigma^2_i\\)，因此得分均值的比较是数据方差的比较。 还有其他几种程序可用于使用参数和非参数方法来检验方差相等或尺度参数相等 [如 Conover et al. (1981) 和 Olejnik &amp; Algina (1987)]。McGaughey (2003) 提出了一种使用数据深度 (data depth) 概念的检验，并将该程序应用于单变量和多变量总体。数据深度超出了本书的范围。 2.3.6 一些建议 Conover (1981) 以及 Olejnik &amp; Algina (1987) 对方差检验的同质性进行了模拟研究，其中包括上述检验以及许多其他检验。研究表明，没有一种检验对所有情况都是稳健和具有最大功效的。根据 Olejnik 和 Algina，Levene’s Test 是 Conover 等人研究的更好的检验之一。O’Brien’s Test 似乎提供了一个合适的大小检验 (size test)，而不会损失太多功效。当分布具有重尾 (heavy tails) 时，Brown–Forsyth’s Test 似乎更好。根据他们的结果，我们提出以下建议： 如果分布具有较重的尾部，请使用 Brown–Forsyth’s test. 如果分布有些偏斜，请使用 O’Brien’s test. 如果数据几乎是正态分布的，那么任何检验都是合适的，包括 Bartlett’s 和 Hartley’s tests. Levene’s 和 O’Brien’s tests 可以很容易地进行定制，用于涉及多个因素的设计实验，包括协方差分析 (Milliken and Johnson, 2002). Levene’s, O’Brien’s 和 Brown–Forsyth’s tests 在正态分布数据方面几乎与 Bartlett’s 和 Hartley’s tests 一样好，在非正态分布的数据方面优于它们。Conover et al. 以及 Olejnik 和 Algina 讨论了一些非参数检验，但它们更难计算，并且上述推荐的检验几乎同样有效。下面是一个示例，其中演示了用于方差相等的每个检验。 2.4 示例：药物和错误 表 2.1 中的数据来自在两种可能的药物影响下对个体8进行的配对联想学习任务 (paired-association learning task) 实验。第1组为对照组（无药物），第2组给药1，第3组给药2，第4组同时给两种药。每组数据的样本量、总和、中位数、平均值和方差见表 2.1。 表 2.1: 配对联想学习任务实验数据 x F-max 统计量为 \\(F_\\max=16.286/1.867=8.723\\). 取 \\(k=t=4,v=7\\) 的自由 \\(5\\%\\) 临界点从表 A.1 得到。临界点为 \\(8.44\\)，由于 \\(8.723&gt;8.44\\)，以 \\(0.05\\) 的显著性水平拒绝 \\(H_{0}\\colon\\,\\sigma_{1}^{2}=\\sigma_{2}^{2}=\\cdots=\\sigma_{t}^{2}\\,\\mathrm{~vs.~}\\,H_{a}\\colon(\\mathrm{not~}H_{0}:)\\)，但不能在 \\(0.01\\) 的水平拒绝。 Bartlett’s test 的计算为： \\[C=1+\\frac1{3\\times3}{\\left(\\frac16+\\frac15+\\frac17+\\frac17-\\frac1{25}\\right)}\\] 且 \\[\\hat\\sigma^2=\\frac{6(16.2857)+5(1.8667)+7(9.6964)+7(2.7860)}{25}=7.7769\\] 因此 \\[\\begin{aligned} U&amp; =\\frac1C{\\left(v\\log_e\\hat\\sigma^2-\\sum_{i=1}^4v_i\\log_e\\hat\\sigma_i^2\\right)} \\\\ &amp;=\\frac1{1.068}[25\\log_{\\mathrm{e}}(7.7769)-6\\log_{\\mathrm{e}}(16.2857)-5\\log_{\\mathrm{e}}(1.8667) \\\\ &amp;-7\\log_{\\mathrm{e}}(9.6964)-7\\log_{\\mathrm{e}}(2.7860)] \\\\ &amp;=7.8111 \\end{aligned}\\] 与 \\(U\\) 相关的渐近抽样分布是基于自由度为 \\(3\\) 的卡方分布，检验的显著性水平为 \\(0.0501\\)，可以再次得出结论，方差在大约 \\(5\\%\\) 的显著性水平上是不等的。 Levene’s test 的计算从残差或观测值与处理均值的偏差的计算开始。接下来，如表 2.2 所示计算残差的绝对值。最后，对残差的这些绝对值进行单向方差分析。所得到的 \\(F\\) 统计量的值为 \\(6.97\\)，其基于自由度 \\(3,25\\)。观察到的 Levene’s test 的显著性水平为 \\(0.0015\\). 在进行方差分析之前，可以通过对表 2.2 中的项目进行平方来获得 Levene’s test 的平方偏差或平方残差版本。在这种情况下，\\(F\\) 统计量的值为 \\(7.36\\)，观察到的显著水平为 \\(0.0011\\)（也基于自由度 \\(3,25\\)）。 表 2.2: 计算 Levene’s test 的 \\(z_{ij} = |y_{ij}-y_{i\\cdot}|\\) 值，其中 \\(y_{ij}\\) 来自表 2.1 x Brown–Forsyth’s test 统计量是通过计算观察值与处理中位数偏差的绝对值（中位数见表 2.1）获得的。表 2.3 包含了与中位数偏差的绝对值。接下来，单向方差分析提供的 \\(F\\) 统计量为 \\(5.49\\)，并且观察到的显著性水平是 \\(0.0049\\)（也基于自由度 \\(3,25\\)）。 表 2.3: 观测结果相对于处理中位数偏差的绝对值 x 表 2.4 包含使用式 (2.3) 计算的 \\(r_{ij}\\) 值，其中 \\(w = 0.5\\). 通过进行方差分析获得 O’Brien’s test 统计量。\\(F\\) 统计量的值为 \\(6.30\\)，观察到的显著性水平为 \\(0.0025\\). 使用 \\(w = 0.7\\)（计算未显示）的 \\(F\\) 统计量值为 \\(5.90\\)，观察到的显著性水平为 \\(0.0035\\). 每个 O’Brien’s test 都基于自由度 \\(3,25\\). 表 2.4: 使用 \\(w=0.5\\) 进行 O’Brien’s Test 的得分 x 每个检验统计量表明，有足够的证据得出方差不等的结论。残差绝对值的组均值见表 2.5。这些处理的残差绝对值均值之间的成对比较见表 2.6。无药物和药物2的残差绝对值的平均值没有差异，药物1和同时给药没有差异，但是这两组之间存在差异。可以使用具有两个方差的简单模型来继续分析治疗均值。使用简单方差模型将提高一些关于均值检验的功效。两个方差模型和相应的均值比较将遵循使用四个方差的分析的讨论。 表 2.5: 残差绝对值均值 x 表 2.6: 残差绝对值组均值的成对比较 x 2.5 关于线性组合的推断 当方差 \\(\\sigma_i^2\\) 相差很大而无法应用第 1 章中讨论的检验和置信区间时，本节讨论了处理均值的任意线性组合 \\(\\sum_{i=1}^tc_i\\mu_i\\) 的假设检验和置信区间的构造问题。如果方差相等假设在 \\(0.01\\) 或 \\(1\\%\\) 水平被拒绝，建议使用本节和下一节中的程序。如果没有足够的证据证明方差不等，则可以使用第 1 章中的结果对处理均值进行推断。 \\(\\sum_{i=1}^tc_i\\mu_i\\) 的最佳估计为 \\(\\sum_{i=1}^tc_i\\hat \\mu_i\\)，其抽样分布为 \\[\\sum_{i=1}^tc_i\\hat{\\mu}_i\\sim N{\\left(\\sum_{i=1}^tc_i\\mu_i,\\sum_{i=1}^tc_i^2\\sigma_i^2/n_i\\right)}\\] 因此 \\[z=\\frac{\\sum_{i=1}^{t}c_{i}\\hat{{\\mu}}_{i}-\\sum_{i=1}^{t}c_{i}\\mu_{i}}{\\sqrt{\\sum_{i=1}^{t}c_{i}^{2}\\sigma_{i}^{2}/n_{i}}}\\sim N(0,1)\\] 当方差未知且不等时，一个明显可用于推断 \\(\\sum_{i=1}^tc_i\\mu_i\\) 的统计量为 \\[z=\\frac{\\sum_{i=1}^tc_i\\hat{\\mu}_i-\\sum_{i=1}^tc_i{\\mu}_i}{\\sqrt{\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2/n_i}}\\] 如果非零 \\(c_i\\) 对应的 \\(n_i\\) 都非常大，则可以合理地假设 \\(Z\\) 具有近似 \\(N(0,1)\\) 分布，因此 \\(Z\\) 可以用于推断 \\(\\sum_{i=1}^tc_i\\mu_i\\). 此时 \\(\\sum_{i=1}^tc_i\\mu_i\\) 的近似 \\((1 - \\alpha)100\\%\\) 置信区间由下式提供： \\[\\sum_{i=1}^tc_i\\hat{\\mu}_i\\pm z_{\\alpha/2}\\sqrt{\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2/n_i}\\] 如果\\(|z| &gt; z_{\\alpha/2}\\)，则在显著性水平 \\(\\alpha\\) 处拒绝 \\(H_0\\). 在其他情况下，注意 \\(z\\) 可以写为 \\[z=\\frac{\\left(\\sum_{i=1}^tc_i\\hat{{\\mu}}_i-\\sum_{i=1}^tc_i\\mu_i\\right)\\Big/\\sqrt{\\sum_{i=1}^tc_i^2\\sigma_i^2/n_i}}{\\sqrt{\\sum_{i=1}^tc_i^2\\hat{\\sigma}_i^2/n_i}\\Big/\\sqrt{\\sum_{i=1}^tc_i^2\\sigma_i^2/n_i}}\\] \\(z\\) 的分子具有标准正态分布，\\(z\\) 的分子和分母独立。\\(z\\) 的分布可以近似为 \\(t(v)\\) 分布，如果 \\(v\\) 的值可以使得 \\[V=v\\times\\frac{\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2\\big/n_i}{\\sum_{i=1}^tc_i^2\\sigma_i^2\\big/n_i}\\] 近似服从 \\(\\chi^2(v)\\). 为了在方差不等时得到 \\(V\\) 的分布的良好卡方近似，选择具有与 \\(V\\) 相同的前两阶矩的卡方分布。也就是说，为了在方差不等的情况下找到 \\(v\\)，求出 \\(v\\) 使得 \\(V\\) 的矩等于 \\(\\chi^2(v)\\) 分布的前两阶矩（这就是所谓的 Satterthwaite’s method ）。这导致自由度为： \\[{v}=\\frac{\\left(\\sum_{i=1}^tc_i^2\\sigma_i^2/n_i\\right)^2}{\\sum_{i=1}^t\\left[c_i^4\\sigma_i^4/n_i^2(n_i-1)\\right]}\\] 不幸的是，由于 \\(v\\) 取决于 \\(\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_t^2\\)，因此无法精确确定。通常的程序是通过下式来估计 \\(v\\)： \\[\\begin{equation} \\hat{{v}}=\\frac{\\left(\\sum_{i=1}^tc_i^2\\hat{\\boldsymbol\\sigma}_i^2/n_i\\right)^2}{\\sum_{i=1}^t\\left[c_i^4\\hat{\\sigma}_i^4/n_i^2(n_i-1)\\right]} \\tag{2.4} \\end{equation}\\] 综上所述，拒绝 \\(H_0\\colon\\sum_{i=1}^tc_i\\mu_i=a\\,\\mathrm{~vs.~}H_a{:}\\sum_{i=1}^tc_i\\mu_i\\neq a\\)，如果 \\[\\left|t_c\\right|=\\frac{\\left|\\sum_{i=1}^tc_i\\hat{\\mu}_i-a\\right|}{\\sqrt{\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2/n_i}}&gt;t_{\\alpha/2,\\hat{v}}\\] 其中 \\(\\hat v\\) 由式 (2.4) 确定。\\(\\sum_{i=1}^tc_i\\mu_i\\) 近似 \\((1 - \\alpha)100\\%\\) 置信区间由下式给出 \\[\\sum_{i=1}^tc_i\\hat{\\mu}_i\\pm t_{\\alpha/2,\\hat{v}}\\sqrt{\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2/n_i}\\] 不幸的是，每当人们想要检验一个新的假设或构造另一个置信区间时，自由度 \\(\\hat v\\) 必须重新估计。可以证明 \\(n_*-1\\leq\\hat{v}\\leq t(n^*-1)\\) 其中 \\(n_*=\\min\\{n_1,n_2,\\ldots,n_t\\}\\) 且 \\(n^*=\\max\\{n_1,n_2,\\ldots,n_t\\}\\). 因此，如果 \\(|t_c|&gt;t_{\\alpha/2,n_*-1}\\)，则可以保证 \\(|t_c|&gt;t_{\\alpha/2,\\hat{v}}\\)；如果 \\(|t_c|&lt;t_{\\alpha/2,t(n^*-1)}\\)，则可以保证 \\(|t_c|&lt;t_{\\alpha/2,\\hat{v}}\\). 此时我们可以避免计算 \\(\\hat v\\). 当 \\(t_{\\alpha/2,t(n^*-1)}&lt;|\\left.t_c\\right|&lt;t_{\\alpha/2,n^*-1}\\)，为了确定是否应该拒绝或不拒绝被检验的零假设，必须计算 \\(\\hat v\\) 的值。为了获取置信区间，通常需要计算 \\(\\hat v\\). 接下来，用药物误差的示例来证明前面的结果。 2.6 示例：药物和错误（续） 考虑表 2.1 中的数据，假设实验者有兴趣回答以下问题： 平均而言，药物对学习有任何影响吗？ 当给予两种药物时，个体犯的错误是否比只给予一种药物时更多？ 两种药物对错误数量的影响是否不同？ 为了回答第一个问题，可以检验三个药物组的均值等于对照组均值的假设。 \\[H_{01}{:}\\,l_1=\\mu_1-\\frac{(\\mu_2+\\mu_3+\\mu_4)}3=0\\mathrm{~vs~}H_{a1}{:}\\,l_1\\neq0\\] 该线性组合的估计为 \\[\\hat{l}_1=\\hat{\\mu}_1-\\frac{\\hat{\\mu}_2+\\hat{\\mu}_3+\\hat{\\mu}_4}3=4.571-\\frac13(34.042)=-6.776\\] \\(\\hat l_1\\) 相应的标准误估计为 \\[\\begin{aligned} s.e.(\\hat{l}_1)&amp; =\\sqrt{\\sum_{i=1}^4\\left(\\frac{c_i^2\\hat\\sigma_i^2}{n_i}\\right)} \\\\ &amp;=\\sqrt{\\frac{\\hat\\sigma_1^2}7+\\frac19{\\left(\\frac{\\hat\\sigma_2^2}6\\right)}+\\frac19{\\left(\\frac{\\hat\\sigma_3^2}8\\right)}+\\frac19{\\left(\\frac{\\hat\\sigma_4^2}8\\right)}}\\\\ &amp;=\\sqrt{2.535}\\\\ &amp;=1.592 \\end{aligned}\\] 与此标准误估计相关的近似自由度通过使用 \\[\\sum_{i=1}^4\\frac{c_i^4\\hat\\sigma_i^4}{n_i^2(n_i-1)}=0.9052\\] 使得 \\[\\hat{v}=\\frac{(2.535)^2}{0.9052}=7.10\\] 检验统计量的值为 \\(t_c=-6.776/1.992=-4.256\\)，观察到的显著性水平为 \\(\\hat \\alpha= 0.0038\\). \\(l_1\\) 的 \\(95\\%\\) 置信区间为 \\[\\hat{l}_1\\pm t_{\\alpha/2,\\hat{v}}\\times\\widehat{s.e.}(\\hat{l}_1)=-6.776\\pm(2.365)(1.592)\\] 简化为 \\[-10.54&lt;\\mu_1-\\frac{\\mu_2+\\mu_3+\\mu_4}3&lt;-3.01\\] 下一个检验是看给予两种药物组的均值是否等于两种药物组的均值的均值。也就是检验 \\[H_{02}\\colon l_2=\\mu_4-\\frac{\\mu_2+\\mu_3}2=0\\,\\mathrm{~vs.~}H_{a2}{:}\\,l_2\\neq0\\] 该线性组合的估计为 \\[\\hat l_2=\\hat{\\mu}_4-\\frac{\\hat{\\mu}_2+\\hat{\\mu}_3}2=3.6042\\] 其估计标准误为 \\[\\begin{aligned} \\widehat{s.e.}(\\hat{l}_{2})&amp; =\\sqrt{\\sum_{i=1}^4\\left(\\frac{c_i^2\\hat\\sigma_i^2}{n_i}\\right)} \\\\ &amp;=\\sqrt{\\frac14\\!\\left(\\frac{\\hat\\sigma_2^2}6\\right)+\\frac14\\!\\left(\\frac{\\hat\\sigma_3^2}8\\right)+\\left(\\frac{\\hat\\sigma_4^2}8\\right)}\\\\ &amp;=\\sqrt{0.7290}\\\\ &amp;=0.8538 \\end{aligned}\\] 检验统计量的值为 \\(t_c = 3.6042/0.8538 = 4.221\\)，因为 \\(|t_c|&gt;t_{0.005,5}\\) 它在 \\(\\alpha=0.01\\) 水平下显著。此时 \\(\\hat v\\) 的值不需要用 \\(n_ *-1\\) 作为近似自由度来计算，计算出的 \\(\\hat v\\) 的值为 \\(16.8\\) ，这是构造 \\(l_2\\) 置信区间所需要的 最后，为了检验假设以查看两种药物的均值是否不同，检验 \\(H_0{:}\\,l_3 = \\mu_2 - \\mu_3 = 0 \\,\\mathrm{~vs.~} H_a{:}\\,l_3 = \\mu_2 - \\mu_3 \\ne 0\\). 该线性组合的估计值为 \\(\\hat l_3 = \\hat\\mu_2 - \\hat\\mu_3=3.042\\)，其标准误估计为 \\[\\widehat{s.e.}(\\hat{l}_3)=\\sqrt{\\sum_{i=1}^4\\left(\\frac{c_i^2\\hat\\sigma_i^2}{n_i}\\right)}=\\sqrt{\\left(\\frac{\\hat\\sigma_2^2}{6}\\right)+\\left(\\frac{\\hat\\sigma_3^2}8\\right)}=\\sqrt{1.523}=1.234\\] 近似自由度的计算通过使用： \\[\\sum_{i=1}^4\\frac{c_i^4\\hat\\sigma_i^4}{n_i^2(n_i-1)}=0.229\\] 使得 \\[\\hat{v}=\\frac{(1.523)^2}{0.229}=10.1\\] 因此，\\(t_c = 3.042/1.234 = 2.465\\)，观察到的显著性水平为 \\(\\hat\\alpha = 0.0334\\). 2.7 自由度的一般 Satterthwaite 近似 与估计标准误差相关的自由度的 Satterthwaite 近似由下式获得 \\[v=\\frac{2*(E\\{[\\widehat{s.e.}(\\hat{l})]^2\\})^2}{\\mathrm{Var}\\{[\\widehat{s.e.}(\\hat{l})]^2\\}}\\] 其中 \\([\\widehat{s.e.}(\\widehat{l})]^2\\) 用于估计 \\(E[s.e.(\\hat{l})]^2\\)，且 \\(\\mathrm{Var}[\\widehat{s.e.}(\\hat{l})]^2\\) 的值由 \\(\\sum_{i=1}^t\\left[c_i^4\\sigma_i^4/n_i^2(n_i-1)\\right]\\) 估计。对于更复杂的模型，\\(\\mathrm{Var}[\\widehat{s.e.}(\\widehat{l})]^2\\) 可以通过使用一阶泰勒级数 (Kendall and Stuart, 1952) 近似为 \\(\\boldsymbol q&#39;\\boldsymbol M \\boldsymbol q\\)，其中 \\(\\boldsymbol M\\) 是方差估计的渐近协方差矩阵估计，向量 \\(\\boldsymbol q\\) 的元素是 \\(E[s.e.(\\hat{l})]^2\\) 关于单个方差的一阶导数，即9 \\[q_{i}=\\frac{\\partial E[(s.e.(\\hat{l})]^{2}}{\\partial\\sigma_{i}^{2}},\\quad i=1,2,\\ldots,t\\] 根据各处理方差的估计值评估 \\(q_i\\) (Montgomery and Runger, 1993, 1994). 当每个样本的数据呈正态分布时，则 \\[\\frac{(n_i-1)\\hat\\sigma_i^2}{\\sigma_i^2}\\] 为中心卡方随机变量。因此 \\(E(\\hat\\sigma_i^2)=\\sigma_i^2\\) 且 \\(\\operatorname{Var}(\\hat\\sigma_i^2)=2\\sigma_i^4/(n_i-1)\\). 令感兴趣的线性组合为 \\(l=\\sum_{i=1}^{t}c_{i}\\mu_{i}\\)，其方差为 \\(\\sigma_{l}^{2}=\\sum_{i=1}^{t}c_{i}^{2}\\sigma_{i}^{2}/n_{i}\\)，则 \\(\\sigma_{l}^{2}\\) 关于 \\(\\hat \\sigma_{i}^{2}\\) 的偏导数为 \\[\\frac{\\partial\\sigma_l^2}{\\partial\\sigma_i^2}=\\frac{c_i^2}{n_i}\\] 使用泰勒级数一阶近似获得的 \\(\\sigma_{l}^{2}\\) 的近似方差为 \\[\\mathrm{Var}(\\sigma_l^2)=\\sum_{i=1}^t\\left[\\left[\\frac{c_i^2}{n_i}\\right]^2\\left[\\frac{2\\sigma_i^4}{n_i-1}\\right]\\right]^2\\] 下一步是用提供近似自由度的相应样本估计值替换总体方差 \\[\\hat{v}=\\frac{2*\\left(E\\{[\\widehat{s.e.}(\\hat{l})]^2\\}\\right)^2}{\\mathrm{Var}\\{[\\widehat{s.e.}(\\hat{l})]^2\\}}=\\frac{\\left(\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2\\right)^2}{\\sum_{i=1}^tc_i^4\\hat\\sigma_i^4/[n_i^2(n_i-1)]}\\] 与上述 Satterthwaite 近似相同。 2.8 比较所有均值 如前所述，当方差不等时，通常的 \\(F\\) 检验非常稳健，前提是样本量几乎相等，或者假设较大的样本量对应于方差差异较大的总体样本。本节提供了两个等均值假设的附加检验。等均值假设的第一个检验 \\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\,\\mathrm{~vs.~}H_{a}\\colon\\,(\\operatorname{not}H_{0}{:})\\) ，由 Welch (1951) 给出，称为 Welch’s test。定义权重 \\(W_{i}=n_{i}/\\hat\\sigma_{i}^{2}\\)，令 \\(\\bar{y}^{*}=\\sum_{i=1}^{t}W_{i}\\bar{y}_{i\\cdot}\\big/\\sum_{i=1}^{t}W_{i}\\) 为样本均值的加权平均值，令 \\[\\Lambda=\\sum_{i=1}^{t}\\frac{(1-W_{i}/W_{\\cdot})^{2}}{n_{i}-1}\\] 其中 \\(W_\\cdot=\\sum_{i=1}^tW_{i\\cdot}\\). 那么 Welch’s test 统计量为 \\[\\begin{equation} F_c=\\frac{\\sum_{i=1}^tW_i\\frac{(\\bar{y}_i.-\\bar{y}^*)}{(t-1)}}{1+2(t-1)\\Lambda/(t^2-1)} \\tag{2.5} \\end{equation}\\] 它具有近似的 \\(F\\) 分布，分子分母自由度分别为 \\(v_{1}=t-1,\\,v_{2}=(t^{2}-1)/3\\Lambda\\). 因此当 \\(F_{c}&gt;F_{\\alpha,v_{1},v_{2}}\\)，拒绝零假设 \\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\). 式 (2.5) 的分子也可以计算为：\\([\\sum_{i=1}^{t}W_{i}\\bar{y}_{i\\cdot}^{2}-\\overline{W}\\bar{y}^{*2}]/(t-1)\\). 该程序使用 2.7 节中的数据进行了演示，初步计算见表 2.7. 表 2.7: 计算 Welch’s test 的量 x 根据以上信息计算 \\(W_\\cdot=7.341,\\bar{y}^{*}=11.724\\) \\[\\Lambda=\\frac{(1-0.430/7.341)^2}6+\\frac{(1-3.214/7.341)^2}5+\\frac{(1-0.825/7.341)^2}7+\\frac{(1-2.872/7.341)^2}7=0.376\\] 且 \\(\\sum_{i=1}^{t}W_{i}\\left.\\bar{y}_{i\\cdot}^{2}-\\overline{W}\\right.\\bar{y}^{*2}=1050.8069-1009.0954=43.7114\\). Welch’s test 统计量的值为 \\[F_c=\\frac{41.7114/3}{1+2\\times2\\times0.376/15}=\\frac{13.9038}{1.1003}=12.6355\\] 自由度为 \\(v_1=3,v_2=15/(3×0.376) = 13.283\\). 观察到的 \\(F_c\\) 相应的显著性概率为 \\(\\hat \\alpha=0.00035\\). 出于比较目的，通常的 \\(F\\) 统计量 \\(F_c=14.91\\)，自由度为 \\(3,25\\). Welch’s test 可以使用 SAS®GLM 通过在 MEANS 语句中指定 Welch 选项来获得。表 2.8 包含 GLM 代码，用于提供方差相等的 BF 检验和均值相等的 Welch 检验。部分重要结果见表 2.8 的第二部分。其他方差相等的检验可以通过指定 O'Brien、Levene 或 Bartlett 来获得。 表 2.8: SAS-GLM 代码提供 Brown-Forsythe 方差齐性检验和 Welch 方差齐性检验 x 检验处理均值相等的第二个程序是将检验一组处理均值 \\(\\mu_i\\) 线性组合假设的过程加以推广。 设一个假设是由 \\(r\\) 个独立的 \\(\\mu_i\\) 的线性组合组成的，例如 \\(H_{0}\\colon\\,\\sum_{i=1}^{t}c_{1i}\\mu_{i}=0,\\sum_{i=1}^{t}c_{2i}\\mu_{i}=0,\\ldots,\\sum_{i=1}^{t}c_{ri}\\mu_{i}=0\\,\\mathrm{~vs.~}H_{a}:(\\mathrm{not}\\,H_{0})\\). 设 \\(\\boldsymbol C\\) 是一个矩阵，其第 \\(k\\) 行是第 \\(k\\) 个线性组合的系数，若假定每个总体或处理的数据均服从正态分布，则处理均值向量的联合抽样分布为 \\(\\hat{\\boldsymbol{\\mu}}\\sim N[\\boldsymbol{\\mu},\\boldsymbol V]\\)，其中 \\(\\boldsymbol V\\) 是一个对角阵，其第 \\(i\\) 个对角元素为 \\(\\sigma^2_i /n_i\\). 线性组合集 \\(\\boldsymbol C \\boldsymbol \\mu\\) 的联合抽样分布为 \\(\\boldsymbol{C\\hat{\\boldsymbol{\\mu}}}\\sim N[\\boldsymbol{C\\mu},\\boldsymbol{CV}\\boldsymbol{C}^{\\prime}]\\). 与零假设的偏差导致的平方和为 \\(SSH_{0} = [\\boldsymbol C\\hat{\\boldsymbol{\\mu}}]^{\\prime}[\\boldsymbol C\\hat{\\boldsymbol V}\\boldsymbol C^{\\prime}]^{-1}[\\boldsymbol C\\hat{\\boldsymbol{\\boldsymbol \\mu}}]\\)，其渐近分布为具有 \\(r\\) 个自由度的卡方分布。近似小样本量统计量为 \\(F_c = SSH_ 0/r\\)，近似分布为 \\(F\\)，自由度为 \\(r,v\\)，其中 \\(v\\) 需要近似 (Fai and Cornelius, 1996; SAS Institute, Inc., 1999, p. 2118). 近似自由度的计算开始于对 \\(\\boldsymbol C \\hat {\\boldsymbol V} \\boldsymbol C&#39; = \\boldsymbol Q \\boldsymbol D \\boldsymbol Q&#39;\\) 执行谱分解，其中 \\(\\boldsymbol D\\) 是具有 \\(\\boldsymbol C \\hat {\\boldsymbol V} \\boldsymbol C&#39;\\) 的特征根作为对角元素的 \\(r×r\\) 对角阵，并且 \\(\\boldsymbol Q\\) 是 \\(\\boldsymbol C \\hat {\\boldsymbol V} \\boldsymbol C&#39;\\) 的对应特征向量的 \\(r×r\\) 正交矩阵。令 \\(\\boldsymbol z_k&#39;\\) 为 \\(\\boldsymbol Q \\boldsymbol C\\) 的第 \\(k\\) 行，并令 \\[v_k=\\frac{2(d_k)^2}{\\boldsymbol b_k&#39;\\boldsymbol M\\boldsymbol b_k}\\] 其中 \\(d_k\\) 是 \\(\\boldsymbol D\\) 的第 \\(k\\) 个对角元素，\\(\\boldsymbol b_k\\) 包含 \\(\\boldsymbol z_k&#39;\\boldsymbol V \\boldsymbol z_k\\) 关于 \\(\\boldsymbol V\\) 中每个方差参数的偏导数在方差估计处的值，\\(\\boldsymbol M\\) 是方差向量的渐近协方差。令 \\[S=\\sum_{k=1}^r\\frac{v_k}{v_k-2}I[v_k&gt;2]\\] 其中 \\(I[v_k&gt;2]\\) 是一个指示函数，当 \\(v_k &gt; 2\\) 时值为 \\(1\\)，否则为 \\(0\\). \\(F_c\\) 分布的近似分母自由度为 \\[v=\\begin{cases}\\frac{2S}{S-r}&amp;\\mathrm{if~}S&gt;r\\\\0&amp;\\mathrm{if~}S\\leq r&amp;\\end{cases}\\] 上述过程可用于通过选择一组 \\(t - 1\\) 个线性独立的 \\(\\mu_i\\) 的对比来提供等均值假设的检验。 SAS-Mixed 程序实现了一种对分母自由度的近似，该分母自由度与分子中具有多个自由度的近似 \\(F\\) 统计量相关。SAS-Mixed 可用于拟合每个处理组方差不等的模型，或使用 REPEATED 语句并指定 GROUP = 选项。表 2.9 中的 Mixed 代码将不等方差模型拟合至表 2.1 中的数据。REPEATED 语句用于指定要为每个处理估计不同的方差（组的每个值）。三个 Estimate 语句用于提供与 2.6 节中的三个问题相对应的计算。 表 2.9: 将不等方差模型拟合到表 2.1 中的数据的 SAS-Mixed 代码 x Mixed 程序的结果见表 2.10，其中协方差参数估计值是四个处理方差的估计值，拟合统计量中的 AIC 是 Akaike Information Criteria (Akaike, 1974)，模型似然比检验提供了等方差假设的检验，固定效应的 III 型检验使用第二个统计量和分母的相应近似自由度提供了等均值假设的检验，估计值包含与 2.6 节中的三个问题对应的结果，其中提供了 \\(t\\) 统计量、近似分母自由度和 \\(95\\%\\) 置信区间。表 2.11 包含了处理均值估计及其相应的标准误估计。名义自由度是与它们各自的方差相对应的自由度。表 2.11 的第二部分包含处理均值的成对比较，包括每次比较的近似分母自由度。该模型可以通过对药物 1 和两种药物使用一个方差，对药物 2和无药物使用一种方差来简化。这可以通过定义一个变量来实现，比如 T，对于药物 1 和两种药物都是 1，对于其他两种处理是 0. 然后在模型指定中将 T 放在 class 语句中，并使用 Repeated/Group=T;。两个方差的估计值分别为 \\(2.4028\\) 和 \\(12.7376\\)，\\(AIC\\) 为 \\(126.4\\)，这比四方差模型的 \\(AIC\\) 值小，表明两方差模型足以描述数据。使用在模型指定中具有较少方差的模型为相应的标准误提供了更多的自由度，从而提供了关于模型中固定效应的假设的更有效的检验。 表 2.10: 将不等方差模型拟合到表 2.1 中的数据的结果 x 表 2.11: 利用不等方差模型估计药物组均值和配对比较 x 2.9 结束语 总之，为了比较所有均值，建议采用以下方法： 如果方差齐性检验在 \\(1\\%\\) 的水平上不显著，则进行通常的方差分析检验。 如果方差齐性检验在 \\(1\\%\\) 的水平上显著，则使用 Welch’s test 或混合模型检验以及相应的近似分母自由度。 如果方差齐性检验在 \\(1\\%\\) 的水平上显著，则使用 \\(AIC\\) 来确定是否可以使用更简单或更少数量的方差来充分描述数据，以增加与均值有关检验的功效。 许多教科书和文章都写过关于对数据进行转换以实现相等的处理方差，从而可以使用通常的方差分析来比较处理。由于能够建立一个不等方差模型来提供均值的标准误估计和均值的比较，许多情况下不需要使用变换。不必使用变换来实现相等方差的一个主要好处是，平均值的单位是测量单位，从而简化了解释。 本章讨论了具有异质误差的单向方差分析模型的统计分析。讨论包括确定误差方差齐性的几个统计检验，以及何时使用每个检验的建议。讨论了在发现误差方差不齐时，对不同处理的效应进行统计推断的适当程序，还回顾了说明这些程序使用的示例。 2.10 练习 “… the actual and physical conduct of an experiment must govern the statistical procedure of its interpretation.” - R. A. Fisher 原文为: heterogeneous error variances pose a much more serious problem when ignored than non-normality of the error variances，应为笔误，此处译者做了修改。↩︎ 原文为: so you are going to reject the null hypothesis more often than specified by the choice of \\(\\alpha\\).↩︎ 原文为: not too unequal.↩︎ 本书将 “subject” 译作个体，原因见介绍页的术语规范。↩︎ 原文分子没有 \\(\\partial\\)，应为笔误，此处已修改。↩︎ "],["chap3.html", "第 3 章 同时推断程序和多重比较 3.1 错误率 3.2 建议 3.3 最小显著差异 3.4 Fisher’s LSD Procedure 3.5 Bonferroni’s Method 3.6 Scheffé’s Procedure 3.7 Tukey–Kramer Method 3.8 模拟方法 3.9 Šidák Procedure 3.10 示例：成对比较 3.11 Dunnett’s Procedure 3.12 示例：与对照比较 3.13 多元 \\(t\\) 3.14 示例：线性独立比较 3.15 序贯拒绝方法 3.16 示例：线性相关比较 3.17 多重极差检验 3.18 Waller–Duncan Procedure 3.19 示例：成对比较的多重极差 3.20 警示 3.21 结束语 3.22 练习", " 第 3 章 同时推断程序和多重比较 通常实验者想在同一个实验中比较多个 \\(\\mu_i\\) 的函数，导致多重检验的情况。也就是说，他们应该试图回答所有关于处理之间关系的问题。在实验或研究中包括两种以上处理的首要原因是能够估计和/或检验关于处理均值之间几种关系的假设。通常，选择处理是为了提供感兴趣的比较结构（例如参见 2.4 节中的药物实验）。在其他时候，实验者可能对将每种处理与其他所有处理进行比较感兴趣，即，进行所有成对比较。例如，当一个人比较几种小麦的产量或任何其他一组被选择用于比较研究的处理时，就是这样的情况。 在一个实验中进行多重比较时，一个值得关注的问题是，观察到的显著性差异是由于真实的差异，还是仅仅由于进行了大量的比较。进行大量的比较增加了发现看似显著但实际上并不显著的差异的机会。例如，如果一个实验者在一个实验中进行了 \\(25\\) 次独立检验，并在 \\(0.05\\) 的水平上发现了一个显著差异，那么她不应该对结果抱有太大的信心。因为平均而言，她应该预期仅凭偶然就发现 \\((0.05)(25)= 1.25\\) 个显著差异。因此，如果实验者用一个实验回答大量问题（我们认为应该这样做），那么最好有一个程序来表明这些差异是否只是偶然的结果。Fisher (1949) 提出了受保护最小显著差异 (least significant difference, LSD）程序，解决了这一问题。从那时起，许多作者对多重检验领域做出了贡献，此领域已经开发了多种设置的程序。 在本章中，讨论并比较了几种著名且常用的多重推断程序。其中一些程序主要用于检验假设，而另一些程序也可用于获得同时置信区间 (simultaneous confidence intervals)；也就是说，对于 \\(\\mu_i\\) 的一组函数，可以导出一组置信区间。对于这些置信区间，有 \\(95\\%\\) 的把握认为所有的置信区间同时 (simultaneously) 包含它们各自的 \\(\\mu_i\\) 的函数。 3.1 错误率 评估和比较多重比较程序的主要方法之一是计算错误率 (error rates)。如果给定的置信区间不包含所估计的量的真实值，则会出现错误。类似地，如果使用假设检验，那么每当真假设被拒绝或假假设没有被拒绝时，就会出现错误。接下来定义了四种错误率。 定义 3.1 ♦ 比较错误率 (comparisonwise error rate) 等于在所有分析的实验中做出的错误推断的数量与做出的推断总数的比值。 定义 3.2 ♦ 实验误差率 (experimentwise error rate, EER) 等于至少发生一次错误的实验数与分析的实验总数的比值。它是当处理之间没有差异时，在实验中至少发生一次错误的概率。EER 也称为完全零假设下的实验误差率 (experimentwise error rate under the complete null hypothesis, EERC). 定义 3.3 ♦ 族错误率 (familywise error rate, FWER) (Westfall et al, 1999) 是对一个预定的 \\(k\\) 个比较或置信区间的集合做出至少一个错误推断的概率，此 \\(k\\) 个比较或置信区间的集合称为推断族。 定义 3.4 ♦ 错误发现率 (false discovery rate, FDR)(Benjamini and Hochberg, 1995) 是被拒绝的假设中被错误拒绝的假设的预期比例。 当零假设是所有处理都同等有效时，即处理均值之间没有差异时，EER 控制错误率。但许多实验涉及一组选定的处理，其中某些处理之间存在已知差异。可能存在一个包含 \\(k\\) 个零假设 \\(H_{01},H_{02},\\cdots,H_{0k}\\) 的集合，这些是关于 \\(t\\) 个均值的假设，而不是所有均值都相等的零假设。这 \\(k\\) 个零假设被称为部分零假设 (partial null hypothesis)，并且通过使用控制 FWER 的方法来控制错误率。例如，练习2.3中的一组处理是六种糖果类型：buttons, blue choc, red choc, small choc, chocChip 和 WchocChip。在研究开始时，人们已知溶解 small choc 所需的时间远小于溶解任何其他糖果所需要的时间。零问题 (null hypothesis) 可能是：溶解 small choc 所需的时间是否等于溶解 blue choc 和 red choc 所需平均时间的一半？在这种情况下，控制 FWER 的方法是合适的，因为使用控制 EER 的方法的条件不成立；也就是说，从一开始就已知平均时间不完全相等。FDR 在遗传学中的微阵列实验中非常有用。 为了避免在单个实验中偶然发现太多显著的比较，人们常常试图在适当的时候将整个实验的错误率或 FWER 固定在某个规定的水平上，如 \\(0.05\\). 当实验者试图用一次实验回答许多问题时，控制 FWER 是一个很好的策略。 3.2 建议 多重比较问题有五种基本类型：1) 将一组处理与一个对照或标准进行比较；2) 在一组 \\(t\\) 个均值之间进行所有成对比较；3) 构造一组同时置信区间或假设的同时检验 (simultaneous confidence intervals or simultaneous tests of hypotheses)；4) 探索性实验并进行大量检验；以及 5) 数据窥探 (data snooping)，其中比较 (comparisons) 可能是数据驱动的。在前四种情况下，在数据被分析之前，比较的数量或置信区间或推入族是已知的。在最后一种情况下，没有固定的比较数量，最终的比较数量可能很大。2本章给出的建议是基于 Westfall et al. (1999), SAS Institute, Inc. (1999), and Westfall (2002) 的信息。 如果实验是探索性或发现性研究，并且结果将用于设计随访或确证性研究，则可能不需要调整多重性，因此使用 \\(t\\) 检验或基于 \\(LSD\\) 值的未调整置信区间。 使用 Dunnett’s procedure 比较一组处理和一个对照。Dunnett’s procedure 有双侧和单侧两种版本，因此可以选择一种版本来适应所考虑的情况。 对于成对比较，如果每个处理组的观察值数量相等，则使用 Tukey’s method. 如果数据不均衡 (unbalanced)，则使用模拟 (Westfall et al., 1999) 一个百分点的方法，考虑到观察值数量不等的模式。 如果线性组合的集合是线性无关的，那么多元 \\(t\\) 可以用来构造置信区间或检验假设。如果线性组合是无关的或正交的，那么多元 \\(t\\) 可以很好地工作。如果线性组合相关，则应使用包含相关结构的模拟方法，而不是使用多元 \\(t\\) 。每个处理组观察次数不等的大多数情况提供的是相关的线性组合，应使用模拟方法。 Bonferroni method 可用于构建同时置信区间或对选定数量的均值的线性组合进行检验，但如果感兴趣的组合数量很大（比如20个或更多），则 Scheffé procedure 通常会产生较短的置信区间，因此请进行检查。对于一组假设，可以有效地使用 Šidák (1967), Holm (1979), 或 Šidák–Holm 的方法。当线性组合无关时，这些边界是相当好的，但当线性组合相关时，所实现的 FWER 可能比期望的小得多。SAS®-MULTTEST 可用于对给定的一组比较进行 bootstrap 和模拟百分点，该组比较考虑了比较之间的相关性。 对于数据窥探或数据驱动的比较或假设，使用 Scheffé procedure，因为可以进行任意多的比较，并且仍然可以控制 EER 或 FWER. 对于涉及数千次比较的遗传研究等研究，请使用控制 FDR 的方法，如 Benjamini and Hochberg (1995) 提出的方法。 对于涉及与对照或安慰剂相比评估处理的安全性以确定可能的不良反应的研究，使用不校正多重检验或比较的方法。对于安全性研究，可能不需要进行多重性调整，因为发生II类错误比发生I类错误严重得多。 确定比较类型并指定所需的错误率控制水平后，选择满足这些条件的方法，该方法提供最小 \\(p\\) 值或最小临界差异或最短置信区间。 在下面的讨论中，我们将讨论每一种推荐的多重比较方法，以及第 1 章单向处理结构中其他几种常用的方法。每一种方法也可以用于更复杂的情况。本书剩余部分使用的参数 \\(v\\) 表示与 \\(\\sigma^2\\) 估计相对应的自由度。对于第 1 章的单向情况，误差自由度为 \\(v = N-t\\). 3.3 最小显著差异 LSD (least significant difference) 多重比较法可能比其他方法使用得更多，这可能是因为它是最容易应用的方法之一。它通常用于将每个处理均值与其他处理均值进行比较，但也可以用于其他比较。用于比较 \\(\\mu_i\\) 和 \\(\\mu_j\\) 的 \\(\\alpha100\\%\\)10显著性水平的 LSD 为 \\[\\begin{equation} \\mathrm{LSD}_\\alpha=t_{\\alpha/2,v}\\hat{\\sigma}\\sqrt{\\frac1{n_i}+\\frac1{n_j}} \\tag{3.1} \\end{equation}\\] 当 \\(|\\hat{\\mu}_i-\\hat{\\mu}_j|&gt;\\text{LSD}_\\alpha\\) 时，结论为 \\(\\mu_i\\ne \\mu_j\\). 此程序的比较错误率等于 \\(\\alpha\\). \\(\\mu_i–\\mu_j\\) 对应的 \\(100(1-\\alpha)\\%\\) 置信区间为 \\[\\begin{equation} \\hat{\\mu}_i-\\hat{\\mu}_j\\pm t_{\\alpha/2,v}{\\hat\\sigma}\\sqrt{\\frac1{n_i}+\\frac1{n_j}} \\tag{3.2} \\end{equation}\\] 如果所有样本量都相等（例如，等于 \\(n\\) ），那么单个 LSD 值可以用于所有成对比较。此时单个 \\(\\mathrm{LSD}_{\\alpha}\\) 值由下式给出 \\[\\begin{equation} \\mathrm{LSD}_\\alpha=t_{\\alpha/2,v}{\\hat\\sigma}\\sqrt{\\frac2n} \\tag{3.3} \\end{equation}\\] 假设一项研究包括 \\(t\\) 种处理均值，并且将在 \\(5\\%\\) 的显著性水平上进行所有可能的成对比较。表 3.1 显示了具有不同 \\(t\\) 值的实验的比较误差率和实验误差率。表中的信息适用于所有处理均值相等的情况。表 3.1 显示，在涉及 6 种治疗的实验中，35.8% 的时间会发现至少一个显著差异，即使所有的处理均值彼此相等。显然，如果没有一些额外的保护措施，使用 LSD 程序可能会非常危险。当存在多个感兴趣的测试或参数或参数的线性组合时，意味着存在多重性问题，应考虑一些调整以避免发现错误结果。Westfall et al. (1999) 对与多重性问题和/或多重比较问题相关的所有问题进行了极好的讨论。以下讨论试图描述那些在分析和解释设计实验结果时有用或已使用的程序。 表 3.1: LSD Procedure 的模拟错误率 x 3.4 Fisher’s LSD Procedure Fisher 的建议为上一节讨论的 LSD 程序提供了一些保护。在 Fisher’s procedure 中，LSD 检验是通过使用方程 (3.1) 在 \\(\\alpha100\\%\\) 显著性水平上进行的，但前提是 \\(H_0{:}\\,\\mu_1=\\mu_2=\\cdots=\\mu_t\\) 首先被第 1 章中讨论的 \\(F\\) 检验在该水平上拒绝。 这比直接的 LSD procedure 有了相当大的改进，因为现在实验错误率大约等于 \\(\\alpha\\). 然而有可能拒绝 \\(H_0{:}\\,\\mu_1=\\mu_2=\\cdots=\\mu_t\\) 但不拒绝任何一个 \\(H_0{:}\\,\\mu_i=\\mu_j\\)，其中 \\(i\\ne j\\). 同样地，当差异确实存在时，该程序可能无法检测到处理对之间的某些差异。换句话说，少数处理对之间可能存在差异，但其余处理的相等可能导致 \\(F\\) 检验不显著，这个过程不允许实验者在没有首先获得显著 \\(F\\) 统计量的情况下进行单个比较。此程序的另一个问题是，许多实验包含已知在处理的某些子集中存在不等均值的处理。此时预期拒绝等均值假设，LSD 将用于进行所有成对比较。如果处理的子集具有等均值，则更多的成对比较将被检测为与预期显著不同。因此，FWER 不被维持。只有当完全零假设为真时，才能推荐 Fisher’s LSD. 不建议将这两种 LSD’s procedure 用于在 \\(\\mu_i\\) 的特定对比上构建同时置信区间，因为获得的置信区间通常太窄。 上述 LSD’s procedure 中的每一个都可以推广到处理均值的几个对比。此推广为：断定 \\(\\sum_{i=1}^{t}c_{i}\\mu_{i}\\neq0\\) 如果 \\[\\begin{equation} \\left|\\sum_{i=1}^tc_i\\hat{\\mu}_i\\right|&gt;t_{\\alpha/2,v}{\\hat\\sigma}\\sqrt{\\sum_{i=1}^tc_i^2/n_i} \\tag{3.4} \\end{equation}\\] 示例见 3.10, 3.12, 3.14 和 3.16 节。 3.5 Bonferroni’s Method 虽然这个程序可能是最少使用的，但它往往是最好的。当实验者想要进行少量比较时，它特别好。每当需要控制 FWER 时，推荐使用这个程序进行有计划的比较。假设实验者想做 \\(p\\) 个这样的比较。能得出结论 \\(\\sum_{i=1}^tc_{iq}\\mu_i\\neq0,q=1,2,\\ldots,p\\)，如果 \\[\\begin{equation} \\left|\\sum_{i=1}^tc_{iq}\\hat{\\mu}_i\\right|&gt;t_{\\alpha/2p,v}{\\hat\\sigma}\\sqrt{\\sum_{i=1}^t\\frac{c_{iq}^2}{n_i}} \\tag{3.5} \\end{equation}\\] 这 \\(p\\) 个检验的 FWER \\(\\le \\alpha\\) 以及比较误差率 \\(=\\alpha/p\\). 通常 FWER 比 \\(\\alpha\\) 小得多。不幸的是，无法确定小多少。附表 A.2 中给出了选定 \\(\\alpha,p,n\\) 的 \\(t_{\\alpha/2p,v}\\) 的值。例如，如果 \\(\\alpha = 0.05,p = 5,n = 24\\)，那么从表 A.2 可以得到 \\(t_{\\alpha/2p,v}=2.80\\). 3.10, 3.12, 3.14 和 3.16 节中的示例演示了 Bonferroni’s method 的使用。表中 \\(m\\) 与这里的 \\(p\\) 是等价的。 推荐使用从 Bonferroni’s method 获得的同时置信区间，其形式为 \\[\\begin{equation} \\sum_{i=1}^tc_{iq}\\hat{\\boldsymbol{\\mu}}_i\\pm t_{\\alpha/2p,v}\\hat{\\boldsymbol\\sigma}\\sqrt{\\sum_{i=1}^t\\frac{c_{iq}^2}{n_i}},\\quad q=1,2,\\ldots,p \\tag{3.6} \\end{equation}\\] Bonferroni’s method 可应用于模型参数的任何函数集，包括方差和均值。 3.6 Scheffé’s Procedure 当实验者想要进行大量”计划外”比较时，建议使用此程序。计划外比较是实验者在计划实验时没有想到进行的比较。这些问题经常出现，因为实验结果经常建议实验者进行某些比较。当有大量计划的比较时，也可以使用该程序，但置信区间的宽度通常比其他程序宽，尽管并不总是如此。给定常数向量 \\(\\boldsymbol c\\)，考虑检验 \\(H_0{:}\\,\\sum_{i=1}^tc_i\\mu_i=0\\)。我们有 \\[\\Pr\\left\\{\\frac{\\left(\\sum_{i=1}^tc_i\\hat{{\\mu}}_i-\\sum_{i=1}^tc_i{\\mu}_i\\right)^2}{\\sum_{i=1}^tc_i^2/n_i}\\leq(t-1)F_{{\\alpha,t-1,v}}\\hat{\\sigma}^2\\quad\\text{ for all contrast vectors }c\\right\\}=1-\\alpha \\] 因此对于所有可能的 \\(\\mu_i\\) 与 \\(0\\) 的对比，一个 FWER \\(=\\alpha\\) 的程序如下：拒绝 \\(H_0{:}\\,\\sum_{i=1}^tc_i\\mu_i=0\\) 如果 \\[\\begin{equation} \\left|\\sum_{i=1}^tc_i\\hat{\\mu}_i\\right|&gt;\\sqrt{(t-1)F_{\\alpha,t-1,v}}{\\hat\\sigma}\\sqrt{\\sum_{i=1}^tc_i^2/n_i} \\tag{3.7} \\end{equation}\\] Scheffé’s procedure 仍然可以使用，但此时 FWER 通常会原小于 \\(\\alpha\\). 对于有限数量的比较，Bonferroni’s method 或多元 \\(t\\) 方法（适当时）通常优于（置信区间更窄或更有效） Scheffé’s procedure. 即，使用Bonferroni’s method 或多元 \\(t\\) 方法相比Scheffé’s procedure，较小的 \\(\\sum_{i=1}^tc_i\\hat \\mu_i\\) 更有可能得出 \\(\\sum_{i=1}^tc_i\\mu_i\\) 与零显著不同的结论11。然而，如果要在数据中”乱翻”，看看是否有什么显著的东西出现，那么应该使用 Scheffé’s procedure，因为这种比较实际上是计划外的比较，而不是计划内的比较。需注意 Scheffé’s procedure 不会显示任何与零显著不同的对比，除非第 1 章讨论的 \\(F\\) 检验拒绝了 \\(H_0\\colon\\,\\mu_1=\\mu_2=\\cdots=\\mu_t\\). Scheffé’s procedure 也可用来获得 \\(\\mu_i\\) 的对比的同时置信区间。所需的结果是，对于任何一组对比 \\(c_1,c_2,\\dots,\\)，可有至少 \\((1-\\alpha)100\\%\\) 的把握认为 \\(\\sum_{i=1}^tc_{iq}\\mu_i\\) 包含在下式给出的区间内 \\[\\begin{equation} \\sum_{i=1}^tc_{iq}\\hat{\\mu}_i\\pm\\sqrt{(t-1)F_{\\alpha,t-1,v}}{\\hat\\sigma}\\sqrt{\\sum_{i=1}^tc_{iq}^2/n_i}\\quad\\text{ for all }q=1,2,\\ldots \\tag{3.8} \\end{equation}\\] 如果要考虑 \\(\\mu_i\\) 所有的线性组合，而不仅仅是所有对比，则式 (3.7) 和 (3.8) 中的 \\(√[(t-1)F_{\\alpha,t-1,v}]\\) 必须替换为 \\(√[tF_{\\alpha,t,v}]\\). 示例见 3.10, 3.12 和 3.14 节。 3.7 Tukey–Kramer Method 无论 \\(n_i\\) 的值如何，都可以使用前面的程序。Tukey’s honest significant difference (HSD) procedure (Tukey, 1952, 1953; Kramer, 1956) 用于在一组均值之间进行所有成对比较。然而该程序要求相等的 \\(n_i\\). Tukey (1953) 和 Kramer (1956) 为样本量不等的情况提供了修改。Hayter (1984) 给出了 Tukey–Kramer method 提供 FWER 保护的证据，尽管如果 \\(n_i\\) 相差不大12时可以使用近似程序。对于 \\(i\\ne i&#39;\\)，Tukey–Kramer method 将拒绝 \\(H_0{:\\mu_i}=\\mu_{i&#39;}\\)，如果 \\[\\begin{equation} \\left|\\hat{\\mu}_i-\\hat{\\mu}_{i^{\\prime}}\\right|&gt;q_{\\alpha,t,v}\\sqrt{\\frac{{\\hat\\sigma}^2}2{\\left(\\frac1{n_i}+\\frac1{n_{i^{\\prime}}}\\right)}} \\tag{3.9} \\end{equation}\\] 其中 \\(q_{\\alpha,t,v}\\) 为学生化极差统计量分布的上分位数。选定 \\(\\alpha,t,v\\) 的 \\(q_{\\alpha,t,v}\\) 值在附表 A.4 中。 如果样本量都等于 \\(n\\)，对于一个对比，拒绝 \\(H_0\\colon\\sum_{i=1}^tc_i\\mu_i=0\\)，如果 \\[\\left|\\sum_{i=1}^tc_i\\hat{\\mu}_i\\right|&gt;q_{\\alpha,t,v}\\frac{\\hat\\sigma}{\\sqrt{n}}{\\left(\\frac12\\sum_{i=1}^t|c_i|\\right)}\\] 3.8 模拟方法 对于不相等的样本量问题，对于比较不是成对比较的问题，以及对于比较不是线性独立的问题，上述方法提供的 FWER 显著性水平低于所需水平。在这种情况下，可以模拟适当的一组比较的分位数。 假设对 \\(\\mu_i\\) 的 \\(p\\) 个线性组合感兴趣，例如 \\(\\sum_{i=1}^{t}c_{iq}\\mu_{i},q=1,2,\\dots,p\\). 希望有程序要么控制假设集合 \\(H_{0}\\colon\\,\\sum_{i=1}^{t}c_{iq}\\mu_{i}=0,q=1,2,\\ldots,p\\) 的 FWER，要么控制同时置信区间的 \\(\\sum_{i=1}^tc_{iq}\\mu_i\\) FWER. 这个过程是： 以与手头数据集相同的结构生成一个数据样本。如果有五个样本量为5、9、3、6和7的处理，则使用这些样本量生成数据 对生成的数据集进行分析，如同对实际数据集所做的那样，并计算 \\(p\\) 个 \\(t\\) 统计量 \\[t_q=\\frac{\\sum_{i=1}^tc_{iq}\\hat{{\\mu}}_i}{\\sqrt{\\hat{\\sigma}^2\\sum_{i=1}^tc_{iq}^2/n_i}}\\quad q=1,2,\\ldots,p\\] 计算 \\(t_q\\) 绝对值的最大值 \\(T_{s}=\\max(|t_{1}|,|t_{2}|,\\ldots,|t_{p}|)\\). 大量重复步骤 1, 2 和 3，跟踪 \\(T_s\\) 的计算值。确定 \\(T_s\\) 分布的上 \\(\\alpha100\\) 分位数，并用 \\(T_\\alpha\\) 表示该百分位数。 对于实际数据集，计算 \\(t_q,q=1,2,\\dots,p\\)，如果 \\(|t_q| &gt;T,q=1,2,\\dots,p\\) 则拒绝第 \\(q\\) 个假设，或者构建同时置信区间为 \\[\\sum_{i=1}^tc_{iq}\\hat{{\\mu}}_i\\pm T_\\alpha\\sqrt{{\\hat\\sigma}^2\\sum_{i=1}^tc_{iq}^2/n_i},\\quad q=1,2,\\ldots,p\\] 可以使用 Edwards and Berry (1987) 的方法来指定模拟的准确性。SAS-MULTTEST 可用于使用 bootstrap 方法获得联合推断 (Westfall et al., 1999). Bootstrap 方法超出了本书的范围。 3.9 Šidák Procedure Šidák (1967) 对 Bonferroni’s method 进行了修改，对每个比较使用了不同的分位数。该过程是为每个比较计算一个 \\(t\\) 统计量 \\[t_q=\\frac{\\sum_{i=1}^tc_{iq}\\hat{{\\mu}}_i}{\\sqrt{\\hat{\\sigma}^2\\sum_{i=1}^tc_{iq}^2/n_i}},\\quad q=1,2,\\ldots,p\\] 计算每次比较的显著性水平，并将显著性水平从最小到最大排序为 \\(p_1,p_2,\\dots p_p\\). 对于 FWER \\(=\\alpha\\)，如果 \\(p_q\\le 1-(1-\\alpha)^{1/p}\\) 或等价地 \\(\\alpha\\ge 1-(1-p_q)^p\\)，则拒绝单个比较。 3.10 示例：成对比较 1.6 节中的任务数据用于阐述上述多重比较程序的结果。表 3.2 包含 SAS-Mixed 代码，用于拟合单向均值模型，LSMeans 语句用于提取几个多重比较程序。表 3.3 包含用于提供模拟、Tukey–Kramer、Bonferroni、Šidák、Scheffé 和 \\(t\\)（未调整）方法的置信度差异或显著性差异的分位数。除了未调整的 \\(t\\)，其他方法为所有成对比较提供 \\(0.05\\) 的 I 类 FWER。模拟和 Tukey–Kramer 方法 使用最小的分位数，Šidák 和 Bonferroni 方法的分位数位于中间，而 Scheffé 方法的分位数最大。表 3.4 包含了每个成对比较的关键显著性差异。任务 1 与 4，2 与 4，3 与 4，3 与 5、3 与 6、4 与 5和 4 与 6 观察到的差异，\\(t\\) 或 LSD 的临界差异，这控制了比较错误率，但未控制实验错误率。只有 4 与 5 ，4 与 6 的比较超过了其他五种方法的临界差异，所有这些方法都提供了实验错误率的保护，未调整的 \\(t\\) 或 LSD 方法的临界差异幅度最小。模拟方法与 Tukey-Kramer 方法临界差异大小相近，但模拟方法稍小；Šidák 方法与 Bonferroni 方法临界差大小相近，但 Šidák 值稍小。正如预期的那样，Scheffé 方法临界差异最大，因为它可以控制无限次比较的 FWER，而实际仅进行了 15 次成对比较。用差异估计加减临界差的方法可以得到所有两两比较的联合 \\(95\\%\\) 置信区间，如 \\(\\mu_1-\\mu_2\\) 的联合 \\(95\\%\\) 置信区间为 \\(0.840 \\pm 6.526\\). 表 3.5 包含每种方法的调整的 \\(p\\) 值。\\(p\\) 值提供了与表 3.4 中 \\(5\\%\\) 差异相同的决定. 表 3.2: 使用 Proc Mixed 计算多个多重比较程序的所有成对比较 x 表 3.3: 用于六个任务均值的所有成对比较的分位数 x 表 3.4: 用于比较未调整的 \\(t\\) 检验和几种多重比较程序的均值对之间差异的临界差异 x 表 3.5: 调整显著性水平以检验从六个程序中获得的 TASK 减去 _TASK 的所有成对比较的相等性，其中 \\(t\\) 对应未调整的 \\(t\\) x 3.11 Dunnett’s Procedure 一个非常有趣的例子是将所有处理与对照进行比较。这种类型的推断在安全性研究中很重要，届时将不同剂量的处理与对照或安慰剂进行比较是很有意义的。Dunnett’s test 声明处理均值 \\(\\mu_i\\) 与对照均值 \\(\\mu_0\\) 存在显著差异，如果 \\[|\\hat{\\mu}_i-\\hat{\\mu}_0|&gt;d_{\\alpha,t,v}\\sqrt{{\\hat\\sigma}^2{\\left(\\frac1{n_i}+\\frac1{n_0}\\right)}}\\] 其中 \\(d_{\\alpha,t,v}\\) 是”多对一 \\(t\\) 统计量” (“many-to-one t-statistic”)(Miller, 1967) 的上 \\(\\alpha100\\) 分位数。Dunnett’s method 控制 FWER。如果样本量不等，模拟程序可以考虑样本量结构，并可能提供更短的界限。 3.12 示例：与对照比较 1.6 节中的任务数据用于演示将每个处理与对照进行比较的过程。在本研究中，假设任务2为对照任务，其他五个任务为实验任务。表 3.6 包含 SAS-Mixed 代码，使用未调整的 \\(t\\)、Bonferroni、Dunnett、Scheffé、Šidák 和 模拟方法将所有其他任务与任务2进行比较。LSMean 语句 DIFF=CONTROL('2') 选项请求将任务2视为对照，并与研究中的其他每个任务进行比较。表 3.7 包含每种方法的 \\(95\\%\\) 分位数。Dunnett 分位数小于其他分位数（除了未调整的 \\(t\\)），模拟方法与之非常接近。目前正在进行五次比较，这决定了 Bonferroni 和 Šidák 分位数的大小。Scheffé 分位数与表 3.4 中的相同，这对于无限数量的比较非常有用。观察到的差异超过临界差异的唯一比较是将任务4与对照(任务2)进行比较。将差异估计加减表 3.8 中的临界差异，可以构建一组关于处理和对照均值之间所有差异的同时置信区间。例如，使用模拟方法，\\(\\mu_1-\\mu_2\\) 的联合 \\(95\\%\\) 置信区间为 \\(0.840 \\pm 5.765\\). 表 3.9 中列出了每种方法的调整的 \\(p\\) 值。 表 3.6: 使用 Proc Mixed 计算多个多重比较程序的所有成对比较 x 表 3.7: 用于比较每个任务均值与任务2（对照）均值的分位数 x 表 3.8: 未调整的 \\(t\\) 检验和五个多重比较程序中各处理组与对照组比较的临界差异 x 表 3.9: 调整显著性水平以检验 \\(H_0:\\,\\mu_i = \\mu_2\\)，从六个程序中获得，其中任务2为对照，\\(t\\) 对应于未调整的 \\(t\\) x 3.13 多元 \\(t\\) 当实验者想要考虑 \\(\\mu_i\\) 线性组合的线性无关集合时，多元 \\(t\\) 方法是一种很好的方法。重要的是，该程序不能用于线性相关的线性组合集合。这种限制阻止了使用这种方法在一组处理均值之间进行所有可能的成对比较，因为均值之间所有可能的比较的集合不是线性独立的集合。关于线性相关线性组合的讨论在本节末尾给出。如果实验者想进行 \\(p\\) 个线性独立的比较，结论为第 \\(q\\) 个比较 \\(\\sum_{i=1}^tc_{iq}\\mu_i\\neq0\\) 如果 \\[\\begin{equation} \\left|\\sum_{i=1}^tc_{iq}\\hat{\\mu}_i\\right|&gt;t_{\\alpha/2,p,v}{\\hat\\sigma}\\sqrt{\\sum_{i=1}^t\\frac{c_{iq}^2}{n_i}} \\tag{3.10} \\end{equation}\\] 其中 \\(t_{\\alpha/2,p,v}\\) 是自由度为 \\(v\\) 且相关矩阵为 \\(\\boldsymbol I_{p}\\) 的 \\(p\\) 元 \\(t\\) 分布的上 \\(\\alpha/2\\) 分位数。选定 \\(\\alpha,p,v\\) 的 \\(t_{\\alpha/2,p,v}\\) 的值在附表 A.3 中给出。基于多元 \\(t\\) 方法的同时置信区间是合适的，并且可以推荐表 A.3 中 \\(m=p\\) 的情况。 多元 \\(t\\) 方法的 FWER \\(\\le\\alpha\\)。如果线性组合 \\(\\sum_{i=1}^tc_{iq}\\hat\\mu_i\\) 在统计上独立或不相关，则 FWER 恰好 \\(=\\alpha\\)。对于一组特定的线性独立比较，多元 \\(t\\) 方法通常会给出最佳结果。如果实验者感兴趣的一组比较是线性独立的，那么多元 \\(t\\) 方法总是比 Bonferroni method 更好，也就是说，得到的置信区间会更窄。 以下结果使我们能够将多元 \\(t\\) 程序的应用扩展到一组线性相关的比较（然而，所得到的检验或置信区间并不完全令人满意）：设 \\(l_1,l_2,\\dots,l_p\\) 是 \\(\\mu_i\\) 的线性组合的线性独立集。如果 \\(|lq|\\le cq\\)，则 \\[\\left|\\sum_{i=1}^p\\lambda_ql_q\\right|\\leq\\sum_{i=1}^p\\left|\\lambda_q\\right|c_q\\] 要利用此结果，请使用以下步骤： 令 \\(l_1,l_2,\\dots,l_p\\) 是 \\(\\mu_i\\) 的线性组合的线性独立集。这个集合被表示为实验者主要感兴趣的线性组合。对于这组比较，得出结论 \\(l_q=\\sum_{i=1}^tc_{iq}\\mu_i\\) 与零显著不同，如果 \\[\\begin{equation} \\left|\\hat{l}_q\\right|&gt;t_{\\alpha/2,p,v}{\\hat\\sigma}\\sqrt{\\sum_{i=1}^tc_{iq}^2/n_i} \\tag{3.11} \\end{equation}\\] 令 \\(l^*\\) 是任何具有次要重要性的比较，即 \\(l_q,q=1,2,\\dots,p\\) 的线性组合。也就是说，对于 \\(\\lambda_q\\) 的某个集合，\\(l^*=\\sum_{q=1}^p\\lambda_ql_q\\)。称 \\(l^*\\) 与零显著不同，如果 \\[\\begin{equation} \\left|\\hat{l}^*\\right|&gt;t_{\\alpha/2,p,v}\\hat{\\boldsymbol\\sigma}\\sum_{q=1}^p\\left(\\left|\\lambda_q\\right|\\sqrt{\\sum_{i=1}^tc_{iq}^2/n_i}\\right) \\tag{3.12} \\end{equation}\\] 实验者可以在不增加 FWER 的情况下根据需要进行尽可能多的 \\(l^*\\) 比较。多元 \\(t\\) 方法的这种扩展对那些具有首要重要性的比较给出了非常有效的检验，但对那些具有次要重要性的比较则不那么有效。如 3.16 节中的示例所示。 3.14 示例：线性独立比较 表 3.10 包含 SAS-Mixed 代码，用于提供任务均值的五个线性独立对比的估计、标准误和置信区间宽度。五个对比是： \\[\\begin{aligned} &amp;\\mu_1-\\frac12(\\mu_2+\\mu_3),\\,\\frac13(\\mu_1+\\mu_2+\\mu_3)-\\frac13(\\mu_4+\\mu_5+\\mu_6) \\\\ &amp;\\mu_6-\\frac12(\\mu_4+\\mu_5),\\,\\frac12(\\mu_1+\\mu_6)-\\frac12(\\mu_4+\\mu_5) \\\\ &amp;\\frac12(\\mu_1+\\mu_6)-\\frac14(\\mu_2+\\mu_3+\\mu_4+\\mu_5) \\end{aligned}\\] 表 3.10: 使用 Proc Mixed 计算多个多重比较程序的所有成对比较 x 表 3.11: 未调整的 \\(t\\) 和三种调整方法的置信区间宽度 x 表 3.11 包含使用多元 \\(t\\)、Bonferroni \\(t\\) 和 Scheffé 方法计算每个五个对比的置信区间宽度的结果。还提供了未调整的 \\(t\\)。置信区间的宽度由 2×Q×(stderr) 计算，其中 Q 表示相应程序的分位数。分位数如下：对于未调整的 \\(t\\)，\\(Q=t_{0.025,62}=1.999\\)，对于多元 \\(t\\)，\\(Q=t_{0.025,5,60=2.649}\\)（表中使用了60个自由度，而不是62个自由度），对于 Bonferroni \\(t\\)，\\(Q＝t_{0.025,15,62}=2.657\\)，对于 Scheffé，\\(Q＝√(5F_{0.05,5,62}=3.437\\)。多元 \\(t\\) 的置信区间的宽度短于 Bonferroni 或 Scheffé 置信区间给出的宽度。Bonferroni \\(t\\) 置信区间仅比多元 \\(t\\)的置信区间略宽。随着比较次数的增加，Bonferronit 置信区间的宽度也会增加。如果比较次数 \\(\\le47\\) 次或更少，则 Bonferroni 置信区间比 Scheffé 方法的置信区间更短。对于 \\(&gt;47\\) 次的比较，Scheffé 置信区间比 Bonferroni 区间短。 3.15 序贯拒绝方法 前面的方法被称为单步方法，因为只需要一步就可以确定所有检验的合适临界值。每个单独的检验或置信水平都是在不参考其他检验或置信水平的情况下进行评估的。在逐步或序贯 (sequantial) 方法中，给定检验的结果取决于先前检验的结果 (Westfall et al., 1999). 这些方法可用于假设检验集。设有 \\(p\\) 个感兴趣的假设，\\(H_{0q}\\colon\\sum_{i=1}^{t}c_{iq}\\mu_{i}=0\\,\\mathrm{~vs.~}\\,H_{0q}\\colon\\sum_{i=1}^{t}c_{aq}\\mu_{i}\\neq0,q=1,2,\\ldots,p\\). 计算 \\(p\\) 个 \\(t\\) 统计量 \\[t_{q}=\\frac{\\sum_{i=1}^{t}c_{iq}\\hat{\\mu}_{i}}{\\sqrt{{\\hat\\sigma}^{2}\\sum_{i=1}^{t}c_{iq}^{2}/n_{i}}},\\quad q=1,2,\\ldots,p\\] 设 \\(p_1,p_2,\\dots,p_p\\) 表示观察到的显著性水平。接下来，将 \\(p_q\\) 从小到大排序为 \\(p_{(1)}\\le p_{(2)}\\le\\cdots p_{(p)}\\). 3.15.1 Bonferroni–Holm Method Bonferroni-Holm 方法从第一次检验的 Bonferroni 调整开始，但增加了后续检验的显著性水平 (Holm, 1979). 如果 \\(p_{(1)}&gt;\\alpha/p\\)，则无法拒绝所有假设。若 \\(p_{(1)}&lt;\\alpha/p\\)，则拒绝 \\(p_{(1)}\\) 对应的假设并将 \\(p_{(2)}\\) 与 \\(\\alpha/(p-1)\\) 比较。若 \\(p_{(2)}&gt;\\alpha/(p-1)\\)，则无法拒绝所有剩余假设。若 \\(p_{(2)}&lt;\\alpha/(p-1)\\)，则拒绝 \\(p_{(2)}\\) 对应的假设并将 \\(p_{(3)}\\) 与 \\(\\alpha/(p-2)\\) 比较。继续这个过程直到对于某个 \\(q\\)，\\(p_{(q)}&gt;\\alpha/(p-q+1)\\)，此时无法拒绝 \\(p_{(q)}\\) 对应的假设以及所有剩余假设。该方法控制 FWER，并且比 Bonferroni method 更强大，因为除了第一个比较外，有序的 \\(p\\) 值与更大的值进行比较。 3.15.2 Šidák–Holm Method Bonferroni–Holm method 中使用的 Holm 修正可以与 Šidák 方法一起使用，其中调整的 \\(p\\) 值为 \\[\\begin{aligned} \\tilde{p}_{(1)}&amp; =1-(1-p_{(1)})^k \\\\ \\tilde{p}_{(2)}&amp; =\\min[\\tilde{p}_{(1)},1-(1-p_{(2)})^{k-1}] \\\\ \\tilde{p}_{(j)}&amp; =\\min[\\tilde{p}_{(j-1)},1-(1-p_{(j)})^{k-j+1}] \\\\ \\tilde{p}_{(k)}&amp; =\\min(\\tilde{p}_{(k-1)},p_{(k)}) \\end{aligned}\\] 当比较是独立的以及涉及相关比较的大多数情况下，该方法提供了对 FWER 的控制 (Holland and Copenhaver, 1987). 3.15.3 控制 FDR 的 Benjamini 和 Hochberg Method 设感兴趣于 \\(p\\) 个比较 \\(\\sum_{i=1}^{t}c_{iq}\\mu_{i},q=1,2,\\ldots,p\\). 计算 \\(p\\) 个 \\(t\\) 统计量 \\[t_q=\\frac{\\sum_{i=1}^tc_{iq}\\hat{\\mu}_i}{\\sqrt{\\hat{\\sigma}^2\\sum_{i=1}^tc_{iq}^2/n_i}},\\quad q=1,2,\\ldots,p\\] 并令 \\(p_1,p_2,\\dots,p_p\\) 表示观察到的显著性水平。接下来，将 \\(p_q\\) 从小到大排序为 \\(p_{(1)}\\le p_{(2)}\\le\\cdots p_{(p)}\\). 控制 FDR（但不控制 FWER）的调整的 \\(p\\) 值为 \\[\\begin{aligned} \\tilde{p}_{(k)}&amp; =p_{(k)} \\\\ \\tilde{p}_{(k-1)}&amp; =\\min\\{\\tilde{p}_{(k)},[k/(k-1)]p_{(k-1)}\\} \\\\ \\tilde{p}_{(k-j)}&amp; =\\min\\{\\tilde{p}_{(k-j+1)},[k/(k-j)]p_{(k-j)}\\} \\\\ \\tilde{p}_{(1)}&amp; =\\min(\\tilde{p}_{(2)},kp_{(1)}) \\end{aligned}\\] 3.16 示例：线性相关比较 选择了八个线性相关的比较，并使用未调整的 \\(t\\)、Bonferroni \\(t\\)、Bonferroni–Holm、Šidák、Šdák–Holm 和 Benjamini–Hochberg 方法来计算调整的显著性水平。这八个比较是： \\[\\begin{aligned} &amp;\\mu_1-\\mu_2,\\mu_1-\\frac12(\\mu_2+\\mu_3),\\mu_1-\\mu_3 \\\\ &amp;\\frac13(\\mu_1+\\mu_2+\\mu_3)-\\frac13(\\mu_4+\\mu_5+\\mu_6),\\mu_4-\\mu_5 \\\\ &amp;\\mu_6-\\frac12(\\mu_4+\\mu_5),\\frac12(\\mu_1+\\mu_6)-\\frac12(\\mu_4+\\mu_5) \\\\ &amp;\\frac12(\\mu_1+\\mu_6)-\\frac14\\left(\\mu_2+\\mu_3+\\mu_4+\\mu_5\\right) \\end{aligned}\\] 表 3.12 包含 SAS-MULTTEST 代码，用于提供这些比较的调整的 \\(p\\) 值。调整的 \\(p\\) 值如表 3.13 所示。标记为 “Raw” 的列包含了未调整的 \\(p\\) 值。“Bonferroni” 列包含 Bonferronis 调整的 \\(p\\) 值。“Stepdown Bonferroni” 列包含 Bonferroni-Holm 调整的 \\(p\\) 值。“Šidák” 列包含 Šidàk 调整的 \\(p\\) 值。“StepdownŠidák”列包含 Šidèk–Holm 调整的 \\(p\\) 值。“False Discovery Rate” 列包括 Benjamini–Hochberg 调整的 \\(p\\) 值。Šidák 调整的 \\(p\\) 值通常小于 Bonferroni \\(t\\) 的 \\(p\\) 值。Stepdown Šidèk 调整的 \\(p\\) 值一般小于 stepdown Bonferronis的 \\(p\\) 值，并且小于 Šidàk 调整前的 \\(p\\) 值。Bonferroni、stepdown Bonferroni、Šidák 和 stepdown Shidák 方法提供的值大于错误发现率方法的值。错误发现率通常会在进行大量检验且对控制 FWER 不感兴趣时使用。 表 3.12: 用 Proc MULTTEST 代码同时获得八个对比的检验信息 x 表 3.13: 八个对比的原始和调整的 \\(p\\) 值 x 为了说明多元 \\(t\\) 的推广在相关比较中的应用，我们将计算关于 \\(\\mu_1 -1/2(\\mu_2 + \\mu_3)\\) 的置信区间，假定线性无关集或主要集包含 \\(\\mu_1 - \\mu_2\\) 和 \\(\\mu_1 - \\mu_3\\). 此时 \\(\\mu_1 -1/2(\\mu_2 + \\mu_3)=1/2(\\mu_1-\\mu_2)+1/2(\\mu_1-\\mu_3)\\)，而根据 3.13 节中的结果，\\(l^*=\\mu_1-1/2(\\mu_2+\\mu_3)=1/2(\\mu_1-\\mu_2)+1/2(\\mu_1-\\mu_3)\\)，且 \\(\\lambda_1=\\lambda_2=1/2\\). 用于评估 \\(l^*\\) 的临界值（根据式 (3.12)）为 \\[\\begin{aligned} t_{\\alpha/2,p,v}\\hat{\\sigma}\\sum_{q=1}^{p}\\left(\\left|\\lambda_{q}\\right|\\sqrt{\\sum_{i=1}^{t}c_{iq}^{2}/n_{i}}\\right)&amp; =(2.649)(5.559){\\left(\\left|\\frac12\\right|\\sqrt{\\frac1{13}+\\frac1{12}}+\\left|\\frac12\\right|\\sqrt{\\frac1{13}+\\frac1{10}}\\right)} \\\\ &amp;=\\frac12(5.895)+\\frac12(6.194) \\\\ &amp;\\text{=6.044} \\end{aligned}\\] 将该结果乘以 \\(2\\)，得到置信区间的宽度为 \\(12.088\\). 多元 \\(t\\)、Bonferroni \\(t\\) 和 Scheffé 方法的置信区间宽度分别为 \\(10.319,10.352\\)和 \\(13.390\\)。线性独立比较的集合称为主比较 (primary comparisonns)，主比较集合中的比较的线性函数称为次比较 (secondary comparisons). 使用式 (3.12) 为次比较提供临界差异，得到的值比作为主比较获得的值大得多，但此时宽度仍然比 Scheffé 方法提供的宽度短。因此，当使用多元 \\(t\\) 方法时，次比较远不如除 Scheffé 方法外的任何其他方法灵敏。 3.17 多重极差检验 Duncan 和 Student–Newman–Keul 的多重极差检验 (multiple range tests) 不能控制 FWER，因此不予以推荐。见 Westfall et al. (1999, p. 154) 的讨论。由于这些程序已被许多领域的研究人员广泛使用，下面将对其进行描述。 3.17.1 Student–Newman–Keul’s Method 这个方法要求 \\(n_i\\) 彼此相等；然而，只要样本量相差不大13，就可以获得良好的近似值。此时，下列公式中的变量 \\(n\\) 被 \\(n_i\\) 的调和平均值 (harmonic mean) 所代替。调和平均值由下式给出 \\[\\tilde{n}=t\\Bigg(\\frac{1}{n_{1}}+\\frac{1}{n_{2}}+\\cdots+\\frac{1}{n_{t}}\\Bigg)^{-1}\\] 该程序在所有等均值假设下控制 EERC，但如果某些均值相等，而某些均值不相等，则无法控制 EERC. 要应用此方法，请将 \\(t\\) 个均值按升序排列为 \\(\\bar{y}_{(1)}\\leq\\bar{y}_{(2)}\\leq\\cdots\\leq\\bar{y}_{(t)}\\). 接下来，\\(t\\) 个均值的学生化极差 (Studentized range) 为 \\[\\frac{\\overline{y}_{(t)}-\\overline{y}_{(1)}}{{\\hat\\sigma}/\\sqrt{n}}\\] 并将其与临界值 \\(q_{\\alpha,t,v}\\) 比较，如果 \\[\\overline{y}_{(t)}-\\overline{y}_{(1)}\\leq\\frac{\\hat\\sigma}{\\sqrt{n}}q_{\\alpha,t,v}\\] 则得出结论，\\(t\\) 个处理均值之间没有显著差异，也不考虑进一步的检验。如果 \\[\\overline{y}_{(t)}-\\overline{y}_{(1)}&gt;\\frac{\\hat\\sigma}{\\sqrt{n}}q_{\\alpha,t,v}\\] 则得出结论，\\(\\mu_{(t)}&gt;\\mu_{(1)}\\) 或，这 \\(t\\) 个均值存在显著的极差。接下来，对两个均值子集 \\(\\{\\bar{y}_{(t)},\\bar{y}_{(t-1)},\\ldots,\\bar{y}_{(2)}\\}\\) 和 \\(\\{\\bar{y}_{(t-1)},\\bar{y}_{(t-2)},\\ldots,\\bar{y}_{(1)}\\}\\) 进行比较。将每个子集的极差与 \\([{\\hat\\sigma}/√(n)]q_{\\alpha,t-1,v}\\) 比较，如果 \\[\\bar{y}_{(t)}-\\bar{y}_{(2)}\\leq\\frac{\\hat\\sigma}{\\sqrt{n}}q_{\\alpha,t-1,v}\\] 则得出结论，在子集 \\(\\{\\mu_{(t)},\\mu_{(t-1)},\\ldots,\\mu_{(2)}\\}\\) 中，处理均值之间没有显著14差异。类似地，如果 \\[\\bar{y}_{(t-1)}-\\bar{y}_{(1)}\\leq\\frac{\\hat\\sigma}{\\sqrt{n}}q_{\\alpha,t-1,v}\\] 则得出结论，在子集 \\(\\{\\mu_{(t-1)},\\mu_{(t-2)},\\ldots,\\mu_{(1)}\\}\\) 中，处理均值之间没有显著15差异。如果以上两个结论都成立，那么我们停止在均值之间进行比较的程序，并得出结论，两个均值子集中的均值没有显著差异。 如果 \\[\\bar{y}_{(t)}-\\bar{y}_{(2)}&gt;\\frac{\\hat\\sigma}{\\sqrt{n}}q_{\\alpha,t-1,v}\\] 则得出结论 \\(\\mu_{(t)}&gt;\\mu_{(2)}\\). 如果 \\[\\bar{y}_{(t-1)}-\\bar{y}_{(1)}&gt;\\frac{\\hat\\sigma}{\\sqrt{n}}q_{\\alpha,t-1,v}\\] 则得出结论 \\(\\mu_{(t-1)}&gt;\\mu_{(1)}\\). 如果这两个结论中的任何一个成立，那么我们将在发现显著差异的子集内进行额外的比较。例如，如果前面的两个集合都包含显著差异，那么可以考虑子集 \\(\\{\\bar{y}_{(t)},\\bar{y}_{(t-1)},\\ldots,\\bar{y}_{(3)}\\},\\{\\bar{y}_{(t-1)},\\bar{y}_{(t-2)},\\ldots,\\bar{y}_{(2)}\\}\\) 和 \\(\\{\\bar{y}_{(t-2)},\\bar{y}_{(t-2)},\\ldots,\\bar{y}_{(1)}\\}\\). 将每个子集的极差与 \\([{\\hat\\sigma}/√(n)]q_{\\alpha,t-2,v}\\) 进行比较。只要前一个子集具有显著的极差，则继续检查较小的均值子集。 每次得到不显著的极差时，将所涉及的均值包括在单个组中。被分在非显著组中的均值子集以后不能被视为显著；也就是说，不应对先前分组到共同子组中的均值进行进一步检验。当所有极差检验不显著时，程序结束。被分在在同一组中的任何两个均值没有显著差异；否则，它们有显著差异。 使用 1.6 节中的任务数据示例对该方法进行说明，取 \\(\\alpha=0.05\\). 由于样本量不等，样本量的调和平均值为 \\(11.23\\). 首先按升序排列均值： Task 6 5 2 1 3 4 Mean 28.818 29.500 31.083 31.923 35.800 38.000 Rank 1 2 3 4 5 6 第一步是对六个均值的极差进行比较，将 \\(38.000-28.818=9.182\\) 与 \\[q_{0.05,6,62}\\frac{\\hat\\sigma}{\\sqrt{\\tilde{n}}}=(4.16)\\sqrt{\\frac{30.9045}{11.23}}=6.900\\] 比较。由于 \\(9.819&gt;6.90\\)，需调查两个含有 \\(t-1=5\\) 个均值的子集。此时，将 \\(35.800-28.818=6.982\\) 和 \\(38.000-29.500=8.500\\) 与 \\[q_{0.05,5,62}\\frac{\\hat\\sigma}{\\sqrt{\\tilde{n}}}=(3.98)\\sqrt{\\frac{30.9045}{11.23}}=6.593\\] 比较。由于 \\(7.619&gt;6.60,8.5&gt;6.60\\)，接着调查含有 \\(t-2=3\\) 个均值的子集，有三个这样的子集。此时，将 \\(31.923 - 28.818 = 3.105,35.800 - 29.500 = 6.300,38.0 - 31.083 = 6.917\\) 与 \\[q_{0.05,4,62}\\frac{\\hat\\sigma}{\\sqrt{\\tilde{n}}}=(3.74)\\sqrt{\\frac{30.9045}{11.23}}=6.195\\] 比较。由于 \\(3.105&lt;6.195\\)，前四个均值被分为一组。由于 \\(6.300&gt;6.195,6.917&gt;6.195\\)，剩下的四个均值组都必须进一步细分为三个均值的组。在进行下一步之前，请考虑以下示意图，说明了当前的情况，其中直线表示前四个均值为一组，并且被认为没有差异。 四个均值的第一个子集 {29.500, 31.083, 31.923, 35.800} 包含已组合在一起的两组三个均值，即 \\(29.500–31.923\\) 和 \\(28.818–31.083\\). 因此，极差 \\(31.923 - 29.500 = 2.423\\) 和 \\(31.083 - 28.818 = 2.265\\) 不与临界点进行比较。仍需比较的极差是 \\(35.800 - 31.083 = 4.717\\) 和 \\(38.0 - 31.923 = 6.077\\)；这些必须与 \\[q_{0.05,3,62}\\mathrm{~}\\frac{\\hat\\sigma}{\\sqrt{\\tilde{n}}}=(3.40)\\sqrt{\\frac{30.9045}{11.23}}=5.635\\] 比较。由于 \\(4.717 &lt; 5.635\\)，这三个均值现在被为一个组，而由于 \\(6.077 &gt; 5.635\\)，第二组必须进一步细分为每组两个均值的组。下图说明了当前情况： 只有一个尺寸为 2 的子集 {35.8, 38.0} 尚未合并到一个公共组中。将极差 \\(38.0 - 35.8 = 2.2\\) 与 \\[q_{0.05,2,62}\\frac{{\\hat\\sigma}}{\\sqrt{\\tilde{n}}}=(2.83)\\sqrt{\\frac{30.9045}{11.23}}=4.691\\] 比较。由于 \\(2.2&lt;4.69\\)，最后这两个均值被分到一组。最终的示意图为： 说明此信息的另一种方法是，如果它们出现在同一组中，则用相同的字母标记均值；如果它们出现在不同的组中，则用不同的字母标记均值。因此，任务数据均值的比较可以表示为 Task Mean 1 31.923 bc 2 31.083 bc 3 35.800 ab 4 38.000 a 5 29.500 c 6 28.818 c 3.17.2 Duncan’s New Multiple Range Method 目前，这种方法通常被称为 Duncan’s method。它是更流行的方法之一，部分原因是使用该方法通常比任何其他方法更容易找到显著差异，除了 Fisher’s LSD method。但是，虽然 Duncan’s method 控制了比较错误率，但它无法控制 FWER。此过程也需要相等的 \\(n_i\\) ，并且与上一节一样，如果对于近似过程而言样本量不太不平等，则以下公式中的变量 \\(n\\) 可以替换为 \\(\\tilde n\\). 此过程的应用类似于 Student-Newman-Keul method 的应用，不同之处在于用于比较一组 \\(p\\) 个均值的学生化极差临界点 \\(q_{\\alpha,p,v}\\) 替换为 \\(q_{\\alpha_p,p,v}\\)，其中 \\(\\alpha_p=1-(1-\\alpha)^{p-1}\\). \\(q_{\\alpha_p,p,v}\\) 的值在附表 A.5 中给出。对于上一节中的数据，此程序应用如下： 将 \\(38.000 - 28.818 = 9.182\\) 与 \\[q_{\\alpha_{6},6,62}\\frac{\\hat\\sigma}{\\sqrt{\\tilde{n}}}=(3.198)\\sqrt{\\frac{30.9045}{11.23}}=5.303\\] 比较，其中 \\(\\alpha_6=1-(1-0.05)^{6-1}=0.226\\). 六个均值的极差是显著的。 将 \\(35.800 - 28.818 = 6.982\\) 和 \\(38.000 - 29.500 = 8.500(3.143)(1.659) = 5.213\\) 与 \\[q_{\\alpha_5,5,62}\\frac{\\hat\\sigma}{\\sqrt{\\tilde{n}}}=(3.143)\\sqrt{\\frac{30.9045}{11.23}}=5.214\\] 比较，其中 \\(\\alpha_5=1-(1-0.05)^{5-1}=0.186\\). 两个极差都是显著的。 将 \\(31.923 - 28.818 = 3.105\\)，\\(35.800 - 29.500 = 6.300\\) 和 \\(38.000 - 31.083 = 6.917\\) 与 \\((3.073)(1.659) = 5.098\\) 比较。后两个极差显著，而第一个极差不显著。此时的分组为 将 \\(35.800 - 31.083 = 4.717\\)，\\(38.000 - 31.923 = 6.077\\) 与 \\((2.976)(1.659) = 4.937\\) 比较。第二个极差显著，而第一个极差不显著。现在的分组情况为： 将 \\(38.000 - 35.800 = 2.200\\) 与 \\((2.829)(1.659) = 4.693\\) 进行比较。该极差不显著。最终的示意图为： 这个例子中 Student-Newman-Keul’s method 和 Duncan’s method 得出相同的图；然而，它们通常不会如此，因为他们使用学生化极差的不同分位数。Duncan’s method 使用较小的值来比较均值极差，这就是它无法控制 FWER 的原因。 3.18 Waller–Duncan Procedure 此程序不适用于大多数混乱数据的情况，因为它也需要相等的 \\(n_i\\)，但当它们不相等时，使用样本量的调和平均值来实现。包含此程序有几个原因，但主要是因为该程序不为人所知，并且因为它似乎具有一些理想的性质，Waller-Duncan procedure 使用样本数据来帮助确定是否需要保守规则（如 Tukey-Kramer）或非保守规则（如 Fisher’s LSD）来进行处理均值之间的成对比较。该程序利用 \\(F\\) 检验的计算值来检验 \\(H_{0}\\colon\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\). 如果 \\(F\\) 值很小，则样本数据往往表明均值是同质的。此时 Waller-Duncan procedure 需要样本均值的绝对差很大才能宣称显著性，从而防止太多的显著性差异。如果 \\(F\\) 值很大，则样本数据往往表明均值是不同质的。此时该程序要求样本平均值的绝对差较小来给出显著性，从而防止太少的显著性差异。Waller-Duncan procedure 要求选择一个称为错误率比 (error rate ratio) 的常数 \\(K\\)，该常数表示 I 类错误相对于 II 类错误的严重性。\\(K\\) 和 I 类错误概率之间的关系大致如下： \\(\\alpha\\) \\(K\\) 0.10 50 0.05 100 0.01 500 因此该程序的临界点取决于 \\(K,n,t\\) 和检验 \\(H_{0}\\colon\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\) 的 \\(F\\) 统计量的计算值。此处未包含表格；它们在 Ott (1988) 中给出。为了使用该程序，我们计算一个 Waller–Duncan LSD，并将所有均值对与此单个 LSD 值进行比较，就像使用 Fisher’s LSD procedure 或 Tukey–Kramer HSD procedure 对待等样本量问题一样。当用户在 SAS-GLM 中请求 Means/Waller 选项时，会计算 Waller–Duncan LSD 值，并将均值分组为类似于上两节给出的图表中。 3.19 示例：成对比较的多重极差 Duncan、Student–Newman–Keul 和 Waller–Duncan 方法可以使用 SAS-GLM 的 Means 语句来完成。表 3.14 包含为任务数据集拟合单向模型的 GLM 代码，并包含 Means 语句，以提供比较六个任务均值的三种方法。表 3.15 包含 Duncan’s 多重比较法的结果。计算并呈现临界极差值，以使人们能够查看一系列均值并确定它们是否不同。例如，当该组涉及四个均值时，将该极差与 \\(5.096\\) 进行比较。均值从大到小依次列出，字母 \\(A,B,C\\) 表示显著的分组。 表 3.14: 生成 Ducan、Student–Newman–Kuels 和 Waller–Duncan 多重比较程序的程序的 GLM 代码 x 表 3.15: 使用 Duncan’s 多重比较程序的结果 x 注释: 此检验控制 I 类比较错误率，而不是实验错误率。 表 3.16 包含 Student–Newman–Keul’s method 的类似结果。如上所述，Student–Newman–Keul’s method 的临界极差值大于 Duncan’s method 的临界极差值。临界极差值的增加使得 Student–Newman–Keul’s method 能够在完全零假设（所有均值相等）下控制实验误差率，而 Duncan’s method 无法控制实验误差率。表 3.17 包含 Waller–Duncan method 的结果。最小显著性差异为 \\(4.448\\)，该值小于表 3.4 中任何未调整的 \\(t\\) 值。最小显著性差异使用样本量的调和平均值为所有比较提供一个值。最小显著性差异较小是因为 \\(F\\) 统计量的值很大，表明均值之间可能存在差异。 表 3.16: SNK 多重比较程序的结果 x 注释: 该检验在完全零假设下控制 I 类实验误差率，但在部分零假设下无法控制。 表 3.17: Waller-Duncan 多重比较程序的结果 x 注释: 该检验在加性损失和某些其他假设下能最小化贝叶斯风险。 3.20 警示 在结束本章之前，请注意，当样本量不等时，下划线或分组程序可能不一致。考虑一个示例，其中标准差的估计值为 \\(2\\)，该值基于 \\(50\\) 个自由度。样本量和样本均值为 Treatment 1 2 3 4 \\(\\hat\\mu_i\\) 39.3 40.1 42.0 43.0 \\(n_i\\) 2 25 25 2 检验等均值假设所需的 \\(F\\) 统计量的值为 \\(4.90\\)，显著性水平为 \\(0.005\\)。将 \\(\\mu_1\\) 与 \\(\\mu_2\\)、\\(\\mu_1\\) 与 \\(\\mu_3\\)、\\(\\mu_2\\) 与 \\(\\mu_4\\) 和 \\(\\mu_3\\) 与 \\(\\mu_4\\) 进行比较的 \\(5\\%\\) LSD值为 \\((2.008)(2)√(1/2+1/25)=2.951\\). 将 \\(\\mu_1\\) 与 \\(\\mu_4\\) 进行比较的 \\(5\\%\\) LSD值为 \\((2.008)(2)√(1/2+1/2)=4.016\\)，将 \\(\\mu_2\\) 与 \\(\\mu_3\\) 进行比较的 \\(5\\%\\) LSD值则为 \\((2.008)(2)√(1/25+1/25)=1.136\\). 因此，对于这些数据，最大均值和最小均值之间的差异 \\(\\hat\\mu_1-\\hat\\mu_4=3.7\\) 不显著，而两个中间均值之间较小的差异 \\(\\hat\\mu_2-\\hat\\mu_3=1.9\\) 是显著的。我们可以通过注意到有足够的信息（足够大的样本量）来声明 \\(\\mu_2\\) 和 \\(\\mu_3\\) 之间存在统计上显著的差异，但没有足够的信息（样本量太小）来声明任何其他均值对之间存在统计上显著的差异来解释这种明显的不一致性。 3.21 结束语 在本章中，讨论了从一个实验数据集进行许多推断的程序。这样的程序是必要的，以确保观察到的处理之间的差异是由于所比较的参数函数的实际差异，而不仅仅是由于偶然性。有些程序更适合计划的比较，而另一些程序更适合数据窥探。对于具有多个变量的研究，可以使用所有均值相等的 \\(F\\) 检验来避免对某些变量进行多重比较。如果 \\(F\\) 检验在所需的 \\(\\alpha\\) 水平上不显著，则不必进行进一步的比较，但如果 \\(F\\) 检验在所需的 \\(\\alpha\\) 水平上显著，则应使用调整多重性的多重比较方法来比较均值（这不是 Fisher’s protected LSD）。最后，所讨论的多重比较和检验程序可应用于不等方差模型（在第 2 章中讨论），通过使用 SAS-Mixed 中的 LSMeans 语句来实现，其中 REPEATED 语句用于指定不等方差结构。还给出了在给定情况下使用哪种程序的建议。 3.22 练习 原文为 100% significance level. 应为笔误。↩︎ 原文为 That is, a smaller value of \\(\\sum_{i=1}^tc_i\\hat \\mu_i\\) can often enable one to declare that \\(\\sum_{i=1}^tc_i\\mu_i\\) is significantly different from zero using Bonferroni’s method or the multivariate t-method than can be declared significant by Scheffé’s method. 为符合中文表达，此处做了适当修改。↩︎ 原文为: not too unequal.↩︎ 原文为: not too unequal.↩︎ 原文中没有 “significant” 一词，严谨起见，译者已添加。↩︎ 原文中没有 “significant” 一词，严谨起见，译者已添加。↩︎ "],["chap4.html", "第 4 章 实验设计基础 4.1 介绍基本概念 4.2 设计实验的结构 4.3 不同设计实验的示例 4.4 结束语 4.5 练习", " 第 4 章 实验设计基础 “… the null hypothesis is never proved or established, but is possibly disproved, in the course of experimentation. Every experiment may be said to exist only to give the facts a chance of disproving the null hypothesis.” - R. A. Fisher 经过适当设计和分析的实验提供了有关所使用资源的调查条件的最大信息量。本章介绍了实验者设计和分析实验时使用的概念和方法。本章讨论的基本概念是处理结构 (treatment structure) 和设计结构 (design structure)，以及重复 (replication)、区组 (block) 和实验单元 (experimental unit) 的思想。给出了设计和处理结构相结合的实例，以说明完全区组设计和不完全区组设计的概念。这些设计涉及一种尺寸 (size)的实验单元。第五章描述了实验单元尺寸的概念，并给出了涉及多于一种实验单元尺寸的各种设计。本章提出的设计结构包括完全随机 (completely randomized, CRD)、随机完全区组 (randomized complete block, RCBD)、不完全区组 (incomplete block, IBD)和拉丁方 (Latin square, LSD)。所考虑的处理结构包括单向、双向、双向对照、部分析因和 \\(n\\) 向结构。在本一章中，介绍了具有必要的变异源和自由度的模型和方差分析表。讨论提供了确定用于计算误差平方和的变异源的方法，以及用于计算结果自由度的算法。一般来说，误差平方和是通过对观测值或经相同处理的观测值 (observations that are treated alike) 的线性组合的比较来获得的。其他平方和的计算将在后面的章节中讨论。本章的基本方法是通过示例来演示概念。裂区 (split-plot)、重复测量 (repeated measures)、条区 (strip-plot) 和交叉设计 (crossover designs ) 使用不同尺寸的实验单元的概念，并在第 5 章中进行了描述。涉及嵌套 (nesting) 的设计也在第 5 章中进行了讨论。 4.1 介绍基本概念 实验设计涉及计划实验，以便从可用资源中获得最多的信息。实验的设计应该从要达到的目的开始。应指定一个或多个主要响应变量，并充分描述实验目的和响应变量之间的联系。应解释用作实验单元的实体，并将其与实验目的联系起来。通常，在设计实验时，实验者可以控制某些被称为处理、总体或处理组合的因素。实验者通常控制要使用的实验单元的选择以及这些实验单元是否可以分组（称为区组）。典型的实验涉及要进行比较或要研究其效应的处理（或处理组合）。 在进行实验之前，必须回答几个问题： 实验的目的是什么？响应变量是什么？这是设计的一个非常重要的方面，因为必须了解生成数据的过程以及数据与目的的关系。 需研究多少种处理？处理的数量可能已经被指定，但有时应该讨论处理的选择如何与研究的目的相关。例如，一名营养学专业的学生想要设计一项研究，以确定在饼干产品中可以使用的大豆粉的最大量来代替小麦粉，这样所得的饼干中就没有大豆味了。该学生选择的饼干配方涉及用大豆粉替代 0、10、20、30、40、50、60、70、80、90 和 100% 的小麦粉。第一个问题是：“如果使用100%大豆粉，你能尝到大豆的味道吗？”因为如果你不能品尝到100%大豆粉的大豆味，那么就没有必要进行实验，如果你能品尝到大豆味，那么就没有必要在一组处理中包括100%大豆粉。我们认为尚不清楚用 20%、30%、40% 和 50% 大豆粉制成的产品是否可以品尝到大豆味。即，确定大豆粉含量为10％时无法品尝到大豆味，而大豆粉含量超过50％时则可品尝到大豆味。确定了不能品尝到含有10%大豆粉的大豆味，而可以品尝到含有超过50%大豆粉的大豆味，在将处理的选择与研究目的联系起来后，只需要最初11个处理中的5个（0、20、30、40和50%大豆粉）。0%作为小麦粉对照。这一过程大大减少了研究所需的样本数量。 每种处理需要观测多少次？这个问题与实现特定目的所需的样本量有关。 实验单元是什么？许多实验只涉及一个尺寸的实验单元。但其中涉及的重要思想是独立的重复。一些实验涉及多个尺寸的实验单元，这一概念在第 5 章中有所描述。研究人员通常认为一个实验只涉及一个尺寸的实验单元，而无法识别涉及多种尺寸的实验单元的情况。这个问题需要认真解决，如第 5 章所述。 实验者如何将处理应用于可用的实验单元，然后对响应进行观测？这个问题涉及使用随机化将处理分配给实验单元，以及在提供数据过程的其他部分中使用随机化。重要的是，随机化用于将处理分配给实验单元。在医学研究中，以随机顺序在实验室中运行样本或使用随机顺序评估受试者也很重要。 是否可以对最终设计进行分析或进行所需的比较？这可能是研究人员最重要的问题，但本书的一个主要目的是使读者能够使用更复杂的设计，并且仍然能够进行分析，以估计重要参数并检验所需的假设。 这些问题的答案不一定是直截了当的，也不能笼统地回答这些问题。希望这里讨论的想法和概念能帮助实验者收集足够的信息，为他们的研究提供答案。 为了继续，考虑一个涉及 \\(t\\) 个处理的实验，其中每个处理应用于 \\(r\\) 个不同的实验单元。令 \\(y_{ij}\\) 是分配给第 \\(i\\) 个处理的第 \\(j\\) 个实验单元观测到的响应，用于描述 \\(y_{ij}\\) 的数学模型为 \\[\\begin{equation} y_{ij}=\\mu_i+\\varepsilon_{ij}\\quad\\mathrm{for~}i=1,2,\\ldots,t,\\mathrm{~and~}j=1,2,\\ldots,r \\tag{4.1} \\end{equation}\\] 其中 \\(\\mu_i\\) 是第 \\(i\\) 个处理的响应均值的未知真实值，\\(\\varepsilon_{ij}\\) 是一个随机变量，表示由自然变异和其他可能的随机和非随机误差源引起的噪声。研究人员应尽力控制非随机误差源，包括模型误差、测量误差、观测误差和处理误差的错误指定。为了进行这个实验，研究人员必须选择 \\(rt\\) 个实验单元，然后将 \\(r\\) 个实验单元随机分配给每个处理。该过程的随机化部分对于防止处理分配中出现偏差非常重要。正是由于实验单元被随机分配给处理，随机化或置换分析 (permutation analysis) 可用于开发适当分析的理论 (Kempthorne, 1952). 关于随机化的使用，至少可以说，它可以防止在实验中引入系统偏差。如果实验者不使用随机化，则无法判断观测到的差异是由于实验单元对处理的反应差异造成的，还是由于用于将实验单元分配给处理的系统方法造成的。 实验的统计目的是比较在实验单元上观测到的处理响应。例如，如果研究人员想比较高血压化合物对人类血压的影响，那么在研究中使用小白鼠作为实验单元将无法对人类做出推断。只能对实验单元的总体进行推断，研究中使用的实验单元是代表性样本。对想要进行推断的实验单元的总体进行表征是非常重要的。研究中使用的实验单元样本必须从总体中随机选择，以对该总体进行推断。通常不可能从要纳入研究的实验单元总体中随机选择实验单元。但至少实验单元的样本必须能够代表总体或一个概念总体 (conceptual population)。例如，在对生产线进行抽样时，人们希望为研究选择的物品能够代表尚未生产的物品总体。如果生产过程没有改变，那么可以合理地假设所选物品将代表未来的物品。描述实验中使用的实验单元所代表的实验单元的总体是非常重要的。如果实验单元不代表要对其进行推断 (inference) 的实验单元的总体，则不能进行推断，相反，人们可以推测 (conjecture) 处理对未抽样总体的效应。例如，从一项涉及白鼠的研究中获得的关于高血压化合物的信息可以用来推测（而不是推断）高血压化合物对人类的效应。 当为研究选择实验单元时，当研究中使用的实验单元组是同质的 (homogeneous) 或非常相似时，可以获得更好的处理之间的比较。在许多实验中，不可能选择 \\(rt\\) 个相同的实验单元。不相同的实验单元通过 \\(\\varepsilon_{ij}\\) 导致数据中的噪声。当实验单元不是同质的或不相似时，有三种方法可以用来解释实验单元之间的差异，一种方法是测量描述实验单元之间差异的特征，如体重和年龄，并使用 Milliken and Johnson (2001) 中描述的协方差分析 (analysis of covariance)。第二种方法是将实验单元分成几组几乎相同的实验单元。几乎相同的实验单元称为同质的。在这种情况下，处理可以在组内的相似实验单元上进行比较，其中组与组之间的变异可以在分析中被解释。相似实验单元的组被称为区组 (block)。解释实验单元之间变异性的第三种方法是同时使用区组和协变量 (covariate) 的分析 。假设有 \\(r\\) 个区组，每个区组有 \\(t\\) 个实验单元，每个区组中每个处理发生一次。表示第 \\(j\\) 个区组中第 \\(i\\) 个处理的观测到的响应的模型为 \\[\\begin{equation} y_{ij}=\\mu_i+b_j+\\varepsilon_{ij}^*\\quad\\mathrm{~for~}i=1,2,\\ldots,t,\\mathrm{~and~}j=1,2,\\ldots,r \\tag{4.2} \\end{equation}\\] 对于模型 (4.2)，模型 (4.1) 中的 \\(\\varepsilon_{ij}\\)s 替换为 \\(\\varepsilon_{ij} = b_j + \\varepsilon_{ij}^*\\)；也就是说，实验单元组或区组之间的变异已被识别并从 \\(\\varepsilon_{ij}^*\\) 中分离出来，它代表区组内实验单元的变异。通过将区组效应与实验单元分离，区组内变异 (within-block variation) 可用于比较处理效应，这涉及计算处理对比 (contrasts) 的标准误估计。 两种处理（或任何处理对比）可以在没有区组效应的情况下进行比较，方法是将两种处理的响应的区组内差异 (within-block differences) 视为 \\[\\begin{aligned} y_{ij}-y_{i^{\\prime}j}&amp; =(\\mu_i+b_j+\\varepsilon_{ij}^*)-(\\mu_{i^{\\prime}}+b_j+\\varepsilon_{i^{\\prime}j}^*) \\\\ &amp;=\\mu_i-\\mu_{i^{\\prime}}+\\varepsilon_{ij}^*-\\varepsilon_{i^{\\prime}j}^* \\end{aligned}\\] 这不取决于区组效应 \\(b_j\\)。这种差异的结果是，一个区组内两种处理响应差异的变异取决于实验单元之间的区组内变异，而不是区组间变异 (between-block variation)。 实验设计的目的是选择实验材料并进行分组，以便尽可能减少实验中各组内实验单元之间的噪声或实验误差。因此，要比较处理的实验单元应该尽可能相似，这样两种处理之间的较小差异就可以被检测为显著差异。 如果有 \\(t\\) 个处理和 \\(t\\) 个实验单元，则可以进行实验，并且可以根据观测结果估计每个处理的平均值。但无法获得误差方差的估计值。只有当部分或全部处理被重复时，才能获得误差方差的估计值（与 \\(\\varepsilon_{ij}\\) 或 \\(\\varepsilon_{ij}^*\\) 相关）。处理的重复 (replications) 是对处理的独立观测。因此，一种处理的两次重复必须涉及两个实验单元。实验单元是应用了处理的实体。但处理的重复必须涉及过程，以便在每个实验单元上独立应用并观测处理。因此，假设一名研究人员想比较两种饮食对兔子生长速度的影响，并且他有 \\(10\\) 只兔子可用于研究。这个过程是将五只兔子随机分配到每种处理中。但是，如果他将分配给其中一种饮食的五只兔子放在一个笼子里，而将分配给第二种饮食的五只兔子放在另一个笼子里，而同一个笼子里的兔子则从一个普通的碗里喂食这种饮食，结果会怎样呢？每只兔子被随机分配了饮食，但由于所有五只兔子都被放入一个笼子并用一个共同的碗喂食，因此不能对兔子进行独立观测。在这种情况下，实验单元是笼子而不是单个兔子。笼子之间是独立处理的，但笼子里的兔子却不是独立处理的。因此，笼子里的兔子不提供独立的饮食重复。了解进行研究的完整过程非常重要，以便能够了解何时发生独立重复以及何时不发生。必须遵守此定义以确定实验期间何时使用重复。研究人员经常使用复制 (duplicate) 或分割样本 (split samples) 来生成两个观测结果，并将它们称为重复 (replications)，而实际上它们是子样本 (sub-samples) 或重复测量 (repeated measures). 复制项必然不会提供与独立重复项相同的信息。 假设一名研究人员想要研究某所大学男女学生的身高差异。假设大学有 \\(22,000\\) 名学生。一个过程可以是从大学学生中随机选择 \\(100\\) 名女学生和 \\(100\\) 名男学生。下一步是找到随机样本中的所有学生并测量他们的身高，从而产生 \\(100\\) 个女性身高测量值和 \\(100\\) 个男性身高测量值。要找到所有 \\(200\\) 名学生，工作量似乎很大。相反，假设研究人员选择一名女性和一名男性，并测量每人的身高 \\(100\\) 次。第二个过程产生 \\(100\\) 个女性身高测量值（本例中为一名女性）和 \\(100\\) 个男性身高测量值（本例中也是一名男性）。每个数据集都有 \\(200\\) 个观测值，但第一个过程中一个数据集内 \\(100\\) 个测量值之间的变异性 (variability) 提供了大学女生和男生之间的变异性的测量。在第二种情况下，一组中的 \\(100\\) 个测量值的变异性提供了对同一个人进行的 \\(100\\) 个测量值之间的差异的度量。第二种情况提供了有关测量过程变异性的信息（对同一个人的重复测量），但没有提供关于特定大学的女性或男性身高之间的变异性的信息。对一个人身高的独立测量不能提供对总体身高的真实变异的测量。对 \\(100\\) 名女性身高的测量提供了 \\(100\\) 次重复，而对同一个人的 \\(100\\) 次测量提供了对该人的重复测量。对同一人的这 \\(100\\) 项测量被称为重复测量或子样本，但不是重复测量。 一位面包师进行了一项实验，比较了三种防腐剂在某种类型的蛋糕产品中抑制霉菌生长的能力。面包师把每种防腐剂混合在一起烤了一个蛋糕。每立方厘米蛋糕的霉菌孢子数量是在储存 \\(9\\) 天后测量的。面包师想要 \\(10\\) 次重复的分析，所以他把每个蛋糕分成 \\(10\\) 片，并获得了每片上的孢子数量。然而，这 \\(10\\) 次测量并不是由 \\(10\\) 种单独使用的防腐剂产生的。他的子样品测得的变异是蛋糕内变异 (within-cake variation) 的指标，而不是防腐剂实验单元间变异 (experimental-unit-to-experimental-unit variation) 或蛋糕间变异 (cake-to-cake variation) 的指标。为了得到每种防腐剂的 \\(10\\) 次重复，面包师需要用每种防腐剂烘焙 \\(10\\) 个蛋糕。这些蛋糕需要相互混合并独立烘焙。将一大批蛋糕面团搅拌在一起，加入防腐剂，然后将混合物倒入 \\(10\\) 个蛋糕平底锅中，可能会更容易。这一过程提供了 \\(10\\) 个蛋糕，但这些蛋糕并不是相互独立地混合在一起的，因此它们不是独立的重复。面包师需要将 \\(10\\) 批面团与防腐剂混合，然后在不同的烤箱 （或在不同的时间）从每批面团中烘焙一个蛋糕，以获得 \\(10\\) 种防腐剂的重复。 另一个非重复的例子涉及一些研究人员所称的条状试验 (strip trial)。在农学中，条状试验包括在一行 (rows)（或行组，a group of rows）中种植给定品种的所有种子，每行（或行组）种植不同的品种。然后将行（或行组）划分为八个部分，这些部分称为重复。图 4.1 中的图表表示六个条区 (strip plot)，每个条区有四行16，并被分成八个部分表示为重复。用条状试验代替八次独立重复的优点是，研究人员不需要在条状试验中不断地将种子从一个播种箱位置换到另一个播种箱位置，而且种植计划非常简单。现在，如果她想进行精心设计的实验，她就必须根据特定的随机方案更换播种箱八次。进行这样的随机化将在随机完全区组设计结构 (randomized complete block design structure) 中提供八个区组。如果实验者像分析随机完全区组设计一样分析条状试验数据，那么她的分析将是错误的。事实上，条状试验不能用来推断品种差异，因为每个品种只有一次独立的观测。四行或条区是应用该品种的实验单元。在条状试验中，研究人员可以轻松地将条区划分为 \\(20\\) 个部分 (parts) 或 \\(100\\) 个部分；毕竟，有了更多的“复制”，人们可以根据两种均值较小差异检测出显著的结果。但是，在这些条 (strips) 中的每一条上进行的这些测量都不是真正的重复；相反，它们是条区的子样本或重复测量。因此，获得越来越多的部分无助于检验均值之间的差异。确定某个部分或观测是否是真实重复的一个检验如下：如果研究人员可以通过分裂同样轻松地获得更多“重复”，那么她就没有获得真正的重复，而是获得了子样本或重复测量。区分子样本和重复样本非常重要，因为从子样本之间估计的误差方差通常比从重复样本或实验单元之间估计的误差方差小得多。使用从子样本计算出的误差方差构建的 \\(F\\) 统计量将比应有的值大得多，导致实验者确定更多的差异，因为其统计显著性超过了应有的差异。 图 4.1: 条区设计示意图，其中四个行和六个品种排列在八个伪重复中 4.2 设计实验的结构 设计实验 (designed experiment) 由两个基本结构组成，能够识别和区分每个结构至关重要。在为特定设计构建适当的模型和分析之前，实验设计中使用的所有因素必须分类为属于处理结构或设计结构。以下定义和讨论用于帮助描述两种结构之间的差异。 定义 4.1 ♦ 设计实验的处理结构 (treatment structure) 由实验者选择用于研究和/或比较的一组处理、因素、处理组合或总体组成。 处理结构是根据那些要比较的因素或处理构建的，通过它们对给定响应变量的效应来测量。必须选择处理结构中的因素来实现既定的实验目的。处理结构可以是一组处理，称为单向处理结构，也可以是一组处理组合，例如双向因素安排 (arrangement) 或高阶因素安排，加上任何对照或标准处理。 定义 4.2 ♦ 设计实验的设计结构 (design structure) 包括将实验单元分组为同质组或区组。 设计实验的设计结构涉及用于形成实验单元组的因素，以便观测处理的条件尽可能统一。如果所有实验单元都非常同质，则只需要一组或一组观测，并且实验单元可以完全随机地分配给处理。这样的设计结构称为完全随机设计结构 (completely randomized design structure). 如果需要多于一组的实验单元，使得组内的单元比组间的实验单元更加同质，则设计结构涉及某种类型的区组设计。有多种因素可用于形成实验单元的区组，但是，如下所述，用于构建区组的一个或多个因素不得与处理结构中的因素发生交互 (interact). 一旦选择了处理结构和设计结构，就通过准确描述将处理结构的处理随机分配（随机化）到设计结构中的实验单元的方法来指定设计的实验。 因此，总的设计实验包括 1）处理结构的选择，2）设计结构的选择和 3）将处理结构中的处理或处理组合随机分配给设计结构中的实验单元的方法。图 4.2 显示了设计实验的两个部分。 图 4.2: 使用随机化将处理结构与设计结构相结合以形成实验总体设计的图示 总的设计实验规定了用于获得适当分析的适当模型。在构建描述设计的模型时，对设计和处理结构进行了两个基本假设。首先，假设设计结构的组成部分是随机效应，即设计中使用的区组是来自实验单元的可能区组的总体的随机样本。这一假设意味着研究人员希望对大量的实验单元进行推断。其次，假设设计结构的组成部分（或因素）与处理结构的组成部分（或因素）之间没有交互作用。换言之，假设处理之间存在的关系从一个区组到另一个区组是一致的（随机变异除外），或者换句话说，区组因素不会影响处理之间的关系。许多教科书将区组因素描述为讨厌因素 (nuisance factors)，而没有解决讨厌因素与处理结构中的因素交互作用的可能性 (Cobb, 1997). 如果可以发生这种交互作用，则这些讨厌因素必须包括在处理结构中，或者讨厌因素的值可以被视为具有不等斜率可能性的协变量 (Milliken and Johnson, 2001). 必须仔细评估可能用于构建区组的因素的选择，以防止与处理结构中的因素可能发生交互。 设计结构的选择是利用实验单元的所有可用知识，并且是独立于处理结构选择的（不要让处理结构影响不良设计结构的选择）。同样，实验者应该在不了解设计结构的情况下选择处理结构（不要让设计结构妨碍选择必要的处理集合）。在指定了适当的设计结构并选择了所需的处理结构之后，可能需要在一个或两个结构中做出一些妥协，以使它们彼此兼容，并使实验者能够进行有效的实验。 4.2.1 设计结构类型 设计结构由区组类型或将实验单元分组为同质组来确定，并由用于形成区组的因素来指定。以下是对一些常见设计结构的描述。有两种基本的设计结构，它们被描述为完全区组 (complete block) 和不完全区组 (incomplete block) 设计结构。4.3 节对几种特定设计结构进行了更详细的讨论。 完全随机设计结构 (Completely randomized design structure). 在完全随机设计结构中，假设所有实验单元都是同质的，并且实验单元完全随机地分配给处理。通常，这些处理被分配相同数量的实验单元，尽管这不是必需的。当实验单元不是同质的，并且实验者不能确定允许将它们分组到更同质的组中的因素时，也可以使用这种设计结构。当区组因素的值被用作协变量而不是使用它们来形成区组时，可以使用协方差分析 (Milliken and Johnson, 2001). 随机完全区组设计 (Randomized complete block design). 如果有 \\(t\\) 个处理，那么随机完全区组设计结构包括具有实验单元的区组，每个区组中有 \\(t\\) 个或多个实验单元。当区组尺寸 (block size) 等于或大于处理数时，有可能在每个区组内出现一组完整的处理，因此被称为随机完全区组。如果每个区组的区组尺寸恰好等于 \\(t\\)，则每个处理恰好被随机分配到每个区组内的一个实验单元。如果每个区组内有 \\(t\\) 个以上的实验单元，那么每个处理可以分配到一个实验单元，一些处理（也可能是全部）可以分配到多个实验单元。如果 \\(t=5\\) 并且区组的尺寸为 \\(8\\)，则每个处理将被分配到每个区组内的实验单元，并且其中三个处理将被分配到一个额外的实验单元以进行这些处理的总共两次重复。一种策略是制定一种区组的处理模式，其中每个处理的观测数量尽可能均衡 (balanced)。图 4.3 包含一种将五种处理分配给三个尺寸为 \\(8\\) 的区组的方法。在每个区组内，将各自的处理随机分配给该区组内的实验单元。所示的安排是一组可能的随机化。如果每个区组由 \\(c\\times t\\) 个实验单元组成，其中 \\(c\\) 是整数，则每个处理可以分配给每个区组内的 \\(c\\) 个实验单元。这也是一个随机完全区组设计结构。随机完全区组设计结构是指区组内实验单元的数量大于或等于处理数量的任何区组方案，因此可以将一整套处理分配给每个区组中的实验单元。 图 4.3: 随机完整区组设计结构，在尺寸为 \\(8\\) 的区组中包含五种处理 拉丁方设计 (Latin square design). 拉丁方设计结构由两个方向的区组组成。对于涉及 \\(t\\) 个处理的实验，\\(t^2\\) 个实验单元被安排为 \\(t\\times t\\) 的方块 (square)，其中行被称为行区组 (row blocks)，列被称为列区组 (column blocks)。因此，实验单元的这种 \\(t\\times t\\) 安排在两个方向上被分区 (blocked)：行区组和列区组。为了构建拉丁方设计结构，将处理随机分配到方块中的实验单元，使得每种处理在每一行区组中发生一次且仅发生一次，在每一行区组中发生一次且仅发生一次。参见 Cochran and Cox (1957) 以了解在行区组和列区组中的各种处理安排。两个或多个方向的区组在许多学科中很常见，特别是当实验单元出现在矩形中时（其中一个维度可能是时间），按行和列进行分区很有用。Graeco–Latin 方块可用于形成三个方向的区组 (Cochran and Cox, 1957). 不完全区组设计 (Incomplete block design)。当一个或多个区组中的处理数超过实验单元数时，即出现不完全区组设计。当这种情况发生时，每个区组中不可能出现完整的处理集，因此被称为“不完全区组”。有几种特殊的不完全区组设计结构，如均衡不完全区组 (balanced incomplete blocks) 和部分均衡不完全区组 (partially balanced incomplete blocks). 均衡不完全区组设计结构是指将处理分配给区组，使得每对处理在同一区组中出现的次数相等。当一组处理在区组内一起出现相同的次数，而其他处理在一些区组内一起出现不同的次数时，就会出现部分均衡不完全区组设计结构。第 5 章中讨论的裂区设计结构是部分不完全区组设计结构的一个示例。例 4.5 描述了一些不完全区组设计结构。 各种组合和推广 (Various combinations and generalizations). 有多种方法可以对实验单元进行分组。有时分组不满足上述定义，但仍然提供了有效的设计结构。一个例子是区组尺寸因区组而异，其中一些区组是不完全的，而另一些区组是完全的。在任何情况下，这些其他的区组方案都可以为实验者提供非常可行的设计结构，以便进行有效的实验。 4.2.2 处理结构类型 处理结构由实验者希望研究的各种处理或处理组合或因素和因素组合组成。处理结构组成部分的选择应与实验目的相关，实验目的应在研究方案或描述中具体说明。接下来描述了一些常见的处理结构类型，每一种都在 4.3 节中进行了更详细的讨论。 单向处理结构 (One-way treatment structure). 单向处理结构由一组 \\(t\\) 个处理或总体组成，其中处理之间没有假定的结构。处理之间可能存在关系，例如使用四个温度，120、130、150和160°C。如果处理是通过组合两个或多个因素构建的，则这些因素不会用于表示模型中的处理。单向处理结构可用于表示任何一组处理，当一些可能的处理组合缺失时，单向处理结构通常用于表示析因 (factorial) 处理结构。第 13 章使用了这种方法。 双向处理结构 (Two-way treatment structure). 双向处理结构由通过组合两个不同因素的水平 (levels) 或可能性 (possibilities) 而构建的处理集组成。所得到的处理集，称为处理组合，是通过将其中一个因素的每个可能性与另一个因素的每个可能性组合而生成的。如果第一个因素有 \\(s\\) 个可能性，第二个因素有 \\(r\\) 个可能性，该组合产生 \\(sr\\) 种处理组合。图 4.4 给出了一个双向处理结构的例子，其中因素 \\(A\\) 有三种可能性，因素 \\(B\\) 有四种可能性，交叉产生 \\(12\\) 种处理组合。 图 4.4: 双向处理结构，其中因素 \\(A\\) 有三个水平，因素 \\(B\\) 有四个水平，生成 \\(12\\) 种处理组合 析因安排处理结构 (Factorial arrangement treatment structure). 析因安排处理结构由通过组合两个或多个因素的水平而构建的处理组合的集合组成。双向处理结构是双向析因安排。三向到 \\(n\\) 向处理结构也是析因安排。\\(n\\) 向处理结构是通过组合 \\(n\\) 个因素的可能性而生成的，其中，因素分别具有 \\(s_1,s_2,\\dots,s_n\\) 个可能性，从而生成 \\(s_1\\times s_2\\times\\dots\\times s_n\\) 种处理组合。析因安排处理结构的例子散布在整本书中。 部分析因安排处理结构 (Fractional factorial arrangement treatment structure). 部分析因安排处理结构仅由析因安排处理结构中可能的处理组合的一部分或一小部分组成。有许多系统的技术来选择适当的分数 (fraction)，其中大多数取决于实验者对处理结构中各种类型因素之间交互作用的假设。一个实验可能涉及 \\(8\\) 个具有两水平的不同因素，因此总共有 \\(2^8\\) 个处理组合。研究人员可能想寻找重要的主效应和两个因素的交互作用。在这种情况下，研究中可以使用四分之一分数 (one-fourth fraction) 或64个处理组合。这样的设计通常表示为 \\(2^{8-4}\\) 部分析因安排，更多细节参见 Milliken and Johnson (1989). 拉丁方排列处理结构涉及具有 \\(n\\) 行处理，\\(n\\) 列处理和 \\(n\\) 个单元格 (cells) 处理的三向析因排列。拉丁方排列由 \\(n^3\\) 种可能的处理组合中的 \\(n^2\\) 种组成，或者是\\(n^3\\) 种可能的处理组合的 \\(1/n =(n^2/n^3)\\) 部分。部分拉丁方安排的一个可能用途是，可以假设这三个因素之间没有双向或三向交互作用。 最优设计处理结构 (Optimal design treatment structures)。对于许多实验情况，处理结构中的所有因素都是定量的，研究目的是收集数据以建立特定的线性或非线性模型。使用其中一个设计准则 (St. John and Draper, 1975) 选择的处理组合形成了最优设计。这组处理组合被称为最优设计处理结构。 具有一个或多个对照的部分安排 (Factorial arrangement with one or more controls). 用于满足实验目的的期望处理结构可以包括将多种处理结构相结合。例如，实验的处理结构可以包括将 \\(c\\) 个对照的单向处理结构与双向析因安排处理结构相结合。图 4.5 包含一种这样的处理结构，其中因素安排由两个水平的因素 \\(A\\) 和三个水平的因素 \\(B\\) 以及三个对照组成。 图 4.5: 将单向和双向处理结构组合，形成九种处理组合的处理结构用于实验 出于分析目的，所有上述处理结构始终可以被视为一种单向处理结构。特别是，当处理结构是两个或多个处理结构的复杂组合时（如图 4.5 所示），在分析结果数据时通常最好将一组处理视为单向处理结构。 裂区和重复测量设计结构由不完全区组设计结构和涉及两个或多个因素的析因安排处理结构组成。实际上，裂区和重复测量设计的设计结构和处理结构的组合产生不同尺寸的实验单元，这是一个必须解决的问题，以便获得适当的分析。这样的设计将在第 5 章讨论。 4.3 不同设计实验的示例 有大量关于用于多种类型实验的各种类型设计的已发表信息，例如， Cochra and Cox (1957), Davies (1954), Federer (1955), Hicks (1993), John (1971), Kirk (1968), Cornell (1990), Anderson and McLean (1974), Box et al. (1978), Cobb (1997), Kempthorne (1952), Laundsby and Weese (1993), Lentner and Bishop (1986), Meed (1988), Montgomery (1991) and Winer (1971). 本节包含几个示例，以演示 4.2 节中描述的设计结构和处理结构。希望这一讨论将帮助读者将这些概念应用到他们自己的实验中。在大多数情况下，通过指定设计结构的类型和处理结构的类型来命名所得到的设计实验。例如，设计的实验可以由随机完全区组设计结构中的双向处理结构组成。这种描述设计实验的方法不同于文献中通常使用的方法，但作者认为使用设计结构和处理结构是识别设计实验的最好方法。此外，这一描述还有助于构建适当的模型并进行适当的分析。针对每种实验情况，给出了相应的设计结构和处理结构，并给出了相应的模型，以及带有相应的变异源及相应自由度的的方差分析表。本节不给出平方和的计算公式，但在其他章节中提供了一些有计算的例子。本章的重点是确定误差平方和的计算方法，并确立相应的自由度。 4.3.1 示例 4.1: 饮食 一位营养学家想要研究健康饮食对体重减轻的影响。本实验的处理结构是单向分类，涉及单个因素，称为饮食，具有五个水平或五个处理。许多不同的设计结构可以用来评估饮食。如果有 \\(20\\) 个同质的人，那么可以使用完全随机设计结构，其中每种饮食被随机分配给四个人。完全随机设计结构中的单向处理结构的一个模型是 \\[\\begin{equation} y_{ij}=\\mu_i+\\varepsilon_{ij}\\quad i=1,2,\\ldots,t,j=1,2,\\ldots,n_i \\tag{4.3} \\end{equation}\\] 其中 \\(\\mu_i\\) 表示第 \\(i\\) 种处理（饮食）的均值，\\(\\varepsilon_{ij}\\) 表示随机误差。模型 (4.3) 的方差分析表见表 4.1，其中假设了 \\(\\varepsilon_{ij}\\sim \\text{i.i.d.}\\,N(0,\\sigma^2)\\). 表 4.1 包含公式 (4.3) 中模型的不同变异源及其各自的自由度。实验误差的 \\(15\\) 个自由度是从经过相同处理的人之间的变异中得到的。有四个人接受了饮食 1，提供了经过相同处理的四个人，这四个人体重减轻值之间的差异为误差提供了三个自由度。每种饮食有四个人经过相同处理。因此，五种饮食中的每种饮食的数据都有三个可供误差的自由度。如果方差相等，那么这五组三个自由度可以合并为一个涉及 \\(15\\) 个自由度的误差项。第 2 章中的方法可用于评估等方差假设的合理性。 表 4.1: 完全随机设计结构中单向处理结构的方差分析表 x 假设研究者在给定时间段内只能招募并采访五个人。让时间段成为一个区组因素，并在每个时间段内将五种饮食随机分配给一个人。该设计是随机完全区组设计结构中的单向处理结构，具有四个尺寸为五的区组。可用于描述此设计中的数据的模型是 \\[\\begin{equation} y_{ij}=\\mu_i+b_j+\\varepsilon_{ij}\\quad i=1,2,3,4,5,j=1,2,3,4 \\tag{4.4} \\end{equation}\\] 其中 \\(\\mu_i\\) 表示第 \\(i\\) 个处理（饮食）的均值，\\(b_j\\) 表示第 \\(j\\) 个区组的效应，\\(\\varepsilon_{ij}\\) 表示与分配给第 \\(j\\) 个区组中第 \\(i\\) 个处理的人相关的随机误差。模型 (4.4) 的方差分析表如表 4.2 所示。误差自由度是通过使用每个区组内处理的四个正交对比来计算的，例如， \\[\\begin{array}{ll}q_{1j}=y_{1j}-y_{2j}&amp;j=1,2,3,4\\\\q_{2j}=y_{1j}+y_{2j}-2y_{3j}&amp;j=1,2,3,4\\\\q_{3j}=y_{1j}+y_{2j}+y_{3j}-3y_{4j}&amp;j=1,2,3,4\\\\q_{4j}=y_{1j}+y_{2j}+y_{3j}+y_{4j}-4y_{5j}&amp;j=1,2,3,4\\end{array}\\] 表 4.2: 随机完全区组设计结构中单向处理结构的方差分析表，每个区组中每种处理有一次重复 x 相同 \\(i\\) 值的 \\(q_{ij}\\) 值都具有相同的均值，表明它们都经相同处理。因此，每组四个 \\(q_{ij}\\) 值的方差为误差提供了三个自由度。因此，可以将四组三个自由度合并（如果方差相等）为具有 \\(12\\) 个自由度的误差平方和。然而，\\(q_{ij}\\) 的方差并不相等，必须在合并 (pooling) 之前重新缩放。对于 \\(j = 1, 2, 3, 4\\)，方差为 \\(\\text{Var}(q_{1j}) = 2\\sigma^2,\\text{Var}(q_{2j})= 6\\sigma^2,\\text{Var}(q_{3j})= 12\\sigma^2\\) 以及 \\(\\text{Var}(q_{4j})= 20\\sigma^2\\)，因此方差为在合并之前需要将 \\(q_{ij}\\) 除以 \\(\\sigma^2\\) 的系数。实际上，这些合并的平方和提供了区组与饮食交互作用的平方和。因此，获得相似处理的方差的第二种方法是使用区组与处理的交互作用 (block-by-treatmen interaction) 来获得随机完全区组设计结构的实验误差估计。 接下来，假设没有 \\(20\\) 个同质的人，但有 \\(10\\) 个同质的男性和 \\(10\\) 个同质的女性。一种策略是使用人的性别作为区组因素，其中有两个尺寸为 \\(10\\) 的区组。可以使用随机完全区组设计结构，其中每种饮食将随机分配给两名男性和两名女性，因此每个区组中每种饮食有两次重复。随机完全区组设计结构中单向处理结构的模型为 \\[\\begin{equation} y_{ijk}=\\mu_{i}+b_{j}+\\boldsymbol{\\varepsilon}_{ijk}\\quad i=1,2,3,4,5,j=1,2,k=1,2 \\tag{4.5} \\end{equation}\\] 其中 \\(\\mu_i\\) 表示第 \\(i\\) 个处理（饮食）效应的均值，\\(b_j\\) 表示第 \\(j\\) 个区组的效应，\\(\\varepsilon_{ijk}\\) 表示与分配给第 \\(j\\) 个区组中第 \\(i\\) 个处理第 \\(k\\) 个人相关的随机误差。模型 (4.5) 的方差分析表如表 4.3 所示。有一个与设计结构或人的性别相关的自由度已从表 4.1 的误差项中删除。随机完全区组设计结构中的单向处理结构的误差项，其中每个区组中每个处理有一个观测结果，是根据区组与处理的交互作用来计算的。这种设计包括区组和每个区组中每种处理的多次观测。区组与处理的交互作用的自由度等于 \\((2-1)×(5-1)=4\\). 每个区组内每种饮食的两个观测结果的变异性提供了一个自由度。因此，在每个区组内对经相同处理的人进行比较时，有五个误差自由度，或者在两个区组内总共有 \\(10\\) 个自由度。将区组与处理的交互作用与区组内变异合并起来共提供了 \\(14\\) 个误差自由度。 表 4.3: 随机完全区组设计结构中单向处理结构的方差分析表，每个区组中每种处理有两次重复 x 在大多数情况下，人的性别不是区组因素好的选择，因为处理（这个例子为饮食）可能会与人的性别发生交互 (interact)。如果选择用于构建区组的一个或多个因素可能与处理发生交互，则该因素需要作为分层因素或在具有可能不等斜率的协方差分析中包括在处理结构中，以进行适当的分析 (Milliken and Johnson, 2001). 在这个例子中，一个人的性别必须与五种饮食相结合，以形成双向因素安排或双向处理结构。这种双向处理结构由 \\(10\\) 种处理组合组成，通过将人的两个性别水平与五个饮食水平相结合而产生。通过将人的性别从设计结构切换到处理结构，得到的设计结构是一个完全随机的设计，每个处理组合有两次重复。随机化方案是将每种饮食随机分配给两名男性和两名女性。这是与模型 (4.5) 相同的随机化方案，但具有不同的处理和设计结构。完全随机化设计结构中的双向处理结构的一个模型是均值模型： \\[\\begin{equation} y_{ijk}=\\mu_{ij}+\\varepsilon_{ijk}\\quad i=1,2,\\ldots,5,j=1,2,k=1,2 \\tag{4.6} \\end{equation}\\] 其中 \\(\\mu_{ij}\\) 表示第 \\(ij\\) 种处理组合（人的性别与饮食）的平均值，\\(\\varepsilon_{ijk}\\) 表示随机误差。有时，均值 \\(\\mu_{ij}\\) 表示为效应模型： \\[\\mu_{ij}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij}\\] 其中 \\(\\mu\\) 是总体平均值17(overall mean)，\\(\\tau_i\\) 是第 \\(i\\) 种饮食的效应，\\(\\beta_j\\) 是人的第 \\(j\\) 种性别的效应，\\(\\gamma_{ij}\\) 是交互作用效应。表 4.4 给出了模型 (4.6) 这两种 \\(\\mu_{ij}\\) 表达式的方差分析表。 表 4.4: 完全随机设计结构中双向处理结构方差分析表，包含均值模型和效应模型 x 接下来，假设饮食结构由一个对照饮食和四个饮食组成，这四个饮食由两个蛋白质水平和两个碳水化合物水平的四个组合组成，如图 4.6 所示。饮食处理结构是一种双向析因安排，当与人的性别交叉时，对照组会产生一种三向处理结构（蛋白质×碳水化合物×性别），其中有两个对照，一个对照用于男性，一个对照用于女性。设计结构是完全随机的，每个处理组合分配给两个人。可以用来描述这些数据的模型是 \\[\\begin{equation} y_{ijk}=\\mu_{ij}+\\varepsilon_{ijk}\\quad i=0,1,2,3,4,j=1,2,k=1,2 \\tag{4.7} \\end{equation}\\] 其中 \\(\\mu_{01}\\) 和 \\(\\mu_{02}\\) 表示对照组的平均值， \\(\\mu_{ij},i = 1, 2, 3, 4, j = 1, 2\\) 表示饮食与性别处理组合的平均值。表 4.5 为模型 (4.7) 的方差分析表。其中 “Control vs 22” 表示对照饮食与四种蛋白质和碳水化合物处理组合的平均值之间的比较。完整的分析最有可能使用饮食与性别的双向处理结构，并具有适当的处理均值的对比，以提供涉及蛋白质、碳水化合物、人的性别和对照的比较。这种对比的构建将在第 6 章及以后进行讨论。 表 4.5: 完全随机设计结构中三向析因安排与两个对照相结合的处理结构的方差分析表 x 图 4.6: 具有双向析因安排和一个对照的处理结构的饮食结构 4.3.2 示例 4.2: 房屋油漆 一家油漆公司想要比较四种白色房屋油漆承受环境条件的能力。实验中准备了四栋方形房屋，每栋房屋的一面朝北，因此房屋可以作为区组因素。房屋的每一面都可能暴露在不同类型的天气下，因此房屋的侧面（这里用北、南、东、西方向表示）也可以用作区组因素。由于处理数量（四种油漆）与两个区组因素的水平数相同，因此可以使用拉丁方设计结构来研究油漆。在这里，油漆可以分配到房屋的侧面，其中每种油漆可以在每个房屋上发生且仅发生一次，并且在每个方向上发生且仅发生一次。存在三种基本的拉丁方安排（参见 Cochran and Cox, 1957）。随机化过程是从三种可能的安排中随机选择一种，然后将房屋随机分配给行，将方向随机分配给列，并将油漆类型随机分配给方块中的字母。表 4.6 显示了一种将油漆分配给房屋和方向的安排。 表 4.6: 将一组处理从单向处理结构分配到拉丁方设计结构 x 本实验的设计是一种单向处理结构中的拉丁方设计结构。可以用来描述该实验数据的模型是 \\[\\begin{equation} y_{ijk}=\\mu_i+h_j+d_k+\\boldsymbol{\\varepsilon}_{ijk}\\quad i=1,2,3,4,j=1,2,3,4,k=1,2,3,4 \\tag{4.8} \\end{equation}\\] 其中 \\(\\mu_i\\) 表示第 \\(i\\) 种油漆的平均耐磨性得分，\\(h_j\\) 表示第 \\(j\\) 个房屋的效应，\\(d_k\\) 表示第 \\(k\\) 个方向的效应，\\(\\varepsilon_{ijk}\\) 表示实验单元误差。表 4.7 给出了模型 (4.8) 的方差分析表。拉丁方设计结构的误差由对比组成，这些对比测量了油漆、房屋与方向的交互作用。 表 4.7: 拉丁方处理结构中单向处理结构的方差分析表 x 接下来，假设油漆具有由 1）基础油漆，2）基础油漆 + 添加剂 I，3）基础油漆 + 添加剂 II，以及 4）基础油漆 + 添加剂 I +添加剂 II。油漆的这种结构提供了双向处理结构，其中一个因素是两个水平[无和添加一些]的添加剂 I，第二个因素是两个水平[无和添加一些]的添加剂 II。由此产生的四种处理组合见表 4.8. 表 4.8: 房屋油漆的双向处理结构示例 x 拉丁方设计结构中的双向处理结构的一个模型是 \\[\\begin{equation} y_{ijkm}=\\mu+\\gamma_i+\\beta_j+(\\gamma\\beta)_{ij}+h_k+d_m+\\varepsilon_{ijkm}\\quad i=1,2,\\quad j=1,2,\\quad k=1,2,3,4,\\quad m=1,2,3,4 \\tag{4.9} \\end{equation}\\] 其中 \\(\\gamma_i\\) 表示添加剂 I 的效应，\\(b_j\\) 表示添加剂 II 的效应，\\((gb)_{ij}\\) 表示两种添加剂之间的交互作用。表 4.9 给出了模型 (4.9) 的方差分析表。分析模型 (4.8) 和 (4.9) 的唯一区别在于，在模型 (4.9) 中，油漆具有一种结构，用于将油漆效应划分为添加剂 I、添加剂 II 以及添加剂 I 和 II 的交互作用所产生的效应。即使处理结构的分析发生了变化，与设计结构相对应的分析部分仍然不受影响。 最后，假设有八栋房屋可用，以便可以使用两种不同的拉丁方设计结构进行实验。表 4.10 显示了将油漆分配给房屋-方向组合的一种可能分配。如果油漆具有表 4.8 中的双向处理结构，则模型由下式给出 \\[\\begin{align} y_{ijkmn}&amp;=\\mu+\\gamma_i+\\beta_j+(\\gamma\\beta)_{ij}+s_k+h_{n(k)}+d_m+\\varepsilon_{ijkmn}\\\\ i&amp;=1,2,\\,j=1,2,\\,k=1,2,\\,m=1,2,3,4,\\,n=1,2,3,4 \\tag{4.10} \\end{align}\\] 其中 \\(s_k\\) 表示方块 \\(k\\) 的效应，\\(h_{n(k)}\\) 表示方块 \\(k\\) 中房屋 \\(n\\) 的效应。模型 (4.10) 的方差分析表如表 4.11 所示。 表 4.9: 拉丁方处理结构中双向处理结构的方差分析表 x 表 4.10: 在重复拉丁方设计结构中显示单向处理结构的安排 x 注释: Square 1 和 Square 2 为用于重复拉丁方设计的两个房屋分组 表 4.11: 重复拉丁方设计结构中双向处理结构的方差分析表 x 注释: Square 为用于重复拉丁方设计的房屋分组 4.3.3 示例 4.3: 钢板 当需要在两个方向上分区 (block) 时，拉丁方设计结构非常有用，但是实验者使用的每个拉丁方安排都不是拉丁方设计结构。此示例用于演示使用拉丁方安排处理结构的后果。将两种油漆添加剂组合起来，对钢板涂漆。该实验的目的是研究油漆组合保护钢材免受高温影响的能力。每种油漆添加剂有五个水平和五个温度来检查保护能力。该实验适用于拉丁方，其中添加剂 I 的水平分配给行，添加剂 II 的水平分配给列，温度水平分配给方块内的单元格。这种排列产生 \\(25\\) 种处理组合。实验单元为 \\(25\\) 块厚 \\(0.2cm\\)、面积为 \\(1 m^2\\) 的钢板。随机化过程是将 \\(25\\) 种处理组合中的一种随机分配给 \\(25\\) 张钢板中的每一张。在这种情况下，处理结构是 \\(5^3\\) 析因安排的一部分（因为它由添加剂 I × 添加剂 II × 温度的 \\(125\\) 种可能的处理组合中的 \\(25\\) 种组成），称为拉丁方安排 (Latin square arrangement) 或拉丁方处理结构 (Latin square treatment structure). 该设计结构是完全随机设计，因为处理组合完全随机地分配给钢板。由于这是部分析因，因此每个主效应与其他两个因素的两因素交互作用和三因素交互作用部分混叠 (partially aliased)（参见 Cochran and Cox, 1957, p. 245）。为了正确分析该实验设计，必须对模型中的参数做出一些假设。通常的假设是不存在双向交互作用，也不存在三向交互作用。然而，人们应该非常小心，如果没有一些先验信息（可以来自其他实验、现有文献等）表明交互作用实际上可以忽略不计，就不要做出这样的假设。表 4.12 给出了一种这样的拉丁方安排，完全随机设计结构中拉丁方处理结构的模型为 \\[\\begin{align} y_{ijk}&amp;=\\mu+\\mathrm{AI}_i+\\mathrm{AII}_j+T_k+\\varepsilon_{ijk},\\quad(i,j,k)\\in\\mathrm{Index} \\tag{4.11} \\end{align}\\] 其中 \\(\\mathrm{AI}_i\\) 表示的添加剂 I 第 \\(i\\) 个水平的效应，\\(\\mathrm{AII}_j\\) 表示添加剂 II 第 \\(j\\) 个水平的效应，\\(T_k\\) 表示温度第 \\(k\\) 个水平的效应，\\(\\mathrm{Index}\\) 表示由实验中观测到的 \\(25\\) 种处理组合组成的指标集。 表 4.12: 拉丁方安排处理结构，其中 \\(T_i\\) 表示温度第 \\(i\\) 个水平 x 如果忽略温度水平的应用，则得到的数据表是完全随机设计结构中双向处理结构的数据表，如表 4.13 所示。该双向处理结构的方差分析表见表 4.14. 该设计包括每个处理组合的一个观测结果，因此没有可用的自由度来估计误差，因为没有经过相同处理的钢板。AI 水平和 AII 水平之间的交互作用与 \\(16\\) 个自由度有关。现在，当温度包括在结构中时，由于检验温度均值相等而产生的平方和是 AI 与 AII 交互作用平方和的一部分，如表 4.15 所示。这意味着 AI 与 AII 交互作用的一部分与温度效应相同，或者说，与温度相关的四个自由度与此交互作用相关的四种自由度混叠 (aliased). 同样，与 AI 效应相关联的四个自由度与 AII 和温度交互作用的四个自由度混叠，与 AII 效应相关的四个自由度与 AI 和温度交互作用的四个自由度混叠。表 4.16 中给出了使用模型 (4.11) 的拉丁方处理结构的方差分析表。使用术语“残差” (residual) 而不是“误差” (error)，因为相应的平方和涉及误差加上可能不为零的任何交互作用效应。如果零交互作用的假设不正确，那么残差均方将过大，由此产生的 \\(F\\) 检验将过小。因此，如果实验中存在交互作用，就无法发现，并且任何其他可检测的处理效应都可能被掩盖。 表 4.13: 拉丁方安排中添加剂 I 水平和添加剂 II 水平的双向处理结构，忽略了温度水平 x 表 4.14: 拉丁方安排双向处理结构部分的方差分析表 x 表 4.15: 拉丁方安排双向处理结构部分的方差分析表，从两种添加剂的交互作用中划分出温度的变异 x 表 4.16: 拉丁方安排处理结构方差分析表 x 4.3.4 示例 4.4: 氮和钾的水平 模型和结果分析由三个基本组成部分组成：i) 处理结构，ii) 设计结构，以及 iii) 误差结构。此示例演示了如何使用三个基本组件来构建模型。一位植物育种家想要研究三种水平的氮 (N) 和四种水平的钾 (K) 的组合对其新玉米品种产量的影响。他的处理结构是双向析因安排，有 \\(12\\) 种处理组合（\\(3\\) 个水平的氮 × \\(4\\) 个水平的钾）。他有三块土地用于进行实验，他将这些土地作为区组。每个区组被分为 \\(12\\) 个部分，称为“区” (plots). 每种处理组合被随机分配到每个区组内的一个区。因此，设计结构是随机完全区组设计，因为每种处理组合在每个区组中出现一次。实验的总体设计称为随机完全区组设计结构中的双向处理结构（随机完全区组设计中的区组被一些作者称为重复 (replications)；然而，我们更喜欢将它们称为区组而不是重复，以便将它们与完全随机设计结构中的重复 (replications) 区分开来。示例 4.5 中的讨论描述了区组和重复之间的重要区别）。此示例的模型是 \\[\\begin{equation} y_{ijk}=\\mu_{ij}+b_{k}+\\boldsymbol{\\varepsilon}_{ijk}\\quad i=1,2,3,j=1,2,3,4,k=1,2,3 \\tag{4.12} \\end{equation}\\] 其中 \\(\\mu_{ij}\\) 是氮的第 \\(i\\) 个水平与钾的第 \\(j\\) 个水平的平均值，\\(b_k\\) 是第 \\(k\\) 个区组的效应，\\(\\varepsilon_{ijk}\\) 表示与每个区组内的区相关的随机误差。一般来说，通过将三种结构中的每一种结构的模型相加来构建一般模型 \\[\\begin{equation} Y= \\mathrm{treatment structure} + \\mathrm{design structure} + \\mathrm{error structure(s)} \\tag{4.13} \\end{equation}\\] 同样，相应的方差分析表也有三个部分。表 4.17 给出了模型 (4.13) 一般的方差分析表。表 4.18 给出了模型 (4.12) 的方差分析表。一般来说，必须考虑到可能存在一个以上的误差项。例如，裂区和重复测量模型有一个以上的误差项（见第 5 章）。 表 4.17: 一般模型的方差表分析 x 表 4.18: 随机完全区组设计结构中双向处理结构的方差分析表 x 4.3.5 示例 4.5: 区组和重复 在许多关于实验设计的教科书中，要么没有区分区组和重复，要么至少对这种区别存在混淆 (confusion)。包含这组示例是为了演示两个概念之间的差异，并说明处理结构与设计结构的组合可以产生实验的多个总体设计。假设研究人员想使用一个设计结构来研究单向处理结构中四种处理的效应，该设计结构有六个尺寸为二的区组（每个区组只有两个同质的实验单元）。在这种情况下，所需的设计结构是不完全区组设计。如果有足够的区组，使得每个处理对都可以在一个区组中同时进行相同次数，那么就可以使用均衡不完全区组设计结构 (Cochran and Cox, 1957). 例如，如表 4.19 所示，可以将四种处理方式分配给区组。在这种情况下，设计结构中有六个区组，每个处理重复三次。此示例用于指出区组和重复的概念是不同的，并强调区组和重复应始终保持分离。区组和重复仅在随机完全区组设计结构的情况下是等价的，其中每个处理在每个区组内观测一次且仅观测一次。不完全区组设计结构的随机化过程包括为区组编号分配区组，然后将分配给该区组的两个处理随机分配给该区组内的两个实验单元。对于表 4.19 中的示例，设计结构与六个区组相关联（见表 4.19 ），而不与由于分配过程恰好发生的三次重复相关联。表 4.19 安排的模型为 \\[\\begin{equation} y_{ij}=\\mu_i+b_j+\\boldsymbol{\\varepsilon}_{ij},\\quad\\mathrm{for~}(i,j)\\in\\mathrm{Index} \\tag{4.14} \\end{equation}\\] 其中 \\(\\mathrm{Index}=\\{(A, 1), (B, 1), (A, 2), (C, 2), (A, 3), (D, 3), (B, 4), (C, 4), (B, 5), (D, 5), (C, 6), (D, 6)\\}\\)，且对子 \\((i,j)\\) 只能取如索引集所示观测到的处理 × 区组组合的值。表 4.20 给出了模型 (4.14) 的方差分析表。与这种连通的18区组-处理 (connected block-treatment) 安排相关的自由度是如此计算的：与区组处理交互作用相关的自由度（就好像观测到了所有组合）减去空单元格的数量19。表 4.21 显示了观测到的区组-处理组合（用 “X” 表示）。有六个区组和四个处理，因此如果所有组合都存在，则区组处理交互作用将基于 \\((6-1)(4-1)=15\\) 个自由度。有 \\(12\\) 个单元格缺失，因此与误差项相关的自由度为 \\(15-12=3\\). 表 4.19: 将四种处理分配到两个实验单元的六个区组的第一种分配：提供均衡不完全区组设计结构 x 表 4.20: 表 4.19 中的均衡不完全区组设计结构的方差分析表 x 表 4.21: 区组与处理的双向结构，其中 \\(X\\) 表示观测到的组合，被填充和空缺的各有 \\(12\\) 个单元格 x 表 4.22 包含第二种分配模式，用于将四种处理分配给六个尺寸为二的区组。处理 \\(A\\) 出现在所有区组中并重复六次。处理 \\(B,C,D\\) 出现在两个区组中且每个区组提供两次重复。模型（4.14）可用于描述此数据，其中索引集为 \\[\\mathrm{Index}=\\{(A, 1), (B, 1), (A, 2), (C, 2), (A, 3), (D, 3), (A, 4), (B, 4), (A, 5), (C, 5), (A, 6), (D, 6)\\}\\] 表 4.22: 将四种处理分配给两个实验单元的六个区组，第二种分配：提供不均衡不完全区组设计结构 x 表 4.20 中的方差分析表也适用于表 4.22 中的安排。如果希望将所有四种处理相互比较，即检验 \\(\\mu_A = \\mu_B = \\mu_C = \\mu_D\\)，则表 4.19 中的安排是最优的（使用 D-最优准则；St. John and Draper, 1975）。如果希望将处理 \\(A\\) 与其他三种处理进行比较，即检验 \\(\\mu_A = \\mu_B,\\mu_A = \\mu_C,\\mu_A = \\mu_D\\)，则表 4.22 中的安排是最优的。 表 4.23 给出了将四种处理分配到六个区组的第三种方法。将处理分为两组，其中 \\(A\\) 和 \\(B\\) 一起出现在三个区组中，处理 \\(C\\) 和 \\(D\\) 一起出现在三个区组中。处理 \\(A\\) 不与处理 \\(C\\) 或 \\(D\\) 的同时出现在一个区组中。处理和区组之间的结构不连通 (not connected)，因为处理分为这两组。定义一个新的变量“组” (group) 来表示两组处理。两组之间的比较是区组 \\(1,3,5\\) 的平均值与区组 \\(2,4,6\\) 的平均值之间的比较，或者说是区组间比较 (between-block comparisons). 处理 \\(A\\) 与处理 \\(B\\) 之间的比较以及处理 \\(C\\) 与处理 \\(D\\) 之间的比较属于区组内比较 (within-block comparisons). 对于处理 \\(A\\) 和处理 \\(B\\)，处理与区组交互作用的自由度为二。同样，对于处理 \\(C\\) 和处理 \\(D\\)，处理与区组交互作用的自由度也为二。误差平方和是将这两个处理与区组交互作用的平方和（及其自由度）合并得到的。表 4.23 中的安排的方差分析表见表 4.24。区组的平方和分为组的平方和和组内嵌套的区组的平方和。各组的平方和作为误差以检验假设 \\(\\mu_A + \\mu_B = \\mu_C + \\mu_D\\)），该假设具有由处理产生的一个自由度。两组处理与区组混杂 (confounded) 在一起；也就是说，如果两组均值之间存在差异，则不知道是由于处理集之间的差异还是由于两组区组之间的差异造成的。混杂的概念与混叠 (aliasing) 的概念类似，但混叠涉及两个（或多个）项无法区分，其中两个项都来自处理结构，而混杂涉及两个项无法区分，其中一项来自处理结构，另一项来自设计结构。 表 4.23: 将四种处理分配给两个实验单元的六个区组的第三种分配：提供不连通不完全区组设计结构 x 表 4.24: 表 4.23 中的不完全区组设计方差分析表 x 表 4.19、4.22 和 4.23 中三种设计之间的差异在于如何将处理分配给区组。请记住，所有三种设计的设计结构和处理结构都是相同的，因此设计结构和处理结构并不描述实验的总体设计。还必须指定将处理结构中的处理随机分配到设计结构中的实验单元的方法。 4.3.6 示例 4.6：行区组和列区组 区组可以通过多种方式出现，拉丁方设计结构是一种同时存在行区组和列区组的设计。拉丁方设计结构有多种变化，其中行比处理或多或少（或者列比处理或多或少）（Cochran and Cox, 1957）。本示例由按行和列划分的实验单元组成，其中每行和列的交集包含多个实验单元。处理结构是双向的，因素 \\(A\\) 有两个水平，因素 \\(B\\) 有两个水平，从而产生四种处理组合。共有 \\(24\\) 个实验单元，排列成三列两行，每行列组合包含 \\(4\\) 个实验单元。将四种处理组合随机分配给每个行列组内的四个实验单元。表 4.25 显示了实验单元的处理组合（非随机）的分配。该设计结构本质上由六个尺寸为四的区组组成，但评估行区组之间和列区组之间的变异性可能很有趣，因此可以构建一个模型以包含这些因素： \\[\\begin{align} y_{ijkm}&amp;=\\mu+\\alpha_i+\\beta_j+(\\alpha\\beta)_{ij}+r_k+c_m+(rc)_{km}+\\varepsilon_{ijkm}\\\\ i&amp;=1,2,j=1,2,k=1,2,m=1,2,3 \\tag{4.15} \\end{align}\\] 其中 \\(\\mu + \\alpha_i + \\beta_j + (\\alpha\\beta)_{ij}\\) 表示因素 A 和 B 的主效应和交互作用，\\(r_k\\) 表示行区组效应，\\(c_m\\) 表示列区组效应，\\((rc)_{km}\\) 表示行区组和列区组之间的交互作用，\\(\\varepsilon_{ijkm}\\) 表示实验单元误差。模型 (4.15) 对应的方差分析表见表 4.26. 分析可能只涉及六个区组，并且可以合并由于行区组、列区组及其交互作用而产生的平方和，从而为设计结构提供五个自由度。通过设计结构与处理结构的交互作用来获得误差平方和；即通过合并 A × 行区组、A × 列区组、A × 行区组 × 列区组、B × 行区组、B × 列区组、B × 行区组 × 列区组、A × B × 行区组、A × B × 列区组，以及 A × B × 行区组 × 列区组的平方和。 表 4.25: 在设计结构中使用行区组和列区组，在处理结构中使用双向安排的设计（非随机形式） x 表 4.26: 双向处理结构的行-列设计结构方差分析表 x 通过结合各种设计结构和处理结构，还有许多其他方法可以构建设计实验。希望以上例子将使实验者能够构建所需的设计实验，构建适当的模型，并进行相应的分析。 4.4 结束语 本章介绍了实验者在设计和分析实验时可以使用的概念和方法。还介绍了设计良好的实验的基本概念。所有设计的实验都包括两个基本特征：处理结构和设计结构。这些概念通常不会在许多其他统计分析书籍中使用。了解设计实验的这两个特征之间的差异将有助于数据分析师为他们的实验选择适当的分析。在必须不与处理结构中的因素发生交互的情况下讨论了区组因素的选择。最后，必须能够识别何时有真正的重复，何时只有子样本。 4.5 练习 也可译作 “排”，即图 4.1 中的竖线。↩︎ 这里的 \\(\\mu\\) 还不足以称为“总体平均值”，严谨地说是“截距”，如果对模型其他参数施加约束才可称为“总体平均值”。更多的讨论详见 Stroup (2012)，例如前言的 xxi 页以及 P.54 的 Note.↩︎ 见 6.3.2 节。↩︎ 原文：The degrees of freedom associated with this connected block–treatment arrangement are computed from the degrees of freedom associated with the block by treatment interaction as if all combinations were observed minus the number of empty cells.↩︎ "],["chap5.html", "第 5 章 多水平设计：裂区、条区、重复测量及其组合 5.1 识别实验单元的尺寸——四种基本设计结构 5.2 分层设计：一种多水平的设计结构 5.3 裂区设计结构：两水平设计结构 5.4 条区设计结构：一种无层次的多水平设计 5.5 重复测量设计 5.6 涉及嵌套因素的设计 5.7 结束语 5.8 练习", " 第 5 章 多水平设计：裂区、条区、重复测量及其组合 “We must be careful not to confuse data with the abstractions we use to analyze them.” - William James 统计学家在咨询工作中并不总是有机会设计他们必须帮助构建适当分析的实验。相反，统计学家首先需要确定研究人员所采用的设计实验的类型。识别过程中的第一步也是最重要的一步是确定是否使用了不止一种尺寸 (size) 的实验单元，如果使用了，则需要识别每种尺寸的实验单元。正如在本节中显而易见的那样，每种尺寸的实验单元都将具有相关的设计结构和处理结构。在识别出不同尺寸的实验单元后，可以通过组合用于描述与每个尺寸的实验单元对应的设计结构和处理结构的模型，从而构建用于进行适当分析的模型。 5.1 识别实验单元的尺寸——四种基本设计结构 涉及一种以上尺寸的实验单元的设计结构被称为多水平设计结构 (multilevel designs structures)，并且包括裂区 (split-plot) 类型的设计结构、条区 (strip-plot) 设计结构、重复测量 (repeated measures) 设计结构、分层 (hierarchical) 或嵌套 (nested) 类型的设计结构以及涉及上述各种组合的设计结构。重复测量和裂区类型的设计结构是相似的，尽管用于进行分析的假设可能不同。裂区和条区设计结构是从农业科学发展而来的，但在包括工程和制造业在内的许多其他学科中都有使用，第 24 章和第 25 章讨论了它们的分析。重复测量设计在社会科学和生物科学中广泛使用，但在大多数领域都适用，因为随着时间的推移，评估处理效应是有意义的，其分析见第 26 - 28 章。嵌套处理结构不同于重复测量和裂区设计使用的处理结构，嵌套处理结构在第 ?? 章中进行了描述。 有四种基本的设计结构，而最复杂的设计结构是这些结构的组合。四种基本设计结构是完全随机设计结构 (completely randomized design structure)、随机完全区组设计结构 (randomized complete block design structure)、裂区设计结构 (split-plot design structure) 和条区设计结构 (strip-plot design structure). 这些基本设计结构中的每一个都有自己的分析，计算所需误差平方和的过程也是独特的。本节介绍了基本设计结构以及计算误差平方和所需的过程。讨论中使用了一个例子，其中处理结构是双向的，一个因素有两个水平，另一个因素有三个水平，设计结构涉及 18 个实验单元。 该实验包括评估纸杯蛋糕 (cupcake) 烘焙后的体积，其中有三种配方和两种烹饪温度；因此，处理结构由三种配方和两种烹饪温度的六种组合组成。希望每种处理组合重复 3 次；因此需要烘焙 18 个纸杯蛋糕。图 5.1 中的图用于演示使用完全随机设计结构的过程。该过程是将处理结构中的六种处理组合完全随机分配给设计结构中的 18 个实验单元（纸杯蛋糕）。箭头表示每个处理组合分配给三个纸杯蛋糕。通常，该过程是一次制作一个纸杯蛋糕，因此纸杯蛋糕混合和烘焙的顺序与实验单元相对应。完全随机设计结构是通过混合一批给定的配方，填充一个纸杯蛋糕形状，然后在设置为特定温度的烤箱 (oven) 中烘焙纸杯蛋糕来完成的。每个纸杯蛋糕都必须用单独一批材料制作，也就是说，每个批次的蛋糕配方只能制作一个纸杯蛋糕，并且每个纸杯蛋糕都必须在设置为特定温度的烤箱中单独烘烤。该过程需要使用 18 批蛋糕混合物和 18 次使用一个或多个烤箱来烘焙纸杯蛋糕。与完全随机设计结构相关的误差是根据相同处理的纸杯蛋糕之间的变异性计算的。根据温度组合，每个配方中有三个纸杯蛋糕，因此三个纸杯蛋糕体积的变异提供了两个测量纸杯蛋糕误差的自由度。人们应该检验六种处理组合方差的相等性（见第 2 章），如果可能的话，将六种处理组的误差估计值合并在一起，以提供 \\(12\\) 个误差自由度，用于测量相同处理的纸杯蛋糕之间的变异性。可用于描述纸杯蛋糕体积的模型为 \\[y_{ijk}=\\mu+\\tau_{i}+\\beta_{j}+(\\tau\\beta)_{ij}+\\varepsilon_{ijk},\\quad i=1,2,j=1,2,3,\\mathrm{and}\\,k=1,2,3\\] 其中 \\(y_{ijk}\\) 表示用第 \\(j\\) 个配方制作并在第 \\(i\\) 个温度下烘焙的第 \\(k\\) 个纸杯蛋糕的体积，\\(\\mu\\) 表示总平均值，\\(\\tau_i\\) 表示第 \\(i\\) 个温度的效应，\\(\\beta_j\\) 表示第 \\(j\\) 个配方的效应，\\((\\tau\\beta)_{ij}\\) 是温度与配方交互作用，以及 \\(\\varepsilon_{ijk}\\) 表示与批次、批次内的纸杯蛋糕以及不同烤箱烘焙的差异相关的变异性。表 5.1 包含了完全随机设计结构中双向处理结构模型的方差分析表，其中根据实验单元或相同处理的纸杯蛋糕的变异性计算了 12 个自由度。与处理结构相关的自由度为 5，与设计结构相关的自由度为 12 个，所有自由度均分配给误差项。表 5.1 中标有 \\(EMS\\) 的列给出了方差分析表各行的预期均方形式。函数 \\(\\phi^2(\\tau),\\phi^2(\\beta),\\phi^2(\\tau\\beta)\\) 分别表示温度主效应均值、配方主效应均值和交互作用效应的二次函数。当相应的效应不存在时，这些函数是非负的且等于零。在本章的其余部分中可以使用类似的解释。 图 5.1: 完全随机设计结构中双向处理结构的随机化 表 5.1: 完全随机设计结构中双向处理结构的方差分析表 x 第二种基本设计结构是随机完全区组设计，图 5.2 中的图表显示了将处理从处理结构分配到设计结构中的实验单元的过程。假设研究人员每天可以制作和烘焙六个纸杯蛋糕，那么实验必须持续三天，才能实现每种处理组合的三次重复。设计结构的实验单元分为三个尺寸为六的区组。接下来，处理结构中的六个处理被随机分配到每个块内的六个实验单元，如图 5.2 中的箭头所示。正如第 4 章所讨论的，随机完全区组设计结构的误差平方和是通过设计结构与处理结构交互作用来计算的，或通过处理与区组的交互作用来计算的。该设计涉及六种处理和三个区组，因此处理与区组交互作用提供了 (3 - 1)(6 - 1) = 10 个与实验误差相关的自由度。这 10 个自由度合并了区组与温度、区组与配方和区组与温度与配方的交互作用相关的自由度。可用于描述随机完全区组设计结构中这种双向处理结构的纸杯蛋糕体积的模型是 \\[y_{ijk}=\\mu+\\tau_i+\\beta_j+(\\tau\\beta)_{ij}+d_k+\\varepsilon_{ijk},\\quad i=1,2,~j=1,2,3,~\\mathrm{and~}~k=1,2,3\\] 其中 \\(d_k\\) 表示第 \\(k\\) 天的效应，即区组因素，\\(\\varepsilon_{ijk}\\) 表示与批次、批次内纸杯蛋糕相关的变异性，以及同一天内不同烤箱烘焙的变异性。表 5.2 包含随机完全区组设计结构中双向处理结构模型的方差分析表，其中有 10 个自由度是根据区组与处理组合的交互作用测量的相同处理的实验单元的变异性计算得出的。该分析具有与完全随机设计结构相同的与处理结构相关的 5 个自由度，但现在，设计结构的 12 个自由度分布在天（区组）和误差之间。表 5.2 中的 \\(\\sigma^2_{day}\\) 项表示 \\(d_k\\) 的方差，\\(k = 1, 2, 3\\). 在本章的其余部分中可以做出类似的解释。 图 5.2: 随机完全区组设计结构中双向处理结构的随机化方案 表 5.2: 随机完全区组设计结构中双向处理结构的方差分析表 x 第三种基本设计结构是裂区设计结构。这里 18 个纸杯蛋糕被分成六个尺寸为三的区组，如图 5.3 所示。由于处理结构中有六种处理组合，所有六种处理不能发生在一个区组内，因此这是一个不完全区组设计结构。三个纸杯蛋糕，每个配方各一个，将在同一烤箱中在指定温度下烘焙（前两个基本设计结构仅在一个烤箱中烘焙一个纸杯蛋糕）。图 5.3 中的图表显示处理结构分为两部分，一部分指定为纸杯蛋糕部分，另一部分指定为烤箱部分。分配给每个烤箱的尺寸为三的区组或三个纸杯蛋糕构成温度水平的实验单元。随机化程序的第一部分是将每个温度随机分配给三个烤箱或区组，如图 5.3 中从温度水平到烤箱的箭头所示。烤箱内的纸杯蛋糕是配方水平的实验单元，随机化程序是将配方水平随机分配给每个烤箱内的一个纸杯蛋糕。实验单元有两种尺寸，有两种设计和处理结构。烤箱实验单元的处理和设计结构由单向处理结构（两个温度水平）和完全随机设计结构（六个烤箱）组成。对于单个纸杯蛋糕，处理和设计结构由随机完全区组设计结构中的单向处理结构（配方的三个水平）组成，其中烤箱代表类似实验单元的区组。因此烤箱是温度的实验单元。 图 5.3: 采用完全随机整区设计结构的裂区随机化方案 这种设计结构是嵌套或分层结构，因为纸杯蛋糕嵌套在烤箱内。因此，裂区设计也是一种分层设计结构。由于实验单元有两种尺寸，因此称为多水平设计。烤箱是较大尺寸的实验单元，通常被称为整区 (whole-plot) 。纸杯蛋糕是较小尺寸的实验单元，通常称为子区 (subplot) 或裂区。 分析这种裂区设计的第一步是忽略单个纸杯蛋糕或配方，只考虑两个温度和六个烤箱。图 5.4 的显示表明，与实验单元烤箱尺寸对应的设计是完全随机设计结构中的单向处理结构。描述在每个烤箱上测量的响应的模型是 \\[y_{ik}^*=\\mu+\\tau_i+e_{ik},\\quad i=1,2,\\mathrm{~and~}k=1,2,3\\] 其中 \\(y_{ik}^*\\) 表示在分配给第 \\(i\\) 个温度的第 \\(k\\) 个烤箱上测量的响应，\\(\\varepsilon_{ik}\\) 表示与烤箱相关的误差项。表 5.3 包含烤箱模型的方差分析表。对于每种温度水平，都有三个相同处理的烤箱，因此每个温度都有两个自由度，可以测量烤箱在相同处理时的变异。如果烤箱在两个温度之间的方差相等，则可以将这两个方差合并，以提供具有四个自由度的烤箱的误差项。 图 5.4: 用于裂区设计的烤箱设计和处理结构 表 5.3: 以烤箱为实验单元忽略配方水平的完全随机设计结构中单向处理结构的方差分析表 x 分析的下一步是忽略温度水平，从而提供一种设计，该设计是随机完全区组设计结构（六个区组）中的单向处理结构（三个配方）。随机化过程如图 5.5 所示。可以用来描述纸杯蛋糕体积的模型是 \\[y_{ijk}=\\mu+\\beta_j+o_{ik}+\\varepsilon_{ijk}^*,\\quad i=1,2,\\quad j=1,2,3,\\mathrm{~and~}\\quad k=1,2,3\\] 其中 \\(o_{ik}\\) 表示区组效应或烤箱效应，\\(\\varepsilon_{ijk}^*\\) 表示与纸杯蛋糕相关的误差。方差分析表在表 5.4 中，其中残差平方和由配方与烤箱交互作用组成。如果所有烤箱都进行同样的处理，则残差平方和将提供纸杯蛋糕与纸杯蛋糕之间变异性的估计。然而，一些烤箱经受一种温度而另一些烤箱经受另一种温度；因此，配方与烤箱交互作用包括温度与配方交互作用。表 5.4 中的预期均方并不完全由该模型确定，这由表中的“?”表示。为了获得纸杯蛋糕之间的变异性，需要在设计上进行一次额外的缩减 (reduction). 只考虑那些温度为 1 的烤箱，如图 5.6 中的黑线所示。缩减设计是指随机完全区组设计结构中的单向处理结构，其中三个区组中的处理相同（温度 1），方差分析表如表 5.5 所示。配方与烤箱交互作用提供了烤箱中经相同处理的纸杯蛋糕变异的测量。该过程继续考虑第二温度下的其他三个烤箱，其中配方与烤箱交互作用提供了额外的四个自由度，用于测量纸杯蛋糕在烤箱内经相同处理时的变异。当两个温度下蛋糕的方差相等时（参见第 2 章的检验），可以将两个来源合并在一起，提供八个自由度的误差平方和以测量蛋糕的变异情况。纸杯蛋糕的误差平方和是通过计算每个温度下烤箱与配方的交互作用，并将这些交互作用在不同温度下进行合并来计算的 (computing the oven by recipe interaction within a temperature pooled across temperatures). 表 5.6 给出了最终完整的裂区方差分析表，其中配方与温度交互作用从纸杯蛋糕残差中分离出来。描述在裂区设计结构中具有完全随机设计整区设计结构的双向处理结构数据的模型是 \\[y_{ijk}=\\mu+\\tau_i+\\beta_j+(\\tau\\beta)_{ij}+o_{ik}+\\varepsilon_{ijk},\\quad i=1,2,~j=1,2,3,\\mathrm{~and~}~k=1,2,3\\] 其中 \\(o_{ik}\\) 表示温度范围内的烤箱变异，\\(\\varepsilon_{ijk}\\) 表示烤箱内纸杯蛋糕的变异。表 5.6 中仍有 5 个与处理结构相关的自由度，但与设计结构相关的 12 个自由度分布在两个误差项之间，其中有 4 个与烤箱误差分量相关的自由度和 8 个与纸杯蛋糕误差分量相关的自由度。 图 5.5: 纸杯蛋糕实验单元的随机完全区组设计结构 表 5.4: 忽略温度水平的随机完全区组设计结构中单向处理结构的方差分析表 x 图 5.6: 仅为温度1烤箱运行的部分设计结构 表 5.5: 随机完全区组设计结构中单向处理结构温度1数据的方差分析表 x 表 5.6: 完全随机整区设计结构裂区设计中双向处理结构的方差分析表 x 作为裂区设计结构的变体，假设研究人员一天内只能运行两次烤箱；因此，这些烤箱被分为三组，每组两个，研究需要三天时间才能完成。图 5.7 中的图表描述了每天向烤箱随机分配温度水平，然后随机分配每个烤箱内的配方水平。烤箱设计结构是随机完全区组设计，因此烤箱误差项通过天与温度交互作用来计算。在烤箱或整区上施加区组结构不会改变纸杯蛋糕或子区的设计结构。仍有六个尺寸为三的区组，所以分析中的纸杯蛋糕部分没有改变。描述在裂区设计结构中具有完全随机区组整区设计结构的双向处理结构纸杯蛋糕体积的模型为 \\[y_{iik}=\\mu+\\tau_i+\\beta_j+(\\tau\\beta)_{ij}+d_k+o_{ik}+\\varepsilon_{iik},\\quad i=1,2,~j=1,2,3,~\\mathrm{and~}~k=1,2,3\\] 其中 \\(d_k\\) 表示天的效应，\\(o_{ik}\\) 表示一天内的烤箱变异，\\(\\varepsilon_{ijk}\\) 表示一天内烤箱内纸杯蛋糕的变异。表 5.7 给出了与上述模型相对应的方差分析表，其中包括天、error (oven) 和 error (cupcake) 的行。 图 5.7: 具有随机完全区组全区（烤箱）设计结构的裂区设计结构图 表 5.7: 随机完全区组整区设计结构裂区设计中双向处理结构的方差分析表 x 如上所述，裂区设计结构是不完全区组设计。图 5.8 显示了每天内将处理组合分配给烤箱或区组的情况。每个区组内只能出现三种处理组合，并且事实上，在一个区组内只能出现具有相同温度水平的那些处理组合。最终的设计是部分均衡不完全区组 (partially balanced incomplete block)，其中一些处理组合总是在一个区组内一起出现，而一些处理组合永远不会在一个区组内一起出现。 图 5.8: 裂区设计结构表示为不完全区组设计结构 第四种基本设计结构是条区。 条区设计结构的构建方法是首先将实验单元排列成具有行和列的矩形，如图 5.9 所示。在此实验中，使用其中一种配方混合一批蛋糕面团，并从该批次中提取两个纸杯蛋糕。由于这批面团是由一个配方制成的，因此批次是配方水平的实验单元。其中一个纸杯蛋糕将在温度 1 下烘焙，另一个纸杯蛋糕将在温度 2 下烘焙。因此，每个烤箱将包含三个纸杯蛋糕，每个配方各有一个。烤箱是分配温度水平的实体，并且是温度水平的实验单元。 图 5.9: 纸杯蛋糕实验条区设计结构图 图 5.9 中矩形的列对应于蛋糕面团的批次，三种配方被随机分配到列中；也就是说，一列中的两个纸杯蛋糕都来自同一批次，该批次是配方水平的实验单元。行由三个纸杯蛋糕组成，与烤箱相对应，烤箱是温度水平的实验单元。该设计的分析可以通过考虑每种尺寸的实验单元的设计和处理结构来构建。首先，忽略配方，只考虑矩形的行，那么烤箱设计是随机完全区组设计结构中的单向处理结构。如表 5.8 所示，与烤箱对应的误差项通过矩形（或天）与温度交互作用来计算，这为 error (oven) 提供了两个自由度。接下来，忽略温度，只考虑矩形的列，那么批次设计是随机完全区组设计结构中的单向处理结构。如表 5.9 所示，与批次对应的误差项通过矩形（或天）与配方交互作用来计算，为 error (batch) 提供了四个自由度。最后，配方与温度交互作用是通过排除行效应和列效应的对比来计算的 (contrasts that are free of the row effects and free of the column effects)，使纸杯蛋糕成为交互作用比较的实验单元。配方、温度和矩形之间的交互作用提供了纸杯蛋糕误差项，在这种情况下，它有四个自由度。该设计涉及三种尺寸的实验单元，可用于描述该结构数据的模型是 \\[y_{ijk}=\\mu+\\tau_i+\\beta_j+(\\tau\\beta)_{ij}+d_k+o_{ik}+b_{jk}+\\varepsilon_{ijk},\\quad i=1,2,\\quad j=1,2,3,\\mathrm{~and~}\\quad k=1,2,3\\] 其中 \\(d_k\\) 表示矩形或天的效应，\\(o_{ik}\\) 表示矩形内的烤箱效应，\\(b_{jk}\\) 表示矩形内的批次效应，\\(\\varepsilon_{ijk}\\) 表示批次、烤箱和矩形内的纸杯蛋糕效应。条区模型对应的方差分析表如表 5.10 所示，其中包含了三个误差项。处理结构仍然与五个自由度相关联，而与设计结构相关的12个自由度则分配为：两个用于矩形、两个用于 error (oven)、四个用于 error (batch) 以及四个用于 error (cupcake). 条区设计结构是一种多水平设计，但它不是分层设计结构，因为行不嵌套在列内，列也不嵌套在行内。行和列是嵌套在矩形（或天）内的，但嵌套结构在这里就停止了。 表 5.8: 条区设计结构中处理结构温度部分的方差分析表 x 表 5.9: 条区设计结构中处理结构配方部分的方差分析表 x 表 5.10: 条区设计结构双向处理结构方差分析表 x 正如第 20 章所讨论的，与效应相对应的预期均方将指示在评估与该效应相关的假设时使用哪个误差项。一些预期均方涉及带“*”上标的方差，以表明除下标所示之外，还有其他因素影响变异性。 在向方差分析表中写入误差项的过程中，只要设计涉及一个以上尺寸的实验单元，将与误差相关的实验单元的尺寸包括在括号中，这是本书其余部分中使用的惯例。这一惯例使研究人员能够轻松地识别研究的变异来源。 更复杂的设计结构在材料和时间方面往往更加节约。对于纸杯蛋糕烘焙实验，完全随机和随机完全区组设计结构需要制作 18 批纸杯蛋糕面团，并且需要使用 18 次烤箱进行 18 次烘焙。裂区设计结构涉及 18 批蛋糕面团（每个纸杯蛋糕一批），但只需要烘焙六次。因此，与完全随机设计相比，裂区设计只使用了三分之一的时间来烘焙纸杯蛋糕。条区需要九批蛋糕面团和六次烘焙。条区设计结构只使用了一半的蛋糕面团批次和三分之一的烘焙时间。如上所述，只要能够解决必要的误差项，使用更复杂的设计结构通常可以节省时间和资源，并且是进行实验的更方便的方式。 随着在设计上施加更多的结构，与最小实验单元尺寸对应的误差自由度会减少。然而，在前面的例子中，与完全随机设计相关的误差包括烤箱、批次和纸杯蛋糕引起的变异。裂区设计有两个误差项，其中一部分误差是由于烤箱之间的变异性，另一部分是由于纸杯蛋糕之间的变异性（也包括批次间的变异性）。条区设计有三个误差项，其中研究中的变异性分为烤箱间的变异性、批次间的变异性和批次内纸杯蛋糕间的变异性。使用更复杂的设计结构为纸杯蛋糕误差项提供了更少的自由度，但该误差项在条区设计结构中被细化为纸杯蛋糕与纸杯蛋糕之间的变异性，其中涉及在完全随机和随机完全区组设计中的烤箱和批次的变异性，以及裂区设计中的批次的变异性。因此，尽管自由度较少，但并不一定意味着处理因素之间比较的功效较小，因为重要方差分量的幅度也可能减小，从而增大功效。与更简单的设计结构的误差项相比，更复杂的设计具有更少变异性来源的误差项。表 5.11 总结了与纸杯蛋糕设计的每个误差项相关的变异性来源。 表 5.11: 与纸杯蛋糕示例相关的各种设计的每个误差项的变异性来源 x 以下各节提供了几个多水平设计的示例，每个多水平设计可以表示为上述四种基本设计结构中的一种或几种的组合。能够识别对应于四种基本设计结构之一的设计部分，为确定研究中每个实验单元尺寸的误差来源提供了一种方法。能够描述模型中的所有误差项是很重要的，因为在使用软件进行适当的分析时需要这些描述。当在模型的残差或最小实验单元水平上存在重复测量或不等方差时，需要残差平方和的表达式，以便软件对适当的方差和协变量进行建模。重复测量实验的建模将需要知道如何计算残差平方和。大多数作者通过减法计算残差平方和，但当需要对残差方差和协方差建模时，减法方法是不够的。 多水平设计有两个重要特点。首先，处理结构至少由一组双向处理组合组成。将多水平设计与第 4 章中的设计区分开来的第二个特征是，在一个实验中使用了多个尺寸的实验单元。在设计结构中，每个水平都有一种尺寸的实验单元。每种尺寸的实验单元都有自己的设计结构和处理结构，并且可以通过组合每种尺寸实验单元的模型来构建模型。由于存在不止一种尺寸的实验单元，因此在分析中使用了多个误差项；也就是说，实验中每种尺寸的实验单元都有一个误差项，这也反映在模型中。 本章提供了几个例子来演示使用第 5.2 节中讨论的四个基本设计结构所需的原则，以正确识别研究中使用的设计实验。一旦实验者能够使用这些原则来识别本章中讨论的设计实验，她就能够使用它们来识别其他设计的特征。 多水平设计可以用许多不同的方式进行结构化。接下来的一系列例子用于演示识别不同尺寸实验单元的过程，然后将这些信息用于构建一个适当的模型，作为分析的基础。每个例子都包括一个方差分析表，其中列出了变异来源、自由度和预期均方（关于计算预期均方的讨论，请参见第 18。设计结构与四个基本设计结构相关，从而可以确定误差项的形式。在对数据进行计算机分析之前，列出适当的变异来源和相应的自由度进行分析是很重要的，因为这可以很好地检查是否使用了适当的模型指定来描述数据。 5.2 分层设计：一种多水平的设计结构 社会科学中经常使用分层设计，其中个体的组形成较大尺寸的实验单元，而组内的个体是较小尺寸的实验单元。例如，一项评估五年级学生数学教学方法的研究涉及从学校系统中选择五年级学生的六个班级，并随机将两种方法中的每一种分配给其中三个班级。班级是教学方法的实验单元。确定教学方法是否对男女学生产生不同的影响是很有意义的。学生是学生性别的实验单元。个体嵌套于班级中的学生性别中，班级又嵌套于教学方法中。这项研究涉及嵌套设计结构和双向处理结构，其中有两种教学方法和两种性别的学生。可以使用以下模型来描述学生在接受其中一种教学方法后在数学测试中的得分 \\[y_{ijkm}=\\mu+\\tau_i+c_{ij}+\\beta_k+(\\tau\\beta)_{jk}+\\varepsilon_{ijkm},\\quad i=1,2,j=1,2,3,k=1,2,m=1,2,\\ldots,n_{ijk}\\] 其中 \\(y_{ijkm}\\) 为第 \\(i\\) 个方法授课的第 \\(j\\) 个班级第 \\(k\\) 个性别的第 \\(m\\) 个学生的成绩，\\(\\mu\\) 表示平均分，\\(\\tau_i\\) 表示教学方法效应，\\(c_{ij}\\) 表示第 \\(i\\) 个方法授课的第 \\(j\\) 个班级的效应， \\(\\beta_k\\) 表示第 \\(k\\) 个性别效应，\\((\\tau\\beta)_{jk}\\) 表示教学方法与性别交互作用，\\(\\varepsilon_{ijkm}\\) 表示采用某种教学方法的班级内某个性别的学生效应。上述模型的方差分析表如表 5.12 所示，其中班级和学生被假定为随机效应（见第 18 章）。系数 \\(k_1\\) 和 \\(k_2\\) 取决于每个班级内每个性别的学生人数（有关预期均方的评估，请参阅第 18 章）。该模型有两个误差项，一项针对班级，一项针对学生，这与裂区设计结构中的结构类似。因此，分层设计与裂区基本设计结构相同。 表 5.12: 分层或裂区设计结构的教学方法研究方差分析表 x 5.3 裂区设计结构：两水平设计结构 裂区设计主要用于农业、工业和生物研究，但也可以有效地用于大多数其他研究领域。裂区设计结构是具有两个或多个水平的多水平设计。裂区设计涉及两种或多种处理结构，具有不完全区组设计结构和至少两种不同尺寸的实验单元。裂区设计与重复测量设计的区别在于，处理结构中每个因素的水平可以随机应用于各种尺寸的实验单元。相反，重复测量设计涉及这样一个步骤：处理结构中至少一个因素（通常是时间）的水平不能随机分配给各个实验单元。以下示例演示了裂区设计的用途，并为识别适当的设计提供指南。 5.3.1 示例 5.1：烹饪大豆——最简单的裂区或两水平设计结构 一位实验者想要研究五种大豆对三种烹饪方法的响应。感兴趣的因变量是大豆煮熟后的嫩度和风味。实验者有一个由 15 个同质行 (rows) 组成的区域。他将五种单向处理结构中的每一种随机分配到三行，从而在完全随机设计结构中生成单向处理结构。品种被分配到行中，如图 5.10 所示；因此，行是与品种相关的实验单元。在收获时节，每行的大豆都会被放入一个盒子 (box) 中。对一行大豆（或一个盒子）进行的某些测量，行实验单元的模型是 \\[y_{ij}=\\mu_i+r_{ij},\\quad i=1,2,3,4,5,\\quad j=1,2,3\\] 其中 \\(\\mu_i\\) 表示第 \\(i\\) 个品种的平均值，\\(r_{ij}\\) 表示与分配给第 \\(j\\) 行的第 \\(i\\) 个品种相关的误差。表 5.13 给出了用于比较品种平均响应的行模型的分析或方差表。每个品种分配了三行，因此，品种内相同处理的行之间的变异性为 error (row) 提供了两个自由度。如果五个品种内的行方差相等，则将方差合并在一起以提供与 error (row) 相关的 10 个自由度。行设计是完全随机设计结构。 图 5.10: 用于将品种分配到烹饪豆实验的行的随机化方案 表 5.13: 行分析的方差分析表，以比较烹饪大豆例子中的品种 x 接下来，实验者想要检查烹饪方法。有几种可能的方法来进行这部分实验，这里讨论了两种。首先，实验者可以为种植了给定品种的三行中的每一行分配不同的烹饪方法，如图 5.11 所示。图 5.11 中的安排产生了一个完全随机设计结构中的双向处理结构，其中行是实验单元。然而，每个品种与烹饪方法的组合只有一次重复或行。因此，没有相同处理的行，这意味着并没有实验误差或行方差的度量。方差分析表的结果如表 5.14 所示。 图 5.11: 将烹饪方法分配到每个品种内的行的随机化方案，以烹饪大豆为例 表 5.14: 行分析的方差分析表，以烹饪大豆为例 x 具有零误差自由度的设计不是很理想 [尽管一些分析可以使用 Milliken &amp; Johnson, 1989; Millikan &amp; Graybill,1970; Johnson &amp; Grayboll, 1972 中讨论的双向非重复实验技术 (two-way non-replicated experiment techniques) 进行]。另一种分配烹饪方法的方式避免了零自由度问题，但确实使实验设计和分析更加复杂。 另一种方法是将每盒大豆（每行一盒）分成三批，然后将每种烹饪方法随机分配给一行中三批中的一批。由于烹饪方法被分配给一个批次 (batch)，因此烹饪方法的实验单元是一个批次。因此，该实验有两种尺寸的实验单元；行（大尺寸）是品种的实验单元，批（小尺寸）是烹饪处理的实验单元。这种分配如图 5.12 所示。 图 5.12: 将烹饪方法分配给批次的随机化过程的图表（仅显示第1行和第15行的线） 批次实验单元的处理和设计结构是随机完全区组设计结构中的单向处理结构，其中行（或盒子）是区组。表 5.15 给出了此设计批次部分的方差分析表。 表 5.15: 用于烹饪大豆示例的批次分析（忽略品种）的方差分析表 x 行的平方和包括品种的平方和加上表 5.13 中 error (row) 的平方和。如果所有行都经相同处理，则烹饪方法与行的交互作用将提供批次误差项，但一些行种植了品种 1，另一些行种植了品种 2，依此类推。因此，烹饪方法与行的交互作用包括了烹饪方法与品种的交互作用。所以，只考虑种植了品种 1 的那些行。品种 1 中的烹饪方法与行的交互作用提供了 (3-1)*(3-1)=4 个自由度，用于测量在同一行中经相同处理的批次的变异。批次误差平方和是通过在五个品种中合并烹饪方法与品种交互作用平方和而获得的 (obtained by pooling the row by cooking method interaction sum of squares within a variety across the five varieties)，从而为 error (batch) 提供 20 个自由度。描述烹饪大豆示例数据的模型如下 \\[y_{ijk}=\\mu_{ik}+r_{ij}+\\varepsilon_{ijk},\\quad i=1,2,3,4,5,j=1,2,3,k=1,2,3\\] 其中，\\(\\mu_{ik}\\) 表示通过第 \\(k\\) 种方法烹饪的第 \\(i\\) 个品种的平均值，\\(r_{ij}\\) 是分配给第 \\(i\\) 个品种的第 \\(j\\) 行的随机效应，假设其分布为 \\(N(0,\\sigma^2_{\\mathrm{row}})\\)， \\(\\varepsilon_{ijk}\\) 表示用第 \\(k\\) 种方法烹饪的第 \\(i\\) 个品种的第 \\(j\\) 行的批次的随机效应，假设其分布为 \\(N(0,\\sigma^2_{\\mathrm{batch}})\\)，还假设 \\(r_{ij}\\) 和 \\(\\varepsilon_{ijk}\\) 是独立的随机变量。 在效应模型中，均值 \\(\\mu_{ik}\\) 可表示为 \\[\\mu_{ik}=\\mu+\\upsilon_i+\\omega_k+(\\upsilon\\omega)_{ik}\\] 其中 \\(\\mu\\) 表示总体平均值，\\(\\upsilon_i\\) 表示第 \\(i\\) 个品种的效应，\\(\\omega_k\\) 表示第 \\(k\\) 种烹饪方法的效应，\\((\\upsilon\\omega)_{ik}\\) 表示品种与烹饪方法的交互作用。 \\[\\begin{aligned}y_{ijk}=&amp;\\mu+\\upsilon_i+r_{ij}\\,&amp;&amp;\\text{\\}row part of model}\\\\&amp;+\\omega_k+(\\upsilon\\omega)_{ik}+\\varepsilon_{ijk}\\,&amp;&amp;\\text{\\}batch part of model}\\end{aligned}\\] 其中模型的行部分也是模型的批次部分的区组结构。裂区设计可以分两步进行分析，先进行行分析，然后进行批次分析。当数据集均衡时，在将单个模型拟合到数据或进行两步分析过程的情况下，将获得相同的结果。表 5.16 给出了烹饪大豆例子的方差分析表，它划分了每个实验单元尺寸、行尺寸和批次尺寸的分析。行分析也是分析的批次部分的区组结构，如箭头所示。 表 5.16: 烹饪大豆实验的方差分析表，显示了每个实验单元尺寸的分析 x 大豆实验的整区或行设计结构是完全随机设计结构；因此，这被称为最简单的裂区或两水平设计结构。通常的整区设计结构通常涉及随机完全区组设计结构，如下例所示。 5.3.2 示例 5.2：磨小麦——通常的裂区或两水平设计结构 谷物碾磨实验包括在将小麦粒碾磨或研磨成小麦粉后评估各种小麦品种 (variety) 的特性。实验包括将研磨辊之间的间隙[称为辊缝 (roll gap)]设置为一个值，然后研磨每种品种的一批（按随机顺序）。接下来，将辊缝更改为另一个值，并研磨新的批次。假设研究人员希望评估三个辊缝和五个品种。因此，五个品种的三个辊缝的双向处理结构的一次重复需要 15 次轧机的运行 (runs)。一个工作日 (day) 可以完成一次重复或 15 次运行，因此需要四天时间才能获得四次重复。环境条件如湿度可能会对研磨过程产生影响，并且这些条件可能每天都不同。因此，为了帮助控制这些条件，将天用作区组因素，其中在一天内获得 15 种处理组合的一次重复。随机化过程是将三个辊隙的顺序随机分配给每天运行的一个辊缝，然后在每个辊缝内，将品种的顺序随机指定给要研磨的批次。图 5.13 显示了随机化过程，其中一天对应于一个区组，一天内的一组五次运行是整区实验单元，单次运行是子区实验单元。未显示所有将品种分配给运行的箭头，因为完整的一组线会使展示混乱不堪。整区设计结构是一个随机完全区组，有四个尺寸为三的区组。整区模型可以表示为 \\[y_{ij}=\\mu+R_i+d_j+e_{ij},\\quad i=1,2,3,j=1,2,3,4,\\mathrm{~where~}d_j\\thicksim i.i.d.\\mathrm{~N}(0,\\sigma_{\\mathrm{day}}^2)\\mathrm{~and~}e_{ij}\\thicksim i.i.d.\\mathrm{~N}(0,\\sigma_{\\mathrm{run}}^2)\\] 其中 \\(R_i\\) 表示辊缝效应，\\(d_j\\) 表示随机天效应 (random day effect)，\\(e_{ij}\\) 表示随机辊缝运行效应或整区误差。整区方差分析表如表 5.17 所示，其中运行或整区误差是通过天与辊缝交互作用计算的；也就是说，随机完全区组设计结构的误差是处理结构与设计结构的交互作用。分析的下一步是确定批次误差的来源。这是通过仅考虑具有一个辊缝（例如 1.5mm）的品种来实现的。表 5.18 中显示了用于比较 1.5mm 辊缝下品种的方差分析表。误差项是通过天与品种（或一天内的运行，因为给定的某天只进行一次运行）的交互作用来计算的，这提供了 12 个自由度来测量在一次运行中相同处理的批次如何变异。这一过程是针对其他两个辊缝设置执行的，每个设置都为批次误差提供 12 个自由度。如果这三个方差相等，那么它们可以合并到具有 36 个自由度的批次误差项中。批次误差项可以表示为 variety × day (roll gap)，也可以表示为“跨辊缝水平的品种与天交互作用” (variety by day interaction pooled across the levels of roll gap). 图 5.13: 磨粉实验随机化过程的显示 表 5.17: 磨粉实验的整区分析 x 表 5.18: 磨粉实验中辊缝为1.5mm时品种比较的方差分析 x 包含运行部分和批次部分的模型可以表示为 \\[y_{ijk}=\\mu+R_i+d_j+e_{ij}+V_k+(RV)_{ik}+\\varepsilon_{ijk},\\quad i=1,2,3,\\quad j=1,2,3,4,\\quad k=1,2,\\ldots,5,\\] 其中 \\[d_j\\thicksim i.i.d.\\mathrm{~}N(0,\\sigma_{\\mathrm{day}}^2)\\text{, }e_{ij}\\thicksim i.i.d.\\mathrm{~}N(0,\\sigma_{\\mathrm{run}}^2)\\text{, and }\\varepsilon_{ijk}\\thicksim i.i.d.\\mathrm{~}N(0,\\sigma_{\\mathrm{batch}}^2)\\] 在上述模型中，\\(R_i\\) 表示第 \\(i\\) 个辊缝效应，\\(V_k\\) 表示第 \\(k\\) 个品种效应，\\((RV)_{ik}\\) 表示辊隙与品种交互作用，\\(\\varepsilon_{ijk}\\) 表示随机批次效应。\\(\\mu+R_i+d_j+e_{ij}\\) 是模型的整区或运行部分，也是模型的子区（或模型的批次部分）的区组结构。模型的批次部分是 \\(V_k+(RV)_{ik}+\\varepsilon_{ijk}\\). 包括运行分析和批次分析的最终方差分析表如表 5.19 所示。括号和箭头表示，模型的运行部分或整区部分是模型批次部分的区组结构。如前所述，通常的裂区设计是具有随机完全区组整区设计结构的裂区设计。 表 5.19: 磨粉实验的方差分析表，显示了每个实验单元尺寸的分析 x 5.3.3 示例 5.3：烘焙面包——具有不完全块设计结构的裂区 一位烘焙科学家设计了一项研究，以评估温度对由两种不同配方制成并在三种不同温度下烘焙的面包 (bread) 体积的影响。图 5.14 显示了本实验的随机化过程。一天 (day) 只有两个烤箱 (oven) 可用，而且当天只能使用一次。每个烤箱可以容纳每种配方下的一条面包，但在一天中只能观察到三种温度中的两种。研究人员希望对每个温度进行四次重复，这意味着该研究需要在不同的六天进行。表 5.20 包含六天的温度分配。图 5.14 显示了将温度随机分配到烤箱的情况，其中天是区组，烤箱是温度水平的实验单元。烤箱设计是一种不完全区组设计结构中的单向处理结构（温度的水平）。可以用来描述每个烤箱数据的模型是 \\[y_{ij}=\\mu+T_i+d_j+o_{ij},\\quad(i,j)\\in\\{(1,1),(2,1),(1,2),(3,2),(2,3),(3,3),(1,4),(3,4),(2,5),(3,5),(1,6),(2,6)\\}\\] 其中 \\[d_j\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{day}}^2)\\quad\\mathrm{and}\\quad o_{ij}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{oven}}^2)\\] 下标 \\((i,j)\\) 在上述指标集中取值，方差分析表见表 5.21. 预期均方是根据III型平方和计算的（见第 10 章）。烤箱误差项是根据设计结构与处理结构交互作用 （或天与温度的交互作用）来计算的。如果观察到表 5.20 中的所有单元格，则烤箱误差将有 (3-1)(6-1)=10 个自由度，但其中六个单元格为空，从而为烤箱误差提供 10-6=4 个自由度。面包设计是一种随机完全区组设计结构中的单向处理结构（配方的水平），其中烤箱是区组。并不是所有区组都是一样的，所以考虑那些温度相同的烤箱。温度为 160°C 的处理结构部分如表 5.22 所示。表 5.22 中的设计是具有四个区组或烤箱或天的随机完全区组设计结构中的单向处理结构（两个配方）。根据 160°C 的温度数据，面包误差项有三个自由度，对应于配方与天的交互作用。160°C 下面包分析的方差分析表如表 5.23 所示。可以为每个温度计算面包误差，如果方差相等，则将三个方差合并，为 error (bread) 提供九个自由度。可以用来表示所有数据的模型是 \\[\\begin{aligned} &amp;y_{ijk}=\\mu+T_i+d_j+o_{ij}+R_k+(TR)_{ik}+\\varepsilon_{ijk} \\\\ &amp;(i,j)\\in\\{(1,1),(2,1),(1,2),(3,2),(2,3),(3,3),(1,4),(3,4),(2,5),(3,5),(1,6),(2,6)\\},k=1,2 \\end{aligned}\\] 其中 \\[d_j\\thicksim N(0,\\sigma_\\mathrm{day}^2),\\quad o_{ij}\\thicksim i.i.d.\\mathrm{~N}(0,\\sigma_\\mathrm{oven}^2)\\quad\\mathrm{and}\\quad\\varepsilon_{ijk}\\thicksim i.i.d.\\mathrm{~N}(0,\\sigma_\\mathrm{loaf}^2)\\] 图 5.14: 一天内烤箱的温度分配和烤箱内面包的配方分配，使用不完全区组整区设计结构 表 5.20: 不完全区组整区设计结构中，将温度分配到天 x 注释: X 表示当天未观测温度 表 5.21: 不完全区组设计结构的烤箱分析（忽略配方）的方差分析表，预期均方(EMS)使用III型平方和计算 x 表 5.22: 160°C 烘焙的配方设计 x 表 5.23: 不完全区组设计结构的面包分析的方差分析表（忽略温度） x 该模型的最终方差分析表见表 5.24，其中预期均方是根据III型平方和计算的。由于不完全区组整区设计结构，因此使用了III型平方和。该模型的烤箱部分为 \\(\\mu+T_i+d_j+o_{ij}\\)，这也是该模型面包部分的区组结构。模型的面包部分是 \\(R_k+(TR)_{ik}+\\varepsilon_{ijk}\\). 这个例子表明，任何类型的设计结构都可以用于实验单元的每个水平或每种尺寸。 表 5.24: 采用不完全区组整区设计结构的面包烘焙研究的完整方差分析表，预期均方(EMS)根据III型平方和计算（见第 10 章） x 5.3.4 示例 5.4：展示柜中的肉——复杂裂区或四水平设计 一位肉类科学家想研究三个水平的温度（temperature, T）、两个水平的包装类型（packaging, P）、四个水平的光照类型（lightning, L）和四个水平的光照强度（intensity, I）对在肉类冷却器 (cooler) 中储存七天的肉的颜色的影响。实验有六个冷却器，三种温度（1、3和5°C）分别随机分配给两个冷却器，如图 5.15 所示。 每个冷却器在一个 4×4 的网格上分为 16 个分区 (partitions)（图 5.16）。光照强度通过它们在冷却器表面上方的距离来调节，因此，一列 (column) 中的所有分区都被分配相同的光照强度。四种类型的光照随机分配到每列内的四个分区。最后，将两种包装分配给牛排，并将两种包装放入每个分区中。图 5.16 显示了这种冷却器的安排方式。 图 5.15: 展示柜研究中肉类冷却器的温度分配 图 5.16: 在展示柜研究中，为每个冷却器中的肉分配列的光照强度、分区的光照类型和半分区的包装类型 在构建适当的分析之前，必须首先正确识别实验单元的不同尺寸或实验水平。温度水平的实验单元是冷却器。冷却器设计是一种完全随机设计结构中的单向处理结构（T 或温度水平）。如果对每个冷却器进行一次测量，则响应可以通过以下方式建模 \\[y_{ij}=\\mu+T_i+c_{ij},\\quad i=1,2,3,j=1,2,\\mathrm{~and~}c_{ij}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{cooler}}^2)\\] 表 5.25 给出了冷却器模型的方差分析表，其中冷却器误差项是根据两个冷却器在一个温度内的变异、跨三种温度计算得出的 (computed from the variation of the two coolers within a temperature, pooled across the three temperatures). 因此，error (cooler) 有三个自由度。 表 5.25: 冷却器实验单元部分的模型的方差分析表 x 光照强度水平的实验单元是冷却器中四个分区所在的列。列设计由单向处理结构（I 或强度水平）组成，采用随机完全区组设计结构，具有六个区组或冷却器。如果所有冷却器都经相同处理，那么列误差项将根据强度与冷却器交互作用来计算。但有三种不同的温度，因此将分析限制在分配给 1°C 的两个冷却器上。分配给 1°C 的两个冷却器如图 5.17 所示。这时，设计是一个单向处理结构（I 的四个水平）的随机完全区组设计结构（两个冷却器）。如果对这两个冷却器的每个列进行测量，则可用于描述响应的模型为 \\[y_{1jk}=\\mu+I_k+c_{1j}+d_{1jk},\\quad j=1,2,\\,k=1,2,3,4,\\,c_{1j}\\sim i.i.d. N(0,\\sigma_{\\mathrm{cooler}}^2)\\,\\mathrm{~and~}\\,d_{1jk}\\sim i.i.d.N(0,\\sigma_{\\mathrm{colum}n}^2)\\] 列模型的方差分析表如图 5.17 所示，其中列误差项是通过强度与冷却器交互作用来计算的，提供三个自由度。对于另外两个温度重复该过程，每个温度都提供具有三个自由度的列误差项。如果这三个方差相等，则可以将它们合并到具有九个自由度的 error (column) 中。error (column) 可以用 intensity × cooler (temperature) 表示，读作“跨温度水平的强度与冷却器交互作用” (intensity by cooler interaction pooled across the levels of temperature). 图 5.17: 展示柜研究中，比较温度 1 下的强度水平以开始列分析 光照类型水平的实验单元是列的分区。分区设计是一种单向处理结构（L 的水平），采用随机完全区组设计结构，有 24 个区组，由六个冷却器的四个列组成。如果所有列都经相同处理，则分区误差项将通过光照类型与列交互作用来计算。但所有列的处理方式并不相同，因为有三种温度和四种强度水平。将结构限制为仅涉及温度为 1°C 且强度为 I1 的那些列，如图 5.18 所示。与图 5.18 相关的设计是随机完全区组设计结构（两个列，但每个列来自不同的冷却器）中的单向处理结构（光照类型的四个水平）。如果对图 5.18 中的每个分区进行一次测量，则可用于描述响应的模型为 \\[\\begin{aligned}y_{1j1m}&amp;=\\mu+L_m+d_{1j1}^*+p_{1j1m},\\quad j=1,2,m=1,2,3,4,d_{1j1}^*\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{column}}^{2^*})\\mathrm{~and}\\\\p_{1j1m}&amp;\\sim i.i.d.N(0,\\sigma_{\\mathrm{partition}}^2)\\end{aligned}\\] 其中 \\(d_{1j1}^*\\) 表示冷却器和该冷却器效果的列的组合 (the combination of cooler and column of that cooler effect). 该分区模型的方差分析表如图 5.18 所示，其中分区误差项通过光照类型与冷却器交互作用来计算，提供三个自由度。这个过程需要对 12 种温度和强度的组合进行，每种组合为 error (partition) 提供三个自由度。如果这 12 个方差相等，则可以将它们合并为一个项，为 error (partition) 提供三个自由度提供 36 个自由度。error (partition) 项可以表示为 light × intensity × cooler (temperature). 图 5.18: 展示柜研究中，比较温度 1 和强度 1 下的光照水平以开始分区分析 最后，包装水平的实验单元是半分区 (half-partitions)（或牛排）。半分区设计是一种单向处理结构（包装的水平或 P），采用随机完全区组设计结构，具有 96 个分区，由六个冷却器的四个列中的四个分区组成。如果所有分区都经相同处理，那么半分区误差项将通过包装与分区交互作用来计算。但并不是所有的分区都经相同处理，因为它们被分配到三个温度水平、四个强度水平和四个光照水平。选择分配给温度为 1°C、强度为 I1 和光照为 L1 的分区，如图 5.19 所示。如果在图 5.19 中对每块牛排或半分区进行一次测量，则可用于描述响应的模型为 \\[\\begin{aligned}y_{1j11n}&amp;=\\mu+P_n+p_{1j1n}^*+\\varepsilon_{1j11n},\\quad j=1,2,n=1,2,p_{1j1m}^*\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{partition}}^{2*})\\quad\\mathrm{and}\\\\\\varepsilon_{1j11n}&amp;\\sim i.i.d.N(0,\\sigma_{\\frac12\\text{partition}} ^ 2 ) \\end{aligned}\\] 该半分区模型的方差分析表如图 5.19 所示，其中半分区误差项通过包装与冷却器交互作用来计算，提供一个自由度。这个过程需要对 48 种温度、强度和光照的组合进行。这 48 个平方和合并在一起为 error (half-partition) 提供 48 个自由度。error (half-partition) 项可以表示为 packaging × light × intensity × cooler (temperature). 图 5.19: 展示柜研究中，比较温度 1、强度 1 和光照 1 下的包装水平以开始半分区分析 上述讨论提供了研究中的四个水平的模型：冷却器模型、列模型、分区模型和半分区模型。这些模型可以组合成一个模型，其中因素之间的交互作用被加在一起。由于基本设计结构是每个水平的裂区，因此每个水平的处理结构以及与其上一水平处理结构的交互作用都包含在模型的该水平部分中。可以用来描述数据的模型是 \\[\\begin{aligned} \\mathcal{Y}_{ijkmn}=&amp; \\mu+T_i+\\mathcal{C}_{ij} &amp;&amp;\\{\\text{cooler part of the model}\\\\ &amp;+I_k+(TI)_{ik}+d_{ijk} &amp;&amp;\\{\\text{column part of the model}\\\\ &amp;+L_m+(TL)_{im}+(IL)_{km}+(TIL)_{ikm}+p_{ijkm} &amp;&amp;\\{\\text{partition part of the model}\\\\ &amp;+P_n+(TP)_{in}+(IP)_{kn}+(TIP)_{ikn}+(LP)_{mn}+(TLP)_{imn}+(ILP)_{km}+(TILP)_{ikmn}+\\varepsilon_{ijkmn} &amp;&amp;\\{\\text{half-partition part of the model}\\\\ &amp;i=1,2,3,\\quad j=1,2,\\quad k=1,2,3,4,\\quad m=1,2,3,4,\\quad n=1,2,\\\\ &amp;c_{ij}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{cooler}}^2),\\quad d_{ijk}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{column}}^2),\\quad p_{ijkn}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{partition}}^2),\\quad \\boldsymbol{\\varepsilon}_{ijkmn}\\thicksim i.i.d.N(0,\\sigma_{\\frac12\\text{partition}} ^ 2 ) \\end{aligned}\\] 表 5.26 给出了上述模型的方差分析表，其中较大的实验单元分析也是下一个较小实验单元的区组结构。这是一个裂-裂-裂区 (split-split-split-plot) 实验模型，由四个水平（或实验单元尺寸）组成，涉及四个误差项，每个水平（或每种实验单元尺寸）对应一个。这也是一种分层设计结构，其中半分区嵌套在分区内，分区嵌套在列内，列嵌套在冷却器内。 表 5.26: 展示柜研究中复杂裂区设计完整的方差分析表 x 注释: 括号和箭头指示哪些效应形成下一个较小尺寸的实验单元的区组 5.4 条区设计结构：一种无层次的多水平设计 构造条区设计结构的过程是将实验单元排列成矩形。一组因素的水平随机分配给每个矩形的行，另一组因素的水平随机分配给每个矩形的列。因此，行是与第一组因素相关的实验单元，列是与第二组因素相关的实验单元。但因此，一行和一列的单元格或交叉点是与两组因素之间的交互作用比较相关的实验单元。通过一个例子来演示条区设计结构的一些用途。 5.4.1 示例 5.5：制作奶酪 一位乳制品科学家设计了一项奶酪制造研究，涉及两种脂肪水平、三种奶酪类型、两种储存温度和两种储存湿度。该实验是一个分两步进行的过程，第一步是用两种脂肪水平为每种类型的奶酪制作一批 (batch) 奶酪。每批奶酪要制成四包一磅重的奶酪块 (cheese block). 第二步是将奶酪储存在一系列环境条件下，用四周的时间使其固化。该研究的储存部分包括将每批奶酪中的一包放入一个指定储存温度和湿度的室 (chamber) 中。这个过程相当于将 24 包奶酪排列成四行六列的矩形。该列对应一批奶酪，该行对应一个环境室，如图 5.20 所示。这位奶制品科学家有四个实验室可用于研究，但他希望有四次重复。因此，通过在四个不同的月份进行实验获得了四次重复。可以通过评估每种尺寸的实验单元的处理和设计结构来构建模型并分析。室设计如图 5.21 所示，其中仅显示了四个月中每个月的温度和湿度水平。室设计是一种双向处理结构（温度水平与湿度水平），采用随机完全区组设计结构，每个月为一个区组。可用于描述在每个室中进行的测量的模型为 \\[\\begin{aligned}y_{ijk}=&amp;\\mu+T_j+H_k+(TH)_{jk}+m_i+c_{ijk},\\quad i=1,2,3,4,j=1,2,k=1,2\\\\&amp;m_i\\sim i.i.d.N(0,\\sigma_{\\mathrm{month}}^2),\\text{ and }c_{ijk}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{chamber}}^2)\\end{aligned}\\] 表 5.27 包含室模型的方差分析表，其中室误差项是处理结构与设计结构的交互作用。在处理结构中有四种处理组合，在设计结构中有四个区组；因此，室误差项基于九个自由度。error (chamber) 项是温度与月交互作用、湿度与月交互作用和温度与湿度与月交互作用项的总和。如果在 SAS-Mixed 程序中使用三向交互项，则三个交互项将合并为一个误差项。室的方差分量用星号表示，因为它也包括由于奶酪块引起的变异。月份的方差分量用星号表示，因为它还包括由于批次和奶酪区组引起的变异。 图 5.20: 采用条区设计结构的奶酪制作实验的随机化方案 图 5.21: 奶酪制作实验中室设计的随机化方案 表 5.27: 奶酪制作实验中室实验单元设计的方差分析 x 批次设计如图 5.22 所示，其中仅考虑了奶酪类型和脂肪百分比。批次设计是一种双向处理结构（奶酪类型水平与脂肪水平），采用随机完全区组设计结构，其中每个月为一个区组。可用于描述对每个批次进行测量的模型为 \\[\\begin{aligned}y_{imn}=&amp;\\mu+F_m+C_n+(FC)_{mn}+m_i+b_{imn},\\quad i=1,2,3,4,m=1,2,n=1,2,3,\\\\&amp;m_i\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{month}}^2)\\mathrm{~and~}b_{imn}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{batch}}^2)\\end{aligned}\\] 表 5.28 包含室模型的方差分析表，其中室误差项是处理结构与设计结构的交互作用。处理结构中有六种处理组合，设计结构中有四个区组，因此批次误差项基于 15 个自由度。error (batch) 项是月份与脂肪、月份与奶酪类型以及脂肪与奶酪类型与月份交互作用项的总和。如果在 SAS-Mixed 程序中使用三向交互项，则三个交互项将合并为一个误差项。批次的方差分量用星号表示，因为它还包括由于奶酪块引起的变异。 图 5.22: 奶酪制作实验的批设计的随机化方案。为了简化绘图，有些线没有包括在内 表 5.28: 奶酪制作实验中批次实验单元设计的方差分析 x 1 磅奶酪块是分配给室的因素和分配给批次的因素之间交互作用的实验单元。模型的奶酪块部分是 \\[\\begin{aligned}&amp;(TF)_{jm}+(TC)_{jn}+(TFC)_{jmn}+(HF)_{kn}+(HC)_{kn}+(HFC)_{kmn}+(THFC)_{jkmn}+\\varepsilon_{ijkmn}\\\\&amp;\\varepsilon_{ijkmn}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{block}}^2)\\end{aligned}\\] 该条区设计的模型是通过将三个实验单元的模型合并为一个模型而获得的： \\[\\begin{aligned}y_{ijk}&amp;=\\mu+m_i&amp;&amp;\\{\\text{blocking part of the model}\\\\&amp;+T_j+H_k+(TH)_{jk}+c_{ijk}&amp;&amp;\\{\\text{chamber part of the model}\\\\&amp;+F_m+C_n+(FC)_{mn}+b_{imn}&amp;&amp;\\{\\text{batch part of the model}\\\\&amp;+(TF)_{jm}+(TC)_{jn}+(TFC)_{jmn}+(HF)_{km}+(HC)_{kn}+(HFC)_{kmn}+(THFC)_{jkmn}+\\varepsilon_{ijkmn}&amp;&amp;\\{\\text{cheese block part of the model}\\\\ &amp;i=1,2,3,4,\\quad j=1,2,\\quad k=1,2,\\quad m=1,2,\\quad n=1,2,3 \\\\ &amp;m_i\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{month}}^2),\\quad c_{ijk}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{chamber}}^2),\\quad b_{imn}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{batch}}^2), \\\\ &amp;\\mathrm{and~}\\varepsilon_{ijkmn}\\sim i.i.d.N(0,\\sigma_{\\mathrm{block}}^2)\\end{aligned}\\] 表 5.29 给出了奶酪实验的方差分析表，其中各行按实验单元的尺寸进行分离。奶酪块误差项通过室处理结构与批次处理结构与设计结构的交互作用来计算，提供 (4 - 1)(6 - 1)(4 - 1) = 45 个自由度。该设计涉及三种尺寸的实验单元：室尺寸、批次尺寸和奶酪块尺寸。奶酪块嵌套在批次内，奶酪块嵌套在室内，但批次不嵌套在室内，室也不嵌套在批次内。因此，这种多层设计结构不是分层设计结构。 表 5.29: 奶酪制作实验完整的方差分析表 x 这个例子说明了与给定尺寸的实验单元相关的设计结构可以涉及任何所需的处理结构。室和批次实验单元的处理结构都是双向析因安排。 我们可以采用这样的双向析因安排：将一个对照作为其中一个实验单元的处理结构。这种先确定实验单元，然后指定每个实验单元的设计和处理结构的过程，为复杂实验提供了确定适当的设计和相应模型的一般方法。 5.5 重复测量设计 重复测量设计在许多研究领域中得到了有效的应用。这些设计包括至少两个因素的处理结构，不完全区组设计结构和至少两种实验单元尺寸。重复测量设计与裂区设计具有相同的设计结构类型，但重复测量设计与裂区类型设计的不同之处在于，一个或多个因素的水平不能随机分配给相应的实验单元。通常，时间是这样一个因素：其水平不能随机分配给个体的时间间隔。涉及时间的重复测量设计是用于纵向研究的设计。因此，重复测量设计涉及一个或多个步骤，其中不可能将某些因素的水平随机分配给其实验单元，而裂区型设计则可以在每一步使用随机化。下面的例子演示了重复测量设计的一些结构，并为正确识别设计实验提供了指导。 5.5.1 示例 5.6：马足——基本重复测量设计 这个特殊的实验引出了使用两种不同尺寸的实验单元的重复测量设计的想法。然而，如果实验者不小心，他或她可能会无意中错过有两种不同尺寸的实验单元的事实，从而导致错误的分析。 兽医有两种技术可用于融合马足 (horse feet) 骨折后的关节，她希望确定哪种技术更好。 这个实验包括取一些马，在每匹马身上折断一个关节，用两种技术中的一种进行修复，四个月后确定融合关节的强度。 她还想确定同样的技术对前足和后足是否同样有效。 由于马匹稀缺且价格昂贵，她计划在每匹马的前足上折断关节，等待其愈合，然后再在后足上折断关节，或者反过来，先折断后足后折断前足。这个愈合过程也在设计中引入了时间因素。因此，处理结构是由两种融合技术（F）、两个位置（P）和两个愈合时间（T）产生的 23 析因安排。设计结构是一个不完全区组设计，每匹马都是一个区组，每个区块（马）有两个观测值。由于区组不完全，一些处理结构信息将与区组（或马）效应混淆 (Cochran and Cox, 1957). 有多种方法可以将处理组合分配给马的双足。假设有四匹马。一个过程是为每匹马指定一种融合技术，其中前足和后足都接受相同水平的融合处理，如表 5.30 所示。 表 5.30: 马足实验处理组合的首次分配 x 注释: 两种融合技术为 \\(F_1\\) 和 \\(F_2\\)，两个时间为 \\(T_1\\) 和 \\(T_2\\)，两个位置为 \\(P_1\\) 和 \\(P_2\\) 设 \\(y_{ijkm}\\) 表示通过第 \\(i\\) 种融合技术、第 \\(j\\) 个位置、第 \\(k\\) 个时间和第 \\(m\\) 匹马获得的观测值。用于描述数据的模型是 \\[y_{ijkm}=\\mu_{ijk}+h_m+\\varepsilon_{ijkm},\\quad i=1,2,\\quad j=1,2,k=1,2,m=1,2,\\ldots,4\\] 其中 \\(\\mu_{ijk}\\) 表示第 \\(i\\) 种融合技术、第 \\(j\\) 个位置、第 \\(k\\) 个时间的平均响应，\\(h_m\\) 表示第 \\(m\\) 匹马的效应，\\(\\varepsilon_{ijkm}\\) 表示在马足上进行的测量的响应误差。在处理组合均值 \\(\\mu_{ijk}\\) 中可以进行两种类型的比较。一种类型的比较是马内 (intra-horse or within-horse) 比较，而另一种类型的比较是马间 (inter-horse or between-horse) 比较。析因效应可以定义为 \\[\\begin{aligned} \\text{Mean}&amp; =\\bar{\\mu}_{\\cdot\\cdot\\cdot} \\\\ F&amp; =\\bar{\\mu}_{1\\cdot\\cdot}-\\bar{\\mu}_{2\\cdot\\cdot},P=\\bar{\\mu}_{\\cdot1\\cdot}-\\bar{\\mu}_{\\cdot2\\cdot},T=\\bar{\\mu}_{\\cdot\\cdot1}-\\bar{\\mu}_{\\cdot\\cdot2} \\\\ F\\times P&amp; \\begin{aligned}&amp;=\\bar{\\mu}_{11\\cdot}-\\bar{\\mu}_{12\\cdot}-\\bar{\\mu}_{21\\cdot}+\\bar{\\mu}_{22\\cdot}\\end{aligned} \\\\ F\\times T&amp; =\\bar{\\mu}_{1\\cdot1}-\\bar{\\mu}_{1\\cdot2}-\\bar{\\mu}_{2\\cdot1}+\\bar{\\mu}_{2\\cdot2} \\\\ P\\times T&amp; =\\bar{\\mu}_{\\cdot11}-\\bar{\\mu}_{\\cdot12}-\\bar{\\mu}_{\\cdot21}+\\bar{\\mu}_{\\cdot22} \\\\ F\\times P\\times T&amp; =\\mu_{111}-\\mu_{112}-\\mu_{121}+\\mu_{122}-\\mu_{211}+\\mu_{212}+\\mu_{221}-\\mu_{222} \\end{aligned}\\] \\(\\mu_{ijk}\\) 的最佳估计为 \\(\\bar y_{ijk\\cdot}\\). 主效应 \\(P\\) 的最佳估计可以表示为 \\[\\begin{aligned}\\hat{P}&amp;=\\bar{y}_{\\cdot1\\cdot\\cdot}-\\bar{y}_{\\cdot2\\cdot\\cdot}\\\\&amp;=\\frac{1}{4}[({y}_{1111}-{y}_{1221})+({y}_{1122}-{y}_{1212})+({y}_{2113}-{y}_{2223})+({y}_{2124}-{y}_{2214})]\\end{aligned}\\] 这是马内比较。将上述模型的右侧替换为 \\(P\\) 中的 \\({y}_{ijkm}\\)，可以很容易地证明马内比较的合理性，这给出 \\[\\begin{aligned}\\hat{P}&amp;=\\frac14[(\\mu_{111}+h_1+\\varepsilon_{1111}-\\mu_{122}-h_1-\\varepsilon_{1221})+(\\mu_{112}+h_2+\\varepsilon_{1122}-\\mu_{121}-h_2-\\varepsilon_{1212})\\\\&amp;+(\\mu_{211}+h_3+\\varepsilon_{2113}-\\mu_{22}-h_3-\\varepsilon_{223})+(\\mu_{212}+h_4+\\varepsilon_{2124}-\\mu_{221}-h_4-\\varepsilon_{2214})]\\\\&amp;=\\bar{\\mu}_{\\cdot1}-\\bar{\\mu}_{\\cdot2}+\\frac{1}{4}[(\\varepsilon_{1111}-\\varepsilon_{1221})+(\\varepsilon_{1122}-\\varepsilon_{1212})+(\\varepsilon_{2113}-\\varepsilon_{222})+(\\varepsilon_{2124}-{\\varepsilon}_{2214})]\\end{aligned}\\] 请注意到马效应 \\(h_m\\) 从表达式中消去。\\(\\hat P\\) 的方差取决于 \\(\\varepsilon_{ijkm}\\) 的方差，而不是 \\(h_m\\) 的方差。 \\(\\hat P\\) 的方差为 \\(\\operatorname{Var}(P) = \\sigma^2_{\\varepsilon} /2\\). \\(F\\) 的最佳估计可以表示为 \\[\\begin{aligned}\\hat{F}&amp;=\\bar{y}_{1\\cdot\\cdot\\cdot}-\\bar{y}_{2\\cdot\\cdot\\cdot}\\\\&amp;=\\frac14[(y_{1111}+y_{1221})+(y_{1122}+y_{1212})-(y_{2113}+y_{2223})-(y_{2124}+y_{2214})]\\end{aligned}\\] 此估计是马间的比较；也就是说，它是马 1 和马 2 平均值与马 3 和马 4 平均值的比较，因此它取决于马效应。通过将模型右侧的 \\(F\\) 表示为 \\[\\begin{aligned} \\hat{F}&amp; =\\frac14[(\\mu_{111}+h_1+\\varepsilon_{1111}+\\mu_{122}+h_1+\\varepsilon_{1221})+(\\mu_{112}+h_2+\\varepsilon_{1122}+\\mu_{121}+h_2+\\varepsilon_{1212}) \\\\ &amp;=[\\bar{\\mu}_{\\cdot1}-\\bar{\\mu}_{\\cdot2}+\\frac14[(\\varepsilon_{1111}+\\varepsilon_{1221})+(\\varepsilon_{1122}+\\varepsilon_{1212})-(\\varepsilon_{2113}+\\varepsilon_{2223})-(\\varepsilon_{2124}+\\varepsilon_{2214})] \\\\ &amp;+\\frac12[h_1+h_2-h_3-h_4] \\end{aligned}\\] 其中涉及 \\(h_m\\)，从而此估计依赖于马效应。\\(\\hat F\\) 的方差取决于 \\(h_m\\) 的方差和 \\(\\varepsilon_{ijkm}\\) 的方差，\\(\\mathrm{Var}(\\hat{F})=\\frac{1}{2}\\left[\\sigma_{\\varepsilon}^{2}+2\\sigma_{\\mathrm{horse}}^{2}\\right]\\)。同样可以证明，\\(P,T,F\\times T,F\\times P\\) 是马内效应，而 \\(F,P\\times T,F\\times P\\times T\\) 是马间效应。由于马间效应涉及 \\(h_m\\)，因此称它们与马效应混淆 (confounded)；即 \\(F,P\\times T,F\\times P\\times T\\) 与马效应混淆。 该设计由不完全区组设计结构中的三向处理结构组成，其中每匹马是一个区组。由于一些比较是马间比较，另一些是马内（足间）比较，因此该实验涉及两种尺寸的实验单元。足是较小尺寸的实验单元，而马是较大尺寸的实验单元。模型中的 \\(h_m\\) 项代表马误差（即，经相同处理的马之间的差异引起的变异），而 \\(\\varepsilon_{ijkm}\\) 项表示足误差（即，同一匹马经相同处理的足之间的差异引起的变异）。当设计涉及不同尺寸的实验单元的实验时，最好选择那些最重要的效应，以便它们涉及较小实验单元之间的比较，并让那些最不重要的效应涉及较大实验单元之间的比较。然而，这类安排并不总是可行的。例如，如果马足实验涉及两种类型的马（例如赛马和工作马），那么马的类型就只能作为马间比较。在只有三个因素的马足实验中，实验者最感兴趣的是比较两种融合技术。表 5.30 中给出的设计使得融合效应与马效应混淆，导致融合技术均值比较的精度低于预期。表 5.31 中给出的设计实现了融合技术均值的比较，且不与马效应混淆，因此达到了使用较小实验单元（马足）的变异性来比较最重要效应的目标。 第一种安排的模型也可以用来表示第二种将处理组合分配给马或区组的数据。使用与第一种安排相同的技术，可以证明 \\(F,P,T,F\\times P\\times T\\) 效应是马内比较，\\(F\\times T,F\\times P,P\\times T\\) 效应是马间比较，这些效应与马效应混淆。上述两种设计都没有产生足够的观测值来为估计两个误差项提供任何自由度。为了获得两种类型的误差方差的一定自由度，可以使用八匹马重复表 5.31 中的设计，其中两匹马被随机分配到每组处理组合。分析仍然由两部分组成，马间分析和马内（足间）分析。将进行八次马内比较（每匹马一次），可划分为对 \\(F,T,P,F \\times P \\times T\\) 效应的估计，以及对马内误差方差的估计，该误差方差用 error (feet) 表示。将进行七此马间比较，可划分为 \\(F\\times T,F\\times P , P\\times T\\) 效应的估计，以及马间误差方差的估计，该误差方差用 error (horse) 表示。方差分析结果表显示在表 5.32 中。 表 5.31: 马足实验处理组合的第二次分配 x 表 5.32: 马间和马内方差分析表 x 这个设计的实验属于重复测量设计类型，因为每匹马都有两次测量（重复）；也就是说，对每匹马测量前足和后足，并且不能将位置水平随机分配给其实验单元。 5.5.2 示例 5.7：舒适度研究——重复测量设计 一位实验者想研究六种环境条件对人的舒适度的影响。他有六个环境室，每个环境室都可以设置不同的环境条件。该实验包括将一个人放在一个室内，然后在暴露 1、2 和 3 小时后测量他的舒适度。研究中有 36 名个体，其中 6 名个体被随机分配到每种环境中。研究人员可以在一天内从六种环境条件中获得数据，因此天被用作一个区组因素，每天将每种环境条件分配给六个室中的一个。暴露时间是研究中的一个重要因素，因此处理结构是双向的，环境水平与三个暴露时间交叉。受试者被随机分配一个从 1 到 36 的数字，其中前 6 人在第一天参与实验，以此类推。环境和人员的分配如图 5.23 所示。图 5.23 中的每个矩形代表一个人，T1、T2和T3分别代表暴露 1、2 和 3 小时后的舒适度。环境的实验单元是一个人或一个室，而时间的实验单元则是该人员“内”的1小时间隔。实际上，人被“分成”三部分，但这种设计结构被称为重复测量设计而不是裂区设计，因为暴露时间水平不能随机分配给一个人的三个 1 小时暴露时间。该设计的结构与随机完全区组整区设计结构中具有双向处理结构的通常裂区相同。对于这种重复测量设计结构，较大尺寸的实验单元（人，或整区）设计由随机完全区组设计结构（六天）中的单向处理结构（六个环境水平）组成。较小尺寸的实验单元（1 小时时间间隔，或裂区）设计是随机完全区组设计结构中的单向处理结构（三次暴露），其中每个人或室是一个区组。可以用来描述该实验数据的模型是 \\[y_{ijk}=\\mu+E_i+d_j+c_{ij}+T_k+(ET)_{ik}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,6,\\quad j=1,2,\\ldots,6,\\quad k=1,2,3\\] 其中 \\(d_j\\) 表示第 \\(j\\) 天的效应，\\(c_{ij}\\) 表示第 \\(j\\) 天用于第 \\(i\\) 个环境的室（或人）的效应，\\(\\varepsilon_{ijk}\\) 是时间间隔效应。如果对每人进行一次观测，则所得数据集将来自随机完全区组设计结构中的单向处理结构。室（或人）的误差项是通过天与环境交互作用计算的。如果比较第一种环境条件下的时间，则所得设计是随机完全区组设计结构中的单向处理结构，其中人（或室，或天）是区组因素。时间间隔误差项是根据天与时间交互作用计算的。可以为每个环境计算时间间隔的误差项，如果方差相等，则可以将其合并到时间间隔误差中。表 5.33 中给出了该重复测量设计的方差分析表。这种基本的重复测量结构与通常的裂区设计相同。 裂区模型假设 \\(d_j,c_{ij},\\varepsilon_{ijk}\\) 是独立的随机变量，方差为 \\(\\sigma^2_\\text{day},\\sigma^2_\\text{chamber},\\sigma^2_\\varepsilon\\). 重复测量设计也假设 \\(d_j,c_{ij},\\varepsilon_{ijk}\\) 是独立的随机变量，但由于 \\(\\varepsilon_{ijk}\\) 是在同一个人身上测量的，它们可以是相关的，相关结构可能需要建模，协方差结构的建模将在第 26 章和第 27 章讨论。 图 5.23: 舒适度研究的数据安排 表 5.33: 舒适度研究的方差分析表 x 将一个人分配到每个环境室的另一种方法是将六人一组分配到一个环境室并在一天内完成研究。这个分配过程似乎是一个好主意，但生成的数据集没有提供任何这样的测量：经相同处理时，室是如何变异的。室误差项不存在是因为六个人组成了环境的实验单元，因此每个环境只有一个独立的观测。如果没有室误差项，就无法评估环境对舒适度的效应。 5.5.3 示例 5.8：交叉或转换设计 一种将处理应用于个体（或对象）的比较方法，就是让个体自身作为对照，将两种或多种处理应用于同一个体。如果有两种处理方法，那么过程是先将处理 A 应用于第一个时间段并测量响应，让处理 A 的效应减弱 (diminish) 或洗脱 (wash out)，然后在第二个时间段将处理 B 应用于个体并观察对处理 B 的响应。随机化过程是构建处理序列 (sequence)（这里是先 A 后 B 和先 B 后 A），然后随机将个体或动物分配给这些序列。这种方法还可以用于植物、地块或其他对象，在将实验单元暴露于处理后，该实验单元应至少能够从第一次处理的效应中恢复一部分。 在这种比较两种处理方法的方法中，动物有两种处理分配序列——先 A 后 B 和先 B 后 A。这两个序列通常用 AB 序列和 BA 序列表示。处理结构是具有两个水平（A 和 B）的单向处理集，但由于处理按顺序应用于每个实验单元，因此生成的序列成为另一种类型的处理。因此，本实验的设计涉及双向处理结构，处理与序列交叉。 这种交叉设计是一种具有两种尺寸的实验单元的重复测量设计。将处理序列分配给个体，使个体成为更大的实验单元。观察处理的时间段或时间是较小尺寸的实验单元。较大尺寸实验单元的设计是完全随机设计结构中具有两个水平的序列（两个可能的序列）的单向处理结构。尽管可以使用任何设计结构，但最常用的是完全随机设计。较小尺寸实验单元（时间间隔）的设计是完全随机区组设计结构中的单向处理结构（两个时间段或两次处理），个体是区组。数据可按表 5.34 所示进行排列，可用于描述数据的模型为 \\[y_{ijk}=\\mu_{ik}+s_{ij}+\\varepsilon_{ijk},\\quad\\mathrm{~where~}(i,j,k)\\in I_\\text{D}{ , s _ { i j }}\\thicksim i.i.d.\\text{ N}(0,\\sigma_{\\mathrm{subject}}^2),\\mathrm{~and~}\\varepsilon_{ijk}\\thicksim i.i.d.\\text{ N}(0,\\sigma_{\\mathrm{time}}^2)\\] 其中 \\(I_D\\) 是实验中实际使用的 \\((i,j,k)\\) 三元组的指标集，\\(\\mu_{ik}\\) 表示第 \\(i\\)个序列中第\\(k\\)次处理的效应，\\(s_{ij}\\)表示分配给第\\(i\\)个序列的第\\(j\\)个受试者的随机效应，\\(\\varepsilon_{ijk}\\)表示在应用第\\(k\\)次处理的第\\(i\\)个序列的时间段中测量的随机误差。第 29 章介绍了一些交叉设计的分析。 表 5.34: 两阶段两处理交叉设计的数据安排 x 5.6 涉及嵌套因素的设计 在给定的设计中，可能在设计结构、处理结构或两个结构中都具有嵌套效应 (nested effects). 嵌套最常见于实验的设计结构中，其中较小尺寸的实验单元嵌套在较大尺寸的实验中。如果每个较大实验单元中的较小实验单元都不同，那么一个尺寸的实验单元就嵌套在另一个较大的尺寸中。当设计结构由几种不同尺寸的实验单元组成，并且存在一种排序：最小尺寸嵌套在次小尺寸内，直到次大尺寸嵌套在最大尺寸的实验单元内，这种设计也称为分层设计结构。本章前几节讨论的裂区设计和重复测量设计是这样的设计结构的良好示例：其中较小尺寸实验单元嵌套在较大尺寸实验单元内。当一个因素的水平仅与第二个因素的一个水平一起出现时，处理结构中就会出现嵌套。在这种情况下，第一个因素的水平被认为是嵌套在第二个因素的水平内。表 5.35 说明了示例 4.2 第二部分的设计结构中的嵌套，其中房屋嵌套在方块内（“X”表示房屋包含在相应的方块内）。每个方块是较大的实验单元或房屋区组，而房屋是较小的实验单元。由于第一个方块的房屋与第二个方块的房屋不同，因此房屋嵌套在方块内。这种嵌套效应通常在模型中用 \\(s_k + h_{m(k)}\\) 表示，其中 \\(s_k\\) 表示第 \\(k\\) 个方块的效应，\\(h_{m(k)}\\) 表示嵌套在第 \\(k\\) 个方块中的第 \\(m\\) 个房屋的效应。方块和方块内房屋的平方和分别用 SSSQUARE 和 SSHOUSES(SQUARES) 表示。如果模型中包含房屋而不是方块，则只有一个由房屋（SSHOUSES）引起的平方和，可以将其划分为 SSHOUSES = SSSQUARES + SSHOUSES(SQUARES)。此过程可以再进行一步，其中房屋的侧面嵌套房屋内（而房屋又嵌套在方块内）。这样，这三种尺寸的实验单元就形成了一个分层设计结构。 表 5.35: 显示嵌套在方块内的房屋的设计 x 5.6.1 示例 5.9：动物遗传学 一位动物科学家想要研究基因对羔羊生长速度的影响。她有 4 只公羊和 12 只母羊。育种结构如表 5.36 所示（“X”表示交配）。在这个例子中，每只公羊都与三只母羊交配，而这三只母羊对于每只公羊来说都是不同的。因此，母羊的水平被称为嵌套因素，母羊嵌套在公羊中。如果动物科学家对这个公羊组合和这个母羊组合的效应感兴趣，那么嵌套在公羊水平内的母羊水平就构成了一个嵌套处理结构。 表 5.36: 育种结构显示母羊嵌套在公羊中 x 当处理结构中出现嵌套时，处理结构必须至少包含两个因素。在这种情况下，嵌套因素的每个水平只与其他因素的一个或几个水平一起出现一次。接下来的两个示例演示了处理结构中的嵌套。 5.6.2 示例 5.10：大豆的生育期组 农作物大豆对于处理结构中的嵌套是一个很好的例子。大豆品种按生育期组 (maturity groups) 进行分类。在美国中西部地区种植着生育期组 4、5 和 6 的大豆品种，但某一生育期组的品种可能比另一生育期组的品种更适合特定地区。一项研究设计用于评估 8 个大豆品种，其中 2 个来自成熟期组 4，4 个来自生育期组 5，2 个来自生育期组 6。表 5.37 展示了处理结构，表明品种水平嵌套在生育期水平内。一个可以描述来自这个嵌套处理结构的数据的模型，是一个具有四个区组的随机完全区组设计结构 \\[\\begin{aligned}&amp;y_{ijk}=\\mu+M_i+V(M)_{j(i)}+b_k+\\varepsilon_{ijk},\\quad i=1,2,3,j=1,\\ldots,n_i,k=1,2,3,4\\\\&amp;b_k\\sim i.i.d.N(0,\\sigma_{\\mathrm{row}}^2),\\varepsilon_{ijk}\\sim i.i.d.N(0,\\sigma_{\\varepsilon}^2),n_1=n_3=2,\\mathrm{~and~}n_2=4.\\end{aligned}\\] 其中 \\(M_i\\) 表示第 \\(i\\) 个生育期组的效应，\\(V(M)_{j(i)}\\) 表示嵌套在第 \\(i\\) 个生育期组内的第 \\(j\\) 个品种的效应，\\(b_k\\) 表示第 \\(k\\) 个区组的效应，\\(\\varepsilon_{ijk}\\) 表示实验单元误差。表 5.38 给出了上述模型的方差分析表，其中误差项是通过品种与区组交互作用来计算的。品种与区组交互作用可以划分为：生育期组与区组交互作用+嵌套在生育期组内的品种与区组的交互作用。 表 5.37: 品种嵌套于生育期组的大豆研究的处理结构 x 表 5.38: 随机完全区组设计结构中大豆品种嵌套于生育期组的方差分析表 x 上述设计的一个问题是，由于生育期组 4 的大豆比生育期组 5 的大豆更早收获，而生育期组 5 的大豆又比生育期组 6 的大豆更早收获，因此地块 (plots) 需要在不同的时间进行收获。随机完全区组设计的一种替代方案是使用裂区设计，其中整区由生育期组形成，子区由生育期组的品种形成。裂区设计的优点是可以同时收获整区内的所有品种。随机化过程是将生育期组水平随机分配给每个整区内的地块集 (sets of plots)，然后将各自的品种随机分配给生育期组内的地块。这种裂区设计结构的模型是 \\[\\begin{aligned}y_{ijk}&amp;=\\mu+M_i+b_k+w_{ik}+V(M)_{j(i)}+\\varepsilon_{ijk},\\quad i=1,2,3,j=1,\\ldots,n_i,k=1,2,3,4\\\\b_k&amp;\\sim i.i.d.N(0,\\sigma_{\\mathrm{row}}^2),v_{ik}\\sim i.i.d.N(0,\\sigma_{\\mathrm{wplot}}^2),\\mathrm{and}\\,\\,\\varepsilon_{ijk}\\sim i.i.d.N(0,\\sigma_{\\varepsilon}^2)\\end{aligned}\\] 其中 \\(w_{ik}\\) 表示整区效应，\\(\\varepsilon_{ijk}\\) 表示子区效应。整图设计是随机完全区组设计结构中的单向处理结构（三个生育期水平），其中整区误差是根据区组与生育期交互作用计算的。子区设计由三个独立的单向处理结构组成，采用随机完全区组设计结构，每个生育期组一个。由于每个生育期组中有不同数量的品种，因此整区的尺寸不同。这种双向嵌套处理结构在裂区设计结构中的方差分析表如表 5.39 所示。 表 5.39: 裂区设计结构中大豆品种嵌套于生育期组的方差分析表 x 5.6.3 示例 5.11：飞机引擎 某飞机公司希望用三种飞机来评估七种引擎的性能。由于某些机械特性，每种飞机只能使用某些引擎。表 5.40 给出了可能的引擎-飞机配置（标记为“X”）。 表 5.40: 嵌套处理结构中可观测的引擎-飞机配置 x 如表 5.40 所示，每种引擎类型只能出现在一种飞机类型上，因此引擎水平嵌套在飞机水平内。飞机公司为七种处理组合（引擎类型与飞机类型）中的每一种制造了三架飞机。 数据收集过程是将 21 种引擎型号-飞机型号的配置随机排序，让试飞员按随机顺序驾驶飞机并测量性能特征。设 \\(y_{ijk}\\) 表示由第 \\(i\\) 种飞机型号和第 \\(j\\) 种引擎型号制成的第 \\(k\\) 架飞机的性能测量。可用于描述性能测量的均值模型为 \\[\\begin{aligned}y_{ijk}&amp;=\\mu_{ij}+p_{ijk},\\quad\\text{for }(i,j)\\in\\Theta\\text{ and }p_{ijk}\\thicksim i.i.d.N(0,\\sigma_{\\text{plane}}^2)\\end{aligned}\\] 或效应模型 \\[y_{ijk}=\\mu+A_i+E_{j(i)}+p_{ijk},\\quad\\mathrm{for~}(i,j)\\in\\Theta,\\] 其中 \\[\\Theta=\\{(1,A),(1,B),(1,C),(2,D),(2,E),(3,F),(3,G)\\}\\] 表 5.41 显示了效应模型的方差分析表。使用同一引擎类型和飞机类型的配置制造三架飞机，可计算这三架飞机性能得分的变异，并将这七种配置的性能得分变异合并在一起以计算飞机误差项 (The plane error term is computed from the variation of the performance scores of the three planes made with the same engine type and aircraft type configuration pooled across the seven configurations). 就均值模型而言，飞机平方和用于检验飞机均值的相等性，即检验原假设 \\[\\bar{\\mu}_{1\\cdot}=\\bar{\\mu}_{2\\cdot}=\\bar{\\mu}_{3\\cdot}\\] 或 \\[\\frac{{\\mu}_{1A}+{\\mu}_{1B}+{\\mu}_{1C}}3=\\frac{{\\mu}_{2D}+{\\mu}_{2E}}2=\\frac{{\\mu}_{3F}+{\\mu}_{3G}}2\\] 引擎（嵌套在飞机内）平方和用于检验原假设 \\[{\\mu}_{1A}={\\mu}_{1B}={\\mu}_{1C},\\quad{\\mu}_{2D}={\\mu}_{2E},\\quad\\mathrm{and}\\quad{\\mu}_{3F}={\\mu}_{3G}\\] 当处理结构中出现嵌套时必须非常小心，因为有这样一种执行分析的趋势：就好像存在嵌套或分层设计结构。单个飞机是本研究的唯一实验单元，即只有一个尺寸的实验单元和一个误差项。当设计结构中出现嵌套时，存在不止一个尺寸的实验单元，因此模型中存在不止一个误差项。下一个示例说明了设计结构中的嵌套。 表 5.41: 完全随机设计结构中双向嵌套处理结构的方差分析表 x 5.6.4 示例 5.12：简单的舒适度实验 为了研究温度（三个水平，分别为 18°C、21°C 和 24°C）和性别（两个水平，男性 M 和女性 F）对人员舒适度的影响，进行了一项舒适度实验。测量人的舒适度的方法有很多种，因此，在此讨论中，假设对每个人员只进行一次舒适度测量。三个温度分别随机分配给九个可用环境室 (environmental chambers) 中的三个。室 (chambers) 是温度水平的实验单元，室设计是完全随机设计结构中的单向处理结构。 18 名男性和 18 名女性被随机分配到各个室，因此每个室都分配了两名男性和两名女性。人员性别的实验单元是人员，人员设计是随机区组设计中的单向处理结构，其中室是区组。在每个区组的每个性别水平上都有两次重复。室关于温度的分配和人员关于室的分配如图 5.24 所示。 将这些人员置于环境条件 3 小时后，测量他们的舒适度。可用于描述这些数据的均值模型为 \\[y_{ijkm}=\\mu_{ik}+c_{j(i)}+p_{m(ijk)}\\quad i=1,2,3,~j=1,2,3,~k=1,2,~m=1,2\\] 其中 \\[c_{j(i)}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{chamber}}^2)\\mathrm{~and~}p_{m(ijk)}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{person}}^2)\\] 效应模型为 \\[y_{ijkm}=\\mu+T_i+c_{j(i)}+S_k+(TS)_{ik}+p_{m(ijk)}\\] 其中 \\(\\mu_{ik}\\) 表示第 \\(i\\) 个温度和第 \\(k\\) 个性别的均值，\\(c_{j(i)}\\) 是分配给第 \\(i\\) 个温度的第 \\(j\\) 个腔室的随机效应，\\(p_{m(ijk)}\\) 表示分配给第 \\(j\\) 个温度的第 \\(k\\) 个腔室的第 \\(k\\) 个性别的第 \\(m\\) 个人的随机效应，\\(T_i,S_k,(TS)_{ik}\\) 分别表示温度、性别和温度与性别交互作用的效应。 图 5.24: 将人员和温度分配给室以进行简单的舒适性实验 这个实验涉及两个层次的嵌套。首先，室嵌套在温度内。其次，同性别的人嵌套在室内。本实验的方差分析表如表 5.42 所示。性别效应和温度与性别交互作用是人员间比较 (between-person comparisons)，因此使用人员误差项来进行这些均值之间的比较。室误差项用于在温度均值之间进行比较。 表 5.42: 简单的舒适度实验嵌套设计结构的方差分析表 x 5.6.5 示例 5.13：重复测量的多地点研究 典型的农业研究涉及在多个地点 (locations) 评估处理，且通常会随着时间的推移测量响应。本研究使用三个地点对四个苜蓿品种进行评估。苜蓿是一种在生长季节收获三次或三次以上的作物，因此数据集包含重复测量。在每个地点，该设计是一个随机完全区组设计结构中的单向处理结构，具有三次重复。图 5.25 显示了每个地点品种关于地块 (plots) 的分配情况。图 5.26 是每个地点的实验单元的图形。由于一个地点的所有地块都是同时收割 (cut) 或收获 (harvest) 的，因此同一地点的所有地块在收割之间都处于相同的环境条件下。因此，重复测量的是给定地点的整个实验，而不是单个地块。图 5.26 中的一列表示一个品种被应用和收获三次的实体 (entity)，是品种的实验单元。地块的一层 (layer) 代表受环境条件影响的实体，并且是收割水平的实验单元。切割水平在所有给定地点的地块上形成条区结构。单元格表示在一个收割时间收获的品种单元。 图 5.25: 将苜蓿品种分配给地块以进行多地点实验 图 5.26: 在一个地点显示实验单元，用于多地点研究 表 5.43: 重复测量多地点研究的方差分析表 x 可以通过忽略层来构建列的分析，这在每个地点的随机完全区组设计结构中提供了单向处理结构。因此，列误差是通过品种与区组交互作用来计算的，其中合并了所有地点 (pooled across locations). 可以通过忽略列来构建层的分析，这在随机完全区组设计结构中提供了一种单向处理结构（收割水平），其中地点是区组。层误差项是通过收割与地点交互作用来计算的。最后，单元格是收割与品种交互作用的单元，并且单元格误差项是这样计算的：收割与品种与区组交互作用，其中合并了所有地点，再加上嵌套于地点内的收割与区组交互作用。可用于描述每个单元格响应的模型是 \\[y_{ijkm}=\\mu+l_i+b_{j(i)}+V_k+(lV)_{ik}+(bV)_{jk(i)}+C_m+(lC)_{im}+(VC)_{km}+(lVC)_{ikm}+\\varepsilon_{ijkm}\\] 其中 \\[\\begin{aligned}&amp;l_i\\thicksim N(0,\\sigma_{\\mathrm{Loc}}^2),\\quad b_{j(i)}\\thicksim N(0,\\sigma_{blk(\\mathrm{Loc})}^2),\\quad(lV)_{ik}\\thicksim N(0,\\sigma_{V*\\mathrm{Loc}}^2),\\quad(bV)_{jk(i)}\\thicksim N(0,\\sigma_{V*Blk(\\mathrm{Loc})}^2),\\\\&amp;(lC)_{im}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{C^*Loc}}^2),\\quad(lVC)_{ikn}\\thicksim i.i.d.N(0,\\sigma_{V*C *\\text{Loc}}^2),\\quad\\varepsilon_{ijkn}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{cell}}^2)\\end{aligned}\\] 该模型的假设是，将地点和嵌套在地点内的区组视为随机效应（参见第 18 章）。因此，所有涉及地点或嵌套在地点内的区组的交互作用也都是随机效应。在每个地点的收割水平被视为重复测量：最先是第一次收割，其次是第二次收割，最后是第三次收割。由于切割水平不能随机分配给地点内的层，因此提供了重复测量。该模型的假设是各层之间相互独立且方差相等，但由于存在重复测量，因此使用更复杂的协方差结构可能更合适。有关重复测量设计的协方差结构建模的讨论，参见第 26 章和第 27 章。该模型的方差分析表如表 5.43 所示，其中期望均方是从关于随机效应的模型假设中获得的（参见第 18 章）。 5.7 结束语 在本章中，考虑了几个不同尺寸的实验单元的设计结构。这些设计也称为多水平设计，一些多水平设计称为分层设计。讨论的设计类型包括裂区设计、条区设计、嵌套设计、重复测量设计以及它们的变体和组合。本章讨论的设计可以组合成一些非常复杂的设计。在这种情况下，确定一个合适的模型来描述数据的关键在于识别实验单元的尺寸并为每个尺寸的实验单元确定处理结构和设计结构。几乎总是这样：给定尺寸的实验单元的设计结构将是四种基本设计结构之一，并且误差平方和将使用特定基本设计结构的过程进行计算。本章的重点在于识别这样的设计以及何时和如何使用它们。涉及多于一种尺寸的实验单元的设计分析将在第 24 章至第 ?? 章中介绍，其中将详细讨论有关模型的假设。有关多水平设计的进一步讨论和示例，请参阅 Milliken (2003a, b) 和 Milliken et al. (1998). 5.8 练习 "],["chap6.html", "第 6 章 模型的矩阵形式 6.1 基本符号 6.2 最小二乘估计 6.3 可估性和连通的设计 6.4 关于线性模型参数的检验假设 6.5 总体边际均值 6.6 结束语 6.7 练习", " 第 6 章 模型的矩阵形式 “The sciences do not try to explain, they hardly even try to interpret, they mainly make models. By a model is meant a mathematical construct which, with the addition of certain verbal interpretations, describes observed phenomena. The justification of such a mathematical construct is solely and precisely that it is expected to work” - John Von Neumann 当使用不均衡 (unbalanced) 的固定效应模型、随机效应模型或混合效应模型时，求和符号变得非常费力，有时甚至几乎无法使用。这个问题可以通过使用模型的矩阵形式表达来解决。本章讨论了模型矩阵形式的构建，并描述了如何使用矩阵获得最小二乘估计、检验假设、计算最小二乘均值或总体边际均值以及构建置信区间。在 6.3 节中讨论了可估性 (estimability) 的概念。 6.1 基本符号 模型的矩阵形式可以表示为 \\[\\begin{equation} \\underset{n\\times1}{\\boldsymbol y}=\\underset{n × p}{\\vphantom{\\boldsymbol y}\\boldsymbol X} \\,\\,\\underset{p × 1}{\\vphantom{\\boldsymbol y}\\boldsymbol \\beta}+\\underset{n × 1}{\\vphantom{\\boldsymbol y}\\boldsymbol\\varepsilon} \\tag{6.1} \\end{equation}\\] 其中 \\(\\boldsymbol y\\) 表示 \\(n \\times 1\\) 观测向量，\\(\\boldsymbol X\\) 表示 \\(n \\times p\\) 已知常数矩阵，称为设计矩阵 (designed matrix)，\\(\\boldsymbol \\beta\\) 表示 \\(p \\times 1\\) 未知参数向量，\\(\\boldsymbol \\varepsilon\\) 表示 \\(n \\times 1\\) 未观测的误差向量。第 \\(i\\) 个观测值（\\(\\boldsymbol y\\) 的第 \\(i\\) 个元素）的模型具有以下形式 \\[\\begin{equation} y_i=\\beta_0+\\beta_1x_{i1}+\\beta_2x_{i2}+\\cdots+\\beta_{p-1}x_{ip-1}+\\varepsilon_i,\\quad i=1,2,\\ldots,n \\tag{6.2} \\end{equation}\\] 用于将模型 (6.2) 表示为矩阵模型 (6.1) 的向量和矩阵是 \\[\\begin{equation} \\boldsymbol{y}=\\begin{bmatrix}y_1\\\\y_2\\\\\\vdots\\\\y_n\\end{bmatrix},\\quad\\boldsymbol{X}=\\begin{bmatrix}1&amp;x_{11}&amp;x_{12}&amp;\\cdots&amp;x_{1p-1}\\\\1&amp;x_{21}&amp;x_{22}&amp;\\cdots&amp;x_{2p-1}\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\1&amp;x_{n1}&amp;x_{n2}&amp;\\cdots&amp;x_{np-1}\\end{bmatrix},\\quad\\boldsymbol{\\beta}=\\begin{bmatrix}\\beta_0\\\\\\beta_1\\\\\\beta_2\\\\\\vdots\\\\\\beta_{p-1}\\end{bmatrix},\\quad\\mathrm{and}\\quad\\boldsymbol{\\varepsilon}=\\begin{bmatrix}\\varepsilon_1\\\\\\varepsilon_2\\\\\\vdots\\\\\\varepsilon_n\\end{bmatrix} \\tag{6.3} \\end{equation}\\] 式 (6.3) 中的矩阵可用于表示多种模型类型，包括单向模型、双向模型、析因模型和部分析因模型等设计模型以及回归模型、协方差分析模型、随机模型等。通过指定 \\(\\boldsymbol X\\) 的适当元素以及 \\(\\boldsymbol \\beta\\) 和 \\(\\boldsymbol \\varepsilon\\) 的适当假设，可以构建效应模型、混合效应模型、裂区模型、重复测量模型和随机系数回归模型。以下各节介绍了各种实验情况下的一些矩阵模型。 6.1.1 简单线性回归模型 简单线性回归模型可以表示为 \\(y_i=\\beta_0+\\beta_1x_i+\\varepsilon_i,i=1,2,\\ldots,n\\) 并且可以用矩阵形式表示为 \\[\\begin{bmatrix}y_1\\\\y_2\\\\\\vdots\\\\y_n\\end{bmatrix}=\\begin{bmatrix}1&amp;x_1\\\\1&amp;x_2\\\\\\vdots&amp;\\vdots\\\\1&amp;x_n\\end{bmatrix}\\begin{bmatrix}{\\beta}_0\\\\{\\beta}_1\\end{bmatrix}+\\begin{bmatrix}{\\varepsilon}_1\\\\{\\varepsilon}_2\\\\\\vdots\\\\{\\varepsilon}_n\\end{bmatrix}\\] \\(\\boldsymbol X\\) 中的全 1 列对应于回归模型的截距 \\(\\boldsymbol \\beta_0\\)，\\(x_i\\) 列对应于回归模型的斜率。 6.1.2 单向处理结构模型 为了在完全随机设计结构中表示具有 \\(t\\) 个处理的单向处理结构的模型，其中第 \\(i\\) 个处理有 \\(n_i\\) 个观测结果，设自变量 \\(x_{ij}\\) 定义为 \\[x_{kij}=\\begin{cases}0&amp;\\text{ if the }ij\\text{th observation is not from the }k\\text{th treatment}\\\\1&amp;\\text{ if the }ij\\text{th observation is from the }k\\text{th treatment}&amp;\\end{cases}\\] 其中 \\(i=1,2,\\cdots,t\\)，\\(j=1,2,\\cdots,n_i\\). 变量 \\(x_{kij}\\) 被称为指示变量 (indicator variable)，因为当它的值为 1 时，它表明观测结果来自处理 k. 当它的值为 0 时，它表明观测结果不来自处理 k. 均值模型 (means model) 可表示为 \\(y_{ij}={\\mu}_1x_{1ij}+{\\mu}_2x_{2ij}+\\cdots+{\\mu}_tx_{tij}+{\\varepsilon}_{ij}\\)，其中 \\(i=1,2,\\cdots,t\\)，\\(j=1,2,\\cdots,n_i\\). 或者以矩阵表示法 \\[\\begin{bmatrix}{y}_{11}\\\\{y}_{12}\\\\\\vdots\\\\{y}_{1n_1}\\\\{y}_{22}\\\\\\vdots\\\\{y}_{2{n}_2}\\\\\\vdots\\\\{y}_{t1}\\\\\\vdots\\\\{y}_{t{n}_t}\\end{bmatrix}=\\begin{bmatrix}1&amp;0&amp;\\cdots&amp;0\\\\1&amp;0&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots\\\\1&amp;0&amp;\\cdots&amp;0\\\\0&amp;1&amp;\\cdots&amp;0\\\\0&amp;1&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots\\\\0&amp;1&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;1\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;1\\end{bmatrix}\\begin{bmatrix}\\mu_1\\\\\\mu_2\\\\\\vdots\\\\\\mu_t\\end{bmatrix}+\\boldsymbol \\varepsilon\\] 均值模型通常表示为 \\(y_{ij}=\\mu_i+\\varepsilon_{ij}\\)，其中 \\(i=1,2,\\cdots,t\\)，\\(j=1,2,\\cdots,n_i\\). 效应模型 (effect model) 可表示为 \\(y_{ij}=\\mu+\\tau_1x_{1ij}+\\tau_2x_{2ij}+\\cdots+\\tau_tx_{tij}+\\varepsilon_{ij}\\)，其中 \\(i=1,2,\\cdots,t\\)，\\(j=1,2,\\cdots,n_i\\). 或者以矩阵表示法 \\[\\begin{bmatrix}{y}_{11}\\\\{y}_{12}\\\\\\vdots\\\\{y}_{1{n}_1}\\\\{y}_{21}\\\\{y}_{22}\\\\\\vdots\\\\{y}_{2{n}_2}\\\\\\vdots\\\\{y}_{t1}\\\\\\vdots\\\\{y}_{t{n}_t}\\end{bmatrix}=\\begin{bmatrix}1&amp;1&amp;0&amp;\\cdots&amp;0\\\\1&amp;1&amp;0&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots\\\\1&amp;1&amp;0&amp;\\cdots&amp;0\\\\1&amp;0&amp;1&amp;\\cdots&amp;0\\\\1&amp;0&amp;1&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots\\\\1&amp;0&amp;1&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots\\\\1&amp;0&amp;0&amp;\\cdots&amp;1\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\1&amp;0&amp;0&amp;\\cdots&amp;1\\end{bmatrix}\\begin{bmatrix}\\mu\\\\\\tau_1\\\\\\tau_2\\\\\\vdots\\\\\\tau_t\\end{bmatrix}+\\boldsymbol \\varepsilon \\] 效应模型通常表示为 \\(y_{ij}=\\mu+\\tau_i+\\varepsilon_{ij}\\)，其中 \\(i=1,2,\\cdots,t\\)，\\(j=1,2,\\cdots,n_i\\). 均值模型和效应模型之间的区别在于，效应模型的设计矩阵包含模型截距 \\(\\mu\\) 的全 1 列，而均值模型不包含全 1 列。 6.1.3 双向处理结构模型 在完全随机设计结构中，对于具有 \\(t\\) 行处理和 \\(b\\) 列处理的双向处理结构，模型的一种形式为 \\[\\begin{equation} y_{ijk}=\\mu_{ij}+\\varepsilon_{ijk}\\quad i=1,2,\\ldots,t,j=1,2,\\ldots,b,\\mathrm{~and~}k=1,2,\\ldots,n_{ij} \\tag{6.4} \\end{equation}\\] 式子 (6.4) 中使用的模型称为均值模型，可以用矩阵形式表示为 \\[\\begin{bmatrix}y_{111}\\\\y_{112}\\\\\\vdots\\\\y_{11n_1}\\\\y_{121}\\\\\\vdots\\\\y_{12n_2}\\\\\\vdots\\\\y_{1b1}\\\\\\vdots\\\\y_{1bn_{1b}} \\\\y_{211}\\\\\\vdots\\\\y_{21n_{21}}\\\\\\vdots\\\\y_{tb1}\\\\\\vdots\\\\y_{tbn_{tb}} \\end{bmatrix}=\\begin{bmatrix} 1&amp;0&amp;\\cdots&amp;0&amp;0&amp;\\cdots&amp;0\\\\ 1&amp;0&amp;\\cdots&amp;0&amp;0&amp;\\cdots&amp;0\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 1&amp;0&amp;\\cdots&amp;0&amp;0&amp;\\cdots&amp;0\\\\ 0&amp;1&amp;\\cdots&amp;0&amp;0&amp;\\cdots&amp;0\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 0&amp;1&amp;\\cdots&amp;0&amp;0&amp;\\cdots&amp;0\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 0&amp;0&amp;\\cdots&amp;1&amp;0&amp;\\cdots&amp;0\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 0&amp;0&amp;\\cdots&amp;1&amp;0&amp;\\cdots&amp;0\\\\ 0&amp;0&amp;\\cdots&amp;0&amp;1&amp;\\cdots&amp;0\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 0&amp;0&amp;\\cdots&amp;0&amp;1&amp;\\cdots&amp;0\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 0&amp;0&amp;\\cdots&amp;0&amp;0&amp;\\cdots&amp;1\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 0&amp;0&amp;\\cdots&amp;0&amp;0&amp;\\cdots&amp;1\\end{bmatrix} \\begin{bmatrix}\\mu_{11}\\\\\\mu_{12}\\\\\\vdots\\\\\\mu_{1b}\\\\\\mu_{21}\\\\\\vdots\\\\\\mu_{tb}\\end{bmatrix} + \\boldsymbol \\varepsilon \\] 双向效应模型可表示为 \\[\\begin{equation} y_{ijk}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij}+\\varepsilon_{ijk}\\quad i=1,2,\\ldots,t,j=1,2,\\ldots,b,k=1,2,\\ldots,n_{ij} \\tag{6.5} \\end{equation}\\] 双向效应模型的矩阵形式为 \\[ \\begin{bmatrix}y_{111}\\\\y_{112}\\\\\\vdots\\\\y_{11n_1}\\\\y_{121}\\\\\\vdots\\\\y_{12n_2}\\\\\\vdots\\\\y_{1b1}\\\\\\vdots\\\\y_{1bn_{1b}} \\\\y_{211}\\\\\\vdots\\\\y_{21n_{21}}\\\\\\vdots\\\\y_{tb1}\\\\\\vdots\\\\y_{tbn_{tb}} \\end{bmatrix}=\\begin{bmatrix} 1 &amp; 0 &amp; \\cdots &amp; 0 &amp; 0 &amp; \\cdots &amp; 0 \\\\ 1 &amp; 0 &amp; \\cdots &amp; 0 &amp; 0 &amp; \\cdots &amp; 0 \\\\ \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots \\\\ 1 &amp; 0 &amp; \\cdots &amp; 0 &amp; 0 &amp; \\cdots &amp; 0 \\\\ 0 &amp; 1 &amp; \\cdots &amp; 0 &amp; 0 &amp; \\cdots &amp; 0 \\\\ \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots \\\\ 0 &amp; 1 &amp; \\cdots &amp; 0 &amp; 0 &amp; \\cdots &amp; 0 \\\\ \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots \\\\ 0 &amp; 0 &amp; \\cdots &amp; 1 &amp; 0 &amp; \\cdots &amp; 0 \\\\ \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots \\\\ 0 &amp; 0 &amp; \\cdots &amp; 1 &amp; 0 &amp; \\cdots &amp; 0 \\\\ 0 &amp; 0 &amp; \\cdots &amp; 0 &amp; 1 &amp; \\cdots &amp; 0 \\\\ \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots \\\\ 0 &amp; 0 &amp; \\cdots &amp; 0 &amp; 1 &amp; \\cdots &amp; 0 \\\\ \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots \\\\ 0 &amp; 0 &amp; \\cdots &amp; 0 &amp; 0 &amp; \\cdots &amp; 1 \\\\ \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots \\\\ 0 &amp; 0 &amp; \\cdots &amp; 0 &amp; 0 &amp; \\cdots &amp; 1 \\\\ \\end{bmatrix} \\begin{bmatrix}\\mu_{11}\\\\\\mu_{12}\\\\\\vdots\\\\\\mu_{1b}\\\\\\mu_{21}\\\\\\vdots\\\\\\mu_{tb}\\end{bmatrix}+ \\boldsymbol \\varepsilon \\] 本书强调与实验设计情境相对应的模型，而不是纯粹的回归情境。接下来的两个例子将展示如何从数据结构构建这样的模型。 6.1.4 示例 6.1：双向处理结构的均值模型 表 6.1 中的信息代表了一个完全随机设计结构中的双向处理结构的数据，其中有三行处理和三列处理，每个单元格有一个或两个观测值。表 6.1 中数据的均值模型的矩阵形式为： \\[\\begin{bmatrix}3\\\\6\\\\9\\\\10\\\\2\\\\5\\\\3\\\\8\\\\4\\\\2\\\\6\\end{bmatrix}=\\begin{bmatrix} 1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0\\\\ 0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0\\\\ 0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0\\\\ 0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0\\\\ 0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0\\\\ 0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1\\end{bmatrix}\\begin{bmatrix}\\mu_{11}\\\\\\mu_{12}\\\\\\mu_{13}\\\\\\mu_{21}\\\\\\mu_{22}\\\\\\mu_{23}\\\\\\mu_{31}\\\\\\mu_{32}\\\\\\mu_{33}\\end{bmatrix}+\\boldsymbol \\varepsilon\\] 表 6.1 中数据的效应模型的矩阵形式为 \\[ \\begin{bmatrix}3\\\\6\\\\9\\\\10\\\\2\\\\5\\\\3\\\\8\\\\4\\\\2\\\\6\\end{bmatrix}=\\begin{bmatrix} 1 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\end{bmatrix} \\begin{bmatrix} \\mu_1 \\\\ \\tau_1 \\\\ \\tau_2 \\\\ \\tau_3 \\\\ \\beta_1 \\\\ \\beta_2 \\\\ \\beta_3 \\\\ \\gamma_{11} \\\\ \\gamma_{12} \\\\ \\gamma_{13} \\\\ \\gamma_{21} \\\\ \\gamma_{22} \\\\ \\gamma_{23} \\\\ \\gamma_{31} \\\\ \\gamma_{32} \\\\ \\gamma_{33} \\end{bmatrix} +\\boldsymbol \\varepsilon \\] 或 \\[\\boldsymbol y=\\boldsymbol j\\boldsymbol\\mu+\\boldsymbol X_1\\boldsymbol \\tau+\\boldsymbol X_2\\boldsymbol\\beta+\\boldsymbol X_3\\boldsymbol \\gamma+\\boldsymbol\\varepsilon \\] 其中，\\(\\boldsymbol j\\) 是与上述设计矩阵的第一列对应的 11×1 向量，\\(\\boldsymbol X_1\\) 是与第 2-4 列对应的 11×3 矩阵，\\(\\boldsymbol X_2\\) 是与第 5-7 列对应的 11×3 矩阵，\\(\\boldsymbol X_3\\) 是与以上设计矩阵的最后九列对应的 11×9 矩阵。 表 6.1: CRD 结构中双向处理结构的数据 x 其他处理和设计结构的设计矩阵也是以类似的方式构建的。幸运的是，大多数用于拟合非均衡数据结构的软件都会使用上述类型的表示形式，并在模型中指定分类效应 (categorical effects) 时自动生成设计矩阵的必要列。 6.2 最小二乘估计 一旦模型以矩阵形式指定，分析的下一步是获得参数向量 \\(\\boldsymbol \\beta\\) 的最小二乘估计 (least squares estimator)。最小二乘法可用于估计模型的参数。要使用此方法，假设模型可以表示为 \\[\\begin{equation} y_i=f(x_i;\\boldsymbol{\\beta})+\\varepsilon_i\\quad\\mathrm{~for~}i=1,2,\\ldots,n \\tag{6.6} \\end{equation}\\] 其中 \\(y_i=f(x_i;\\boldsymbol{\\beta})\\) 是由 \\(x_i\\) 表示的设计变量向量的函数，且依赖于参数向量 \\(\\boldsymbol \\beta\\). \\(\\boldsymbol \\beta\\) 的最小二乘估计通常用 \\(\\hat {\\boldsymbol \\beta}\\) 表示，它能最小化平方和 \\[\\begin{equation} SS(\\boldsymbol{\\beta})=\\sum_{i=1}^n[y_i-f(x_i;\\boldsymbol{\\beta})]^2 \\tag{6.7} \\end{equation}\\] 如果除了假设模型的形式为 (6.6) 之外，还额外假设 \\(\\varepsilon_i \\sim i.i.d\\,N(0,\\sigma^2),i＝1,2,\\cdots,n\\)，则 \\(\\boldsymbol \\beta\\) 的最小二乘估计也是最大似然估计 (maximum likelihood estimator). 例如，完全随机设计中单向处理结构的均值模型的模型函数为 \\[f(x_{ij};\\boldsymbol{\\beta})=\\mu_i,\\quad i=1,2,\\ldots,t;\\quad j=1,2,\\ldots,n_i\\] \\(\\mu_i\\) 的最小二乘估计记作 \\(\\hat \\mu_1,\\cdots,\\hat \\mu_t\\)，它们是这样的值，即能够最小化 \\[\\begin{aligned}SS({\\mu})=\\sum_{i=1}^t\\sum_{j=1}^{n_j}(y_{ij}-\\mu_i)^2\\end{aligned}\\] 完全随机设计中双向处理结构的均值模型的模型函数为 \\[f(x_{ijk};\\boldsymbol{\\beta})=\\mu_{ij}\\quad i=1,2,\\ldots,t;j=1,2,\\ldots,b;k=1,2,\\ldots,n_{ij}\\] \\(\\mu_{ij}\\) 的最小二乘估计记作 \\(\\hat \\mu_{11},\\cdots,\\hat \\mu_{tb}\\)，它们是这样的值，即能够最小化 \\[\\begin{aligned}SS({\\mu})=\\sum_{i=1}^{t}\\sum_{j=1}^{b}\\sum_{k=1}^{n_{ij}}(y_{ijk}-\\mu_{ij})^2\\end{aligned}\\] 完全随机设计中双向处理结构的效应模型的模型函数为 \\[f(x_{ijk};\\boldsymbol{\\beta})=\\mu+\\tau_i+{\\beta}_j+\\gamma_{ij},\\quad i=1,2,\\ldots,t;j=1,2,\\ldots,b;k=1,2,\\ldots,n_{ij}\\] \\(\\mu,\\tau_i,\\beta_j,\\gamma_{ij}\\) 的最小二乘估计是通过最小化下式来获得的 \\[SS(\\mu,\\tau_i,\\beta_j,\\gamma_{ij})=\\sum_{i=1}^t\\sum_{j=1}^b\\sum_{k=1}^{n_{ij}}(y_{ijk}-\\mu-\\tau_i-\\beta_j-\\gamma_{ij})^2\\] 通常，模型可以写成矩阵形式，如式 (6.1) 中的矩阵形式，并且 \\(\\boldsymbol \\beta\\) 的最小二乘估计是这样的 \\(\\hat {\\boldsymbol \\beta}\\) ，即能最小化平方和 \\[\\begin{equation} SS(\\boldsymbol\\beta)=(\\boldsymbol y-\\boldsymbol X \\boldsymbol\\beta)^{\\prime}(\\boldsymbol y-\\boldsymbol X \\boldsymbol\\beta) \\tag{6.8} \\end{equation}\\] 6.2.1 最小二乘方程组 矩阵表示和计算可用于确定能使残差平方和最小化的 \\(\\boldsymbol\\beta\\) 值。当进行最小化时，会得到一组 \\(\\hat {\\boldsymbol \\beta}\\) 必须满足的方程，这些方程被称为模型的最小二乘方程组 (least squares equations) 或正规方程组 (normal equations). 对于模型 (6.1)，正规方程组由下式给出： \\[\\begin{equation} \\boldsymbol X^{\\prime} \\boldsymbol X\\hat{\\boldsymbol{\\beta}}=\\boldsymbol X^{\\prime}\\boldsymbol{y} \\tag{6.9} \\end{equation}\\] 任何满足正规方程组的向量 \\(\\hat {\\boldsymbol \\beta}\\) 都是 \\(\\boldsymbol\\beta\\) 的最小二乘估计。对于一些模型，最小二乘估计不必是唯一的。为了帮助读者更加熟悉正规方程组，下面提供了第 6.1 节中讨论的模型的正规方程组。 单向均值模型的正规方程组为 \\[\\begin{bmatrix}n_1&amp;0&amp;\\cdots&amp;0\\\\0&amp;n_2&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;n_t\\end{bmatrix}\\begin{bmatrix}\\hat{\\mu}_1\\\\\\hat{\\mu}_2\\\\\\vdots\\\\\\hat{\\mu}_t\\end{bmatrix}=\\begin{bmatrix}y_{1\\cdot}\\\\y_{2\\cdot}\\\\\\vdots\\\\y_{t\\cdot}\\end{bmatrix}\\mathrm{~where~}y_{i\\cdot}=\\sum_{i=1}^{n_i}y_{ij}\\] 单向效应模型的正规方程组为 \\[\\begin{bmatrix}n_{\\cdot}&amp;n_1&amp;n_2&amp;\\cdots&amp;n_t\\\\n_1&amp;n_1&amp;0&amp;\\cdots&amp;0\\\\n_2&amp;0&amp;n_2&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\n_t&amp;0&amp;0&amp;\\cdots&amp;n_t\\end{bmatrix}\\begin{bmatrix}\\hat{\\mu}\\\\\\hat{\\tau}_1\\\\\\hat \\tau_2\\\\\\vdots\\\\\\hat{\\tau}_t\\end{bmatrix}=\\begin{bmatrix}y_{\\cdot\\cdot}\\\\y_{1\\cdot}\\\\y_{2\\cdot}\\\\\\vdots\\\\y_{t\\cdot}\\end{bmatrix}\\quad\\mathrm{where~}y_{\\cdot\\cdot}=\\sum_{i=1}^t\\sum_{j=1}^{n_i}y_{ij}\\quad\\mathrm{and}\\quad n_{\\cdot}=\\sum_{i=1}^tn_t\\] 使用表 6.1 中数据的双向均值模型的正规方程组为 \\[\\begin{bmatrix}2&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;0&amp;2&amp;0&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0\\\\0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0\\\\0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1\\end{bmatrix}\\begin{bmatrix}\\hat{\\mu}_{11}\\\\\\hat{\\mu}_{12}\\\\\\hat{\\mu}_{13}\\\\\\hat{\\mu}_{21}\\\\\\hat{\\mu}_{22}\\\\\\hat{\\mu}_{23}\\\\\\hat{\\mu}_{31}\\\\\\hat{\\mu}_{32}\\\\\\hat{\\mu}_{33}\\end{bmatrix}=\\begin{bmatrix}y_{11\\cdot}\\\\y_{12\\cdot}\\\\y_{13\\cdot}\\\\y_{21\\cdot}\\\\y_{22\\cdot}\\\\y_{23\\cdot}\\\\y_{31\\cdot}\\\\y_{32\\cdot}\\\\y_{33\\cdot}\\end{bmatrix}\\] 其中 \\[y_{ij\\cdot}=\\sum_{k=1}^{n_{ij}}y_{ijk}\\] 与表 6.1 中的数据相对应的双向效应模型的正规方程组为 $$$$ \\[\\begin{bmatrix} 11&amp;4&amp;4&amp;3&amp;4&amp;4&amp;3&amp;2&amp;1&amp;1&amp;1&amp;2&amp;1&amp;1&amp;1&amp;1\\\\ 4&amp;4&amp;0&amp;0&amp;2&amp;1&amp;1&amp;2&amp;1&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 4&amp;0&amp;4&amp;0&amp;1&amp;2&amp;1&amp;0&amp;0&amp;0&amp;1&amp;2&amp;1&amp;0&amp;0&amp;0\\\\ 3&amp;0&amp;0&amp;3&amp;1&amp;1&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;1&amp;1\\\\ 4&amp;2&amp;1&amp;1&amp;4&amp;0&amp;0&amp;2&amp;0&amp;0&amp;1&amp;0&amp;0&amp;1&amp;0&amp;0\\\\ 4&amp;1&amp;2&amp;1&amp;0&amp;4&amp;0&amp;0&amp;1&amp;0&amp;0&amp;2&amp;0&amp;0&amp;1&amp;0\\\\ 3&amp;1&amp;1&amp;1&amp;0&amp;0&amp;3&amp;0&amp;0&amp;1&amp;0&amp;0&amp;1&amp;0&amp;0&amp;1\\\\ 2&amp;2&amp;0&amp;0&amp;2&amp;0&amp;0&amp;2&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 1&amp;1&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 1&amp;1&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 2&amp;0&amp;2&amp;0&amp;0&amp;2&amp;0&amp;0&amp;0&amp;0&amp;0&amp;2&amp;0&amp;0&amp;0&amp;0\\\\ 1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0\\\\ 1&amp;0&amp;0&amp;1&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0\\\\ 1&amp;0&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0\\\\ 1&amp;0&amp;0&amp;1&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1\\end{bmatrix} \\begin{bmatrix}\\hat\\mu\\\\\\hat\\tau_{1}\\\\\\hat{\\tau}_2\\\\\\hat\\tau_{3}\\\\\\hat\\beta_{1}\\\\\\hat\\beta_{2}\\\\\\hat\\beta_{3}\\\\\\hat\\gamma_{11}\\\\\\hat\\gamma_{12}\\\\\\hat\\gamma_{13}\\\\\\hat\\gamma_{21}\\\\\\hat\\gamma_{22}\\\\\\hat\\gamma_{23}\\\\\\hat\\gamma_{31}\\\\\\hat\\gamma_{32}\\\\\\hat\\gamma_{33}\\end{bmatrix}=\\begin{bmatrix}y_{\\cdot\\cdot\\cdot}\\\\y_{1\\cdot\\cdot}\\\\y_{2\\cdot\\cdot}\\\\y_{3\\cdot\\cdot}\\\\y_{\\cdot1\\cdot}\\\\y_{\\cdot2\\cdot}\\\\y_{\\cdot3\\cdot}\\\\y_{11\\cdot}\\\\y_{12\\cdot}\\\\y_{13\\cdot}\\\\y_{21\\cdot}\\\\y_{22\\cdot}\\\\y_{23\\cdot}\\\\y_{31\\cdot}\\\\y_{32\\cdot}\\\\y_{33\\cdot}\\end{bmatrix}\\] 其中 \\[y_{\\cdot\\cdot\\cdot}=\\sum_{i=1}^t\\sum_{j=1}^b\\sum_{k=1}^{n_{ij}}y_{ijk},\\quad y_{i\\cdot\\cdot}=\\sum_{j=1}^b\\sum_{k=1}^{n_{ij}}y_{ijk},\\quad y_{\\cdot j\\cdot}=\\sum_{i=1}^t\\sum_{k=1}^{n_{ij}}y_{ijk},\\quad\\mathrm{and}\\quad y_{ij\\cdot}=\\sum_{k=1}^{n_{ij}}y_{ijk}\\] 当 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 满秩时 (Graybill, 1976)，即 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 是非奇异的，则 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 的逆存在，并且 \\({\\boldsymbol \\beta}\\) 的最小二乘估计（方程 (6.9) 中 \\(\\hat {\\boldsymbol \\beta}\\) 的解）为 \\[\\begin{equation} \\hat {\\boldsymbol \\beta}=(\\boldsymbol X^\\prime \\boldsymbol X)^{-1}\\boldsymbol{X^{\\prime}y} \\tag{6.10} \\end{equation}\\] 当 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 是满秩时，最小二乘估计是唯一的。计算 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 的逆通常不是一项容易的任务。计算软件开发的最重要方面之一是，现在统计学家可以求超大型矩阵的逆，这在计算机出现之前是不可能的。然而，当 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 中存在某些模式时，可以利用这些模式更容易地求逆。对于单向均值模型和双向均值模型的正规方程组，\\(\\boldsymbol X^\\prime \\boldsymbol X\\) 是对角矩阵（所有对角元非零，非对角元为零），并且 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 的逆是通过简单地将每个对角元替换为其倒数来获得的。因此，单向均值模型的 \\(\\mu_i\\) 的最小二乘估计为 \\[\\begin{bmatrix}\\hat{{\\mu}}_1\\\\\\hat{{\\mu}}_2\\\\\\vdots\\\\\\hat{{\\mu}}_t\\end{bmatrix}=\\begin{bmatrix}\\frac1{n_1}&amp;0&amp;\\cdots&amp;0\\\\0&amp;\\frac1{n_2}&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;\\frac1{n_t}\\end{bmatrix}\\begin{bmatrix}y_{1\\cdot}\\\\y_{2\\cdot}\\\\\\vdots\\\\y_{t\\cdot}\\end{bmatrix}\\] 或等价地 \\[\\hat{\\mu}_i=\\frac{y_{i\\cdot}}{n_i}=\\bar{y}_{i\\cdot}\\quad i=1,2,\\ldots,t\\] 类似地，双向均值模型 \\(\\mu_{ij}\\) 的最小二乘估计为 \\[\\hat{\\mu}_{ij}=\\frac{y_{ij\\cdot}}{n_{ij}}=\\bar{y}_{ij\\cdot}\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,b\\] 与均值模型的正规方程组不同，效应模型的 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 是奇异的，并且 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 的逆不存在。在这种情况下，正规方程组有许多解（实际上是无穷多个最小二乘解）。效应模型被称为过度指定 (overspecified models) 或奇异模型 (sigular models)，因为与从收集的数据中可以唯一估计的参数相比，这些模型具有更多的参数。通常使用过度指定的模型，并且有几种方法可以求解其相应的正规方程组。以下讨论涉及完全随机设计结构中的双向处理结构，但类似的技术也可用于其他因素效应模型。 理论上，广义逆可用于求解关于 \\({\\boldsymbol \\beta}\\) 的正规方程组 (Graybill, 1976)，但求解过度指定模型的正规方程组的常用方法是对模型中的参数进行限制（这实际上产生了 g-inverse 解）。对模型参数施加限制可以通过多种方式实现，这里考虑其中两种方式。 6.2.2 零和限制 一种常见的技术是要求某些参数的和等于零。这种方法自方差分析之初就被用来求解正规方程组。对于使用表 6.1 中数据的双向效应模型，零和限制 (Sum-to-Zero Restrictions) 为： \\[\\begin{aligned} &amp;\\begin{aligned}\\sum_{i=1}^3\\tau_i=0,\\sum_{j=1}^3\\beta_j=0,\\sum_{i=1}^3\\gamma_{i1}=0,\\sum_{i=1}^3\\gamma_{i2}=0,\\sum_{i=1}^3\\gamma_{i3}=0\\end{aligned} \\\\ &amp;\\sum_{j=1}^3\\gamma_{1j}=0,\\sum_{j=1}^3\\gamma_{2j}=0,\\,\\text{and }\\sum_{j=1}^3\\gamma_{3j}=0 \\end{aligned}\\] 接下来，通过在考虑限制的情况下根据其他参数求解一些参数，然后将表达式替换回模型，将这些限制合并到模型中。例如，可以替换的参数有 \\[\\begin{aligned}\\tau_3&amp;=-\\tau_1-\\tau_2,\\quad\\beta_3=-\\beta_1-\\beta_2,\\quad\\gamma_{13}=-\\gamma_{11}-\\gamma_{12}\\\\\\gamma_{23}&amp;=-\\gamma_{21}-\\gamma_{22},\\quad\\gamma_{31}=-\\gamma_{11}-\\gamma_{21},\\quad\\gamma_{32}=-\\gamma_{12}-\\gamma_{22}\\\\\\gamma_{33}&amp;=-\\gamma_{13}-\\gamma_{23}=-\\gamma_{31}-\\gamma_{32}=\\gamma_{11}+\\gamma_{12}+\\gamma_{21}+\\gamma_{22}\\end{aligned}\\] 因此，替换模型中的 \\(\\tau_3,~\\beta_3,~\\gamma_{13},~\\gamma_{23},~\\gamma_{33},~\\gamma_{31}\\) 和 \\(\\gamma_{32}\\)，以获得重新参数化的模型 \\[ \\begin{bmatrix}y_{111}\\\\y_{112}\\\\y_{121}\\\\y_{131}\\\\y_{211}\\\\y_{221}\\\\y_{222}\\\\y_{231}\\\\y_{311}\\\\y_{321}\\\\y_{331}\\end{bmatrix}= \\begin{bmatrix}1&amp;1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0\\\\1&amp;1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0\\\\1&amp;1&amp;0&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0\\\\1&amp;1&amp;0&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0\\\\1&amp;1&amp;0&amp;-1&amp;-1&amp;-1&amp;-1&amp;0&amp;0\\\\1&amp;0&amp;1&amp;1&amp;0&amp;0&amp;0&amp;1&amp;0\\\\1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;1\\\\1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;1\\\\1&amp;0&amp;1&amp;-1&amp;-1&amp;0&amp;0&amp;-1&amp;-1\\\\1&amp;-1&amp;-1&amp;0&amp;0&amp;-1&amp;0&amp;-1&amp;0\\\\1&amp;-1&amp;-1&amp;0&amp;1&amp;0&amp;-1&amp;0&amp;-1\\\\1&amp;-1&amp;-1&amp;-1&amp;-1&amp;1&amp;1&amp;1&amp;1\\end{bmatrix}\\begin{bmatrix}\\mu^*\\\\\\tau_1^*\\\\\\tau_2^*\\\\\\beta_1^*\\\\\\beta_2^*\\\\\\gamma_{11}^*\\\\\\gamma_{12}^*\\\\\\gamma_{21}^*\\\\\\gamma_{22}^*\\end{bmatrix}+\\boldsymbol{\\varepsilon} \\] 其表示为 \\[\\begin{aligned}\\boldsymbol{y}=\\boldsymbol{X}^*\\boldsymbol{\\beta}^*+\\boldsymbol{\\varepsilon}\\end{aligned}\\] 表 6.1 中数据对应的零和限制正态方程的解为 \\(\\hat{\\boldsymbol{\\beta^*}}=(\\boldsymbol X^{*\\prime} \\boldsymbol X^*)^{-1}\\boldsymbol X^{*\\prime}\\boldsymbol{y}\\). 可得到 \\[\\begin{aligned} \\hat{\\boldsymbol \\beta}^{*\\prime}&amp;=[\\hat{\\mu}^*,\\hat{\\tau}_1^*,\\hat{\\tau}_2^*,\\hat{\\beta}_1^*,\\hat{\\beta}_2^*,\\hat{\\gamma}_{11}^*,\\hat{\\gamma}_{12}^*,\\hat{\\gamma}_{21}^*,\\hat{\\gamma}_{22}^*] \\\\ &amp;=[5.500,2.333,-0.833,-2.000,-0.5000,-1.333,1.667,-0.667,-0.167] \\end{aligned}\\] \\(\\boldsymbol \\beta\\) 剩余元素的估计从如下限制中获得： \\[\\begin{aligned} \\hat{{\\tau}}_3^*&amp;=-\\hat{{\\tau}}_1^*-\\hat{{\\tau}}_2^*=-1.500,\\quad\\hat{{\\beta}}_3^*=-\\hat{{\\beta}}_1^*-\\hat{{\\beta}}_2^*=2.500 \\\\ \\hat{\\gamma}_{13}^*&amp;=-\\hat{\\gamma}_{11}^*-\\hat{\\gamma}_{12}^*=-0.333,\\quad\\hat{\\gamma}_{23}^*=-\\hat{\\gamma}_{21}^*-\\hat{\\gamma}_{22}^*=0.833 \\\\ \\hat{\\gamma}_{31}^*&amp;=-\\hat{\\gamma}_{11}^*-\\hat{\\gamma}_{21}^*=2.000,\\quad\\hat{\\gamma}_{32}^*=-\\hat{\\gamma}_{12}^*-\\hat{\\gamma}_{22}^*=-1.500 \\\\ \\hat{\\gamma}_{33}^*&amp;=\\hat{\\gamma}_{11}^*+\\hat{\\gamma}_{12}^*+\\hat{\\gamma}_{21}^*+\\hat{\\gamma}_{22}^*=-0.500 \\end{aligned}\\] 关于均值模型参数 \\(\\mu_{ij}\\)，参数 \\(\\mu^*,t_i^*,\\beta_{j}^*,\\gamma^*_{ij}\\) 可以通过如下定义以满足零和限制 \\[\\mu^*=\\bar{\\mu}_{\\cdot\\cdot},\\quad\\tau_i^*=\\bar{\\mu}_{i\\cdot}-\\bar{\\mu}_{\\cdot\\cdot\\cdot},\\quad\\beta_j^*=\\bar{\\mu}_{\\cdot j}-\\bar{\\mu}_{\\cdot\\cdot\\cdot},\\quad\\mathrm{and}\\quad\\gamma_{ij}^*=\\mu_{ij}-\\bar{\\mu}_{i\\cdot}-\\bar{\\mu}_{\\cdot j}+\\bar{\\mu}_{\\cdot\\cdot}\\] 6.2.3 置零限制 另一种常用于求解双向效应模型正规方程组的重新参数化技术为，将每组中的最后一个参数设置为零 (Set-to-Zero)（选择最后一个参数是为了方便；也可以选择第一个、第二个或任何其他参数）。对于表 6.1 中数据的双向效应模型，限制为 \\[\\tau_3=0,\\beta_3=0,\\gamma_{13}=0,\\gamma_{23}=0,\\gamma_{33}=0,\\gamma_{31}=0,\\mathrm{~and~}\\gamma_{23}=0\\] 通过将上述限制条件纳入双向效应模型，得到重新参数化后的模型为 \\[\\begin{bmatrix}y_{111}\\\\y_{112}\\\\y_{121}\\\\y_{131}\\\\y_{211}\\\\y_{221}\\\\y_{222}\\\\y_{231}\\\\y_{311}\\\\y_{321}\\\\y_{331}\\end{bmatrix}=\\begin{bmatrix}1&amp;1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0\\\\1&amp;1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0\\\\1&amp;1&amp;0&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0\\\\1&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\1&amp;0&amp;1&amp;1&amp;0&amp;0&amp;0&amp;1&amp;0\\\\1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;1\\\\1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;1\\\\1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\1&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0\\\\1&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0\\\\1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\end{bmatrix}\\begin{bmatrix}\\mu^+\\\\\\tau_1^+\\\\\\tau_2^+\\\\\\beta_1^+\\\\\\beta_2^+\\\\\\gamma_{11}^+\\\\\\gamma_{12}^+\\\\\\gamma_{21}^+\\\\\\gamma_{22}^+\\end{bmatrix}+\\boldsymbol\\varepsilon \\] 可以表示为 \\(\\boldsymbol{y}=\\boldsymbol{X}^+\\boldsymbol{\\beta}^++\\boldsymbol{\\varepsilon}\\)。矩阵 \\(\\boldsymbol{X}^+\\) 是通过从双向效应模型完整设计矩阵 \\(\\boldsymbol X\\) 中删除与 \\(\\tau_3,\\beta_3,\\gamma_{31},\\gamma_{32},\\gamma_{33},\\gamma_{13},\\gamma_{23}\\) 对应的列而获得的。关于重新参数化模型设计矩阵的求解过程，置零限制比零和限制简单得多。置零限制对应的正规方程组的解为 \\[\\hat{\\boldsymbol{\\beta}}^+=(\\boldsymbol X^{+\\prime}\\boldsymbol X^{+})^{-1}\\boldsymbol X^{+\\prime}\\boldsymbol y\\] 可以得到 \\[\\begin{aligned} \\hat{\\boldsymbol{\\beta}}^{+\\prime}&amp; =[\\hat{{\\mu}}^+,\\hat{{\\tau}}_1^+,\\hat{{\\tau}}_2^+,\\hat{{\\beta}}_1^+,\\hat{{\\beta}}_2^+,\\hat{{\\gamma}}_{11}^+,\\hat{{\\gamma}}_{12}^+,\\hat{{\\gamma}}_{21}^+,\\hat{{\\gamma}}_{22}^+] \\\\ &amp;=[6.0,4.0,2.0,-2.0,-4.0,-3.5,3.0,-4.0,0.0] \\end{aligned}\\] 其余参数的估计是零，因为它们是由置零限制指定的，即， \\[\\hat{\\tau}_3^+=\\hat{\\beta}_3^+=\\hat{\\gamma}_{31}^+=\\hat{\\gamma}_{32}^+=\\hat{\\gamma}_{33}^+=\\hat{\\gamma}_{13}^+=\\hat{\\gamma}_{23}^+=0\\] 为了将参数置零限制条件与均值模型参数 \\(\\mu_{ij}\\) 关联起来，定义 \\(\\mu^+,t_i^+,\\beta_j^+,\\gamma_{ij}^+\\) \\[\\begin{aligned}\\mu^+=\\mu_{tb},&amp;\\,\\,\\tau_i^+=\\mu_{ib}-\\mu_{tb},\\,\\,\\beta_j^+=\\mu_{tj}-\\mu_{tb}\\,\\mathrm{~and~}\\,\\gamma_{ij}^+=\\mu_{ij}-\\mu_{tj}-\\mu_{ib}+\\mu_{tb}\\end{aligned}\\] 当 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 的不满秩时（即 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 是奇异的），正规方程组有多个可能的解。这是因为模型参数过多，即模型中的参数（在双向效应模型的情况下为 16 个）比可用数据（有 9 个数据单元，因此最多可以估计 9 个参数）能够唯一确定的参数要多。可以唯一估计的参数数量可被称为基本 (essential) 参数数量。为了应对过度参数化模型以及非唯一的最小二乘解，必须考虑可估性的概念，这是 6.3 节的主题。下一个例子将给出单向处理结构效应模型的两种可能的解。 6.2.4 示例 6.2：单向处理结构 表 6.2: 第 6.2.4 节中均值和效应模型的单向处理结构数据 x 这是一个单向处理结构的示例，在完全随机设计结构中具有四种处理。数据如表 6.2 所示。 \\(\\boldsymbol X^*\\) 矩阵是通过使用零和限制重新参数化模型来构造的；即，假设 \\(\\tau_1^*+\\tau_2^*+\\tau_3^*+\\tau_4^*=0\\). 由此产生的设计矩阵为 \\[\\boldsymbol X^*=\\begin{bmatrix} 1 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ \\end{bmatrix}\\] 零和限制模型的正规方程组为 \\[\\begin{bmatrix}26&amp;-1&amp;-3&amp;-2\\\\-1&amp;15&amp;8&amp;8\\\\-3&amp;8&amp;13&amp;8\\\\-2&amp;8&amp;8&amp;14\\end{bmatrix}\\begin{bmatrix}\\hat{\\mu}^*\\\\\\hat{\\tau}_1^*\\\\\\hat{\\tau}_2^*\\\\\\hat{\\tau}_3^*\\end{bmatrix}=\\begin{bmatrix}55.1\\\\-0.9\\\\-2.5\\\\-5.9\\end{bmatrix}\\] 零和限制模型的正规方程组相应最小二乘解为 \\[\\hat{\\boldsymbol{\\beta}}^*=\\begin{bmatrix}\\hat{{\\mu}}^*\\\\\\hat{{\\tau}}_1^*\\\\\\hat{{\\tau}}_2^*\\\\\\hat{{\\tau}}_3^*\\end{bmatrix}=\\begin{bmatrix}2.1510\\\\0.0204\\\\0.5690\\\\-0.4510\\end{bmatrix}\\] 以及 \\(\\hat{\\tau}_4^*=-\\hat{\\tau}_1^*-\\hat{\\tau}_2^*-\\hat{\\tau}_3^*=-0.1384\\). 就均值模型参数而言，零和限制参数可表示为 \\[\\mu^*=\\bar{\\mu}_{\\cdot},\\quad\\tau_1^*=\\mu_1-\\bar{\\mu}_{\\cdot},\\quad\\tau_2^*=\\mu_2-\\bar{\\mu}_{\\cdot},\\quad\\tau_3^*=\\mu_3-\\bar{\\mu}_{\\cdot},\\quad\\tau_4^*=\\mu_4-\\bar{\\mu}_{\\cdot}\\] 具有 \\(\\tau_ 4 ^+ = 0\\) 的置零限制设计矩阵 \\(\\boldsymbol X^+\\) 是通过在 \\(\\boldsymbol X^*\\) 中用“0”替换“-1”来构建的。置零限制模型的正规方程组为 \\[\\begin{bmatrix}26&amp;7&amp;5&amp;6\\\\7&amp;7&amp;0&amp;0\\\\5&amp;0&amp;5&amp;0\\\\6&amp;0&amp;0&amp;6\\end{bmatrix}\\begin{bmatrix}\\hat{{\\mu}}^+\\\\\\hat{{\\tau}}_1^+\\\\\\hat{{\\tau}}_2^+\\\\\\hat{{\\tau}}_3^+\\end{bmatrix}=\\begin{bmatrix}55.1\\\\15.2\\\\13.6\\\\10.2\\end{bmatrix}\\] 置零限制模型的最小二乘解为 \\[\\boldsymbol{\\hat{\\beta}}^+=\\begin{bmatrix}{\\hat{\\mu}}^+\\\\{\\hat{\\tau}}_1^+\\\\{\\hat{\\tau}}_2^+\\\\{\\hat{\\tau}}_3^+\\end{bmatrix}=\\begin{bmatrix}2.0125\\\\0.1589\\\\0.7075\\\\-0.3125\\end{bmatrix}\\] 且 \\(\\tau_ 4 ^+ = 0\\). 就均值模型参数而言，置零限制参数可表示为 \\[\\mu^+=\\mu_4,\\quad\\tau_1^+=\\mu_1-\\mu_4,\\quad\\tau_2^+=\\mu_2-\\mu_4,\\quad\\tau_3^+=\\mu_3-\\mu_4,\\quad\\tau_4^+=\\mu_4-\\mu_4=0\\] 需要估计的最后一个参数是总体方差 \\(\\sigma^2\\). 基于 \\(\\boldsymbol \\beta\\) 最小二乘解的 \\(\\sigma^2\\) 的估计为 \\[\\begin{align} \\hat{\\sigma}^2&amp; =\\frac{1}{n-r}(\\boldsymbol y-X\\hat{\\boldsymbol \\beta})&#39;(\\boldsymbol y-\\boldsymbol X\\hat{\\boldsymbol \\beta}) \\\\ &amp;=\\frac1{n-r}\\sum_{i=1}^n{(y_i-\\hat{\\beta}_0-\\hat{\\beta}_1x_{i1}-\\hat{\\beta}_2x_{i2}-\\cdots-\\hat{\\beta}_{p-1}x_{ip-1})^2} \\tag{6.11} \\end{align}\\] 其中 \\(r=\\operatorname{rank}(\\boldsymbol X)\\). 如果假设误差独立分布，且前四阶矩等于正态分布的前四阶矩，那么 \\(\\hat \\sigma^2\\) 是 \\(\\sigma^2\\) 的最佳二次无偏估计 (best quadratic unbiased estimate). 如果误差也服从正态分布，那么 \\(\\hat \\sigma^2\\) 是 \\(\\sigma^2\\) 的最佳无偏估计 (best unbiased estimate)，且 \\((n - r)\\hat \\sigma^2 /\\sigma^2\\) 的抽样分布是自由度为 \\(n - r\\) 的中心卡方分布。 6.3 可估性和连通的设计 当过度指定模型或非满秩模型用于实验情况时，存在许多不同的最小二乘解（实际上有无限多个解）。如果两名研究人员分析上述两个数据集，一个使用零和限制，另一个使用置零限制，他们可能会得出不同的结论。对于上一节中的双向示例，\\(\\tau_2^* = -0.833, \\tau_2^+ = 2.000\\)；因此，一位研究人员可能会说 \\(\\tau_2\\) 很可能为负，而另一位研究人员可能会说 \\(\\tau_2\\) 很可能为正——而这两种说法都是错误的。 6.3.1 可估函数 由于两位研究人员都在分析相同的数据集，因此他们似乎应该只考虑对两个重新参数化模型具有相同估计的参数或参数的函数。这种参数函数称为参数的可估函数 (estimable functions of the parameters). 定义 6.1 ♦ 参数或参数的函数 \\(f(\\boldsymbol \\beta)\\) 是可估的，当且仅当参数或参数的函数的估计值对于最小二乘解的选择是不变的；也就是说，无论使用正规方程组的哪个解，估计值都是相同的。 如果两位研究人员对参数的可估函数进行了估计，即使他们采用了两种不同的最小二乘解，他们也会得到相同的估计值。因此，他们对于参数的可估函数会得出相同的结论。对于矩阵模型，\\(\\boldsymbol \\beta\\) 的线性可估函数表现为参数向量的线性组合，如 \\(\\boldsymbol a^\\prime \\boldsymbol \\beta\\)，其中 \\(\\boldsymbol a^\\prime\\) 是一个 p × 1 的常数向量。线性函数 \\(\\boldsymbol a^\\prime \\boldsymbol \\beta\\) 是可估的，当且仅当存在向量 \\(r\\)，使得 \\(\\boldsymbol a =\\boldsymbol X ^\\prime \\boldsymbol X r\\). 每个形如 \\(\\boldsymbol x^\\prime_i \\boldsymbol \\beta\\) 的函数都是可估的，其中 \\(\\boldsymbol x^\\prime_i\\) 是 \\(\\boldsymbol X\\) 的第 \\(i\\) 行。此外，\\(\\boldsymbol x^\\prime_i \\boldsymbol \\beta\\) 的任何线性组合都是可估的函数。考虑 6.2 节中单向示例的两个解。由于每个参数 \\(\\mu,\\tau_1,\\tau_2,\\tau_3,\\tau_4\\) 都有两个不同的解，因此这些参数被认为是不可估的 (nonestimable). 但是，通过计算每种方法关于 \\(\\mu + \\tau_i\\) 的估计值，可以发现 \\[\\hat{\\mu}^*+\\hat{\\tau}_i^*=\\hat{\\mu}^++\\hat{\\tau}_i^+,\\quad i=1,2,3,4\\] 证明 \\(\\mu + \\tau_i\\) 是参数的可估函数。 \\(\\tau_i\\) 的所有对比，如差异 \\({\\tau}_1{-\\tau}_2{,\\tau}_1{-\\tau}_3{,\\tau}_2{-\\tau}_3\\) 或者 \\(\\sum_{i=1}^tc_i\\tau_i\\) 其中 \\(\\sum_{i=1}^tc_i=0\\)，可证明是单向模型的可估函数。 对于双向效应模型，一些可估函数为 \\(\\mu+\\tau_i+\\beta_j+\\gamma_{ij},\\quad\\gamma_{ij}-\\gamma_{ij^\\prime}-\\gamma_{i^\\prime j}+\\gamma_{i^\\prime j^\\prime},\\quad\\beta_j-\\beta_j+\\bar{\\gamma}_{\\cdot j}-\\bar{\\gamma}_{\\cdot j^\\prime},\\quad\\tau_i-\\tau_i+\\bar{\\gamma}_{i\\cdot}-\\bar{\\gamma}_{i^\\prime\\cdot}\\) 可估函数在第 10 章进行了更详细的讨论。这里需记住的重点是可估函数的定义。从数据集中进行推断时，必须只考虑可估的参数函数，因为它们是参数的函数，其估计值不依赖于选择的最小二乘解。SAS®-GLM 和 SAS®-Mixed 都会检查所请求估计的参数或参数函数是否确实是可估的。如果参数或参数函数不可估，则不提供估计值。 6.3.2 连通性 与可估函数相关的另一个概念是双向处理结构的连通性 (connectedness). 如果可以假设行处理和列处理的水平之间没有交互作用，那么可以将处理组合平均值建模为 \\[\\begin{equation} \\mu_{ij}=\\mu+\\tau_i+\\beta_j,\\quad i=1,2,\\ldots,b,j=1,2,\\ldots,t \\tag{6.12} \\end{equation}\\] 如果双向处理结构中的数据以这样的方式出现在双向单元格中，即对于模型 (6.12) 中的所有 \\(j\\ne j^\\prime\\) 以及 \\(i\\ne i^\\prime\\)，\\(\\beta_j-\\beta_{j^\\prime}\\) 和 \\(\\tau_i-\\tau_{i^\\prime}\\) 都是可估的，则该双向处理结构被称为连通的 (connected)。图 6.1 中的安排 I 是一个连通的实验，而安排 II 不是。例如，使用安排 I， \\[\\beta_1-\\beta_2=(\\mu+\\tau_1+\\beta_1)-(\\mu+\\tau_1+\\beta_5)+(\\mu+\\tau_2+\\beta_5)-(\\mu+\\tau_2+\\beta_2)\\] 我们可以得到单元格均值的线性组合，因此 \\(\\beta_1-\\beta_2\\) 是可估的。对于安排 II，没有这样的单元格均值的线性组合可以得到 \\(\\beta_1-\\beta_2\\)，因此 \\(\\beta_1-\\beta_2\\) 是不可估的。下一节将讨论关于参数的可估函数的假设检验。 图 6.1: 连通和非连通的双向处理结构 6.4 关于线性模型参数的检验假设 对于线性模型中参数线性函数的假设检验，有多种方法可以开发适当的统计量。这里使用的方法用矩阵表示法，相当于条件误差原理（第 1 章）和似然比统计量。讨论仅限于检验关于参数的可估函数的假设。特别是，考虑检验假设 \\[\\begin{equation} H_0{:\\boldsymbol{H\\beta}}=\\boldsymbol{h}\\mathrm{~vs~}H_a{:\\boldsymbol{H\\beta}}\\neq\\boldsymbol{h} \\tag{6.13} \\end{equation}\\] 其中线性组合 \\(\\boldsymbol{H\\beta}\\) 是 \\(\\boldsymbol \\beta\\) 的可估函数，\\(\\boldsymbol H\\) 是秩为 \\(q\\) 的 q × p矩阵（即，\\(\\boldsymbol H\\) 的所有行是线性无关的）。相应的检验统计量为 \\[\\begin{equation} F_c=\\frac{SSH_0/q}{\\hat{\\sigma}^2} \\tag{6.14} \\end{equation}\\] 其中 \\(\\hat \\sigma^2\\) 由式 (6.11) 给出，并且 \\[\\begin{equation} SSH_0=(\\boldsymbol H\\hat{\\boldsymbol{\\beta}}-\\boldsymbol h)^{\\prime}\\left[\\boldsymbol H(\\boldsymbol X^{\\prime}\\boldsymbol X)^{-}\\boldsymbol H^{\\prime}\\right]^{-1}(\\boldsymbol H\\hat{\\boldsymbol{\\beta}}-\\boldsymbol h) \\tag{6.15} \\end{equation}\\] 这被称为因偏离零假设而产生的平方和 (sum of squares due to deviations from the null hypothesis)（记号 “\\((\\boldsymbol X^{\\prime}\\boldsymbol X)^{-}\\)” 表示矩阵 \\(\\boldsymbol X^{\\prime}\\boldsymbol X\\) 的广义逆，Graybill, 1976）。在误差向量元素为 \\(i.i.d.\\,N(0,\\sigma^2)\\) 的假设下，\\(F_c\\) 服从自由度为 \\(q,n-r\\) 的 \\(F\\) 分布。 式 (6.13) 中的假设总是可以用重新参数模型 \\(\\boldsymbol{y}=\\boldsymbol{X}^*\\boldsymbol{\\beta}^*+\\boldsymbol \\varepsilon\\) 来等价地表述为下式，其中 \\(\\boldsymbol X^{*\\prime}\\boldsymbol X^*\\) 是非奇异的 \\[H_0{:}H^*\\boldsymbol{\\beta}^*=\\boldsymbol{h}^*\\mathrm{~vs~}H_a{:}H^*\\boldsymbol{\\beta}^*\\neq\\boldsymbol{h}^*\\] 则式 (6.15) 的 \\(SSH_0\\) 可计算为 \\[SSH_0=(\\boldsymbol H^*\\hat{\\boldsymbol{\\beta}}^*-\\boldsymbol{h}^*)^{\\prime}[\\boldsymbol H^*(\\boldsymbol X^{*\\prime}\\boldsymbol X^*)^{-1}(\\boldsymbol{H}^*{}^{\\prime}\\hat{\\boldsymbol{\\beta}}^*-\\boldsymbol{h}^*)]\\] 对于单向模型，在原始效应模型中检验假设 \\[\\begin{aligned}H_0\\colon\\tau_1=\\tau_2=\\cdots=\\tau_t\\text{ vs }H_a\\colon\\tau_i\\neq\\tau_{i&#39;}\\quad\\text{for some }i\\neq i&#39;\\end{aligned}\\] 相当于在置零重新参数化模型中检验 \\[\\begin{aligned}H_0\\colon\\tau_1^*=\\tau_2^*=&amp;\\cdots=\\tau_{t-1}^*=0\\text{ vs }H_a{:}\\tau_i^*\\neq0\\quad\\text{for some }i\\leq t\\text{ -1}\\end{aligned}\\] 对于示例 6.2 关于 \\(\\boldsymbol \\beta^*\\) 的零假设是 \\[H_0{:}\\begin{bmatrix}0&amp;1&amp;0&amp;0\\\\0&amp;0&amp;1&amp;0\\\\0&amp;0&amp;0&amp;1\\end{bmatrix}\\begin{bmatrix}\\mu^*\\\\\\tau_1^*\\\\\\tau_2^*\\\\\\tau_3^*\\end{bmatrix}=0\\quad\\mathrm{or}\\quad \\boldsymbol H^*\\boldsymbol \\beta^*=0\\] 偏离 \\(H_0\\) 而产生的平方和为 \\[SSH_0=(\\hat{\\tau}_1^*\\quad\\hat{\\tau}_1^*\\quad\\hat{\\tau}_1^*)\\,\\boldsymbol{Z}^{-1}\\begin{bmatrix}\\hat{\\tau}_1^*\\\\\\hat{\\tau}_2^*\\\\\\hat{\\tau}_3^*\\end{bmatrix}\\] 其中 \\(\\boldsymbol{Z}=\\boldsymbol{H}^*(\\boldsymbol{X}^*\\boldsymbol{&#39;}\\boldsymbol{X}^*)^{-1}\\boldsymbol{H}^*\\boldsymbol{&#39;}\\). 这是矩阵 \\((\\boldsymbol{X}^*\\boldsymbol{&#39;}\\boldsymbol{X}^*)^{-1}\\) 中与 \\(\\tau_1,\\tau_2,\\tau_3)\\) 相关的行和列的部分。 可估函数 \\(\\boldsymbol a^\\prime \\boldsymbol \\beta\\) 的一个 \\((1-\\alpha)100\\%\\) 置信区间为 \\[\\boldsymbol a^{\\prime}\\hat{\\boldsymbol \\beta}-[t_{\\alpha/2,n-p}]S_{\\boldsymbol a^{\\prime}\\hat{\\boldsymbol \\beta}}\\leq a^{\\prime}\\boldsymbol{\\beta}\\leq a^{\\prime}\\hat{\\beta}+[t_{\\alpha/2,n-p}]S_{\\boldsymbol a^{\\prime}\\hat{\\boldsymbol \\beta}}\\] 其中 \\(S_{\\boldsymbol a&#39;\\boldsymbol{\\beta}}^2=\\hat{\\sigma}^2\\boldsymbol{a&#39;}(\\boldsymbol{X&#39;}\\boldsymbol{X})^{-1}\\boldsymbol{a}\\). 通过使用第 3 章中讨论的多重比较程序，可以构造关于几个可估函数的同时置信区间 (simultaneous confidence intervals). 6.5 总体边际均值 在通过方差分析对交叉分类数据集进行分析后，实验者通常对估计特定效应或单元格均值感兴趣。总体边际均值 (population marginal means) 被定义为在特定类别上平均化的参数线性组合，就好像每个单元格中都有一个观测值一样 (Searle et al., 1980). 如果每个单元格中至少有一个观测值，那么所有的总体边际均值都是可估的，而如果某些单元格为空，则它们不一定可估。这个定义不依赖于单元格中的样本量。如果数据代表单元格的比例抽样，那么实验者可能希望考虑单元格均值的加权平均值，其中权重由样本量给出（参见第 10 章）。或者，可能需要使用其他加权方案来对各个单元格进行平均。本节末尾提供了一个示例，以演示不同的可能性。 对于完全随机设计的单向处理结构，第 \\(i\\) 个处理的总体边际平均值为 \\(\\mu+\\tau_i=\\mu_i\\)，并由下式估计 \\[\\widehat{\\mu+\\tau_i}=\\hat{\\mu}+\\hat{\\tau_i}\\] 其中 \\(\\hat \\mu,\\hat \\tau_i\\) 是从正规方程组的任何解得到的。这些估计值被称为总体边际均值估计 (estimated population marginal means). 对于完全随机设计中的双向处理结构，第 \\((i,j)\\) 个单元格的总体边际平均值为 \\(\\begin{aligned}\\mu_{ij}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij}\\end{aligned}\\). 第 \\(i\\) 行的总体边际均值是该行中 \\(\\mu_{ij}\\) 的平均值，或者 \\[\\bar{\\mu}_{i\\cdot}=\\sum_{j=1}^b\\frac{\\mu_{ij}}b=\\mu+\\tau_i+\\bar{\\beta}_{\\cdot}+\\bar{\\gamma}_{i\\cdot}\\] 第 \\(j\\) 列的总体边际均值是该列中 \\(\\mu_{ij}\\) 的平均值，或者 \\[\\bar{{\\mu}}_{\\cdot j}=\\sum_{i=1}^t\\frac{{\\mu}_{ij}}t={\\mu}+\\bar{{\\tau}}_{\\cdot}+{\\beta}_j+\\bar{{\\gamma}}_{\\cdot j}\\] 总体边际均值估计分别为 \\[\\begin{aligned} \\hat{{\\mu}}_{ij} &amp;=\\hat{\\mu}+\\hat{\\tau}_i+\\hat{\\beta}_j+\\hat{\\gamma}_{ij}, \\\\ \\hat{\\bar{{\\mu}}}_{i\\cdot} &amp;=\\hat{\\mu}+\\hat{\\tau}_i+\\sum_{j=1}^b\\frac{\\hat{\\beta}_j}b+\\sum_{j=1}^b\\frac{\\hat{\\gamma}_{ij}}b,\\\\ \\hat{\\bar{{\\mu}}}_{\\cdot j}&amp;=\\hat{{\\mu}}+\\sum_{i=1}^t\\frac{\\hat{{\\tau}}_i}t+\\hat{{\\beta}}_j+\\sum_{i=1}^t\\frac{\\hat{{\\gamma}}_{ij}}t \\end{aligned}\\] 这些估计对于任何可能的最小二乘解都是唯一的 \\[\\hat{\\mu},\\hat{\\tau}_1,\\hat{\\tau}_2,\\ldots,\\hat{\\tau}_t,\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_b,\\hat{\\gamma}_{11},\\hat{\\gamma}_{12},\\ldots,\\hat{\\gamma}_{tb}\\] 根据零和限制模型，表 6.1 中双向示例的总体边际平均值 \\(\\hat{\\bar\\mu}_{1\\cdot}\\) 的估计为 \\[\\begin{aligned} \\hat{\\bar{\\mu}}_{1\\cdot}&amp; =\\hat{\\mu}^*+\\hat{\\tau}_1^*+\\frac{\\hat{\\beta}_1^*+\\hat{\\beta}_2^*+\\hat{\\beta}_3^*}3+\\frac{\\hat{\\gamma}_{11}^*+\\hat{\\gamma}_{12}^*+\\hat{\\gamma}_{13}^*}3 \\\\ &amp;=5.500+2.333+\\frac{-2.000-0.500+2.500}3+\\frac{-1.333+1.667-0.333}3 \\\\ &amp;=7.833 \\end{aligned}\\] 当按预期使用置零限制的最小二乘解时，可以获得与 \\(\\hat{\\bar\\mu}_{1\\cdot}\\) 相同的值，因为 \\({\\bar\\mu}_{1\\cdot}\\) 在这个例子中是可估的。 当没有空单元格时，所有的总体边际均值都是可估的。如果有空单元格，那么任何涉及一个或多个缺失单元格的总体边际均值都是不可估的。例如，如果 \\((2,2)\\) 单元格在 2×2 处理结构中缺失，则没有关于 \\(\\mu_{22}\\) 的信息，因此 \\(\\mu_{22}\\) 是不可估的。第 2 列的总体边际均值为 \\[\\bar{\\mu}_{\\cdot 2}=\\frac{\\mu_{12}+\\mu_{22}}2\\] 由于 \\(\\bar{\\mu}_{\\cdot 2}\\) 依赖于 \\(\\mu_{22}\\)，因此 \\(\\bar{\\mu}_{\\cdot 2}\\) 是不可估的（\\(\\bar{\\mu}_{2\\cdot }\\) 也不可估）。 任何可估的总体边际均值都可以表示为重新参数化模型参数向量元素的线性组合；也就是说，对于 \\(\\boldsymbol a\\) 的适当选择，总体边际均值可以表示为 \\(\\boldsymbol a^\\prime\\boldsymbol \\beta^*\\). 总体边际均值估计的方差为 \\[\\mathrm{Var}(\\boldsymbol a^{\\prime}\\hat{\\boldsymbol{\\beta}^*})=\\sigma^2 \\boldsymbol a^{\\prime}(\\boldsymbol X^{*\\prime}\\boldsymbol X^*)^{-1}\\boldsymbol a\\] 且 \\(\\boldsymbol a^\\prime\\boldsymbol \\beta^*\\) 的标准误估计为 \\[\\widehat{s.e.}(\\boldsymbol a^{\\prime}\\hat{\\boldsymbol \\beta}^*)=\\hat{\\sigma}\\sqrt{\\boldsymbol a^{\\prime}(\\boldsymbol X^{*\\prime} \\boldsymbol X^*)^{-1}\\boldsymbol a}\\] 对于置零限制的单向模型，总体边际均值估计为 \\[\\widehat{\\mu+\\tau_i}=\\hat{\\mu}^*+\\hat{\\tau}_i^*,\\quad i=1,2,\\ldots,t-1\\] 且 \\[\\widehat{{\\mu}+{\\tau}_t}=\\hat{{\\mu}}^*\\] 这些总体边际均值估计的方差为 \\[\\mathrm{Var}(\\widehat{\\mu+\\tau_i})=\\mathrm{Var}(\\hat{\\mu}^*)+2\\mathrm{Cov}(\\hat{\\mu}^*,\\hat{\\tau}_i^*)+\\mathrm{Var}(\\hat{\\tau}_i^*)\\quad i=1,2,\\ldots,t-1\\] 且 \\[\\mathrm{Var}(\\widehat{\\mu+\\tau_t})=\\mathrm{Var}(\\hat{\\mu}^*)\\] 表 6.3: 双向处理结构的平均绩点数据 x 表 6.3 中的数据是一所学校学生样本的平均绩点 (GPA)，学生按学年和性别进行分类。双向模型 \\[y_{ijk}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij}+\\varepsilon_{ijk}\\quad i=1,2,3,4,\\quad j=1,2,\\quad k=1,2,\\ldots,n_{ij}\\] 用于描述数据，其中 \\(y_{ijk}\\) 是 GPA 值，\\(\\tau_i\\) 是第 \\(i\\) 年的效应，\\(\\beta_j\\) 是第 \\(j\\) 个性别的效应，\\(\\gamma_{ij}\\) 是交互作用效应。参数的置零最小二乘解如表 6.4 所示。对于那些置零的参数，标准误估计为零。第 \\(1\\) 学年和女性的单元格均值估计为 \\[\\hat{\\mu}_{1f}=\\hat{\\mu}+\\hat{\\tau}_1+\\hat{\\beta}_f+\\hat{\\gamma}_{1f}=3.333-0.133-0.033+0.205=3.372\\] 其余单元格均值可类似计算，如表 6.6 所示。表 6.6 和 6.7 提供了边际年份和边际性别的均值估计。 表 6.4: 双向处理结构中 GPA 数据的最小二乘解 x 表 6.5: 单元格均值及标准误估计 x 表 6.6: 跨性别水平的年份原始均值、最小二乘均值和加权平均值 x 表 6.7: 跨年份水平的女性和男性平均原始均值、最小二乘均值和加权平均值 x 原始均值 (raw measn) 是各个单元格均值的加权平均值，使用单元格中的观测数量作为权重。例如，第 1 年的原始均值或未调整的均值 (unadjusted mean) 计算为 \\[\\hat{\\bar{\\mu}}_{1\\cdot}=\\frac{7^*3.371+5^*3.200}{7+5}=3.300\\] 年份和性别效应的最小二乘均值 (least square means) 是相应单元格均值的未加权平均值，第 1 年的最小二乘均值为 \\[\\hat{\\bar{\\mu}}_{1\\cdot}=\\frac{3.371+3.200}2=3.286\\] 表 6.8: 平均成绩研究中的学生在班级中的分布 x 在论述边际年份或边际性别效应时，人们可能想要使用原始均值（根据观察到的单元格大小进行加权）或最小二乘均值（每个单元格均值具有相同的权重，就好像单元格大小相同一样）。对于设计的实验，最小二乘均值可能是人们感兴趣的均值，因为您可能设计了一个每个单元格中观测数量相等的实验，因此，即使某些数据可能缺失，提供假设单元格大小相等的边际均值估计也是一个合理的解决方案。但是，如果数据来自观察性研究，则未加权的均值可能不是人们感兴趣的边际均值。如果数据来自总体的简单随机样本，那么单元格大小可能反映了总体的比例成员结构 (proportional membership structure). 如果情况确实如此，那么原始均值或按样本量加权的均值就是感兴趣的边际均值。但如果单元格中的样本量不代表总体结构，那么最小二乘均值和原始均值都不是感兴趣的指标。当总体中的某些部分因设计或偶然原因被过度采样或采样不足时，就会出现这种现象。当已知总体结构，即每个单元格的总体比例已知时，通过使用已知的总体比例作为权重，可以获得感兴趣的边际均值。例如，假设研究每年中男性和女性的比例如表 6.8 所示。使用权重估计的第 1 年的边际均值为： \\[\\hat{\\tilde{\\mu}}_{1\\cdot}=\\frac{11^*3.371+22^*3.200}{33}=3.257\\] 使用权重对女性所有年份的边际均值估计为 \\[\\hat{\\tilde{\\mu}}_{\\cdot f}=\\frac{11^*3.371+12^*3.180+10^*3.475+8^*3.300}{41}=3.327\\] 使用权重对男性所有年份的边际均值估计为 \\[\\hat{\\tilde{\\mu}}_{\\cdot m}=\\frac{22^*3.200+14^*3.300+13^*3.267+10^*3.333}{59}=3.261\\] 计算几种调整的均值并从中选择你喜欢的值并不是问题，但有必要尽可能准确地指定总体结构中的比例，然后使用这些权重计算的边际平均估计。这可以通过允许使用 estimate 语句的软件包来完成，其中提供了所需边际均值的估计和标准误的估计。表 6.9 包含使用 SAS-GLM 程序的代码，以表 6.8 中的比例作为权重提供边际均值的估计。 表 6.9: 带 estimate 语句的SAS®-GLM代码，使用表 6.8 中的权重提供性别和年份水平的总体边际均值估计 x 6.6 结束语 本章仅供对理论背景感兴趣的人阅读，介绍了最小二乘估计程序，并讨论了可估性的重要概念。还讨论了总体边际均值的定义和估计。本章为那些想开发供自己使用的统计软件的人提供了通用公式。 6.7 练习 "],["chap7.html", "第 7 章 均衡双向处理结构 7.1 模型定义和假设 7.2 参数估计 7.3 交互作用及它们的重要性 7.4 主效应 7.5 计算机分析 7.6 结束语 7.7 练习", " 第 7 章 均衡双向处理结构 “A judicious man looks on statistics not to get knowledge, but to save himself from having ignorance foisted on him.” - Thomas Carlyle 第 4 章和第 5 章讨论了如何分析实验的设计结构。本章将讨论分析实验的处理结构的方法。特别是，本章将重点分析双向交叉分类的处理结构。假设存在两组处理 \\(T_1,T_2,\\cdots,T_t\\) 和 \\(B_1,B_2,\\cdots,B_b\\). 每个 \\(T\\) 处理要与每个 \\(B\\) 处理结合，并分配给一个实验单元。为方便起见，假设实验单元完全随机地分配给处理组合。或者，假设从大量实验单元中随机抽取了一个样本，并且可以根据 \\(T_1,T_2,\\cdots,T_t\\) 和 \\(B_1,B_2,\\cdots,B_b\\) 的值将样本中的实验单元分配给不同的类别。在这两种情况下，在交叉分类的处理结构中，对总共 \\(bt\\) 个总体进行了抽样。 分析实验的处理结构和设计结构通常是独立进行的，除非是区组设计和重复测量设计，以及本书后面章节中考虑的这些设计的变体。因此，无论实验单元是分组为完全区组、均衡的不完全区组、拉丁方还是其他分组方式，处理结构的分析对于大多数标准设计来说都是相似的，几乎没有区别。由于对 \\(bt\\) 个总体进行了抽样，因此在检验等处理均值的假设时，平方和的自由度为 \\(bt-1\\)，即假设 \\(\\mu_{11}=\\mu_{12}=\\cdots=\\mu_{tb}\\). 本章考虑了处理平方和的不同划分，以检验实验者通常感兴趣的不同类型的假设。 7.1 模型定义和假设 7.1.1 均值模型 均值模型 (means model) 定义为 \\[\\begin{equation} Y_{ijk}=\\mu_{ij}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,b,\\quad k=1,2,\\ldots,n \\tag{7.1} \\end{equation}\\] 其中假设 \\(\\varepsilon_{ijk}\\sim i.i.d.N(0,\\sigma^2),i=1,2,\\ldots,t,j=1,2,\\ldots,b,k=1,2,\\ldots,n\\)，且当处理组合 \\((T_i,B_j)\\) 被分配到随机选择的实验单元时，\\(\\mu_{ij}\\) 是预期的响应。 7.1.2 效应模型 具有双向处理结构的实验中另一个常见模型称为效应模型 (effects model)，其由式 (7.1) 定义，且 \\(\\mu_{ij}\\) 替换为 \\[\\begin{equation} \\mu_{ij}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij},\\quad i=1,2,\\ldots,t,j=1,2,\\ldots,b \\tag{7.2} \\end{equation}\\] 从哲学角度看，效应模型在直觉上很有吸引力，因为它可能是基于这样的假设：\\(\\mu\\) 代表某种总体平均效应，\\(\\tau_i\\) 代表将 \\(T_i\\) 分配给实验单元后对均值的效应，\\(\\beta_j\\) 代表将 \\(B_j\\) 分配给实验单元后的效应，而 \\(\\gamma_{ij}\\) 代表同时使用 \\(T_i\\) 和 \\(B_j\\) 时可能对实验单元产生的任何额外的正面或负面效应。然而，如第 6 章所指出的，效应模型存在一些可估性问题。下面将讨论这两种模型。 7.2 参数估计 在大多数情况下，\\(\\sigma^2\\) 的估计仅来自对实验设计结构的分析。然而，在某些情况下，实验者可能能够对 \\(\\mu_{ij}\\) 或处理效果做出某些假设，这些假设可能会提供一些关于 \\(\\sigma^2\\) 的额外信息。例如，如果实验者知道 \\(\\mu_{11}=\\mu_{12}\\)，那么可以将来自均值为 \\(\\mu_{11}\\) 和 \\(\\mu_{12}\\) 的总体的样本组合起来，以提供用于估计 \\(\\sigma^2\\) 的额外自由度。在这种情况下，相应的单自由度平方和由 \\(n(\\bar{y}_{11\\cdot}-\\bar{y}_{12\\cdot})^2/2\\) 给出。 大多数实验者不会倾向于相信 \\(\\mu_{11}=\\mu_{12}\\)，但还有其他可能合适的信念 (beliefs). 其中一个信念是，两组处理的效应是加性的 (additive). 也就是说，两组处理不会发生交互 (interact). 如果这是真的，那么额外的信息将可用于估计 \\(\\sigma^2\\). 如果将 \\(bt\\) 种组合视为 \\(bt\\) 个不同的处理，则第 1 章至第 3 章中针对单向处理结构提供的所有讨论都适用于双向处理结构；也就是说，比如 \\([\\mu_{11},\\mu_{12},\\ldots,\\mu_{1b},\\ldots,\\mu_{t1},\\mu_{t2},\\ldots,\\mu_{tb}]=[\\mu_1,\\mu_{2},\\ldots,\\mu_{tb}]\\). 因此，均值模型中参数的最佳估计为 \\[\\hat{\\mu}_{ij}=\\frac1n\\sum_{k=1}^ny_{ijk}=\\bar{y}_{ij\\cdot},\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,b\\] 以及 \\[\\hat{\\sigma}^2=\\frac1{N-bt}\\sum_{ijk}(y_{ijk}-\\bar{y}_{ij\\cdot})^2\\] 其中 \\(N=nbt\\). \\(\\hat \\mu_{ij}\\) 的抽样分布为 \\(N(\\mu_{ij},\\sigma^2/n)\\)，其中 \\(i=1,2\\cdots,t,\\,j=1,2,\\cdots,b\\). 且 \\((N-bt)\\hat{\\sigma}^2/\\sigma^2\\) 的抽样分布为 \\(\\chi^2(N^-bt)\\). 另外，\\(\\hat{\\mu}_{11},\\hat{\\mu}_{12},\\ldots,\\hat{\\mu}_{tb}\\) 和 \\(\\sigma^2\\) 有独立的概率分布。 大多数情况下，实验者想要回答以下问题： \\(T\\) 处理如何影响响应？ \\(B\\) 处理如何影响响应？ 7.3 交互作用及它们的重要性 为了很好地回答上述问题，实验者必须首先确定这两组处理是否发生交互。交互作用假设 (interaction hypothesis) 可以用几种等效的方式来表述。下面给出了其中一些。 \\(H_0\\colon{{\\mu}}_{ij}-\\mu_{ij}=\\mu_{i&#39;j}-\\mu_{i&#39;j&#39;}\\) 对于所有的 \\(i\\ne i&#39;\\) 和 \\(j\\ne j&#39;\\) \\(H_0\\colon\\mu_{ij}-\\mu_{i&#39;j}=\\mu_{ij&#39;}-\\mu_{i&#39;j&#39;}\\) 对于所有的 \\(i\\ne i&#39;\\) 和 \\(j\\ne j&#39;\\) \\(H_0\\colon{\\mu_{ij}-\\mu_{i&#39;j}-\\mu_{ij&#39;}+\\mu_{i&#39;j&#39;}=0}\\) 对于所有的 \\(i\\ne i&#39;\\) 和 \\(j\\ne j&#39;\\) \\(H_0\\colon\\mu_{ij}=\\mu+\\tau_i+\\beta_j\\) 对于所有的 \\(i\\) 和 \\(j\\) 以及一些参数集 \\({\\mu},{\\tau}_1,{\\tau}_2,...,{\\tau}_t,{\\beta}_1,{\\beta}_2,\\cdots,{\\beta}_b\\) 1-4 中的每一个都意味着两组处理效应之间没有交互作用。对 1 的解释是，任何一对 B 处理之间的差异都是相同的，无论它们与哪种 T 处理相结合。类似地，对 2 的解释是，任何一对 T 处理之间的差异都是相同的，无论它们与哪种 B 处理相结合。1 和 2 在代数上都等价于 3，3 通常被称为所有可能的二乘二表格差异的集合 (the set of all possible two by two table differences). 对 4 的解释是，这两组处理的效应是加性的。如果 1-4 中的任何一个是真的，那么说明 T 处理和 B 处理之间没有相互作用。 如果两组处理不发生交互，则一组处理的效应可以如此进行最佳比较：对另一组处理的效应进行平均之后。这样的比较是最佳的，是因为平均化增加了比较两个或多个处理效应的统计功效，或者等价地，平均化对效应差异给出了尽可能短的置信区间。如果两组处理发生交互，那么一组处理效应之间的差异将依赖于与它们结合的第二组处理的水平，这会使实验分析稍微复杂一些。 7.4 主效应 如果实验者得出结论，这两组处理没有交互作用，那么关于主效应 (main effects) 的假设就可以进行检验。这些假设可以写成： \\[\\begin{aligned}H_{01}\\colon\\bar{\\mu}_{1\\cdot}=\\bar{\\mu}_{2\\cdot}=\\cdots=\\bar{\\mu}_{t\\cdot}\\quad\\text{and}\\quad H_{02}\\colon\\bar{\\mu}_{\\cdot1}=\\bar{\\mu}_{\\cdot2}=\\cdots=\\bar{\\mu}_{\\cdot b}\\end{aligned}\\] 即使实验中存在交互作用，上述两个假设仍然可以检验。然而，这两种情况对检验结果的解释将截然不同。 7.5 计算机分析 大多数统计分析包都会自动给出前两节中描述的两个主效应假设和交互作用假设的检验，前提是指定了以下形式的模型 \\[y=T\\mathrm{~}B\\mathrm{~}T\\times B\\] 大多还具有一个选项，允许用户通过使用第 3 章中讨论的一个或多个多重比较程序来相互比较主效应均值。大多数软件包还允许用户指定和检验用户自己选择的对比。如果确定两组处理发生交互，则实验者可能想要比较所有 \\(bt\\) 个处理组合两两之间的差异。如果所使用的统计包无法进行此类比较，则可以手动完成此操作。或者，如果统计分析包不允许对 \\(T\\times B\\) 单元格均值进行多重比较，通常可以通过一些技巧使其能够完成。为此，可以在数据文件中包含一个新的识别变量，使该新变量具有 \\(bt\\) 个不同的值，对应 \\(bt\\) 个处理组合。这个新变量可用于重新分析数据，作为单因素处理结构，从而得出双向单元格均值的多重比较。实验者可能还感兴趣于如何对多重检验进行调整，如第 3 章所述。 7.6 结束语 当处理以双向处理结构进行安排时，通常会检验三个基本的前提假设。其中最重要的是交互作用假设。如果没有交互作用，那么通过对其他处理水平的平均化，可以最好地比较每种处理的主效应。如果存在交互作用，那么在比较第一种处理的效应时，实验者必须小心以确定对第二种处理的水平进行平均是否有意义。通常这样做是没有意义的。 7.7 练习 "],["chap8.html", "第 8 章 案例研究：均衡双向实验的完整分析 8.1 主效应均值对比 8.2 交互对比 8.3 油漆铺路示例 8.4 分析定量处理因素 8.5 多重检验 8.6 结束语 8.7 练习", " 第 8 章 案例研究：均衡双向实验的完整分析 “All life is an experiment. The more experiments you make, the better.” - Ralph Waldo Emerson 在上一章中，我们假设当处理 T 和处理 B 在实验中发生交互时，实验者将想要比较在处理 B 的每一种可能性下处理 T 的效应，反之亦然。在许多情况下，交互作用并非在实验中随处发生——通常只有一两种处理组合会导致交互作用。在其他情况下，一种处理的可能性可能与第二种处理的可能性发生交互，而第一种处理的所有其他可能性都不与第二种处理的任何可能性发生交互。 为了对具有交互作用的数据进行更完整的分析，确定交互作用在数据中的位置是有帮助的。例如，如果已知实验中的所有交互作用都是由处理 T 的其中一种可能性（通常是对照）引起的，那么在对处理 B 的所有可能性进行平均后，仍然可以比较处理 T 的所有其他可能性。这将导致更大功效的检验，用于比较不与处理 B 交互的处理 T 的可能性。 8.1 主效应均值对比 通常，处理 T 和处理 B 的可能性会提示进行主效应对比，这对实验者来说会特别有趣。这样的主效应对比会提示特殊类型的交互作用对比，这对实验者来说也应该很有趣。此外，这样的交互作用对比通常很容易解释。接下来定义了主效应对比和正交主效应对比。 定义 8.1 ♦ 若 \\(\\sum_{i=1}^tc_i=0\\)，则称 \\(\\bar \\mu_{i\\cdot}\\) 的线性组合 \\(\\sum_{i=1}^tc_i\\bar{\\mu}_{i\\cdot}\\) 为 T 主效应均值的一个对比 (contrast).同样，若 \\(\\sum_{i=j}^td_j=0\\)，则称 \\(\\bar \\mu_{\\cdot j}\\) 的线性组合 \\(\\sum_{j=1}^bd_j\\bar{\\mu}_{\\cdot j}\\) 为 B 主效应均值的一个对比。 定义 8.2 ♦ 若 \\(\\sum_{i=1}^tc_ic_i^{\\prime}=0\\)，则称两对比 \\(\\sum_{i=1}^tc_i\\bar{\\mu}_{i\\cdot}\\) 和 \\(\\sum_{i=1}^tc_i^\\prime \\bar{\\mu}_{i\\cdot}\\) 为 T 主效应均值的正交对比 (orthogonal contrasts). 同样，若 \\(\\sum_{j=1}^tc_jc_j^{\\prime}=0\\)，则称两对比 \\(\\sum_{j=1}^tc_j\\bar{\\mu}_{\\cdot j}\\) 和 \\(\\sum_{j=1}^tc_j^\\prime \\bar{\\mu}_{\\cdot j}\\) 为 B 主效应均值的正交对比。 现假设 \\[\\begin{aligned}S_T&amp;=\\left\\{\\sum_{i=1}^tc_{i1}\\bar{\\mu}_{i\\cdot},\\sum_{i=1}^tc_{i2}\\bar{\\mu}_{i\\cdot},\\ldots,\\sum_{i=1}^tc_{it-1}\\bar{\\mu}_{i\\cdot}\\right\\}\\end{aligned}\\] 为 T 主效应均值的一组 t-1 个正交对比，以及 \\[\\begin{aligned}S_B&amp;=\\left\\{\\sum_{j=1}^bc_{j1}\\bar{\\mu}_{\\cdot j},\\sum_{j=1}^bc_{j2}\\bar{\\mu}_{\\cdot j},\\ldots,\\sum_{j=1}^bc_{\\cdot j}\\bar{\\mu}_{j\\cdot}\\right\\}\\end{aligned}\\] 为 B 主效应均值的一组 b-1 个正交对比。\\(S_T\\) 和 \\(S_B\\) 中的每一个都表明两个主效应平方和的划分 (partitioning)。即，T 的平方和的划分定义为 \\[\\begin{equation} S_T^*=\\left\\{Q_p^2=\\frac{nb(\\sum_ic_{ip}\\bar{y}_{i\\cdot\\cdot})^2}{\\sum_ic_{ip}^2},\\quad p=1,2,\\ldots,t-1\\right\\} \\tag{8.1} \\end{equation}\\] B 的平方和的划分定义为 \\[\\begin{equation} S_B^*=\\left\\{Q_q^2=\\frac{nt(\\sum_jd_{jq}\\bar{y}_{\\cdot j\\cdot})^2}{\\sum_jd_{jq}^2},\\quad q=1,2,\\ldots,b-1\\right\\} \\tag{8.2} \\end{equation}\\] 也就是说，\\(S^*_T\\) 中的每个 \\(Q_p^2\\) 都是一个单自由度平方和，用于检验 T 主效应均值中相应的对比是否等于 0. 此外，\\(S^*_T\\) 中 t-1 个单自由度对比的总和等于用于检验 \\(H_{01}\\colon\\bar{\\mu}_{1\\cdot}=\\bar{\\mu}_{2\\cdot}=\\cdots=\\bar{\\mu}_{t\\cdot}\\) 的平方和。\\(S^*_B\\) 的元素也存在类似的情况。 不应过分强调获得基本平方和的正交划分的可取性。从数学角度看，正交划分是不错的，但从实际的角度来看可能并不那么好。通常，一组精心选择的正交对比将使实验者能够明智、清晰、完整地解释他/她的数据。然而，实验者应该真正考虑任何以及所有有意义的对比，不应过度关注所选择的对比是否正交。 8.2 交互对比 本节从双向实验中交互对比的定义开始。 若对于 \\(j=1,2,\\cdots,b\\) 有 \\(\\sum_i\\omega_{ij}=0\\) 且若对于 \\(i=1,2,\\cdots,t\\) 有 \\(\\sum_j\\omega_{ij}=0\\)，则称 \\(\\mu_{ij}\\) 的线性组合 \\(\\sum_i\\sum_j\\omega_{ij}\\mu_{ij}\\) 为一个交互对比 (interaction contrasts). 双向实验主效应中的对比产生了特殊类型的交互对比。设 \\(\\sum_{i=1}^tc_i\\bar{\\mu}_{i\\cdot}\\) 为 T 主效应均值的一个对比以及 \\(\\sum_{j=1}^bd_j\\bar{\\mu}_{\\cdot j}\\) 为 B 主效应均值的一个对比，则 \\(\\sum_i\\sum_jc_id_j{\\mu}_{i{j}}\\) 为交互对比。即，对于所有的 \\(i,j\\)，取 \\(\\omega_{ij}=c_id_j\\) 即得到一个交互对比。若 \\(\\sum_i\\sum_j\\omega_{ij}\\omega_{ij}^{\\prime}=0\\)，则两交互对比 \\(\\sum_i\\sum_j\\omega_{ij}\\mu_{ij}\\) 和 \\(\\sum_i\\sum_j\\omega_{ij}^{\\prime}\\mu_{ij}\\) 为正交交互对比 (orthogonal interaction contrasts). 两组主效应的正交对比导致交互效应的正交对比。设 \\(\\sum_{i=1}^tc_i\\bar{\\mu}_{i\\cdot}\\) 和 \\(\\sum_{i=1}^tc_i^{\\prime}\\bar{\\mu}_{i\\cdot}\\) 为 T 主效应均值的两个对比以及 \\(\\sum_{j=1}^bd_j\\bar{\\mu}_{\\cdot j}\\) 和 \\(\\sum_{j=1}^bd_j^{\\prime}\\bar{\\mu}_{\\cdot j}\\) 为 B 主效应均值的两个对比，若 \\(\\sum_{i=1}^tc_ic_i^{\\prime}=0\\) 或 \\(\\sum_{j=1}^bd_jd_j^{\\prime}=0\\)，则 \\(\\sum_i\\sum_jc_id_j\\mu_{ij}\\) 和 \\(\\sum_i\\sum_jc_i^{\\prime}d^{\\prime}_j\\mu_{ij}\\) 为正交交互对比。也就是说，如果主效应对比对中的至少一个是正交对比对，则两个交互对比将彼此正交。接下来假设 \\(S^*_T\\) 和 \\(S^*_B\\) 由 8.1 节定义，令 \\(S^*_{T\\times B}\\) 定义为 \\[\\begin{equation} S_{T\\times B}^*=\\left\\{Q_{pq}^2=\\frac{n(\\sum_i\\sum_jc_{ip}d_{jq}\\bar{y}_{ij\\cdot})^2}{\\sum_ic_i^2\\sum_jd_j^2},\\quad p=1,2,\\ldots,t-1;q=1,2,\\ldots,b-1\\right\\} \\tag{8.3} \\end{equation}\\] 则 \\(S_{T\\times B}^*\\) 定义了交互作用平方和的一个划分。也就是说，\\(\\sum_p\\sum_qQ_{pq}^2=T{\\times}B\\) 个交互作用平方和，以及式 (8.3) 中的所有 (t-1)(b-1) 个单自由度平方和具有独立的概率分布。下一节将讨论一个示例，以说明上一节中描述的思想。 8.3 油漆铺路示例 考虑表 8.1 中的实验，该实验给出了每种 paint × paving 处理组合的三次独立重复的平均值。进行这项实验是为了比较由两家不同公司生产的两种颜色的油漆 (paints) 在三种类型路面 (paving surfaces) 上的使用寿命，以周为单位。该实验的误差平方和为 455.04，具有 24 个自由度，因此 \\(\\hat \\sigma^2=18.96\\). 本实验通常的方差分析表如表 8.2 所示。 表 8.1: 油漆铺路单元格均值 x 注释: 颜色后跟随的 I 和 II 表示生产厂家，Asphalt I, Asphalt II, Concrete 表示三种类型的路面 表 8.2: 油漆铺路示例方差分析表 x 每种油漆和铺路 (paving) 处理的可能值都会在主效应中产生两组正交对比，这可能是令人感兴趣的。这些在表 8.3 中给出。这两组主效应的正交对比表明，在交互效应中存在六个正交对比。这些数据如表 8.4 所示。 表 8.3: 油漆铺路实验主效应对比 x 表 8.4: 油漆铺路数据交互作用假设 x 注释: Type 是指 asphalt vs concrete 表8.5 中给出了使用表 8.3 和 8.4 中表明的划分对这些数据进行更完整的分析。下面给出了从表 8.5 中获得三个选定对比的平方和所需的计算细节。 表 8.5: 油漆铺路实验方差分析表，包括单自由度检验 x 根据式 (8.1)，用于比较两种白色油漆均值的单自由度平方和为， \\[Q_1^2=\\frac{3\\cdot3[(1)29.0+(-1)35.0]^2}{(1)^2+(-1)^2}=162.0\\] 根据式 (8.2)，用于比较沥青 (asphalt) 和混凝土 (concrete) 的单自由度平方和为， \\[Q_2^2=\\frac{3\\cdot4[(1)(26.5)+(1)(27.5)+(-2)(29.5)]^2}{1^2+1^2+(-2)^2}=40.5\\] 根据式 (8.3)，而用于比较 type × type 交互作用的单自由度平方和为， \\[Q_3^2=\\frac{3\\left[(1)(30)+(1)(28)+(-2)(29)+(-1)(34)+(-1)(35)+(2)(36)\\right]^2}{\\left(1\\right)^2+\\left(1\\right)^2+\\left(-2\\right)^2+\\left(-1\\right)^2+\\left(-1\\right)^2+\\left(2\\right)^2}=2.25\\] 根据表 8.5 的分析，可以得出以下结论： 实验中的所有交互作用都是由两种黄色油漆在两种类型的表面上的不同作用引起的，因为其交互对比是交互作用中唯一显著的单自由度平方和。 因为我们现在知道了数据中交互作用的位置，我们可以进行以下观测： 由于沥青和油漆之间没有交互作用，因此可以在对所有油漆进行平均后对这两种沥青进行比较。该比较的 \\(F\\) 统计量的值为 \\(F=0.32\\)；因此，沥青 I 和 II 之间没有显著差异。 由于白色油漆和三种路面之间没有交互作用，因此可以在对所有路面进行平均后对两种白色涂料进行比较。该比较的 \\(F\\) 统计量值为 \\(F=8.54\\)，这表明白色油漆 II 与 I 有显著差异。从表 8.1 中我们可以看出，白色油漆 II 的持续时间更长。 尽管比较黄色油漆 I 和黄色油漆 II 的统计量是显著的（\\(F=4.45\\)），但在进行解释时必须小心，因为黄色油漆的品牌和路面类型之间存在显著的交互作用。 尽管沥青与混凝土的比较并不显著（\\(F=2.14\\)），但在进行解释时必须再次小心，因为油漆品牌和路面类型之间存在显著的交互作用。 为了完成对这些数据的分析，我们还应该检查： 沥青上的黄色油漆 I 与黄色油漆 II，即检验 \\(\\mu_{11}+\\mu_{12}-\\mu_{21}-\\mu_{22}=0\\). 混凝土上的黄色油漆 I 与黄色油漆 II. 对于黄色油漆 I，比较混凝土和沥青。 对于黄色油漆 II，比较混凝土和沥青。 三种路面上的白色油漆。 结果如表 8.6 所示。 表 8.6: 结论 3 中的假设检验 x 对表 8.6 中的结果和表 8.1 中的平均值的检查表明，1）黄色油漆 II 在沥青上明显优于黄色油漆 I，但 2）黄色油漆 I 在混凝土上明显优于黄色油漆 II；3） 黄色油漆 II 在混凝土上的持续时间明显长于在沥青上；4） 黄色油漆 II 在沥青上的持续时间明显长于在混凝土上；最后，5）白色油漆在所有三种路面上持续的时间大致相同。 我们对该示例的分析所获得的所有结果都可以使用许多统计计算包获得，如 SAS® 和 SPSS，使用它们的对比选项。其中一些程序可能要求将 12 种处理组合视为单向处理结构。 8.4 分析定量处理因素 在本节中，假设实验的两个因素的水平都是定量的 (quantitative). 在这种情况下，可以定义对比以衡量每组处理主效应均值的曲线趋势。感兴趣的趋势通常是线性的、二次的、三次的等等。相应的正交对比将主效应平方和划分为测量线性、二次、三次等等趋势的效应，然后可以用来构建交互效应的正交对比。由此产生的对比称为 Lin T × Lin B（T 的线性效应乘以 B 的线性效应）、Lin T × Quad B （T 的线性效应乘以 B 的二次效应）等等。对于 3×4 的实验，其中两种处理具有相等的间隔水平（例如，因子 T 为 5, 10, 15，因子 B 为 2, 4, 6, 8），Lin T 对比由 \\(-\\bar{\\mu}_{1\\cdot}+0\\bar \\mu_{2\\cdot}+\\bar{\\mu}_{3\\cdot}=0\\) 定义，Lin B 对比由 \\(-3\\bar{{\\mu}}_{\\cdot1}-\\bar{{\\mu}}_{\\cdot2}+\\bar{{\\mu}}_{\\cdot3}+3\\bar{{\\mu}}_{\\cdot4}=0\\). 注意，对于 Lin T 对比，在 \\(\\sum_{i=1}^3c_i\\bar{\\mu}_{i\\cdot}=0\\) 中 \\(c_1=-1,c_2=0,c_3=1\\). 对于 Lin B 对比，在 \\(\\sum_{j=1}^4d_j\\bar{\\mu}_{\\cdot j}=0\\) 中 \\(d_1=-3,d_2=-1,d_3=1,d_4=3\\). 因此 Lin T × Lin B 交互对比定义为 \\(3\\mu_{11}+\\mu_{12}-\\mu_{13}-3\\mu_{14}-3\\mu_{31}-\\mu_{32}+\\mu_{33}+3\\mu_{34}=0\\). 在正交多项式系数表中可以找到在主效应均值中用于定义这些类型的正交对比的 \\(c_i\\) 和 \\(d_j\\) 的值。参见 Beyer (1968). 表 8.7 中再现了 3×4 实验的结果。 表 8.7: 3×4 实验的正交对比系数 x 设 \\(x_1,x_2,\\cdots,x_t\\) 表示因素 T 的水平，\\(z_1,z_2,\\cdots,z_b\\) 表示因素 B 的水平。总是存在参数 \\(\\alpha_{kh},k=0,1,2,\\cdots,t-1,h=0,1,2,\\cdots,b-1\\) 使得单元格均值参数可以表示为 \\(x_i\\) 和 \\(z_j\\) 的多项式函数。也就是说，存在这样的 \\(\\alpha_{kh}\\) 使得 \\[\\begin{equation} \\mu_{ij}=\\sum_{k=0}^{t-1}\\sum_{h=0}^{b-1}\\alpha_{kh}x_i^kz_j^h \\tag{8.4} \\end{equation}\\] 展开式 (8.4)，可以得到 \\[\\begin{aligned}\\mu_{ij}=&amp;\\alpha_{00}+\\alpha_{10}x_i+\\alpha_{20}x_i^2+\\cdots+\\alpha_{t-10}x_i^{t-1}+\\alpha_{01}z_j+\\alpha_{02}z_j^2+\\cdots+\\alpha_{0b-1}z_j^{b-1}\\\\&amp;+\\alpha_{11}x_iz_j+\\alpha_{12}x_iz_j^2+\\cdots+\\alpha_{t-1b-1}x_i^{t-1}z_j^{b-1}\\end{aligned}\\] 根据方程 (8.4) 中的 \\(\\alpha_{kh}\\) 值，表 8.8 给出了对于 3×4 实验的主效应期望值和交互对比。在构建此表时，我们假设 \\(x\\) 的三个水平分别编码为 -1、0 和 1，\\(z\\) 的四个水平分别编码为 -3, -1, 1 和 3. 提供表 8.8 的目的是指出当研究这种类型的对比时，实际上正在检验哪些假设。例如，Lin T 与 Lin B 的对比检验了假设 \\(40\\alpha_{11}+328\\alpha_{13}=0\\) . 因此，如果此效应显著，那么可能是因为 \\(\\alpha_{11} ≠ 0\\) 或者 \\(\\alpha_{13} ≠ 0\\)，而不仅仅是因为 \\(\\alpha_{11} ≠ 0\\)（如许多数据分析师可能认为的那样）。 表 8.8: 3×4 实验中正交多项式的期望值 x 如果要考察正交多项式，建议先观察最高阶项的系数，然后按照降序考虑剩余项的阶数。一旦确定某个高阶项在模型中，那么所有两个分量阶数均低于该显著项的项，无论它们是否显著，也都应该被包含在模型中。例如，如果决定 \\(x^2z^2\\) 应包括在模型中，那么模型也应该包括 \\(xz^2,z^2,x^2z,x^2,xz,x,z\\). 这是因为正交多项式总是表示定量变量的编码值。因此，如果 \\(\\alpha_{22}\\) 非零，这意味着 \\[\\left(\\frac{x-h_1}{c_1}\\right)^2\\left(\\frac{z-h_2}{c_2}\\right)^2\\] 在模型中，其中 \\(\\left(\\frac{x-h_1}{c_1}\\right)\\) 和 \\(\\left(\\frac{z-h_2}{c_2}\\right)\\) 为 \\(x\\) 和 \\(z\\) 的编码值。式 \\(\\left(\\frac{x-h_1}{c_1}\\right)^2\\left(\\frac{z-h_2}{c_2}\\right)^2\\) 的展开说明项 \\(xz^2,z^2,x^2z,x^2,xz,x,z\\) 也在模型中，即使其他低阶正交多项式可能不显著。 8.5 多重检验 第 3 章中讨论的任何多重比较程序都可以使用，只需进行一些非常小的调整，就可以对双因素实验的主效应进行多重比较。调整要求将 \\(n\\) 和 \\(n_i\\) 替换为：为估计被比较的主效应均值而进行的观测总数。在本章中，B 主效应均值的样本量为 \\(nt\\)，T 主效应均值的样本量为 \\(nb\\). 我们对主效应均值多重比较的建议与第 3.2 节中给出的建议相同。第 3 章中给出的容易推广到交互对比的程序是 LSD procedure、Bonferroni’s method、多元 \\(t\\) 方法、模拟方法和 Scheffé’s procedure. 我们发现，Scheffé’s procedure 不是很令人满意，因为所需的临界点太大，程序太保守。我们对交互对比多重比较的建议如下： 对交互进行 \\(F\\) 检验。 如果 \\(F\\) 统计量显著，则使用 LSD procedure（或等价地，上一节中给出的对比程序）进行任何计划的比较。对于数据窥探和计划外比较，请使用 Johnson (1976) 给出的程序，此处不讨论。 如果交互作用的 \\(F\\) 检验不显着，实验者仍应检查她计划考虑的任何单个交互对比，但要使用多元 \\(t\\) 方法或 Bonferroni’s method. 只要所选对比是线性独立的，就使用多元 \\(t\\) 方法；否则应使用 Bonferroni’s method. 8.6 结束语 在本章中，我们通过举例介绍了从实验中获得最大信息量的方法。其中包括发现实验中交互作用发生位置的方法。了解实验中交互作用发生的位置对于确定可能提出的问题的最佳答案很有价值。本章介绍的技术应该可以帮助实验者更好地分析他们的实验。还考虑了定量处理因素的分析，包括如何确定哪些趋势可能与不同水平的处理因素有关。 8.7 练习 "],["chap9.html", "第 9 章 使用均值模型分析子类数不等的均衡双向处理结构 9.1 模型定义和假设 9.2 参数估计 9.3 检验所有均值是否相等 9.4 交互作用和主效应假设 9.5 总体边际均值 9.6 同时推断与多重比较 9.7 结束语 9.8 练习", " 第 9 章 使用均值模型分析子类数不等的均衡双向处理结构 “Numerical quantities focus on expected values, graphical summaries on unexpected values.” - John Tukey 第 7 章和第 8 章考虑了相同样本量的情况，其中每个处理组合的观测次数相同。第 13-15 章考虑了一些处理组合缺失的情况，但本章以及第 10-12 章假设观测到了每种处理组合，并且每种组合观测了多次。 9.1 模型定义和假设 如第 7.1.1 节所示，令 \\(\\mu_{ij}\\) 为当处理 T 的可能性 \\(i\\) 和处理 B 的可能性 \\(j\\) 均应用于同一实验单元时的预期响应。本章假设观测到的响应 \\(Y_{ijk}\\) 可以通过以下方式建模 \\[\\begin{equation} Y_{ijk}=\\mu_{ij}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,b,k=1,2,\\ldots,n_{ij} \\tag{9.1} \\end{equation}\\] 满足理想条件 \\[\\varepsilon_{ijk}\\sim i.i.d.N(0,\\sigma^2),\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,b,\\quad k=1,2,\\ldots,n_{ij}\\] 以及对于每个 \\(i\\) 和 \\(j\\)，\\(n_{ij}&gt;0\\). 9.2 参数估计 若将 \\(bt\\) 个处理组合视为 \\(bt\\) 个不同的处理，那么第 1-3 章中讨论的单向处理结构的所有内容也适用于双向处理结构。对于不均衡的数据问题，这通常是分析数据最佳和最简单的方法。均值模型中参数的最佳估计是 \\[\\begin{equation} \\hat{\\mu}_{ij}=\\frac1{n_{ij}}\\sum_{k=1}^{n_{ij}}y_{ijk}=\\bar{y}_{ij\\cdot},i=1,2,\\ldots,t,j=1,2,\\ldots,b \\tag{9.2} \\end{equation}\\] 以及 \\[\\begin{equation} \\hat{\\sigma}^2=\\frac1{N-bt}\\sum_{ijk}(y_{ijk}-\\overline{y}_{ij\\cdot})^2 \\tag{9.3} \\end{equation}\\] 其中 \\(N=n_{\\cdot}\\). \\(\\hat \\mu_{ij},\\hat \\sigma^2\\) 的抽样分布为 \\[\\hat{\\mu}_{ij}\\thicksim N(\\mu_{ij},\\sigma^2/n_{ij})\\quad\\mathrm{for~}i=1,2,\\ldots,t,j=1,2,\\ldots,b\\] 以及 \\[(N-bt)\\hat{\\sigma}^2/\\sigma^2\\thicksim\\chi^2(N-bt)\\] 此外，所有的 \\(\\hat \\mu_{ij},\\hat \\sigma^2\\) 独立分布，像之前章节一样。 当数据不均衡时，实验者通常想回答与数据均衡时相同的问题。回想一下，这些问题是： 两组处理发生交互吗？ T 处理如何影响响应？ B 处理如何影响响应？ 根据均值模型的参数，这些问题可以表述为假设，相应的假设是： \\[\\begin{array}{l}H_{T\\times B}\\colon\\mu_{ij}-\\mu_{i&#39;j}-\\mu_{ij&#39;}+\\mu_{i&#39;j&#39;}=0&amp;\\text{ for all }i\\neq i&#39;\\text{ and }j\\neq j&#39;\\\\H_T\\colon\\bar{\\mu}_{1\\cdot}=\\bar{\\mu}_{2\\cdot}=\\cdots=\\bar{\\mu}_{t\\cdot}\\\\H_B\\colon\\bar{\\mu}_{\\cdot1}=\\bar{\\mu}_{\\cdot2}=\\cdots=\\bar{\\mu}_{\\cdot b}\\end{array}\\] 检验上述假设应被视为分析任何双向实验的第一步。通常会有明确的对比，直接解决研究人员感兴趣的其他问题。假设 \\(H_{T\\times B},H_T,H_B\\) 经常被检验，以帮助选择适当的多重比较程序来解决可能感兴趣的其他问题。 如式 7.2 所示，始终存在参数 \\(\\mu,\\tau_i,\\beta_j,\\gamma_{ij},i=1,2,\\cdots,t,j=1,2,\\cdots,b\\) 使得 \\(\\mu_{ij}\\) 可以在效应模型中表示为 \\[\\mu_{ij}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij},\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,b\\] 许多实验者更喜欢使用效应模型来查看处理组合方式的表示。这可能是因为许多统计学家鼓励实验者考虑这样的模型。因此，许多现有的计算机软件引导数据分析师使用效应模型的表示。本书考虑了这两类模型。本章考虑均值模型，第 10 章考虑效应模型。第 1.5 节和第 1.6 节介绍了计算检验统计量的不同程序。对于单向情况，所有这些方法都会产生相同的检验统计量。事实上，对于匀称的 (well-balanced) 双向实验也总是如此。然而，不均衡数据集的情况并不总是如此。匀称意味着每种处理组合都有相同数量的观测结果。本章使用矩阵程序来获取检验统计量，第 10 章使用模型拟合程序。 9.3 检验所有均值是否相等 考虑表 9.1 中的数据。数据来自于在完全随机设计结构中进行的小型双向处理结构实验。首先，计算表 9.1 中数据的双向单元格均值和边际均值。表 9.2 给出了这些均值，其中行边际均值 (row marginal mean) 定义为给定行单元格均值的均值，列边际均值 (column marginal mean) 定义为给定列单元格均值的均值。 表 9.1: 一个不均衡的双向实验 x 表 9.2: 表 9.2 中数据的单元平均值和边际平均值 x 应注意的是，在不均衡双向实验中，有两种不同的方法可以计算 T 均值和 B 均值。表 9.1 给出了通过行（列）综总和并除以行（列）观测数量计算得出的平均值。表 9.2 给出了分两步计算的平均值。首先计算每个 T × B 组合的单元格均值，然后计算每行和列的单元格均值。除非实验是匀称的，否则这两种方法通常会给出不同的答案。例如，表 9.1 中的 \\(T_1\\) 平均值为 22.75，而表 9.2 中的 \\(T_1\\) 平均值为 23. 因此，必须解决的一个问题是在计算处理主效应均值时应使用这两种方法中的哪一种。应使用哪种方法将在 9.5 节中讨论。 表 9.1 中数据的实验误差方差为 \\[\\hat{\\sigma}^2=\\frac1{N-bt}\\sum_{ijk}(y_{ijk}-\\overline{y}_{ij.})^2=20/10=2\\] 自由度为 \\(N-bt=16-6=10\\). 接下来，将该实验视为具有六种处理的单向处理结构，并检验所有六种处理组合均值是否彼此相等。也就是说，考虑检验 \\[\\begin{aligned}H_0\\colon\\mu_{11}=\\mu_{12}=\\mu_{13}=\\mu_{21}=\\mu_{22}=\\mu_{23}\\end{aligned}\\] 使用式 (8.1) 可得 \\[SSH_0=\\frac{60^2}3+\\frac{50^2}2+\\frac{72^2}3+\\frac{52^2}2+\\frac{69^2}3+\\frac{96^2}3-\\frac{399^2}{16}=238.9375\\] 基于 5 个自由度。因此用于检验 \\(H_0\\) 的 \\(F\\) 统计量为 \\[F_c=\\frac{238.9375/5}2=23.89\\] 在 \\(\\hat\\alpha = 0.00003\\) 水平上显著。因此，\\(H_0\\) 将被拒绝，因此六种不同处理组合均值之间存在显著差异。 9.4 交互作用和主效应假设 在上一节中，确定了六种处理组合均值之间存在显著差异。现在有必要看看差异出现在哪里。第一步，考虑表 9.1 中给出的数据是否存在显着的 T × B 交互作用并检验 \\[\\begin{aligned}H_{T\\times B}\\colon\\mu_{ij}-\\mu_{i&#39;j}-\\mu_{ij&#39;}+\\mu_{i&#39;j&#39;}=0&amp;&amp;\\text{ for all }i\\neq i&#39;&amp;\\mathrm{~and~}j\\neq j&#39;\\end{aligned}\\] 这可以通过利用第 1.4 节中讨论的矩阵程序来开发检验统计量来实现。假设 \\(H_{T\\times B}\\) 为真当且仅当 \\[\\mu_{11}-\\mu_{12}-\\mu_{21}+\\mu_{22}=0\\] 以及 \\[\\mu_{11}-\\mu_{13}-\\mu_{21}+\\mu_{23}=0\\] 反过来，这些声明为真当且仅当 \\(\\boldsymbol C\\boldsymbol \\mu=0\\)，其中 \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0&amp;-1&amp;1&amp;0\\\\1&amp;0&amp;-1&amp;-1&amp;0&amp;1\\end{bmatrix}\\quad\\mathrm{and}\\quad \\boldsymbol \\mu^{\\prime}=[\\mu_{11}~\\mu_{12}~\\mu_{13}~\\mu_{21}~\\mu_{22}~\\mu_{23}]\\] 根据式 (1.11)，由于 \\(\\boldsymbol D=\\mathrm{Diag}[1/3,1/2,1/3,1/2,1/3,1/3]\\) \\[SSH_{T \\times B}=[\\boldsymbol C\\hat{\\boldsymbol{\\mu}}]^{\\prime}[\\boldsymbol C\\boldsymbol D\\boldsymbol C^{\\prime}]^{-1}[\\boldsymbol C\\hat{\\boldsymbol{\\mu}}]=[-8\\quad2]\\begin{bmatrix}\\frac{10}6&amp;\\frac56\\\\\\frac56&amp;\\frac96\\end{bmatrix}^{-1}\\begin{bmatrix}-8\\\\2\\end{bmatrix}\\] 因此 \\(SSH_{T\\times B}=776(6/65)=71.631\\) 且基于 2 个自由度。相应的 \\(F\\) 统计量为 \\(F_c=(71.631/2)/2=17.91\\) 且基于自由度 2 和 10，在 \\(\\hat \\alpha=0.0005\\) 水平下显著。其他 \\(\\boldsymbol C\\) 矩阵也可以用来检验无交互作用的假设，但所有这些矩阵都会产生相同的检验统计量。读者可以验证这是真的。 接下来考虑检验预期行边际均值的相等性。这里出于说明目的，尽管由于显著的 T × B 交互作用，这种检验在这里可能不合适。合适的假设为 \\(H_T{:{\\bar{\\mu}}_{1\\cdot}}=\\bar{{\\mu}}_{2\\cdot}\\). 注意到 \\(H_T\\) 为真当且仅当 \\(\\boldsymbol C\\boldsymbol \\mu=\\boldsymbol 0\\)，其中 \\(\\boldsymbol C=[1\\,\\,1\\,\\,1\\,\\,-1\\,\\,-1\\,\\,-1]\\). 使用式 (1.11) 可得 \\[SSH_T=[\\boldsymbol C\\hat{\\boldsymbol{\\mu}}]^{\\prime}[\\boldsymbol C\\boldsymbol D\\boldsymbol C^{\\prime}]^{-1}[\\boldsymbol C\\hat{\\boldsymbol{\\mu}}]=[-12][14/6]^{-1}[-12]=61.714\\] 基于 1 个自由度，且相应的 \\(F\\) 统计量为 \\(F_{c}=(61.714/1)/2=30.857\\)，在 \\(\\hat \\alpha=0.00024\\) 水平下显著。也可以取 \\(\\boldsymbol C=[\\frac{1}{3}\\,\\,\\frac{1}{3}\\,\\,\\frac{1}{3}\\,\\,-\\frac{1}{3}\\,\\,-\\frac{1}{3}\\,\\,-\\frac{1}{3}]\\)。读者应该验证 \\(\\boldsymbol C\\) 的第二个选择是否会产生与上面使用的 \\(\\boldsymbol C\\) 相同的 \\(F\\) 检验统计量。 最后，考虑通过检验 \\(H_B\\colon\\bar{\\mu}_{\\cdot1}=\\bar{\\mu}_{\\cdot2}=\\bar{\\mu}_{\\cdot3}\\) 来测试预期列边际均值的相等性。注意，\\(H_B\\) 为真当且仅当 \\(\\boldsymbol C\\boldsymbol \\mu=\\boldsymbol 0\\) 时，其中 \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0&amp;1&amp;-1&amp;0\\\\1&amp;0&amp;-1&amp;1&amp;0&amp;-1\\end{bmatrix}\\] 使用式 (1.11) 可得 \\[\\begin{aligned}SSH_B&amp;=[C\\hat{\\boldsymbol{\\mu}}]^{\\prime}[\\boldsymbol C\\boldsymbol D\\boldsymbol C^{\\prime}]^{-1}[\\boldsymbol C\\hat{\\boldsymbol{\\mu}}]=[-2\\,\\,-10]\\begin{bmatrix}\\frac{10}6&amp;\\frac56\\\\\\frac56&amp;\\frac96\\end{bmatrix}^{-1}\\begin{bmatrix}-2\\\\-10\\end{bmatrix}\\\\\\\\&amp;=[-2\\,\\,-10]\\frac6{65}\\begin{bmatrix}9&amp;-5\\\\-5&amp;10\\end{bmatrix}\\begin{bmatrix}-2\\\\-10\\end{bmatrix}=77.169\\end{aligned}\\] 基于 2 个自由度。因此，相应的 \\(F\\) 统计量为 \\(F_c=19.29\\)，在 \\(\\hat \\alpha=0.0037\\) 水平下显著。 表 9.3 中给出的方差分析表总结了上述检验。请注意，此分析结果与第 7 章讨论的均衡情形下的结果之间存在一些差异。 表 9.3: 表 9.1 中数据的方差分析表 x 对于均衡的数据，总有 \\[SS_T+SS_B+SS_{T\\times B}=SS_{\\mu_{11}=\\mu_{12}=\\cdot\\cdot\\cdot=\\mu_{23}}\\] 对于不均衡的数据通常不然。 对于均衡的数据，\\(SS_T,SS_B,SS_{T\\times B}\\) 在统计学上是独立的；对于不均衡的数据，这通常是不正确的。 人们不必过于担心 T, B 和 T × B 的平方和之和不等于检验所有均值相等的平方和，或者 T, B 和 T × B 的平方和在统计上不独立。之所以在此提出，是因为它们确实成立，而并非因为它们是必须解决的问题。 还有其他一些平方和经常与双向处理结构的分析有关，第 10 章将讨论其中两种常用的平方和。 9.5 总体边际均值 实验者常常对比较每个主效应的可能性感兴趣。在均衡的情况下，人们可以比较 \\(\\bar{\\mu}_{1\\cdot},\\bar{\\mu}_{2\\cdot},\\ldots,\\bar{\\mu}_{t\\cdot}\\)。如前所述，这些均值在均衡和不均衡的情况下都被称为总体边际均值。 \\(\\bar{\\mu}_{i\\cdot}\\) 的最佳估计是 \\[\\begin{equation} \\hat{\\bar{\\mu}}_{i\\cdot}=\\frac1b\\sum_{j=1}^b\\hat{\\mu}_{ij}=\\bar{\\hat{\\mu}}_{i\\cdot}\\quad i=1,2,\\ldots,t \\tag{9.4} \\end{equation}\\] \\(\\hat{\\bar{\\mu}}_{i\\cdot}\\) 的标准误估计为 \\[\\begin{equation} \\widehat{s.e.}(\\hat{\\bar{\\mu}}_{i\\cdot})=\\frac{\\hat{\\sigma}}b\\sqrt{\\sum_{j=1}^b\\frac1{n_{ij}}},\\quad i=1,2,\\ldots,t \\tag{9.5} \\end{equation}\\] \\(\\bar{\\mu}_{\\cdot j}\\) 的最佳估计是 \\[\\begin{equation} \\hat{\\bar{\\mu}}_{\\cdot j}=\\frac1t\\sum_{i=1}^t\\hat{\\mu}_{ij}=\\bar{\\hat{\\mu}}_{\\cdot j},\\quad j=1,2,\\ldots,b \\tag{9.6} \\end{equation}\\] \\[\\begin{equation} \\widehat{s.e.}(\\hat{\\bar{\\mu}}_{\\cdot j})=\\frac{\\hat{\\sigma}}t\\sqrt{\\sum_{i=1}^t\\frac1{n_{ij}}},\\quad j=1,2,\\ldots,b \\tag{9.7} \\end{equation}\\] 需注意，在不均衡数据问题中，通常 \\(\\hat{\\bar{\\mu}}_{i\\cdot}\\) 不同于 \\(\\bar y_{i\\cdot}\\) 且 \\(\\hat{\\bar{\\mu}}_{\\cdot j}\\) 不同于 \\(\\bar y_{\\cdot j}\\). 在这个例子中，\\(\\bar{y}_{1\\cdot\\cdot}=22.75,\\hat {\\bar \\mu}_{1\\cdot}=23\\). \\(\\hat{\\bar{\\mu}}_{i\\cdot},\\hat{\\bar{\\mu}}_{\\cdot j}\\) 分别为 \\(\\bar{\\mu}_{i\\cdot},\\bar{\\mu}_{\\cdot j}\\) 的无偏估计。注意到 \\(\\bar{y}_{i\\cdot\\cdot},\\bar{y}_{\\cdot j\\cdot}\\) 分别为 \\[\\tilde{\\mu}_{i\\cdot}=\\left(\\sum_{j=1}^bn_{ij}\\mu_{ij}\\right)\\Bigg/n_{i\\cdot},\\quad\\tilde{\\mu}_{\\cdot j}=\\left(\\sum_{i=1}^tn_{ij}\\mu_{ij}\\right)\\Bigg/n_{\\cdot j}\\] 的无偏估计。即，\\(\\bar{y}_{i\\cdot\\cdot}\\) 使用第 \\(i\\) 行单元格样本量作为权重，提供该行单元格均值参数加权平均的无偏估计。类似的，\\(\\bar{y}_{\\cdot j \\cdot}\\) 使用第 \\(j\\) 列单元格样本量作为权重，提供该列单元格均值参数加权平均的无偏估计。因此主效应均值的估计有两种：\\(\\hat{\\bar{\\mu}}_{i\\cdot},\\hat{\\bar{\\mu}}_{\\cdot j}\\) 和 \\(\\bar{y}_{i\\cdot\\cdot},\\bar{y}_{\\cdot j \\cdot}\\)。当使用软件包来分析数据时，确定它计算的是哪种是极其重要的。 对于表 9.1 中的数据，如表 9.2 所示，总体边际均值的估计为 \\(\\hat{\\bar{\\mu}}_{1\\cdot}=23,\\hat{\\bar{\\mu}}_{2\\cdot}=27,\\hat{\\bar{\\mu}}_{\\cdot1}=23,\\hat{\\bar{\\mu}}_{\\cdot2}=27,\\hat{\\bar{\\mu}}_{\\cdot3}=28\\). 这些估计的标准误估计为 \\[\\begin{aligned} &amp;\\widehat{s.e.}(\\hat{\\bar{\\mu}}_{1\\cdot}) =\\frac{\\sqrt{2}}3\\sqrt{\\frac13+\\frac12+\\frac13}=0.51 \\\\ &amp;\\widehat{s.e.}(\\hat{\\bar{\\mu}}_{2\\cdot}) =\\frac{\\sqrt2}3\\sqrt{\\frac12+\\frac13+\\frac13}=0.51 \\\\ &amp;\\widehat{s.e.}(\\hat{\\bar{{\\mu}}}_{\\cdot1}) =\\frac{\\sqrt{2}}2\\sqrt{\\frac13+\\frac12}=0.65 \\\\ &amp;\\widehat{s.e.}(\\hat{\\bar{\\mu}}_{\\cdot2}) =\\frac{\\sqrt2}2\\sqrt{\\frac12+\\frac13}=0.65 \\\\ &amp;\\widehat{s.e.}(\\hat{\\bar{\\mu}}_{\\cdot3}) =\\frac{\\sqrt2}2\\sqrt{\\frac13+\\frac13}=0.58 \\end{aligned}\\] 关于总体边际均值线性组合的推断，如 \\(\\sum_ic_i\\bar{\\mu}_{i\\cdot}\\) 或 \\(\\sum_jd_j\\bar{\\mu}_{\\cdot j}\\)，可以证明 \\[\\begin{equation} \\frac{\\sum_ic_i\\hat{\\bar{\\mu}}_{i\\cdot}-\\sum_ic_i\\bar{\\mu}_{i\\cdot}}{\\frac{\\hat{\\sigma}}b\\sqrt{\\sum_ic_i^2\\left(\\sum_j\\frac1{n_{ij}}\\right)}}\\thicksim t(v) \\tag{9.8} \\end{equation}\\] 以及 \\[\\begin{equation} \\frac{\\sum_jc_j\\hat{\\bar{\\mu}}_{\\cdot j}-\\sum_jc_j\\bar{\\mu}_{\\cdot j}}{\\frac{\\hat{\\sigma}}t\\sqrt{\\sum_jc_j^2\\left(\\sum_i\\frac1{n_{ij}}\\right)}}\\thicksim t(v) \\tag{9.9} \\end{equation}\\] 方程 (9.8) 和 (9.9) 中的公式可以作为方程 (1.4) 的特殊情况获得。例如，检验 \\(H_T{:{\\bar{\\mu}}_{1\\cdot}}=\\bar{{\\mu}}_{2\\cdot}\\) 的 \\(t\\) 统计量为 \\[t_c=\\frac{\\hat{\\bar{\\mu}}_{1\\cdot}-\\hat{\\bar{\\mu}}_{2\\cdot}}{\\frac\\partial b\\sqrt{\\sum_j\\frac1{n_{1j}}+\\sum_j\\frac1{n_{2j}}}}=\\frac{23-27}{\\frac{\\sqrt{2}}3\\sqrt{\\left(\\frac13+\\frac12+\\frac13\\right)+\\left(\\frac12+\\frac13+\\frac13\\right)}}=\\frac{-4}{\\frac{1.414}3\\sqrt{\\frac73}}=\\frac{-4}{0.72}=-5.55\\] 在 \\(\\hat \\alpha=0.00024\\) 水平下显著。\\(\\hat{\\bar{\\mu}}_{1\\cdot}-\\hat{\\bar{\\mu}}_{2\\cdot}\\) 的一个 95% 置信区间为 \\[\\begin{aligned} \\hat{\\bar{\\mu}}_{\\cdot1}-\\hat{\\bar{\\mu}}_{\\cdot2}\\mp t_{\\frac\\alpha2,v}\\frac{\\hat{\\sigma}}t\\sqrt{\\sum_i\\frac1{n_{i1}}+\\sum_j\\frac1{n_{i2}}}&amp; =23-24\\mp t_{.025,v}\\cdot\\frac{1.414}2\\sqrt{\\left(\\frac13+\\frac12\\right)+\\left(\\frac12+\\frac13\\right)} \\\\ &amp;=-1\\mp(2.228)(0.91)=-1\\mp2.03 \\end{aligned}\\] 9.6 同时推断与多重比较 在每个处理组合观测次数不等的双向实验中，很少有好的程序可以用于进行多重比较。如果想比较所有双向单元格均值对子，那么第 3 章中讨论的任何技术都可以简单地使用，只需将双向实验视为单向处理结构实验。在这种情况下，读者应参阅第 3.2 节中给出的建议。如果希望对总体边际均值进行多重比较，建议使用基于方程 (9.8) 和 (9.9) 的 \\(t\\) 检验。如果用于比较相应边际均值的相应 \\(F\\) 检验是显著的，则使用给定的显著性水平。如果 \\(F\\) 检验不显著，那么仍然建议使用这些 \\(t\\) 检验。然而，在这种情况下，应该使用 Bonferroni’s method，并声称只有当计算出的显著水平小于 \\(\\alpha/p\\) 时，两个总体边际均值才显著不同，其中 \\(\\alpha\\) 是选定的实验误差率，\\(p\\) 是在收集数据之前考虑的比较次数。如果确定数据中存在交互作用，那么人们可能会想要比较在其他处理的每种可能性下，某一种处理的效果。也就是说，人们可能希望将每一行内的单元格均值相互比较，并将每一列内的单元格均值相互比较。有 \\(bt(t + 1)/2 + bt(b + 1)/2\\) 个 这样的两两比较。如果比较所有均值的 \\(F\\) 检验显著，则可以对所有此类成对比较使用实际显著性水平。这种用法相当于 Fisher’s LSD 程序。如果比较所有均值的 \\(F\\) 检验不显着，则可以采用 Bonferroni’s method. 对于数据窥探和计划外比较，应该使用 Scheffé’s procedure. 9.4 节中描述的检验统计量可以通过许多统计计算包自动获得。由于这些包采用了效应模型，感兴趣的读者应该参见第 10.7 节。 9.7 结束语 本章是考虑对子类数量不等的双向处理结构进行分析的七章中的第一章。本章所介绍的分析方法是基于均值模型得出的。其中一个重要的假设是，所有处理组合至少被观测过一次。检验主效应和相互作用假设的程序是作为第一章中介绍的一般技术的特例而获得的。本章定义了总体边际均值，并给出了对总体边际均值进行推断的程序。第 10 章利用效应模型回答了类似的问题；然而，作者希望所有读者都能对均值模型和效应模型感到同样舒适。 9.8 练习 "],["chap10.html", "第 10 章 使用效应模型分析子类数不等的均衡双向处理结构 10.1 模型定义 10.2 参数估计和 I 型分析 10.3 在 SAS 中使用可估函数 10.4 I–IV 型假设 10.5 在 SAS-GLM 中使用 I–IV 型可估函数 10.6 总体边际均值与最小二乘均值 10.7 计算机分析 10.8 结束语", " 第 10 章 使用效应模型分析子类数不等的均衡双向处理结构 “It is a capital mistake to theorize before one has data.” - Sir Arthur Conan Doyle 第 9 章讨论了使用均值模型分析具有不等子类数的双向处理结构。本章考虑在相同情况下使用效应模型。所有可以使用效应模型回答的问题也可以使用均值模型回答，反之亦然。之所以讨论效应模型，是因为当使用统计计算软件包分析双向处理结构时，效应模型常常是一个重要的工具。因为统计软件通常会自动产生主效应和交互效应的检验统计量，以及边际均值、双向均值及其标准误估计。 10.1 模型定义 与均值模型 (9.1) 对应的效应模型定义如下 \\[\\begin{equation} y_{ijk}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,t;~j=1,2,\\ldots,b;~k=1,2,\\ldots,n_{ij} \\tag{10.1} \\end{equation}\\] 其中 \\({\\varepsilon}_{ijk}\\thicksim i.i.d.N(0,{\\sigma}^2)\\). 10.2 参数估计和 I 型分析 除了第 9 章介绍的那些平方和，在分析具有不等子类数量的双向处理结构时，还会涉及其他一些平方和。本章将探讨其中两种。首先是一系列平方和，它们涉及通过推广第 3.2 节所述的模型比较方法，以序贯 (sequential) 的方式将双向效应模型逐步拟合到观测数据上。常用的一种序列步骤如下 第一步. 拟合 \\(y_{ijk}=\\mu+\\varepsilon_{ijk}\\)，将其残差平方和表示为 \\(RSS_1\\). 第二步. 拟合 \\(y_{ijk}=\\mu+\\tau_i+\\varepsilon_{ijk}\\)，将其残差平方和表示为 \\(RSS_2\\). 第三步. 拟合 \\(y_{ijk}=\\mu+\\tau_i+\\beta_j+\\varepsilon_{ijk}\\)，将其残差平方和表示为 \\(RSS_3\\). 第四步. 拟合 \\(y_{ijk}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij}+\\varepsilon_{ijk}\\)，将其残差平方和表示为 \\(RSS_4\\). \\(RSS_i\\) 为第 \\(i(i=1,2,3,4)\\) 步拟合模型之后的残差平方和。\\(RSS_1\\) 与 \\(RSS_2\\) 之间的差记作 \\(R(\\tau|\\mu)\\)，称为调整 \\(\\mu\\) 后 \\(\\tau\\) 引起的缩减。即 \\(R(\\tau|\\mu)=RSS_1-RSS_2\\). 这个缩减给出了通过考虑将 \\(\\tau_i\\) 也包含在内的模型，可以减小第一步中模型的残差平方和。\\(R(\\tau|\\mu)\\) 越大，模型中包含 \\(\\tau_i\\) 就越重要。因此，\\(R(\\tau|\\mu)\\) 处理 T 不同可能性的效应的度量。\\(R(\\beta|\\mu,\\tau)=RSS_2-RSS_3\\) 称为同时调整 \\(\\mu\\) 和 \\(\\tau\\) 后 \\(\\beta\\) 引起的缩减。它表示通过在模型中进一步包含 \\(\\beta_j\\)，能够额外减少第二步模型残差平方和的量。\\(R(\\beta|\\mu,\\tau)\\) 是对处理 B 不同可能性的效应的一种度量，该效应独立于并超越了处理 T 的效应。最后，\\(R(\\gamma|\\mu,\\tau,\\beta)=RSS_3-RSS_4\\) 称为同时调整 \\(\\mu,\\tau,\\beta\\) 后 \\(\\gamma\\) 引起的缩减。它表示通过在模型的第三步中添加交互参数 \\(\\gamma_{ij}\\)，可以进一步减少模型残差平方和的额外量。显然，\\(R(\\gamma|\\mu,\\tau,\\beta)\\) 是交互作用的度量，因为第三步中的模型是一个加性模型，当且仅当没有交互作用时才成立。 表 10.1 给出了与序贯分析 (sequential analysis) 对应的方差分析表。这种分析称为 I 型分析。表 10.1 最后四行的平方和在统计上是独立的，并且 T, B 和 T × B 均方与误差均方的比都服从非中心 \\(F\\) 分布。确定表 10.1 中每个 \\(F\\) 统计量所检验的确切假设非常有趣且具有信息价值。所检验的假设在第 10.4 节中给出。 表 10.1: 序贯分析的方差分析表（I 型分析） x 为了说明这一点，对于 I 型分析所需的四个模型，均需拟合到表 9.1 中的数据。要理解此处进行的计算，需要熟悉第 6 章的内容。然而，对于那些愿意利用统计计算软件包执行所需计算的读者来说，这种理解不是必需的。对详细内容感兴趣的读者可以考虑接下来的几页内容进行深入学习和探讨。第一步中给出的模型为 \\(y_{ijk}={\\mu}+{\\varepsilon}_{ijk}\\). 该模型中 \\(\\mu\\) 的最佳估计是所有观测值的平均值 \\(\\hat{{\\mu}}=\\bar{y}_{\\cdot\\cdot\\cdot}=24.9375\\)，残差平方和为 \\[RSS_1=\\sum_{i,j,k}(y_{ijk}-\\hat{\\mu})^2=\\sum_{i,j,k}y_{ijk}^2-n_{\\cdot\\cdot}\\bar{y}^2_{\\cdot\\cdot\\cdot}=10209-16(24.9375)^2=258.9375\\] 该残差平方和基于 \\(n_{\\cdot\\cdot} = 16 - 1 = 15\\) 个自由度。 第二步中定义的模型的正规方程组为： \\[\\begin{bmatrix}16&amp;8&amp;8\\\\8&amp;8&amp;0\\\\8&amp;0&amp;8\\end{bmatrix}\\begin{bmatrix}\\hat{{\\mu}}\\\\\\hat{{\\tau}}_1\\\\\\hat{{\\tau}}_2\\end{bmatrix}=\\begin{bmatrix}399\\\\182\\\\217\\end{bmatrix}\\] 这些方程的一种可能解是通过使用第 6.2 节中讨论的置零限制获得的，可得 \\(\\hat{{\\tau}}_2=0,\\hat{{\\tau}}_1=-4.375,\\hat \\mu=27.125\\) （回想第 6 章，不存在唯一解）。残差平方和为 \\[ \\begin{aligned}RSS_2=\\sum_{i,j,k}(y_{ijk}-\\hat{\\mu}-\\hat{\\tau}_i)^2&amp;=\\sum_{i,j,k}y_{ijk}^2-\\hat{\\mu}\\cdot y_{\\cdot\\cdot\\cdot}-\\hat{\\tau}_1\\cdot y_{1\\cdot\\cdot}-\\hat{\\tau}_{2} \\cdot y_{2\\cdot\\cdot} \\\\ &amp;=10209-27.125\\cdot399-(-4.375)\\cdot 182-0\\cdot 217 \\\\ &amp;=182.375 \\end{aligned} \\] 基于 16-2=14 个自由度。因此，\\(R(\\tau|\\mu)=258.9375-182.375=76.5625\\) 基于 15-14=1 个自由度。 第三步中模型的正规方程组为 \\[\\begin{bmatrix}16&amp;8&amp;8&amp;5&amp;5&amp;6\\\\8&amp;8&amp;0&amp;3&amp;2&amp;3\\\\8&amp;0&amp;8&amp;2&amp;3&amp;3\\\\5&amp;3&amp;2&amp;5&amp;0&amp;0\\\\5&amp;2&amp;3&amp;0&amp;5&amp;0\\\\6&amp;3&amp;3&amp;0&amp;0&amp;6\\end{bmatrix}\\begin{bmatrix}\\hat{\\mu}\\\\\\hat{\\tau}_1\\\\\\hat{\\tau}_2\\\\\\hat{\\beta}_1\\\\\\hat{\\beta}_2\\\\\\hat{\\beta}_3\\end{bmatrix}=\\begin{bmatrix}399\\\\182\\\\217\\\\112\\\\119\\\\168\\end{bmatrix}\\] 为获得一个解，可以令 \\(\\tau_2 = 0\\) 且 \\(\\beta_3 = 0\\)（参见第 6 章）。然后，通过删除对应于 \\(\\tau = 0\\) 和 \\(\\beta = 0\\) 的行和列，可以将该方程组简化为等价的方程组。该系统简化为： \\[\\begin{bmatrix}16&amp;8&amp;5&amp;5\\\\8&amp;8&amp;3&amp;2\\\\5&amp;3&amp;5&amp;0\\\\5&amp;2&amp;0&amp;5\\end{bmatrix}\\begin{bmatrix}\\hat{\\mu}\\\\\\hat{\\tau}_1\\\\\\hat{\\beta}_1\\\\\\hat{\\beta}_2\\end{bmatrix}=\\begin{bmatrix}399\\\\182\\\\112\\\\119\\end{bmatrix}\\] 该简化系统的解为 \\(\\hat{\\mu}=30.154,\\hat{\\tau}_1=-4.308,\\hat{\\beta}_1=-5.169,\\hat{\\beta}_2=-4.631\\)。该模型的残差平方和为 \\[\\begin{aligned} RSS_3&amp; =\\sum_{i,j,k}y_{ijk}^2-\\hat{\\mu}\\cdot y_{\\cdot\\cdot\\cdot}-\\hat{\\tau}_1\\cdot y_{1\\cdot\\cdot}-\\hat{\\beta}_1\\cdot y_{\\cdot1\\cdot}-\\hat{\\beta}_2\\cdot y_{\\cdot2\\cdot} \\\\ &amp;=10209-30.154\\cdot399-(-4.308)\\cdot182-(-5.169)\\cdot112-(-4.631)\\cdotp119 \\\\ &amp;=91.631 \\end{aligned}\\] 基于 16-4=12 个自由度。因此 \\(R(\\beta|\\mu,\\tau)=RSS_2-RSS_3=182.375-91.631=90.744\\) 基于 14-12=2 个自由度。 第四步中模型的正规方程组为 \\[\\begin{bmatrix}16&amp;8&amp;8&amp;5&amp;5&amp;6&amp;3&amp;2&amp;3&amp;2&amp;3&amp;3\\\\8&amp;8&amp;0&amp;3&amp;2&amp;3&amp;3&amp;2&amp;3&amp;0&amp;0&amp;0\\\\8&amp;0&amp;8&amp;2&amp;3&amp;3&amp;0&amp;0&amp;0&amp;2&amp;3&amp;3\\\\5&amp;3&amp;2&amp;5&amp;0&amp;0&amp;3&amp;0&amp;0&amp;2&amp;0&amp;0\\\\5&amp;2&amp;3&amp;0&amp;5&amp;0&amp;0&amp;2&amp;0&amp;0&amp;3&amp;0\\\\6&amp;3&amp;3&amp;0&amp;0&amp;6&amp;0&amp;0&amp;3&amp;0&amp;0&amp;3\\\\3&amp;3&amp;0&amp;3&amp;0&amp;0&amp;3&amp;0&amp;0&amp;0&amp;0&amp;0\\\\2&amp;2&amp;0&amp;0&amp;2&amp;0&amp;0&amp;2&amp;0&amp;0&amp;0&amp;0\\\\3&amp;3&amp;0&amp;0&amp;0&amp;3&amp;0&amp;0&amp;3&amp;0&amp;0&amp;0\\\\2&amp;0&amp;2&amp;2&amp;0&amp;0&amp;0&amp;0&amp;0&amp;2&amp;0&amp;0\\\\3&amp;0&amp;3&amp;0&amp;3&amp;0&amp;0&amp;0&amp;0&amp;0&amp;3&amp;0\\\\3&amp;0&amp;3&amp;0&amp;0&amp;3&amp;0&amp;0&amp;0&amp;0&amp;0&amp;3\\end{bmatrix}\\left.\\left[\\begin{array}{c}\\hat{\\mu}\\\\\\hat{\\tau}_1\\\\\\hat{\\tau}_2\\\\\\hat{\\beta}_1\\\\\\hat{\\beta}_2\\\\\\hat{\\beta}_3\\\\\\hat{\\gamma}_{11}\\\\\\hat{\\gamma}_{12}\\\\\\hat{\\gamma}_{13}\\\\\\hat{\\gamma}_{21}\\\\\\hat{\\gamma}_{22}\\\\\\hat{\\gamma}_{23}\\end{array}\\right.\\right]=\\begin{bmatrix}399\\\\182\\\\217\\\\112\\\\119\\\\168\\\\60\\\\50\\\\72\\\\52\\\\69\\\\96\\end{bmatrix}\\] 为获得一个解，令 \\(\\hat{\\tau}_2=0,\\hat{\\beta}_3=0,\\hat{\\gamma}_{13}=0,\\hat{\\gamma}_{21}=0,\\hat{\\gamma}_{22}=0,\\hat{\\gamma}_{23}=0\\) （参见第 6 章）。使用缩减技术，系统简化为 \\[\\begin{bmatrix}16&amp;8&amp;5&amp;5&amp;3&amp;2\\\\8&amp;8&amp;3&amp;2&amp;3&amp;2\\\\5&amp;3&amp;5&amp;0&amp;3&amp;0\\\\5&amp;2&amp;0&amp;5&amp;0&amp;2\\\\3&amp;3&amp;3&amp;0&amp;3&amp;0\\\\2&amp;2&amp;0&amp;2&amp;0&amp;2\\end{bmatrix}\\begin{bmatrix}\\hat{\\mu}\\\\\\hat{\\tau}_1\\\\\\hat{\\beta}_1\\\\\\hat{\\beta}_2\\\\\\hat{\\gamma}_{11}\\\\\\hat{\\gamma}_{12}\\end{bmatrix}=\\begin{bmatrix}399\\\\182\\\\112\\\\119\\\\60\\\\50\\end{bmatrix}\\] 该简化系统的解为 \\(\\hat{\\mu}=32,\\hat{\\tau}_1=-8,\\hat{\\beta}_1=-6,\\hat{\\beta}_2=-9,\\hat{\\gamma}_{11}=2,\\hat{\\gamma}_{12}=10\\). 因此 \\(\\hat\\sigma^2=2\\)，因为完全模型 (full model) 的残差平方和为 \\(RSS_4=10,209-10,189=20\\)，基于 10 个自由度。而且 \\(R(\\gamma|\\mu,\\tau,\\beta)=RSS_3-RSS_4=91.631-20=71.631\\) 基于 12-10=2 个自由度。所有前面的结果都可以总结在方差分析表中，如表 10.2 所示。 表 10.2: I 型方差分析表 x I 型分析中的平方和以及交互作用的检验统计量与第 9 章中使用均值模型和矩阵程序获得的结果相同；然而，这两个程序对于 T 和 B 主效应给出了不同的平方和和检验统计量。双向处理结构中的数据也可以通过先拟合 \\(\\mu\\) 后 \\(\\beta\\) 再 \\(\\tau\\)，最后 \\(\\gamma\\) 来分析。表 10.2 中尚未给出的唯一所需的新平方和是 \\(R(\\beta|\\mu)\\) 和 \\(R(\\tau|\\mu,\\beta)\\). 对于不均衡数据情况，T 和 B 主效应的相应 \\(F\\) 检验通常与按表 10.1 和/或表 10.2 中给出的顺序拟合效应所获得的结果不同。 应回忆第 6 章中的参数估计 \\(\\hat{{\\mu}}=32,\\hat{{\\tau}}_1=-8,\\hat{{\\beta}}_1=-6,\\hat{\\beta}_2=-9,\\hat{\\gamma}_{11}=2,\\hat{\\gamma}_{12}=10\\) 不是相应参数 \\(\\mu,\\tau_1,\\beta_1,\\beta_2,\\gamma_{11},\\gamma_{12}\\) 的无偏估计。事实上，这些单独的参数是不可估的。在用于求解正规方程组的置零限制下，可以证明 \\[\\begin{align} &amp;\\hat{\\mu} \\,\\,\\text{is an unbiased estimate of}\\,\\, \\mu+\\tau_2+\\beta_3+\\gamma_{23} \\\\ &amp;\\hat{\\tau}_1 \\,\\,\\text{is an unbiased estimate of}\\,\\, \\tau_1-\\tau_2+\\gamma_{13}-\\gamma_{23} -\\gamma_{23} \\\\ &amp;\\hat{\\beta}_1 \\,\\,\\text{is an unbiased estimate of}\\,\\, \\beta_1-\\beta_3+\\gamma_{21}-\\gamma_{23} -\\gamma_{23} \\\\ &amp;\\hat{\\beta}_2 \\,\\,\\text{is an unbiased estimate of}\\,\\, \\beta_2-\\beta_3+\\gamma_{22}-\\gamma_{23} \\gamma_{23}\\\\ &amp;\\hat{\\gamma}_{11} \\,\\,\\text{is an unbiased estimate of}\\,\\, \\gamma_{11}-\\gamma_{13}-\\gamma_{21}+\\gamma_{23}\\\\ &amp;\\hat{\\gamma}_{12} \\,\\,\\text{is an unbiased estimate of}\\,\\, \\gamma_{12}-\\gamma_{13}-\\gamma_{22}+\\gamma_{23} \\tag{10.2} \\end{align}\\] 有关可估函数及其估计的更多信息，请参阅下一节。 10.3 在 SAS 中使用可估函数 SAS®-GLM 程序有一个选项，可用于识别模型参数的可估函数（不使用 SAS 的读者可以跳过本节）。由于使用示例来描述可估函数是最简单的，因此请再次考虑表 9.1 中的数据。可以使用以下语句获得该数据的 SAS-GLM 分析： PROC GLM; CLASSES T B; MODEL y = T B T*B/&lt;selected options&gt;; 许多选项可以与 MODEL 语句一起使用。其中最重要的选项之一是 E 选项。此选项要求 SAS-GLM 打印模型参数可估函数的一般形式。回想一下第 6 章，设计模型中参数的所有线性函数不一定都是可估的。使用 E 选项，SAS-GLM 会打印信息，这些信息可用于确定可估参数和不可估参数的线性组合。 SAS-GLM 给出的可估函数的一般形式如表 10.3 所示。这意味着模型参数的线性函数 \\(\\boldsymbol\\ell^\\prime\\boldsymbol \\beta\\) （其中 \\(\\boldsymbol\\ell^{\\prime}=[\\ell_1,\\ell_2,\\ldots,\\ell_{12}]\\) 和 \\(\\boldsymbol\\beta^{\\prime}=[\\mu,\\tau_1,\\tau_2,\\beta_1,\\beta_2,\\beta_3,\\gamma_{11},\\gamma_{12},\\gamma_{13},\\gamma_{21},\\gamma_{22},\\gamma_{23}]\\)）是可估的当且仅当存在常数 \\(L1,L2,L4,L5,L7,L8\\) 使得 \\[\\begin{aligned} \\boldsymbol{\\ell&#39;\\beta} = &amp;({L1})\\mu+({L2})\\tau_1+({L1}-{L2})\\tau_2+({L4})\\beta_1+({L5})\\beta_2+({L1}-{L4}-{L5})\\beta_3+({L7})\\gamma_{11}\\\\&amp;+(\\mathrm{L}8)\\gamma_{12}+(\\mathrm{L}2-\\mathrm{L}7-\\mathrm{L}8)\\gamma_{13}+(\\mathrm{L}4-\\mathrm{L}7)\\gamma_{21}+(\\mathrm{L}5-\\mathrm{L}8)\\gamma_{22} \\\\ &amp;+(L1-L2-L4-L5+L7+L8)\\gamma_{23} \\end{aligned}\\] 表 10.3: 可估函数的一般形式 x 例如，从可估函数的一般形式，我们可以看到： \\(\\mu\\) 是不可估的。因为要使得 \\(\\mu\\) 可估，至少需要同时满足 \\(L1 = 1,L2 = 0\\) 以及 \\(L1 - L2 = 0\\) 这三个条件，而这三个条件无法同时为真。 \\(\\tau_1\\) 是不可估的。因为要使得 \\(\\tau_1\\) 可估，至少需要同时满足 \\(L1 = 0、L2 = 0\\) 以及 \\(L1 - L2 = 0\\) 这三个条件，而这三个条件无法同时为真。 \\(\\tau_1 - \\tau_2\\) 不可估。因为要使得 \\(\\tau_1 - \\tau_2\\) 可估，至少需要同时满足 \\(L1 = 0,L2 = 1,L1 - L2 =-1,L4 = 0,L5 = 0,L1 - L4 - L5 = 0,L7 = 0,L 8 = 0\\) 以及 \\(L2 - L7 -L 8 = 0\\). 然而 \\(L2=1,L7=0,L8=0,L2-L7-L8\\) 无法同时为真。 很明显，模型参数有许多函数是不可估的，那么模型参数有哪些有趣的函数是可估的呢？从第 6 章中，我们知道模型参数存在可估的函数。实际上，模型参数的一组可估函数基 (a basis set of estimable functions) 定义为一组线性独立的可估函数，这样的一组函数确保了任何其他的可估函数都能够表示为此集合内可估函数的线性组合。在可估函数的一般形式中，我们可以看到，我们可以自由地选择 \\(L\\) 中的六个，即 \\(L1,L2,L4,L5,L7,L8\\). 因此在一个基中有六个线性无关的可估函数，一个容易得到的基是依次让六个 \\(L\\) 中的一个 等于 1，其余的 \\(L\\) 都等于 0. 例如，取 \\(L1 = 1\\) 和 \\(L2 = L4 = L5 = L7 = L8 = 0\\)，一般形式简化为 \\(\\mu + \\tau_2 + \\beta_3 + \\gamma_{23}\\)，这给出了一个模型参数的可估线性函数。取 \\(L2 = 1\\) 其它的 \\(L\\) 等于 0，一般形式简化为 \\(\\tau_1-\\tau_2+\\gamma_{13}-\\gamma_{23}\\)，这给出了令一个模型参数的可估线性函数。以如此方式继续可得到表 10.4 中给出的可估函数的一组基。 表 10.4: 可估函数的一组基 x 请注意，在该基中的线性函数数量为六，这与第 6 章讨论的 \\(\\boldsymbol X^\\prime\\boldsymbol X\\) 矩阵的秩相等，并且也等于该 2×3 实验中处理组合的数量。另外，请注意表 10.4 中的可估函数与满足置零限制正规方程组的解所估计的函数完全相同（如方程 (10.2) 所示）。这不是巧合；在使用 SAS-GLM 分析数据时，可以通过将一般形式中的每个 L 设为 1，其他 L 设为 0，从而找到由正规方程组置零解估计的函数，这总是成立的。 可估函数的基不是唯一的，表 10.5 给出了另一个可估函数的基，还给出了产生这个基的 \\(L1,L2,L4,L5,L7, L8\\) 的值。 表 10.5: 可估函数的另一组基 x 当在 SAS-GLM model 语句上使用 SOLUTION 选项时，计算机将使用置零限制打印出模型参数的最小二乘估计。SOLUTION 选项的结果如表 10.6 所示。注意，该 SOLUTION 选项的结果与第 10.2 节中给出的置零解一致，为方便起见，在此重复： \\[\\hat{\\mu}=32,\\hat{\\tau}_1=8,\\hat{\\beta}_1=-6,\\hat{\\beta}_2=-9,\\hat{\\gamma}_{11}=2,\\hat{\\gamma}_{12}=10\\] 表 10.6: SAS-GLM 中使用 SOLUTION 选项获得的结果 x 注释: 已发现 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 矩阵是奇异的，并且使用广义逆来求解正规方程。估计值后面跟着字母“B”的项不是唯一可估的 然而，如前所述，这些最小二乘估计值实际上并不直接估计它们各自对应的参数。事实上，正如先前所展示的那样，各个单独参数是不可估的。SAS-GLM 通过在表 10.6 中每个最小二乘估计旁边放置字母 B 来表明这一点。表 10.4 给出了这些估计是真正无偏估计的参数函数20。也就是说，\\(\\hat{\\mu}=32\\) 是 \\(\\mu+\\tau_2+\\beta_3+\\gamma_{23}\\) 的最佳无偏估计，\\(\\hat{{\\tau}}_1={-}8\\) 是 \\(\\tau_1-\\tau_2+\\gamma_{13}-\\gamma_{23}\\) 的最佳无偏估计，\\(\\hat{{\\tau}}_2=0\\) 估计值为 0（这意味着它在估计零值上做得相当好），\\(\\hat{{\\beta}}_1=-6\\) 是 \\(\\beta_1-\\beta_3+\\gamma_{21}-\\gamma_{23}\\) 的最佳无偏估计，以此类推。表 10.6 中打印的标准误是估计的实际标准误估计。即，\\(\\widehat {s.e.}( \\hat{\\mu})=0.8165,\\widehat{s.e.}(\\hat{\\tau}_1)=1.1547\\)，以此类推。表 10.6 中的 \\(t\\) 统计量检验被估计的相应函数是否等于零。例如对应于 \\(\\hat \\mu\\) 的 \\(t=39.19\\)，检验 \\(H_0\\colon\\mu+\\tau_2+\\beta_3+\\gamma_{23}=0\\). 这样的检验通常不是很有趣。通过在 SAS-GLM 程序中使用 CONTRAST 或 ESTIMATE 语句，人们可以对选择考虑的参数的任何可估线性组合进行推断。线性组合不必是对比，但它必须是可估的。幸运的是，SAS-GLM 总是检查指定的线性组合是否是可估的函数。如果是，则 ESTIMATE 语句给出其最佳无偏估计、标准误估计并检验被估参数函数是否等于零的 \\(t\\) 统计量和 \\(p\\) 值。CONTRAST 语句允许同时检验几个可估函数，并给出 \\(F\\) 统计量及其 \\(p\\) 值，如第 1 章所述。在我们的例子中，正确使用 ESTIMATE 语句需要以下形式： ESTIMATE &#39;label&#39; INTERCEPT C1 T C2 C3 B C4 C5 C6 T*B C7 C8 C9 C10 C11 C12; 如果一个特定效应的所有系数都为零，则该效应及其系数不需要包含在 ESTIMATE 语句中。要使用 CONTRAST 语句，只需在上述形式中将单词 ESTIMATE 替换为 CONTRAST。例如，要获得表 10.5 中给出的可估函数的最佳估计，可以使用： ESTIMATE 'OVERALL MEAN' INTERCEPT 1 T -5 -5 B .33333 .33333 .33333 T*B .16667 .16667 .16667 .16667 .16667 .16667; ESTIMATE 'TI -T2' T 1 —1 T*B .33333 .33333 .33333 —.33333 —.33333 -.33333; ESTIMATE 'Bl -B3' B 1 0 -1 T*B .5 0 -.5 .5 0 -.5; ESTIMATE 'B2 —B3' B 0 1 -1 T*B 0 .5 -.5 0 .5 -.5; ESTIMATE 'INT1' T*B 1 0 -1 -1 0 1; ESTIMATE 'INT2' T*B O 1 -1 0 -1 1; 10.4 I–IV 型假设 本书的许多读者可能已经意识到，SAS-GLM 为用户提供了从四种类型的平方和中选择一种来检验假设的选项。本节主要涉及定义和解释相应的四种类型的假设。表 9.1 中的数据将用于说明这些假设。如第 10.2 节所述，I 型平方和是通过以序贯方式拟合双向效应模型获得的。每一步所获平方和是衡量该步添加特定项的重要性的指标，是通过在模型中包含该项可以减少残差平方和的量。II 型分析也是利用模型比较技术获得的。针对模型中处于相同或较低水平的每个其他效应，调整与每个效应对应的平方和。因此，对应于 T 效应的 II 型平方和为 \\(R(\\tau|\\mu,\\beta)\\)，对应于 B 效应的 II 型平方和为 \\(R(\\beta|\\mu,\\tau)\\). 稍有困惑的读者应该参阅第 16.3 节，因为三向处理结构的 I 型和 II 型分析的定义将有助于澄清 I 型平方和与 II 型平方和之间的差异。表 10.7 显示了双向效应模型的 I 型和 II 型平方和，表 10.8 给出了表 9.1 中数据的 II 型平方和以及检验统计量。 表 10.7: I 型和 II 型平方和的定义 x 表 10.8: II 型方差分析表 x 我们建议实验者根据均值模型中的参数而不是效应模型中的参数来思考。使用效应模型来拟合双向实验的主要优点是，许多有趣的假设能够被自动检验；这使得实验者进行相关工作变得更为便捷。效应模型的缺点是实验者很难准确理解 I 型和 II 型平方和检验的内容。均值模型的主要优点是能够准确地理解正在检验和/或估计的内容。均值模型的缺点是实验者必须编写自己的 ESTIMATE 和 CONTRAST 语句来获得感兴趣的检验统计量。我们希望实验者对效应模型和均值模型都有所了解：效果模型可用于自动获得许多感兴趣的统计量，均值模型可用于识别感兴趣统计量所估计或检验的内容。 I 型和 II 型平方和检验了哪些假设？用 I 型平方和检验的假设称为 I 型假设。表 10.9 给出了 I 型分析检验的假设，对应的模型是在均值模型参数框架下的模型 (10.1)，数据来源于表 9.1 21 。稍后我们将展示如何从 SAS-GLM 程序中确定这些假设。显然，实验者很少对表 10.9 中对应于 T 和 B 的假设感兴趣，并且随着表 (9.1) 中一个或多个单元格中样本量的变化，假设也会发生变化。与 T×B 对应的假设相当于检验无交互作用假设。也就是说，在这个特定示例中，对比 \\[\\mu_{11}-\\mu_{13}-\\mu_{21}+\\mu_{23}\\quad\\mathrm{and}\\quad\\mu_{12}-\\mu_{13}-\\mu_{22}+\\mu_{23}\\] 张成交互作用空间 (span the iteraction space). 表 10.10 给出了以均值模型参数表示的双向实验的 I 型假设的一般公式。注意，从一般形式中我们可以看到，T 的 I 型假设使用每个单元格内的样本量作为权重来比较行单元格均值的加权平均值。例如，对于表 9.1 中的数据，T 的 I 型假设可以写成 \\[H_0{:}\\frac{3\\mu_{11}+2\\mu_{12}+3\\mu_{13}}8=\\frac{2\\mu_{21}+3\\mu_{212}+3\\mu_{213}}8\\] 表 10.9: 表 9.1 中数据的均值模型 I 型分析的假设 x 表 10.10: 用均值模型参数表示的双向效应模型 I 型假设的一般形式 x 对于表 9.1 中的数据，表 10.11 中给出了根据平均模型参数进行 II 型分析检验的假设。 表 10.11: 表 9.1 中数据的均值模型进行 II 型分析的假设 x 对于一般模型，T 效应对应的行检验的 II 型假设为 \\[\\begin{equation} \\sum_{j=1}^b\\left(n_{ij}-\\frac{n_{ij}^2}{n_{\\cdot j}}\\right)\\mu_{ij}=\\sum_{i^{\\prime}=1}^t\\sum_{j=1}^b\\frac{n_{ij}n_{i^{\\prime}j}}{n_{\\cdot j}}\\mu_{i^{\\prime}j},\\quad i=1,2,\\ldots,t \\tag{10.3} \\end{equation}\\] 表 10.12 和表 10.13 给出了根据方程 (10.1) 中的效应模型参数对表 9.1 中的数据进行的 I 型和 II 型假设。 表 10.12: 表 9.1 中数据的效应模型进行 I 型分析的假设 x 表 10.13: 表 9.1 中数据的效应模型进行 II 型分析的假设 x 对表 10.10-10.13 的检查表明，I 型和 II 型分析检验的主效应假设可能不是很有趣。此外，拒绝或接受这些假设可能不容易解释。 计算效应模型平方和的第三种方法如下： 对于处理 T 的 t 个水平，生成 t - 1 个哑变量 (dummy variables)，对于处理 B 的 b 个水平，生成 b - 1 个哑变量。创建与 \\(\\tau\\) 和 \\(\\beta\\) 对应的哑变量，以便在具有哑变量的模型中有 \\(\\tau_t=-(\\tau_1+\\tau_2+\\cdots+\\tau_{t-1})\\) 和 \\(\\beta_t=-(\\beta_1+\\beta_2+\\cdots+\\beta_{t-1})\\). T 和 B 之间的交互作用由它们相应的哑变量的乘积表示。特别的，对于 \\(j=1,2,\\cdots,b\\) 有 \\(\\gamma_{tj}=-(\\gamma_{1j}+\\gamma_{2j}+\\cdots+\\gamma_{t-1j})\\) 以及对于 \\(i=1,2,\\cdots,t\\) 有 \\(\\gamma_{ib}=-(\\gamma_{i1}+\\gamma_{i2}+\\cdots+\\gamma_{ib-1})\\). 拟合具有处理变量所有哑变量及其交互作用的模型，并获得残差平方和。这相当于全效应模型 (full-effects model) 的残差平方和。 接下来，拟合一个模型，其中包含所有哑变量，除了与正在检验的主效应或交互作用对应的哑变量。该缩减模型的残差平方和与步骤 3 中模型的残差平方和之间的差值就是与该效应对应的平方和。 由此产生的分析称为 III 型分析。它也被称为 Yates’s weighted squares of means technique. 当观测到所有处理组合时，III 型分析检验的假设与均衡数据集检验的假设相同。表 10.14 给出了这些 III 型假设的平均模型参数，表 10.15 给出了效应模型参数。这些假设通常是实验者想要的，表 10.16 给出了表 9.1 中数据的 III 型平方和。 表 10.14: 基于均值模型的效应模型的 III 型假设 x 表 10.15: 根据效应模型参数对效应模型的 III 型假设 x 表 10.16: III 型方差分析表 x 对于表 9.3 中的数据，通过 Yates’s method 重新参数化的模型的矩阵形式为 \\[\\begin{bmatrix}19\\\\20\\\\21\\\\24\\\\22\\\\25\\\\25\\\\25\\\\27\\\\21\\\\24\\\\21\\\\32\\\\33\\end{bmatrix}=\\begin{bmatrix}1&amp;-1&amp;1&amp;0&amp;-1&amp;0\\\\1&amp;-1&amp;1&amp;0&amp;-1&amp;0\\\\1&amp;-1&amp;0&amp;1&amp;0&amp;-1\\\\1&amp;-1&amp;0&amp;1&amp;0&amp;-1\\\\1&amp;-1&amp;0&amp;1&amp;0&amp;-1\\\\1&amp;-1&amp;-1&amp;-1&amp;1&amp;1\\\\1&amp;-1&amp;-1&amp;-1&amp;1&amp;1\\\\1&amp;-1&amp;-1&amp;-1&amp;1&amp;1\\\\1&amp;1&amp;1&amp;0&amp;1&amp;0\\\\1&amp;1&amp;1&amp;0&amp;1&amp;0\\\\1&amp;1&amp;1&amp;0&amp;1&amp;0\\\\1&amp;1&amp;0&amp;1&amp;0&amp;1\\\\1&amp;1&amp;0&amp;1&amp;0&amp;1\\\\1&amp;1&amp;-1&amp;-1&amp;-1&amp;-1\\\\1&amp;1&amp;-1&amp;-1&amp;-1&amp;-1\\\\1&amp;1&amp;-1&amp;-1&amp;-1&amp;-1\\end{bmatrix}\\begin{bmatrix}\\mu\\\\\\tau_1\\\\\\beta_1\\\\\\beta_2\\\\\\gamma_{11}\\\\\\gamma_{12}\\end{bmatrix}+\\begin{bmatrix}{\\varepsilon}_{111}\\\\{\\varepsilon}_{112}\\\\{\\varepsilon}_{113}\\\\{\\varepsilon}_{121}\\\\{\\varepsilon}_{122}\\\\{\\varepsilon}_{131}\\\\{\\varepsilon}_{132}\\\\{\\varepsilon}_{133}\\\\{\\varepsilon}_{211}\\\\{\\varepsilon}_{212}\\\\{\\varepsilon}_{213}\\\\{\\varepsilon}_{221}\\\\{\\varepsilon}_{222}\\\\{\\varepsilon}_{231}\\\\{\\varepsilon}_{232}\\\\{\\varepsilon}_{233}\\end{bmatrix}\\] 请注意，上述设计矩阵中的第五列（对应于 \\(\\gamma_{11}\\)）是第二列和第三列（对应于 \\(\\tau_{1}\\) 和 \\(\\beta_1\\)）的乘积，第六列（对应于 \\(\\gamma_{12}\\)）是第二列和第四列的乘积（对应于 \\(\\tau_1\\) 和 \\(\\beta_2\\)）。 SAS-GLM 引入了第四种生成与主效应及其交互作用对应的平方和的方法。当观测到所有处理组合时，IV 型分析检验的假设与 III 型分析检验的假设相同；然而，当未观测到某些处理组合时，III 型和 IV 型分析不一致。我们将在第 14 章讨论 IV 型假设的构建。 作为本节的总结，在分析没有缺失处理组合的双向处理结构模型中的数据时，我们提出以下建议： 如果实验者想比较两种处理的效应，她应该关注 III 型分析所检验的假设。这些假设等价于在均衡或相等子类数量情况下检验的假设。 如果实验者有兴趣建立一个模型来预测特定处理组合的效应，那么她可以使用 I 型和/或 II 型分析。 在抽样调查实验中，每个处理组合的观测数量通常与这些组合在总体中实际发生的频率成正比。在这种情况下，实验者可能对基于 \\(R(\\tau|\\mu,\\beta)\\) 和 \\(R(\\beta|\\mu,\\tau)\\) 的假设最感兴趣，因为这些平方和检验了有关行均值和列均值的加权平均值的假设，权重与观测到的样本量成正比。如果使用 SAS-GLM，这可能需要两次 I 型分析，一次先在模型中纳入 T，另一次则先在模型中纳入 B. 10.5 在 SAS-GLM 中使用 I–IV 型可估函数 在本节中，我们展示了如何使用 SAS-GLM 提供的信息来确定由不同类型的平方和检验的假设（不使用 SAS-GLM 的读者可以跳过本节）。在第 10.3 节中，我们讨论了通过使用 MODEL 语句上的 E 选项获得的可估函数的一般形式。如果选择了 E1 选项，SAS-GLM 将为每个效应打印 I 型可估函数的一般形式。当使用效应模型时，该选项对表 9.1 中数据的结果如表 10.17 所示。 表 10.17: 表 9.1 中数据的 SAS-GLM 的 I 型可估函数 x 根据表 10.17，我们发现 \\(\\boldsymbol \\beta=[\\mu,\\tau_1,\\tau_2,\\beta_1,\\beta_2,\\beta_3,\\gamma_{11},\\gamma_{12},\\gamma_{13},\\gamma_{21},\\gamma_{22},\\gamma_{23}]\\) 的线性组合 \\(\\boldsymbol \\ell^\\prime \\boldsymbol \\beta\\) 是 I 型可估函数当且仅当存在常数 \\(L2\\) 使得 \\[\\begin{aligned} \\boldsymbol \\ell^\\prime \\boldsymbol \\beta =&amp;(L2)\\tau_1-(L2)\\tau_2+(0.125\\cdot L2)\\beta_1-(0.125\\cdot L2)\\beta_2 \\\\ &amp;+(0.375\\cdot L2)\\gamma_{11}+(0.25\\cdot L2)\\gamma_{12}+(0.375\\cdot L2)\\gamma_{13} \\\\ &amp;-(0.25\\cdot L2)\\gamma_{21}-(0.375\\cdot L2)\\gamma_{22}-(0.375\\cdot L2)\\gamma_{23} \\end{aligned}\\] T 的 I 型可估函数的基可以通过选择 \\(L2\\) 的特定值来获得，例如 \\(L2 = 1\\) 或 \\(L2 = 8\\). 我们可以自由地仅选择可估函数一般形式的 \\(L\\) 中的一个，其对应于与 T 的 I 型平方和相关的 1 个自由度；剩下的所有 \\(L\\) 都由我们对 \\(L2\\) 的选择决定。对于我们的示例，\\(L1 = 0,L4 = 0.125 · L,L5 = -0.125 · L2,L7 = 0.375 · L2\\) 和 \\(L8 = 0.25 · L2\\). 取 \\(L2=1\\)，I 型可估函数的基为 \\[\\{\\tau_1-\\tau_2+(1/8)(\\beta_1-\\beta_2)+(1/8)(3\\gamma_{11}+2\\gamma_{12}+3\\gamma_{13}-2\\gamma_{21}-3\\gamma_{22}-3\\gamma_{23})\\}\\] 该参数函数是通过 I 型分析与零进行比较的函数。参见表 10.11. 另一个基可以通过取 \\(L2 = 8\\) 来构造，由下式给出 \\[\\{8\\tau_1-8\\tau_2+\\beta_1-\\beta_2+3\\gamma_{11}+2\\gamma_{12}+3\\gamma_{13}-2\\gamma_{21}-3\\gamma_{22}-3\\gamma_{23}\\}\\] 由于 \\(\\mu_{ij} = \\mu + \\tau_i + \\beta_j + \\gamma_{ij}\\)，在均值模型参数框架下所检验的假设可以通过将效应模型表示中的 \\(\\gamma_{ij}\\) 上的系数分配给均值模型表示中的 \\(\\mu_{ij}\\) 来确定。因此，以均值模型参数表达的 T 的 I 型假设为 \\[\\begin{array}{l}(3\\mu_{11}+2\\mu_{12}+3\\mu_{13}-2\\mu_{21}-3\\mu_{22}-3\\mu_{23})/8=0\\text{ or equivalently that}\\\\3\\mu_{11}+2\\mu_{12}+3\\mu_{13}-2\\mu_{21}-3\\mu_{22}-3\\mu_{23}=0\\end{array}\\] 这是表 10.9 中给出的关于 T 的假设。 如果选择 MODEL 语句上的 E2 选项，SAS-GLM 将打印每种效应的 II 型可估函数的一般形式。表 9.1 中的数据结果如表 10.18 所示。 表 10.18: 表 9.1 中数据的 SAS-GLM 的 II 型可估函数 x 根据表 10.18 可以看出，\\(\\boldsymbol \\ell^\\prime \\boldsymbol \\beta\\) 是 II 型可估函数当且仅当存在常数 \\(L4,L5\\) 使得 \\[ \\begin{aligned}\\boldsymbol{\\ell}^{\\prime}\\boldsymbol{\\beta} =&amp;(L4)\\beta_1+(L5)\\beta_2+(-L4-L5)\\cdot\\beta_3+(0.5692\\cdot L4+0.0308\\cdot L5)\\gamma_{11}\\\\ &amp;+(-0.0308\\cdot L4+0.4308\\cdot L5)\\gamma_{12}+(-0.5385\\cdot L4-0.4615\\cdot L5)\\gamma_{13} \\\\ &amp;+(0.4308\\cdot\\text{L4- }0.0308\\cdot L5)\\gamma_{21}+(0.0308\\cdot L4+0.5692\\cdot L5)\\gamma_{22} \\\\ &amp;+(-0.4615\\cdot L4-0.5385\\cdot L5)\\gamma_{23} \\end{aligned} \\] 在这种情况下，我们可以选择两个 L 的值，即 \\(L4\\) 和 \\(L5\\). 因此，B 的 II 型平方和有 2 个自由度。运气好的话，或者使用表 10.9 中给出的一般形式，我们可以确定上述表达式中给出的十进制数有一个最小公分母 65. 选择 \\(L4 = 1\\) 和 \\(L5 = 0\\)，然后选择 \\(L4 = 0\\) 和 \\(L5 = 1\\)， 可以为 B 的 II 类可估函数提供一个基，在效应模型参数框架下为 \\[\\begin{array}{l}\\{\\beta_1-\\beta_3+(1/65)(37\\gamma_{11}-2\\gamma_{12}-35\\gamma_{13}+28\\gamma_{21}+2\\gamma_{22}-30\\gamma_{23})\\mathrm{~and}\\\\\\beta_2-\\beta_3+(1/65)(2\\gamma_{11}+28\\gamma_{12}-30\\gamma_{13}-2\\gamma_{21}+37\\gamma_{22}-35\\gamma_{23})\\}\\end{array}\\] 对于第一个函数，令 \\(L4 = 65\\) 且 \\(L5 = 0\\)；对于第二个函数，令 \\(L4 = 0\\) 且 \\(L5 = 65\\)，可得到在均值模型参数框架下的基 \\[\\begin{gathered} \\{37{\\mu}_{11}-2{\\mu}_{12}-35{\\mu}_{13}+28{\\mu}_{21}+2{\\mu}_{22}-30{\\mu}_{23}\\mathrm{~and} \\\\ 2\\mu_{11}+28\\mu_{12}-30\\mu_{13}-2\\mu_{21}+37\\mu_{22}-35\\mu_{23}\\} \\end{gathered}\\] 从表 10.17 和/或表 10.18 中 T × B 的 I 型和/或 II 型可估函数的一般形式，可以看出有两个 L 值可供选择。 通过令 \\(L7 = 1\\) 和 \\(L8 = 0\\)，然后令 \\(L7 = 0\\) 和 \\(L8 = 1\\)，可以得到 T × B 的 I 型可估函数的一个基，在效应模型参数框架下将产生 \\[\\{\\gamma_{11}-\\gamma_{13}-\\gamma_{21}+\\gamma_{23}\\mathrm{~and~}\\gamma_{12}-\\gamma_{13}-\\gamma_{22}+\\gamma_{23}\\}\\] 在均值模型参数框架下将产生 \\[\\{\\mu_{11}-\\mu_{13}-\\mu_{21}+\\mu_{23}\\mathrm{~and~}\\mu_{12}-\\mu_{13}-\\gamma_{22}+\\mu_{23}\\}\\] 读者可能希望验证，对于所有 \\(i\\ne i^\\prime\\) 和 \\(j\\ne j^\\prime\\)，每个 2 × 2 表的差 \\(\\mu_{ij}-\\mu_{ij&#39;}-\\mu_{i&#39;j}+\\mu_{i&#39;j&#39;}=0\\) 都可以作为这个基中这两个函数的线性组合。 根据表 10.18，T 的 II 型可估函数的一般形式由下式给出 \\[\\begin{array}{c}(L2)\\tau_1-(L2)\\tau_2+(0.3077\\cdot L2)\\gamma_{11}+(0.3077\\cdot L2)\\gamma_{12}+(0.3846\\cdot L2)\\gamma_{13}\\\\+(-0.3077\\cdot L2)\\gamma_{21}+(-0.3077\\cdot L2)\\gamma_{22}+(-0.3846\\cdot L2)\\gamma_{23}\\end{array}\\] 这些十进制分数的最小公分母是 13；因此，取 \\(L2 = 1\\)，T 的 II 类可估函数的基，在效应模型参数框架下为 \\[\\{\\tau_1-\\tau_2+(1/13)(4\\gamma_{11}+4\\gamma_{12}+5\\gamma_{13}-4\\gamma_{21}-4\\gamma_{22}-5\\gamma_{23})\\}\\] 在均值模型参数框架下为（取 \\(L2=13\\)） \\[\\{4\\mu_{11}+4\\mu_{12}+5\\mu_{13}-4\\mu_{21}-4\\mu_{22}-5\\mu_{23}\\}\\] 最后，我们考虑 III 和 IV 型可估函数。对于表 9.1 中的数据，它们是相同的；如表 10.19 所示。T 的 III 型可估函数的基，在效应模型参数框架下为 \\[\\{\\tau_1-\\tau_2+\\bar{\\gamma}_{1\\cdot}-\\bar{\\gamma}_{2\\cdot}\\}\\] 在均值模型参数框架下为（在两种情况下都取 \\(L2=1\\)） \\[\\{\\bar{\\mu}_{\\cdot 1}-\\bar{\\mu}_{\\cdot 2}\\}\\] 表 10.19: 表 9.1 中数据的 SAS-GLM 的 III 型可估函数 x 以类似的方式，我们可得到 B 的 III 型可估函数的基，在效应模型参数框架下为 \\[\\{\\beta_1-\\beta_3+\\bar{\\gamma}_{\\cdot1}-\\bar{\\gamma}_{\\cdot 3}\\mathrm{~and~}\\beta_2-\\beta_3+\\bar{\\gamma}_{\\cdot 2}-\\bar{\\gamma}_{\\cdot 3}\\}\\] 在均值模型参数框架下为 \\[\\{\\bar{\\mu}_{\\cdot1}-\\bar{\\mu}_{\\cdot3}\\mathrm{~and~}\\bar{\\mu}_{\\cdot2}-\\bar{\\mu}_{\\cdot3}\\}\\] 请注意，\\(H_0\\colon\\bar{{\\mu}}_{\\cdot1}-\\bar{{\\mu}}_{\\cdot3}=0\\mathrm{~and~}\\bar{{\\mu}}_{\\cdot2}-\\bar{{\\mu}}_{\\cdot3}=0\\) 为真当且仅当 \\(H_0\\colon\\bar{\\mu}_{1\\cdot}=\\bar{\\mu}_{2\\cdot}=\\bar{\\mu}_{3\\cdot}\\) 为真。读者可以验证表 9.1 中数据的 IV 型可估函数与 III 型可估函数是否相同。 10.6 总体边际均值与最小二乘均值 双向效应模型的总体边际均值定义为，对于处理 T \\[\\bar{\\mu}_{i\\cdot}=\\mu+\\tau_i+\\bar{\\beta}_{\\cdot}+\\bar{\\gamma}_{i\\cdot},\\quad i=1,2,\\ldots,t\\] 对于处理 B \\[\\bar{\\mu}_{\\cdot j}=\\mu+\\bar{\\tau}_{\\cdot}+\\bar{\\beta}_j+\\overline{\\gamma}_{\\cdot j},\\quad j=1,2,\\ldots,b\\] 这些边际均值的最佳估计分别为 \\[\\hat{\\bar{\\mu}}_{i\\cdot}=\\hat{\\mu}+\\hat{\\tau}_i+\\hat{\\bar{\\beta}}_{\\cdot}+\\hat{\\bar{\\gamma}}_i.,i=1,2,\\ldots,t\\quad\\mathrm{and}\\quad\\hat{\\bar{\\mu}}_{\\cdot j}=\\hat{\\mu}+\\hat{\\bar{\\tau}}_{\\cdot}+\\hat{\\bar{\\beta}}_j+\\hat{\\bar{\\gamma}}_{\\cdot j},~j=1,2,\\ldots,b\\] 这些边际均值的估计通常被称为最小二乘均值。它们各自的标准误由方程 (9.5) 和 (9.7) 给出。为了对总体边际均值的线性组合进行推断，可以使用 (9.5) 和 (9.6)。如果在 SAS-GLM 程序中使用 LSMEANS T B T*B/PDIFF; 选项，则得到边际均值和双向单元格均值的最佳无偏估计，以及这些均值某些子集之间的成对比较。这些数据如表 10.20 所示。请注意，T 和 B 的最小二乘均值与表 9.2 中给出的 T 和 B 均值相同，双向均值与表 9.2 中的单元格均值相同。表 10.20 还提供了最小二乘均值的标准误估计和用于最小二乘均值之间成对比较的 \\(p\\) 值。例如，\\(\\hat{{\\mu}}_{1\\cdot}\\) 的标准误估计为 0.51，这与第 9.5 节中计算的标准误估计一致。此外，表 10.20 中给出了将 \\(\\hat{{\\mu}}_{1\\cdot}\\) 与 \\(\\hat{{\\mu}}_{2\\cdot}\\) 进行比较的 \\(p=0.0002\\)，这与第 9.5 节中计算的 \\(t\\) 统计量的 \\(p\\) 值一致。可以对其他估计、标准误和检验统计量进行类似的比较。 表 10.20: 边际均值和单元格均值的最佳估计 x 10.7 计算机分析 几乎所有的统计计算包都是为了处理效应模型而不是均值模型而开发的。由于三种主要类型的假设可以检验具有不相等子类数量的均衡双向处理结构，因此必须小心确定所使用的统计软件包检验的是哪种类型。尽管这些计算软件包是为了处理效应模型而开发的，但均值模型也可以很容易地实现。使用均值模型允许用户指定处理均值之间的有意义对比。本讨论中使用的名称，即 I, II, III 和 IV 型，与 SAS 使用的名称相对应。SPSS 使用相同的表示法，并将生成 I, II 和 III 型分析。SPSS 默认使用 III 型分析。默认情况下，SAS-GLM 同时生成 I 型和 III 型分析。鼓励使用其他计算软件包的读者分析表 9.1 中的数据，然后将其分析结果与本章和第 9 章中的分析进行比较。这种比较应该能够揭示出他们的计算软件包生成的是哪种类型的分析。SAS-GLM 还允许如下语句来计算均值 MEANS T B T*B/&lt;options&gt;; 然而，对于不均衡的数据，Means 语句并没有给出总体边际均值的无偏估计，而是计算行均值和列均值的加权平均值的估计值。也就是说，上述 Means 选项给出了加权均值的最佳无偏估计，其定义为 \\[\\tilde{\\mu}_{i.}=\\frac1{n_{i\\cdot}}\\sum_{j=1}^{b}n_{ij}\\mu_{ij},\\mathrm{~}i=1,2,\\ldots,t\\quad\\mathrm{and~}\\quad\\tilde{\\mu}_{\\cdot j}=\\frac1{n_{\\cdot j}}\\sum_{i=1}^{t}n_{ij}\\mu_{ij},\\mathrm{~}j=1,2,\\ldots,b\\] 实验者可能对这些加权平均值感兴趣的唯一情况可能是抽样调查实验（见第 10.4 节末尾的第三条建议）。 对于表 9.1 中的数据，这些加权平均值的最佳估计值，T 加权均值为 \\(\\bar y_{1\\cdot\\cdot}=22.75\\) 和 \\(\\bar y_{2\\cdot\\cdot}=27.125\\)，B 加权均值为 \\(\\bar y_{\\cdot1\\cdot}=22.2,\\bar y_{\\cdot2\\cdot}=23.8\\) 和 \\(\\bar y_{\\cdot3\\cdot}=28.0\\). 10.8 结束语 在本章中，假设所有处理组合都被观测到，使用效应模型对子类数量不等的双向处理结构进行了分析。尽管均值模型可以回答所有可能提出的问题，但在这里使用了效应模型，因为现有的大部分统计计算软件都使用效应模型。讨论了 I–III 型分析以及每种分析类型的使用条件。在几乎所有情况下，III 型分析将是首选的分析。III 型分析与第九章中给出的分析相同。将总体边际均值与加权边际均值进行对比，并考虑每种均值的适用性。 值得注意的是，如果关于表 9.1 中的数据建立双向加性模型， \\[y_{ijk}=\\mu+\\tau_i+\\beta_j+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,t;\\quad j=1,2,\\ldots,b;\\quad k=1,2,\\ldots,n_{ij}\\] 在包括交互项的双向模型分析中，T 和 B 的 II 型和 III 型平方和将彼此相同，并且它们都等于包含交互项的双向模型分析中 T 和 B 的 II 型平方和。 The functions of the parameters that these estimators are really unbiased estimates of are those given in Table 10.4.↩︎ 原文：Table 10.9 gives the hypotheses tested by a type I analysis of the data in Table 9.1 for model (10.1) in terms of the parameters in a means model.↩︎ "],["chap11.html", "第 11 章 分析子类数不等的大型均衡双向实验 11.1 可行性问题 11.2 未加权均值法 11.3 同时推断与多重比较 11.4 未加权均值的示例 11.5 计算机分析 11.6 结束语", " 第 11 章 分析子类数不等的大型均衡双向实验 “The science of statistics is the chief instrumentality through which the progress of civilization is now measured, and by which its development hereafter will be largely controlled.” - S. N. D. North 在本章中，我们提出了一种方法，用于获得均衡处理结构实验的近似分析，这些实验在每个单元格中具有不等数量的观测结果。 11.1 可行性问题 我们通常建议使用通用计算包，如第 10.7 节中讨论的计算包，来分析不均衡的数据集，其中每个处理组合至少观察一次。然而，在实践中出现了许多这样做可能不可行的情况，特别是在发展中国家，人们可能有几个处理因素，每个因素都有几个不同的水平。在这些情况下，精确的程序需要进行多次矩阵求逆，而要求逆的矩阵的大小可能超过研究人员和可用计算机的能力。 例如，考虑一个有四个因素的实验，每个因素都发生在五个水平上。为了获得精确的分析，必须能够对几个大矩阵求逆。在这种情况下，为了进行精确分析，需要求逆的最大矩阵的大小是不均衡情况下的 624×624 矩阵。显然，这样的实验并不罕见。此外，一些大型实验可能需要良好的初始起始值，以便迭代算法能够收敛到合理的解。本章中的方法可以让研究人员在难以使程序收敛的情况下找到良好的初始起始值。 分析这些类型的混乱数据情况的另一种方法称为未加权均值法 (methods of unweighted means)（Bancroft 1968）。第 11.2 节对双向处理结构的方法进行了描述。虽然人们很少遇到无法通过一般计算程序进行分析的双向实验，但对于双向实验，未加权均值法很容易被讨论和理解，并且这种讨论很容易推广到更大的实验情况。在继续之前，我们想指出的不是测量到的观测结果的数量使一般程序不可行，而是正在研究的处理组合的数量。 11.2 未加权均值法 基本上，未加权均值法通过使用各种处理组合的观测均值来近似对应于每个效应的平方和。这里给出的公式是用于等样本量的公式；然而，如果样本量只是略有不同，它们仍然可以给出相当准确的结果。正确的平方和可以通过使用 III 型分析获得，本章中给出的公式近似于 III 型平方和。 考虑第 9 章和第 10 章中描述的双向模型，其中因素 T 有 t 种可能性，因素 B 有 b 种可能性。令 \\(\\mu_{ij}\\) 代表人们期望在随机选择的实验单元上观测的响应，该实验单元接收 \\(T_i\\) 与 \\(B_j\\) 交叉的组合。令 \\[\\hat{\\mu}_{ij}=\\bar{y}_{ij\\cdot}\\quad i=1,2,\\ldots,t,j=1,2,\\ldots,b\\] 并令 \\[\\hat{\\bar{\\mu}_{i\\cdot}}=\\frac1b\\sum_{j=1}^b\\hat{\\mu}_{ij}\\quad\\mathrm{~and~}\\quad\\hat{\\bar{\\mu}}_{\\cdot j}=\\frac1t\\sum_{i=1}^t\\hat{\\mu}_{ij}\\] 对于检验 \\(H_{0T}\\colon\\bar{\\mu}_{1\\cdot}=\\bar{\\mu}_{2\\cdot}=\\cdots=\\bar{\\mu}_{t\\cdot}\\)，我们计算 \\[\\begin{aligned}SST=b\\sum_{i=1}^t(\\hat{\\bar{\\mu}}_{i\\cdot}-\\hat{\\bar{\\mu}}_{\\cdot\\cdot})^2=\\sum_{i=1}^tb\\hat{\\bar{\\mu}}_{i\\cdot}^2-bt\\hat{\\bar{\\mu}}_{\\cdot\\cdot}^2\\end{aligned}\\] 基于 t-1 个自由度。对于检验 \\(H_{0B}{\\colon}\\bar{{\\mu}}_{\\cdot1}=\\bar{{\\mu}}_{\\cdot2}=\\cdots=\\bar{{\\mu}}_{\\cdot b}\\)，我们计算 \\[SSB=t\\sum_{j=1}^b(\\hat{\\bar{\\mu}}_{\\cdot j}-\\hat{\\bar{\\mu}}_{\\cdot\\cdot})^2=t\\sum_{j=1}^b\\hat{\\bar{\\mu}}_{\\cdot j}^2-bt\\hat{\\bar{\\mu}}_{\\cdot\\cdot}^2\\] 基于 b-1 个自由度。对于所有 \\(i\\ne i^\\prime\\) 和 \\(j\\ne j^\\prime\\) 的检验 \\(H_{0T\\times B}{:{\\mu}_{ij}-{\\mu}_{i&#39;j}-{\\mu}_{ij&#39;}+{\\mu}_{i&#39;j&#39;}=0}\\)，我们计算 \\[SST\\times B=\\sum_{i=1}^t\\sum_{j=1}^b(\\hat{\\mu}_{ij}-\\hat{\\bar{\\mu}}_{i\\cdot}-\\hat{\\bar{\\mu}}_{\\cdot j}+\\hat{\\bar{\\mu}}_{\\cdot\\cdot})^2=\\sum_{i=1}^t\\sum_{j=1}^b\\hat{\\mu}_{ij}^2-b\\sum_{i=1}^t\\hat{\\bar{\\mu}}_{i\\cdot}^2-t\\sum_{j=1}^b\\hat{\\bar{\\mu}}_{\\cdot j}^2+bt\\hat{\\bar{\\mu}}_{\\cdot\\cdot}^2\\] 基于 (t-1)(b-1) 个自由度。由于上述平方和是根据平均值计算的，因此通常的误差平方和 \\[SSError=\\sum_{i=1}^t\\sum_{j=1}^{b}\\sum_{k=1}^{n_{ij}}(y_{ijk}-\\bar{y}_{ij\\cdot})^2\\] 需要调整。因为 \\(\\hat\\mu_{ij}\\) 的方差由 \\(\\sigma^2/n_{ij}\\) 给出而不是由 \\(y_{ijk}\\) 的方差 \\(\\sigma^2\\) 给出。该调整是通过将误差平方和除以 \\[\\tilde{n}=\\left[\\frac1{bt}{\\left(\\sum_{i=1}^{t}\\sum_{j=1}^{b}\\frac1{n_{ij}}\\right)}\\right]^{-1}\\] 单元格样本量的调和平均值以给出。 \\(\\tilde{n}\\) 是样本量的调和平均值，它是 \\(n_{ij}\\) 的一种可能平均值。误差自由度仍然是 N - bt. 表 11.1 给出了未加权均值分析的方差分析表。当单元格样本量相差不大时，此分析会产生 \\(F\\) 分布的合理近似值。通常的建议是，如果样本量的变化不超过 2 倍，则该分析是可以接受的。 表 11.1: 未加权均值的方差分析表 x 11.3 同时推断与多重比较 T 边际均值和 B 边际均值的定义与第 9 章和第 10 章相同。因此，T 边际均值由 \\(\\bar{{\\mu}}_{i\\cdot},i=1,2,\\ldots,t\\) 给出，和B的边际平均值由 \\(\\bar{{\\mu}}_{\\cdot j},j=1,2,\\ldots,b\\) 给出。这些边际均值的最佳估计分别为 \\[\\hat{\\bar{{\\mu}}}_{i\\cdot}=\\frac1b\\sum_{j=1}^b\\hat{{\\mu}}_{ij},\\quad i=1,2,\\ldots,t\\] 以及 \\[\\hat{\\bar{{\\mu}}}_{\\cdot j}=\\frac1b\\sum_{i=1}^t\\hat{{\\mu}}_{ij},\\quad i=1,2,\\ldots,t\\] \\(\\hat{\\bar{\\mu}}_{i\\cdot}\\) 标准误的精确估计 (exact estimated standard error) 为 \\[\\widehat{s.e.}(\\hat{\\bar{\\mu}}_{i\\cdot})=\\frac{\\hat{\\sigma}}b\\sqrt{\\sum_{j=1}^b\\frac1{n_{ij}}}\\] \\(\\hat{\\bar{\\mu}}_{\\cdot j}\\) 标准误的精确估计 (exact estimated standard error) 为 \\[\\widehat{s.e.}(\\hat{\\bar{\\mu}}_{\\cdot j})=\\frac{\\hat{\\sigma}}t\\sqrt{\\sum_{i=1}^t\\frac1{n_{ij}}}\\] 其中 \\[\\hat{\\sigma}=\\sqrt{\\frac{\\sum_{i=1}^{t}\\sum_{j=1}^{b}\\sum_{k=1}^{n_{ij}}(y_{ijk}-\\bar y_{ij\\cdot})^2}{N-tb}}=\\sqrt{ErrorMS}\\] 如果单元格样本量相差不大，则这些标准误可以分别用 \\(\\hat \\sigma/\\sqrt{}(b\\tilde n)\\) 和 \\(\\hat \\sigma/\\sqrt{}(t\\tilde n)\\) 近似。\\(\\hat{\\bar{\\mu}}_{i\\cdot}-\\hat{\\bar{\\mu}}_{i&#39;\\cdot}\\) 的标准误估计为 \\[\\widehat{s.e.}(\\hat{\\bar{\\mu}}_{i\\cdot}-\\hat{\\bar{\\mu}}_{i&#39;\\cdot})=\\frac{\\hat{\\sigma}}{b}\\sqrt{\\sum_{j=1}^b\\frac1{n_{ij}}+\\sum_{j=1}^b\\frac1{n_{i&#39;j}}}\\] 可用 \\(\\hat \\sigma\\sqrt{}2/\\sqrt{}(b\\tilde n)\\) 近似。类似地， \\[\\widehat{s.e.}(\\hat{\\bar{\\mu}}_{\\cdot j}-\\hat{\\bar{\\mu}}_{\\cdot j&#39;})=\\frac{\\hat{\\sigma}}{t}\\sqrt{\\sum_{i=1}^t\\frac1{n_{ij}}+\\sum_{i=1}^t\\frac1{n_{ij&#39;}}}\\] 可用 \\(\\hat \\sigma\\sqrt{}2/\\sqrt{}(t\\tilde n)\\) 近似。 接下来考虑对于 \\(i\\ne i^\\prime\\) 和 \\(j\\ne j^\\prime\\) 的 2×2 交互对比 \\(\\mu_{ij}-\\mu_{i&#39;j}-\\mu_{ij&#39;}+\\mu_{i&#39;j&#39;}\\). 这种交互对比的最佳估计为 \\(\\hat\\mu_{ij}-\\hat\\mu_{i&#39;j}-\\hat\\mu_{ij&#39;}+\\hat\\mu_{i&#39;j&#39;}\\)，其标准误估计为 \\[\\widehat{s.e.}(\\hat{\\mu}_{ij}-\\hat{\\mu}_{i^{\\prime}j}-\\hat{\\mu}_{ij^{\\prime}}+\\hat{\\mu}_{i^{\\prime}j^{\\prime}})=\\hat{\\sigma}\\sqrt{\\frac1{n_{ij}}+\\frac1{n_{i^{\\prime}j}}+\\frac1{n_{ij^{\\prime}}}+\\frac1{n_{i^{\\prime}j}}}\\] 如果样本量相差不大，可用 \\(\\hat \\sigma/\\sqrt{}(4/\\tilde n)\\) 近似。 对于单元格均值参数的上述函数中的每一个，检验统计量由下式给出 \\[t_c=\\frac{\\mathrm{estimate}}{\\text{estimated standard error}}\\] 其中如果 \\(|t_c|&gt;t_{\\alpha/2,N-tb}\\)，则拒绝相应的假设。此外，一个 \\((1-\\alpha)100\\%\\) 置信区间为 \\[\\mathrm{estimate}\\pm t_{\\alpha/2,N-tb}(\\text{estimated standard error})\\] 可以使用第 3 章中描述的同时推断程序，并鼓励研究人员这样做。这些想法可以推广到单元格均值和/或边际均值的更一般的对比中。如果简单地用 \\(\\tilde n\\) 代替 \\(n\\)，则可以近似第 8 章中的所有公式。 11.4 未加权均值的示例 表 11.2: 表 9.1 中的单元格均值和边际均值 x 作为示例，请再次考虑表 9.1 中的数据。回想一下，误差平方和为 20，自由度为 10，并且均值表在表 11.2 中重复。\\(\\tilde n\\) 的值为 \\[\\tilde{n}=\\left[\\frac1{bt}\\left(\\sum_{i=1}^t\\sum_{j=1}^b\\frac1{n_{ij}}\\right)\\right]^{-1}=\\left[\\frac1{(3)(2)}\\left(\\frac13+\\frac12+\\frac13+\\frac12+\\frac13+\\frac13+\\frac13\\right)\\right]^{-1}=\\left(\\frac7{18}\\right)^{-1}=2.5714\\] 接着注意到 \\[\\begin{aligned} &amp;\\sum_{i,j}{\\hat{\\mu}}_{ij}^2 =20^2+25^2+\\cdots+28^2=3830 \\\\ &amp;\\sum_{i,j}\\hat{\\bar{\\mu}}_{i\\cdot}^2 =23^2+27^2=1258 \\\\ &amp;\\sum_j\\hat{\\bar{\\mu}}_{\\cdot j}^2 =23^2+24^2+28^2=1889 \\\\ &amp; \\hat{\\bar{\\mu}}_{\\cdot \\cdot}^2=(25)^2=625 \\end{aligned}\\] 因此 \\[\\begin{aligned}SST&amp;=3(1258)-6(625)=24\\\\SSB&amp;=2(1889)-6(625)=28\\\\SST \\times B &amp;= 3830 - 3(1258) - 2(1889) + 6(625) = 28\\end{aligned}\\] 方差分析表见表 11.3。请注意，表 11.3 中的 \\(F\\) 统计量与表 9.3 中给出的精确 \\(F\\) 统计量非常相似。 表 11.3: 表 9.1 中数据未加权均值方差分析表 x 11.5 计算机分析 尽管我们不推荐这样做，但未加权均值分析所需的统计量可以在 Excel® 和其他电子表格程序中获得。通过将实验视为单向实验并利用均值模型，可以最有效地获得未调整误差平方和。要获得未加权均值分析所需的 T, B 和 T × B 平方和，可以按照以下步骤操作。 获取每种处理组合的单元格均值。 获取 T 边际均值、B 边际均值和总体均值。 计算单元格均值、T 边际均值和 B 边际均值的方差。分别记为 \\(S_{TB}^2,S_{B}^2,S_{T}^2\\). 那么 \\[\\begin{align} \\text{error } SS&amp; =\\sum_{i,j,k}y_{ijk}^2-(bt-1)S_{TB}^2+bt\\hat{\\bar{\\mu}}_{\\cdot\\cdot}^2 \\\\ SST&amp; =b(t-1)S_T^2 \\\\ SSB&amp; =t(b-1)S_B^2 \\\\ SST\\times B&amp;=(bt-1)S_{TB}^2-b(t-1)S_T^2-t(b-1)S_B^2 \\tag{11.1} \\end{align}\\] 如果有可以执行单向方差分析的程序，以及一个可以针对均衡数据进行双向方差分析的程序，那么她可以通过将双向处理结构视为使用均值模型的单向处理结构，从单向方差分析程序中获取误差平方和。通过用双向方差分析程序分析单元格均值，可以获得 T, B和 T×B 的平方和。表 11.4 给出了 SAS® 代码，该代码提供执行未加权均值分析所需的统计量。如果读者希望运行此代码，那么将由她自己决定。 表 11.4: 提供未加权均值分析所需统计量的 SAS 代码 x 11.6 结束语 在本章中，我们介绍了一种方法，用于对涉及大量不同处理组合的实验进行满意的统计分析，其中每个处理组合至少观察一次。这些技术对于可能无法使用高级统计软件程序的人员来说是有用的。 "],["chap12.html", "第 12 章 案例研究：子类数不等的均衡双向处理结构 12.1 脂肪-表面活性剂示例 12.2 结束语", " 第 12 章 案例研究：子类数不等的均衡双向处理结构 “… a hypothesis test tells us whether the observed data are consistent with the null hypothesis, and a confidence interval tells us which hypotheses are consistent with the data.” - William C. Blackwelder 在本章中，我们分析了在随机完全区组设计中进行的双向处理结构产生的一组数据。实验本应是均衡的，但由于不可预见的情况，一些区组缺少一些处理组合。然而，我们仍然假设每种处理组合至少观察一次。第 13-15 章讨论了从未观测到某些处理组合的情况。 12.1 脂肪-表面活性剂示例 一位烘焙科学家希望研究三种不同脂肪分别与三种不同表面活性剂 (surfactant) 混合对面包体积的影响，这些面包由九种不同处理组合（即每种脂肪与表面活性剂的搭配）所制备的面团烘焙而成。实验中采用了四个相同类型但来源各异的面粉 (flour) 作为区组因子，这意味着每种面粉都要使用全部九种处理组合来制作面包。遗憾的是，其中一批酵母失效了，因此使用这批酵母制作出的 10 个面包的数据无法纳入分析范围。庆幸的是，所有九种脂肪与表面活性剂的组合至少有一次观测结果。具体数据见表 12.1. 表 12.1: 烘焙实验中的特定体积 x 表 12.1 中的数据采用 SAS®-GLM 程序进行分析。由于所有处理组合都至少观测一次，并且在每个区组 （面粉） 中观测到一些相同的处理组合，III 型平方和检验了有趣且易于解释的假设。III 型分析检验的假设与没有缺失数据的情况下检验的假设相同。因此，我们可以预测这些假设是什么，并且我们不需要包括 E3 选项来识别正在检验的假设。正规方程是使用零和限制来求解的，因此 SOLUTION 选项的结果将不令人感兴趣，因此该选项不用于 SAS-GLM 分析。所有边际均值都是可估的，并且它们的估计值是通过使用 LSMeans 选项获得的。 使用表 12.2 中给出的 SAS 命令对数据进行分析。表 12.3 给出了表 12.2 中命令的方差分析结果。脂肪与表面活性剂交互作用的 III 型 \\(F\\)值为 \\(F=8.52\\)，这在 \\(p=0.0011\\) 水平上显著。因此，应在每个脂肪水平内比较表面活性剂，并在每个表面活性剂水平内比较脂肪。因此，表 12.4 给出了脂肪表面活性剂最小二乘均值，表 12.5 给出了这些双向最小二乘均值之间的成对比较。 表 12.2: 表 12.1 中数据的 SAS 分析 x 表 12.3: 模型方差分析以及主效应和交互作用的检验 x 表 12.4: 脂肪 × 表面活性剂最小二乘均值 x 图 12.1 给出了双向最小二乘均值的图形；位于同一圆圈内的样本均值没有显著差异。使用的 \\(p\\) 值如表 12.5 所示。 图 12.1: 最小二乘均值图。位于同一圆圈内的均值没有显著差异 表 12.5: 脂肪 × 表面活性剂最小二乘均值之间的成对比较 x 从图 12.1 中，我们可以得出以下观察结果 1. 脂肪 3 与表面活性剂 3 的组合给出的响应显著高于所有其它处理组合给出的响应。 2. 脂肪 3 通常给出的响应显著高于脂肪 1 给出的响应。 3. 与脂肪 1 一起使用时，表面活性剂水平没有差异。 12.2 结束语 在下一章中，我们将讨论某些处理组合从未被观测到的情况。这种情况下，在选择合适分析方法时需要格外注意。本章中，我们探讨了随机完全区组设计下，当某些处理组合在某些区组中缺失时，如何对均衡双向处理结构进行分析。所描述的分析方法仅适用于每个处理组合至少被观测一次的情况。这里使用 SAS-GLM 进行了数据分析。正如第 22 章讨论的那样，若将面粉来源视为随机效应，则能更恰当地分析这份数据。 "],["chap13.html", "第 13 章 使用均值模型分析缺失处理组合的双向处理结构 13.1 参数估计 13.2 假设检验和置信区间 13.3 计算机分析 13.4 结束语 13.5 练习", " 第 13 章 使用均值模型分析缺失处理组合的双向处理结构 “You can’t fix by analysis what you bungled by design.” - Light, Singer and Willett, page v 在本章和接下来的两章中，我们讨论从未观测到某些处理组合时双向处理结构的分析。这类实验情况在实践中经常发生，大部分是偶然的，但有时是有意为之。当实验者确实可以控制实验时，应格外小心以确保观测到所有处理组合。 许多统计软件包包含计算缺失处理组合的实验的检验统计量的例程，但本章显示这些检验统计量的观测值（如果有的话）通常没有什么意义。因此，当实际上自动提供的分析通常不是感兴趣的分析时，可用的统计包可能给实验者关于分析的虚假的安全感。以下各节指出了一些问题并提供了获得适当、有意义的分析方法。 13.1 参数估计 正如在第 9 章中一样，缺失处理组合的影响使分析变得足够复杂，以至于使用了一组非常简单的假设数据来帮助讨论。第 15 章讨论了一个现实的例子。 表 13.1: 缺失处理组合的双向实验 x 考虑表 13.1 中的假设数据，来自完全随机设计的双向处理结构，其中处理 T 和 B 各有三个水平。设 \\(\\mu_{ij}\\) 表示当处理 \\(T_i\\) 和 \\(B_j\\) 被施加到随机选择的实验单元时的预期响应。这个实验的一般均值模型是 \\[\\begin{equation} Y_{ijk}=\\mu_{ij}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,t;\\quad j=1,2,\\ldots,b;\\quad k=1,2,\\ldots,n_{ij} \\tag{13.1} \\end{equation}\\] 其中 \\({\\varepsilon}_{i{j}k}\\thicksim{i}.{i}.{d}.{N}(0,{\\sigma}^2)\\). 如果对任何 \\(i\\)和 \\(j\\) 都有 \\(n_{ij}=0\\)，则处理组合 \\(T_i\\) 和 \\(B_j\\) 未观测到。表 13.2 包含至少观测到一次的那些处理组合的单元格均值参数。注意，即使表 13.2 没有对应于 \\((1，2)\\) 单元格和 \\((3，3)\\) 单元格的单元格均值参数，也假设存在这样的参数。也就是说，我们令 \\(\\mu_{12}\\) 和 \\(\\mu_{33}\\) 分别表示对应于 \\((1，2)\\) 单元格和 \\((3，3)\\) 单元格的均值模型参数。 表 13.2: 表 13.1 中数据的单元格均值参数 x 每当处理组合缺失时，如果不对模型中的参数做出一些额外的假设，就无法检验某些假设。涉及与缺失单元格对应参数的假设通常不能被检验。例如，如果不对 \\(\\mu_{12}\\) 和/或 \\(\\mu_{33}\\) 进行一些假设 (assumptions)，就无法检验涉及 \\(\\mu_{12}\\) 和/或 \\(\\mu_{33}\\) 的假设 (hypothesis). 例如，如果能够假设 \\(\\mu_{12}=\\mu_{11}\\)，则可以检验涉及 \\(\\mu_{12}\\) 的假设，因为对于表 13.1 中的数据，可以通过 \\(\\hat \\mu_{11}=(2+4)/2=3\\) 来估计 \\(\\mu_{12}\\). 大多数实验者不愿意做出这种假设。对于表 13.1 中的数据，除非人们愿意对这两个参数做出一些假设，否则不可能估计（或检验）涉及参数 \\(\\mu_{12}\\) 和 \\(\\mu_{33}\\) 的线性组合。一个常见的假设是，T 的水平和 B 的水平之间没有交互作用。这相当于假设 (assuming) \\[\\mu_{12}=\\mu_{11}-\\mu_{21}+\\mu_{22}\\quad\\mathrm{and}\\quad\\mu_{33}=-\\mu_{22}+\\mu_{23}+\\mu_{32}\\] 以及假设 \\[\\mu_{11}-\\mu_{13}-\\mu_{21}+\\mu_{23}=0\\quad\\mathrm{and}\\quad\\mu_{21}-\\mu_{22}-\\mu_{31}+\\mu_{32}=0\\] 在我们看来，如果没有一些支持性的实验证据表明这些假设可能是真实的，就不应该做出这样的假设。实验者往往愿意假设他们的任何实验中的因素或处理之间不存在交互作用，主要是因为他们不知道如何处理这种交互作用，或者因为他们认为自己对此不感兴趣。这两者都不是假设两组处理之间没有交互作用的正当理由。如果存在交互作用，实验者必须处理它，并且必须有兴趣对交互作用进行推断。在第 8 章中，我们讨论了当观察到所有处理组合时处理交互作用的方法。彼时考虑的问题类型也可以在此时考虑。 如前所述，不可能对涉及缺失处理组合参数的函数做出推断。例如，不可能检验 \\(\\bar \\mu_{1\\cdot}=\\bar \\mu_{2\\cdot}=\\bar \\mu_{3\\cdot}\\) 或 \\(\\bar \\mu_{\\cdot1}=\\bar \\mu_{\\cdot2}=\\bar \\mu_{\\cdot3}\\)，因为这些假设涉及我们没有任何信息的参数。事实上，估计所有总体边际均值也是不可能的。对于上述数据，无法估计 \\(\\bar \\mu_{1\\cdot}\\) 和 \\(\\bar \\mu_{3\\cdot}\\) ，也无法估计 \\(\\bar \\mu_{\\cdot2}\\) 和 \\(\\bar \\mu_{\\cdot3}\\). 然而，我们可以估计 \\(\\bar \\mu_{2\\cdot}\\) 和 \\(\\bar \\mu_{\\cdot1}\\) 因为这些边际均值参数不涉及与缺失单元格对应的参数。正如人们所期望的那样，模型 (13.1) 参数的最佳估计是 \\[\\hat{\\mu}_{ij}=\\bar{y}_{ij\\cdot}\\quad i=1,2,\\ldots,t;j=1,2,\\ldots,b\\mathrm{~if~}n_{ij}&gt;0\\] 以及 \\[\\hat{{\\sigma}}^2=\\frac{\\sum_{ijk}(y_{ijk}-\\bar{y}_{ij\\cdot})^2}{N-C}\\] 其中 \\(N = n_{\\cdot\\cdot}\\) 且 C = 观测到的处理组合总数。如果 \\(n_{ij} &gt; 0\\)，则 \\(\\hat\\mu_{ ij}\\) 的抽样分布为 \\(N(\\mu_{ij}, \\sigma^2 /n_{ij}), i = 1, 2, \\cdots , t; j = 1, 2, \\cdots , b\\) 且 \\((N - C)\\hat\\sigma^2/\\sigma^2\\) 的抽样分布为 \\(\\chi^2(N - C)\\). 另外，\\(\\hat\\mu_{ ij}, i = 1, 2, \\cdots , t; j = 1, 2, \\cdots , b\\) 和 \\(\\hat\\sigma^2\\) 在统计上是独立的。 13.2 假设检验和置信区间 显然，分析缺少处理组合的实验的一种方法是使用第 1 章中讨论的程序；事实上，这往往是最好的方法。也就是说，第 1 章中的程序可用于检验与观测到的处理组合对应的 \\(\\mu_{ij}\\) 的任何线性组合的假设。我们使用表 13.1 中的数据进行说明。 13.2.1 示例 13.1 假设我们希望获得表 13.1 中 \\(\\bar\\mu_{2\\cdot}\\) 的 95% 置信区间。首先，观测单元格中的均值估计为 \\(\\hat\\mu_{11}=3,\\hat\\mu_{13}=6.5,\\hat\\mu_{21}=3,\\hat\\mu_{22}=14,\\hat\\mu_{23}=9.5,\\hat\\mu_{31}=6,\\hat\\mu_{32}=9\\)，并且 \\(\\sigma^2\\) 的估计为 \\[ \\begin{aligned} \\hat\\sigma^2=&amp;\\frac{1}{11-7}[(2-3)^2+(4-3)^2+(7-6.5)^2+(6-6.5)^2+(3-3)^2+(14-14)^2\\\\ &amp;+(10-9.5)^2+(9-9.5)^2+(6-6)^2+(6-6)^2+(9-9)^2]\\\\ =&amp;\\frac{3}{4}\\\\=&amp;0.75 \\end{aligned} \\] 此外，实验误差 \\(\\sigma^2\\) 的估计基于 4 个自由度。 \\(\\bar\\mu_{2\\cdot}\\) 的最佳估计为 \\(\\hat{\\bar\\mu}_{2\\cdot} = (3 + 14 + 9.5)/3 = 5.5\\) ，其估计标准误差为 \\[\\widehat{s.e.}(\\hat{\\bar{\\mu}}_{2\\cdot})=\\frac{\\sqrt{\\hat{\\sigma}^2\\left(\\frac1{n_{21}}+\\frac1{n_{22}}+\\frac1{n_{23}}\\right)}}b=\\frac{\\sqrt{0.75\\left(\\frac11+\\frac11+\\frac12\\right)}}3=0.4564\\] 因此，\\(\\bar\\mu_{2\\cdot}\\) 的 95% 置信区间为 \\(5.5 ± (2.776)(0.4564) = 5.5 ± 1.267\\) 或 \\(4.233 &lt; \\bar\\mu_{2\\cdot}&lt; 6.767\\). 假设我们希望确定在这个双向实验中是否存在与缺失单元格相关的交互作用。一般来说，如果观察到所有九种处理组合，则 3 × 3 实验中的交互作用检验将基于 4 个自由度，但由于缺少两个单元格，因此在这种情况下只有两个线性独立的对比来衡量交互作用。衡量相互作用的两个线性相关对比是 \\[\\mu_{11}-\\mu_{13}-\\mu_{21}+\\mu_{23}\\quad\\mathrm{~and~}\\quad\\mu_{21}-\\mu_{22}-\\mu_{31}+\\mu_{32}\\] 因此，考虑检验 \\[H_{0T\\times B}\\colon\\mu_{11}-\\mu_{13}-\\mu_{21}+\\mu_{23}=0\\quad\\mathrm{and}\\quad\\mu_{21}-\\mu_{22}-\\mu_{31}+\\mu_{32}=0\\] 使用第 1 章中介绍的矩阵程序，我们可以通过检验 \\(\\boldsymbol C\\boldsymbol \\mu = \\boldsymbol 0\\) 来检验上述假设，其中 \\[\\boldsymbol{C}=\\begin{bmatrix}1&amp;-1&amp;-1&amp;0&amp;1&amp;0&amp;0\\\\0&amp;0&amp;1&amp;-1&amp;0&amp;-1&amp;1\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{\\mu}=\\begin{bmatrix}\\mu_{11}\\\\\\mu_{13}\\\\\\mu_{21}\\\\\\mu_{22}\\\\\\mu_{23}\\\\\\mu_{31}\\\\\\mu_{32}\\end{bmatrix}\\] 因 \\(H_{0T\\times B}\\) 而导致的平方和为 \\[SS_{T\\times B}=(\\boldsymbol C\\hat{\\boldsymbol\\mu})^{\\prime}(\\boldsymbol C\\boldsymbol D\\boldsymbol C)^{-1}\\left.(\\boldsymbol C\\hat{\\boldsymbol \\mu})^{\\prime}\\quad\\mathrm{where~}D=\\mathrm{Diag}\\left(\\frac12,\\frac12,1,1,\\frac12,\\frac12,1\\right)\\right. \\] 我们得到 \\[SS_{T\\times B}=\\begin{bmatrix}3&amp;-8\\end{bmatrix}\\begin{bmatrix}\\frac52&amp;-1\\\\-1&amp;\\frac72\\end{bmatrix}^{-1}\\begin{bmatrix}3\\\\-8\\end{bmatrix}=18.5161\\] 此平方和基于 2 个自由度。相应的 \\(F\\) 统计量为 \\(F = 18.5161/0.75 = 12.34\\)，具有 2 和 4 个自由度；该 \\(F\\) 在 0.0194 水平上显著。 由于缺少两个单元格，无法关于 13.1 中的数据检验 \\(\\bar{\\mu}_{1\\cdot}=\\bar{\\mu}_{2\\cdot}=\\bar{\\mu}_{3\\cdot}\\)。不过，可以检验 \\[H_{0T}{:}(\\mu_{11}+\\mu_{13})/2=(\\mu_{21}+\\mu_{23})/2\\quad\\mathrm{and}\\quad(\\mu_{21}+\\mu_{22})/2=(\\mu_{31}+\\mu_{32})/2\\] 从广义上讲，这些是 T 主效应类的假设，因为第一个方程在对 \\(B_1\\) 和 \\(B_3\\) 进行平均后将 \\(T_1\\) 与 \\(T_2\\) 进行比较，而第二个方程在对 \\(B_1\\) 和 \\(B_2\\) 进行平均后将 \\(T_2\\) 与 \\(T_3\\) 进行比较。实验者必须单独或同时确定这些假设中的任何一个是否有意义；我们用它们来说明这个方法。 为了检验 \\(H_{0T}\\) 给出的假设，我们可以取 \\[\\boldsymbol C=\\begin{bmatrix}1&amp;1&amp;-1&amp;0&amp;-1&amp;0&amp;0\\\\0&amp;0&amp;1&amp;1&amp;0&amp;-1&amp;-1\\end{bmatrix}\\] 再取 \\(D=\\mathrm{Diag}\\left(\\frac12,\\frac12,1,1,\\frac12,\\frac12,1\\right)\\). 那么因 \\(H_{0T}\\) 而导致的平方和为 \\[SS_T=(\\boldsymbol C\\hat{\\boldsymbol{\\mu}})^{\\prime}(\\boldsymbol C\\boldsymbol D\\boldsymbol C)^{-1}(\\boldsymbol C\\hat{\\boldsymbol{\\mu}})^{\\prime}=\\begin{bmatrix}-3&amp;2\\end{bmatrix}\\begin{bmatrix}\\frac52&amp;-1\\\\-1&amp;\\frac72\\end{bmatrix}^{-1}\\begin{bmatrix}-3\\\\2\\end{bmatrix}=3.8065\\] 有 2 个自由度。合适的 \\(F\\) 统计量为 \\(F = (3.8065/2)/0.75 = 2.5377\\)，自由度为 2 和 4，相应的 \\(p\\)值为 0.1943，因此不能拒绝 \\(H_{0T}\\). 读者可能已经注意到，对于最后两个示例，\\(\\boldsymbol C\\boldsymbol D\\boldsymbol C\\) 是相同的；这是巧合，一般情况下并不如此。当未观测到某些处理组合时，通常最好将实验视为单向实验，并使用类似于第 1.7 节中描述的计算例程来回答重要问题。然而，由于许多统计软件包在使用效应模型时自动提供某些检验，因此许多实验者更喜欢它们。第 14 章描述了此类分析。 13.3 计算机分析 表 13.1 中的数据可以使用表 13.3 中的语句使用 SAS®-GLM 程序进行分析。由于 T 和 B 主效应不包含在 Model 语句中，并且 Noint 选项用作 Model 语句的选项，因而使用的是双向均值模型来刻画这些数据。分析中使用的两个 Contrast 语句对应于第 13.2 节中计算的两个平方和，即 \\(H_{0T×B}\\) 和 \\(H_{0T}\\) 的平方和。 表 13.3: SAS-GLM 命令 x 数据列表如表 13.4 所示，可估函数的一般形式如表 13.5 所示。对表 13.5 的检查表明，单元格均值的每个线性组合都是可估的。还要注意，在可估函数的一般形式中，没有对应于两个缺失单元格的行。 表 13.4: 示例 13.1 的数据 x 表 13.5: 可估函数 x 方差分析表如表 13.6 所示。F 值 122.10 对应于 I 型分析和 III 型分析正在检验所有 \\(\\mu_{ij}\\) 都等于 0 的假设的模型；也就是说，\\(F=122.10\\) 用于检验 \\[H_{0}\\colon\\mu_{11}=\\mu_{13}=\\mu_{21}=\\mu_{22}=\\mu_{23}=\\mu_{31}=\\mu_{32}=0\\] 表 13.6: 示例 13.1 的方差分析表 x 还应注意，误差均方为 0.75，这与第 13.2 节中给出的 \\(\\sigma^2\\) 的估计值一致。 两个 Contrasts 语句的结果如表 13.7 所示。请注意，这些与上一节中显示的计算结果一致。Estimates 语句的结果如表 13.8 所示。这对应于上一节给出的 \\(T_2\\) 主效应平均值。表 13.9 包含 Solution 选项的结果，这些结果是每个单元格均值参数的估计和标准误。这些估计值与表 13.10 中的估计值相同，表 13.10 来自 LSMeans 语句。表 13.10 还给出了所有双向单元格均值之间的成对比较，这些是通过在 LSMeans 语句中包含 pdiff 选项产生的。 表 13.7: 示例 13.1 Contrast 语句的结果 x 表 13.8: 示例 13.1 Estimate 语句的结果 x 表 13.9: 示例 13.1 Model 语句 Solution 选项的结果 x 表 13.10: 示例 13.1 双向最小二乘均值 x 注释: 为了确保整体保护水平，应仅使用与预先计划的比较相关的概率 13.4 结束语 在本章中，我们讨论了在没有观测到某些处理组合的情况下会出现的一些并发症。在本章中，我们使用了均值模型（第 14 章使用了效应模型）来描述可能的分析类型。当没有观测到一些处理组合时，需记住的是，除非可以对模型中的参数做出一些额外的假设，否则一些感兴趣的假设可能是不可检验的。然而，在没有证据支持的情况下，不应做出此类假设。 13.5 练习 "],["chap14.html", "第 14 章 使用效应模型分析缺失处理组合的双向处理结构 14.1 I 型和 II 型假设 14.2 III 型假设 14.3 IV 型假设 14.4 总体边际均值和最小二乘均值 14.5 计算机分析 14.6 结束语 14.7 练习", " 第 14 章 使用效应模型分析缺失处理组合的双向处理结构 “An approximate answer to the right problem is worth a good deal more than an exact answer to an approximate problem.” - John Tukey 在第 13 章中，我们讨论了当某些处理组合未观测到时，如何使用均值模型来分析双向处理结构。在本章中，我们考虑使用效应模型来分析相同类型的情况。使用效应模型并不能回答任何使用均值模型无法回答的问题，反之亦然。虽然均值模型非常简单且易于理解，但效应模型似乎比实际情况复杂得多。我们更喜欢使用均值模型，并且在这里讨论效应模型只是因为许多统计包似乎推荐并鼓励使用效应模型。本章考虑的效应模型是 \\[y_{ijk}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,t;~j=1,2,\\ldots,b;~k=0,1,2,\\ldots,n_{ij}\\] 其中 \\(\\varepsilon_{ijk}\\sim i.i.d.N(0,\\sigma^2)\\) 且 \\(n_{ij}=0\\) 表示第 (i,j) 个处理组合未观测到。 14.1 I 型和 II 型假设 对于缺少处理组合的双向处理结构的 I 型和 II 型分析可以定义为观测到所有组合的处理结构。也就是说，可以拟合连续的模型，并在将不同效应添加到模型中时确定残差平方和的减少量。 为了说明这一点，请考虑对表 13.1 中的数据进行 I 型分析。我们在这里只考虑结果。对实际模型拟合结果感兴趣的读者可以参考本书的上一版本。表 14.1 和 14.2 分别给出了这些数据的 I 型和 II 型方差分析表。 表 14.1: I 型方差分析表 x 表 14.2: II 型方差分析表 x 在第 10 章中已经指出，当数据不均衡时，即使所有的处理组合都至少被观测一次，I 型和 II 型假设也可能没有多大意义。那么很明显，在有缺失处理组合的情况下，这两种假设也不会突然有意义。事实上，为了证明这一点是正确的，表 14.3 和表 14.4 给出了 I 型和 II 型分析检验的假设（均值模型），表 14.5 和表 14.6 给出了效应模型。这些表中的条目可以通过 SAS®-GLM 对表 13.1 中的数据进行分析来确定，也可以使用表 10.9 和公式 10.3 中给出的通用公式来确定，因为这些公式也适用于缺失单元格的问题。 表 14.3: 根据均值模型对表 13.1 中数据进行 I 型分析的假设 x 表 14.4: 根据均值模型对表 13.1 中数据进行 II 型分析的假设 x 表 14.5: 根据效应模型对表 13.1 中数据进行 I 型分析的假设 x 表 14.6: 根据效应模型对表 13.1 中数据进行 II 型分析的假设 x 接下来，我们讨论 I 型和 II 型主效应假设的可能解释。I 型和 II 型假设通常没有多大意义，除非目标是建立一个简单的模型来进行预测，而不是检验有关不同处理组合效应的假设。对于模型构建，解释与第 10 章中的解释完全相同，我们在第 10 章中讨论了没有缺失处理组合的案例。如第 10 章所示，如果每个单元格中的观测数量与总体中存在的每种处理组合的实际数量成正比，那么实验者可能会对 \\(R(\\tau|\\mu)\\) 和 \\(R(\\beta|\\mu)\\) 感兴趣。两者都可以通过进行两个 I 型分析来获得，一个是 model 语句中首先出现 T，另一个是 model 语句中首先出现 B. 14.2 III 型假设 当观测到所有处理组合时，III 型假设与子类数相等时检验的假设相同。当某些处理组合缺失时，无法检验此类假设，因为它们涉及没有相关信息的参数。对于表 13.1 中的数据，我们无法估计 \\(\\hat \\mu_{1\\cdot}\\) 和 \\(\\hat \\mu_{3\\cdot}\\)，因为我们无法估计 \\(\\mu_{12}\\) 和 \\(\\mu_{33}\\). 同样，我们也无法估计 \\(\\hat \\mu_{\\cdot 2}\\) 和 \\(\\hat \\mu_{\\cdot 3}\\). 因此无法检验 \\(\\bar{\\mu}_{1\\cdot}=\\bar{\\mu}_{2\\cdot}=\\bar{\\mu}_{3\\cdot}\\) 或 \\(\\bar{\\mu}_{\\cdot 1}=\\bar{\\mu}_{\\cdot 2}=\\bar{\\mu}_{\\cdot 3}\\). 主效应的 I 型和 II 型假设都取决于每个单元格中的观测次数。只要在一个单元格中至少有一个观测结果，那么该单元格均值是可估的。因此，可估计的参数函数仅取决于观测到哪种处理组合，而不取决于观测了多少次。 III 型假设的发展使得它们不依赖于单元格的大小，而仅依赖于观测到的单元格。这与双向实验的 III 型假设的定义一致，其中观测到所有处理组合。即，假设 \\(\\bar{\\mu}_{1\\cdot}=\\bar{\\mu}_{2\\cdot}=\\bar{\\mu}_{3\\cdot}\\) 和 \\(\\bar{\\mu}_{\\cdot 1}=\\bar{\\mu}_{\\cdot 2}=\\bar{\\mu}_{\\cdot 3}\\) 不依赖于单元格大小。我们不打算讨论缺失数据情况下 III 型假设的构建。尽管目标可能看起来合理，但我们认为当存在缺失单元格时， III 型假设是最糟糕的假说，因为似乎没有合理的方法来解释它们。为了便于说明，表 14.7 中给出了表 13.1 中数据的 III 型分析。表 14.8 和 14.9 给出了通过 III 型分析测试的假设。对表 14.8 和 14.9 的研究表明，除了 T×B 交互作用之外，III 型假设没有意义。表 14.7 - 14.9 中的结果取自 SAS-GLM 对表 13.1 中数据的分析。 表 14.7: III 型方差分析表 x 表 14.8: 根据均值模型对表 13.1 中数据进行 III 型分析的假设 x 表 14.9: 根据效应模型对表 13.1 中数据进行 III 型分析的假设 x 14.3 IV 型假设 在前两节中我们试图表明当存在缺失处理组合时，通过 I 型、II 型或 III 型分析检验的所谓主效应假设中没有一个是完全令人满意的，因为如果两个因素之间存在交互作用的可能性，它们很少有任何合理的解释。这种假设极难解释，因为发生在同一行或同一列中的单元格均值系数很少相同。构建 IV 型假设，使得单元格均值系数是平衡的；因此，由此产生的假设是可解释的。 为了说明这一点，让我们看看表 13.1 数据集中所有可能的 IV 型假设。表 14.10 给出了非缺失单元格的单元格均值参数。基本上，对于双向处理结构，如果假设比较的是一个处理水平在另一个处理的一个或多个共同水平上的平均值，那么该假设就被定义为 IV 型假设。因此，这些假设应该是边际均值假设，只不过当处理组合缺失时，人们不能对所有其他处理水平进行平均，而只能对其他因素的部分水平进行平均。 表 14.10: 表 13.1 中数据的单元格均值参数 x 在对 \\(B_1\\) 和 \\(B_3\\) 求平均后比较 \\(T_1\\) 和 \\(T_2\\) 的 IV 型假设是：\\(H_0{:}(\\mu_{11}+\\mu_{13})/2=(\\mu_{21}+\\mu_{23})/2\\). 另一种比较 \\(T_1\\) 和 \\(T_2\\) 的 IV 型假设是 \\(H_0{:\\mu_{11}}=\\mu_{21}\\). 后一种假设仅在 \\(B_1\\) 上求平均后比较比较 \\(T_1\\) 和 \\(T_2\\). 关于均值模型参数的 T 的所有可能 IV 型假设见表 14.11. \\(B\\) 的 IV 型假设是类似的。表 14.12 给出了 B 的所有可能的 IV 型假设。 表 14.11: 表 13.1 中数据关于 T 的所有可能的 IV 型假设 x *: 通过 SAS-GLM IV 型分析自动检验的假设 表 14.12: 表 13.1 中数据关于 B 的所有可能的 IV 型假设 x *: 通过 SAS-GLM IV 型分析自动检验的假设 SAS-GLM 会自动生成通常可以解释的 IV 型假设，但在解释这些假设之前，首先需要检查 IV 型可估函数，以明确 SAS-GLM 生成了哪些假设。也就是说，与没有缺失处理组合的情况不同，不存在适合所有数据集的唯一解释。事实上，在分析之前对处理重新标记 (relabeling) 可能会导致生成不同的 IV 型假设，因此在 IV 型分析中会有不同的平方和以及 \\(F\\) 值。因此，获得的 IV 型分析并不是数据的唯一特征，而是取决于处理是如何标记的 (labeled). 显然，这并不是非常理想的，但也是不可避免的。SAS-GLM 通过在打印的自由度上放置星号，并指出 “Other Type IV Testable Hypotheses exist which may yield different SS.” 来表示这种情况已经发生。对于表 13.1 中的数据，SAS-GLM 分析自动检验的 T 的 IV 型假设等价于同时检验 \\[\\mu_{11}=\\mu_{31}\\quad\\mathrm{and}\\quad\\frac{\\mu_{21}+\\mu_{22}}2=\\frac{\\mu_{31}+\\mu_{32}}2\\] 因此，T 的 IV 型假设同时比较了 \\(B_1\\) 上 \\(T_1\\) 和 \\(T_3\\) 的效应以及 \\(B_1\\) 和 \\(B_2\\) 上 \\(T_2\\) 和 \\(T_3\\) 的平均效应。这两个函数在表 14.11 中用星号标识。我们注意到，\\(B_3\\) 根本不涉及此特定集合。由 SAS-GLM 得到的 IV 型方差分析表如表 14.13 所示。 表 14.13: IV 型方差分析表 x *: 存在其他可检验的 IV 型假设，这些假设可能产生不同的 \\(SS\\) 表 14.11 中给出了未经 SAS-GLM 检验的 IV 型假设，但对于实验者来说可能与自动检验的假设一样有趣。为了检验这种有趣的 IV 型假设，人们可以（并且应该）使用 Estimate 或 Contrast 语句。例如，要在使用效应模型时检验表 14.11 中的所有 IV 型假设，我们将在 SAS-GLM 分析中使用以下 Estimate 语句 ESTIMATE &#39;T1 VS T2 AVE OVER Bl AND B3&#39; T 1 —1 0 T*B .5 .5 —.5 0 —.5 0 0; ESTIMATE &#39;T2 VS T3 AVE OVER Bl AND B2&#39; T 0 1 —1 T*B 0 0 .5 .5 0 —.5 —.5; ESTIMATE &#39;T1 VS T2 AT Bl&#39; T 1 —1 0 T*B 1 0 —1 0 0 0 0; ESTIMATE &#39;TI VS T3 AT Bl&#39; T 1 0 —1 T*B 1 0 0 0 0 —1 0; ESTIMATE &#39;T2 VS T3 AT B1&#39; T 0 1 —1 T*B 0 0 1 0 0 —1 0; ESTIMATE &#39;T2 VS T3 AT B2&#39; T 0 1 —1 T*B 0 0 0 1 0 0 —1; ESTIMATE &#39;T1 VS T2 AT B3&#39; T 1 —1 0 T*B 0 1 0 0 —1 0 0; 上述 Estimate 语句的结果如表 14.14 所示。 表 14.14: Estimate 选项的结果 x 如果读者没有可用的 SAS-GLM，则可以使用与第 13.2 节中给出的类似的均值模型和程序来检验表 14.11 和 14.12 中的所有假设。 14.4 总体边际均值和最小二乘均值 总体边际均值和最小二乘均值的定义方式与第 9.5 节和第 10.6 节中的定义方式相同。然而，如果没有观测到特定处理与其他处理因素的所有可能性，则相应的总体边际平均值是不可估的。在这种情况下，双向单元格均值表（例如 \\(\\bar \\mu_{ij}\\)）可用于将每个观测到的处理组合与所有其他观测到的处理组合进行比较。如果数据集非常稀疏，则很少有总体边际均值可估计。 对于表 13.1 中的数据，\\(\\bar\\mu_{2\\cdot}\\) 和\\(\\bar\\mu_{1\\cdot}\\) 是唯一可估的总体边际均值。它们的最佳估计值分别为 \\(\\hat{\\bar\\mu}_{2\\cdot}=8.333\\) 和 \\(\\hat{\\bar\\mu}_{1\\cdot}=4.00\\). 一般来说，\\(\\sum_{i,j}c_{ij}\\mu_{ij}\\) 的最佳估计为 \\(\\sum_{i,j}c_{ij}\\hat{\\mu}_{ij}\\)，且标准误估计为 \\({\\hat{\\sigma}}\\sqrt{\\Sigma_{i,j}(c_{ij}^2/n_{ij})}\\)，其中关于所有非空单元格求和。\\(\\sum_{i,j}c_{ij}\\mu_{ij}\\) 的一个 \\((1-\\alpha)100\\%\\) 置信区间为 \\[\\sum_{i,j}c_{ij}\\hat{\\mu}_{ij}\\pm t_{\\alpha/2,v}\\hat{\\sigma}\\sqrt{\\frac{c_{ij}^2}{n_{ij}}}\\] 用于检验 \\(\\sum_{i,j}c_{ij}\\mu_{ij}=0\\) 自由度为 \\(v\\) 的 \\(t\\) 统计量为 \\[t=\\frac{\\sum_{i,j}c_{ij}\\hat{{\\mu}}_{ij}}{\\hat{{\\sigma}}\\sqrt{\\sum_{i,j}\\frac{c_{ij}^2}{n_{ij}}}}\\] 在这两种情况下，\\(n\\) 是对应于误差均方 \\(\\hat\\sigma^2\\) 的自由度。 对于希望进行多重比较的研究人员，我们建议在比较所有处理组合的 \\(F\\) 值显著时，使用上述 \\(t\\) 检验给出的观察到的 \\(p\\) 值。如果该 \\(F\\) 值不显著，那么应该在所有感兴趣的比较中使用 Bonferroni’s method。也就是说，如果获得的 \\(p\\)值小于 \\(\\alpha/p\\)，其中 \\(p\\) 是计划比较的总次数，则声明线性组合与零显著不同。对于数据窥探和计划外比较，应使用 Scheffé’s procedure. 14.5 计算机分析 读者应该使用他或她自己的统计软件包来分析本章以及第 15 章和第 17 章中给出的例子。将由此获得的分析结果与本书中给出的结果进行比较，将使读者对她习惯使用的软件包所检验的各种假设有宝贵的见解。据我们所知，没有任何一个包能够充分或完整地处理缺失处理组合的数据分析。有几个软件包能够很好地处理不均衡数据，前提是没有缺失处理组合。 14.6 结束语 总之，对于存在缺失处理组合的数据，要做出可接受的分析需要深思熟虑。实验人员或统计学家不能仅仅在计算机程序上运行数据，然后从该程序中选取数字来撰写论文。不幸的是，这种做法已经被不知情的实验人员和数据分析师采用，并且还在被采用。我们希望学习过本章的人再也不会这样做。对于那些愿意付出必要努力来正确分析数据的人，建议使用第 13 章中讨论的均值模型。 第 15 章将讨论一个更现实的例子。 14.7 练习 "],["chap15.html", "第 15 章 案例研究：缺失处理组合的双向处理结构 15.1 案例研究 15.2 结束语", " 第 15 章 案例研究：缺失处理组合的双向处理结构 “If all the statisticians in the world were laid head to toe, they wouldn’t be able to reach a conclusion” Anon., after comment on economists by G. B. Shaw 15.1 案例研究 在第 13 章和第 14 章中，我们讨论了在缺失处理组合时，完全随机设计结构中双向处理结构的分析。在本章中，我们将说明当未观测到某些处理组合时，如何在随机完全区组设计中分析双向处理结构。考虑表 15.1 中的数据，该数据是从第 12 章中描述的实验中获得的，但在任何区组中都有一些处理组合未被观测到。图 15.1 显示了至少观测一次的处理组合。任何涉及处理组合（脂肪 1、表面活性剂 3）或（脂肪 2、表面活性剂 2）的假设都无法进行检验，除非做出额外的假设。在本次讨论中，令 \\(FS_{ij}\\) 代表将脂肪 \\(i\\) 和表面活性剂 \\(j\\) 分配给随机选择的实验单元时预期的响应。 表 15.1: 第 5 章烘焙实验的特定体积 x 图 15.1: 烘焙实验中观测到的处理组合 为了获得该实验的误差平方和，我们可以使用任何可用的统计包在随机区组设计结构中拟合效应模型或均值模型。拟合效应模型的模型是 MODEL SPVOL = BLK FAT SURF FAT*SURF; 拟合双向脂肪 × 表面活性剂组合的均值模型的模型为 MODEL SPVOL = BLK FAT*SURF / NOINT; 拟合这两个模型后，我们发现误差平方和等于 2.0941，自由度为 11. 因此 \\[\\hat{\\sigma}^2=2.0941/11=0.1904\\] 如果观测到所有处理组合，则交互作用假设将有 4 个自由度。由于从未观测到两种处理组合，因此交互作用假设仅保留 2 个自由度。交互空间中两个独立的对比是 \\(FS_{11}-FS_{12}-FS_{31}+FS_{32}\\) 和 \\(FS_{21}-FS_{23}-FS_{31}+FS_{33}\\). SAS®-GLM IV 型分析检验这两个对比是否同时为零。检验两个对比同时为零的 \\(F\\) 统计量值为 \\[F=(5.4002/2)/0.1904=14.18\\] 具有 2 和 11 个自由度。 表 15.2 给出了所有可能的脂肪的 IV 型假设。4 中的假设通过 SAS-GLM IV 型的脂肪分析自动检验。如果愿意，可以使用 Contrast 语句来检验假设 1-3，也可以使用 Estimate 语句来检验假设 2 和 3。所进行的统计检验的结果也显示在表 15.2 中。 表 15.2: 关于脂肪的 IV 型假设 x 表 15.3 列出了表面活性剂所有可能的 IV 型假设。通过 SAS-GLM IV 型分析自动检验表面活性剂假设 3 和假设 5 中的最后一个等式。给出的 \\(F\\) 值为 \\(F = 6.34\\)，自由度为 2 和 11。所有五个假设都可以使用 Contrast 语句进行检验，除了假设 3 之外的所有假设都可以使用 Estimate 语句进行检验。 表 15.3: 关于表面活性剂的 IV 型假设 x 由于这些数据中存在显著的交互作用，因此最好通过检查观测到的七种处理组合的最小二乘均值来比较所有观测到的处理组合。表 15.4 中给出了使用成对 \\(t\\) 检验将它们相互比较的最小二乘均值和 \\(p\\) 值。我们注意到，当设计结构是完全随机设计时，总体单元格均值的最佳估计是每个单元格中观测值的平均值（这在随机区组设计中是不正确的）。使用计算包或使用第 6 章的方法可以很容易地获得最佳估计。根据这些估计，我们可以构建图 15.2 ，其中没有显著差异的均值包含在同一个圆圈中。 表 15.4: 成对比较的最小二乘均值、\\(t\\) 统计量和 \\(p\\) 值 x 注释: 为了确保整体保护水平，应仅使用与预先计划的比较相关的概率 图 15.2: 脂肪 × 表面活性剂最小二乘法均值。位于同一圆圈内的均值没有显著差异 15.2 结束语 本章说明了在未观测到某些处理组合的情况下，随机完全区组设计中双向处理结构实验的分析。 "],["chap16.html", "第 16 章 分析三向和高阶处理结构 16.1 一般策略 16.2 均衡和不均衡实验 16.3 I 型和 II 型分析 16.4 结束语 16.5 练习", " 第 16 章 分析三向和高阶处理结构 “Statistics are the triumph of the quantitative method, and the quantitative method is the victory of sterility and death” - Hilaire Belloc 在第 7 - 15 章中，我们讨论了双向处理结构的分析。这 9 章中给出的方法和结果可以推广到更复杂的处理结构；随着处理结构复杂性的增加，这种分析只会变得稍微复杂一些。我们通过具体分析三向处理结构来说明泛化方法。 在第 16.1 节中，我们给出了分析高阶处理结构时应遵循的一般策略。第 16.2 节讨论了均衡和不均衡处理结构的分析。对不均衡实验的讨论包括每个处理组合至少观测一次的情况和一些处理组合缺失的情况。 16.1 一般策略 假设处理 \\(T_i,B_j,C_k\\) 同时应用于同一实验单元。设 \\(\\mu_{ijk}\\) 表示对处理组合 \\((T_i,B_j,C_k)\\) 的预期响应，\\(i=1,2,\\cdots,t;j=1,2,\\cdots,b;k=1,2,\\cdots,c\\). 这些处理组合之间不存在三向相互作用的前提是 \\[(\\mu_{ijk}-\\mu_{i^{\\prime}jk}-\\mu_{ij^{\\prime}k}+\\mu_{i^{\\prime}j^{\\prime}k})-(\\mu_{ijk^{\\prime}}-\\mu_{i^{\\prime}jk^{\\prime}}-\\mu_{ij^{\\prime}k^{\\prime}}+\\mu_{i^{\\prime}j^{\\prime}k^{\\prime}})=0\\quad\\mathrm{for~all~}i,i^{\\prime},j,j^{\\prime},k,\\mathrm{and~}k^{\\prime}\\] 这意味着对于所有 k 和 k’ 值，因素 C 在 k 水平上的 T × B 交互作用与因素 C 在 k’ 水平上的 T × B 交互作用相同。类似地，T × C 交互作用在因素 B 的所有水平上都是相同的，以及 B × C 交互作用在因素 T 的所有水平上都是相同的。无交互作用陈述的等价表达为 \\(\\mu_{ijk}-\\bar{\\mu}_{ij\\cdot}-\\bar{\\mu}_{i\\cdot k}-\\bar{\\mu}_{\\cdot jk}+\\bar{\\mu}_{i\\cdot\\cdot}+\\bar{\\mu}_{\\cdot j\\cdot}+\\bar{\\mu}_{\\cdot\\cdot k}-\\bar{\\mu}_{\\cdot\\cdot\\cdot}=0\\quad\\text{ for all }i,j,\\mathrm{~and~}k\\) 存在参数 \\(\\mu,\\tau_1,\\tau_2,\\cdots,\\tau_t,\\beta_1,\\beta_2,\\cdots,\\beta_b,\\xi_1,\\xi_2,\\ldots,\\xi_c,\\gamma_{11},\\gamma_{12},\\cdots,\\gamma_{tb},\\eta_{11},\\eta_{12},\\cdots,\\eta_{tc},\\theta_{11},\\theta_{12},\\cdots,\\theta_{bc}\\) 使得 \\[\\mu_{ijk}=\\mu+\\tau_i+\\beta_j+\\xi_k+\\gamma_{ij}+\\eta_{ik}+\\theta_{jk}\\quad\\text{for all }i,j,\\mathrm{~and~}k\\] 也就是说，\\(\\mu_{ijk}\\) 可以用主效应和双因素交互效应来描述。在分析三向处理结构时，第一步也是最重要的一步是确定是否存在三因素交互作用，尽管实验者可能对此不感兴趣。如果没有三因素交互作用，那么第二步是确定是否存在任何双因素交互作用。如果也没有双因素交互作用，那么可以分析每个主效应。如果存在三因素交互作用，实验者应该在所选的第三个处理因素（通常是最不感兴趣的因素）的每个水平上分析两个处理因素的双向处理结构。显然，这些双向分析可以通过让每个处理成为所选的第三个处理来进行。使用统计计算包可以获得的分析类型与可用于双向处理结构的分析类型相似。 图 16.1 显示了分析三向处理结构的一般策略。这种策略也可应用于四向和高阶处理结构。如果对所有处理组合进行相同次数的观测，则可以使用许多不同类型的统计软件来分析结果数据。 图 16.1: 三因素实验的分析策略 16.2 均衡和不均衡实验 如果观测到所有处理组合，但观测次数不相等，则可以使用 III 型分析。如果每种处理组合都至少观测一次，那么所有的主效应和交互作用假设仍然可以得到检验，并且回答的问题与在处处完全均衡时回答的问题相同。 如果某些处理组合缺失，那么就像第 13 章中的情况一样，无法检验涉及缺失处理组合的假设。实验者应该在感兴趣的处理之间指定她自己的 IV 型假设。这种假设可以通过使用第 1 章中描述的矩阵程序或通过许多统计计算包中可用的 Contrast 语句进行检验。 第 17 章中的示例演示了可能需要的一些步骤，以便获得对缺失处理组合数据的完整分析。 16.3 I 型和 II 型分析 第 10 章描述了双向处理结构实验的 I 型和 II 型分析。这两种分析都使用模型比较程序为每个效应产生平方和。I 型分析序贯式地 (sequentially) 拟合模型，每个效应都会针对模型中之前的所有其他效应进行调整。在第 II 型分析中，针对相同或更低水平的所有其他效应调整每个效应的平方和。考虑由下式给出的三向模型 \\[\\begin{aligned}y_{ijk\\ell}&amp;=\\mu+T_i+B_j+(TB)_{ij}+C_k+(TC)_{ik}+(BC)_{jk}+(TBC)_{ijk}+\\varepsilon_{ijk\\ell}\\\\&amp;\\mathrm{for~}i=1,2,\\ldots,t,~j=1,2,\\ldots,b;~k=1,2,\\ldots,c;~\\mathrm{and}~\\ell=1,2,\\ldots,n_{ijk}\\end{aligned}\\] 假设对于所有 \\(i,j,k\\) 有 \\(n_{ijk}&gt;0\\). 也就是说，每个三向单元格至少观测一次。表 16.1 显示了使用第 10 章中描述的缩减符号的 I 型和 II 型平方和及其相应的自由度。 表 16.1: 在每个单元格中至少有一次观测的三向实验的 I 型和 II 型平方和 x 16.4 结束语 本章讨论了三向及高阶处理结构实验的分析。给出了一个流程图，提供了分析此类实验的一般策略。 首先研究最高阶交互作用效应是很重要的。许多实验者避免考虑高阶交互作用，因为他们通常不太确定如何处理这些交互作用。应该避免这种诱惑。尽管经验告诉我们，非常高阶的交互作用很少是有意义的，但无论何时，都必须处理它们。第 8 章中讨论的技术可以推广到三向和更高阶的处理结构，并有助于确定哪些处理组合导致了交互作用。交点的原因可能是研究中确定的最重要的信息。 16.5 练习 "],["chap17.html", "第 17 章 案例研究：具有许多缺失处理组合的三向处理结构 17.1 营养评分示例 17.2 SAS-GLM 分析 17.3 一个完整的分析 17.4 结束语 17.5 练习", " 第 17 章 案例研究：具有许多缺失处理组合的三向处理结构 “Statistics are no substitute for judgment.” - Henry Clay 在本章中，我们详细分析了当缺少许多处理组合时的三向处理结构。 17.1 营养评分示例 一位家庭经济学家进行了一项抽样调查实验，研究低收入经济水平的母亲对营养的了解程度，并判断旨在增加她们营养知识的培训计划的效果。在训练项目前后对这些母亲进行了测试，并测量了她们测试成绩的变化。这些变化如表 17.1 所示。受试的母亲根据三个因素进行分类：age, race 以及是否收到食品券 (food stamps). 表 17.1: 培训前后营养测试成绩的变化 x 17.2 SAS-GLM 分析 表 17.2 给出了使用 SAS 命令从 SAS®-GLM 获得的表 17.1 中数据的 IV 型方差分析表。 PROC GLM; CLASSES GROUP AGE RACE; MODEL GAIN=GROUP|AGE|RACE/SOLUTION E4; LSMEANS GROUP|AGE|RACE/PDIFF STDERR; RUN; 表 17.2: IV 型方差分析表 x *: 存在其他可检验的 IV 型假设，这些假设可能会产生不同的 SS 表 17.2 显示表 17.1 中数据的 \\(\\sigma^2\\) 估计为 \\(\\hat\\sigma^2 = 2627.4724/92 = 28.56\\)，自由度为 92. 表 17.2 还显示三因素交互作用假设的自由度为零，这表明这些数据中没有可用于估计三因素交互作用的对比。这并不意味着 group, age 和 race 之间不存在三因素交互作用，只是三因素交互作用效应中没有可检验的假设。 IV 型 \\(F\\) 值似乎表明任何主效应和双向交互作用都没有显著差异。这似乎有点奇怪，特别是因为对表 17.1 中的数据进行目视检查显示，未收到食品券的组中的 GAIN 存在大量负值，而收到食品券的组中的 GAIN 值主要是正的。因此，人们预计食品券会产生影响，至少在这两个亚组中。还要注意，比较具有数据的单元格对应的 15 个单元格均值的 \\(F\\) 值为 2.67，自由度为 14 和 92. 其对应的 \\(p\\) 值为 0.0026，这似乎也表明这 15 个处理组合均值之间存在显著差异。那么，为什么组的主效应检验（\\(F = 2.65,p = 0.1068\\)）不显著呢？当然，答案可能在于 GROUP 的 IV 型 \\(F\\) 值实际正在检验的假设。 表 17.3: SAS-GLM 检验的 IV 型假设 x 表 17.3 显示了 SAS-GLM IV 型分析所检验的假设。对表 17.3 的检查显示，组的 IV 型假设将食品券组与无食品券组进行比较，对它们共有的六个单元格平均值进行平均，即对应于 (age = 1, white)、(age = 2, white)、(age = 3, black)、(age = 3, Hispanic)、(age = 3, white) 和 (age = 4, black) 的单元格。这似乎是一个非常合理的假设，因为它对尽可能多的相似类别进行了平均。为了进一步探讨这个检验为什么不显著，让我们看一下对这两组进行比较的相应的 IV 型对比的标准误。标准误估计为 \\[\\begin{aligned} \\widehat{s.e.}\\text{ (type IV group contras}t)&amp; =\\hat{\\sigma}\\sqrt{\\sum_i\\sum_j\\sum_k\\left(\\frac{c_{ijk}^2}{n_{ijk}}\\right)} \\\\ &amp;=5.344\\sqrt{\\left(\\frac12+\\frac18+\\frac14+\\frac11+\\frac1{31}+\\frac11\\right)+\\left(\\frac13+\\frac18+\\frac16+\\frac12+\\frac1{20}+\\frac11\\right)} \\\\ &amp;=12.047 \\end{aligned}\\] 请注意，标准误的大小更多地取决于单元格内的小样本量，而不是大样本量。由于 group 的 IV 型对比涉及三个单元格，其中只有一个观测值，因此观测到的标准误必大于 \\[5.344\\sqrt{\\frac11+\\frac11+\\frac11}=9.256\\] 无论其他单元格中的观测数量如何。这说明了数据分析师必须了解的数据分析的另一个方面。如果相应的假设涉及样本量较小的单元格，某些检验可能没有太大的功效。即使观测到所有单元格，这也可能是正确的。也就是说，如果某些单元格样本量较小，即使具有均衡的处理结构，其功效也可能较低。 似乎在 SAS-GLM 的 IV 型分析中，几乎没有自动检验的假设能引起实验者对这些数据的特别兴趣。我们甚至不考虑 I-III 型假设，因为在有缺失单元格的情况下，它们通常没有什么意义。 在这种混乱的实验中，获取有用信息的最安全、最简单的方法是查看三向最小二乘均值，以及它们之间的成对比较。表 17.4 给出了三向最小二乘均值及其标准误估计，表 17.5 给出了与最小二乘均值之间成对比较对应的 \\(p\\) 值。 表 17.4: 三向最小二乘均值 x 表 17.5: 所有最小二乘均值的成对比较 x 假设我们希望检验 IV 型 group 假设 \\(\\mu_{\\mathrm{Y3W}}=\\mu_{\\mathrm{N3W}}\\)。也就是说，具有最大样本量的两个单元格均值如何相互比较？这两个单元格对应于表 17.5 中的 LSMeans 6 和 13，比较这两个均值的相应 \\(p\\) 值为 \\(p = 0.0004\\). 因此，在 age = 3 和 race = white 的母亲亚组，由于食品券的发放，存在显著差异。接下来，考虑 age = 2, whites. 相应的单元格均值为 LSMeans 3 和 10，相应的 \\(p\\) 值为 \\(p=0.0424\\)，这也表明由于食品券的发放而产生显著差异。最后，考虑与 age = 3 的 black 对应的群体。这两个均值对应于 LSMeans 4 和 11，并且相应的 \\(p\\) 值为 \\(p＝0.0017\\). 因此，很明显，如果只考虑具有合理样本量的单元格，那么我们将发现由于食品券的发放而产生显著差异。 17.3 一个完整的分析 由于我们无法检验三因素交互作用，因此不知道是否存在三因素交互作用，我们接下来在第三种处理因素的每个水平上进行双向分析。让我们假设实验者对 race × group 的效应或差异最感兴趣。因此，我们在每个 age 水平上检查了这些双向组合，如表 17.6 所示。 表 17.6: 表 17.1 中数据每个 age 水平观测到的 race × age 组合 x 注释: “X”表示该单元格在实验中至少观测到一次 对于表 17.6 中的 age = 1，我们观察到以下情况：1）不可能检验该 age 组中的 race × group 交互作用，因为不存在测量双因素交互作用的对比；2） 唯一可以检验的比较组的 IV 型假设是 \\(\\mu_{\\mathrm{Y1W}}=\\mu_{\\mathrm{N1W}}\\) ；3）age = 1 组中唯一涉及可检验 race 的 IV 型假设是 \\(\\mu_{\\mathrm{Y1B}}=\\mu_{\\mathrm{Y1W}}\\)；以及 4）假设 \\(\\mu_{\\mathrm{Y1B}}=\\mu_{\\mathrm{N1W}}\\) 也可以在 age = 1 组中进行检验，但该假设可能是次要的，因为它涉及 race 和 group 中的不同水平。根据表 17.5，检验 \\(\\mu_{\\mathrm{Y1W}}=\\mu_{\\mathrm{N1W}}\\) 的 \\(p\\) 值为 0.5628。与 3 和 4 中的假设相对应的 \\(p\\) 值分别为 0.5141 和 0.1975. 表 17.7 和 17.8 分别给出了可检验的假设、各自检验统计量的 \\(p\\) 值以及 age 组（age = 2 和 age = 4）的（主观）重要性评级。 表 17.7: 表 17.1 中数据关于 age = 2 的可检验假设 x 注释: \\(p\\) 值来自表 17.5 表 17.8: 表 17.1 中数据关于 age = 4 的可检验假设 x 注释: \\(p\\) 值来自表 17.5 最后，我们检查了 age = 3 的组。在该组中，观测到了所有 race × group 组合；因此，可以检验 race × group 交互作用。如果这种交互作用不显著，我们可以检验 age = 3 的母亲亚组中 race 和 group 的主效应均值。这三个假设由 \\[\\begin{aligned} &amp;H_{01}\\colon\\mu_\\text{N3B}{ - \\mu _\\text{N3W }{ - \\mu _\\text{Y3B}} }+\\mu_\\text{Y3W}{ = 0,\\,\\text{and}} \\,\\,\\mu_\\text{N3H}{ - \\frac 1 2 }(\\mu_\\text{N3B}+\\mu_\\text{N3W})-\\mu_\\text{Y3H }+\\frac12(\\mu_\\text{Y3B}+\\mu_\\text{Y3W}){=}0 \\\\ &amp;H_{02}\\colon\\bar{\\mu}_{\\text{YЗ}\\cdot}=\\bar{\\mu}_{\\text{NЗ}\\cdot} \\\\ &amp;H_{03}\\colon\\bar{\\mu}_{\\cdot\\text{ЗВ}} = \\bar { \\mu }_{\\cdot\\text{ЗН}} = \\bar { \\mu }_{\\cdot\\text{ЗW}} \\end{aligned}\\] 关于 \\(H_{01}\\) 的检验统计量实际上是由表 17.2 中所示的原始 SAS-GLM 分析给出的，而其他两个假设的检验则不是。假设 \\(H_{01}\\) 等价于 race × group IV 型 \\(F\\) 值检验的假设，这一点可以通过检查表 17.3 中 race × group 的可估计函数看出。这三个假设的检验可以通过使用 SAS-GLM 中的 Contrast 语句（如下所示）或手工计算获得。在这种情况下，手工检验可能更容易。当使用 SAS-GLM 时，使用均值模型也更容易。使用此模型，只需要输入与 group × age × race 效应相对应的系数。效应模型所需的 SAS-GLM Contrast 语句如表 17.9 所示。 表 17.9: 用于检验 \\(H_{01}\\) - \\(H_{03}\\) 的 Contrast 语句 x 上述三个假设的检验统计量可以通过在 17.2 节中给出的 SAS 命令中包含以下 Contrast 语句来获得。表 17.9 中给出了所需的语句。这些选项的结果如表 17.10 所示。如果实验者也对种族年龄组合的影响感兴趣，可以根据组因子的每个值来分析这些组合。 表 17.10: SAS Contrast 语句的结果 x 如果实验者感兴趣于 race × age 组合的效应，则可以在 group 因素的每个值上分析这些组合。如果实验者想对每种 race 检查 group × age 组合的效应，也存在类似的情况。这两种分析都可以通过手工进行、通过使用 Contrast 语句，或者在可能的情况下，如本节开头所示，对于 age 因子的不同水平使用三向最小二乘均值。 高阶交叉分类处理结构的分析可以采用与本章所示类似的方法进行。 17.4 结束语 本章对具有大量缺失处理组合的三向处理结构进行了分析。进行了 SAS-GLM 分析并给出了解释。还提出了 SAS-GLM 分析未回答的问题，并说明了回答这些问题的技术。 17.5 练习 "],["chap18.html", "第 18 章 随机效应模型和方差分量 18.1 介绍 18.2 矩阵表示法中的一般随机效应模型 18.3 计算期望均方 18.4 结束语 18.5 练习", " 第 18 章 随机效应模型和方差分量 “Maturity is the capacity to endure uncertainty.” - John Finley 具有多个随机分量 (random component) 的模型适用于多种情况，包括随机效应和混合效应模型，其中处理结构中的部分或全部因子是随机的，或者如裂区和重复测量设计那样有多种尺寸的实验单元。对于此类模型，感兴趣的参数包括与随机分量的分布相关的方差（通常称为方差分量, variance components）。重要的是能够识别模型的随机分量，并能够在模型分析中使用它们。当对给定模型进行方差分析时，需要均方的期望值（均方是方差分量的函数），以构造适当的检验统计量，并确定用于比较固定效应参数的标准误。还需要能够获得方差分量的估计，并检验假设和构造方差分的函数的置信区间。随机效应模型及其分析方法的讨论分为四章。本章定义了随机效应模型，并描述了一种计算平方和期望的一般程序。该程序可以很容易地利用计算机软件评估平方和的期望值。估计问题在第 19 章中讨论，检验假设和构造置信区间的方法在第 20 章中介绍，第 21 章提供了一个详细的示例分析。 18.1 介绍 在抽样方案和感兴趣的参数中，使用随机效应模型背后的哲学与使用固定效应模型（在前几章中讨论的）背后的哲学截然不同。在讨论这些差异之前，先给出随机效应和固定效应的定义。 定义 18.1 ♦ 如果一个因子的水平由可能水平总体中的随机样本组成，则该因子是一个随机效应因子 (random effect factor). 定义 18.2 ♦ 如果一个因子的水平是通过非随机过程选择的，或者如果它的水平由可能水平的整个总体组成，那么它就是一个固定效应因子 (fixed effect factor). 因此，为了确定一个因子是固定效应还是随机效应，我们需要知道实验者是如何选择该因子的水平的。如果实验中包括了该因子所有可能水平或一组选定的因子水平，则该因子被视为混合效应。如果使用某种形式的随机化来选择实验中包括的水平，那么该因子就是随机效应。 规则：因子的水平在被证明为随机之前都是固定的。 为了确定一个因子的水平是随机的，必须描述可能水平的总体或概念总体，并且必须指定随机选择该因子水平的方法。要对水平总体进行推断，因此如果无法描述该总体，则推断可能没有意义。 例如，假设一个植物育种学家想要研究小麦品种的某个特性（比如说产量）。存在许多可能的小麦品种（品种的总体），但是如果他想要研究某一组特定的品种，那么他就会选择这些品种进行实验。在这种情况下，因子 “品种” 被称为固定效应，因为品种的水平是选定的 (chosen) 或固定的 (fixed). 然而，如果植物育种学家感兴趣的是特性在总体中的品种之间是如何分布的，那么他就对哪些品种包含在实验中不感兴趣。在这种情况下，植物育种学家可以从品种的总体中随机选择包含在实验中的品种。因此在第二个实验中，因子品种是一个随机效应。在构造模型来描述给定的实验情况时，必须指出一个因子是随机效应还是固定效应。前几章所考虑的模型是在假设处理结构中的所有因子都是固定效应，并且实验单元只有一个尺寸的假设下构造的。然而，在第四章引入区组时，已经暗示了随机效应的概念，其中假设因子 “区组” 是一个随机效应。此外，一个基本假设是，与模型的设计结构相关的那些因子是随机效应。一些因子既有一组固定效应水平，也有一组随机效应水平 (Njuho and Milliken, 2005)，但这里没有详细阐述这一主题。根据设计结构中实验单元的尺寸和对处理结构中因子的假设，可以构造三种基本类型的模型。这些类型的模型定义如下。 定义 18.3 ♦ 如果处理结构中的所有因子都是固定效应，并且研究中只有一个尺寸的实验单元，没有区组，并且方差都相等，则该模型称为固定 (fixed) 或固定效应 (fixed effects) 模型。 定义 18.4 ♦ 如果处理结构中的所有因子都是随机效应（设计结构中的全部因子已经被假设为随机效应），则该模型称为随机 (random) 或随机效应 (random effects) 模型。 定义 18.5 ♦ 如果处理结构中的一些因子是固定效应，一些因子是随机效应，或者处理结构中所有因子都是固定效应并且设计结构中有多种尺寸的实验单元（或者模型中至少有两个方差分量），则该模型称为混合 (mixed) 或混合效应 (mixed effects) 模型。 本章讨论的模型都是随机效应模型。第 22 章和第 23 章介绍了对混合模型的讨论。下面的例子有助于激发随机效应模型的应用和分析。 18.1.1 示例 18.1：随机效应嵌套处理结构 一个消费者团体研究了美国至少拥有 20,000 人口的城市中咖啡价格的变异。该团体希望调查的三个因子是州 (state)、州内的城市 (sity) 以及州内城市内的商店 (store). 处理结构或抽样设计是一个涉及州、城市和商店的三向两水平的嵌套系统，其中城市嵌套在州内，商店嵌套在城市内。抽样程序是从所有可能的州中随机选择 \\(r\\) 个州（\\(r &lt; 50\\)）。接下来，从第 \\(i\\) 个州中的 \\(C_i\\) 个城市中随机选择 \\(t_i\\) 个城市（\\(t_i &lt; C_i\\)），这些城市的人口至少为 20,000. 最后，从第 \\(i\\) 个州中的第 \\(j\\) 个城市的 \\(S_{ij}\\) 家商店中随机选择 \\(n_{ij}\\) 家商店（\\(n_{ij} &lt; S_{ij}\\)），并确定每家随机选择的商店中特定等级的咖啡价格。可以用来描述咖啡价格变异的模型是 \\[y_{ijk}=\\mu+s_i+c_{j(i)}+a_{k(ij)}\\quad i=1,2,\\ldots,r,j=1,2,\\ldots,t_i,\\quad k=1,2,\\ldots,n_{ij}\\] 其中 \\(\\mu\\) 表示美国咖啡的平均价格，\\(s_i\\) 表示第 \\(i\\) 个随机选择的州的效应，\\(c_{j(i)}\\) 表示第 \\(i\\) 个州中第 \\(j\\) 个随机选择的城市的效应，\\(a_{k(ij)}\\) 表示从第 \\(i\\) 个州中的第 \\(j\\) 个城市随机选择的第 \\(k\\) 家商店的效应。假设 \\(s_i\\sim i.i.d.\\,N(0,\\sigma_{\\mathrm{State}}^2)\\) \\(c_{j(i)}\\sim i.i.d.\\,N(0,\\sigma_{\\mathrm{City}}^2)\\) \\(a_{k(ij)}\\sim i.i.d.\\,N(0,\\sigma_{\\mathrm{Store}}^2)\\) 还假设所有随机效应都是彼此独立分布的。该随机效应模型中的参数为 \\(\\mu,\\sigma_{\\mathrm{State}}^2,\\sigma_{\\mathrm{City}}^2,\\sigma_{\\mathrm{Store}}^2\\). 项 \\(s_i,c_{j(i)},a_{k(ij)}\\) 是随机变量，不是模型中的参数。大多数应用只对参数估计感兴趣，对预测随机变量的值不感兴趣。但是，当对随机变量的预测感兴趣时，可以获得随机效应的最佳线性无偏预测估计 (estimated best linear unbiased predictors, EBLUP) (Littell et al., 2006; Milliken and Johnson, 2002). 咖啡价格的方差可以通过模型参数表示为 \\[\\mathrm{Var}(y_{ijk})=\\sigma_{\\mathrm{Price}}^2=\\sigma_{\\mathrm{State}}^2+\\sigma_{\\mathrm{City}}^2+\\sigma_{\\mathrm{Store}}^2\\] 同一城市（和州）内商店的两种咖啡价格之间的协方差为 \\[\\mathrm{Cov}(y_{ij1},~y_{ij2})=\\sigma_{y_{ij1}y_{ij2}}=\\sigma_{\\mathrm{State}}^2+\\sigma_{\\mathrm{City}}^2\\] 这两个价格之间的相关性为 \\[\\rho_{y_{ij1}y_{ij2}}=\\frac{\\sigma_{\\mathrm{State}}^2+\\sigma_{\\mathrm{City}}^2}{\\sigma_{\\mathrm{State}}^2+\\sigma_{\\mathrm{City}}^2+\\sigma_{\\mathrm{Store}}^2}\\] 州内不同城市商店的两种咖啡价格之间的协方差为 \\(\\mathrm{Cov}(y_{i11},y_{i22})=\\sigma_{y_{i11}y_{i22}}=\\sigma_{\\mathrm{State}}^2\\). 同一州内两个不同城市的两个价格之间的相关性为 \\[\\rho_{y_{i11}y_{i22}}=\\frac{\\sigma_{\\mathrm{State}}^2}{\\sigma_{\\mathrm{State}}^2+\\sigma_{\\mathrm{City}}^2+\\sigma_{\\mathrm{Store}}^2}\\] 因此，当模型包含随机效应时，会在结果数据上施加与咖啡价格相似的相关结构 (correlation structure). 能够构造模型并识别各种观测分组之间的变异来源以及相关性是有意义的。以下示例用于演示构造一个或多个随机效应的模型，并评估数据集中观测结果之间的隐含协方差或相关结构。 18.2 矩阵表示法中的一般随机效应模型 为了描述用于评估平方和期望的方法，有必要使用一些通用符号来描述一般随机效应模型 (general random effects model). 本节介绍一般随机效应模型的矩阵表示，后面的部分将使用该模型来演示计算期望均方的一般方法。为了帮助可视化一般随机效应模型及其在矩阵方面的表达，我们研究了完全随机设计结构中单向处理结构的随机效应模型。 18.2.1 示例 18.2：单向随机效应模型 描述完全随机设计结构中的单向随机效应处理结构的模型是 \\[\\begin{equation} y_{ij}={\\mu}+{u}_i+{\\varepsilon}_{ij},\\quad i=1,2,\\ldots,t,j=1,2,\\ldots,n_i \\tag{18.1} \\end{equation}\\] 其中 \\(\\mu\\) 是响应的总体平均值，\\(\\mu_i\\) 表示第 \\(i\\) 个随机选择的处理的效应，并假设其分布为 \\(i.i.d.\\,N(0, \\sigma^2_u)\\)，\\(\\varepsilon_{ij}\\) 表示第 \\(i\\) 个处理的第 \\(j\\) 个观测值的随机误差，并假设其分布为 \\(i.i.d.\\,N(0, \\sigma^2_\\varepsilon)\\). 还假设 \\(\\mu_i\\) 和 \\(\\varepsilon_{ij}\\) 是独立的随机变量。这些假设允许评估观测值的方差和协方差。观测值的方差是 \\[\\begin{aligned} \\operatorname{Var}(y_{ij})&amp; ={\\sigma}_y^2=\\mathrm{Var}({\\mu}+{\\mu}_i+{\\varepsilon}_{ij}){=}\\mathrm{Var}({u}_i)+\\mathrm{Var}({\\varepsilon}_{ij}) \\\\ &amp;=\\sigma_u^2+\\sigma_\\varepsilon^2 \\end{aligned}\\] \\(y_{ij}\\) 的方差有两个分量，包括处理总体的方差或 \\(u\\) 水平的方差和实验单元的方差，因此称为方差分量 (variance components or components of variance). 从 \\(u_i\\) 的相同可能性获得的两个观测值的协方差为 \\[\\begin{aligned}\\mathrm{Cov}(y_{ij},y_{ij^{\\prime}})&amp;=\\mathrm{Cov}(\\mu+u_i+\\varepsilon_{ij},\\mu+u_i+\\varepsilon_{ij^{\\prime}})\\\\&amp;=\\mathrm{Cov}(u_i,u_i)=\\mathrm{Var}(u_i)=\\sigma_u^2\\end{aligned}\\] 从不同 \\(i\\) 值获得的两个观测值之间的协方差为零。因此，从相同 \\(i\\) 获得的观测值是相关的，这种相关性称为组内相关性 (intraclass correlation)，定义为 \\[\\rho=\\frac{\\mathrm{Cov}(y_{ij},y_{ij},)}{\\sqrt{\\mathrm{Var}(y_{ij})\\mathrm{Var}(y_{ij},)}}=\\frac{\\sigma_u^2}{\\sigma_u^2+\\sigma_\\varepsilon^2}\\] 不同 \\(i\\) 值的观测结果是不相关的。方程 (18.1) 中的模型可以用矩阵表示法描述为 \\[\\begin{equation} \\boldsymbol y=\\boldsymbol j \\mu+\\boldsymbol Z_1 \\boldsymbol u+\\boldsymbol \\varepsilon \\tag{18.2} \\end{equation}\\] 其中 \\(\\boldsymbol j\\) 是 N × 1 全一向量（\\(N=\\sum_{i=1}^tn_i\\)），\\(\\boldsymbol Z_1\\) 是 N × t 设计矩阵，\\(\\boldsymbol u\\) 是假定服从多元正态分布 \\(N_t(\\boldsymbol 0,\\sigma^2_u\\boldsymbol I_t)\\) 的 t × 1 随机向量变量，且 \\(\\boldsymbol \\varepsilon\\) 是假定服从多元正态分布 \\(N_N(\\boldsymbol 0,\\sigma^2_\\varepsilon\\boldsymbol I_t)\\) 的 N × 1 随机向量变量。观测值向量 \\(\\boldsymbol y\\) 的协方差阵为 \\[\\begin{aligned} \\boldsymbol\\Sigma&amp; =\\mathrm{Var}(\\boldsymbol{y})=\\mathrm{Var}(\\boldsymbol{j} \\mu+\\boldsymbol{Z}_1\\boldsymbol{u}+\\boldsymbol{\\varepsilon}) \\\\ &amp;=\\boldsymbol{Z}_1\\operatorname{Var}(\\boldsymbol{u})\\boldsymbol{Z}_1^{\\prime}+\\operatorname{Var}(\\boldsymbol{\\varepsilon}) \\\\ &amp;=\\sigma_u^2\\boldsymbol{Z}_1\\boldsymbol{Z}_1^{\\prime}+\\boldsymbol{\\sigma}_\\boldsymbol{\\varepsilon}^2\\boldsymbol{I}_N \\end{aligned}\\] \\(y_{ij}\\) 的方差是 \\(\\boldsymbol\\Sigma\\) 的对角元，\\(y_{ij}\\) 对子之间的协方差是 \\(\\boldsymbol\\Sigma\\) 的非对角元。 等价地，模型可以写为 \\[ \\begin{bmatrix}y_{11}\\\\y_{12}\\\\\\vdots\\\\y_{1n_1}\\\\y_{21}\\\\y_{22}\\\\\\vdots\\\\y_{2n_2}\\\\\\vdots\\\\y_{t1}\\\\y_{t2}\\\\\\vdots\\\\y_{tn_t}\\end{bmatrix}= \\begin{bmatrix}1\\\\1\\\\\\vdots\\\\1\\\\1\\\\1\\\\\\vdots\\\\1\\\\\\vdots\\\\1\\\\1\\\\\\vdots\\\\1\\end{bmatrix}\\mu+ \\begin{bmatrix} 1&amp;0&amp;\\cdots&amp;0\\\\ 1&amp;0&amp;\\cdots&amp;0\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 1&amp;0&amp;\\cdots&amp;0\\\\ 0&amp;1&amp;\\cdots&amp;0\\\\ 0&amp;1&amp;\\cdots&amp;0\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 0&amp;1&amp;\\cdots&amp;0\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 0&amp;0&amp;\\cdots&amp;1\\\\ 0&amp;0&amp;\\cdots&amp;1\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 0&amp;0&amp;\\cdots&amp;1\\\\\\end{bmatrix}\\begin{bmatrix} \\mu_1\\\\\\mu_2\\\\\\vdots\\\\\\mu_t\\end{bmatrix}+ \\begin{bmatrix}\\varepsilon_{11}\\\\\\varepsilon_{12}\\\\\\vdots\\\\\\varepsilon_{1n_1}\\\\\\varepsilon_{21}\\\\\\varepsilon_{22}\\\\\\vdots\\\\\\varepsilon_{2n_2}\\\\\\vdots\\\\\\varepsilon_{t1}\\\\\\varepsilon_{t2}\\\\\\vdots\\\\\\varepsilon_{tn_t}\\end{bmatrix} \\] 一般随机效应模型将具有 \\(r\\) 个随机分量，代表了处理结构中随机效应因子的主效应和交互作用，同时也代表了用于描述设计结构的因子以及设计与处理结构分量之间可能存在的交互作用，此交互作用用于描述必要误差项22。一般随机效应模型包括由 \\(\\mu\\) 表示的总体均值参数以及由向量 \\(\\boldsymbol \\varepsilon\\) 表示的残差或最小尺寸实验单元的误差。一般随机效应模型可以用矩阵表示为 \\[\\begin{equation} \\boldsymbol y=\\boldsymbol j \\mu+\\boldsymbol Z_1\\boldsymbol u_1+\\boldsymbol Z_2\\boldsymbol u_2+\\cdots+\\boldsymbol Z_r\\boldsymbol u_r+\\boldsymbol\\varepsilon \\tag{18.3} \\end{equation}\\] 其中 \\(\\boldsymbol \\mu_s(s=1,2,\\cdots,r)\\) 表示随机效应以及 \\(\\boldsymbol\\varepsilon\\) 表示残差，其中假设所有这些随机变量独立分布，且假设它们的边际分布为 \\[\\boldsymbol u_1\\thicksim N(0,\\sigma_1^2\\boldsymbol I_{t_1}),\\quad \\boldsymbol u_2\\thicksim N(0,\\sigma_2^2\\boldsymbol I_{t_2}),\\ldots,\\quad \\boldsymbol u_r\\thicksim N(0,\\sigma_r^2\\boldsymbol I_{t_r}),\\quad\\mathrm{and}\\quad\\boldsymbol\\varepsilon\\thicksim N(0,\\sigma_\\varepsilon^2\\boldsymbol I_N)\\] \\(N\\) 为数据向量 \\(\\boldsymbol y\\) 中的观测总数，\\(\\boldsymbol Z_i\\) 为对应于第 \\(i\\) 个随机效应向量的 \\(N × t_i\\) 设计矩阵。这种一般随机效应模型可以表示为 \\[\\begin{aligned}&amp;\\boldsymbol{y}=\\boldsymbol{j}_{\\Tiny N} \\mu+\\boldsymbol{Z}\\boldsymbol{u}+\\boldsymbol{\\varepsilon}\\quad\\mathrm{where~}\\boldsymbol{Z}=\\boldsymbol{[Z}_1,\\boldsymbol{Z}_2,\\ldots,\\boldsymbol{Z}_r],\\\\\\\\&amp;\\boldsymbol{u}=\\begin{bmatrix}\\boldsymbol{u}_1\\\\\\boldsymbol{u}_2\\\\\\vdots\\\\\\boldsymbol{u}_r\\end{bmatrix}\\mathrm{~and~}\\quad\\mathrm{Var}(\\boldsymbol{u})=\\begin{bmatrix}{\\sigma}_1^2\\boldsymbol{I}_{t_1}&amp;0&amp;0&amp;0\\\\0&amp;{\\sigma}_2^2\\boldsymbol{I}_{t_2}&amp;0&amp;0\\\\0&amp;0&amp;\\ddots&amp;0\\\\0&amp;0&amp;0&amp;{\\sigma}_r^2\\boldsymbol{I}_{t_r}\\end{bmatrix}\\end{aligned}\\] 因此 \\[\\operatorname{Var}(\\boldsymbol y)=\\boldsymbol Z^{\\prime}\\operatorname{Var}(\\boldsymbol u)\\boldsymbol Z+\\sigma_\\varepsilon^2\\boldsymbol I_N\\] 数据向量 \\(\\boldsymbol y\\) 的协方差阵为 \\[\\begin{aligned} \\boldsymbol \\Sigma&amp; =\\operatorname{Var}(\\boldsymbol y)=\\operatorname{Var}(\\boldsymbol j \\mu+\\boldsymbol Z_1\\boldsymbol u_1+\\boldsymbol Z_2\\boldsymbol u_2+\\cdots+\\boldsymbol Z_r\\boldsymbol u_r+\\boldsymbol\\varepsilon) \\\\ &amp;=\\boldsymbol{Z}_1\\mathrm{Var}(\\boldsymbol{u}_1)\\boldsymbol{Z}_1^{\\prime}+\\boldsymbol{Z}_2\\mathrm{Var}(\\boldsymbol{u}_2)\\boldsymbol{Z}_2^{\\prime}+\\cdots+\\boldsymbol{Z}_r\\mathrm{Var}(\\boldsymbol{u}_r)\\boldsymbol{Z}_r^{\\prime}+\\mathrm{Var}(\\boldsymbol{\\varepsilon}) \\\\ &amp;=\\sigma_1^2\\boldsymbol{Z}_1\\boldsymbol{Z}_1^{\\prime}+\\sigma_2^2\\boldsymbol{Z}_2\\boldsymbol{Z}_2^{\\prime}+\\cdots+\\sigma_r^2\\boldsymbol{Z}_r\\boldsymbol{Z}_r^{\\prime}+\\sigma_\\varepsilon^2\\boldsymbol{I}_N \\end{aligned}\\] 这种一般形式的随机效应模型可以在许多情况下使用，以帮助识别数据收集系统中的变异源。分析这些变异来源的一种方法是计算一组与每个随机效应对应的平方和，然后确定每个平方和估计的参数函数。通过获取效应平方和的期望值，可以评估由每个效应平方和所估计的方差分量函数。接下来的章节将使用这种矩阵形式的一般随机效应模型来描述涉及观测值的平方和期望值的评估方法。 18.3 计算期望均方 在对随机效应模型进行方差分析时，平方和的期望值涉及到方差分量。对于给定的模型，至少有两种方法可用于评估期望均方（记住，均方是一个平方和除以其自由度）。第一种方法是利用模型假设代数地求解期望值，第二种方法是通过计算机算法来评估期望值。代数方法是通过将其应用于从具有单向随机效应处理结构的模型分析中获得的平方和来呈现的。计算机算法方法则从一般性角度进行了讨论，并通过更复杂的例子进行了演示。 18.3.1 代数方法 方程 (18.1) 中的单向随机效应模型中有两个方差分量，因此在分析中使用两个平方和来描述响应的变异性。通常计算的两个平方和是随机效应水平内的平方和，记作 \\(Q_1\\) ，以及随机效应水平之间的平方和，记作 \\(Q_2\\)。 对于单向随机效应模型，这些平方和由下式给出 \\[\\begin{aligned}Q_1&amp;=\\sum_{i=1}^t\\sum_{j=1}^{n_i}(y_{ij}-\\bar{y}_{i\\cdot})^2=\\sum_{i=1}^t\\sum_{j=1}^{n_i}y_{ij}^2-\\sum_{i=1}^tn_i\\bar{y}_{i\\cdot}^2\\\\\\\\Q_2&amp;=\\sum_{i=1}^tn_i(\\bar{y}_{i\\cdot}-\\bar{y}_{\\cdot\\cdot})^2=\\sum_{i=1}^tn_i\\bar{y}_{i\\cdot}^2-n_{\\cdot\\cdot}\\bar{y}_{\\cdot\\cdot}^2\\end{aligned}\\] 根据模型 (18.1) 的随机变量，\\(Q_1,Q_2\\) 中的量可以表示为 \\[\\begin{align} y_{ij}&amp;=\\mu+\\mu_i+\\varepsilon_{ij}\\\\ \\bar y_{i\\cdot}&amp;=\\mu+\\mu_i+\\bar\\varepsilon_{i\\cdot}\\\\ \\bar y_{\\cdot\\cdot}&amp;=\\mu+\\tilde \\mu_{\\cdot}+\\bar\\varepsilon_{\\cdot\\cdot}\\quad\\text{where}\\,\\,\\tilde\\mu_{\\cdot}=\\frac1N\\sum_{i=1}^tn_i\\mu_i \\tag{18.4} \\end{align}\\] 将方程 (18.4) 中的项代入 \\(Q_1\\)，表达式变为 \\[Q_1=\\sum_{i=1}^t\\sum_{j=1}^{n_i}[(\\mu+u_i+\\varepsilon_{ij})-(\\mu+u_i+\\bar{\\varepsilon}_{i\\cdot})]^2=\\sum_{i=1}^t\\sum_{j=1}^{n_i}(\\varepsilon_{ij}-\\bar{\\varepsilon}_{i\\cdot})^2\\] 使用 \\(\\boldsymbol \\varepsilon\\) 的分布性质可以评估 \\(Q_1\\) 的期望值 \\[\\begin{aligned} E(Q_1)&amp; =\\sum_{i=1}^t\\sum_{j=1}^{n_i}E({\\varepsilon}_{ij}-\\bar{{\\varepsilon}}_i.)^2=\\sum_{i=1}^t\\sum_{j=1}^{n_i}[E({\\varepsilon}_{ij}^2)+E(\\bar{{\\varepsilon}}_{i\\cdot}^2)-2E({\\varepsilon}_{ij}\\bar{{\\varepsilon}}_{i\\cdot})]\\quad\\text{(by squaring)} \\\\ &amp;=\\sum_{i=1}^t\\sum_{j=1}^{n_i}\\left(\\sigma_\\varepsilon^2+\\frac{\\sigma_\\varepsilon^2}{n_i}-2\\frac{\\sigma_\\varepsilon^2}{n_i}\\right)\\quad\\mathrm{using~}E(\\varepsilon_{ij}^2)=\\sigma_\\varepsilon^2\\quad\\mathrm{and~}\\quad E(\\bar{\\varepsilon}_{i\\cdot}^2)=\\frac{\\sigma_\\varepsilon^2}{N_i} \\\\ &amp;=\\sum_{i=1}^t\\sum_{j=1}^{n_i}\\frac{(n_i-1)\\sigma_\\varepsilon^2}{n_i}=\\sigma_\\varepsilon^2\\sum_{i=1}^t\\left(n_i-1\\right)=\\left(N-t\\right)\\sigma_\\varepsilon^2 \\end{aligned}\\] 使用此表达式作为平方和的期望值，期望均方为 \\[E(\\text{mean square of Q}_1)=E{\\left(\\frac{Q_1}{N-t}\\right)}=\\sigma_\\varepsilon^2\\] 将方程 (18.4) 中的表达式代入定义 \\(Q_2\\) 的方程得到 \\[\\begin{gathered} Q_2 \\begin{aligned}=\\sum_{i=1}^tn_i(\\mu+\\mu_i+\\varepsilon_{ij}-\\mu-\\tilde{u}_{\\cdot}+\\bar{\\varepsilon}_{i\\cdot})^2\\end{aligned} \\\\ =\\sum_{i=1}^tn_i[(u_i-\\tilde{u}_{\\cdot})+(\\varepsilon_{ij}-\\bar{\\varepsilon}_{i\\cdot})]^2 \\end{gathered}\\] \\(Q_2\\) 的期望为 \\[\\begin{aligned} E(Q_{2})&amp; \\begin{aligned}=\\sum_{i=1}^tn_i[E(u_i-\\tilde{u}_{\\cdot})^2+E(\\bar{{\\varepsilon}}_{i\\cdot}-\\bar{{\\varepsilon}}_{\\cdot\\cdot})^2]\\end{aligned} \\\\ &amp;\\begin{aligned}=\\sum_{i=1}^tn_i[E(u_i)^2+E(\\tilde{u}_{\\cdot})^2-2E(u_i\\tilde{u}_{\\cdot})+E(\\bar{\\varepsilon}_{i\\cdot})^2+E(\\bar{\\varepsilon}_{\\cdot\\cdot})^2-2E(\\bar{\\varepsilon}_{i\\cdot}\\bar{\\varepsilon}_{\\cdot\\cdot})]\\end{aligned} \\end{aligned}\\] 为了简化这一点，\\(Q_2\\) 的期望分为两部分进行评估。第一部分评估了涉及 \\(\\boldsymbol \\varepsilon\\) 的期望。与均值 \\(\\bar \\varepsilon_{i\\cdot}\\) 和 \\(\\bar \\varepsilon_{\\cdot\\cdot}\\) 相关的分布为 \\[\\bar{{\\varepsilon}}_{i\\cdot}\\sim N{\\left(0,\\frac{{\\sigma}_\\varepsilon^2}{n_i}\\right)}\\quad\\mathrm{and}\\quad\\bar\\varepsilon_{\\cdot\\cdot}\\sim N{\\left(0,\\frac{{\\sigma}_\\varepsilon^2}N\\right)}\\] 那么 \\(Q_2\\) 中涉及 \\(\\boldsymbol \\varepsilon\\) 部分的期望是 \\[\\begin{aligned} &amp;\\sum_{i=1}^{t}n_{i}\\left[E(\\bar{{\\varepsilon}}_{i\\cdot})^{2}+E(\\bar{{\\varepsilon}}_{\\cdot\\cdot})^{2}-2E(\\bar{{\\varepsilon}}_{i\\cdot}\\bar{{\\varepsilon}}_{\\cdot\\cdot})\\right] \\\\ &amp;=\\sum_{i=1}^tn_i\\left\\{\\sigma_\\varepsilon^2{\\left(\\frac1{n_i}\\right)}+\\frac{\\sigma_\\varepsilon^2}N-2E{\\left[\\bar{{\\varepsilon}}_{i\\cdot}\\frac{\\sum_{i^{\\prime}=1}^tn_{i^{\\prime}}\\bar{{\\varepsilon}}_{i^{\\prime}\\cdot}}N\\right]}\\right\\} \\\\ &amp;=\\sum_{i=1}^tn_i\\left\\{\\sigma_\\varepsilon^2{\\left(\\frac1{n_i}\\right)}+\\frac{\\sigma_\\varepsilon^2}N-2\\frac{n_i}NE(\\bar{\\varepsilon}_i)^2\\right\\} \\\\ &amp;=\\sum_{i=1}^tn_i\\left\\{\\sigma_\\varepsilon^2{\\left(\\frac1{n_i}\\right)}+\\frac{\\sigma_\\varepsilon^2}N-2\\frac{n_i}N{\\left(\\frac{\\sigma_\\varepsilon^2}{n_i}\\right)}\\right\\} \\\\ &amp;=\\sum_{i=1}^tn_i\\left(\\frac1{n_i}-\\frac1N\\right){\\sigma}_\\varepsilon^2 \\\\ &amp;=\\sum_{i=1}^t\\left(1-\\frac{n_i}N\\right)\\sigma_\\varepsilon^2=\\left(t-1\\right)\\sigma_\\varepsilon^2 \\end{aligned}\\] 为了评估 \\(Q_2\\) 期望中涉及 \\(u_i\\) 的部分，设 \\(\\tilde{u}_{\\cdot}=\\sum_{i=1}^t(n_iu_i/N)\\). 由于 \\(u_i\\) 独立且均值为零 \\[\\mathrm{Var}(\\tilde{u}_\\cdot)=E(\\tilde{u}_\\cdot)^2=\\sum_{i=1}^t\\left(\\frac{n_i^2}{N^2}\\right){\\sigma}_u^2=\\left(\\frac1{N^2}\\right){\\sum}_{i=1}^t(n_i^2){\\sigma}_u^2\\] 由于对于 \\(i\\ne i^\\prime\\) 有 \\(E(u_iu_{i^\\prime})\\)，\\(u_i\\) 和 \\(\\tilde{u}_\\cdot\\) 之间的协方差为 \\[\\mathrm{Cov}(\\tilde{u}_\\cdot,u_i)=E(\\tilde{u}_\\cdot u_i)=\\left(\\frac{n_i}N\\right)E(u_i)^2=\\left(\\frac{n_i}N\\right)\\sigma_u^2\\] 把这些部分放在一起，\\(Q_2\\) 的期望中涉及 \\(u_i\\) 的部分是 \\[\\begin{aligned} \\sum_{i=1}^{t} &amp;n_{i}\\left[E(u_{i})^{2}+E(\\tilde{u}_{\\cdot})^{2}-2E(u_{i}\\tilde{u}_{\\cdot})\\right] \\\\ &amp;=\\sum_{i=1}^tn_i\\sigma_u^2+\\sum_{i=1}^t\\frac{n_i\\sigma_u^2}{N^2}\\left(\\sum_{i=1}^tn_i^2\\right)-2\\sum_{i=1}^t\\left(\\frac{n_i^2}N\\right)\\sigma_u^2 \\\\ &amp;\\left.=\\left(\\sum_{i=1}^tn_i{\\sigma}_u^2\\right.-\\frac{\\sum_{i=1}^tn_i^2}N{\\sigma}_u^2\\right)=\\left(N-\\frac{\\sum_{i=1}^tn_i^2}N\\right){\\sigma}_u^2 \\end{aligned}\\] 最后，将这两个部分合在一起，\\(Q_2\\) 的期望为 \\[\\begin{aligned}E(Q_2)=(t-1)\\sigma_\\varepsilon^2+\\left(N-\\frac{\\sum_{i=1}^tn_i^2}N\\right)\\sigma_u^2\\end{aligned}\\] \\(Q_2\\) 的期望均方为 \\[E{\\left(\\frac{Q_2}{t-1}\\right)}=\\sigma_\\varepsilon^2+{\\left(\\frac1{t-1}\\right)}{\\left(N-\\frac{\\sum_{i=1}^tn_i^2}N\\right)}\\sigma_u^2\\] 表 18.1 中给出了单向随机效应模型的方差分析表，包括来源、自由度、平方和以及期望均方。 表 18.1: 单向随机效应模型的方差分析表 x 18.3.2 Hartley 综合法的计算 Hartley (1967) 提出了一种技术，用于评估特定设计和平方和的均方期望值，他称之为综合法 (Hartley’s method of synthesis). 为了描述并随后应用这一技术，我们首先用矩阵表示从一般随机效应模型 (18.3) 计算出的平方和的期望值。任何通过公式计算或通过计算机软件提取的平方和，总是可以表示为数据的二次型 (quadratic form) \\[\\begin{equation} Q=\\boldsymbol{y&#39;Ay} \\tag{18.5} \\end{equation}\\] 其中 \\(\\boldsymbol y\\) 是观测向量，\\(\\boldsymbol A\\) 是适当选择的对称常数矩阵，称为二次型的矩阵 (the matrix of the quadratic form) (Graybill, 1976). 例如，n 个观测值的向量的样本方差为 \\[s^2=\\sum_{i=1}^n\\frac{(\\boldsymbol y_i-\\bar{\\boldsymbol y}_{\\cdot})^2}{n-1}=\\boldsymbol y^{\\prime}\\biggl[\\frac1{n-1}{\\biggl(\\boldsymbol I_n-\\frac1n\\boldsymbol J_n\\biggr)}\\biggr]\\boldsymbol{y}\\] 其中 \\(\\boldsymbol I_n\\) 为 n × n 单位阵，\\(\\boldsymbol J_n\\) 为 n × n 全一阵，二次型 \\(\\boldsymbol{y&#39;Ay}\\) 的矩阵为 \\[\\boldsymbol A=\\frac1{n-1}{\\biggl(\\boldsymbol I_n-\\frac1n\\boldsymbol J_n\\biggr)}\\] 针对不同的模型，总存在某些特定的选择使得矩阵 \\(\\boldsymbol A\\) 产生所需的平方和，幸运的是，正如我们很快将看到的那样，无需了解矩阵 \\(\\boldsymbol A\\) 中的元素具体是什么，甚至不必知道如何确定矩阵 \\(\\boldsymbol A\\) 的元素。只需要知道矩阵 \\(\\boldsymbol A\\) 是存在的。 对于一般随机效应模型 (18.3) 及其相应的协方差阵 \\(\\boldsymbol \\Sigma\\)，二次型的期望 (Graybill, 1976) 为 \\[\\begin{equation} E(\\boldsymbol{y^{\\prime}Ay})=\\mathrm{Tr}[\\boldsymbol{A\\Sigma}]+\\frac12\\mu^2\\boldsymbol{j}_n^{\\prime}\\boldsymbol A\\boldsymbol{j}_n \\tag{18.6} \\end{equation}\\] 其中 \\(\\operatorname{Tr}[\\boldsymbol{B}]=\\sum_{i=1}^nb_{ii}\\) 且 \\(b_{ii},i=1,2,\\cdots,n\\) 表示方阵 \\(\\boldsymbol B\\) 的对角元。方差分析中的平方和被构造为使得 \\(\\mu^2\\boldsymbol{j}_n^{\\prime}\\boldsymbol A\\boldsymbol{j}_n\\). 因此，平方和的期望不取决于 \\(\\mu^2\\boldsymbol{j}_n^{\\prime}\\boldsymbol A\\boldsymbol{j}_n\\)，并且由下式给出 \\[\\begin{equation} E(\\boldsymbol{y^{\\prime}Ay})=\\mathrm{Tr}[\\boldsymbol{A\\Sigma}] \\tag{18.7} \\end{equation}\\] 方程 (18.3) 中的一般随机效应模型的协方差阵为 \\[\\boldsymbol{\\Sigma}={\\sigma}_1^2\\boldsymbol{Z}_1\\boldsymbol{Z}_1^{\\prime}+{\\sigma}_2^2\\boldsymbol{Z}_2\\boldsymbol{Z}_2^{\\prime}+\\cdots+{\\sigma}_r^2\\boldsymbol{Z}_r\\boldsymbol{Z}_r^{\\prime}+{\\sigma}_\\varepsilon^2\\boldsymbol{I}_N\\] 因此，二次型 \\(\\boldsymbol{y^{\\prime}Ay}\\) 的期望是 \\[\\begin{aligned}E(\\boldsymbol{y^{\\prime}Ay})&amp;=\\mathrm{Tr}[\\boldsymbol A\\boldsymbol{\\Sigma}]=\\mathrm{Tr}[\\boldsymbol A(\\sigma_1^2\\boldsymbol Z_1\\boldsymbol Z_1^{\\prime}+\\sigma_2^2\\boldsymbol Z_2\\boldsymbol Z_2^{\\prime}+\\cdots+\\sigma_r^2\\boldsymbol Z_r\\boldsymbol Z_r^{\\prime}+\\sigma_\\varepsilon^2\\boldsymbol I_N)]\\\\&amp;=\\sigma_1^2\\mathrm{~Tr}[\\boldsymbol A\\boldsymbol Z_1\\boldsymbol Z_1^{\\prime}]+\\sigma_2^2\\mathrm{~Tr}[\\boldsymbol A\\boldsymbol Z_2\\boldsymbol Z_2^{\\prime}]+\\cdots+\\sigma_r^2\\mathrm{~Tr}[\\boldsymbol A\\boldsymbol Z_r\\boldsymbol Z_r^{\\prime}]+\\sigma_\\varepsilon^2\\mathrm{~Tr}[\\boldsymbol A]\\end{aligned}\\] 因此，\\(\\sigma^2_{\\varepsilon}\\) 的系数为 \\(\\mathrm{Tr}[\\boldsymbol A]\\)，这等于与平方和 \\(\\boldsymbol{y^{\\prime}Ay}\\) 相关的自由度。对于 \\(s=1,2,\\cdots,r\\)，\\(\\sigma^2_{\\varepsilon}\\) 的系数为 \\(\\mathrm{Tr}[\\boldsymbol A\\boldsymbol Z_s\\boldsymbol Z_s^{\\prime}]\\). 迹运算符的一个性质是，\\(\\mathrm{Tr}[\\boldsymbol A\\boldsymbol Z_s\\boldsymbol Z_s^{\\prime}]=\\mathrm{Tr}[\\boldsymbol Z_s^{\\prime}\\boldsymbol A \\boldsymbol Z_s]\\) 其中 \\(\\mathrm{Tr}[\\boldsymbol Z_s^{\\prime}\\boldsymbol A \\boldsymbol Z_s]\\) 是 \\(\\boldsymbol Z_s^{\\prime}\\boldsymbol A \\boldsymbol Z_s\\) 对角元之和，即 \\(\\mathrm{Tr}[\\boldsymbol Z_s^{\\prime}\\boldsymbol A \\boldsymbol Z_s]=\\sum_{j=1}^{t_s}\\boldsymbol z^\\prime_{sj}\\boldsymbol A \\boldsymbol z_{sj}\\) 因为 \\(\\boldsymbol Z_s\\) 中有 \\(t_s\\) 列。但是，\\(\\boldsymbol z^\\prime_{sj}\\boldsymbol A \\boldsymbol z_{sj}\\) 与 \\(\\boldsymbol{y^{\\prime}Ay}\\) 是相同的平方和，只不过这里是以列向量 \\(\\boldsymbol z^\\prime _{sj}\\) 代替 \\(\\boldsymbol y\\) 作为数据使用。因此，如果你有一个计算 \\(\\boldsymbol{y^{\\prime}Ay}\\) 的方程或计算机程序，它也可以用来计算 \\(\\boldsymbol z^\\prime_{sj}\\boldsymbol A \\boldsymbol z_{sj}\\). 因此，在 \\(\\boldsymbol{y^{\\prime}Ay}\\) 的期望中，\\(\\sigma^2_s\\) 的系数是 \\(\\boldsymbol{z&#39;}_{s1}\\boldsymbol{Az}_{s1}+\\boldsymbol{z&#39;}_{s2}\\boldsymbol{Az}_{s2}+\\cdots+\\boldsymbol{z&#39;}_{st_s}\\boldsymbol{Az}_{st_s}\\). 如果 \\(\\boldsymbol A\\) 的元素是已知的，那么可以明确地评估上述平方和。然而，由于通常会使用计算机代码来计算 \\(\\boldsymbol{y^{\\prime}Ay}\\)，此时 \\(\\boldsymbol A\\) 未知，那么每个 \\(\\boldsymbol z^\\prime_{sj}\\boldsymbol A \\boldsymbol z_{sj}\\) 可以通过让计算机计算以列向量 \\(\\boldsymbol z_{sj}\\) 作为数据向量（替代 \\(\\boldsymbol y\\)）所得的平方和来进行计算。因此，必须根据模型中的所有随机效应计算设计矩阵每列的平方和 \\([\\boldsymbol Z_1,\\boldsymbol Z_2,\\cdots,\\boldsymbol Z_r]\\)，就好像它们是数据一样，然后平方和 \\(\\boldsymbol{y^{\\prime}Ay}\\) 的期望被评估为 \\[E(\\boldsymbol{y^{\\prime}Ay})=v\\sigma_\\varepsilon^2+\\left(\\sum_{q=1}^{t_1}\\boldsymbol z_{1q}^{\\prime}\\boldsymbol A\\boldsymbol z_{1q}\\right)\\sigma_1^2+\\left(\\sum_{q=1}^{t_2}\\boldsymbol z_{2q}^{\\prime}\\boldsymbol A\\boldsymbol z_{2q}\\right)\\sigma_2^2+\\cdots+\\left(\\sum_{q=1}^{t_r}\\boldsymbol z_{rq}^{\\prime}\\boldsymbol A\\boldsymbol z_{rq}\\right)\\sigma_r^2\\] 其中 \\(v\\) 是与 \\(\\boldsymbol{y^{\\prime}Ay}\\) 相关的自由度。 为了更好地说明综合法的概念，我们重新计算单向随机效应模型的平方和 \\(Q_1\\) 和 \\(Q_2\\) 的期望值。首先，我们会采用一个特定模型，其中 \\(t=4\\)，并且对每个 \\(i\\) 都有 \\(n_i=4\\)，以此来展示如何计算期望值；接着为一般单向随机效应模型计算期望值。 在具有四个重复的完全随机设计结构中，用矩阵形式描述四个随机选取的小麦品种产量的模型为： \\[\\begin{bmatrix}y_{11}\\\\y_{12}\\\\y_{13}\\\\y_{14}\\\\y_{21}\\\\y_{22}\\\\y_{23}\\\\y_{24}\\\\y_{31}\\\\y_{32}\\\\y_{33}\\\\y_{34}\\\\y_{41}\\\\y_{42}\\\\y_{43}\\\\y_{44}\\end{bmatrix}=\\begin{bmatrix}1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\end{bmatrix}\\mu+\\begin{bmatrix}1&amp;0&amp;0&amp;0\\\\1&amp;0&amp;0&amp;0\\\\1&amp;0&amp;0&amp;0\\\\1&amp;0&amp;0&amp;0\\\\0&amp;1&amp;0&amp;0\\\\0&amp;1&amp;0&amp;0\\\\0&amp;1&amp;0&amp;0\\\\0&amp;1&amp;0&amp;0\\\\0&amp;0&amp;1&amp;0\\\\0&amp;0&amp;1&amp;0\\\\0&amp;0&amp;1&amp;0\\\\0&amp;0&amp;1&amp;0\\\\0&amp;0&amp;0&amp;1\\\\0&amp;0&amp;0&amp;1\\\\0&amp;0&amp;0&amp;1\\\\0&amp;0&amp;0&amp;1\\end{bmatrix}+\\begin{bmatrix}\\boldsymbol u_1\\\\\\boldsymbol u_2\\\\\\boldsymbol u_3\\\\\\boldsymbol u_4\\end{bmatrix}+\\begin{bmatrix} \\varepsilon_{11}\\\\\\varepsilon_{12}\\\\\\varepsilon_{13}\\\\\\varepsilon_{14}\\\\ \\varepsilon_{21}\\\\\\varepsilon_{22}\\\\\\varepsilon_{23}\\\\\\varepsilon_{24}\\\\ \\varepsilon_{31}\\\\\\varepsilon_{32}\\\\\\varepsilon_{33}\\\\\\varepsilon_{34}\\\\ \\varepsilon_{41}\\\\\\varepsilon_{42}\\\\\\varepsilon_{43}\\\\\\varepsilon_{44}\\end{bmatrix}\\] 或 \\(\\boldsymbol{y}=\\boldsymbol{j}_{16} \\mu+[\\boldsymbol z_1\\,\\,\\boldsymbol z_2\\,\\,\\boldsymbol z_3\\,\\,\\boldsymbol z_4]\\boldsymbol{u}+\\boldsymbol{\\varepsilon}\\). 组内平方和 (within sum of squares23) \\(Q_1\\) 的期望值为 \\[E(Q_1)=E(\\boldsymbol{y&#39;}\\boldsymbol A_w\\boldsymbol{y})=\\boldsymbol{\\sigma}_u^2\\left[\\boldsymbol{\\sum}_{j=1}^4\\boldsymbol{z}&#39;_j\\boldsymbol{A}_w\\boldsymbol{z}_j\\right]+12{\\sigma}_\\varepsilon^2\\] 其中 12 是与 \\(Q_1\\) 相关的自由度，\\(\\boldsymbol{A}_w\\) 表示组内平方和 \\(Q_1\\) 二次型的矩阵。为了获得 \\(\\sigma^2_u\\) 的系数，使用 \\(\\boldsymbol z_1\\) 作为数据计算组内平方和 \\(Q_1\\)，使用 \\(\\boldsymbol z_2\\) 作为数据计算 \\(Q_1\\)，使用 \\(\\boldsymbol z_3\\) 作为数据计算 \\(Q_1\\)，使用 \\(\\boldsymbol z_4\\) 作为数据计算 \\(Q_1\\). 对于列 \\(\\boldsymbol z_1\\) 的组内平方和 \\[\\begin{aligned}Q_1(\\boldsymbol z_1)=\\sum_{i=1}^4\\sum_{j=1}^4z_{1ij}^2-4\\sum_{i=1}^4\\bar{z}_{1i\\cdot}^2&amp;=4-4(1)=0\\end{aligned}\\] 同样，\\(Q_1(\\boldsymbol z_2),Q_1(\\boldsymbol z_3),Q_1(\\boldsymbol z_4)\\) 也为 0. 这意味着 \\(\\sigma^2_u\\) 在 \\(E(Q_1)\\) 中的系数为零，因此 \\(E(Q_1)=12{\\sigma}_\\varepsilon^2\\). 组间平方和 (between sum of squares24) \\(Q_2\\) 的期望值为 \\[E(Q_2)=E(\\boldsymbol{y&#39;}\\boldsymbol A_B\\boldsymbol{y})={\\sigma}_u^2\\biggl[\\boldsymbol{\\sum}_{j=1}^4\\boldsymbol{z&#39;}_{j}\\boldsymbol A_B\\boldsymbol{z}_j\\biggr]+3{\\sigma}_\\varepsilon^2\\] 其中 \\[Q_2=\\sum_{i=1}^tn_i(\\bar{y}_{i\\cdot}-\\bar{y}_{\\cdot\\cdot})^2=\\sum_{i=1}^tn_i\\bar{y}_{i\\cdot}^2-n_{\\cdot\\cdot}\\bar{y}_{\\cdot\\cdot}\\] 其中 3 是与 \\(Q_2\\) 相关的自由度，\\(\\boldsymbol{A}_B\\) 表示组间平方和 \\(Q_2\\) 二次型的矩阵。要计算 \\(\\sigma^2_u\\) 的系数，请使用每列 \\(\\boldsymbol z_1,\\boldsymbol z_2,\\boldsymbol z_3,\\boldsymbol z_4\\) 计算组间平方和 \\(Q_2\\) 的值，并将这四个值相加。使用 \\(\\boldsymbol z_1\\) 作为数据计算的组间平方和的值为 \\[Q_2(\\boldsymbol z_1){=}4\\sum_{i=1}^4\\bar{z}_{1i\\cdot}^2-16\\bar{z}_{\\cdot\\cdot\\cdot}^2=4(1^2+0^2+0^2+0^2){-}16(0.25)^2{=}3\\] \\(Q_2(\\boldsymbol z_2),Q_2(\\boldsymbol z_3),Q_2(\\boldsymbol z_4)\\) 的值也等于 3；因此，\\(\\sigma^2_u\\) 的系数为 \\(3+3+3+3=12\\). 使用这些值，\\(E(Q_2)\\) 的表达式为 \\[E(Q_2)=12\\sigma_u^2+3\\sigma_\\varepsilon^2\\] 接下来，使用 Hartley 的综合法来计算方程 (18.1) 中的一般单向随机效应模型的组内和组间平方和的期望值。模型的矩阵形式为 \\[\\begin{bmatrix}y_{11}\\\\\\vdots\\\\y_{1n_1}\\\\y_{21}\\\\\\vdots\\\\y_{2n_2}\\\\\\vdots\\\\y_{t1}\\\\\\vdots\\\\y_{tn_l}\\end{bmatrix}=\\begin{bmatrix}1\\\\\\vdots\\\\1\\\\1\\\\\\vdots\\\\1\\\\\\vdots\\\\1\\\\\\vdots\\\\1\\end{bmatrix} \\mu+\\begin{bmatrix}1&amp;0&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\1&amp;0&amp;\\cdots&amp;0\\\\0&amp;1&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\0&amp;1&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;1\\\\\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;1\\end{bmatrix}\\begin{bmatrix}\\boldsymbol{u}_1\\\\\\boldsymbol{u}_2\\\\\\vdots\\\\\\boldsymbol{u}_t\\end{bmatrix}+\\boldsymbol{\\varepsilon}\\] 或 \\[\\boldsymbol y=\\boldsymbol j_{n} \\mu+[\\boldsymbol z_1,\\boldsymbol z_2,\\ldots,\\boldsymbol z_t]\\boldsymbol u+\\boldsymbol \\varepsilon \\] 组内或误差平方和为 \\[Q_1=\\sum_{i=1}^t\\sum_{j=1}^{n_i}y_{ij}^2-\\sum_{i=1}^tn_i\\bar{y}_{i\\cdot}^2=\\boldsymbol{y&#39;A}_w\\boldsymbol{y}\\] 其期望为 \\[\\begin{aligned}E(Q_1)=\\sigma_u^2\\sum_{i=1}^t\\boldsymbol z_i&#39;\\boldsymbol A_w\\boldsymbol z_i+(N-t)\\sigma_\\varepsilon^2\\end{aligned}\\] 其中 \\(N=\\sum_{i=1}^tn_i\\) 以及 \\(\\boldsymbol A_w\\) 是组内平方和二次型的矩阵。当使用第一列 \\(\\boldsymbol z_1\\) 作为数据时，\\(Q_1\\) 的值为 \\[Q_1(\\boldsymbol z_1)=\\sum_{i=1}^t\\sum_{j=1}^{n_i} z_{1ij}^2-\\sum_{i=1}^tn_i\\bar{ z}_{1i\\cdot}^2=n_1-\\left[n_1(1)+n_2(0)+\\cdots+n_t(0)\\right]=0\\] 同样，\\(Q_1(\\boldsymbol z_2),Q_1(\\boldsymbol z_3),Q_1(\\boldsymbol z_4)\\) 也为 0. 因此，\\(\\sigma^2_u\\) 在 \\(E(Q_1)\\) 中的系数为零，这意味着 \\(E(Q_1)=(N-t)\\sigma^2_{\\varepsilon}\\)，并且其中存在与 \\(Q_1\\) 相关的 N-t 个自由度。 组间平方和为 \\[Q_2=\\sum_{i=1}^tn_i\\bar{y}_{i\\cdot}^2-n_{\\cdot\\cdot}\\bar{y}_{\\cdot\\cdot}^2=\\boldsymbol y^{\\prime}\\boldsymbol A_B\\boldsymbol y\\] 其期望为 \\[E(Q_2)=\\sigma_u^2\\sum_{i=1}^t\\boldsymbol z_i \\boldsymbol A_B\\boldsymbol z_i+(t-1)\\sigma_\\varepsilon^2\\] 其中 \\(\\boldsymbol A_B\\) 是组间平方和二次型的矩阵。当使用第一列 \\(\\boldsymbol z_1\\) 作为数据时，\\(Q_2\\) 的值为 \\[Q_2(\\boldsymbol z_1){=}\\sum_{i=1}^tn_i\\bar{z}_{1i\\cdot}^2-N\\bar{z}_{1\\cdot\\cdot}^2\\] 对于列 \\(\\boldsymbol z_1\\) 有 \\(\\bar z_{11\\cdot}=1,\\bar z_{12\\cdot}=\\bar z_{13\\cdot}=\\cdots \\bar z_{1t\\cdot}=0\\) 以及 \\(\\bar z_{1\\cdot\\cdot}=n_1/N\\). 因此 \\[Q_2(\\boldsymbol z_1)=n_1(1)^2+n_2(0)^2+\\cdots+n_t(0)^2-N(n_1/N)^2=\\frac{n_1-n_1^2}N\\] 类似地，使用 \\(\\boldsymbol Z\\) 的其他列作为数据的 \\(Q_2\\) 的值为 \\[Q_2(\\boldsymbol z_2)=\\frac{n_2-n_2^2}N,\\quad Q_2(\\boldsymbol z_3)=\\frac{n_3-n_3^2}N,\\ldots,Q_2(\\boldsymbol z_t)=\\frac{n_t-n_t^2}N\\] 合并这些结果，组间平方和的期望值为 \\[E(Q_2)=(t-1)\\sigma_\\varepsilon^2+\\left[\\sum_{i=1}^tQ_2(\\boldsymbol z_i)\\right]\\sigma_u^2=(t-1)\\sigma_\\varepsilon^2+\\left[\\sum_{i=1}^tn_i^2\\right]\\sigma_u^2\\] 通过 Hartley 综合法获得的 \\(Q_1\\) 和 \\(Q_2\\) 的期望值与使用代数技术获得的期望值相等。 接下来，使用 Hartley 综合法来评估用于描述在完全随机设计结构中具有交互作用的双向随机效应处理结构的模型的平方和期望值。在这种情况下，行处理和列处理都是随机效应。该实验的数据可建模为 \\[y_{ijk}=\\mu+a_i+b_j+c_{ij}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,s,j=1,2,\\ldots,t,\\quad k=1,2,\\ldots,n_{ij}\\] 其中 \\(a_i,i=1,2,\\cdots,s\\) 表示与行对应的随机效应，其具有 \\(i.i.d.\\,N(0,\\sigma^2_a)\\) 分布；\\(b_i,i=1,2,\\cdots,t\\) 表示与列对应的随机效应，其具有 \\(i.i.d.\\,N(0,\\sigma^2_b)\\) 分布；\\(c_{ij}\\) 表示行-列组合的随机效应，其具有 \\(i.i.d.\\,N(0,\\sigma^2_c)\\) 分布，\\(\\varepsilon_{ijk}\\) 实验单元误差，其具有 \\(i.i.d.\\,N(0,\\sigma^2_\\varepsilon)\\) 分布。图 18.1 中的示意图代表来自完全随机设计结构中的不均衡双向处理结构的数据，其中每个单元格有两到三个观测结果。 图 18.1: 双向随机效应处理结构示例 在图 18.1 所示数据结构的完全随机设计结构中，这种双向随机效应处理结构的矩阵形式为 \\[\\begin{bmatrix}y_{111}\\\\y_{112}\\\\y_{113}\\\\y_{121}\\\\y_{122}\\\\y_{131}\\\\y_{132}\\\\y_{211}\\\\y_{212}\\\\y_{221}\\\\y_{222}\\\\y_{223}\\\\y_{231}\\\\y_{232}\\end{bmatrix}=\\begin{bmatrix}1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\\\1\\end{bmatrix}\\mu +\\begin{bmatrix}1&amp;0\\\\1&amp;0\\\\1&amp;0\\\\1&amp;0\\\\1&amp;0\\\\1&amp;0\\\\1&amp;0\\\\0&amp;1\\\\0&amp;1\\\\0&amp;1\\\\0&amp;1\\\\0&amp;1\\\\0&amp;1\\\\0&amp;1\\end{bmatrix}\\begin{bmatrix}a_1\\\\a_2\\end{bmatrix}+\\begin{bmatrix}1&amp;0&amp;0\\\\1&amp;0&amp;0\\\\1&amp;0&amp;0\\\\0&amp;1&amp;0\\\\0&amp;1&amp;0\\\\0&amp;0&amp;1\\\\0&amp;0&amp;1\\\\1&amp;0&amp;0\\\\1&amp;0&amp;0\\\\0&amp;1&amp;0\\\\0&amp;1&amp;0\\\\0&amp;1&amp;0\\\\0&amp;0&amp;1\\\\0&amp;0&amp;1\\end{bmatrix}\\begin{bmatrix}b_1\\\\b_2\\\\b_3\\end{bmatrix}+\\begin{bmatrix}1&amp;0&amp;0&amp;0&amp;0&amp;0\\\\1&amp;0&amp;0&amp;0&amp;0&amp;0\\\\1&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;1&amp;0&amp;0&amp;0&amp;0\\\\0&amp;1&amp;0&amp;0&amp;0&amp;0\\\\0&amp;0&amp;1&amp;0&amp;0&amp;0\\\\0&amp;0&amp;1&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;1&amp;0&amp;0\\\\0&amp;0&amp;0&amp;1&amp;0&amp;0\\\\0&amp;0&amp;0&amp;0&amp;1&amp;0\\\\0&amp;0&amp;0&amp;0&amp;1&amp;0\\\\0&amp;0&amp;0&amp;0&amp;1&amp;0\\\\0&amp;0&amp;0&amp;0&amp;0&amp;1\\\\0&amp;0&amp;0&amp;0&amp;0&amp;1\\end{bmatrix}\\begin{bmatrix}c_{11}\\\\c_{12}\\\\c_{13}\\\\c_{21}\\\\c_{22}\\\\c_{23}\\end{bmatrix}+\\boldsymbol \\varepsilon\\] 或 \\(\\boldsymbol{y}=\\boldsymbol{j}_{14} \\mu+\\boldsymbol{Z}_1\\boldsymbol{a}+\\boldsymbol{Z}_2\\boldsymbol{b}+\\boldsymbol{Z}_3\\boldsymbol{c}+\\boldsymbol{\\varepsilon}\\) 其中模型参数为 \\(\\mu,\\sigma_a^2,\\sigma_b^2,\\sigma_c^2\\) 和 \\(\\sigma_\\varepsilon^2\\) 这种不均衡双向随机效应模型的平方和可以用几种不同的方法计算（见第 9 章和第 10 章）。在该模型的分析中，有四个方差分量，因此需要四个不同的平方和。为了演示综合方法，选择了四个平方和，它们对应于 SSROWS, SSCOLUMNS, SSINTERACTION 和 SSERROR 的均衡情况，但针对不等的样本量进行了修改（对应于 Henderson 的 I 型平方和，在本节稍后讨论）。四个平方和是 \\[\\begin{aligned} &amp;Q_1 =\\sum_{i=1}^s\\frac{y_{i\\cdot\\cdot}^2}{n_{i\\cdot}}-\\frac{y_{i\\cdot\\cdot}^2}{n_{\\cdot\\cdot}}\\mathrm{~(SSROWS)} \\\\ &amp;Q_2 =\\sum_{j=1}^t\\frac{y_{\\cdot j\\cdot}^2}{n_{\\cdot j}}-\\frac{y_{\\cdot\\cdot\\cdot}^2}{n_{\\cdot\\cdot}}\\mathrm{~(SSCOLUMNS)} \\\\ &amp;Q_3 =\\sum_{i=1}^\\text{s}{ \\sum _ { j = 1 }^{t}\\frac{y_{ij\\cdot}^2}{n_{ij}}-Q_1-Q_2+\\frac{y^2_{\\cdot\\cdot\\cdot}}{n_{\\cdot\\cdot}}\\quad\\text{(SSINTERACTION)}} \\\\ &amp;Q_4 =\\sum_{i=1}^s\\sum_{j=1}^t\\sum_{k=1}^{n_{ij}}{(y_{ijk}-\\bar{y}_{ij\\cdot})^2}\\quad\\text{(SSERROR)} \\end{aligned}\\] 对于图 18.1 中的数据结构， \\[Q_2=\\frac{y_{\\cdot1\\cdot}^2}5+\\frac{y_{\\cdot2\\cdot}^2}5+\\frac{y_{\\cdot3\\cdot}^2}4-\\frac{y_{\\cdot\\cdot\\cdot}^2}{14}\\] 以及，对于 \\(k_1,k_2,k_3\\) 的一些值，\\(E(Q_2)\\) 具有形式 \\(E(Q_2)＝k_1\\sigma_a^2+k_2\\sigma_b^2+k_3\\sigma_c^2+2\\sigma_\\varepsilon^2\\)，其中 2 是与 \\(Q_2\\) 相关的自由度。下一步是使用 Hartley 的综合法来确定 \\(k_1,k_2,k_3\\). 要确定 \\(k_1\\) 的值，请为 \\(\\boldsymbol Z_1\\) 的两列中的每一列计算 \\(Q_2\\). 使用 \\(\\boldsymbol Z_1\\) 的第一列作为数据的 \\(Q_2\\) 的值为 \\[\\begin{aligned}Q_2( \\boldsymbol z_{11})=\\frac{3^2}5+\\frac{2^2}5+\\frac{2^2}4-\\frac{7^2}{14}=0.1\\end{aligned}\\] 并且使用 \\(\\boldsymbol Z_1\\) 的第二列作为数据的 \\(Q_2\\) 的值为 \\[Q_2(\\boldsymbol z_{12})=\\frac{2^2}5+\\frac{3^2}5+\\frac{2^2}4-\\frac{5^2}{14}=0.1\\] 因此，\\(k_1＝Q_2( z_{11})+Q_2( z_{11})=0.1+0.1=0.2\\). 为确定 \\(k_2\\) 的值，计算 \\(\\boldsymbol Z_2\\) 每列的 \\(Q_2\\) 为 \\[ \\begin{aligned} Q_2(z_{21})=\\frac{5^2}5+\\frac{0^2}5+\\frac{0^2}4-\\frac{5^2}{14}=3.214 \\\\ Q_2(z_{22})=\\frac{0^2}5+\\frac{5^2}5+\\frac{0^2}4-\\frac{5^2}{14}=3.214 \\\\ Q_{2}(z_{23})=\\frac{0^{2}}{5}+\\frac{0^{2}}{5}+\\frac{4^{2}}{4}-\\frac{4^{2}}{14}=2.857 \\end{aligned} \\] \\(k_2\\) 的值为 \\(k_2=Q_2( z_{21})+Q_2( z_{22})+Q_2( z_{23})=3.214+3.214+2.857=9.285\\). \\(k_3\\) 的值是通过计算 \\(\\boldsymbol Z_3\\) 的每列的 \\(Q_2\\) 来获得的。\\(Q_2\\) 的值为 \\[\\begin{aligned} Q_2({z}_{311}) =\\frac{3^2}5+\\frac{0^2}5+\\frac{0^2}4-\\frac{3^2}{14}=1.157 \\\\ Q_2(z_{312}) =\\frac{0^2}5+\\frac{2^2}5+\\frac{0^2}4-\\frac{2^2}{14}=0.514 \\\\ Q_2(z_{313}) =\\frac{0^2}5+\\frac{0^2}5+\\frac{2^2}4-\\frac{2^2}{14}=0.714 \\\\ Q_{2}({z}_{321}) =\\frac{2^2}5+\\frac{0^2}5+\\frac{0^2}4-\\frac{2^2}{14}=0.514 \\\\ Q_2(z_{322}) =\\frac{0^2}5+\\frac{3^2}5+\\frac{0^2}4-\\frac{3^2}{14}=1.157 \\\\ Q_2({z}_{323})=\\frac{0^2}5+\\frac{0^2}5+\\frac{2^2}4-\\frac{2^2}{14}=0.714 \\end{aligned}\\] 因此，\\(k_3=1.157+0.514+0.714+0.514+1.157+0.714=4.770\\). 使用上述 \\(k_1,k_2,k_3\\) 的值，SSROWS 的期望值为 \\[E(Q_2)=0.200\\sigma_a^2+9.285\\sigma_b^2+4.770\\sigma_c^2+2\\sigma_\\varepsilon^2\\] 类似地，应用 Hartley 的综合法，\\(Q_1\\) 和 \\(Q_3\\) 的期望值被确定为 \\[E(Q_1)=7.000{\\sigma}_a^2+0.143{\\sigma}_b^2+2.429{\\sigma}_c^2+(1){\\sigma}_\\varepsilon^2\\] 以及 \\[E(Q_3)=4.371{\\sigma}_c^2+2{\\sigma}_\\varepsilon^2\\] 一般来说，SSERROR 的期望值等于与 SSERROR 相关的自由度乘以 \\({\\sigma}_\\varepsilon^2\\)，在这种情况下，它提供 \\[E(Q_4)=E(\\text{SSERROR})=8\\sigma_\\varepsilon^2\\] 对于不均衡处理结构，计算平方和的方法有很多种，包括 SAS®-GLM 的 I-IV 型平方和，SAS-MIXED 的 I-III 型平方和，以及 Henderson 提出的四种方法。下面展示了如何使用 SAS 计算 SAS-GLM 的 I-III 型期望值，并演示了如何使用 SAS 来提供平方和期望的计算。表 18.2 包含 SAS 代码，用于生成列 \\(\\boldsymbol Z_1\\)（由 \\(\\boldsymbol a_1\\) 和 \\(\\boldsymbol a_2\\) 表示）、\\(\\boldsymbol Z_1\\)（由 \\(\\boldsymbol b_1,\\boldsymbol b_2\\) 和 \\(\\boldsymbol b_3\\) 表示）和 \\(\\boldsymbol Z_3\\)（由 \\(\\boldsymbol c_{11},\\boldsymbol c_{12},\\boldsymbol c_{13},\\boldsymbol c_{21},\\boldsymbol c_{22}\\) 和 \\(\\boldsymbol c_{23}\\) 表示），并使用 SAS-GLM 计算每列的三种类型的平方和。每列的平方和如表 18.3 所示。由行导致的 I 型平方和期望值的计算为 \\[\\begin{aligned} E[\\mathrm{SSROW(I)}]=&amp;(1)\\sigma_\\varepsilon^2+(0.6429+0.2857+0.2857+0.2857+0.6429+0.2857)\\sigma_c^2\\\\ &amp;+(0.0714+0.0714+0.000)\\sigma_b^2+(3.500+3.500)\\sigma_a^2 \\\\ =&amp;\\sigma_\\varepsilon^2+2.4284\\sigma_c^2+0.1428\\sigma_b^2+7\\sigma_a^2 \\end{aligned}\\] 表 18.2: 图 18.1 中数据结构和表 19.2 中的数据的 \\([\\boldsymbol Z_1,\\boldsymbol Z_2,\\boldsymbol Z_3]\\) 和 \\(\\boldsymbol y\\) 的每列的 I-III 型平方和的 SAS 代码 x 表 18.3: 图 18.1 中数据结构和表 19.2 中的数据的 \\([\\boldsymbol Z_1,\\boldsymbol Z_2,\\boldsymbol Z_3]\\) 和 \\(\\boldsymbol y\\) 的每列的 I-III 型平方和 x 各效应的平方和总和显示在表 18.4 中。因此，表 18.5 包含使用表 18.4 中显示的摘要计算的剩余平方和的期望。可以计算每个预期平方和的系数，其中 \\(\\sigma^2_\\varepsilon\\) 的系数是与相应平方和相关的自由度。 表 18.4: 使用表 18.3 中的数据，针对每个效应，\\([\\boldsymbol Z_1,\\boldsymbol Z_2,\\boldsymbol Z_3]\\) 的每列的 I-III 型平方和之和 x 表 18.5: 使用 Hartley 综合法计算的 SAS I-III 型平方和的期望值 x 在接下来讨论的统计文献中，有几种计算平方和的替代方法（附有名称）。讨论包含关于何时可以将这些技术应用于混合效应模型以及随机效应模型的指示。Henderson (1953) 介绍了四种计算平方和的方法，称为 Henderson’s methods I, II, III 和 IV （另见 Searle, 1987; Henderson, 1984). 以下讨论考虑了 Henderson’s methods I 和 II. 方差分析法或 Henderson’s methods I 仅适用于随机效应模型，是一种由计算平方和组成的技术，类似于为均衡数据集计算的平方和，不同之处在于它们被更改以考虑每个处理组合或不均衡数据集的不等数量的观测值。上面使用 Henderson’s methods I 平方和时未给出理由，下面给出理由。使用双向分类随机效应模型来演示该方法。 可用于描述均衡双向数据集的模型是 \\[\\begin{aligned}y_{ijk}&amp;=\\mu+a_i+b_j+c_{ij}+\\varepsilon_{ijk}&amp;&amp;i=1,2,\\ldots,s,&amp;j=1,2,\\ldots,t,&amp;k=1,2,\\ldots,n\\end{aligned}\\] 其中 \\[a_i\\thicksim i.i.d.\\mathrm{~N}(0,\\sigma_a^2),\\quad b_j\\thicksim i.i.d.\\mathrm{~N}(0,\\sigma_b^2),\\quad c_{ij}\\thicksim i.i.d.\\mathrm{~N}(0,\\sigma_c^2),\\quad\\mathrm{and~}\\quad\\varepsilon_{ijk}\\thicksim i.i.d.\\mathrm{~N}(0,\\sigma_\\varepsilon^2)\\] 方差分析中使用的平方和为 \\[\\begin{aligned} \\text{SSA}&amp; =nt\\sum_{i=1}^{s}(\\bar{y}_{i\\cdot\\cdot}-\\bar{y}_{\\cdot\\cdot\\cdot})^2=\\sum_{i=1}^{s}\\frac{y_{i\\cdot\\cdot}^2}{nt}-\\frac{y_{\\cdot\\cdot\\cdot}^2}{nst} \\\\ \\text{SSB}&amp; =ns\\sum_{j=1}^t(\\bar{y}_{\\cdot j\\cdot}-\\bar{y}_{\\cdot\\cdot\\cdot})^2=\\sum_{j=1}^t\\frac{y_{\\cdot j\\cdot}^2}{ns}-\\frac{y_{\\cdot\\cdot\\cdot}^2}{nst}, \\\\ \\text{SSAB}&amp; =n\\sum_{i=1}^s\\sum_{j=1}^t(\\bar{y}_{ij\\cdot}-\\bar{y}_{i\\cdot\\cdot}-\\bar{y}_{\\cdot j\\cdot}+\\bar{y}_{\\cdot\\cdot\\cdot})^2 \\\\ &amp;=\\sum_{i=1}^s\\sum_{j=1}^t\\frac{y_{ij\\cdot}^2}n-\\sum_{i=1}^s\\frac{y_{i\\cdot\\cdot}^2}{nt}-\\sum_{j=1}^t\\frac{y_{\\cdot j\\cdot}^2}{ns}+\\frac{y_{\\cdot\\cdot\\cdot}^2}{nst} \\end{aligned}\\] 要将这些平方和从等样本量转换为不等样本量，请将乘积 \\(nst\\) 替换为 \\(n_{\\cdot\\cdot}\\)，将 \\(ns\\) 替换为 \\(n_{\\cdot j}\\)，将 \\(nt\\) 替换为 \\(n_{i\\cdot }\\). 因此，不等样本量的平方和变为 \\[ \\begin{aligned} \\text{SSA} &amp;=\\sum_{i=1}^s\\frac{y_{i\\cdot\\cdot}^2}{n_{i\\cdot}}-\\frac{y^2_{\\cdot\\cdot\\cdot}}{n_{\\cdot\\cdot\\cdot}}, \\\\ \\text{SSB} &amp;=\\sum_{j=1}^t\\frac{y_{\\cdot j\\cdot}^2}{n_{\\cdot j}}-\\frac{y_{\\cdot\\cdot\\cdot}^2}{n_{\\cdot\\cdot\\cdot}}, \\\\ \\text{S} SAB&amp;=\\sum_{i=1}^s\\sum_{j=1}^t\\frac{y_{ij\\cdot}^2}{n_{ij}}-\\sum_{i=1}^s\\frac{y_{i\\cdot\\cdot}^2}{n_{i\\cdot}}-\\sum_{j=1}^t\\frac{y_{\\cdot j \\cdot}^2}{n_{\\cdot j}}+\\frac{y_{\\cdot\\cdot\\cdot}^2}{n_{\\cdot\\cdot}} \\end{aligned} \\] 这些平方和是在讨论图 18.1 中数据结构之初所使用的。 拟合常数法 (fitting-constants method)，或 Henderson’s methods III，涉及将数据拟合到各种线性模型中，然后计算相应的平方和。该方法使用所谓的因拟合完全模型而导致的平方和减少以及因拟合各种子模型而导致的平方和减少（参见第 10 章）。为了设定符号，考虑模型25 \\[\\boldsymbol y=\\boldsymbol X_1\\boldsymbol b_1+\\boldsymbol X_2\\boldsymbol b_2+\\boldsymbol X_3\\boldsymbol b_3+\\boldsymbol\\varepsilon \\] 由于拟合完全模型而导致的总平方和的减少为 \\[R(\\boldsymbol b_1,\\boldsymbol b_2,\\boldsymbol b_3)=\\boldsymbol y^{\\prime}\\boldsymbol y-\\mathrm{SSERROR}(\\boldsymbol b_1,\\boldsymbol b_2,\\boldsymbol b_3)\\] 其中 \\(\\mathrm{SSERROR}(\\boldsymbol b_1,\\boldsymbol b_2,\\boldsymbol b_3)\\) 是拟合完全模型后的残差平方和。由于拟合 \\(\\boldsymbol b_1\\) 和 \\(\\boldsymbol b_2\\) 导致的减少为 \\(R(\\boldsymbol b_1,\\boldsymbol b_2)=\\boldsymbol y^{\\prime}\\boldsymbol y-{\\text{SSERROR}(\\boldsymbol b_1,\\boldsymbol b_2)}\\) 其中 \\({\\text{SSERROR}(\\boldsymbol b_1,\\boldsymbol b_2)}\\) 是模型 \\(\\boldsymbol y=\\boldsymbol X_1 \\boldsymbol b_1+\\boldsymbol X_2 \\boldsymbol b_2 + \\boldsymbol \\varepsilon\\) 的残差平方和。 拟合 \\(\\boldsymbol b_1\\) 和 \\(\\boldsymbol b_2\\) 后由于 \\(\\boldsymbol b_3\\) 造成的减少由 \\(R(\\boldsymbol b_3 |\\boldsymbol b_1 , \\boldsymbol b_2)\\) 表示，并由下式给出： \\(R(\\boldsymbol b_3 |\\boldsymbol b_l , \\boldsymbol b_2) = R(\\boldsymbol b_1 , \\boldsymbol b_2, \\boldsymbol b_3) - R(\\boldsymbol b_1 , \\boldsymbol b_2) = \\text{SSERROR}(\\boldsymbol b_1, \\boldsymbol b_2) - \\text{SSERROR}(\\boldsymbol b_1, \\boldsymbol b_2, \\boldsymbol b_3)\\)。同样，拟合 \\(\\boldsymbol b_2\\) 后由于 \\(\\boldsymbol b_1\\) 导致的减少为 \\(R(\\boldsymbol b_1 |\\boldsymbol b_2) = R(\\boldsymbol b_1, \\boldsymbol b_2) - R(\\boldsymbol b_2) = \\text{SSERROR}(\\boldsymbol b_2)-\\text{SSERROR}(\\boldsymbol b_1, \\boldsymbol b_2)\\)。最后，拟合 \\(\\boldsymbol b_3\\) 后由于 \\(\\boldsymbol b_1\\) 和 \\(\\boldsymbol b_2\\) 导致的减少为 \\(R(\\boldsymbol b_1 , \\boldsymbol b_2 |\\boldsymbol b_3) = R(\\boldsymbol b_1 , \\boldsymbol b_2, \\boldsymbol b_3) - R(\\boldsymbol b_3) = \\text{SSERROR}(\\boldsymbol b_3) - \\text{SSERROR}(\\boldsymbol b_1, \\boldsymbol b_2, \\boldsymbol b_3)\\). 使用此技术的优点之一是，\\(E[R(\\boldsymbol b_1 , \\boldsymbol b_2 |\\boldsymbol b_3)]\\) 不依赖于 \\(\\boldsymbol b_3\\)（如果它是固定效应）或 \\(\\sigma^2_\\varepsilon\\)（如果它是随机效应），除非 \\(\\boldsymbol b_3\\) 表示 \\(\\boldsymbol b_1\\) 和 \\(\\boldsymbol b_2\\) 之间的交互作用或者与 \\(\\boldsymbol b_1\\) 或 \\(\\boldsymbol b_2\\) 的交互作用26。 对于模型 \\[\\boldsymbol y=\\boldsymbol j \\mu+\\boldsymbol X_1\\boldsymbol b+\\boldsymbol X_2\\boldsymbol t+\\boldsymbol X_3\\boldsymbol g+\\boldsymbol \\varepsilon \\] 其中 \\(\\boldsymbol{b}\\sim N(0,\\sigma_b^2),\\boldsymbol{t}\\sim N(0,\\sigma_t^2),\\boldsymbol{g}\\sim N(0,\\sigma_g^2)\\) 以及 \\(\\boldsymbol{\\varepsilon}\\sim N(0,\\sigma_\\varepsilon^2)\\)，一组可能的平方和（来自 SAS-GLM 和 SAS-MIXED 的 I 型平方和）为 \\[\\begin{aligned} &amp;R(\\boldsymbol b| \\mu)=R( \\mu,\\boldsymbol b)-R( \\mu) \\\\ &amp;R(\\boldsymbol t| \\mu,\\boldsymbol b)=R( \\mu,\\boldsymbol b,\\boldsymbol t)-R( \\mu,\\boldsymbol b) \\\\ &amp;R(\\boldsymbol g| \\mu,\\boldsymbol b,\\boldsymbol t)=R( \\mu,\\boldsymbol b,\\boldsymbol t,\\boldsymbol g)-R( \\mu,\\boldsymbol b,\\boldsymbol t) \\\\ &amp;\\mathrm{SSERROR}( \\mu,\\boldsymbol b,\\boldsymbol t,\\boldsymbol g)]=\\boldsymbol y^{\\prime}\\boldsymbol y-R( \\mu,\\boldsymbol b,\\boldsymbol t,\\boldsymbol g) \\end{aligned}\\] 这些平方和的期望具有以下形式 \\[\\begin{aligned} &amp;E[\\text{SSERROR}( \\mu,\\boldsymbol b,\\boldsymbol t,\\boldsymbol g)]=(n-p)\\sigma_\\varepsilon^2 \\\\ &amp;E[R(\\boldsymbol g| \\mu,\\boldsymbol b,\\boldsymbol t)]=k_1\\sigma_\\varepsilon^2+k_2\\sigma_g^2 \\\\ &amp;E[R(\\boldsymbol t| \\mu,\\boldsymbol b)]=k_3\\sigma_\\varepsilon^2+k_4\\sigma_g^2+k_5\\sigma_t^2, \\\\ &amp;E[R(\\boldsymbol b| \\mu)]=k_6\\sigma_\\varepsilon^2+k_7\\sigma_g^2+k_8\\sigma_t^2+k_9\\sigma_b^2 \\end{aligned}\\] 也可以使用由 \\(R(\\boldsymbol t| \\mu),R(\\boldsymbol b| \\mu, \\boldsymbol t),R(\\boldsymbol g| \\mu, \\boldsymbol b, \\boldsymbol t)\\) 和 \\(\\text{SSERROR}( \\mu,\\boldsymbol b,\\boldsymbol t, \\boldsymbol g)\\) 给出的 I 型平方和，拟合常数法可以用于随机效应和混合效应模型，只要固定效应先于随机效应拟合即可。 综合法可用于评估涉及随机效应和/或多个误差项的任何模型的平方和的期望。一组平方和及其期望（或均方）可用于估计方差分量，以开发假设检验，并构造关于各个方差分量和/或方差分量函数的置信区间。第 19 章讨论了估计方法，第 20 章介绍了推断技术。许多统计软件程序自动使用 Hartley 综合法来计算期望均方 (expected mean squares). 18.4 结束语 本章定义了随机效应和固定效应的概念以及随机效应模型的概念。随机效应模型以矩阵形式表示，以描述计算期望均方的方法。采用完全随机设计结构中不均衡单向处理结构来演示计算期望均方的代数方法和 Hartley’s 综合法。描述了计算平方和的不同方法，并使用完全随机设计结构中不均衡双向处理结构来演示各自期望均方的计算。提供 SAS 代码来演示 Hartley’s 综合法。 18.5 练习 原文：The general random effects model will have r random components representing the main effects and interactions for the random effect factors of the treatment structure and for those factors used to describe the design structure as well as possible interactions between components of the design and treatment structures used to describe the necessary error terms.↩︎ 是前文 “the sum of squares within levels of the random effect” 的简写。↩︎ 是前文 “the sum of squares between the levels of the random effect” 的简写。↩︎ 原书上下文并没有给出这些符号的意义，也令译者一头雾水。尤其下方的 “\\(\\boldsymbol{b}\\sim N(0,\\sigma_b^2),\\boldsymbol{t}\\sim N(0,\\sigma_t^2),\\boldsymbol{g}\\sim N(0,\\sigma_g^2)\\)”，原书中这些变量确实是加粗字体，但其分布并没有表示为多元正态分布的形式。↩︎ 原文：unless \\(\\boldsymbol b_3\\) denotes an interaction between \\(\\boldsymbol b_1\\) and \\(\\boldsymbol b_2\\) or an interaction with \\(\\boldsymbol b_1\\) or \\(\\boldsymbol b_2\\).↩︎ "],["chap19.html", "第 19 章 方差分量的估计方法 19.1 矩法 19.2 最大似然 19.3 受限或残差最大似然估计 19.4 MIVQUE 法 19.5 使用 JMP 估计方差分量 19.6 结束语 19.7 练习", " 第 19 章 方差分量的估计方法 “By a small sample, we may judge of the whole piece.” - Miguel de Cervantes from Don Quixote 对于一般随机效应模型，估计方差分量有几种方法。当设计均衡（每个单元格样本量相等且没有缺失的单元格）时，其中的一些程序会产生相同的估计，而当设计不均衡时，则会产生不同的估计。本章讨论的四种技术分别是矩法 (method of moments)、最大似然 (maximum likelihood, ML)、受限或残差最大似然 (restricted, or residual maximum likelihood, REML) 和 MIVQUE. 矩法产生无偏估计，最大似然和 REML 估计是一致的，并且具有最大似然估计通常的大样本量特性，而 MIVQUE 法产生的估计在二次无偏估计类中具有最小方差。当设计均衡且方差分量的解均为正时，矩法、REML 和 MIVQUE 估计是相同的。当设计不均衡时，矩法估计最容易计算，而其他三种方法则需要迭代算法。另一方面，最大似然、REML 和 MIVQUE 法提供的估计比矩法具有更好的性质。REML 通常是估计方差分量的首选方法。 19.1 矩法 自 Eisenhart (1947) 将随机效应模型命名为 MODEL II 以来，矩法一直被用于获取得方差分量的估计。许多研究人员在接下来的 20 年里致力于矩法的研究，推导了估计，并开发了检验假设的方法以及构造方差分量置信区间的方法（Searle, 1987; Graybill, 1976; Henderson 1984; Searle et al. 1992; Burdick and Graybill, 1992 等提供了很好的参考文献列表）。在本节中，讨论矩法估计过程的广义版本。 一般随机效应模型可以写为 \\[\\boldsymbol y=\\boldsymbol j_N\\boldsymbol\\mu+\\boldsymbol Z_1\\boldsymbol u_1+\\boldsymbol Z_2\\boldsymbol u_2+\\cdots+\\boldsymbol Z_r\\boldsymbol u_r+\\boldsymbol \\varepsilon \\] 其中 \\[\\begin{align} E(\\boldsymbol{u}_i)&amp;=\\boldsymbol{0},\\quad i=1,2,\\ldots,r\\\\\\operatorname{Var}(\\boldsymbol{u}_i)&amp;={\\sigma}_i^2\\boldsymbol{I}_{t_i},\\quad i=1,2,\\ldots,r\\\\E(\\boldsymbol{\\varepsilon})&amp;=\\boldsymbol{0},\\operatorname{Var}(\\boldsymbol{\\varepsilon})={\\sigma}_{\\boldsymbol{\\varepsilon}}^2\\boldsymbol{I}_N \\tag{19.1} \\end{align}\\] \\(\\boldsymbol u_1,\\boldsymbol u_2,\\cdots,\\boldsymbol u_r,\\boldsymbol \\varepsilon\\) 为独立的随机向量。 用于估计方程 (19.1) 的一般随机效应模型的方差分量的矩法技术包括以下步骤： 计算模型中方差分量的平方和及其相应的均方。 根据方差分量评估每个均方的期望；这些期望必须不涉及 \\(\\boldsymbol \\mu\\)（或任何其他固定效应参数），并且每个方差分量必须包括在至少一个均方的期望中。 令均方的期望等于均方的观测值，从而生成方差分量的线性方程组（用方程组中的方差分量解替换方差分量参数）。 求解所得方程组以获得每个方差分量的估计。 矩法的一个问题是方差分量的一些估计可能具有负值。当方差分量的解为负时，将方差分量的估计设置为零（将估计保留在参数空间中）。 当模型 (19.1) 的随机效应 \\(\\boldsymbol u_1,\\boldsymbol u_2,\\cdots,\\boldsymbol u_r,\\boldsymbol \\varepsilon\\) 联合独立且服从正态分布时，并且当平方和彼此独立分布时，所得方差分量的估计为最小方差无偏的 (minimum variance unbiased)。如果 \\(\\boldsymbol u_1,\\boldsymbol u_2,\\cdots,\\boldsymbol u_r,\\boldsymbol \\varepsilon\\) 具有与正态分布相同的前四阶矩，则估计是最小方差二次无偏的 (minimum variance quadratic unbiased) (Graybill, 1976, p. 632). 矩法技术不需要为了获得估计而假设正态性。在不假设正态性，或不假设随机向量的分布具有与正态分布相同前四阶矩的情况下，这些估计所拥有的唯一已知属性是：它们是无偏的。然而，当解为负时将估计设置为零的过程意味着估计不再是无偏的。 矩法的关键是确定如何计算平方和，然后评估所得均方期望。这些主题在第 18 章中进行了讨论。 如果模型具有 r+1 个方差分量 \\(\\sigma_\\varepsilon^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_r^2\\)，则需要 r+1 个平方和（或均方）。设 \\(Q_0=\\boldsymbol y^\\prime \\boldsymbol A_0 \\boldsymbol y,Q_1=\\boldsymbol y^\\prime \\boldsymbol A_1 \\boldsymbol y,\\cdots,Q_r=\\boldsymbol y^\\prime \\boldsymbol A_r \\boldsymbol y\\)，表示具有各自期望值的平方和，这些期望值为 \\[\\begin{aligned}E(Q_i)=b_{i0}\\sigma_\\varepsilon^2+b_{i1}\\sigma_1^2+b_{i2}\\sigma_\\gamma^2+\\cdots+b_{ir}\\sigma_r^2,\\quad i=0,1,2,\\ldots,r\\end{aligned}\\] 令每个平方和等于其期望值，在方差上加上波浪号（~），将解表示为 \\[Q_i=b_{i0}\\tilde{\\sigma}_\\varepsilon^2+b_{i1}\\tilde{\\sigma}_1^2+b_{i2}\\tilde{\\sigma}_2^2+\\cdots+b_{ir}\\tilde{\\sigma}_r^2,\\quad i=0,1,2,\\ldots,r\\] 或以矩阵表示法 \\[\\begin{bmatrix}Q_0\\\\Q_1\\\\Q_2\\\\\\vdots\\\\Q_r\\end{bmatrix}=\\begin{bmatrix}b_{00}&amp;b_{01}&amp;b_{02}&amp;\\cdots&amp;b_{0r}\\\\b_{10}&amp;b_{11}&amp;b_{12}&amp;\\cdots&amp;b_{1r}\\\\b_{20}&amp;b_{21}&amp;b_{22}&amp;\\cdots&amp;b_{2r}\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\b_{r0}&amp;b_{r1}&amp;b_{r2}&amp;\\cdots&amp;b_{rr}\\end{bmatrix}\\begin{bmatrix}\\tilde{\\sigma}_\\varepsilon^2\\\\\\tilde{\\sigma}_1^2\\\\\\tilde{\\sigma}_2^2\\\\\\vdots\\\\\\tilde{\\sigma}_r^2\\end{bmatrix}\\] 或 \\(\\boldsymbol Q=\\boldsymbol B \\tilde {\\boldsymbol\\sigma}^2\\). 如果矩阵 \\(\\boldsymbol B\\) 的秩为 r+1，那么所有的方差分量都是可估的。如果 \\(\\boldsymbol B\\) 的秩小于 r+1，则不是所有的方差分量都是可估的，并且只有方差分量的一些线性组合是可估的。假设 \\(\\boldsymbol B\\) 的秩为 r+1，则方程组的解为 \\[\\tilde {\\boldsymbol\\sigma}^2=\\boldsymbol B^{-1}\\boldsymbol Q{=}\\boldsymbol C\\boldsymbol Q\\mathrm{~(say)}\\] 在不将值限制在参数空间的情况下获得该解；也就是说，有些解可能是负的。\\(\\sigma_i^2\\) 的解由 \\(\\tilde \\sigma_i^2\\) 表示，估计由 \\(\\hat \\sigma_i^2\\) 表示，其中 \\[\\hat{\\sigma}_i^2=\\begin{cases}\\tilde{\\sigma}_i^2&amp;\\mathrm{~if~}\\tilde{\\sigma}_i^2&gt;0\\\\0&amp;\\mathrm{~if~}\\tilde{\\sigma}_i^2\\leq0&amp;\\end{cases}\\quad i=0,1,2,\\ldots,r\\] 在许多计算平方和的模型和方法中，矩阵 \\(\\boldsymbol B\\) 是三角阵，因此可以在不求 \\(\\boldsymbol B\\) 的逆的情况下获得解。 每个解都是观测到的平方和 \\(Q_0,Q_1,Q_2,\\cdots,Q_r\\) 的线性组合 \\[\\tilde{\\sigma}_i^2=c_{i0}Q_0+c_{i1}Q_1+c_{i2}Q_2+\\cdots+c_{ir}Q_r\\quad i=0,1,2,\\ldots,r\\] 其中 \\(c_i&#39;=[c_{i0}\\quad c_{i1}\\quad c_{i2}\\quad \\cdots\\quad c_{ir}]\\) 是 \\(\\boldsymbol C=\\boldsymbol B^{-1}\\) 的第 \\(i\\) 行。\\(\\tilde \\sigma_i^2\\) 的方差为 \\[\\mathrm{Var}(\\tilde{\\sigma}_i^2)=\\mathrm{Var}(c_{i0}Q_0+c_{i1}Q_1+c_{i2}Q_2+\\cdots+c_{ir}Q_r)\\] 当 \\(Q_i,i=0,1,\\cdots,r\\) 不相关时，\\(\\tilde \\sigma_i^2\\) 的方差为 \\[\\operatorname{Var}(\\tilde{\\sigma}_i^2)=c_{i0}^2\\operatorname{Var}(Q_0)+c_{i1}^2\\operatorname{Var}(Q_1)+c_{i2}^2\\operatorname{Var}(Q_2)+\\cdots+c_{ir}^2\\operatorname{Var}(Q_r)\\] Searle (1971, Chapter 11) 总结了几种模型的矩法估计及其方差。对于大多数均衡模型（假设随机变量分布的矩对应于正态分布的前四阶矩），矩法估计是方差分量的一致最小方差无偏估计 (uniformly minimum variance unbiased estimators) (Graybill, 1976). 因此，对于几乎均衡的模型，矩法估计应该具有相当好的性质。 19.1.1 应用。示例 19.1：不均衡单向模型 示例 18.2 的不均衡单向随机效应模型为 \\[y_{ij}=\\mu+u_i+\\varepsilon_{ij}\\quad i=1,2,\\ldots,t\\mathrm{~and~}j=1,2,\\ldots,n_i\\] 其中 \\(u_i\\) 不相关且均值为 0 方差为 \\(\\sigma^2_1\\)，\\(\\varepsilon_{ij}\\) 不相关且均值为 0 方差为 \\(\\sigma^2_{\\varepsilon}\\)，并且 \\(u_i\\) 与 \\(\\varepsilon_{ij}\\) 不相关。可以使用的两个平方和是组内平方和 (sum of squares within) \\(Q_0\\) 或 SSW ，以及组间平方和 (sums of squares between) \\(Q_1\\) 或 SSB，其中 \\[\\begin{aligned}Q_0&amp;=\\sum_{i=1}^t\\sum_{j=1}^{n_i}(y_{ij}-\\bar{y}_{i\\cdot})^2=\\sum_{i=1}^t\\sum_{j=1}^{n_i}y_{ij}^2-\\sum_{i=1}^tn_i\\bar{y}_{i\\cdot}^2=SSW\\\\\\\\\\\\Q_1&amp;=\\sum_{i=1}^tn_i(\\bar{y}_{i\\cdot}-\\bar{y}_{\\cdot\\cdot})^2=\\sum_{i=1}^tn_i\\bar{y}_{i\\cdot}^2-\\left(\\sum_{i=1}^tn_i\\right)\\bar{y}_{\\cdot}^2=SSB\\end{aligned}\\] \\(Q_0,Q_1\\) 的期望值在第 18 章中评估为 \\[\\begin{aligned}E(Q_0)&amp;=(N-t){\\sigma}_\\varepsilon^2\\\\\\\\E(Q_1)&amp;=(t-1){\\sigma}_\\varepsilon^2+\\left(N-\\frac{{\\sum}_{i=1}^t{n}_i^2}N\\right){\\sigma}_1^2\\end{aligned}\\] 其中 \\(N=\\sum_{i=1}^tn_i\\). 通过令平方和等于其期望值而获得的方程为 \\[\\begin{aligned}&amp;Q_0=(N-t)\\tilde{{\\sigma}}_\\varepsilon^2\\\\\\\\&amp;Q_1=(t-1)\\tilde{{\\sigma}}_\\varepsilon^2+\\left(N-\\frac{\\sum_{i=1}^tn_i^2}N\\right)\\tilde{{\\sigma}}_1^2\\end{aligned}\\] 或以矩阵表示法 \\[\\begin{bmatrix}Q_0\\\\Q_1\\end{bmatrix}=\\begin{bmatrix}N-t&amp;0\\\\(t-1)&amp;N-\\frac{\\sum_{i=1}^tn_i^2}N\\end{bmatrix}\\begin{bmatrix}\\tilde{\\sigma}_\\varepsilon^2\\\\\\tilde{\\sigma}_1^2\\end{bmatrix}\\] 方程组也可以通过令观测到的均方等于它们的期望来生成，因为均方是通过将每个方程除以其相应的自由度来获得的。解是相同的。所得到的涉及均方的待解方程组为 \\[\\begin{aligned}\\frac{Q_0}{N-t}&amp;=\\tilde{\\sigma}_\\varepsilon^2\\\\\\frac{Q_1}{t-1}&amp;=\\tilde{\\sigma}_\\varepsilon^2+\\frac{\\left(N-\\frac{\\sum_{i=1}^tn_i^2}N\\right)}{t-1}\\tilde{\\sigma}_1^2\\end{aligned}\\] 此方程组的解为 \\[\\begin{aligned}\\widetilde{\\sigma}_\\varepsilon^2&amp;=\\frac{Q_0}{N-t}\\\\\\tilde{\\sigma}_1^2&amp;=\\frac{Q_1-(t-1)\\tilde{\\sigma}_\\varepsilon^2}{N-\\frac{\\sum_{i=1}^tn_i^2}N}\\end{aligned}\\] 矩法估计为 \\[\\hat{\\sigma}_\\varepsilon^2=\\tilde{\\sigma}_\\varepsilon^2\\] 且 \\[\\hat{{\\sigma}}_1^2=\\begin{cases}\\tilde{{\\sigma}}_1^2&amp;\\mathrm{~if~}\\tilde{{\\sigma}}_1^2&gt;0\\\\0&amp;\\mathrm{~if~}\\tilde{{\\sigma}}_1^2\\leq0&amp;\\end{cases}\\] 19.1.2 示例 19.2：单向随机效应模型中的小麦品种 实验者从一批小麦品种中随机选取了四个品种，进行了一项实验，以评估小麦植株在抽穗前受到昆虫破坏的程度。实验设计结构为完全随机设计，每个品种有四个重复或区（区为实验单元）。由于环境条件的影响，一些区 (plots) 被毁坏（因雨水过多而淹没）。在小麦植株开始抽穗的前一天，实验者从每个区中随机选取了 20 株植物，并使用 0 到 10 的评分量表评估每株植物受到的昆虫破坏程度，其中 0 表示无破坏，10 表示严重破坏。因此，每个区上测得的响应是 20 株植物评分的平均值。数据如表 19.1 所示。计算平方和 \\(Q_0\\) 和 \\(Q_1\\) 所需的计算，以及由此产生的平方和、均方、期望均方、方程组、求解结果和方差分量估计均列在表 19.1 中。从方差分量的估计获得的信息是，一个品种内区之间的方差约为 0.056，而品种总体的方差约为 0.067. 将随机选择的品种种植到随机选择的区的方差是两个方差分量的总和，即 \\[\\hat{\\sigma}_{\\mathrm{Damage}}^2=\\hat{\\sigma}_{\\varepsilon}^2+\\hat{\\sigma}_{\\mathrm{Var}}^2=0.056+0.067=0.123\\] 表 19.1: 示例 19.2 小麦品种虫害的数据和计算 x 组内相关性 (intraclass correlation) 的估计为 \\[\\hat{\\rho}=\\frac{\\hat{\\sigma}_\\mathrm{Var}^2}{\\hat{\\sigma}_\\varepsilon^2+\\hat{\\sigma}_\\mathrm{Var}^2}=\\frac{0.067}{0.123}=0.545\\] 当用非单向或非完全随机设计结构的处理结构进行实验时，没有普遍接受的技术来获得平方和，从而得出方差分量的估计。第 18 章中提出的计算平方和的方法用于估计双向随机效应模型的方差分量。 19.1.3 示例 19.3：表 18.2 中的双向设计数据 表 19.2 中的数据是图 18.1 的观测，其中通过综合法评估了几种类型的平方和的期望值。值 \\(Q_0,Q_1,Q_2\\) 和 \\(Q_3\\) 对应于 Henderson’s method I 的平方和为 \\[\\begin{aligned} &amp;Q_0 =SSError=30.6666 \\\\ &amp;Q_1 =SSA=\\sum_{i=1}^2\\frac{y_{i\\cdot\\cdot}^2}{n_{i\\cdot}}-\\frac{y_{\\cdot\\cdot\\cdot}^2}{n_{\\cdot\\cdot}}=0.6428 \\\\ &amp;Q_2 =SSB=\\sum_{j=1}^3\\frac{y_{\\cdot j\\cdot}^2}{n_{\\cdot j}}-\\frac{y_{\\cdot\\cdot\\cdot}^2}{n_{\\cdot\\cdot}}=15.2143 \\\\ &amp;Q_3 =SSAB=\\sum_{i=1}^2\\sum_{j=1}^3\\frac{y_{ij\\cdot}^2}{n_{ij}}-\\sum_{i=1}^2\\frac{y_{i\\cdot\\cdot}^2}{n_{i\\cdot}}-\\sum_{j=1}^3\\frac{y_{\\cdot j\\cdot}^2}{n_{\\cdot j}}+\\frac{y_{\\cdot\\cdot\\cdot}^2}{n_{\\cdot\\cdot}}=108.6905 \\end{aligned}\\] 表 19.2: 示例 19.3 的双向随机效应处理结构数据 x 这些平方和的期望值是： \\[\\begin{aligned} &amp;E(Q_0)=8{\\sigma}_\\varepsilon^2 \\\\ &amp;E(Q_{1}) =\\sigma_\\varepsilon^2+0.1429\\sigma_b^2+2.4286\\sigma_c^2+7.0\\sigma_a^2 \\\\ &amp;E(Q_2) =2\\sigma_\\varepsilon^2+9.286\\sigma_b^2+4.77\\sigma_c^2+0.20\\sigma_a^2 \\\\ &amp;E(Q_3) =2\\sigma_\\varepsilon^2+6.37\\sigma_c^2 \\end{aligned}\\] 令平方和的值等于其各自的预期值，从而得到以下方程组 \\[\\begin{aligned} \\text{30.6666}&amp; =8\\tilde{\\sigma}_\\varepsilon^2 \\\\ \\text{0.6428}&amp; =\\tilde{{\\sigma}}_\\varepsilon^2+0.1429\\tilde{{\\sigma}}_b^2+2.4286\\tilde{{\\sigma}}_c^2+7.0\\tilde{{\\sigma}}_a^2 \\\\ \\text{15.2143}&amp; =2\\tilde{{\\sigma}}_\\varepsilon^2+9.286\\tilde{{\\sigma}}_b^2+4.77\\tilde{{\\sigma}}_c^2+0.20\\tilde{{\\sigma}}_a^2 \\\\ \\text{108.6905}&amp; =2\\tilde{{\\sigma}}_\\varepsilon^2+6.37\\tilde{{\\sigma}}_c^2 \\end{aligned}\\] 解为 \\[\\begin{aligned} &amp;\\tilde{{\\sigma}}_\\varepsilon^2 =3.83325 \\\\ &amp;\\tilde{{\\sigma}}_c^2 =15.8593 \\\\ &amp;\\tilde{{\\sigma}}_b^2 =-10.8817 \\\\ &amp;\\tilde{{\\sigma}}_a^2 =-8.2523 \\end{aligned}\\] 提供方差分量的无偏估计。因为上面的一些值是负值，所以方差分量最终的矩法估计为 \\[\\begin{aligned} &amp;\\hat{{\\sigma}}_\\varepsilon^2 =3.83325 \\\\ &amp;\\hat{{\\sigma}_c^2} \\text{=15.8593} \\\\ &amp;\\hat{{\\sigma}_b^2} =0.00 \\\\ &amp;\\hat{{\\sigma}_a^2} =0.00 \\end{aligned}\\] 示例 19.3 的结果指出了使用矩法技术时经常遇到的一个问题：它可以产生方差分量的负解，这对于方差分量是不可接受的。以下列出了通过拟合常数法或 Henderson’s method III 平方和（SAS® I 型）和SAS III 型平方和（这些平方和的期望值是通过综合法评估的，并在表 19.4 中给出）生成的方程组求解得出的示例 19.3 的矩法解和相应的估计值。 I 型解为 \\[\\begin{aligned} &amp;\\tilde{{\\sigma}}_\\varepsilon^2 =3.8333 \\\\ &amp;\\tilde{\\sigma}_c^2 =\\frac{109.1451-2(3.8333)}{4.5178}=22.4620 \\\\ &amp;\\tilde{{\\sigma}}_b^2 =\\frac{14.5797-2(3.8333)-4.6252(22.4620)}{9.1429}=-10.5877 \\\\ &amp;\\tilde{\\sigma}_{a}^{2} =\\frac{0.6429-3.833-0.1428(-10.71322)-2.4284(22.4620)}{7.00}=-8.0329 \\end{aligned}\\] 以及 I 型估计为 \\[\\begin{aligned} &amp;\\hat{{\\sigma}}_\\varepsilon^2 =3.8333 \\\\ &amp;\\hat{\\sigma}_c^2 =22.4620 \\\\ &amp;\\hat{{\\sigma}_b^2} =0 \\\\ &amp;\\hat{{\\sigma}_a^2} =0 \\end{aligned}\\] III 型解为 \\[\\begin{aligned} &amp;\\tilde{{\\sigma}}_\\varepsilon^2 =3.8333 \\\\ &amp;\\tilde{{\\sigma}}_c^2 =\\frac{109.1451-2(3.8333)}{4.5178}=22.4620 \\\\ &amp;\\tilde{{\\sigma}}_b^2 =\\frac{8.9098-2(3.8333)-4.5178(22.4620)}{9.0353}=-11.1080 \\\\ &amp;\\tilde{{\\sigma}}_a^2 =\\frac{0.677-3.833-2.2500(22.4620)}{6.75}=-8.0305 \\end{aligned}\\] III 型估计27为 \\[\\begin{aligned} &amp;\\hat{{\\sigma}}_\\varepsilon^2 =3.8333 \\\\ &amp;\\hat{{\\sigma}_c^2} =22.4620 \\\\ &amp;\\hat{{\\sigma}_b^2} =0 \\\\ &amp;\\hat{\\sigma}_a^2 =0 \\end{aligned}\\] 当方差分量的解为负时，标准过程是将相应的估计值设置为零。为了证明这一过程的结果，单向随机效应模型的组内均方 (mean square within) 和组间均方 (mean square between) 的期望均方可以表示为 \\[\\begin{aligned}E(MSWithin)&amp;=\\sigma_\\varepsilon^2\\\\E(MSBetween)&amp;=\\sigma_\\varepsilon^2+c\\sigma_u^2\\end{aligned}\\] \\(\\sigma^2_u\\) 的解为 \\[\\tilde{\\sigma}_u^2=\\frac{MSBetween-MSWithin}c\\] 在正态性假设下，MSWithin 和 MSBetween 是独立的随机变量。如果 \\(\\sigma^2_u=0\\)，那么两个期望均方都等于 \\(\\sigma^2_\\varepsilon=0\\)，因此，\\(\\sigma^2_u\\) 的解为负的概率约为 0.50，这取决于自由度。如果分子和分母的自由度相等，那么 \\[P(MSBetween&lt;MSWithin\\mid\\sigma_u^2=0)=0.50\\] 随着 \\(\\sigma^2_u\\) 变大，得到负解的概率降低。因此，当解为负时，将 \\(\\hat\\sigma^2_u\\) 设置为零是合理的（更详细的讨论请参见 Searle et al. 1992）。第 20 章讨论了由矩法估计构造的置信区间和假设检验。 19.2 最大似然 在统计学中，估计分布参数最常用的技术是最大似然法 (method of maximum likelihood). 该过程使用假设的观测分布，并构造似然函数，该函数是数据和未知模型参数的函数。最大似然估计是在参数空间中使似然函数值最大化的参数值。在实践中最大化似然函数的 loge. 等价地，可以确定参数空间中最小化 -2loge似然函数的参数值。一般随机效应模型 (19.1) 的参数空间为 \\[\\{-\\infty&lt;\\mu&lt;+\\infty,\\quad0&lt;\\sigma_i^2&lt;+\\infty,\\quad i=1,2,\\ldots,k;\\quad0&lt;\\sigma_\\varepsilon^2&lt;\\infty\\}\\] 对于一般随机效应模型 (19.1)，观测向量的分布为 \\[ \\boldsymbol y\\thicksim N(\\boldsymbol j_n\\mu,\\sigma_\\varepsilon^2\\boldsymbol I_n+\\sigma_1^2\\boldsymbol Z_1\\boldsymbol Z_1^{\\prime}+\\sigma_2^2\\boldsymbol Z_2\\boldsymbol Z_2^{\\prime}+\\cdots+\\sigma_k^2\\boldsymbol Z_k\\boldsymbol Z_k^{\\prime})\\quad\\mathrm{or}\\quad \\boldsymbol y\\thicksim N (\\boldsymbol j_n\\mu,\\boldsymbol \\Sigma) \\] 观测值的似然函数为 \\[L(\\boldsymbol\\mu,\\sigma_\\varepsilon^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2|\\boldsymbol y)=(2\\pi)^{-n/2}|\\boldsymbol{\\Sigma}|^{-1/2}\\exp[-\\frac12(\\boldsymbol{y}-\\boldsymbol{j}_n\\mu)^{\\prime}\\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{y}-\\boldsymbol{j}_n\\mu)]\\] -2loge似然函数为 \\[\\begin{aligned}\\ell(\\boldsymbol\\mu,\\sigma_e^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2|\\boldsymbol y)&amp;=-2\\log_e[L(\\mu,\\sigma_e^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2|\\boldsymbol y)]\\\\&amp;=n\\log_e(2\\pi)+\\log_e(|\\boldsymbol{\\Sigma}|)+(\\boldsymbol{y}-\\boldsymbol{j}_n{\\mu})^{\\prime}\\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{y}-\\boldsymbol{j}_n{\\mu})\\end{aligned}\\] 在参数空间上最小化 \\(\\ell(\\boldsymbol\\mu,\\sigma_e^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2|\\boldsymbol y)\\) 的过程通常需要利用似然方程的迭代过程，其中涉及到关于模型 \\(\\ell(\\boldsymbol\\mu,\\sigma_e^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2|\\boldsymbol y)\\) 每个参数的一阶导数或一阶和二阶导数。 当数据来自均衡设计时（相等的 \\(n\\) 以及无缺失单元格），通过将似然函数的一阶导数等于零而生成的似然方程组通常可以显式求解。由于方差分量解中的一些值可能为负值，因此所得到的解不受参数空间的限制。对于某些均衡模型，可以证明，当似然方程中 \\(\\sigma^2_i\\) 的解为负时，\\(\\sigma^2_i\\) 的最大似然估计为 \\(\\hat\\sigma^2_i=0\\) (Searle, 1971). 对于不均衡设计，需要迭代技术，其中估计过程应将方差分量的估计值限制在参数空间中。 19.2.1 示例 19.4：均衡单向模型的最大似然解 均衡单向随机效应模型可表示为 \\[y_{ij}=\\mu+u_i+\\varepsilon_{ij},\\quad i=1,2,\\ldots,t\\quad\\mathrm{and~}j=1,2,\\ldots,n\\] 其中 \\(\\mu_i\\sim i.i.d.\\,N(0,\\sigma^2_u),\\varepsilon_{ij}\\sim i.i.d.\\,N(0,\\sigma^2_\\varepsilon)\\)，且 \\(\\mu_i,\\varepsilon_{ij}\\) 独立，或 \\(\\boldsymbol y\\sim N[(\\boldsymbol j_n\\otimes \\boldsymbol j_t)\\mu,\\boldsymbol \\Sigma]\\) 其中 \\(\\boldsymbol \\Sigma=\\sigma^2_u \\boldsymbol j_n\\otimes \\boldsymbol j_t +\\sigma^2_\\varepsilon \\boldsymbol I_n\\otimes \\boldsymbol I_t\\). 符号 \\(A \\otimes B\\) 表示 \\(A,B\\) 两矩的 Kronecker 积28或直积 (direct product) (Graybill, 1976). 协方差阵 \\(\\boldsymbol \\Sigma\\) 可以表示为 \\[\\boldsymbol{\\Sigma}={\\sigma}_\\varepsilon^2\\left[\\left(\\boldsymbol{I}_n-\\frac1n\\boldsymbol{J}_n\\right)\\otimes\\boldsymbol{I}_t\\right]+({\\sigma}_\\varepsilon^2+n{\\sigma}_u^2)\\left[\\left(\\frac1n\\boldsymbol{J}_n\\right)\\otimes\\boldsymbol{I}_t\\right]\\] 其中 \\({\\sigma}_\\varepsilon^2\\) 和 \\({\\sigma}_\\varepsilon^2+n{\\sigma}_u^2\\) 分别为 \\(\\boldsymbol \\Sigma\\) 和 \\(\\left[\\left(\\boldsymbol{I}_n-\\frac1n\\boldsymbol{J}_n\\right)\\otimes\\boldsymbol{I}_t\\right]\\) 的特征根，以及 \\(\\left[\\left(\\frac1n\\boldsymbol{J}_n\\right)\\otimes\\boldsymbol{I}_t\\right]\\) 为正交幂等矩阵。 协方差阵的逆为 \\[\\boldsymbol{\\Sigma}^{-1}=\\frac1{{\\sigma}_\\varepsilon^2}{\\left[\\left(\\boldsymbol{I}_n-\\frac1n\\boldsymbol{J}_n\\right)\\otimes\\boldsymbol{I}_t\\right]}+\\frac1{{\\sigma}_\\varepsilon^2+n{\\sigma}_u^2}{\\left[\\left(\\frac1n\\boldsymbol{J}_n\\right)\\otimes\\boldsymbol{I}_t\\right]}\\] 使用协方差的逆矩阵这种表示，可以获得以下结果 \\[|\\boldsymbol{\\Sigma}|=(\\sigma_\\varepsilon^2)^{t(n-1)}(\\sigma_\\varepsilon^2+n\\sigma_u^2)^t\\] 或 \\[\\log_\\mathrm{e}|\\boldsymbol{\\Sigma}|=t(n-1)\\log_\\mathrm{e}(\\sigma_\\varepsilon^2)+t\\log_\\mathrm{e}(\\sigma_\\varepsilon^2+n\\sigma_u^2)\\] 以及 \\[(\\boldsymbol y-\\boldsymbol j_{nt}\\mu)^{\\prime}\\boldsymbol{\\Sigma}^{-1}(\\boldsymbol y-\\boldsymbol j_{nt}\\mu)=\\frac{nt(\\bar{y}_{\\cdot\\cdot}-\\mu)^2}{\\sigma_\\varepsilon^2+n\\sigma_u^2}+\\frac{SSE}{\\sigma_\\varepsilon^2}+\\frac{SSU}{\\sigma_\\varepsilon^2+n\\sigma_u^2}\\] 其中 \\[SSE=\\sum_{i=1}^t\\sum_{j=1}^n(y_{ij}-\\bar{y}_{i\\cdot})^2\\quad\\mathrm{~and~}\\quad SSU=n\\sum_{i=1}^t(\\bar{y}_{i\\cdot}-\\bar{y}_{\\cdot\\cdot})^2\\] 使用这些表达式，\\(-2\\log_{\\mathrm{e}}(L(\\mu,\\sigma_{u}^2,\\sigma_{\\varepsilon}^2|\\boldsymbol y)\\) 可以写为 \\[\\begin{aligned} \\ell(\\mu,{\\sigma}_u^2,{\\sigma}_\\varepsilon^2|\\boldsymbol{y}) =tn\\log_\\mathrm{e}(2\\pi)+t(n-1)\\log_\\mathrm{e}(\\sigma_\\varepsilon^2)+t\\log_\\mathrm{e}(\\sigma_\\varepsilon^2+n\\sigma_u^2) \\\\ +\\frac{nt(\\bar{y}_{\\cdot\\cdot}-\\mu)^2}{\\sigma_\\varepsilon^2+n\\sigma_u^2}+\\frac{SSE}{\\sigma_\\varepsilon^2}+\\frac{SSU}{\\sigma_\\varepsilon^2+n\\sigma_u^2} \\end{aligned}\\] 通过关于三个参数 \\(\\mu,\\sigma_u^2,\\sigma_\\varepsilon^2\\) 对 \\(\\ell(\\mu,\\sigma_u^2,\\sigma_\\varepsilon^2|\\boldsymbol y)\\) 求导，然后将导数设置为零来获得似然方程。将导数设置为零，在求解参数时评估的导数为 \\[\\begin{aligned} &amp;\\frac{\\partial\\ell(\\mu,\\sigma_u^2,\\sigma_\\varepsilon^2|\\boldsymbol y)}{\\partial\\mu} =\\frac{-2nt(\\bar{y}_{\\cdot\\cdot}-\\tilde{\\mu})}{\\sigma_\\varepsilon^2+n\\sigma_u^2}=0 \\\\ &amp;\\frac{\\partial\\ell(\\mu,\\sigma_u^2,\\sigma_\\varepsilon^2|\\boldsymbol y)}{\\partial\\sigma_\\varepsilon^2} =\\frac{t(n-1)}{\\tilde{\\sigma}_\\varepsilon^2}+\\frac t{\\tilde{\\sigma}_\\varepsilon^2+n\\tilde{\\sigma}_u^2}-\\frac{nt(\\bar{y}_{\\cdot\\cdot}-\\tilde{\\mu})^2}{(\\tilde{\\sigma}_\\varepsilon^2+n\\tilde{\\sigma}_u^2)^2}-\\frac{SSE}{(\\tilde{\\sigma}_\\varepsilon^2)^2}-\\frac{SSU}{(\\tilde{\\sigma}_\\varepsilon^2+n\\tilde{\\sigma}_u^2)^2}=0 \\\\ &amp;\\frac{\\partial\\ell(\\mu,\\sigma_u^2,\\sigma_\\varepsilon^2|\\boldsymbol y)}{\\partial\\sigma_u^2} =\\frac{nt}{\\tilde{\\sigma}_\\varepsilon^2+n\\tilde{\\sigma}_u^2}-\\frac{n^2t(\\bar{y}_{\\cdot\\cdot}-\\tilde{\\mu})^2}{(\\tilde{\\sigma}_\\varepsilon^2+n\\tilde{\\sigma}_u^2)^2}-\\frac{nSSU}{(\\tilde{\\sigma}_\\varepsilon^2+n\\tilde{\\sigma}_u^2)^2}=0 \\end{aligned}\\] 最大似然方程的解为 \\[\\tilde{\\mu}=\\bar{y}_{\\cdot\\cdot },\\quad\\tilde{\\sigma}_\\varepsilon^2=\\frac{SSE}{t(n-1)}=MSError,\\quad\\mathrm{and}\\quad\\tilde{\\sigma}_u^2=\\frac1n{\\left[\\frac{SSU}t-MSError\\right]}\\] 因此，最大似然估计为 \\[\\hat{\\mu}=\\tilde{\\mu}=\\bar{y}_{\\cdot\\cdot },\\quad\\hat{\\sigma}_\\varepsilon^2=\\tilde{\\sigma}_\\varepsilon^2=\\frac{SSE}{t(n-1)}=MSError\\] 以及 \\[\\hat{\\sigma}_u^2=\\begin{cases}\\tilde{\\sigma}_u^2&amp;\\mathrm{~if~}&amp;\\tilde{\\sigma}_u^2\\geq0\\\\0&amp;\\mathrm{~if~}&amp;\\tilde{\\sigma}_u^2&lt;0&amp;\\end{cases}\\] 当 \\({\\sigma}_u^2\\) 的估计为零时，则通过合并 SSE 和 SSU 及其自由度来重新计算 \\({\\sigma}_\\varepsilon^2\\) 的估计，从而获得 \\[\\hat{\\sigma}_\\varepsilon^2=\\frac{SSE+SSU}{tn-1}\\] 如果恰好存在负的组内相关性，那么通过合并获得的 \\({\\sigma}_\\varepsilon^2\\) 的估计将低估方差。必须对假设及其适当性进行仔细研究，因为如果 \\(u_i\\) 水平内的实验单元之间存在一定程度的竞争，则负相关将是合适的。在这种情况下，协方差阵可以表示为 \\[\\boldsymbol{\\Sigma}={\\sigma}_A^2{\\rho}[c{J}_n\\otimes\\boldsymbol{I}_t]+{\\sigma}_A^2(1-{\\rho})[\\boldsymbol{I}_n\\otimes\\boldsymbol{I}_t]\\] 其中 \\(\\sigma_{\\varepsilon}^{2}=\\sigma_{A}^{2}\\left(1-\\rho\\right)\\) 以及 \\(\\sigma_{u}^{2}=\\sigma_{A}^{2}\\rho\\). 已经开发了几种计算算法来最大化似然函数，从而提供模型参数的最大似然估计（参数空间中的值）(Hemmerle and Hartley, 1973; Corbeil and Searle, 1976). 最大似然估计的大样本量方差可以通过求二阶导数矩阵的逆来获得，其中二阶导数在最大似然估计处。Searle (1971) 以及 Searle et al. (1992) 报道了几个设计的实验的最大似然估计及其方差。 当使用计算机软件来构造这些模型时，实验者应彻底研究所使用的算法，并确定其性质，即它是否总是产生有意义的估计，以及它是否在参数空间上使似然函数最大化。 通过使用 SAS-Mixed，我们获得了示例 19.2 和示例 19.3 中方差分量的最大似然估计。示例 19.2 中 \\(\\sigma^2_\\varepsilon\\) 和 \\(\\sigma^2_u\\) 的最大似然估计值分别为 \\(\\hat\\sigma^2_\\varepsilon= 0.05749\\) 和 \\(\\sigma^2_u = 0.04855\\)，如表 19.3 所示。示例 19.3 中模型参数的最大似然估计为 \\(\\hat\\sigma^2_\\varepsilon= 3.5989,\\hat\\sigma^2_c= 8.5604,\\hat\\sigma^2_a = 0\\) 以及 \\(\\hat\\sigma^2_b = 0\\)，如表 19.4 所示。SAS-Mixed 中的 ML 算法在参数空间上进行最大化，如表 19.4 中 \\(\\hat\\sigma^2_a,\\hat\\sigma^2_b\\) 设置为零。 表 19.3: Proc Mixed 代码来计算示例 19.2 中数据的方差分量和均值的最大似然估计 x 表 19.4: Proc Mixed 代码来获得示例 19.3 中双向随机效应模型方差分量的最大似然估计 x 19.3 受限或残差最大似然估计 通过最大化似然函数中不包括任何混合效应的部分，或者通过在从模型中去除固定效应之后最大化残差的似然函数，来获得受限或残差最大似然估计 (Restricted or residual maximum likelihood estimates, REML). 对于本章中的模型，只有一个固定效应参数 \\(\\mu\\). 这也相当于在给定的总体样本均值下查看一组平方和的条件分布。该过程通过将似然函数分解为两部分来完成，其中一部分涉及固定效应参数，另一部分仅涉及方差分量。通过关于方差分量对 -2loge残差似然函数进行求导，并将其设置为零，从而得到 REML 方程。 对于一般随机效应模型 (19.1)，观测值的似然函数为 \\[L(\\mu,\\sigma_\\varepsilon^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2|\\boldsymbol y)=(2\\pi)^{-n/2}\\left|\\boldsymbol{\\Sigma}\\right|^{-1/2}e^{\\left[-(1/2)(\\boldsymbol{y}-\\boldsymbol{j}_n{\\mu})^{\\prime}\\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{y}-\\boldsymbol{j}_n{\\mu})\\right]}\\] 并且 -2loge似然函数为 \\[\\begin{aligned} \\ell(\\mu,\\sigma_\\varepsilon^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2|\\boldsymbol y) =&amp;-2\\log_e[L(\\mu,\\sigma_\\varepsilon^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2|\\boldsymbol y)] \\\\ =&amp;\\,n\\log_\\mathrm{e}(2\\pi)+\\log_\\mathrm{e}(|\\boldsymbol{\\Sigma}|)+(\\boldsymbol{y}-\\boldsymbol{j}_n{\\mu})^{\\prime}\\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{y}-\\boldsymbol{j}_n{\\mu}) \\\\ =&amp;\\,\\ell(\\mu,\\sigma_\\varepsilon^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2|\\bar{y}) \\\\ &amp;+\\ell(\\sigma_\\varepsilon^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2| SSE,SSU_1,SSU_2,\\ldots,SSU_k) \\end{aligned}\\] 其中 \\(SSE,SSU_1,SSU_2,\\ldots,SSU_k\\) 表示不依赖于 \\(\\mu\\) 的独立平方和的集合，\\(\\ell(\\sigma_\\varepsilon^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2| SSE,SSU_1,SSU_2,\\ldots,SSU_k)\\) 是残差似然函数。残差似然方程的解提供了方差分量的 REML 估计。 19.3.1 示例 19.5：均衡单向模型的 REML 解 使用示例 19.4 中描述的均衡单向随机效应模型，-2loge似然函数可以表示为充分统计量 \\(\\bar y_{\\cdot\\cdot},SSE,SSU\\) 的函数 \\[\\begin{aligned} \\ell(\\mu,\\sigma_u^2,\\sigma_\\varepsilon^2|\\boldsymbol y) =&amp;\\,tn\\log_{\\mathrm{e}}(2\\pi)+t(n-1)\\log_{\\mathrm{e}}(\\sigma_{\\varepsilon}^2)+t\\log_{\\mathrm{e}}(\\sigma_{\\varepsilon}^2+n\\sigma_{u}^2) \\\\ &amp;+\\frac{nt(\\bar{y}_{\\cdot\\cdot}-\\mu)^2}{\\sigma_\\varepsilon^2+n\\sigma_u^2}+\\frac{SSE}{\\sigma_\\varepsilon^2}+\\frac{SSU}{\\sigma_\\varepsilon^2+n\\sigma_u^2} \\\\ =&amp;\\left[\\frac{nt(\\bar{y}_{\\cdot\\cdot}-\\mu)^2}{\\sigma_\\varepsilon^2+n\\sigma_u^2}+\\log_{\\mathrm{e}}(2\\pi)+\\log_{\\mathrm{e}}(\\sigma_\\varepsilon^2+n\\sigma_u^2)\\right] \\\\ &amp;+\\left[(tn-1)\\log_{\\mathrm{e}}(2\\pi)+t(n-1)\\log_e(\\sigma_e^2)+(t-1)\\log_{\\mathrm{e}}(\\sigma_\\varepsilon^2+n\\sigma_u^2)+\\frac{SSE}{\\sigma_\\varepsilon^2}+\\frac{SSU}{\\sigma_\\varepsilon^2+n\\sigma_u^2}\\right] \\\\ =&amp;\\,\\ell(\\mu,\\sigma_u^2,\\sigma_\\varepsilon^2\\mid\\bar{y}_{\\cdot\\cdot})+\\ell(\\sigma_u^2,\\sigma_\\varepsilon^2\\mid SSE,SSU) \\end{aligned}\\] 残差似然函数为 \\(\\ell(\\sigma_u^2,\\sigma_\\varepsilon^2|SSE,SSU)\\)，其中 \\[\\begin{aligned} \\ell(\\sigma_u^2,\\sigma_\\varepsilon^2|SSE,SSU) =&amp;\\left[(tn-1)\\log_{\\mathrm{e}}(2\\pi)+t(n-1)\\log_{\\mathrm{e}}(\\sigma_{\\varepsilon}^2)\\right. \\\\ &amp;\\left.+(t-1)\\log_{\\mathrm{e}}(\\sigma_\\varepsilon^2+n\\sigma_u^2)+\\frac{SSE}{\\sigma_\\varepsilon^2}+\\frac{SSU}{\\sigma_\\varepsilon^2+n\\sigma_u^2}\\right] \\end{aligned}\\] 通过关于两个参数 \\(\\sigma^2_u,\\sigma^2_\\varepsilon\\) 对 \\(\\ell(\\sigma_u^2,\\sigma_\\varepsilon^2|SSE,SSU)\\) 进行求导，然后将导数设置为零，可以获得受限最大似然方程。将导数设置为零，在求解参数时评估的导数为 \\[\\begin{aligned}\\frac{\\partial\\ell({\\sigma}_u^2,{\\sigma}_\\varepsilon^2|SSE,SS{U})}{\\partial{\\sigma}_\\varepsilon^2}&amp;=\\frac{t(n-1)}{{\\tilde{\\sigma}}_\\varepsilon^2}+\\frac{t-1}{{\\tilde{\\sigma}}_\\varepsilon^2+n{\\tilde{\\sigma}}_u^2}-\\frac{SS{E}}{({\\tilde{\\sigma}}_\\varepsilon^2)^2}-\\frac{SS{U}}{({\\tilde{\\sigma}}_\\varepsilon^2+n{\\tilde{\\sigma}}_u^2)^2}=0\\\\\\frac{\\partial\\ell({\\sigma}_u^2,{\\sigma}_\\varepsilon^2|{SSE},{SSU})}{\\partial{\\sigma}_u^2}&amp;=\\frac{n(t-1)}{{\\tilde{\\sigma}}_\\varepsilon^2+n{\\tilde{\\sigma}}_u^2}-\\frac{nSS{U}}{\\left({\\tilde{\\sigma}}_\\varepsilon^2+n{\\tilde{\\sigma}}_u^2\\right)^2}=0\\end{aligned}\\] 残差最大似然方程的解是 \\[\\tilde{\\sigma}_\\varepsilon^2=\\frac{SSE}{t(n-1)}=MSError,\\quad\\mathrm{and}\\quad\\tilde{\\sigma}_u^2=\\frac1n{\\left[\\frac{SSU}{t-1}-MSError\\right]}=\\frac1n[MSU-MSError]\\] 残差最大似然估计为 \\[\\hat{\\sigma}_\\varepsilon^2=\\tilde{\\sigma}_\\varepsilon^2=\\frac{SSE}{t(n-1)}=MSError\\] 以及 \\[\\hat{\\sigma}_u^2=\\begin{cases}\\tilde{\\sigma}_u^2&amp;\\mathrm{~if~}\\tilde{\\sigma}_u^2\\geq0\\\\0&amp;\\mathrm{~if~}\\tilde{\\sigma}_u^2&lt;0&amp;\\end{cases}\\] 当 \\({\\sigma}_u^2\\) 的估计为零时，则通过合并 SSE 和 SSU 及其自由度来重新计算 \\({\\sigma}_\\varepsilon^2\\) 的估计，从而获得 \\[\\hat{\\sigma}_\\varepsilon^2=\\frac{SSE+SSU}{tn-1}\\] 表 19.5 和 19.6 分别包含用于提取示例 19.2 和示例 19.3 中数据集方差分量的 REML 估计的 SAS-Mixed 代码和结果。 表 19.5: Proc Mixed 代码来计算示例 19.2 中数据的方差分量和均值的受限最大似然估计 x 表 19.6: Proc Mixed 代码来获得示例 19.3 中双向随机效应模型方差分量的受限最大似然估计 x 19.4 MIVQUE 法 Rao (1971) 描述了获得方差分量的最小方差二次无偏估计 (minimum variance quadratic unbiased estimators, MIVQUE) 的一般过程。对于第 18.2 节的一般随机效应模型，方差的线性组合 \\[\\theta=C_0\\sigma_\\varepsilon^2+C_1\\sigma_1^2+C_2\\sigma_2^2+\\cdots+C_k\\sigma_k^2\\] 的 MIVQUE 是观测值的二次函数，其关于 \\(\\theta\\) 是无偏的，并且在 \\(\\theta\\) 的二次无偏估计类中具有最小方差。因此，方差分量的 MIVQUE 估计具有最小方差性质，而矩法估计通常不具有。每个单独的方差分量都可以被选作可能要估计的参数。选择 \\(C_0=1,C_1=C_2=\\cdots=C_k=0\\) 提供 \\(\\theta=\\sigma^2_\\varepsilon\\). \\(C_i\\) 值的其它选择将提供 \\(\\theta=\\sigma^2_i\\) 以及方差分量的其它线性组合。 19.4.1 方法说明 \\(\\theta\\) 的估计必须是 \\(\\boldsymbol y\\) 的二次函数，因此，对于某个矩阵 \\(\\boldsymbol A\\)，\\(\\theta\\) 的估计的形式为 \\(\\boldsymbol y^\\prime\\boldsymbol A\\boldsymbol y\\). \\(\\boldsymbol y^\\prime\\boldsymbol A\\boldsymbol y\\) 的期望是 \\[E(\\boldsymbol y^{\\prime}\\boldsymbol A\\boldsymbol y)=\\mathrm{tr}(\\boldsymbol{\\Sigma}\\boldsymbol A)+\\mu^2\\boldsymbol{j}_n^{\\prime}\\boldsymbol A\\boldsymbol{j}_n\\] 根据假设，\\(E(\\boldsymbol y^{\\prime}\\boldsymbol A\\boldsymbol y)=\\theta\\)。由于期望不取决于 \\(\\mu\\)，因此必须选择 \\(\\boldsymbol A\\) 以满足 \\(\\mu^2\\boldsymbol{j}_n^{\\prime}\\boldsymbol A\\boldsymbol{j}_n=0\\). 在正态性条件下，当 \\(\\mu^2\\boldsymbol{j}_n^{\\prime}\\boldsymbol A\\boldsymbol{j}_n=0\\) 时，\\(\\boldsymbol y^{\\prime}\\boldsymbol A\\boldsymbol y\\) 的方差为 \\[\\mathrm{Var}(\\boldsymbol{y}^{\\prime}A\\boldsymbol{y})=2\\mathrm{~tr}[\\boldsymbol{\\Sigma}A]^2\\] 因此，\\(\\theta\\) 的 MIVQUE 是 \\(\\boldsymbol y^{\\prime}\\boldsymbol A\\boldsymbol y\\)，其中 $ A$ 被选择为使得 $[A]=$ 并且 \\(\\operatorname{tr}[\\boldsymbol{\\Sigma}\\boldsymbol A]^2\\) 在如下参数空间中达到最小化 \\[\\{0&lt;\\sigma_\\varepsilon^2&lt;\\infty,\\quad0&lt;\\sigma_1^2&lt;\\infty,\\quad0&lt;\\sigma_2^2&lt;\\infty,\\ldots,0&lt;\\sigma_k^2&lt;\\infty\\}\\] Rao (1971) 证明了\\(\\boldsymbol \\sigma^2=[\\sigma_\\varepsilon^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2]&#39;\\) 的 MIVQUE 是 \\(\\hat{\\boldsymbol \\sigma}^2=\\boldsymbol S^{-1}\\boldsymbol f\\)，其中 \\(\\boldsymbol S\\) 是具有如下元素的 (k+1) × (k+1) 的矩阵 \\[s_{ii^{\\prime}}=\\mathrm{tr}[\\boldsymbol X_i\\boldsymbol X_i^{\\prime}\\boldsymbol R\\boldsymbol X_{i^{\\prime}}\\boldsymbol X_{i^{\\prime}}]\\quad i,i^{\\prime}=0,1,2,\\ldots,k\\] \\(\\boldsymbol f\\) 是具有如下元素的 (k+1) × 1 的向量 \\[\\boldsymbol f_i=\\boldsymbol y^{\\prime}\\boldsymbol R\\boldsymbol X_i\\boldsymbol X_i^{\\prime}\\boldsymbol R\\boldsymbol y,\\quad i=0,1,2,\\ldots,k\\] 其中 \\[\\boldsymbol R=\\boldsymbol\\Sigma^{-1}[\\boldsymbol I_n-\\boldsymbol j_n(\\boldsymbol j_n^{\\prime}\\boldsymbol\\Sigma^{-1}\\boldsymbol j_n)^{-1}\\boldsymbol j_n^{\\prime}]\\boldsymbol \\Sigma^{-1}\\] \\(\\hat\\sigma^2\\) 的解取决于 \\(\\boldsymbol \\Sigma\\) 的元素，这些元素是未知方差分量的函数。为了计算 \\(\\sigma^2\\) 的 MIVQUE，必须将一些常数代入 \\(\\boldsymbol \\Sigma\\) 中的 \\(\\sigma_\\varepsilon^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2\\) 。对于这组常数，\\(\\sigma^2\\) 的估计是 MIVQUE（并且是 \\(\\boldsymbol y\\) 的二次函数）。为了使 \\(\\hat\\sigma^2\\) 是 \\(\\sigma^2\\) 的 MIVQUE，\\(\\boldsymbol R\\) 的元素必须不依赖于数据向量。一些软件使用 1 作为残差方差的值，使用 0 作为其他方差和协方差的值。 通常，最好将接近真实值的 \\(\\sigma_\\varepsilon^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2\\) 的值代入 \\(\\boldsymbol \\Sigma\\). 一种可能的程序是从其他实验中获得值。使用固定值（不依赖于当前数据）作为非迭代过程中 \\(\\sigma^2\\) 的起始值，或使用零迭代 (zero iterations) 的过程，提供了一个称为 MIVQUE0 的解，其中 0 表示未执行任何迭代。Swallow and Monahan (1984) 使用矩法估计作为方差的初始值，并使用 MIVQUE-A 来描述方差分量的最终估计。另一种方法是使用迭代程序 (Brown, 1976)，通过使用方差分量的一些初始值，例如 \\(\\sigma_{\\varepsilon0}^2,\\sigma_{10}^2,\\sigma_{20}^2,\\ldots,\\sigma_{k0})^2\\) 来开始该过程。使用这些初始值来评估 \\(\\boldsymbol \\Sigma\\)，并获得 \\(\\hat\\sigma^2_{(0)}\\)。这里，\\(\\hat\\sigma^2_{(0)}\\) 取决于为 \\(\\sigma^2_{(0)}\\) 选择的值。然后使用 \\(\\hat\\sigma^2_{(0)}\\) 来评估 \\(\\boldsymbol \\Sigma\\)，以获得第二次迭代估计 \\(\\hat\\sigma^2_{(1)}\\). 继续迭代过程，直到一次迭代与下一次迭代之间几乎没有变化。因为 \\(\\boldsymbol \\Sigma\\) 的元素是 \\(\\boldsymbol y\\) 的函数，所得到的迭代 MIVQUE 值不再是 \\(\\boldsymbol y\\) 的二次函数。可以将 \\(\\hat\\sigma^2_{i}\\) 的最终估计，例如在在第 m+1 步时，称为给定先前值 \\(\\hat\\sigma^2_{(m)}\\) 的 MIVQUE. 对于均衡模型，Swallow and Searle (1978) 已经表明方程可以简化从而可以获得显式解。此解与矩法提供的解相同。当存在不等样本量和/或空单元格时，迭代过程可能是合适的方法。Swallow and Searle (1978) 的一项模拟研究表明，REML, ML 和矩法比 MIVQUE0 提供更好的方差分量估计。 MIVQUE 的值（无论是以 \\(\\sigma_i^2\\) 的常数值评估还是在给定的前一步中评估）都是 \\(\\boldsymbol y\\) 的二次型的线性组合。因此，可以评估方差，因为二次型 \\(\\boldsymbol y^{\\prime}\\boldsymbol A\\boldsymbol y\\) 的方差为 \\(2\\, \\text{tr}(\\boldsymbol B\\boldsymbol \\Sigma)^2\\). Swallow and Searle (1978) 展示了如何使用这些表达式来获得不均衡单向模型的估计的方差。他们计算并比较了具有不同总体数量、样本量和方差的非均衡单向模型的 MIVQUE 和矩法估计的方差。MIVQUE 估计的方差是根据 \\(\\sigma_u^2\\) 和 \\(\\sigma^2_\\varepsilon\\) 的真实值在估计过程中进行评估的。从矩法获得的 \\(\\sigma^2_\\varepsilon\\) 的估计与从 MIVQUE 法获得的估计非常相似，其中 MIVQUE 的方差不大于矩法估计的方差的 4％. 对于相当均衡的模型（\\(n_i\\) 差异不大），\\(\\sigma^2_u\\) 的 MIVQUE 的方差不大于矩法估计的方差的 10%. 对于许多不均衡样本量，\\(\\sigma^2_u\\) 的 MIVQUE 方差比相应的矩法估计小 60%. 如果在估计过程中使用除 \\(\\sigma^2_u\\) 和 \\(\\sigma^2_\\varepsilon\\) 真实值之外的值，则两种方法的估计的方差将更为相似。SAS-Mixed 具有一个 MIVQUE0 选项用于 MIVQUE 法，是一种非迭代方法。 本节最后以一个使用 MIVQUE 估计的不均衡单向设计的例子结束。 19.4.2 应用。示例 19.6：MIVQUE 用于不均衡单向设计 Swallow and Searle (1978) 提出的方程用于一般单向模型，然后将其应用于示例 19.2 中的数据。模型为 \\[y_{ij}=\\mu+u_i+\\varepsilon_{ij}\\quad i=1,2,\\ldots,t\\mathrm{~and~}j=1,2,\\ldots,n_i\\] 其中 \\(\\boldsymbol{u}\\thicksim{N}(0,\\sigma_u^2\\boldsymbol{I}_t),\\boldsymbol{\\varepsilon}\\thicksim{N}(0,\\sigma_\\varepsilon^2\\boldsymbol{I}_N)\\) 且 \\(\\boldsymbol{u},\\boldsymbol{\\varepsilon}\\) 是独立随机变量。\\(N=\\sum_{i=1}^tn_i\\). 定义 \\[k_i=\\frac{n_i}{\\sigma_{\\varepsilon0}^2+n_i\\sigma_{u0}^2}\\quad\\mathrm{and}\\quad K=\\frac1{\\sum_{i=1}^tk_i}\\] 矩阵 \\(\\boldsymbol \\Sigma\\) 的元素是 \\[\\begin{aligned} S_{11}&amp; =\\sum_{i=1}^tk_i^2-2K\\sum_{i=1}^tk_i^3+K^2\\left(\\sum_{i=1}^tk_i^2\\right)^2 \\\\ S_{12}&amp; =\\sum_{i=1}^t\\frac{k_i^2}{n_i}-2K\\sum_{i=1}^t\\frac{k_i^3}{n_i}+K^2\\biggl(\\sum_{i=1}^tk_i^2\\biggr)\\biggl(\\sum_{i=1}^t\\frac{k_i^2}{n_i}\\biggr) \\\\ S_{22}&amp; =\\frac{N-t}{\\sigma_{\\varepsilon0}^4}+\\sum_{i=1}^t\\frac{k_i^2}{n_i^2}-2K\\sum_{i=1}^t\\frac{k_i^3}{n_i^2}+K^2\\left(\\sum_{i=1}^t\\frac{k_i^2}{n_i}\\right)^2 \\end{aligned}\\] 向量 \\(\\boldsymbol f\\) 的元素是 \\[\\begin{aligned}f_1&amp;=\\sum_{i=1}^tk_i^2\\bigg(\\bar{y}_i-K\\sum_{i=1}^tk_i\\bar{y}_{i\\cdot}\\bigg)^2\\\\f_2&amp;=\\frac{\\sum_{i=1}^t\\sum_{j=1}^{n_i}y_{ij}^2-\\sum_{i=1}^tn_i\\bar{y}_{i\\cdot}^2}{\\sigma_{\\epsilon0}^4}+\\sum_{i=1}^t\\frac{k_i^2\\left(\\bar{y}_{i\\cdot}-K\\sum_{i=1}^tk_i\\bar{y}_{i\\cdot}\\right)^2}{n_i}\\end{aligned}\\] 对于给定的 \\(\\sigma^2_{u0}\\) 和 \\(\\sigma^2_{\\varepsilon0}\\) 的值，\\(\\sigma^2_{u}\\) 和 \\(\\sigma^2_{\\varepsilon}\\) 的 MIVQUE 估计为 \\(\\hat{\\sigma}^2=\\boldsymbol S^{-1}\\boldsymbol f\\)，或 \\[\\begin{aligned}\\hat{\\sigma}_\\varepsilon^2&amp;=\\frac{s_{11}f_2-s_{12}f_1}c\\\\\\hat{\\sigma}_u^2&amp;=\\frac{s_{22}f_1-s_{12}f_2}c\\end{aligned}\\] 其中 \\(c=s_{11}s_{22}-s_{12}^2\\). 表 19.1 中数据的两个方差分量的 MIVQUE 估计在表 19.7 中，表 19.2 中数据的四个方差分量的 MIVQUE 估计在表 19.8 中。这些估计是使用 SAS Mixed 的非迭代解获得的。估计的方差为 \\[\\mathrm{Var}(\\hat{\\sigma}_\\varepsilon^2)=\\frac{2s_{11}}c,\\quad\\mathrm{Var}(\\hat{\\sigma}_u^2)=\\frac{2s_{2}}c,\\quad\\mathrm{and}\\quad\\mathrm{Cov}(\\hat{\\sigma}_\\varepsilon^2,\\hat{\\sigma}_u^2)=\\frac{-2s_{12}}c\\] 表 19.7: Proc Mixed 代码来计算示例 19.2 中数据的方差分量和均值的 MIVQUE0 估计 x 表 19.8: Proc Mixed 代码来获得示例 19.3 中双向随机效应模型的方差分量的 MIVQUE0 估计 x 估计对 \\(\\sigma^2_{u0}\\) 和 \\(\\sigma^2_{\\varepsilon0}\\) 的选择不是很敏感，但方差确实取决于 \\(\\sigma^2_{u0}\\) 和 \\(\\sigma^2_{\\varepsilon0}\\) 初始值的选择。表 19.9 包含表 19.1 中数据的 MIVQUE0 估计及其方差，其中使用了所列起始值。当 \\(\\sigma^2_{u0}\\) 和 \\(\\sigma^2_{\\varepsilon0}\\) 的起始值与 \\(\\hat\\sigma^2_{u}\\) 和 \\(\\hat\\sigma^2_{\\varepsilon}\\) 的估计相距甚远时，估计的方差变化非常大。如果使用迭代程序，则解收敛于 \\(\\hat{\\sigma}_\\varepsilon^2=0.057003\\) 和 \\(\\hat{\\sigma}_u^2=0.073155\\)，其中 \\(\\mathrm{Var}(\\hat{\\sigma}_\\varepsilon^2)=0.000721,\\mathrm{Var}(\\hat{\\sigma}_u^2)=0.005694\\) 以及 \\(\\mathrm{cov}(\\hat{\\sigma}_\\varepsilon^2,\\hat{\\sigma}_u^2)=-0.000235\\). 迭代过程从几个值开始（\\(\\sigma^2_{u0}=2,\\sigma^2_{\\varepsilon0}=1\\) 以及 \\(\\sigma^2_{u0}=50,\\sigma^2_{\\varepsilon0}=1000\\) 等）。所有起始值的选择在四次迭代中收敛到上述值。经过两次迭代，估计相当稳定，但方差仍在变化。 表 19.9: 示例 19.2 所选起始值的 MIVQUE0 方差分量估计 x 19.5 使用 JMP 估计方差分量 方差分量的估计可以使用 JMP 软件 (SAS Institute, Inc., 2005) 的 fit model 选项获得。图 19.1 给出了示例 19.2 的数据集，显示在 JMP 数据表中（从 SAS 数据集导入）。在 Analyze 菜单上，选择 fit model，如图 19.2 所示。在 fit model 界面上，选择 Damage 作为 Y 变量，选择 variety 作为模型效应。使用 attributes 菜单来指定 variety 是一个随机效应。默认的估计方法是 REML，但可以选择 EMS 来提供使用 III 型平方和的矩法估计。单击 run model 按钮以获取图 19.3 中的结果。方差分量的估计及其标准误估计与表 19.5 中 SAS 的结果相似。主要区别是使用了 Wald 法而不是 Satterthwaite 近似来计算 variety 方差分量的置信区间（详见第 20 章）。 图 19.1: 示例 19.2 数据集的 JMP 表 图 19.2: 示例 19.2 的 JMP fit model 表 图 19.3: 示例 19.2 的 JMP REML 结果 图 19.4 是示例 19.3 数据的 JMP 数据表。fit model 界面如图 19.5 所示，其中 row, col 和 row × col 被选择为随机效应，并选择 REML 方法进行估计。方差分量的 REML 估计如图 19.6 所示，其中的结果与表 19.6 中 SAS 的结果相似。fit model 界面有另一个选项，可以在其中选中 “unbounded variance components” 框。此选项不会将解限制在参数空间中（类似于在 SAS Mixed 中使用 unbounded 选项）。图 19.7 选中了 “unbounded variance components” 框，解如图 19.8 所示。row 和 col 方差分量的解是负的，Wald 法用于计算置信区间（残差除外）。JMP fit model 过程为具有随机效应的模型提供了适当的分析，SAS Mixed也是如此。 图 19.4: 示例 19.3 数据集的 JMP 表 图 19.5: 用于示例 19.3 REML 估计的 JMP fit model 界面 图 19.6: 示例 19.3 的 JMP REML 结果 图 19.7: 示例 19.3 框选 “unbounded variance components” 的JMP fit model 界面 图 19.8: 示例 19.3 的 JMP REML 的无界结果 19.6 结束语 本章介绍了四种方法，矩法、最大似然法、残差最大似然法和 MIVQUE 法，用于获得随机效应模型方差分量的估计。使用两个示例，一个单向随机效应模型和一个双向随机效应模型来演示每种估计方法。当数据均衡且提供正解时，REML, MIVQUE0 和 矩法的估计是相同的。当数据集不均衡时，每种方法都会产生不同的估计。使用 SAS-MIXED 和 JMP 进行了计算。 19.7 练习 原文为 “the type III solutions are”，应为笔误。↩︎ 设 \\(\\boldsymbol A, \\boldsymbol B\\) 分别为 m × n 和 p × q 阶矩阵，则 \\(\\boldsymbol A \\otimes \\boldsymbol B=\\begin{bmatrix}a_{11}\\boldsymbol B&amp;\\cdots&amp;a_{1n}\\boldsymbol B\\\\\\vdots&amp;\\ddots&amp;\\vdots\\\\a_{m1}\\boldsymbol B&amp;\\cdots&amp;a_{mn}\\boldsymbol B\\end{bmatrix}\\). Knronecker 积 “\\(\\otimes\\)” 可作用于两任意大小的矩阵，那么也包括向量。↩︎ "],["chap20.html", "第 20 章 方差分量的推断方法 20.1 假设检验 20.2 构造置信区间 20.3 模拟研究 20.4 结束语 20.5 练习", " 第 20 章 方差分量的推断方法 “God not only plays dice. He also sometimes throws the dice where they cannot be seen.” - Stephen William Hawking 当研究者设计一个涉及随机效应因素的实验时，她通常希望根据模型中指定的特定方差分量做出推断。特别是，如果 \\(\\sigma_u^2\\) 是对应于因素 A 水平分布的方差分量，实验者可能希望确定是否有足够的证据得出 \\(\\sigma_u^2&gt;0\\) 的结论。可以通过以下方式做出适当的决定：1）检验假设 \\(H_0{:}\\sigma_u^2=0\\mathrm{~vs~}{H_a}{:}\\sigma_u^2&gt;0\\)；2）构造关于 \\(\\sigma_u^2\\) 的置信区间；或 3）为 \\(\\sigma_u^2\\) 构造置信下限。本章讨论了随机效应模型的这些推断程序，其中假设检验方法在第 20.1 节中描述，置信区间（下界）的构造在第 20.2 节中描述。方差分量的置信区间构造一直是研究的一个活跃领域，许多作者已经为方差分量参数的特定函数开发了专门的置信区间。本章中描述的方法可在现行软件中使用，有些可用于特定问题。讨论并不全面，而是指出了已经解决的置信区间类型。在 Burdick and Graybill (1992) 以及当前统计期刊的论文中，有更为完整的讨论。 20.1 假设检验 有两种基本技术来检验关于方差分量的假设。第一种技术使用方差分析表中的平方和来构造 \\(F\\) 统计量。对于大多数均衡模型，\\(F\\) 统计量的分布与 \\(F\\) 分布完全相同，而对于不均衡模型，分布由 \\(F\\) 分布近似，随着设计变得越来越不均衡，近似值变得越来越差。第二种技术基于似然比检验 (likelihood rato test)，渐近分布于卡方分布。对于均衡设计，\\(F\\) 统计量方法可能比似然比检验更好，而对于不均衡设计，没有明确的选择。读者可能希望在决定使用哪种方法来检验感兴趣的假设之前，使用与感兴趣的数据集类似的数据结构进行模拟实验，以研究检验统计量的分布。 20.1.1 使用方差分析表 如果数据集是均衡的，那么通过常规方差分析获得的平方和独立分布于卡方随机变量的标量倍数29。令 \\(Q\\) 表示基于自由度 v 的平方和，其中其期望均方是四个方差分量的函数。也就是说，假设 \\[E(Q/v)=\\sigma_\\varepsilon^2+k_1\\sigma_1^2+k_2\\sigma_2^2+k_3\\sigma_3^2\\] 然后，假设数据服从正态分布， \\[W=\\frac Q{\\sigma_\\varepsilon^2+k_1\\sigma_1^2+k_2\\sigma_2^2+k_3\\sigma_3^2}\\] 通常分布为具有 n 个自由度的卡方随机变量。对于许多形如 \\(H_0{:}\\sigma_1^2=0\\mathrm{~vs~}{H_a}{:}\\sigma_1^2&gt;0\\) 的假设，有两个独立的平方和，用 \\(Q_1\\) 和 \\(Q_2\\) 表示，分别基于 v1 和 v2 自由度，期望为 \\[\\begin{aligned}E(Q_1/n_1)&amp;=\\sigma_\\varepsilon^2+k_1\\sigma_1^2+k_2\\sigma_2^2+k_3\\sigma_3^2\\\\E(Q_2/n_2)&amp;=\\sigma_\\varepsilon^2+k_2\\sigma_2^2+k_3\\sigma_3^2\\end{aligned}\\] 假设 \\(H_0{:}\\sigma_1^2=0\\mathrm{~vs~}{H_a}{:}\\sigma_1^2&gt;0\\) 等价于 \\[\\begin{aligned}H_0\\colon E\\left(Q_1/v_1\\right)&amp;=E(Q_2/v_2)\\text{ vs }H_a\\colon E(Q_1/v_1)&gt;E(Q_2/v_2)\\end{aligned}\\] 用于检验该假设的统计量为 \\(F = (Q_1/v_1)/(Q_2/v_2)\\)，在 \\(H_0\\) 条件下，该统计量通常分布为具有 v1 和 v2 自由度的中心 \\(F\\) 分布。对于较大的 \\(F\\) 值，该假设被拒绝。此过程涉及获取平方和，然后使用其期望均方来确定每个感兴趣假设的适当除数。以下两个示例演示了此程序。 20.1.2 示例 20.1：完全随机设计结构中的双向随机效应检验统计量 在完全随机设计结构中，两个因素均为随机的双向处理结构的模型为 \\[y_{ijk}=\\mu+a_i+b_j+c_{ij}+\\varepsilon_{ijk}\\quad\\mathrm{~for~}i=1,2,\\ldots,a,j=1,2,\\ldots,b,\\mathrm{~and~}k=1,2,\\ldots,n\\] 其中 \\(a_i\\thicksim i.i.d.\\,N(0,\\sigma_a^2),b_j\\thicksim i.i.d.\\,N(0,\\sigma_b^2),c_{ij}\\thicksim i.i.d.\\,N(0,\\sigma_c^2),\\varepsilon_{ijk}\\thicksim i.i.d.\\,N(0,\\sigma_\\varepsilon^2)\\)，且随机变量 \\(a_i,b_j,c_{ij},\\varepsilon_{ijk}\\) 独立分布。 表 20.1 显示了模型的方差分析表以及模型的平方和和期望均方。通过检查期望均方来选择适当的分子和分母来构造检验统计量。用于检验假设 \\(H_0{:}\\sigma_a^2=0\\mathrm{~vs~}{H_u}{:}\\sigma_a^2&gt;0\\) 的统计量是通过在 \\(MSA\\) 的期望均方中设置 \\(\\sigma_a^2=0\\) 来构造的。接下来，当 \\(H_0\\) 为真时，找到与 \\(MSA\\) 具有相同期望均方的另一个均方，并使用该均方作为除数。要检验 \\(H_0{:}\\sigma_a^2=0\\mathrm{~vs~}{H_u}{:}\\sigma_a^2&gt;0\\)，适当的除数是 \\(MSAB\\)；要检验 \\(H_0{:}\\sigma_b^2=0\\mathrm{~vs~}{H_u}{:}\\sigma_b^2&gt;0\\)，适当的除数是 \\(MSAB\\)；要检验 \\(H_0{:}\\sigma_c^2=0\\mathrm{~vs~}{H_u}{:}\\sigma_c^2&gt;0\\)，适当的除数是 \\(MSResidual\\). 决策规则是拒绝 \\(H_0{:}\\sigma_a^2=0\\mathrm{~vs~}{H_u}{:}\\sigma_a^2&gt;0\\) 如果 \\(F = MSA/MSAB&gt;F_{\\alpha,(a-1),(a-1)(b-1)}\\)，其中 \\(\\alpha\\) 为所选的 I 类错误率。对于 \\(\\sigma_b^2\\) 和 \\(\\sigma_c^2\\) 可以类似地确定检验统计量。表 20.1 包含假设列表和相应的检验统计量。很可能，当 \\(F\\) 统计量不超过指定的分位数时，结论并不是方差分量为零，而是与系统中其他变异源相比，方差分量的大小可以忽略不计。 表 20.1: 示例 20.1 双向随机效应模型方差分析表 x 20.1.3 示例 20.2：复杂三向随机效应检验统计量 表 20.2: 示例 20.2 数据 x 表 20.2 中的数据来自一个设计，其中处理结构中的三个因素的水平是随机效应，A 的水平与 B 的水平交叉，C 的水平嵌套在 B 的水平内，所有这些都在一个完全随机设计结构中。一个描述与表 20.2 结构相似的大型数据集的一般模型是 \\[\\begin{aligned}&amp;y_{ijkm}=\\mu+a_i+b_j+(ab)_{ij}+c_{k(j)}+(ac)_{ik(j)}+\\varepsilon_{ijkm}\\\\&amp;\\mathrm{for~}i=1,2,\\ldots,a,j=1,2,\\ldots,b,k=1,2,\\ldots,c,\\mathrm{~and~}m=1,2,\\ldots,n\\end{aligned}\\] 参数 \\(\\mu\\) 表示总体均值，\\(a_i\\) 表示因子 A 水平 i 的效应，\\(b_j\\) 表示因子 B 水平 j 的效应，\\((ab)_{ij}\\) 表示因子 A 和因子 B 水平之间的交互作用，\\(c_{k(j)}\\) 表示嵌套在因子 B 第 j 个水平内的因子 C 水平 k 的效应，\\((ac)_{ik(j)}\\) 表示因子 A 与嵌套在因子 B 内的因子 C 水平之间的交互作用，以及 \\(\\varepsilon_{ijkm}\\) 表示实验单元或抽样误差。在理想条件下，\\(a_i\\thicksim i.i.d.~N(0,\\sigma_a^2),~b_j\\thicksim i.i.d.~N(0,~\\sigma_b^2),~(ab)_{ij}\\thicksim i.i.d.~N(0,~\\sigma_{ab}^2),~(ac)_{ik(j)}\\thicksim i.i.d.~N(0,~\\sigma_{ac(b)}^2)\\) 以及 \\(\\varepsilon_{ijkm}\\thicksim i.i.d.~N(0,~\\sigma_{\\varepsilon}^2)\\). 此外， \\(a_i,b_j,(ab)_{ij},c_{k(j)},(ac)_{ik(j)}\\) 和 \\(\\varepsilon_{ijkm}\\) 独立分布。一般情况下的期望均方方差分析表如表 20.3 所示。 表 20.3: 示例 20.2 方差分析表 x 通过检查期望均方，可以构造 \\(F\\) 统计量来检验每个方差分量的假设。用于检验以下假设的统计量是 要检验 \\(H_0\\colon{\\sigma}_a^2=0\\mathrm{~vs~}H_a\\colon{\\sigma}_a^2&gt;0\\)，则 \\(F_a=MSA/MSAB\\). 要检验 \\(H_0\\colon{\\sigma}_{ab}^2=0\\mathrm{~vs~}H_a\\colon{\\sigma}_{ab}^2&gt;0\\)，则 \\(F_{ab}=MSAB/MSAC(B)\\). 要检验 \\(H_0\\colon{\\sigma}_{c(b)}^2=0\\mathrm{~vs~}H_a\\colon{\\sigma}_{c(b)}^2&gt;0\\)，则 \\(F_{c(b)}=MSC(B)/MSAC(B)\\). 要检验 \\(H_0\\colon{\\sigma}_{ac(b)}^2=0\\mathrm{~vs~}H_a\\colon{\\sigma}_{ac(b)}^2&gt;0\\)，则 \\(F_{ac(b)}=MSAC(B)/MSResidual\\). 然而，没有 \\(F\\) 统计量来检验 \\(H_0\\colon{\\sigma}_b^2=0\\mathrm{~vs~}H_b\\colon{\\sigma}_a^2&gt;0\\)，因为不涉及 \\(\\sigma^2_b\\) 的均方都不具有预期值 \\(\\sigma_\\varepsilon^2+n\\sigma_{ac(b)}^2+na\\sigma_{c(b)}^2+nc\\sigma_{ab}^2\\)，这是当 \\(\\sigma^2_b=0\\) 时 \\(MSB\\) 的期望值。但存在一个均方的线性组合（不包括 \\(MSB\\)）具有所需的期望值，即，\\(E[MSC(B)+MSAB-MSAC(B)]=\\sigma_\\varepsilon^2+n\\sigma_{ac(b)}^2+na\\sigma_{c(b)}^2+nc\\sigma_{ab}^2\\). 令 \\(Q=MSC(B)+MSAB-MSAC(B)\\)，那么用于检验 \\(H_0\\colon{\\sigma}_b^2=0\\mathrm{~vs~}H_b\\colon{\\sigma}_a^2&gt;0\\) 的统计量为 \\(F_b=MSB/Q\\). \\(F_b\\) 的抽样分布可以用自由度为 b-1 和 r 的 \\(F\\) 分布来近似。分母自由度 r 的确定是通过使用第 2 章中讨论的 Satterthwaite (1946) 近似，将 \\(rQ/E(Q)\\) 的分布近似为卡方分布来完成的。Satterthwaite 近似用于近似 \\(Q = q_1MS_1 + q_2MS_2 + \\cdots + q_kMS_k\\) 的抽样分布，其中 \\(MS_i\\) 表示基于自由度为 \\(f_i\\) 的均方，均方独立分布，\\(q_i\\) 是已知常数。那么 \\(rQ/E(Q)\\) 近似分布为基于自由度为 r 的中心卡方随机变量，其中 \\[r=\\frac{(Q)^2}{\\sum_{i=1}^k\\frac{\\left(q_iMS_i\\right)^2}{f_i}}\\] 假设 \\(U\\) 是基于 f 个自由度的均方，独立分布于 \\(MS_1,MS_2,\\cdots,MS_k\\)，期望为 \\(E(U) = E(Q) + k_0\\sigma^2_0\\). 检验 \\(H_0\\colon{\\sigma}_0^2=0\\mathrm{~vs~}H_a\\colon{\\sigma}_0^2&gt;0\\) 的统计量为 \\(F = U/Q\\)，其近似分布为具有 f 和 r 自由度的 \\(F\\) 分布。 检验 \\(H_0\\colon{\\sigma}_b^2=0\\mathrm{~vs~}H_a\\colon{\\sigma}_b^2&gt;0\\) 的统计量为 \\(F_b = MSB/Q\\)，近似分布为具有 b-1 和 r 自由度的 \\(F\\) 分布，其中 \\[r=\\frac{(Q)^2}{\\frac{[MSC(B)]^2}{b(c-1)}+\\frac{[MSAB]^2}{(a-1)(b-1)}+\\frac{[MSAC(B)]^2}{b(a-1)(c-1)}}\\] 表 20.4: 关示示例 20.2 的数据，使用 I 型平方和的 Proc Mixed 代码的方差分析表 x 表 20.4 包含表 20.3 中数据的方差分析表，其中包括除数（用误差项表示）和用于检验各个假设的 \\(F\\) 统计量。要检验 \\(H_0\\colon{\\sigma}_b^2=0\\mathrm{~vs~}H_a\\colon{\\sigma}_b^2&gt;0\\)，令 \\[\\begin{aligned} Q&amp; =MSC(B)+MSAB-MSAC(B) \\\\ &amp;=12.0625+10.5625-0.8125=21.8125 \\end{aligned}\\] \\(Q\\) 对应的自由度为 \\[\\begin{aligned} r&amp; =\\frac{(21.8125)^2}{(12.0625)^2/2+(10.5625)^2/1+(0.8125)^2/2} \\\\ &amp;=\\frac{475.7852}{184.9785}=2.57 \\end{aligned}\\] 检验统计量 \\(F = 770.0625/21.8125 = 35.304\\) 基于 1 和 2.57 自由度。检验的显著性水平为 0.0144，表明有证据表明 \\({\\sigma}_b^2 &gt; 0\\)，或者由于因子 B 水平总体引起的变异是系统总变异的重要组成部分。 为了检验均衡设计中方差分量的假设，应尽可能使用根据两个均方之比构造的 \\(F\\) 检验。当无法使用两个均方之比时，Satterthwaite 近似是可接受的替代方案。 当设计不均衡时，几乎总是需要某种 Satterthwaite 近似来检验有关方差分量的假设。此外，方差分析表中的平方和可能不具有独立分布，尽管平方和集对于某些特殊情况可能是独立的。残差或误差平方和始终独立于方差分析表中的其他平方和。因此，对于任何期望为 \\({\\sigma}_{{\\varepsilon}}^2+{k}_0{\\sigma}_0^2\\) 的均方 \\(U\\)，统计量 \\(F_0 = U/MSResidual\\) 提供了对假设 \\(H_0\\colon{\\sigma}_0^2=0\\mathrm{~vs~}H_a\\colon{\\sigma}_0^2&gt;0\\) 的检验。在 \\(H_0\\) 的条件下，\\(F\\) 分布为具有 u 和 v 自由度的中心 \\(F\\) 分布，其中 u 是与 \\(U\\) 相关的自由度，v 是与 \\(MSResidual\\) 相关的自由度。 期望值涉及超过两个方差分量的均方通常不能用于获得具有精确 \\(F\\) 抽样分布的单个方差分量的检验统计量。某些均衡设计会出现精确的 \\(F\\) 分布，如前两个示例所示。比率不精确分布于 \\(F\\) 的一个原因是各自的均方不是独立分布的。如果设计不太不均衡，那么使用 \\(F\\) 分布作为近似应该是足够的。此外，当设计不均衡时，平方和（残差除外）不会分布为卡方分布的标量倍数。 一般来说，为了检验 \\(H_0\\colon{\\sigma}_0^2=0\\mathrm{~vs~}H_a\\colon{\\sigma}_0^2&gt;0\\)，将有一个均方，记为 \\(U_1\\)，期望为 \\[E(U_1)=\\sigma_\\varepsilon^2+k_{1a}\\sigma_a^2+k_{1b}\\sigma_b^2+k_{1c}\\sigma_c^2\\] 但不会有其他均方具有期望 \\(\\sigma_\\varepsilon^2+k_{1b}\\sigma_b^2+k_{1c}\\sigma_c^2\\)；也就是说，没有一个均方是合适的除数。方法是找到其他均方的线性组合，如 \\(Q=\\sum_{i=1}^kq_iMS_i\\) 其中 \\(E(Q)=\\sigma_\\varepsilon^2+k_{1b}\\sigma_b^2+k_{1c}\\sigma_c^2\\). Satterthwaite 近似可用于近似 \\(Q\\) 的抽样分布，即，求 r，使得 \\(rQ/E(Q)\\) 近似分布为具有 r 个自由度的卡方随机变量。该近似是双重的，因为 1) 自由度是近似的，2) 组成 \\(Q\\) 的均方不一定按照近似所要求的那样独立分布为卡方随机变量。 SAS®-Mixed 代码和使用 III 型平方和得出的方差分析表，用于示例 19.2 中的小麦虫害数据，如表 20.5 所示。variaty 均方的期望值是 \\(\\sigma_\\varepsilon^2+3.1795\\sigma_\\mathrm{var}^2\\). 为了检验假设 \\(H_0\\colon\\sigma_{\\text{var}}^2=0\\text{ vs }H_a\\colon\\sigma_{\\text{var}}^2&gt;0\\)，适当的除数是残差均方，它提供的 \\(F\\) 统计量为 4.79. 将计算出的 \\(F\\) 统计量与具有 3 和 9 个自由度的 \\(F\\) 分布进行比较；其显著性水平为 0.0293. 由于这是一个单向实验，因此 I 型分析与 III 型分析相同。 表 20.5: 示例 19.2 中数据含期望均方和 \\(F\\) 统计量的方差分析表 x 表 20.6: 示例 19.3 的双向随机效应数据的 I 型分析，其中预期均方和误差项用于计算 \\(F\\) 统计量 x 表 20.6 显示了根据示例 19.3 的双向随机效应数据的 I 型平方和构造的 SAS-Mixed 代码和方差分析表。为了检验假设 \\(H_0\\colon{\\sigma}_{\\mathrm{row}\\times\\mathrm{col}}^2=0\\text{ vs }H_a\\colon{\\sigma}_{\\mathrm{row}\\times\\mathrm{col}}^2&gt;0\\)，适当的除数是残差均方，它提供的 \\(F\\) 统计量为 14.24. 将计算出的 \\(F\\) 统计量与自由度为 2 和 8 的 \\(F\\) 分布进行比较，提供的显著性水平为 0.0023. 没有精确的检验可用于检验 \\(H_0\\colon{\\sigma^2}_{\\text{row}}=0\\text{ vs }H_a\\colon{\\sigma^2}_{\\text{row}}&gt;0\\) 和 \\(H_0\\colon{\\sigma^2}_{\\text{col}}=0\\text{ vs }H_a\\colon{\\sigma^2}_{\\text{col}}&gt;0\\)，因此需要构造近似检验。用于检验 \\(H_0\\colon{\\sigma^2}_{\\text{row}}=0\\text{ vs }H_a\\colon{\\sigma^2}_{\\text{row}}&gt;0\\) 的 \\(MS_{\\text{Row}}\\) 的适当除数计算如下 \\[\\begin{aligned} Q_{row} =&amp;\\,\\frac{0.1429}{4.5714}MSCol+\\frac1{2.2588}{\\left[2.4286-\\frac{0.1429}{4.5714}\\times2.3126\\right]}MSRow\\times Col \\\\ &amp;+\\left[1-\\frac{0.1429}{4.5714}-\\frac1{2.2588}{\\left(2.4286-\\frac{0.1429}{4.5714}\\times2.3126\\right)}\\right]MSResidual \\\\ =&amp;\\,0.0313\\times MSCol+1.0432 \\,MSRow\\times Col-0.0744\\,MSResidual\\\\ =&amp;\\,55.7806 \\end{aligned}\\] 与 \\(Q_{\\mathrm{row}}\\) 相关的 Satterthwaite 近似自由度计算如下 \\[\\begin{aligned}df_{Q_{\\mathrm{row}}}&amp;=\\frac{(Q_{\\mathrm{row}})^2}{\\frac{(0.0313\\times MSCol)^2}2+\\frac{(1.0432\\times MSRow\\times Col)^2}2+\\frac{(0.0744\\times MSResidual)^2}8}\\\\&amp;=1.9961\\end{aligned}\\] 生成的 \\(F\\) 统计量为 \\(F_{\\mathrm{row}}=MSRow/Q_{\\mathrm{row}}=0.0113\\)，显著性水平为 0.9251. 用于检验 \\(H_0\\colon{\\sigma^2}_{\\text{col}}=0\\text{ vs }H_a\\colon{\\sigma^2}_{\\text{col}}&gt;0\\) 的 \\(MSCol\\) 的适当除数计算为 \\[\\begin{aligned} Q_{\\text{col}}&amp; =\\frac{2.3126}{2.2588}MSRow\\times Col+\\left[1-\\frac{2.3126}{2.2588}\\right]MSResidual \\\\ &amp;=1.0238\\,MSRow\\times Col-0.0238\\,MSResidual \\\\ &amp;=56.8729 \\end{aligned}\\] 与 \\(Q_{\\mathrm{col}}\\) 相关的 Satterthwaite 近似自由度计算如下 \\[\\begin{aligned}df_{Q_{\\mathrm{col}}}&amp;=\\frac{(Q_{\\mathrm{col}})^2}{\\frac{(1.0238\\times MSRow\\times Col)^2}2+\\frac{(0.0238\\times MSResidual)^2}8}\\\\&amp;=1.9935\\end{aligned}\\] 生成的 \\(F\\) 统计量为 \\(F_{\\mathrm{col}}=MSCol/Q_{\\mathrm{col}}=0.1323\\)，显著性水平为 0.8832. 20.1.4 似然比检验 检验方差分量假设的第二种方法基于似然比程序，该程序涉及评估完全模型的似然函数值以及评估在 \\(H_0\\) 条件下模型的似然函数值。 方程 (18.3) 的一般随机模型是 \\[\\boldsymbol y=\\boldsymbol j_n\\mu+\\boldsymbol Z_1 \\boldsymbol u_1+\\boldsymbol Z_2\\boldsymbol u_2+\\cdots+\\boldsymbol Z_k\\boldsymbol u_k+\\boldsymbol\\varepsilon \\] 其中 \\(\\boldsymbol{u}_1\\thicksim N(0,{\\sigma}_1^2\\boldsymbol{I}_{t_1}),\\boldsymbol{u}_2\\thicksim N(0,{\\sigma}_2^2\\boldsymbol{I}_{t_2}),...,\\boldsymbol{u}_r\\thicksim N(0,{\\sigma}_r^2\\boldsymbol{I}_{t_r}),{\\varepsilon}\\thicksim N(0,{\\sigma}_\\varepsilon^2\\boldsymbol{I}_N)\\) 且这些随机变量独立分布。分布假设意味着 \\(\\boldsymbol y\\) 的边际分布为 \\(N(\\boldsymbol j_n\\mu,\\boldsymbol \\Sigma)\\) 其中 \\(\\boldsymbol \\Sigma=\\sigma_\\varepsilon^2\\boldsymbol I_n+\\sigma_1^2\\boldsymbol Z_1\\boldsymbol Z_1^{\\prime}+\\sigma_2^2\\boldsymbol Z_2\\boldsymbol Z_2^{\\prime}+\\cdots+\\sigma_k^2\\boldsymbol Z_k\\boldsymbol Z_k^{\\prime}\\). 似然方程是 \\[L(\\mu,\\sigma_\\varepsilon^2,\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2|\\boldsymbol y)=(2\\pi)^{-n/2}|\\boldsymbol \\Sigma|^{-1/2}\\exp\\left[-\\frac12(\\boldsymbol y-\\boldsymbol j_n\\mu)^{\\prime}\\boldsymbol\\Sigma^{-1}(\\boldsymbol y-\\boldsymbol j_n\\mu)\\right]\\] \\(H_0{:{\\sigma_1^2}}=0\\) 条件下的似然函数为 \\[L_0(\\mu,\\sigma_\\varepsilon^2,0,\\sigma_2^2,\\ldots,\\sigma_k^2|\\boldsymbol y)=(2\\pi)^{-n/2}\\left|\\boldsymbol \\Sigma_0\\right|^{-1/2}\\exp\\left[-\\frac12(\\boldsymbol y-\\boldsymbol j_n\\mu)^{\\prime}\\boldsymbol \\Sigma_0^{-1}(\\boldsymbol y-\\boldsymbol j_n\\mu)\\right]\\] 其中 \\(\\boldsymbol \\Sigma_0=\\sigma_\\varepsilon^2\\boldsymbol I_n+\\sigma_2^2\\boldsymbol Z_2\\boldsymbol Z_2^{\\prime}+\\sigma_3^2\\boldsymbol Z_3\\boldsymbol Z_3^{\\prime}+\\cdots+\\sigma_k^2\\boldsymbol Z_k\\boldsymbol Z_k^{\\prime}\\). 该过程是获得两个似然函数的参数的最大似然估计，并根据其估计的值评估每个似然函数。似然比检验统计量为 \\[LR(\\sigma_1^2=0)=\\frac{L_0(\\hat{\\mu}_0,\\hat{\\sigma}_{\\varepsilon0}^2,0,\\hat{\\sigma}_{20}^2,\\hat{\\sigma}_{30}^2,\\ldots,\\hat{\\sigma}_{k0}^2|\\boldsymbol y)}{L(\\hat{\\mu},\\hat{\\sigma}_{\\varepsilon}^2,\\hat{\\sigma}_1^2,\\hat{\\sigma}_2^2,\\ldots,\\hat{\\sigma}_k^2|\\boldsymbol y)}\\] 其中 \\(\\hat{\\sigma}_{i0}^2\\) 表示，在 \\(H_0{:{\\sigma_1^2}}=0\\) 条件下从似然函数中得到的 \\({\\sigma}_{i0}^2\\) 的最大似然估计。当 \\(H_0{:{\\sigma_1^2}}=0\\) 为真， \\[\\begin{aligned}-2\\log[LR(\\sigma_1^2=0)]=&amp;-2\\log_{\\mathrm{e}}[L_0(\\hat{\\mu}_0,\\hat{\\sigma}_{\\varepsilon0}^2,0,\\hat{\\sigma}_{20}^2,\\hat{\\sigma}_{30}^2,\\ldots,\\hat{\\sigma}_{k0}^2| \\boldsymbol y)]\\\\&amp;+2\\log_{\\mathrm{e}}[L(\\hat{\\mu},\\hat{\\sigma}_{\\varepsilon}^2,\\hat{\\sigma}_1^2,\\hat{\\sigma}_2^2,\\ldots,\\hat{\\sigma}_k^2|\\boldsymbol y)]\\end{aligned}\\] 的渐近抽样分布为自由度为 1 的中心卡方分布。存在一个自由度的原因是 \\(L_0(·)\\) 中的参数比 \\(L_1(·)\\) 中少一个。决策规则是如果 \\(-2\\log[LR(\\sigma_1^2=0)]&gt;\\chi_{\\alpha,1}^2\\)，则拒绝 \\(H_0\\). 似然比检验统计量可以使用 SAS-Mixed 计算，其中 METHOD = ML 用作方差分量估计程序。 20.1.5 示例 20.3：小麦品种——单向随机效应模型 表 20.7 中给出了 SAS-Mixed 代码以及获得示例 19.2 完全模型参数的最大似然估计结果。描述示例 19.2 数据的模型的参数最大似然估计为 \\(\\hat{\\mu}=3.9909,\\hat{\\sigma}_\\varepsilon^2=0.05749\\) 和 \\(\\hat{\\sigma}_\\mathrm{var}^2=0.04855\\) 以及 \\(-2\\log_{\\mathrm{e}}(\\hat{\\mu},\\hat{\\sigma}_{\\varepsilon^{}}^2,\\hat{\\sigma}_{\\mathrm{var}}^2|\\boldsymbol y)\\) 的值为 4.96762. 缩减模型使用表 20.8 中的 SAS-Mixed 代码拟合数据，其中从表 20.7 的模型中删除了语句 “Random Variety;”. 在\\(H_0{:{\\sigma_1^2}}=0\\) 条件下，参数的最大似然估计为 \\(\\hat{\\mu}=4.0269,\\hat{\\sigma}_\\varepsilon^2=0.1014\\) 和 \\(\\hat{\\sigma}_\\mathrm{var}^2=0\\) 以及 \\(-2\\log_{\\mathrm{e}}(\\hat{\\mu},\\hat{\\sigma}_{\\varepsilon^{}}^2,\\hat{\\sigma}_{\\mathrm{var}}^2|\\boldsymbol y)\\) 的值为 7.13832. 检验 \\(H_0\\) 的似然比检验的 -2loge 值为 \\(7.13832 - 4.96762 = 2.1707\\). 值 2.171 与具有一个自由度的中心卡方分布的分位数进行比较。此检验的显著性水平为 0.1407。使用表 20.5 中的期望均方构造的 \\(F\\) 检验提供了 0.0293 的显著性水平。似然比检验的抽样分布是渐近分布，对于大样本量来说是可以接受的，而在本例中，样本量很小。前面给出的 \\(F\\) 检验的抽样分布是准确的。对于涉及超过两个方差分量的模型，其他方差分量的 \\(F\\) 检验是小样本量的近似检验，通常相当充分，并且对于小样本量的情况，可能比基于渐近分布的检验更好。 表 20.7: 示例 19.2 使用 Method = ML 评估似然函数的 Proc Mixed 代码和拟合完全模型的结果 x 表 20.8: 示例 19.2 拟合缩减模型的 Proc Mixed 代码和结果，使用 Method = ML 评估当 \\(\\sigma^2_{\\text{var}} = 0\\) 时的似然函数 x 20.1.6 示例 20.4：不均衡双向 为检验示例 19.3 中的双向随机效应数据的假设 \\(H_0\\)，似然比统计量是通过拟合一个在 random 语句中包含了所有项的模型，然后拟合一个在 random 语句中不包含 row × col 项的模型来获得的，如表 20.9 所示。用于拟合这两个模型的 SAS-Mixed 代码包含在表 20.9 中。不包含行效应和列效应的模型拟合结果也包含在内，但没有提供相应的 SAS-Mixed 代码。给出了方差分量的最大似然估计、截距估计和 -2log(likelihood) 值。用于假设 \\(H_0:\\sigma_{\\mathrm{~row\\times col}}^2=0\\mathrm{~vs~}H_a{:}\\sigma_{\\mathrm{~row\\times col}}^2&gt;0\\) 的似然比统计量为 \\(73.4-68.7=4.7\\)，其在 \\(H_0\\) 条件下为具有单自由度的卡方抽样分布。显著性水平为 0.030，表明有足够的信息去相信 \\(\\sigma_{\\mathrm{~row\\times col}}^2&gt;0\\). 对于检验行和列方差分量是否等于零的假设，似然比统计量的值均为零。这是因为两个方差分量的最大似然估计均为零。因此，在检验行方差分量是否为零时，无论行是否包含在 random 语句中，-2log(likelihood) 的值都保持不变。 表 20.9: 各种模型的方差分量最大似然估计，以便计算似然比检验统计量来检验每个单独方差分量为零的假设 x 20.2 构造置信区间 有些程序可以为某些模型中的某些方差分量提供精确的置信区间，但大多数情况下，所获得的置信区间都是近似的，并依赖于某种类型的近似。 20.2.1 残差方差 \\(\\sigma^2_\\varepsilon\\) 对于一般随机模型，\\(\\sigma^2_\\varepsilon\\) 的 \\((1 - \\alpha)100\\%\\) 置信区间为 \\[\\frac{v\\hat{\\sigma}_\\varepsilon^2}{\\chi_{(\\alpha/2),v}^2}\\leq\\sigma_\\varepsilon^2\\leq\\frac{v\\hat{\\sigma}_\\varepsilon^2}{\\chi_{1-(\\alpha/2),v}^2}\\] 其中 \\(\\hat{\\sigma}_\\varepsilon^2=\\text{SSRESIDUAL}/v\\)，v 表示与 \\(\\hat{\\sigma}_\\varepsilon^2\\) 相关的自由度。\\(\\chi_{1-(\\alpha/2),v}^2,\\chi_{\\alpha/2,v}^2\\) 表示自由度为 v 的卡方分布的下 \\(\\alpha/2\\) 和上 \\(\\alpha/2\\) 分位点。 20.2.2 一般 Satterthwaite 近似 方差分量抽样分布的一般 Satterthwaite 近似 (general Satterthwaite approximation) 是通过将 \\(r\\hat{{\\sigma}}_i^2/E(\\hat{{\\sigma}}_i^2)\\) 的前两阶矩与基于 r 个自由度的卡方分布的前两阶矩相等，然后解出 r 来获得的。卡方分布的一阶矩等于其自由度 r. 因此，令 \\(r\\hat{{\\sigma}}_i^2/E(\\hat{{\\sigma}}_i^2)\\) 的一阶矩等于自由度为 r 的卡方分布的一阶矩，并不能提供有关 r 的信息。自由度为 r 的卡方分布的方差等于 2r. 令 \\(r\\hat{{\\sigma}}_i^2/E(\\hat{{\\sigma}}_i^2)\\) 的方差等于自由度为 r 的卡方分布的方差，得到 \\[\\mathrm{Var}\\left(\\frac{r\\hat{\\sigma}_i^2}{E(\\hat{\\sigma}_i^2)}\\right)=2r\\quad\\mathrm{or}\\quad\\frac{r^2}{\\left[E(\\hat{\\sigma}_i^2)\\right]^2}\\mathrm{Var}(\\hat{\\sigma}_i^2)=2r\\] 这意味着 \\[r=\\frac{2[\\operatorname{E}(\\hat{\\sigma}_i^2)]^2}{\\operatorname{Var}(\\hat{\\sigma}_i^2)}\\] r 的值是通过将 \\(E(\\hat{\\sigma}_i^2)\\) 替换为 \\(\\hat{\\sigma}_i^2\\) ，并将 \\({\\operatorname{Var}(\\hat{\\sigma}_i^2)}\\) 替换为其方差的估计值来估计的。如果获得了 REML 或 ML 解，则可以使用信息矩阵的逆来提供方差分量估计的方差的估计 (estimates of the variances of the estimated variance components). SAS-Mixed 使用在方差分量估计值处评估的信息矩阵的逆来提供估计方差分量的方差和协方差的渐近估计值。 表 20.10 包含使用 covtest, cl 和 asycov 选项的 SAS-Mixed 代码，以生成方差分量估计的标准误估计，将每个估计值与其标准误估计的比值计算为 Z 值，将 Satterthwaite 类型的置信区间标记为 Lower 和 Upper，以及方差分量估计值的渐近协方差阵。表 20.10 中的 data step 计算了与每个方差分量估计相关的近似自由度，然后使用这些自由度来计算 Satterthwaite 置信区间。\\(\\hat{\\sigma}_{\\text{var}}^2\\) 和 \\(\\hat{\\sigma}_{\\varepsilon}^2\\) 的近似自由度分别为 1.758 和 8.828。重新计算的置信区间与 SAS-Mixed 提供的置信区间相同。 表 20.10: SAS-Mixed 代码，采用 Method = REML 和 Data Step 来计算示例 19.2 中小麦昆虫损害的方差分量的 Satterthwaite 类型置信区间 x 表 20.11 中的 SAS-Mixed 代码为示例 20.1 中的数据提供了方差分量的 REML 估计。方差分量的置信区间是使用 \\(df = 2(\\text{Z-value})^2\\) 计算的，分别提供了 0.50, 0.95, 0.84, 1.73, 0 和 8 个自由度。应该注意到，当与随机效应相关的水平数非常少，因此自由度非常小，所得到的置信区间将非常宽。 表 20.11: 用于提供方差分量的 REML 估计和 Satterwaite 置信区间的 SAS-Mixed 代码 x 20.2.3 方差分量函数的近似置信区间 研究人员通常希望构造关于模型中方差分量的某些函数的置信区间。如下一节所述，涉及均衡模型的某些情况下存在精确的置信区间。 在本节中，使用一阶泰勒级数 (Kendall and Stuart, 1973) 来估计方差函数的方差，然后使用它来构造 Satterthwaite 类型的置信区间。设 \\(\\sigma\\) 表示方差分量的向量，\\(\\text{Var}(\\sigma)\\) 表示方差分量的方差估计和协方差阵估计。假设感兴趣的方差分量的函数为 \\({\\varphi}({\\sigma})\\)，且 \\({\\varphi}({\\sigma})\\) 具有连续的一阶导数。\\({\\varphi}({\\sigma})\\) 的最大似然估计是 \\({\\varphi}(\\hat{\\sigma})\\)，其中 \\(\\hat{\\sigma}\\) 表示 \\(\\sigma\\) 的最大似然估计。与方差分量对应的信息矩阵的逆的估计是 \\(\\hat{{V}}(\\hat{{\\sigma}})\\)，它提供了 \\(\\text{Var}(\\sigma)\\) 的估计。计算 \\({\\varphi}({\\sigma})\\) 关于每个方差分量的导数，并在 \\(\\hat{\\sigma}\\) 处评估它们。然后令 \\({\\varphi}(\\hat{\\sigma})\\) 的近似方差为 \\({\\sigma}_{{\\varphi}(\\hat{\\sigma})}^2=\\hat{\\boldsymbol{f}}^{\\prime}\\hat{\\boldsymbol{V}}(\\hat{{\\sigma}})\\hat{\\boldsymbol{f}}\\). 与该估计对应的 Satterthwaite 近似自由度计算如下 \\[r=\\frac{2[\\varphi(\\hat{\\sigma})]^2}{\\hat{\\sigma}_{\\varphi(\\hat{\\sigma})}^2}\\] 假设研究人员有兴趣估计示例 19.2 的昆虫损害研究数据的总变异性；也就是说，研究人员想要估计 \\(\\varphi(\\sigma)=\\sigma^2_{\\text{var}}+\\sigma^2_{\\varepsilon}\\). \\(\\varphi(\\sigma)\\) 的一阶导数向量为 \\[\\boldsymbol f=\\begin{bmatrix}\\frac{\\partial\\varphi(\\sigma)}{\\partial\\sigma_\\mathrm{var}^2}\\\\\\frac{\\partial\\varphi(\\sigma)}{\\partial\\sigma_\\varepsilon^2}\\end{bmatrix}=\\begin{bmatrix}1\\\\1\\end{bmatrix}\\] 方差分量估计的协方差阵为 \\[\\hat{\\boldsymbol V}(\\hat{\\sigma})=\\begin{bmatrix}\\hat{\\sigma}_{\\hat{\\sigma}_{\\mathrm{var}}^2}^2&amp;\\hat{\\sigma}_{\\hat{\\sigma}_{\\mathrm{var}}^2,\\hat{\\sigma}_{\\hat{\\varepsilon}}^2}^2\\\\\\hat{\\sigma}_{\\hat{\\sigma}_{\\mathrm{var}}^2,\\hat{\\sigma}_{\\hat{\\varepsilon}}^2}^2&amp;\\hat{\\sigma}_{\\hat{\\sigma}_{\\hat{\\varepsilon}}^2}^2\\end{bmatrix}\\] 因此 \\(\\varphi(\\hat{\\sigma})\\) 的近似方差为 \\[\\hat{\\sigma}_{\\varphi(\\hat{\\sigma})}^2=\\hat{\\sigma}_{\\hat{\\sigma}_\\mathrm{var}^2}^2+\\hat{\\sigma}_{\\hat{\\sigma}_\\varepsilon^2}^2+2\\hat{\\sigma}_{\\hat{\\sigma}_\\mathrm{var}^2\\hat{\\sigma}_\\varepsilon^2}\\]. 使用表 20.10 中的信息可以得到 \\[\\varphi(\\hat{\\sigma})=0.07316+0.05700=0.13010\\] 以及 \\[\\hat{\\sigma}_{\\varphi(\\hat{\\sigma})}^2=0.006087+0.000736-2(0.00031)=0.006203\\] 方差估计对应的近似自由度为 \\[r=\\frac{2(0.13010)^2}{0.006203}=5.46\\] 最后，\\(\\varphi(\\sigma)=\\sigma_{\\mathrm{var}}^2+\\sigma_{\\varepsilon}^2\\) 的 95% 置信区间为 \\[0.052287&lt;\\sigma_\\mathrm{var}^2+\\sigma_\\varepsilon^2&lt;0.70253\\] 作为第二个例子，组内相关系数定义为 \\[\\rho=\\frac{\\sigma_\\mathrm{var}^2}{\\sigma_\\varepsilon^2+\\sigma_\\mathrm{var}^2}\\] 可以使用泰勒级数方法构造近似置信区间，其中 \\[\\varphi(\\rho)=\\frac{\\sigma_\\mathrm{var}^2}{\\sigma_\\varepsilon^2+\\sigma_\\mathrm{var}^2}\\] \\(\\rho=\\frac{\\sigma_\\mathrm{var}^2}{\\sigma_\\varepsilon^2+\\sigma_\\mathrm{var}^2}\\) 导数的估计向量的转置为 \\[\\hat{\\boldsymbol f}^{\\prime}=\\left[\\frac{(\\hat{\\sigma}_\\varepsilon^2+\\hat{\\sigma}_\\mathrm{var}^2)-(\\hat{\\sigma}_\\mathrm{var}^2)}{(\\hat{\\sigma}_\\varepsilon^2+\\hat{\\sigma}_\\mathrm{var}^2)^2},\\frac{-(\\hat{\\sigma}_\\mathrm{var}^2)}{(\\hat{\\sigma}_\\varepsilon^2+\\hat{\\sigma}_\\mathrm{var}^2)^2}\\right]\\] 使用表 20.10 中的信息，组内相关性的估计值为 \\(\\hat\\rho = 0.5621\\)，其方差估计为 0.2156。相应的近似自由度为 \\(r = 2.93\\). 得到的组内相关系数的近似置信区间为 (0.1785, 8.214)，可以简化为 (0.1785, 1)，因为类内相关系数不能大于 1. 对于方差分量的线性函数，一阶泰勒级数方法非常有效，而对于如组内相关性这样的非线性函数，其效果较差。组内相关性的置信区间更好，将在第 20.2.3 节中描述。 当使用平方和的方法获得方差分量的估计值时，可以使用通常的 Satterthwaite 近似 (usual Satterthwaite approximation) 来构造置信区间。假设每个方差分量的估计值可以表示为方差分析表中给出的均方值的线性组合，如 \\(\\hat{{\\sigma}}_s^2=\\sum_{i=1}^kc_{is}MS_i+c_{\\varepsilon s}MSResidual\\). 然后自由度的近似数计算为 \\[r_s=\\frac{(\\hat{\\sigma}_s^2)^2}{\\sum_{i=1}^k\\frac{\\left(c_{is}MS_i\\right)^2}{df_{_{MS_i}}}+\\frac{\\left(c_{_{\\mathbf{\\varepsilon}s}}MSResidual\\right)^2}{df_{_{MSResidual}}}}\\] \\(\\sigma^2_s\\) 的近似 \\((1 - \\alpha)100\\%\\) 置信区间为 \\[\\frac{r_s\\hat{\\sigma}_s^2}{\\chi_{\\alpha/2,r_s}^2}\\leq\\sigma_s^2\\leq\\frac{r_s\\hat{\\sigma}_s^2}{\\chi_{1-(\\alpha/2),r_s}^2}\\] 当使用平方和方法估计方差分量时，可以很容易地从期望均方和 SAS-Mixed 提供的误差项获得均方系数。例如，示例 20.2 中 \\(\\sigma^2_a\\) 的估计为 \\[\\hat{\\sigma}_a^2=\\frac18{\\left[MSA-MS(A\\times B)\\right]}=\\frac18(39.0625-10.5625)=3.5625\\] 自由度的近似数为 \\[\\begin{aligned}r&amp;=\\frac{(3.5625)^2}{\\frac{[(1/8)39.0625]^2}1+\\frac{[(1/8)10.5625]^2}1}=0.305\\end{aligned}\\] \\(\\sigma^2_a\\) 的最终置信区间为 (0.4226, 27556199203.09)，这是由于自由度数非常低 (0.305) 而导致的非常宽的区间。另外，示例 20.2 中 \\(\\sigma^2_b\\) 的估计为 \\[\\begin{aligned} \\hat{\\sigma}_b^2&amp; =\\frac18\\{MSB-[MS(A\\times B)+MS(C(B))-MS(A\\times C(B))]\\} \\\\ &amp;=\\frac18(770.0625-12.0625-10.5625+0.8125) \\\\ &amp;=93.5313 \\end{aligned}\\] 自由度的近似数为 \\[\\begin{aligned}r&amp;=\\frac{(93.5313)^2}{\\frac{[(1/8)770.0625]^2}1+\\frac{[(1/8)12.0625]^2}2\\frac{[(1/8)10.5625]^2}{1}\\frac{[(1/8)0.8125]^2}2}\\\\ &amp;=0.944 \\end{aligned}\\] \\(\\sigma^2_b\\) 的最终置信区间为 (18.1347, 141493.19)，这也是由于自由度数较少而导致的较宽区间。基本上，当只有少量自由度可用于估计方差分量时，对该方差分量将会知之甚少。 20.2.4 方差分量的 Wald 型置信区间 Wald 型置信区间可以使用最大似然估计的渐近正态性来计算。方差分量 \\(\\sigma^2_s\\) 的 \\((1 - \\alpha)100\\%\\) Wald 置信区间为 \\(\\hat{{\\sigma}}_s^2-Z_{\\alpha/2}\\sqrt{\\hat{\\sigma}_{\\hat{{\\sigma}}_s^2}^2}\\leq{\\sigma}_s^2\\leq\\hat{{\\sigma}}_s^2+Z_{\\alpha/2}\\sqrt{\\hat{\\sigma}_{\\hat{{\\sigma}}_s^2}^2}\\). Wald 置信区间关于 \\(\\hat{{\\sigma}}_s^2\\) 对称。在数据正态性的假设下，与方差相关的抽样分布是不对称的卡方分布。但随着自由度数量的增加，卡方分布的形状变得更加对称。因此，当与方差分量相关的自由度较大时，Wald 置信区间应该足够，但当自由度数量较小时，Satterthwaite 型置信区间将更接近于现实。当在 SAS-Mixed 中使用 METHOD = TYPEx 并请求置信区间时，除残差方差分量计算的是 Satterthwaite 置信区间外，所有方差分量都提供 Wald 置信区间。 20.2.5 一些精确的置信区间 由均衡模型的方差分析表中的所有平方和（不包括 \\(SSRESIDUAL\\)）与残差平方和无关，因此可以使用下一个结果来构造方差分量的置信区间，如 \\(\\sigma^2_1\\)，当模型中存在期望为 \\(\\sigma_\\varepsilon^2+a\\sigma_1^2\\) 的均方时，其置信系数至少为 \\(1-\\alpha\\). 令 \\(Q_1=MSRESIDUAL\\) 并假设其基于 u1 个自由度，并令 \\(Q_2\\) 为基于 u2 个自由度，期望为 \\(\\sigma_\\varepsilon^2+a\\sigma_1^2\\). 关于 \\(\\sigma_\\varepsilon^2\\) 和 \\(\\sigma_\\varepsilon^2+a\\sigma_1^2\\) 的一组精确同时 \\((1 - \\alpha)100\\%\\) 置信区间由下式给出 \\[\\begin{aligned}&amp;\\frac{u_1Q_1}{\\chi_{\\rho/2,u_1}^2}\\leq\\sigma_\\varepsilon^2\\leq\\frac{u_1Q_1}{\\chi_{1-(\\rho/2),u_1}^2}\\\\&amp;\\frac{u_2Q_2}{\\chi_{\\rho/2,u_2}^2}\\leq\\sigma_\\varepsilon^2+a\\sigma_1^2\\leq\\frac{u_2Q_2}{\\chi_{1-(\\rho/2),u_2}^2}\\end{aligned}\\] 其中 \\(\\rho=1-\\sqrt{1-\\alpha}\\). 这两个区域在 \\((\\sigma_{\\varepsilon^{}}^2,\\sigma_1^2)\\) 平面上的交集为 \\((\\sigma_{\\varepsilon^{}}^2,\\sigma_1^2)\\) 提供了 \\((1 - \\alpha)100\\%\\) 同时置信域 (simultaneous confidence region). 置信域图如图 20.1 所示。通过确定置信域内 \\(\\sigma_1^2\\) 的最大值和最小值，可以获得关于 \\(\\sigma_1^2\\) 的 \\((1 - \\alpha)100\\%\\) 置信区间。图 20.1 中交集区域中 \\(\\sigma_1^2\\) 的最小值由 c 给出，最大值由 d 给出。 c 和 d 的值可以通过求解相应的线相交处的 \\(\\sigma_1^2\\) 的值来确定。两组线相交于 \\[\\begin{aligned}c&amp;=\\frac{u_2Q_2/\\chi_{\\rho/2,u_2}^2-u_2Q_2/\\chi_{1-(\\rho/2),u_2}^2}a\\\\d&amp;=\\frac{u_2Q_2/\\chi_{1-(\\rho/2),u_2}^2-u_1Q_1/\\chi_{\\rho/2,u_2}^2}a\\end{aligned}\\] 从而提供 \\(c\\leq\\sigma_1^2\\leq d\\) 作为关于 \\(\\sigma_1^2\\) 的 \\((1 - \\alpha)100\\%\\) 置信区间。c 的值对应于如下两条线相交时 \\(\\sigma_1^2\\) 的值 \\[\\sigma_\\varepsilon^2=u_1Q_1/\\chi_{1-(\\rho/2),u_1}^2\\quad\\mathrm{and}\\quad\\sigma_\\varepsilon^2=-a\\sigma_1^2+u_2Q_2/\\chi_{\\rho/2,u_2}^2\\] d 的值对应于如下两条线相交时 \\(\\sigma_1^2\\) 的值 \\[\\sigma_\\varepsilon^2=u_1Q_1/\\chi_{\\rho/2,u_1}^2\\quad\\mathrm{~and~}\\quad\\sigma_\\varepsilon^2=-a\\sigma_1^2+u_2Q_2/\\chi_{1-(\\rho/2),u_2}^2\\] 图 20.1: \\(\\sigma_{\\varepsilon}^2,\\sigma_1^2\\) 的置信域图 上述关于 \\((\\sigma_{\\varepsilon^{}}^2,\\sigma_1^2)\\) 的联合置信域可用于构造任意关于 \\(\\sigma_{\\varepsilon^{}}^2\\) 和 \\(\\sigma_1^2\\) 的连续函数的置信区间。令 \\(\\varphi(\\sigma_{\\varepsilon^{}}^2,\\sigma_1^2)\\) 表示 \\(\\sigma_{\\varepsilon^{}}^2\\) 和 \\(\\sigma_1^2\\) 在 \\((\\sigma_{\\varepsilon^{}}^2,\\sigma_1^2)\\) 空间上的连续函数，并令 \\(\\mathfrak{R}_\\alpha(\\sigma_{\\varepsilon^{}}^2,\\sigma_1^2)\\) 表示 \\(\\sigma_{\\varepsilon^{}}^2\\) 和 \\(\\sigma_1^2\\) 的联合置信域 (joint confidence region). \\(\\varphi(\\sigma_{\\varepsilon^{}}^2,\\sigma_1^2)\\) 的置信下限为 \\[L=\\min_{(\\sigma_\\varepsilon^2,\\sigma_1^2)\\in\\Re_\\alpha(\\sigma_\\varepsilon^2,\\sigma_1^2)}[\\varphi(\\sigma_\\varepsilon^2,\\sigma_1^2)]\\] \\(\\varphi(\\sigma_{\\varepsilon^{}}^2,\\sigma_1^2)\\) 的置信上限为 \\[U=\\max_{(\\sigma_\\varepsilon^2,\\sigma_1^2)\\in\\Re_\\alpha(\\sigma_\\varepsilon^2,\\sigma_1^2)}[\\varphi(\\sigma_\\varepsilon^2,\\sigma_1^2)]\\] 例如，如果 \\[\\varphi(\\sigma_\\varepsilon^2,\\sigma_1^2)=\\frac{\\sigma_1^2}{\\sigma_\\varepsilon^2+\\sigma_1^2}\\] 最大值出现在 \\((u_1Q_1/\\chi_{1-(\\alpha/2),{u_1}}^2C)\\)，最小值出现在 \\((u_1Q_1/\\chi_{\\alpha/2,u_1}^2,d)\\). 因此，使用示例 20.1 中的数据，得到的 \\(\\frac{\\sigma_1^2}{\\sigma_\\varepsilon^2+\\sigma_1^2}\\) 的置信区间约为 \\[-0.048511&lt;\\frac{\\sigma_1^2}{\\sigma_\\varepsilon^2+\\sigma_1^2}&lt;1.89748\\] 或 \\[0&lt;\\frac{\\sigma_1^2}{\\sigma_\\varepsilon^2+\\sigma_1^2}&lt;1\\] 因为众所周知 \\(\\frac{\\sigma_1^2}{\\sigma_\\varepsilon^2+\\sigma_1^2}\\) 必须大于 0 且小于 1. 当自由度数很小时，最小化和最大化方法可能会导致疯狂的结果，特别是当 \\(\\varphi(\\sigma_\\varepsilon^2,\\sigma_1^2)\\) 是非线性函数时。 Williams (1962) 提出的 \\(\\sigma_1^2\\) 的另一个置信区间具有由下式给出的置信下限和上限： \\[\\begin{aligned}c_1&amp;=\\frac{u_2[Q_2-Q_1F_{\\alpha/2,u_2,u_1}]}{a\\chi_{\\alpha/2,u_2}^2}\\quad\\text{and}\\quad d_1=\\frac{u_2[Q_2-Q_1F_{1-(\\alpha/2),u_2,u_1}]}{a\\chi_{1-(\\alpha/2),u_2}^2}\\end{aligned}\\] 其置信系数至少为 \\(1 - 2\\alpha\\). 模拟研究（Boardman, 1974；以及作者未发表的研究）表明，如果取 \\(\\rho=\\alpha\\) 为而不是 \\(\\rho=1-√(1-\\alpha)\\)，如上所述，第一种程序为 \\(\\sigma_1^2s\\) 提供的置信区间的置信系数不小于 \\(1-\\alpha\\). 类似的模拟表明，Williams 提出的区间的置信系数不小于 \\(1-\\alpha\\). Williams 的区间比 \\(c\\leq\\sigma_1^2\\leq d\\) 刻画的区间稍短。因此 (c, d) 区间比 Williams 区间稍微保守一些。 20.2.6 示例 20.5：均衡单向随机效应处理结构 表 20.12: 示例 20.5 数据 x 表 20.12 中的数据来自单向处理结构，其中从工厂工作的工人总体中随机选择了五名工人。工人的水平是随机效应，研究是在完全随机设计结构下进行的，其中五名工人，每名工人三个观测值，响应是在固定时间段内装配的单元数。可用于刻画这些数据的模型是 \\[y_{ij}=\\mu+iv_i+\\varepsilon_{ij},\\quad i=1,2,\\ldots,5,j=1,2,3,w_i\\thicksim i.i.d.N(0,\\sigma_{w}^2)\\mathrm{~and~}\\varepsilon_{ij}\\thicksim i.i.d.N(0,\\sigma_{\\varepsilon}^2)\\] 表 20.13: 示例 20.5 工人数据的 SAS-Mixed 代码和方差分析表结果 x 表 20.13 提供了包括期望均方的方差分析表。\\(\\sigma_\\varepsilon^2\\) 的 95% 置信区间为 \\[\\frac{16}{20.483}\\leq\\sigma_\\varepsilon^2\\leq\\frac{16}{3.247}\\quad\\mathrm{or}\\quad0.781\\leq\\sigma_\\varepsilon^2\\leq4.928\\] \\(\\sigma_\\varepsilon^2+3\\sigma_w^2\\) 的 95% 置信区间为 \\[\\frac{128}{11.143}\\leq\\sigma_\\varepsilon^2+3\\sigma_w^2\\leq\\frac{128}{0.484}\\quad\\mathrm{or}\\quad11.487\\leq\\sigma_\\varepsilon^2+3\\sigma_w^2\\leq264.463\\] 通过使用这两个区间相交产生的联合置信域，关于 \\(\\sigma_w^2\\) 的近似 95% 置信区间为 \\(c\\leq\\sigma_w^2\\leq d\\)，其中 \\[\\begin{aligned}c&amp;=\\frac{11.487-4.928}3=2.186\\quad\\mathrm{and}\\quad d=\\frac{264.463-0.781}3=87.818\\end{aligned}\\] 因此，可以得到 \\(2.186\\leq\\sigma_w^2\\leq 87.818\\) 作为 \\(\\sigma_w^2\\) 的近似 95% 置信区间。 这种程序可用于构造关于任何方差分量（例如 \\(\\sigma_1^2\\)）的置信区间，当存在两个使得 \\(E(Q_2) = E(Q_1) + \\sigma_1^2\\) 的独立均方 \\(Q_1\\) 和 \\(Q_2\\)，分别基于 u1 和 u2 自由度。令 \\({\\sigma}_0^2=E(Q_1)\\) ，并在之前的开发中用 \\(\\sigma^2_0\\) 替换 \\(\\sigma^2_\\varepsilon\\)；那么 \\(\\sigma_1^2\\) 的 \\((1 - \\alpha)100\\%\\) 近似置信区间为 \\(c\\leq\\sigma_1^2\\leq d\\). Williams (1962) 的结果也适用于这种情况 (Graybill, 1976, 定理 15.3.5). 20.2.7 示例 20.6 为了演示上述更一般的程序，对示例 20.2 中的数据构造了关于 \\(\\sigma_a^2\\) 的 90% 置信区间，其中数据在表 20.2 中，期望均方在表 20.3 中，并且方差分析表数据见表 20.4. 令 \\(Q_2=MSA\\) 且 \\(Q_1=MSAB\\)，两者都基于 1 个自由度。它们的期望分别是 \\[E(Q_1)=\\sigma_\\varepsilon^2+2\\sigma_{ac(b)}^2+4\\sigma_{ab}^2\\quad\\mathrm{~and~}\\quad E(Q_2)=\\sigma_\\varepsilon^2+2\\sigma_{ac(b)}^2+4\\sigma_{ab}^2+8\\sigma_a^2,\\] 令 \\(\\sigma_0^2=\\sigma_\\varepsilon^2+2\\sigma_{ac(b)}^2+4\\sigma_{ab}^2,\\sigma_1^2=\\sigma_a^2\\) 以及 \\(a=8\\). 那么 \\(\\sigma_0^2\\) 的置信限为 \\[\\begin{aligned}c&amp;=\\frac{(1\\times39.0625/3.8415)-(1\\times10.5625/0.00393)}8=-334.69\\\\d&amp;=\\frac{(1\\times39.0625/0.00393)-(1\\times10.5625/3.8415)}8=1242.10\\end{aligned}\\] 或 \\[-334.69\\leq\\sigma_a^2\\leq1242.10\\] 在此示例中，图 20.1 中确定 c 值的两条线在参数空间之外相交，因此下限被截断为零，因此置信区间仅包括参数空间中 \\(\\sigma_a^2\\) 的值。因此，\\(\\sigma_a^2\\) 的置信区间为 \\(0 \\le \\sigma_a^2 \\le 1242.10\\). 类似的技术可用于构造关于 \\(\\sigma_{ab}^2,\\sigma_{ac(b)}^2\\) 和 \\(\\sigma_{c(b)}^2\\) 的置信区间，但不能用于获取关于 \\(\\sigma_b^2\\) 的置信区间。 Burdick and Graybill (1992) 提出了几种可以获得方差分量精确置信区间的情况。他们还提出了方差分量几个函数的近似置信区间。对于每个单元格中观测值数量相等且没有缺失单元格的均衡设计，通常可以获得精确的置信区间。这些区间基于分析中的一组平方和，这些平方和作为独立的卡方随机变量进行分布。Burdick and Graybill (1992) 介绍了 Graybill and Wang (1980), Lu et al. (1989) 以及 Ting et al. (1990) 为方差分量的各种函数开发的置信区间。以下讨论是关于与在完全随机设计结构中进行的均衡单向随机效应处理结构相关的置信区间，Burdick and Graybill 称之为单层嵌套设计 (one-fold nested design). 该模型是 \\[\\begin{aligned}&amp;y_{ij}=\\mu+u_i+\\varepsilon_{ij},\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,n\\\\&amp;u_i\\thicksim i.i.d.N(0,\\sigma_u^2),\\varepsilon_{ij}\\thicksim i.i.d.N(0,\\sigma_\\varepsilon^2)\\end{aligned}\\] 其中 \\(u_i,\\varepsilon_{ij}\\) 为独立随机变量。 该模型的方差分析表基于两个平方和 \\[\\begin{aligned}\\mathrm{SSBetween}&amp;=n\\sum_{i=1}^t{(\\bar{y}_{i\\cdot}-\\bar{y}_{\\cdot\\cdot})^2}=(t-1)Q_1\\\\\\text{SSWithin}&amp;=\\sum_{i=1}^t\\sum_{j=1}^n{(y_{ij}-\\bar{y}_{i\\cdot})^2}=t(n-1)Q_2\\end{aligned}\\] 其中 \\(Q_1\\) 和 \\(Q_2\\) 为各自的均方。与平方和对应的期望均方为 \\[\\begin{aligned}E(\\text{MSBetween})&amp;=E(Q_1)=\\sigma_\\varepsilon^2+n\\sigma_u^2\\quad\\mathrm{~and~}\\quad E(\\text{MSWITHIN})=E(Q_2)=\\sigma_\\varepsilon^2\\end{aligned}\\] 两个平方和是具有如下抽样分布的独立随机变量 \\[\\frac{(t-1)Q_1}{\\sigma_\\varepsilon^2+n\\sigma_u^2}\\thicksim\\chi_{t-1}^2\\quad\\mathrm{and}\\quad\\frac{t(n-1)Q_2}{\\sigma_\\varepsilon^2}\\thicksim\\chi_{t(n-1)}^2\\] \\(\\sigma^2_\\varepsilon\\) 的 95% 精确置信区间为 \\[\\left[\\frac{Q_2}{F_{\\alpha/2,t(n-1),\\infty}}\\leq\\sigma_\\varepsilon^2\\leq\\frac{Q_2}{F_{1-(\\alpha/2),t(n-1),\\infty}}\\right]\\] 其中 \\(F_{\\alpha/2,t(n-1),\\infty}\\) 和 \\(F_{1-(\\alpha/2),t(n-1),\\infty}\\) 为分子分母自由度分别为 \\(t(n-1)\\) 和 \\(\\infty\\) 的 \\(F\\) 分布的上分位数和下分位数。可以注意到 \\(F_{\\alpha/2,t(n-1),\\infty}=\\chi_{\\alpha/2,t(n-1)}^2/[t(n-1)]\\) 以及 \\(F_{1-(\\alpha/2),t(n-1),\\infty}=\\chi_{1-(\\alpha/2),t(n-1)}^2/[t(n-1)]\\). 使用这些分位数表示法，上述关于 \\(\\sigma^2_\\varepsilon\\) 的置信区间与第 20.2.1 节中的区间相同。 由 Burdick and Graybill (1992) 给出的关于 \\(\\sigma^2_u\\) 的 \\((1-\\alpha)100\\%\\) 近似置信区间为 \\[\\left[\\frac{Q_1-Q_2-\\sqrt{V_L}}n\\leq\\sigma_u^2\\leq\\frac{Q_1-Q_2+\\sqrt{V_U}}n\\right]\\] 其中 \\[V_L=G_1^2Q_1^2+H_2^2Q_2^2+G_{12}Q_1Q_2\\quad V_U=H_1^2Q_1^2+G_2^2Q_2^2+H_{12}Q_1Q_2\\] 其中 \\[\\begin{aligned} G_{1} &amp;=1-\\frac1{F_{\\alpha/2,t-1,\\infty}},\\quad G_2=1-\\frac1{F_{\\alpha/2,t(n-1),\\infty}} \\\\ H_{1} &amp;=\\frac1{F_{1-(\\alpha/2),t-1,\\infty}}-1,~H_2=\\frac1{F_{1-(\\alpha/2),t(n-1),\\infty}}-1 \\\\ G_{12} &amp;=\\frac{(F_{\\alpha/2,t-1,t(n-1)}-1)^2-G_1^2F_{\\alpha/2,t-1,t(n-1)}^2-H_2^2}{F_{\\alpha/2,t-1,t(n-1)}} \\\\ H_{12} &amp;=\\frac{(1-F_{1-(\\alpha/2),t-1,t(n-1)})^2-H_1^2F_{1-(\\alpha/2),t-1,t(n-1)}^2-G_2^2}{F_{1-(\\alpha/2),t-1,t(n-1)}} \\end{aligned}\\] 当下界为负时，下限设置为 0. 当 \\(Q_1/Q_2&lt;F_{\\alpha/2,t-1,t(n-1)}\\) 时下界为负。 使用 \\(Q_1/Q_2&gt;F_{\\alpha,t-1,t(n-1)}\\) 作为决策规则来拒绝 \\(H_0{:}\\sigma_u^2=0\\mathrm{~vs~}{H_a}{:}\\sigma_u^2&gt;0\\)，这提供了一个精确检验，是一个一致最有效无偏检验 (uniformly most powerful unbiased test) (Lehmann, 1986). 由 Burdick and Graybill (1992) 给出的关于 \\(\\sigma_\\varepsilon^2+\\sigma_u^2\\) 的近似 \\((1 - \\alpha)100\\%\\) 置信区间为 \\[\\left[\\hat{\\sigma}_\\varepsilon^2+\\hat{\\sigma}_u^2-\\frac{\\sqrt{G_1^2Q_1^2+G_2^2(n-1)Q_2^2}}n\\leq\\sigma_\\varepsilon^2+\\sigma_u^2\\leq\\hat{\\sigma}_\\varepsilon^2+\\hat{\\sigma}_u^2+\\frac{\\sqrt{H_1^2Q_1^2+H_2^2(n-1)Q_2^2}}n\\right]\\] 其中 \\[\\begin{aligned}G_1&amp;=1-\\frac1{F_{\\alpha/2,t-1,\\infty}},\\quad G_2=1-\\frac1{F_{\\alpha/2,t(n-1),\\infty}}\\\\H_1&amp;=\\frac1{F_{1-(\\alpha/2),t-1,\\infty}}-1,\\quad H_2=\\frac1{F_{1-(\\alpha/2),t(n-1),\\infty}}-1\\end{aligned}\\] 组内相关性 \\(\\rho=\\frac{\\sigma_u^2}{\\sigma_e^2+\\sigma_u^2}\\) 的近似 \\((1 - \\alpha)100\\%\\) 置信区间为 \\[\\begin{aligned}\\left[\\frac{L^*-1}{L^*-1+n}\\le\\rho\\le\\frac{U^*-1}{U^*-1+n}\\right]\\end{aligned}\\] 其中 \\[L^*=\\frac{Q_1}{Q_2F_{\\alpha/2,t-1,t(n-1)}}\\quad\\mathrm{and}\\quad U^*=\\frac{Q_1}{Q_2F_{1-(\\alpha/2),t-1,t(n-1)}}\\] 比率 \\(\\sigma_{u}^2/\\sigma_{\\varepsilon}^2\\) 的 \\((1 - \\alpha)100\\%\\) 置信区间由下式给出 \\[\\left[\\frac{L^*-1}n\\leq\\frac{\\sigma_u^2}{\\sigma_\\varepsilon^2}\\leq\\frac{U^*-1}n\\right]\\] Burdick and Graybill (1992) 还描述了当模型中存在两个或多个方差分量时，为均衡和不均衡设计构造关于方差分量和方差分量函数的置信区间的方法。本节的讨论仅限于具有两个方差分量的模型。以下示例用于演示这些置信区间的计算。 20.2.8 示例 20.6 （续） 示例 20.5 的数据用于演示 \\(\\sigma_\\varepsilon^2,\\sigma_w^2,\\sigma_w^2/\\sigma_\\varepsilon^2\\) 和 \\(\\rho\\) 置信区间的计算。两个平方和为 \\(Q_1=32.0,Q_2=1.6\\)，且 \\(n=3, t-1=4,t(n-1)=10,F_{0.025,3,10}=4.46834,F_{0.975,3,10}=0.11307,F_{0.025,3,\\infty}=2.78582,F_{0.025,10,\\infty}=2.04832, -0.11208,H_{12}=-8.15882,V_\\text{L}{ = 4 2 6 . 1 2 9 , V _\\text{U}{ = 5 3 5 1 5 7 1 , L }^{*}=}4.47593\\) 以及 \\(U^{*}=176.878\\). \\(\\sigma_\\varepsilon^2,\\sigma_w^2,\\sigma_w^2/\\sigma_\\varepsilon^2\\) 和 \\(\\rho\\) 的 95% 置信区间分别为 \\([0.78113\\leq\\sigma_{\\varepsilon}^2\\leq4.92767],[3.25237\\leq\\sigma_{w^{}}^2\\leq87.2449],[4.78382\\leq\\sigma_{\\varepsilon}^2+\\sigma_{u}^2\\leq89.1765],[1.15864\\leq(\\sigma_{w^{}}^2/\\sigma_{\\varepsilon}^2)\\leq58.6259]\\) 和 \\([0.53675\\leq\\rho\\leq0.98323]\\). REML 解的 Satterthwaite 类型置信区间显示在表 20.14 中。使用三种方法构造关于 \\(\\sigma^2_w\\) 的置信区间。三个 95% 置信区间是 Burdick and Graybill \\((3.25237\\leq\\sigma_w^2\\leq87.2449)\\), REML \\((3.4964\\leq\\sigma_w^2\\leq99.2870)\\) 以及联合置信域 \\((2.186\\leq\\sigma_w^2\\leq 87.818)\\). 三个区间之间没有太大差异，并且随着方差分量对应的随机效应水平的增加，差异会减小。 表 20.14: 示例 20.5 工人数据的 SAS-Mixed 代码和方差分量的 REML 估计 x 20.3 模拟研究 由于计算置信区间的选项众多，可以使用给定数据的结构进行模拟研究，以提供有关置信区间程序性能的信息。例如，表 20.15 中的信息包含 SAS data step 代码，用于对示例 20.5 中数据集的结构进行模拟，其中每个数据集有五名工人，每个工人有三个观测值。模拟中使用的方差分量值对应于表 20.15 中示例 20.5 的 REML 估计值（请注意，在这种情况下，矩估计与 REML 估计值相同）。模拟结果表明，96.63% 的置信区间覆盖 \\({\\sigma_w^2}\\) 的真实值，95.26% 的置信区间覆盖 \\({\\sigma_\\varepsilon^2}\\) 的真实值。这两个经验置信率都非常接近人们期望的 95% 覆盖率。当数据服从正态分布时，对于这种尺寸的设计，每个 Satterthwaite 置信区间的覆盖率都相当充足。 表 20.15: 用于单向随机效应 Satterthwaite 置信区间覆盖范围检查的模拟代码和结果 x 对于不均衡模型，方差分析表中的平方和并不一定具有独立的卡方分布。因此，用于均衡模型的技术不能直接应用于不均衡模型，否则会违反假设。如果模型不太不均衡，平方和将几乎是独立的卡方随机变量，均衡模型技术应该提供有效的置信区间。对于不均衡模型和大样本量，可以使用最大似然估计及其渐近性质来构造关于方差分量的置信区间。上述示例说明了对于任何给定问题，不同的置信区间可能会有何不同。当设计不均衡且样本量不大时，一种建议是使用最宽的置信区间。评估特定方法有效性的另一种技术是使用模拟。 20.4 结束语 本章介绍关于方差分量和方差分量函数的假设检验和构造置信区间的方法。假设检验是使用平方和方法完成的，其中使用期望均方或使用似然比检验构造检验统计量。基于平方和方法的检验似乎比基于似然比的检验对于小样本量实验具有更好的覆盖范围。SAS-Mixed 提供的置信区间以及其他特殊情况下的置信区间也得到了描述。如第 20.3 节所述，可以通过模拟研究来评估特定置信区间对于给定数据结构的实用性。针对不均衡模型和一些均衡模型的情况，描述了围绕 Satterthwaite 近似值的近似方法。还包括了几个示例来演示这些技术。SAS-Mixed 提供的置信区间对于各个方差分量似乎是足够的，但对于方差分量的非线性函数（如组内相关系数或两个方差分量的比率）的置信区间，则需要专门的方法。 20.5 练习 原文：“then sums of squares obtained by the usual analysis of variance are independently distributed as scalar multiples of chi-square random variables.”↩︎ "],["chap21.html", "第 21 章 案例研究：随机效应模型分析 21.1 数据集 21.2 估计 21.3 模型构建 21.4 缩减模型 21.5 置信区间 21.6 使用 JMP 进行计算 21.7 结束语 21.8 练习", " 第 21 章 案例研究：随机效应模型分析 “The aim of science is to seek the simplest explanation of complex facts… Seek simplicity and distrust it.” - A. N. Whitehead 前三章描述了分析随机效应模型的方法，并提供了一些示例来演示各种分析技术。本章介绍了更复杂实验情况的分析，包括估计、模型构建、假设检验和置信区间估计。 21.1 数据集 在这个实验中，我们研究了多家工厂 (plants) 生产线中工人的工作效率。在公司的工厂中随机挑选了三家。从每一家工厂中，我们又随机挑选了四个装配地点 (sites) 和三个工人 (workers). 我们期望每个工人在他们工厂的每个装配地点工作五次，但由于调度问题和其他优先级，每个工人实际工作的次数各不相同。工人们到达每个地点的顺序是随机的，并且他们尽可能地遵循这个安排。响应变量是组装零件的效率，这是组装单元数量和错误次数的函数。效率得分以及工厂编号、地点编号和工人编号都列在表 21.1 中，其中 EFF_1, EFF_2,…, EFF_5 表示工人可能工作的五天的得分。 表 21.1: 案例研究中的数据，其中 EFF_i 表示工人在某一地点工作的第 i 次时间 x 研究中的所有三个因素都是随机的，地点和工人都位于工厂内。因此，地点和工人效应以及它们的交互作用效应都嵌套在工厂内。用于描述数据的模型，对于 \\(i=1,2,3,j=1,2,3,4,k=1,2,3\\) 和 \\(l=1,\\ldots,n_{ijk}\\) \\[\\begin{align} y_{ijkl}=\\mu+p_i+s_{j(i)}+w_{k(i)}+(sw)_{jk(i)}+\\varepsilon_{ijkl} \\tag{21.1} \\end{align}\\] 其中 \\(p_i\\) 表示第 i 个工厂的效应，\\(s_{j(i)}\\) 表示工厂 i 内第 j 个地点的效应，\\(w_{k(i)}\\) 表示表示工厂 i 内第 k 个工人的效应，\\((sw)_{jk(i)}\\) 表示工厂 i 内地点和工人的交互效应，\\(\\varepsilon_{ijkl}\\) 为残差项。 假设 \\[\\begin{aligned}&amp;p_i\\thicksim i.i.d.N(0,\\sigma_p^2),s_{j(i)}\\thicksim i.i.d.N(0,\\sigma_\\mathrm{s}^2),w_{k(i)}\\thicksim i.i.d.N(0,\\sigma_w^2)\\\\ &amp;sw_{jk(i)}\\thicksim i.i.d.N(0,\\sigma_{sw}^2),\\varepsilon_{ijkl}\\thicksim i.i.d.N(0,\\sigma_\\varepsilon^2),\\end{aligned}\\] 且所有随机变量 \\(p_i,s_{j(i)},w_{k(i)},(sw)_{jk(i)},\\varepsilon_{ijkl}\\) 独立。 21.2 估计 采用 I-III 型平方和、REML、最大似然、MIVQUE0（含和不含 NOBOUND 方法）的矩法估计程序求解方差分量，结果列于表 21.2. 同时附上用于获得 REML 估计的 SAS®-Mixed代码，可通过将特定名称与 Method = 选项结合来选择其他估计技术。表 21.3 和 21.4 给出了 I 型和 III 型平方和的期望均方，可用于构建求取每个方差分量的矩法估计所需的方程。\\(\\sigma_s^2\\) 的 REML, ML 和 MIVQUE0 估计均为零，而包含 nobound 选项的 MIVQUE0 以及 I-III 型 \\(\\sigma_s^2\\) 的解均为负值。通过从不含 nobound 选项的 MIVQUE0 解中将 \\(\\sigma_s^2\\) 的解设为零，得到 MIVQUE0 解。通过将负解转换为 0 来获得方差分量的估计；也就是说，\\(\\sigma_s^2\\) 的估计为 \\(\\hat\\sigma_s^2=0\\). 由于 \\(\\sigma_s^2\\) 的估计为零，下一步将是对模型中的方差分量进行假设检验。可以通过逐步删除过程从模型中删除随机分量，以尝试获得一个更简单的模型来描述过程中的变异。从模型中删除一个项本质上就是将移除的方差分量设置为零。这种模型构建可以针对与处理结构中的因素相对应的任何方差分量进行，但是不会对与设计结构中的因素相对应的方差分量进行模型构建。 表 21.2: 使用 Proc Mixed 中可用的每种方法，为模型 (21.1) 方差分量生成解，其中 MVQ 表示 MIVQUE0，MVQNB 表示 nobound 选项的 MIVQUE。Proc Mixed 代码适用于 Method = REML 方法 x 表 21.3: 带有期望均方的 I 型方差分析表 x 表 21.4: 带有期望均方的 III 型方差分析表 x 21.3 模型构建 基于 I 型平方和的方差分析表用于通过检验有关方差分量的假设来构建模型。该过程从研究与最后一个平方和相关的方差分量开始，然后逐行向上到与第一个平方和相关的方差分量。零假设是方差分量等于零。I 型平方和方法观测到的以及期望均方列于表 21.3 中。 第一步是检验 \\(H_0\\colon{\\sigma}_{sw}^2=0\\text{ vs }H_{a}\\colon{\\sigma}_{sw}^2&gt;0\\). 检查表 21.3 中的期望均方后，残差被确定为适当的除数，因此检验统计量为 \\[F_{C_{\\mathrm{s}w}}=\\frac{MS[worker\\times site(plant)]}{MS(Residual)}=21.42\\left(\\text{which is in Table 2}1.5\\right)\\] 将 \\(F_{C_{\\mathrm{s}w}}\\) 的抽样分布与分子自由度为 18、分母自由度为 82 的 \\(F\\) 分布的分位数进行比较。观察到的显著性水平小于 0.0001，这表明 \\({\\sigma}_{sw}^2\\) 是过程中变异性的重要来源。 下一步是检验 \\(H_0\\colon{\\sigma}_{s}^2=0\\text{ vs }H_{a}\\colon{\\sigma}_{s}^2&gt;0\\). \\(E\\{MS[site(plant)]\\}=\\sigma_\\varepsilon^2+3.4789\\sigma_{sw}^2+9.1928\\sigma_s^2\\) 并且不存在其他期望为 \\(\\sigma_\\varepsilon^2+3.4789\\sigma_{sw}^2\\) 的均方可用作检验统计量的除数。因此，需要根据 \\(MS(Residual)\\) 和 \\(MS[worker\\times site(рlant)]\\) 构建均方 \\(Q_s^*\\)，使得 \\(E(Q_s^*)=\\sigma_\\varepsilon^2+3.4789\\sigma_{sw}^2\\). 这样的 \\(Q_s^*\\) 为 \\[\\begin{aligned} Q_s^*&amp; =3.4789{\\left[\\frac{MS[worker\\times site(plant)]}{2.8569}\\right]}+{\\left[1-\\frac{3.4989}{2.8569}\\right]}MS(Residual) \\\\ &amp;=1.2177MS[worker\\times site(plant)]-0.2177MS(Residual) \\\\ &amp;=128.921 \\end{aligned}\\] 卡方分布可用于近似 \\(r_sQ_s^*/(\\sigma_\\varepsilon^2+3.4789\\sigma_{sw}^2)\\) 的抽样分布，使用 Satterthwaite 近似将确定相关的自由度确定为 \\[\\begin{aligned}r_s&amp;=\\frac{(Q_s^*)^2}{\\frac{\\{1.2177MS[worker\\times site(plant)]\\}^2}{18}+\\frac{[0.2177MS(Residual)]}{82}}\\\\&amp;=\\frac{\\left(128.921\\right)^2}{\\frac{[1.2177\\times106.738]^2}{18}+\\frac{[0.2177\\times4.983]^2}{82}}=17.7\\end{aligned}\\] 检验统计量为 \\[F_{C_s}=\\frac{MS[site(plant)]}{Q_s^*}=0.65\\text{ (see Table 21.5)}\\] 其近似分布为自由度为 9 和 17.7 的 \\(F\\) 分布。观察到的检验显著性水平为 0.7396，这表明 \\({\\sigma}_{s}^2\\) 是过程中可忽略不计的变异源；也就是说，无法拒绝 \\(H_0\\colon{\\sigma}_{s}^2=0\\text{ vs }H_{a}\\colon{\\sigma}_{s}^2&gt;0\\). 表 21.5 和 21.6 包含均方、期望均方、合适的误差项、近似分母自由度以及基于 III 型平方和的检验统计量。用于检验 \\(H_0\\colon{\\sigma}_{s}^2=0\\text{ vs }H_{a}\\colon{\\sigma}_{s}^2&gt;0\\) 的近似 \\(F\\) 统计量为 0.67，分母自由度估计为 18.1，以及观察到的显著性水平为 0.7217. III 型分析中关于 \\({\\sigma}_{s}^2\\) 的结论与 I 型分析中得出的结论相同。由于 site(plant) 是处理结构的一部分，并且 \\({\\sigma}_{s}^2\\) 可以忽略不计，因此一种策略是将 \\({\\sigma}_{s}^2\\) 设置为零，从模型中消除 \\(s_{j(t)}\\) 并根据数据拟合缩减模型。 表 21.5: 方差分量假设的 I 型检验 x 表 21.6: 方差分量假设的 III 型检验 x 21.4 缩减模型 缩减模型为 \\[\\begin{align} y_{ijkl}&amp;=\\mu+p_i+w_{k(i)}+(sw)_{jk(i)}+\\varepsilon_{ijkl}\\\\i&amp;=1,2,3,~j=1,2,3,4,~k=1,2,3,~l=1,\\ldots,n_{ijk} \\tag{21.2} \\end{align}\\] 当从模型中移除 \\(s_{j(i)}\\) 时，SAS-Mixed 将 site(plant) 的平方和与 worker × site(plant) 的平方和合并，如表 21.7 中 worker×site(plant) 的 27 个自由度所示。当 \\({\\sigma}_{s}^2=0\\) 时，由于来自表 21.3 和 21.4 的 \\(MS[site(plant)]\\) 和 \\(MS[worker \\times site(plant)]\\) 的期望均方相似，因此这是一个合理的过程；也就是说，在表 21.3 中，\\(E\\{MS[site(plant)]\\}=\\sigma_\\varepsilon^2+3.4789\\sigma_{sw}^2\\) 和 \\(E\\{MS[worker\\times site(plant)]\\}=\\sigma_\\varepsilon^2+2.8569\\sigma_{sw}^2\\)，在 III 型分析中，系数甚至更接近。 表 21.7: 带期望均方的缩减模型的 I 型方差分析表 x 表 21.7 列出了缩减模型的自由度、I 型均方和期望均方。worker × site(plant) 的期望均方为 \\(\\sigma_\\varepsilon^2+3.0643\\sigma_{sw}^2\\). 此系数通过 \\(3.0643 = [(9 \\times 3.4789) + (18\\times2.8561)/27]\\) 计算，这是 I 型分析中 site(plant) 和 worker × site(plant) 的预期均方的 \\({\\sigma}_{s}^2=0\\) 的合并系数。这种等价性之所以发生，是因为 I 型平方和是序贯性的，因此合并过程是加性的。通过比较表 21.4, 21.6 和 21.8 中的 III 型分析，可以发现这种现象不会发生在其他类型的平方和上。使用 REML、ML MIVQUE0、I-III 型方法的缩减模型的方差分量估计列于表 21.9 中。除了 MIVIQUE0（其值最大，为 6.61）之外，所有方法的残差方差估计大约都等于 4.98。ML 估计的 \\({\\sigma}_{p}^2=0\\) 值最小，为 29.6，而 III 型估计最大，为 58.6. 其他方法的范围在 47.6 到 53.1 之间。由于 plant 只有三个水平，\\({\\sigma}_{p}^2\\) 是最难估计的方差分量；也就是说，与模型中的其他方差分量相比，对 \\({\\sigma}_{p}^2\\) 的了解较少。 \\({\\sigma}_{w}^2\\) 和 \\({\\sigma}_{sw}^2\\) 的估计在不同的估计方法中非常一致，\\({\\hat\\sigma}_{w}^2\\) 的范围为 25.5 至 28.9，\\({\\hat\\sigma}_{sw}^2\\) 的范围为 25.4 至 30.7。 表 21.8: 带期望均方的缩减模型的 III 型方差分析表 x 表 21.9: 缩减模型的方差分量估计 x 可以通过对残差方差分量进行假设检验来继续分析，以确定模型是否可以进一步缩减。用于检验 \\(H_0\\colon{\\sigma}_{sw}^2=0\\mathrm{~vs~}H_a\\colon{\\sigma}_{sw}^2&gt;0\\) 的统计量为 \\[\\begin{aligned}F_{C_{sw}}=\\frac{MS[worker\\times site(plant)]}{MS(Residual)}=19.90\\end{aligned}\\] 其分布为自由度为 27 和 82 的 \\(F\\) 分布。观察到的显著性水平小于 0.0001. 因此，\\({\\sigma}_{sw}^2\\) 是生成数据过程中变异的重要来源并且 \\((sw)_{jk(i)}\\) 应保留在模型中。同样，\\({\\sigma}_{sw}^2\\) 是适应方差分量 (adaption variance component)，其中一些工人在某些地点工作更有效，而其他工人在不同地点工作更有效。根据工人的需求定制每个地点有助于减少系统的变异性。 \\(Q^*_w\\) 需计算用于检验 \\(H_0\\colon{\\sigma}_{w}^2=0\\mathrm{~vs~}H_a\\colon{\\sigma}_{w}^2&gt;0\\). 均方 \\(Q^*_w\\) 根据 \\(MS[worker\\times site(plant)\\) 和 \\(MS(Residual)\\) 构建，使得 \\(E(Q^*_w)=\\sigma_\\varepsilon^2+3.9015\\sigma_{sw}^2\\). 那么 \\[\\begin{aligned} Q _{w}^{*}&amp; =3.9015{\\left[\\frac{MS[site\\times worker(plant)]}{3.0643}\\right]}+{\\left[1-\\frac{3.9015}{3.0643}\\right]}MS(Residual) \\\\ &amp;=1.2732MS[site\\times worker(plant)]-0.2732MS(Residual) \\\\ &amp;=124.9085 \\end{aligned}\\] 检验统计量为 \\(F_{C_w}=456.9419/124.9085=3.66\\)，其分布为具有 6 和 \\(r_w\\) 自由度的 \\(F\\) 分布，其中 \\[\\begin{aligned} r_{w}&amp; =\\frac{(Q_w^*)}{\\{1.2732MS[site\\times worker(plant)]\\}^2/27+[0.2732\\times MS(Residual)]^2/82} \\\\ &amp;=\\frac{(124.9085)^2}{[1.2732\\times99.1752]^2/27+[0.2732\\times4.9831]^2/82} \\\\ &amp;=26.42 \\end{aligned}\\] 该检验统计量的观测显著性水平为 0.0089，表明 \\({\\sigma}_{w}^2\\) 是系统变异的重要组成部分。 最后，需要从 \\(MS[worker(plant)],MS[worker \\times site(plant)]\\) 和 \\(MS(Residual)\\) 构造另一个 \\(Q_p^*\\)，使得 \\[E(Q_p^*)=\\sigma_\\varepsilon^2+3.9277\\sigma_{sw}^2+13.136\\sigma_w^2\\] 以便可以构建统计量来检验 \\(H_0\\colon{\\sigma}_{p}^2=0\\mathrm{~vs~}H_a\\colon{\\sigma}_{p}^2&gt;0\\). 所需的 \\(Q_p^*\\) 为 \\[\\begin{aligned} Q_p^*=&amp; =\\frac{13.136}{13.037}\\{MS[worker(plant)]\\} \\\\ &amp;+\\left[\\frac{3.9277-\\frac{13.136}{13.037}(3.0915)}{3.0643}\\right]\\{MS[site\\times worker(plant)]\\} \\\\ &amp;+\\left[1-\\frac{13.136}{13.037}-\\frac{3.9277-\\frac{13.136}{13.037}(3.0915)}{3.0643}\\right]MS(Residual) \\\\ &amp;=1.0076MS[worker(plant)]-0.0012MS[site\\times worker(plant)]-0.0065MS(Residuаl) \\\\ &amp;=460.2638 \\end{aligned}\\] 检验统计量为 \\[F_{C_p}=\\frac{MS(plant)}{Q_p^*}=5.027\\] 其分布为具有 2 和 \\(r_p\\) 自由度的 \\(F\\) 分布，其中 \\(r_p=(Q_p^*)^2/D_p\\) 以及 \\[\\begin{aligned} D_{p} =&amp;\\frac{\\{1.0076MS[worker(plant)]\\}^2}6+\\frac{\\{0.0012MS[site\\times worker(plant)]\\}^2}{27} \\\\ &amp;+\\frac{\\left[0.0065MS(Residual)\\right]^2}{82}=35,330.281 \\end{aligned}\\] 那么 \\(r_p=5.9961\\). 与此检验相关的观察到的显著性水平为 0.0522，这表明 \\({\\sigma}_{p}^2\\) 是系统变异的重要贡献者，但它不如 \\({\\sigma}_{sw}^2\\) 或 \\({\\sigma}_{w}^2\\) 那么重要。模型 (21.2) 中的所有方差分量在 \\(\\alpha &lt; 0.10\\) 时与零显著不同，并且模型无法进一步缩减。 表 21.8 和 21.10 中的结果来自 III 型平方和。 SAS-Mixed 使用期望均方来计算适当的除数，并使用 Satterthwaite 近似来计算分母自由度。用于检验 \\(H_0\\colon{\\sigma}_{p}^2=0\\mathrm{~vs~}H_a\\colon{\\sigma}_{p}^2&gt;0,H_0\\colon{\\sigma}_{w}^2=0\\mathrm{~vs~}H_a\\colon{\\sigma}_{w}^2&gt;0\\) 和 \\(H_0\\colon{\\sigma}_{sw}^2=0\\mathrm{~vs~}H_a\\colon{\\sigma}_{sw}^2&gt;0\\) 的 III 型平方和分析的显著性水平分别为 0.0357, 0.0040 和小于 0.0001. III 型分析的显著性水平略低于 I 型分析（对于前两个检验），但在其他问题中，III 型分析的显著性水平可能会略高于 I 型分析。表 21.11 包含缩减模型的 REML 分析结果。与plant, worker(plant) 和 worker × site(plant) 方差分量 \\(Z\\) 检验统计量相关的显著性水平分别为 的 0.2118, 0.0869 和 0.0003. 这些显著性水平远大于 I 型和 III 型平方和方法的结果。出现这种情况是因为 \\(Z\\) 检验渐近服从正态随机变量，而在这些情况下，与每个方差分量估计相关联的自由度数量都很小。除非有很多水平与方差分量的估计相关，否则与 \\(Z\\) 值相关的信息对于检验假设没有用处。 表 21.10: 缩减模型方差分量假设的 III 型检验 x plant 方差分量测量工厂总体内工厂之间的差异。由于存在很大的变异性，其中一家工厂很可能制定了适当的程序，使工人能够更有效地工作。worker(plant) 方差分量的重要性表明某些工人比其他工人更有效率，因此培训计划可以帮助提高表现不如其他工人的效率。worker × site(plant) 方差分量是一个适应方差分量，这意味着一些工人更适应在某些地点工作，而在其他地点则表现不佳，另一方面，一些其他工人在之前工人表现不佳的地点上表现出色。 21.5 置信区间 分析的下一步是在方程 (21.2) 中构造关于缩减模型方差分量的置信区间。表 21.11 和 21.12 中显示的结果分别是使用 REML 和 I 型平方和对缩减模型方差分量的估计。使用第 20.2.2 节中的方法计算 REML 解的置信区间，其中 \\(df=2(Z\\text{-}value)^2\\). \\(\\hat{{\\sigma}_p^2},\\hat{{\\sigma}_w^2},\\hat{{\\sigma}_{sw}^2}\\) 的自由度分别为 1.28, 3.70 和 82.10. 表 21.13 包含 REML 置信区间以及以标准差单位表示的区间的计算自由度30。I 型分析计算的置信区间是 20.2.4 节的 Wald 区间（由于区间关于估计对称，且一些下限为负值，因此可以注意到这一点），但对于 \\(\\sigma^2_\\varepsilon\\)，区间是使用 20.2.2 节中的结果，基于 81.93 个自由度计算得出的。基于 I 型平方和的置信区间可以使用第 20.2.2 节的方法重新计算，其中 \\(df=2(Z\\text{-}value)^2\\). 对于 \\({\\hat{\\sigma}_p^2}\\)，由此得到的自由度为 1.4677，提供的 95% 置信区间为 \\([11.2668\\le {\\hat{\\sigma}_p^2} \\le 5984.61]\\). 对于 \\({\\hat{\\sigma}_w^2}\\)，由此得到的自由度为 3.9682，提供的 95% 置信区间为 \\([9.1149\\le {\\hat{\\sigma}_p^2} \\le 212.97]\\). 对于 \\({\\hat{\\sigma}_{sw}^2}\\)，由此得到的自由度为 20.8392，提供的 95% 置信区间为 \\([18.1625\\le {\\hat{\\sigma}_p^2} \\le 62.98]\\). 表 21.14 总结了这些重新计算的置信区间结果。 表 21.11: 缩减模型方差分量的 REML 估计。方差分量的 Satterthwaite 型置信区间 x 表 21.12: 缩减模型方差分量的 I 型平方和估计。非残差方差的 Wald 型置信区间 x 表 21.13: 方差分量的 REML 估计及其计算中所用的自由度，包括区间的标准差和平方根 x 表 21.14: 基于 I 型平方和，使用第 20.2.2 节中的一般 Satterthwaite 近似计算置信区间 x 接下来，使用通常的 Satterthwaite 近似值，根据 I 型平方和的信息，为方差分量提供置信区间。使用 20.2.1 节中的方法构造关于 \\({{\\sigma}_{\\varepsilon}^2}\\) 的置信区间。\\({{\\sigma}_{\\varepsilon}^2}\\) 的 95% 置信区间为 \\[\\frac{82[MS(Residual)]}{\\chi_{(\\alpha/2),82}^2}\\leq\\sigma_\\varepsilon^2\\leq\\frac{82[MS(Residual)]}{\\chi_{1-(\\alpha/2),82}^2}\\] 或 \\[\\frac{82(4.9831)}{108.937}\\leq\\sigma_\\varepsilon^2\\leq\\frac{82(4.9831)}{58.8446}\\] 或 \\[3.781\\leq\\sigma_\\varepsilon^2\\leq6.944\\] 上述关于 \\({{\\sigma}_{\\varepsilon}^2}\\) 的 95% 置信区间与表 21.11 中 Residual 的置信区间相同。 使用表 21.7 中期望均方的 \\({{\\sigma}_{sw}^2}\\) 的 Satterthwaite 置信区间，\\({{\\sigma}_{sw}^2}\\) 的矩法解（和估计）可以表示为 \\[\\hat{\\sigma}_{sw}^2=\\frac{MS[worker\\times site(plant)]}{3.064}-\\frac{MS(Residual)}{3.064}=30.7388\\] 那么 \\(r_{sw}\\hat{\\sigma}_{sw}^2/\\sigma_{sw}^2\\) 近似分布为自由度为 \\(r_{sw}\\) 的卡方随机变量，其中 \\[r_{_{sw}}=\\frac{(\\hat{\\sigma}_{sw}^2)^2}{\\left[\\frac{MS[worker\\times site(plant)]}{3.064}\\right]\\Big/27+\\left[\\frac{MS(Residual)}{3.064}\\right]\\Big/82}=24.33\\] \\({{\\sigma}_{sw}^2}\\) 的一个近似 95% 置信区间为 \\[\\frac{r_{sw}\\hat{\\sigma}_{sw}^2}{\\chi_{.025,24.33}^2}\\leq\\sigma_{sw}^2\\leq\\frac{r_{sw}\\hat{\\sigma}_{sw}^2}{\\chi_{.975,24.33}^2}\\] 或 \\[18.80\\leq\\sigma_{sw}^2\\leq59.17\\] 表 21.15: 缩减模型方差分量假设的 I 型检验 x 为了构造关于 \\(\\sigma_{sw}^2\\) 的置信区间，将 \\(\\hat\\sigma_{sw}^2\\) 的解表示为（从表 21.15 的 Error 项中获得信息） \\[\\begin{aligned}\\hat{\\sigma}_w^2&amp;=\\{MS(worker)-1.2732MS[worker\\times site(plant)]+0.2732MS(Residual)\\}/13.037\\\\&amp;=25.4692\\end{aligned}\\] 与 \\(\\hat\\sigma_{sw}^2\\) 相关的近似自由度为 \\(r_w=3.12\\)，这给出近似 95% 置信区间 \\([8.297\\le \\hat\\sigma_{sw}^2 \\le 327.87]\\). 为了获得关于 \\(\\sigma_{p}^2\\) 的 95% 置信区间，可以使用表 21.15 中的结果将 \\(\\sigma_{p}^2\\) 的估计表示为 \\[ \\begin{aligned} \\hat\\sigma_p^2=&amp;\\{MS(plant)-1.0076MS[worker(plant)]+0.0012MS[worker\\times site(plant)\\\\&amp;+0.0065 MS(Residual)\\}/38.941\\\\ =&amp;47.60 \\end{aligned} \\] 与 \\(\\hat\\sigma_{p}^2\\) 相关的自由度为 \\(r_p=1.27\\). 由此产生的近似 95% 置信区间为 \\([10.58\\le \\sigma_{p}^2 \\le 12078.74]\\). 使用 Satterthwaite 近似计算的置信区间集如表 21.16 所示。 表 21.16: 基于 I 型平方和的通常 Satterthwaite 近似置信区间 x 分析的最后阶段是使用第 20.2 节中的置信域法来构建方差分量 \\(\\sigma^2_p,\\sigma^2_w,\\sigma^2_{sw}\\) 的置信区间。\\(\\sigma^2_{sw}\\) 95% 置信区间的端点 \\(c_{sw},d_{sw}\\) 为 \\[c_{sw}=\\frac{27MS[worker\\times site(plant)]/\\chi_{.025,27}^2-82MS(Residual)/\\chi_{.975,82}^2}{3.064}=17.96\\] 和 \\[d_{sw}=\\frac{27MS[worker\\times site(plant)]/\\chi_{975,27}^2-82MS(Residual)/\\chi_{.025,82}^2}{3.064}=58.74\\] 将这两个表达式简化为一个得到置信区间 \\(17.96\\le \\sigma^2_{sw} \\le 58.74\\). 关于 \\(\\sigma^2_{w}\\) 的 95% 置信区间的两个端点是 \\(c_{w},d_{w}\\)，其中 \\[c_w=\\frac{6MS[worker(plant)]/\\chi_{.025,6}^2-r_wQ_w^*/\\chi_{.975,26.42}^2}{13.037}=-3.335\\] 和 \\[d_w=\\frac{6MS[worker(plant)]/\\chi_{.975,6}^2-r_wQ_w^*/\\chi_{.025,26.42}^2}{13.037}=164.00\\] 其中 \\(r_w=26.42\\) 且 \\(Q^*_w=124.9085\\). 简化这些表达式可以得到区间 \\(0\\leq\\sigma_w^2\\leq164.00\\). 关于 \\(\\sigma^2_{p}\\) 的 95% 置信区间端点是 \\(c_p,d_p\\)，其中 \\[c_p=\\frac{2MS(plant)]/\\chi_{.025,2}^2-r_pQ_p^*/\\chi_{.975,5.9961}^2}{38.941}=-41.2471\\] 和 \\[d_p=\\frac{2MS(plant)]/\\chi_{.975,2}^2-r_pQ_p^*/\\chi_{.025,5.9961}^2}{38.941}=2341.94\\] 其中 \\(r_p=5.9961\\) 且 \\(Q^*_p=460.2638\\). 简化以得到区间 \\(0\\leq\\sigma_p^2\\leq 2431.94\\). 表 21.17 展示了使用置信域法计算的置信区间。 表 21.17: 使用第 20.2.5 节置信域法计算的置信区间总结 x 表 21.18 总结了上述四种计算置信区间的方法，其中表中的条目是各自方差分量的下限和上限。 表 21.18: 四种类型的 95% 置信区间及其上限和下限总结 x 21.6 使用 JMP 进行计算 图 21.1 包含了示例 21 中 JMP® 数据表的一部分，其中 plant, site 和 worker 被指定为名义变量。图 21.2 包含 fit model 界面，其中 plant, site(plant), worker(plant) 和 site×worker(plant) 被指定为随机效应，并选择 REML 方法。图 21.3 显示了完全模型的方差分量估计，包括标准误估计和 95% 置信区间，这与表 21.2 中的 REML 估计相对应。图 21.4 显示了缩减模型的 fit model 界面，其中从图 21.2 的 fit model 界面中移除了 site(plant) 项。图 21.5 中 JMP 的 REML 估计与表 21.11 显示的 SAS-Mixed 估计相同。JMP 中的 fit model 过程为随机效应模型提供了出色的结果。 图 21.1: 示例 21 JMP 数据表的一部分 图 21.2: 示例 21 完全模型的 JMP fit model 界面 图 21.3: 示例 21 的 JMP REML 结果 图 21.4: 示例 21 缩减模型的 JMP fit model 界面 图 21.5: 示例 21 缩减模型的 JMP REML 结果 21.7 结束语 通过这四种方法获得的置信区间存在很大差异，其中方差分量自由度较小的情况下的差异最大。REML 和通常的 Satterthwaite 近似值非常相似，其中对于工厂和工人方差分量，使用 I 型平方和的一般 Satterthwaite 区间和置信域是非常多变的31。在本章中，使用第 19 章中描述的六种估计方法详细分析了复杂的非均衡随机效应模型，以估计方差分量。展示了第 20 章中描述的检验假设和构造置信区间的方法。发现原始模型中的一个方差分量不显著，因此采用模型构建方法提供了充分模型，其中其余方差分量的估计是有意义的。 为了确定不同方法之间可能存在多少差异，应该至少使用两种方法来估计方差分量和构造置信区间，以分析非均衡数据集。如果两种方法都得出相似的结果，那么使用哪种方法都无所谓，可以信任其中任何一种方法。如果结果差异很大，那么应该调查设计的哪些特性导致了这些差异。分析结果使用 SAS-Mixed 和 JMP 的 fit model 过程进行描述。 21.8 练习 原文：Table 21.13 contains the computed degrees of freedom for the REML confi dence intervals as well as intervals that are expressed in standard deviation units.↩︎ 原文：The REML and usual Satterthwaite approximation are quite similar where the general Satterthwaite intervals using the type I sums of squares and confidence regions for the plant and worker variance components are quite variable.↩︎ "],["chap22.html", "第 22 章 混合模型的分析 22.1 混合模型简介 22.2 混合模型随机效应部分的分析 22.3 混合模型固定效应部分的分析 22.4 最佳线性无偏预测 22.5 混合模型方程组 22.6 结束语 22.7 练习", " 第 22 章 混合模型的分析 “Facts speak louder than statistics” - Mr. Justice Streatfield (1950) 混合模型用于刻画来自实验或研究的数据，这些数据需要多个方差-协方差参数，并涉及一些固定效应参数。第 2 章的不等方差模型是混合模型，因为它们涉及多个方差分量。第 18 - 21 章描述的模型称为随机效应模型，但每个模型都有一个未知的均值参数，因此这些模型本质上是混合模型。第 18 章中使用的混合模型的定义围绕着具有固定效应和多个方差分量的一些处理结构。因此，混合模型的一般定义是具有一些固定效应参数和协方差结构中多于一个参数的模型。符合此定义的模型包括随机完全区组模型 (randomized complete blocks models)、不完全区组模型 (incomplete blocks models)、裂区型模型 (split-plot-type models)、条区型模型 (strip-plot-type models)、重复测量型模型 (repeated measures type models)、随机系数模型 (random coefficients models)、多水平模型 (multilevel models) 和分层模型 (hierarchical models). 混合模型包含三部分：1）模型的固定效应部分；2）模型的随机效应部分；3）模型的残差部分。因此，混合模型的分析包括两种类型的分析，一种是模型随机效应和残差部分的分析，另一种是模型固定效应部分的分析。本章讨论混合模型的构建以及分析模型随机效应部分和固定效应部分所需的步骤。本章的结果为理论结果和概念理解之间提供了桥梁。 22.1 混合模型简介 描述同时具有随机效应因子和固定效应因子的实验的模型称为混合模型。由于存在两种类型的因子，因此所得到的模型具有两个部分，随机效应部分和固定效应部分。为了构造这样的模型，使用以下规则来确定特定交互作用是随机效应还是固定效应。 规则：如果主效应是随机效应，则涉及该主效应的任何交互作用也是随机效应。只有那些所有对应的主效应都是固定效应的交互作用才是固定效应。 例如，三向处理结构，其中 A 和 B 的水平为固定效应，C 的水平为随机效应，模型为 \\[y_{ijkm}=\\mu+\\alpha_i+\\beta_j+\\gamma_{ij}+c_k+d_{ik}+f_{jk}+g_{ijk}+\\varepsilon_{ijkm}\\] 其中 \\(\\mu\\) 表示平均响应，\\(\\alpha_i\\) 表示固定因子 A 第 i 个水平的效应，\\(\\beta_j\\) 表示固定因子 B 第 j 个水平的效应，\\(\\gamma_{ij}\\) 表示 A 水平和 B 水平之间交互作用，\\(c_k\\) 表示随机因子 C 第 k 个水平的效应，\\(d_{ik}\\) 表示 A 水平和 C 水平之间的交互作用，\\(f_{jk}\\) 表示 B 水平和 C 水平之间的交互作用，\\(g_{ijk}\\) 表示 A, B, C 水平之间的三向交互作用，\\(\\varepsilon_{ijkm}\\) 表示残差效应。 模型的固定效应部分为 \\(\\mu+\\alpha_i+\\beta_j+\\gamma_{ij}\\)，随机效应部分为 \\(c_k+d_{ik}+f_{jk}+g_{ijk}\\)，残差效应部分为 \\(\\varepsilon_{ijkm}\\). 关于随机效应项和模型残差部分的简单假设如下 \\(c_k\\thicksim i.i.d.N(0,\\sigma_c^2),d_{ik}\\thicksim i.i.d.N(0,\\sigma_d^2),f_{jk}\\sim i.i.d.N(0,\\sigma_f^2),g_{ijk}\\sim i.i.d.N(0,\\sigma_g^2),\\varepsilon_{ijkm}\\sim i.i.d.N(0,\\sigma_\\varepsilon^2)\\) 并且 \\(c_k,d_{ik},f_{jk},g_{ijk},\\varepsilon_{ijkm}\\) 为独立随机变量。A 和 B 之间的交互作用（由 \\(\\gamma_{ij}\\) 表示）是固定效应，而所有其他交互作用都是随机效应，因为它们都涉及由下标 k 表示的随机因子 C. 通常，混合模型还将涉及与设计结构对应的项，但这些项不包括在上述模型中。 一般线性混合模型的矩阵表示是 \\[\\boldsymbol y=\\boldsymbol X\\boldsymbol{\\beta}+\\boldsymbol Z_1\\boldsymbol u_1+\\boldsymbol Z_2\\boldsymbol u_2+\\cdots+\\boldsymbol Z_k\\boldsymbol u_k+\\boldsymbol{\\varepsilon}\\] 其中 \\(\\boldsymbol y\\) 为 N × 1 数据向量，\\(\\boldsymbol X\\boldsymbol{\\beta}\\) 为模型的固定效应部分，\\(\\boldsymbol Z_1\\boldsymbol u_1+\\boldsymbol Z_2\\boldsymbol u_2+\\cdots+\\boldsymbol Z_k\\boldsymbol u_k\\) 为模型的随机效应部分，以及 \\(\\boldsymbol{\\varepsilon}\\) 为模型的残差部分。理想条件为 \\(\\boldsymbol {u}_{i}\\thicksim N(\\boldsymbol0,{\\sigma}_{i}^{2}\\boldsymbol{I}_{n_{i}}),i=1,2,\\ldots,k;\\boldsymbol{\\varepsilon}\\thicksim N(\\boldsymbol{0},{\\sigma}_{\\varepsilon}^{2}\\boldsymbol{I}_{N})\\) 且 \\(\\boldsymbol{u}_i\\left(i=1,2,\\ldots,k\\right),\\boldsymbol \\varepsilon\\) 为独立随机变量。 给定 \\(\\boldsymbol u_1,\\boldsymbol u_2,\\ldots,\\boldsymbol u_k\\) 的 \\(\\boldsymbol y\\) 的条件分布由固定效应模型表示：\\(\\boldsymbol y=\\boldsymbol X\\boldsymbol{\\beta}+\\boldsymbol Z_1\\boldsymbol u_1+\\boldsymbol Z_2\\boldsymbol u_2+\\cdots+\\boldsymbol Z_k\\boldsymbol u_k+\\boldsymbol{\\varepsilon}\\) 其中 \\(\\boldsymbol{\\varepsilon}\\thicksim N(\\boldsymbol{0},{\\sigma}_{\\varepsilon}^{2}\\boldsymbol{I}_{N})\\) 且其中的 \\(\\boldsymbol u_1,\\boldsymbol u_2,\\ldots,\\boldsymbol u_k\\) 为固定效应（因为取了条件）。\\(\\boldsymbol{y}\\) 的边际分布为 \\(\\boldsymbol{y}\\thicksim N(\\boldsymbol{X\\beta},\\boldsymbol{\\Sigma})\\)，或 \\(\\boldsymbol{\\Sigma}={\\sigma}_1^2\\boldsymbol{Z}_1\\boldsymbol{Z}_1&#39;+{\\sigma}_2^2\\boldsymbol{Z}_2\\boldsymbol{Z}_2&#39;+\\cdots+{\\sigma}_k^2\\boldsymbol{Z}_k\\boldsymbol{Z}_k&#39;+{\\sigma}_\\varepsilon^2\\boldsymbol{I}_N\\)，或等价地 \\(\\boldsymbol{y}=\\boldsymbol{X\\beta}+\\boldsymbol{e}\\) 其中 \\(\\boldsymbol{e}\\thicksim N(\\boldsymbol{0},\\boldsymbol{\\Sigma})\\). 混合模型的总体参数为 \\(\\boldsymbol{\\beta},{\\sigma}_1^2,{\\sigma}_2^2,\\ldots,{\\sigma}_k^2\\) 和 \\({\\sigma}_\\varepsilon^2\\). 模型随机效应的分析部分包括方差分量 \\({\\sigma}_1^2,{\\sigma}_2^2,\\ldots,{\\sigma}_k^2\\) 和 \\({\\sigma}_\\varepsilon^2\\) 的估计、检验假设和置信区间的构建。模型固定效应部分的分析包括 \\(\\boldsymbol \\beta\\) 的可估函数的 估计、检验假设和置信区间的构建。 \\(\\boldsymbol y\\) 的这种边际分布基于这样的假设：随机效应的协方差阵是单位阵的标量倍数。混合效应模型更一般的形式是 \\(\\boldsymbol y=\\boldsymbol X\\boldsymbol{\\beta}+\\boldsymbol Z_1\\boldsymbol u_1+\\boldsymbol Z_2\\boldsymbol u_2+\\cdots+\\boldsymbol Z_k\\boldsymbol u_k+\\boldsymbol{\\varepsilon}\\)，其中 \\(\\boldsymbol u_i\\sim N(\\mathbf{0},\\boldsymbol{G}_i),i=1,2,\\ldots,k,\\boldsymbol{\\varepsilon}\\thicksim N(\\mathbf{0},\\boldsymbol{R})\\)，且 \\(\\boldsymbol u_i\\,(i=1,2,\\ldots,k)\\) 和 \\(\\boldsymbol{\\varepsilon}\\) 为独立随机变量。\\(\\boldsymbol y\\) 的边际分布可以用更一般的术语表示为 \\(\\boldsymbol{y}\\thicksim N(\\boldsymbol{X\\beta},\\boldsymbol{\\Sigma})\\) 其中 \\(\\boldsymbol{\\Sigma}=\\boldsymbol{Z}_1\\boldsymbol{G}_1\\boldsymbol{Z}_1^{\\prime}+\\boldsymbol{Z}_2\\boldsymbol{G}_2\\boldsymbol{Z}_2^{\\prime}+\\cdots+\\boldsymbol{Z}_k\\boldsymbol{G}_k\\boldsymbol{Z}_k^{\\prime}+\\boldsymbol{R}\\)，或等价地 \\(\\boldsymbol{y}=\\boldsymbol{X\\beta}+\\boldsymbol{e}\\) 其中 \\(\\boldsymbol{e}\\thicksim N(\\boldsymbol{0},\\boldsymbol{\\Sigma})\\). 理想情况下，矩阵 \\(\\boldsymbol G_1,\\boldsymbol G_1,\\ldots,\\boldsymbol G_k\\) 和 \\(\\boldsymbol R\\) 是正定的，并且包含对随机效应和模型残差部分的协方差结构进行建模所需的参数。混合模型的分析将在接下来的两节中介绍，每节对应一个分析部分。首先考虑模型的随机效应和残差部分的分析。 22.2 混合模型随机效应部分的分析 通过首先拟合模型的固定效应部分，然后计算该模型的残差，可以从一般线性混合模型构建随机效应模型。生成的模型不依赖于模型的固定效应部分。表示为 \\(\\boldsymbol y\\) 边际分布的一般线性混合模型是 \\[\\boldsymbol y=\\boldsymbol X\\boldsymbol{\\beta}+\\boldsymbol e\\quad\\mathrm{where~}\\boldsymbol e\\thicksim N(\\boldsymbol{0},\\boldsymbol{\\Sigma})\\mathrm{~and~}\\boldsymbol{\\Sigma}=\\sigma_1^2\\boldsymbol{Z}_1\\boldsymbol{Z}_1^{\\prime}+\\sigma_2^2\\boldsymbol{Z}_2\\boldsymbol{Z}_2^{\\prime}+\\cdots+\\sigma_k^2\\boldsymbol{Z}_k\\boldsymbol{Z}_k^{\\prime}+\\sigma_\\varepsilon^2\\boldsymbol{I}_N\\] \\(\\boldsymbol \\beta\\) 的（普通）最小二乘估计为 \\(\\boldsymbol{\\hat{\\beta}}=(\\boldsymbol X^{\\prime}\\boldsymbol{X})^-\\boldsymbol{X^{\\prime}}\\boldsymbol{y}\\) 其中 \\((\\boldsymbol X^{\\prime}\\boldsymbol{X})^-\\) 表示 \\(\\boldsymbol X^{\\prime}\\boldsymbol{X}\\) 的 Moore–Penrose 广义逆。残差向量为 \\[\\boldsymbol r=\\boldsymbol y-\\boldsymbol X\\hat{\\boldsymbol{\\beta}}=(\\boldsymbol I-\\boldsymbol X\\boldsymbol X^-)\\boldsymbol y\\] 残差向量的模型（称为残差模型）为 \\[\\boldsymbol r=(\\boldsymbol I-\\boldsymbol X\\boldsymbol X^-)\\boldsymbol Z_1\\boldsymbol u_1+(\\boldsymbol I-\\boldsymbol X\\boldsymbol X^-)\\boldsymbol Z_2\\boldsymbol u_2+\\cdots+(\\boldsymbol I-\\boldsymbol X\\boldsymbol X^-)\\boldsymbol Z_k\\boldsymbol u_k+(\\boldsymbol I-\\boldsymbol X\\boldsymbol X^-)\\boldsymbol{\\varepsilon}\\] 残差模型不依赖于固定效应参数或模型的固定效应部分 \\(\\boldsymbol {Xb}\\)，因此残差模型是随机效应模型。第 18 - 20 章中讨论的随机效应模型分析方法可用于分析残差随机效应模型。矩法、最大似然法、REML 法和 MINQUE 法这四种技术是接下来四小节的主题。第 23 章通过两个例子演示了这些方法，一个是均衡数据集，一个是不均衡数据集。 22.2.1 矩法 正如第 19 章中描述的随机效应模型分析，矩法技术需要计算平方和，确定其期望，然后从方程组中估计方差分量，该方程组通过将观测到的均方与其期望值相等而获得。为了估计方差分量，必须获得其期望值不依赖于模型的混合效应部分的平方和。第 18.3 节讨论的拟合常数的方法提供了这样的平方和：首先拟合模型的固定效应部分，然后拟合随机效应部分。 为了演示混合模型随机效应部分的分析，考虑完全随机设计结构中的双向处理结构，其中一个随机因子用 B 表示，另一个随机因子用 T 表示。得到的双向混合模型为 \\[y_{ijk}=\\mu+\\beta_i+t_j+g_{ij}+\\varepsilon_{ijk}\\quad i=1,2,\\ldots,b\\quad j=1,2,\\ldots,t\\quad k=1,2,\\ldots,n_{ij}\\] 其中假设 \\(t_i \\thicksim i.i.d.N(0,\\sigma_t^2),g_{ij} \\thicksim i.i.d.N(0,\\sigma_g^2)\\) 以及 \\(\\varepsilon_{ijk}\\thicksim i.i.d.N(0,\\sigma_\\varepsilon^2)\\). 从拟合常数方法获得的平方和为 \\(R(\\beta|\\mu),R(t|\\mu,\\beta),R(g|\\mu,\\beta,t)\\) 以及 \\(SSERROR\\). 对于某些常数 \\(k_1,k_2,k_3\\)，最后三个均方的期望值分别具有以下形式 \\[\\begin{aligned}E[MSR(t|\\mu,\\beta)]&amp;=\\sigma_\\varepsilon^2+k_1\\sigma_g^2+k_2\\sigma_\\varepsilon^2\\\\E[MSR(g|\\mu,\\beta,t)]&amp;=\\sigma_\\varepsilon^2+k_3\\sigma_g^2\\\\E[MSERROR]&amp;=\\sigma_\\varepsilon^2\\end{aligned}\\] \\(k_1,k_2,k_3\\) 的值将取决于样本量和数据结构。这些均方期望不涉及固定效应参数，因此均方可用于估计方差分量，也可以用于检验关于它们的假设。 方程组是通过将观测到的均方等于期望均方来构建的，其中 \\(\\tilde{{\\sigma}}_{{\\varepsilon}}^2,\\tilde{{\\sigma}}_t^2\\) 和 \\(\\tilde{{\\sigma}}_g^2\\) 表示解；即， \\[\\begin{aligned} MSR(t|\\mu,\\beta)&amp; =\\tilde{{\\sigma}}_\\varepsilon^2+k_1\\tilde{{\\sigma}}_g^2+k_2\\tilde{{\\sigma}}_\\varepsilon^2 \\\\ MSR(g|\\mu,\\beta,t)&amp; =\\tilde{\\sigma}_\\varepsilon^2+k_3\\tilde{\\sigma}_g^2 \\\\ MSERROR&amp; =\\tilde{{\\sigma}}_\\varepsilon^2 \\end{aligned}\\] 解为 \\[\\begin{aligned} \\tilde{{\\sigma}}_\\varepsilon^2 &amp; =MSERROR \\\\ \\tilde{{\\sigma}}_g^2&amp; =[MSR(g|\\mu,\\beta,t)-\\tilde{\\sigma}_\\varepsilon^2]/k_3 \\\\ \\tilde{{\\sigma}}_t^2&amp;=[MSR(t|\\mu,\\beta)-k_1\\tilde{\\sigma}_g^2-\\tilde{\\sigma}_\\varepsilon^2]/k_2 \\end{aligned}\\] 方差分量的估计为 \\[\\begin{aligned} &amp;\\hat{{\\sigma}}_\\varepsilon^2 =\\tilde{\\sigma}_\\varepsilon^2 \\\\ &amp;\\hat{{\\sigma}}_g^2 =\\begin{cases}\\tilde{{\\sigma}}_g^2&amp;\\mathrm{~if~}\\tilde{{\\sigma}}_g^2\\geq0\\\\0&amp;\\mathrm{~if~}\\tilde{{\\sigma}}_g^2&lt;0&amp;\\end{cases} \\\\ &amp;\\hat{{\\sigma}}_t^2 =\\begin{cases}\\tilde{{\\sigma}}_t^2&amp;\\mathrm{~if~}\\tilde{{\\sigma}}_t^2\\geq0\\\\0&amp;\\mathrm{~if~}\\tilde{{\\sigma}}_t^2&lt;0&amp;\\end{cases} \\end{aligned}\\] 方差分量的近似 \\((1-\\alpha)100\\%\\) 置信区间为 \\[\\frac{df_{\\hat{\\sigma}_r^2}\\hat{\\sigma}_r^2}{\\chi^2_{\\alpha/2,df_{\\hat{\\sigma}_r^2}}}\\leq\\sigma_r^2\\leq\\frac{df_{\\hat{\\sigma}_r^2}\\hat{\\sigma}_r^2}{\\chi^2_{1-(\\alpha/2),df_{\\hat{\\sigma}_r^2}}},\\quad r=t,g,\\varepsilon \\] 其中 \\[df_{\\hat{\\sigma}_\\varepsilon^2}=df_{MSERROR},\\quad df_{\\hat{\\sigma}_s^2}=\\frac{(\\hat{\\sigma}_g^2)^2}{\\frac{\\left[(1/k_3)MSR(g|\\mu,\\beta,t)\\right]^2}{df_{MSR(g|\\mu,\\beta,t)}}+\\frac{[(1/k_3)MSERROR]^2}{df_{MSERROR}}}\\] 以及 \\[df_{\\hat{\\sigma}_t^2}=\\frac{(\\hat{\\sigma}_t^2)^2}{\\frac{\\left[(1/k_3)MSR(t|\\mu,\\beta)\\right]^2}{df_{MSR(t|\\mu,\\beta)}}+\\frac{\\left[(k_1/k_3k_2)MSR(g|\\mu,\\beta,t)\\right]^2}{df_{MSR(g|\\mu,\\beta,t)}}+\\frac{\\left[(1/k_2)(1-(k_1/k_3))MSERROR\\right]^2}{df_{MSERROR}}}\\] 期望均方可用于构建关于模型中方差分量假设的检验。检验 \\(H_{0}\\colon{\\sigma}_{t}^{2}=0\\operatorname{vs}H_{a}\\colon{\\sigma}_{t}^{2}&gt;0\\) 的统计量为 \\[\\begin{aligned}F_{tc}&amp;=\\frac{MSR(t\\mid\\mu,\\beta)}{Q}\\quad\\mathrm{where~}Q=\\frac{k_1}{k_3}MSR(g|\\mu,\\beta,t)+\\left(1-\\frac{k_1}{k_3}\\right)MSERROR\\end{aligned}\\] 其具有近似 \\(F\\) 的抽样分布，分子自由度为 \\(df_{MSR(t|\\mu,\\beta)}\\)，分母自由度为 v，其中 \\[v=\\frac{Q^2}{\\frac{\\left[(k_1/k_3)MSR(g|\\mu,\\beta,t)\\right]^2}{df_{MSR(g|\\mu,\\beta,t)}}+\\frac{\\left[\\left(1-(k_1/k_3)\\right)MSERROR\\right]^2}{df_{MSERROR}}}\\] 由 Satterthwaite 近似确定。 用于检验 \\(H_{0}\\colon{\\sigma}_{g}^{2}=0\\operatorname{vs}H_{a}\\colon{\\sigma}_{g}^{2}&gt;0\\) 的统计量为 \\[F_{gc}=\\frac{MSR(g|\\mu,\\beta,t)}{MSERROR}\\] 其具有近似 \\(F\\) 的抽样分布，分子自由度为 \\(df_{MSR(g|\\mu,\\beta,t)}\\)，分母自由度为 \\(df_{MSERROR}\\). 22.2.2 最大似然方法 最大似然方法可应用于完全似然函数，记作 \\(L(\\boldsymbol{\\beta},\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2,\\sigma_\\varepsilon^2)=(2\\pi)^{-n/2}|\\boldsymbol{\\Sigma}|^{-1/2}\\exp[-\\frac12(\\boldsymbol{y}-\\boldsymbol X\\boldsymbol{\\beta})^{\\prime}\\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{y}-\\boldsymbol X\\boldsymbol{\\beta})]\\). 关于所有参数最大化该似然函数或等价地最小化 \\(-2\\log[L(\\boldsymbol{\\beta},\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2,\\sigma_\\varepsilon^2)]\\)，提供了用于同时估计固定参数和随机效应参数的方程组 (Hartley and Rao, 1967). 所需的方程组为 \\[\\left.\\frac{\\partial l}{\\partial\\boldsymbol\\beta}\\right|_{\\boldsymbol\\beta=\\hat{\\boldsymbol\\beta},\\sigma=\\hat{\\sigma}}=0,\\quad\\left.\\frac{\\partial l}{\\partial\\sigma_1^2}\\right|_{\\boldsymbol\\beta=\\hat{\\boldsymbol\\beta},\\sigma=\\hat{\\sigma}}=0,\\quad\\left.\\frac{\\partial l}{\\partial\\sigma_2^2}\\right|_{\\boldsymbol\\beta=\\hat{\\boldsymbol\\beta},\\sigma=\\hat{\\sigma}}=0,\\ldots,\\quad\\left.\\frac{\\partial l}{\\partial\\sigma_k^2}\\right|_{\\boldsymbol\\beta=\\hat{\\boldsymbol\\beta},\\sigma=\\hat{\\sigma}}=0,\\quad\\left.\\frac{\\partial l}{\\partial\\sigma_\\varepsilon^2}\\right|_{\\boldsymbol\\beta=\\hat{\\boldsymbol\\beta},\\sigma=\\hat{\\sigma}}=0\\] 其中 \\(l=-2\\log[L(\\boldsymbol{\\beta},{\\sigma}_1^2,{\\sigma}_2^2,\\ldots,{\\sigma}_k^2,{\\sigma}_\\varepsilon^2)],{\\sigma}^{\\prime}=[{\\sigma}_1^2,{\\sigma}_2^2,\\ldots,{\\sigma}_k^2,{\\sigma}_\\varepsilon^2]\\) 以及 \\(\\hat{{\\sigma}}^{\\prime}=[\\hat{{\\sigma}}_1^2,\\hat{{\\sigma}}_2^2,\\ldots,\\hat{{\\sigma}}_k^2,\\hat{{\\sigma}}_\\varepsilon^2]\\). 具有相等观测次数的双向混合模型用于演示最大似然估计的计算。该模型可以表示为 \\[y_{ijk}=\\mu_i+a_j+g_{ij}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,a,\\quad k=1,2,\\ldots,n\\] 其中 \\(\\mu_i\\) 表示固定效应因子 T 第 i 个水平的均值，\\(\\alpha_j\\) 表示随机效应因子 A 的第 j 个水平的效应，\\(\\gamma_{ij}\\) 表示随机相互作用效应，\\(\\varepsilon_{ijk}\\) 表示残差效应。在理想条件下，\\(a_j\\thicksim i.i.d.N(0,\\sigma_a^2),g_{ij}\\thicksim i.i.d.N(0,\\sigma_g^2),\\varepsilon_{ijk}\\thicksim i.i.d.N(0,\\sigma_e^2)\\)，且 \\(a_j,g_{ij},\\varepsilon_{ijk}\\) 为独立随机变量。数据向量的方差为 \\[\\begin{aligned} \\boldsymbol{\\Sigma}=&amp;\\,{\\sigma}_a^2[\\boldsymbol{J}_n\\otimes\\boldsymbol{I}_a\\otimes\\boldsymbol{J}_t]+{\\sigma}_g^2[\\boldsymbol{J}_n\\otimes\\boldsymbol{I}_a\\otimes\\boldsymbol{I}_t]+{\\sigma}_\\varepsilon^2[\\boldsymbol{I}_n\\otimes\\boldsymbol{I}_a\\otimes\\boldsymbol{I}_t] \\\\ =&amp;\\,(\\sigma_\\varepsilon^2+n\\sigma_g^2+nt\\sigma_a^2)\\left[\\frac1{n}\\boldsymbol J_n\\otimes \\boldsymbol I_a\\otimes\\frac1t\\boldsymbol J_t\\right]+(\\sigma_\\varepsilon^2+n\\sigma_g^2)\\left[\\frac1{n}\\boldsymbol J_n\\otimes \\boldsymbol I_a\\otimes(\\boldsymbol I_t-\\frac1t\\boldsymbol J_t)\\right] \\\\ &amp;+\\sigma_\\varepsilon^2\\left[(\\boldsymbol I_n-\\frac1n\\boldsymbol J_n)\\otimes \\boldsymbol I_a\\otimes \\boldsymbol I_t\\right] \\\\ =&amp;\\,\\lambda_1\\boldsymbol V_1+\\lambda_2\\boldsymbol V_2+\\lambda_3\\boldsymbol V_3\\text{ (say)} \\end{aligned}\\] 其中 \\(\\lambda_1=\\sigma_\\varepsilon^2+n\\sigma_g^2+nt\\sigma_a^2,\\lambda_2=\\sigma_\\varepsilon^2+n\\sigma_g^2,\\lambda_3=\\sigma_\\varepsilon^2\\) 以及 \\(\\boldsymbol V_1,\\boldsymbol V_2,\\boldsymbol V_3\\) 为幂等阵且两两正交。记号 \\(\\boldsymbol A\\otimes \\boldsymbol B\\) 表示矩阵 \\(\\boldsymbol A,\\boldsymbol B\\) 的直积 (direct product) (Graybill 1976). 因此，\\(|\\boldsymbol{\\Sigma}|=\\lambda_1^{a}\\lambda_2^{a(t-1)}\\lambda_3^{at(n-1)}\\) 且 \\(\\boldsymbol{\\Sigma}^{-1}=(1/\\lambda_1)\\boldsymbol{V}_1+(1/\\lambda_2)\\boldsymbol{V}_2+(1/\\lambda_3)\\boldsymbol{V}_3\\). \\(l=-2\\log (L)\\) 的值可表示为 \\(l=nta\\log(2\\pi)+a\\log(\\lambda_1)+a(t-1)\\log(\\lambda_2)+at(n-1)\\log(\\lambda_3)+Q\\) 其中 \\(Q=[\\boldsymbol{y}-(\\boldsymbol{j}_n\\otimes\\boldsymbol{j}_a\\otimes\\boldsymbol{I}_t)\\boldsymbol{\\mu}]&#39;\\boldsymbol{\\Sigma}^{-1}[\\boldsymbol{y}-(\\boldsymbol{j}_n\\otimes\\boldsymbol{j}_a\\otimes\\boldsymbol{I}_t)\\boldsymbol{\\mu}]\\). 使用一些代数计算，并利用上述关系，\\(Q\\) 的值可以表示为 \\[Q=\\frac1{\\lambda_1}\\boldsymbol y^{\\prime}\\boldsymbol A_1\\boldsymbol y+\\frac1{\\lambda_2}\\boldsymbol y^{\\prime}\\boldsymbol A_2\\boldsymbol y+\\frac1{\\lambda_3}\\boldsymbol y^{\\prime}\\boldsymbol A_3\\boldsymbol y+\\frac1{\\lambda_1}nat(\\bar{y}_{\\cdot\\cdot\\cdot}-\\bar{\\mu}_{\\cdot})^2+\\frac{na}{\\lambda_2}\\sum_{i=1}^t(\\bar{y}_{i\\cdot\\cdot}-\\bar{y}_{\\cdot\\cdot\\cdot}+\\bar{\\mu}_{\\cdot}-\\mu_{i})^2\\] 其中 \\[\\begin{aligned} &amp;\\boldsymbol{y^{\\prime}}\\boldsymbol A_1\\boldsymbol{y} \\left.=\\boldsymbol y^{\\prime}{\\left[\\frac1n\\boldsymbol J_n\\right.}\\otimes\\left(\\boldsymbol I_a-\\frac1a\\boldsymbol J_a\\right)\\otimes\\frac1t\\boldsymbol J_t\\right]\\boldsymbol{y}=SSA \\\\ &amp;\\boldsymbol{y&#39;A}_2\\boldsymbol{y} \\left.=\\boldsymbol y^{\\prime}{\\left[\\frac1n\\boldsymbol J_n\\right.}\\otimes\\left(\\boldsymbol I_a-\\frac1a\\boldsymbol J_a\\right)\\otimes\\left(\\boldsymbol I_t-\\frac1t\\boldsymbol J_t\\right)\\right]\\boldsymbol{y}=SSTA \\\\ &amp;\\boldsymbol{y&#39;A_3}\\boldsymbol{y} =\\boldsymbol y^{\\prime}\\bigg[\\left(\\boldsymbol I_n-\\frac1n\\boldsymbol J_n\\right)\\otimes \\boldsymbol I_a\\otimes \\boldsymbol I_t\\bigg]\\boldsymbol{y}=SSERROR \\end{aligned}\\] \\(-2 \\log(\\text{likelihood})\\) 的值可以表示为 \\[\\begin{aligned} l =&amp;\\,nta\\log(2\\pi)+a\\log(\\lambda_1)+a(t-1)\\log(\\lambda_2)+at(n-1)\\log(\\lambda_3) \\\\ &amp;+\\frac1{\\lambda_3}SSERROR+\\frac1{\\lambda_1}SSA+\\frac1{\\lambda_2}SSTA+\\frac1{\\lambda_1}nat(\\bar{y}_{\\cdot\\cdot\\cdot}-\\bar{\\mu}_{\\cdot})^2 \\\\ &amp;+\\frac{na}{\\lambda_2}\\sum_{i=1}^{t}(\\bar{y}_{i\\cdot\\cdot}-\\bar{y}_{\\cdot\\cdot\\cdot}+\\bar{\\mu}_{\\cdot}-\\mu_i)^2 \\end{aligned}\\] 接下来，关于 \\(\\lambda_1,\\lambda_2,\\lambda_3,\\bar\\mu_{\\cdot}\\) 和 \\((\\mu_i-\\bar\\mu_{\\cdot})\\) 对 \\(l\\) 进行求导，并将导数设置为零，以提供方程组： \\[\\begin{aligned} &amp;\\left.\\frac{\\partial l}{\\partial\\lambda_3}\\right|_{{\\mu}=\\hat{{\\mu}},{\\lambda}=\\hat{{\\lambda}}} =-\\frac{at(n-1)}{\\hat{\\lambda}_3}+\\frac{SSERROR}{\\hat{\\lambda}_3^2}=0\\Longrightarrow\\hat{\\lambda}_3^2=\\frac{SSERROR}{at(n-1)}=\\hat{\\sigma}_\\varepsilon^2 \\\\ &amp;\\left.\\frac{\\partial l}{\\partial\\lambda_2}\\right|_{{\\mu}=\\hat{{\\mu}},{\\lambda}=\\hat{{\\lambda}}} =-\\frac{a(n-1)}{\\hat{\\lambda}_2}+\\frac{SSTA}{\\hat{\\lambda}_2^2}=0\\Longrightarrow\\hat{\\lambda}_2^2=\\frac{SSTA}{a(n-1)} \\\\ &amp;\\left.\\frac{\\partial l}{\\partial\\lambda_1}\\right|_{{\\mu}=\\hat{{\\mu}},{\\lambda}=\\hat{{\\lambda}}} =-\\frac a{\\hat{\\lambda}_1}+\\frac{SSA}{\\hat{\\lambda}_1^2}=0\\Longrightarrow\\hat{\\lambda}_1^2=\\frac{SSA}a \\\\ &amp;\\left.\\frac{\\partial l}{\\partial\\bar{\\mu}.}\\right|_{{\\mu}=\\hat{{\\mu}},{\\lambda}=\\hat{{\\lambda}}} =\\frac{-2nat(\\bar{y}_{\\cdot\\cdot\\cdot}-\\hat{\\bar{\\mu}}_{\\cdot\\cdot\\cdot})}{\\hat{\\lambda}_1^2}=0\\Longrightarrow\\hat{\\bar{\\mu}}_{\\cdot\\cdot\\cdot}=\\bar{y}_{\\cdot\\cdot\\cdot} \\end{aligned}\\] 以及 \\[\\left.\\frac{\\partial l}{\\partial\\mu_i-\\bar{\\mu}_{\\cdot}}\\right|_{{\\mu}=\\hat{{\\mu}},{\\lambda}=\\hat{{\\lambda}}}=\\frac{-2na(\\bar{y}_{i\\cdot\\cdot}-\\bar{y}_{\\cdot\\cdot\\cdot}+(\\hat{\\mu}_i-\\hat{\\bar{\\mu}}_\\cdot))}{\\hat{\\lambda}_2}=0\\Longrightarrow(\\hat{\\mu}_i-\\hat{\\bar{\\mu}}_{\\cdot})=\\bar{y}_{i\\cdot\\cdot}-\\bar{y}_{\\cdot\\cdot\\cdot}\\] 或 \\(\\hat{\\bar{{\\mu}}_i}=\\bar{y}_{i\\cdot\\cdot}\\). 利用 \\(\\lambda_1=\\sigma_\\varepsilon^2+n\\sigma_g^2+nt\\sigma_a^2,\\lambda_2=\\sigma_\\varepsilon^2+n\\sigma_g^2\\) 以及 \\(\\lambda_3=\\sigma_\\varepsilon^2\\) 的事实，方差分量的最大似然估计为： \\[\\hat{\\sigma}_\\varepsilon^2=\\hat{\\lambda}_g,\\quad\\hat{\\sigma}_g^2=\\begin{cases}\\dfrac{\\hat{\\lambda}_2-\\hat{\\lambda}_3}n&amp;\\mathrm{if~}\\hat{\\lambda}_2\\geq\\hat{\\lambda}_3\\\\0&amp;\\mathrm{if~}\\hat{\\lambda}_2&lt;\\hat{\\lambda}_3\\end{cases},\\quad\\mathrm{and}\\quad\\hat{\\sigma}_a^2=\\begin{cases}\\dfrac{\\hat{\\lambda}_1-\\hat{\\lambda}_2}{nt}&amp;\\mathrm{if~}\\hat{\\lambda}_1\\geq\\hat{\\lambda}_2\\\\0&amp;\\mathrm{if~}\\hat{\\lambda}_1&lt;\\hat{\\lambda}_2\\end{cases}\\] 请注意，\\(\\hat{\\sigma}_\\varepsilon^2\\) 是 \\({\\sigma}_\\varepsilon^2\\) 的无偏估计，而 \\(\\hat{\\sigma}_a^2,\\hat{\\sigma}_g^2\\) 分别为 \\({\\sigma}_a^2,{\\sigma}_g^2\\) 的有偏估计。 22.2.3 残差最大似然法 Corbeil and Searle (1976) 将似然函数分为两部分，一部分涉及固定效应，另一部分不包含固定效应。然后，他们从没有固定效应的模型部分获得了方差分量的最大似然估计，他们将其称为受限最大似然估计 (restricted maximum likelihood estimators) 或 REML 估计。为了说明这一点，请再次考虑一般线性混合模型 \\(\\boldsymbol y=\\boldsymbol X\\boldsymbol{\\beta}+\\boldsymbol Z_1\\boldsymbol u_1+\\boldsymbol Z_2\\boldsymbol u_2+\\cdots+\\boldsymbol Z_k\\boldsymbol u_k+\\boldsymbol{\\varepsilon}\\) 以及第 22.1 节中给出的通常假设。假设 \\(\\boldsymbol X\\) 的秩为 p. 为了构造受限似然函数，令 \\(H\\) 为秩为 N-p 的 N × (N - p) 矩阵，使得 \\(\\boldsymbol {HH}^\\prime = (\\boldsymbol I - \\boldsymbol X\\boldsymbol X^- )\\)。定义变换 \\[\\boldsymbol z=\\begin{bmatrix}\\boldsymbol z_1\\\\\\boldsymbol z_2\\end{bmatrix}=\\begin{bmatrix}\\boldsymbol X^{\\prime}\\\\\\boldsymbol H^{\\prime}\\end{bmatrix}\\boldsymbol y\\] 其中 \\[\\begin{bmatrix}\\boldsymbol X^{\\prime}\\\\\\boldsymbol H^{\\prime}\\end{bmatrix}\\] 为 N × N 非奇异矩阵。因此从 \\(\\boldsymbol y\\) 到 \\(\\boldsymbol z\\) 的变换是一对一的变换。 \\[\\boldsymbol z=\\begin{bmatrix}\\boldsymbol{z}_1\\\\\\boldsymbol{z}_2\\end{bmatrix}\\] 的分布为 \\[\\left.\\begin{bmatrix}\\boldsymbol z_1\\\\\\boldsymbol z_2\\end{bmatrix}\\thicksim N\\left[\\begin{bmatrix}\\boldsymbol X^{\\prime}\\boldsymbol X\\boldsymbol{\\beta}\\\\\\boldsymbol 0\\end{bmatrix}\\right.,\\begin{bmatrix}\\boldsymbol X^{\\prime}\\boldsymbol{\\Sigma}\\boldsymbol X&amp;\\boldsymbol X^{\\prime}\\boldsymbol{\\Sigma}\\boldsymbol H\\\\\\boldsymbol H^{\\prime}\\boldsymbol{\\Sigma}\\boldsymbol X&amp;\\boldsymbol H^{\\prime}\\boldsymbol{\\Sigma}\\boldsymbol H\\end{bmatrix}\\right]\\] \\[\\boldsymbol z=\\begin{bmatrix}\\boldsymbol{z}_1\\\\\\boldsymbol{z}_2\\end{bmatrix}\\] 可以分解为给定 \\(\\boldsymbol z_2\\) 下 \\(\\boldsymbol z_1\\) 的似然乘以 \\(\\boldsymbol z_2\\) 的边际似然。\\(\\boldsymbol z_2\\) 的边际似然不取决于模型的固定效应参数，而是取决于方差分量。\\(\\boldsymbol z_2\\) 的边际似然为 \\[L_{\\boldsymbol H}(\\boldsymbol z_2)=L_{\\boldsymbol H}(\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2,\\sigma_\\varepsilon^2)=(2\\pi)^{-(n-p)/2}|\\boldsymbol{H^{\\prime}\\Sigma H}|^{-1/2}\\exp\\left[-\\frac12\\boldsymbol{yH}(\\boldsymbol H^{\\prime}\\boldsymbol \\Sigma \\boldsymbol H)^{-1}\\boldsymbol H^{\\prime}\\boldsymbol y\\right]\\] 方差分量的 REML 估计是使 \\(L_{\\boldsymbol H}(\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2,\\sigma_\\varepsilon^2)\\) 最大化的 \\(\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2,\\sigma_\\varepsilon^2\\) 的值。该受限似然函数适用于随机向量 \\(\\boldsymbol z_2\\). 但固定效应模型的残差（参见第 22.2 节开头）可以表示为 \\(\\boldsymbol r = \\boldsymbol H \\boldsymbol z_2\\)，即 \\(\\boldsymbol z_2\\) 的变换。因此，受限似然函数利用了残差模型中不依赖于固定效应的信息，或者说 受限似然是模型残差的函数。因此，为此方法选择的名称是残差最大似然。最大化 \\(l_R=\\log[L_{\\boldsymbol H}(\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2,\\sigma_\\varepsilon^2)]\\) 的过程产生了一组需要求解的方程。不能保证方程组的解会提供一个位于参数空间中的解集。再次强调，获得方差分量的非负估计是很重要的，因为这些估计用于分析模型的固定效应部分。 在重新审视第 22.2.2 节中描述的均衡双向混合模型时，似然函数可表示为 \\[\\begin{aligned} L(\\mu,\\lambda_1,\\lambda_2,\\lambda_3) =&amp;\\,\\left[\\left((2\\pi)^{1/2}\\lambda_1^{1/2}\\right)^{-1}\\exp\\biggl(-\\frac{nat}{2\\lambda_1}(\\bar{y}_{\\cdot\\cdot\\cdot}-\\bar{\\mu}_{\\cdot})^2\\biggr)\\biggr]\\times\\biggl[(2\\pi)^{(t-1)/2}\\lambda_2^{(t-1)/2}\\biggr]^{-1}\\right. \\\\ &amp;\\times\\exp\\left[-\\frac{na}{2\\lambda_2}\\sum_{i=1}^t(\\bar{y}_{i\\cdot\\cdot}-\\bar{y}_{\\cdot\\cdot\\cdot}-\\mu_i+\\bar{\\mu}_{\\cdot})^2\\right]\\times\\left[(2\\pi)^{(nat-t)/2}\\lambda_1^{(a-1)/2}\\lambda_2^{(a-1)(t-1)/2}\\lambda_3^{at(n-1)/2}\\right]^{-1} \\\\ &amp;\\times\\exp\\left[-\\frac12{\\left(\\frac{SSERROR}{\\lambda_3}+\\frac{SSA}{\\lambda_1}+\\frac{SSTA}{\\lambda_2}\\right)}\\right] \\\\ =&amp;\\,L(\\bar{\\mu}_\\cdot)\\times L(\\mu_i-\\bar{\\mu}_\\cdot)\\times L(\\lambda_1,\\lambda_2,\\lambda_3)\\mathrm{~(say)} \\end{aligned}\\] \\(\\lambda_1,\\lambda_2,\\lambda_3\\) 的 REML 估计通过最小化 \\(-2\\log[L(\\lambda_1,\\lambda_2,\\lambda_3)]\\) 获得，这是通过对 \\(l_R\\) 关于 \\(\\lambda_1,\\lambda_2,\\lambda_3\\) 求导并将导数设置为零来实现的。导数和解是 \\[\\begin{aligned} &amp;\\left.\\frac{\\partial l_R}{\\partial\\lambda_1}\\right|_{\\lambda=\\hat{\\lambda}} =\\frac{(a-1)}{\\hat{\\lambda}_1}-\\frac{SSA}{\\hat{\\lambda}_1^2}=0\\Rightarrow\\hat{\\lambda}_1=\\frac{SSA}{a-1} \\\\ &amp;\\left.\\frac{\\partial l_R}{\\partial\\lambda_2}\\right|_{\\lambda=\\hat{\\lambda}} =\\frac{(a-1)(t-1)}{\\hat{\\lambda}_2}-\\frac{SSTA}{\\hat{\\lambda}_2^2}=0\\Rightarrow\\hat{\\lambda}_2=\\frac{SSTA}{(a-1)(t-1)} \\\\ &amp;\\left.\\frac{\\partial l_R}{\\partial\\lambda_3}\\right|_{\\lambda=\\hat{\\lambda}} =\\frac{at(n-1)}{\\hat{\\lambda}_3}-\\frac{SSERROR}{\\hat{\\lambda}_3^2}=0\\Rightarrow\\hat{\\lambda}_3=\\frac{SSERROR}{at(n-1)} \\end{aligned}\\] 方差分量的估计计算如下： \\[\\hat{\\sigma}_\\varepsilon^2=\\hat{\\lambda}_3,\\quad\\hat{\\sigma}_g^2=\\begin{cases}\\frac{\\hat{\\lambda}_2-\\hat{\\lambda}_3}n&amp;\\mathrm{~if~}\\hat{\\lambda}_2\\geq\\hat{\\lambda}_3\\\\0&amp;\\mathrm{~if~}\\hat{\\lambda}_2&lt;\\hat{\\lambda}_3\\end{cases},\\quad\\mathrm{~and~}\\quad\\hat{\\sigma}_a^2=\\begin{cases}\\frac{\\hat{\\lambda}_1-\\hat{\\lambda}_2}n&amp;\\mathrm{~if~}\\hat{\\lambda}_1\\geq\\hat{\\lambda}_2\\\\0&amp;\\mathrm{~if~}\\hat{\\lambda}_1&lt;\\hat{\\lambda}_2&amp;\\end{cases}\\] REML 估计是方差分量的无偏估计，它们与使用矩法获得的估计相同。 22.2.4 MINQUE 法 随机模型的 MINQUE 法在第 19.3 节中描述。在该应用中，模型的均值为 \\(\\boldsymbol j_n\\mu\\)，而该混合模型的均值为 \\(\\boldsymbol{Xb}\\). 该估计可以推广到一般线性混合模型 (Swallow and Searle, 1978)，其中 \\(\\boldsymbol \\sigma=(\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2,\\sigma_\\varepsilon^2)^{\\prime}\\) 的 MINQUE 估计为 \\(\\boldsymbol{\\hat{\\sigma}}=\\boldsymbol{S}^{-1}\\boldsymbol{q}\\) 其中矩阵 \\(\\boldsymbol S\\) 的元素为 \\(s_{ii^{\\prime}}=\\mathrm{tr}[\\boldsymbol{Z}_i\\boldsymbol{Z}_i^{\\prime}\\boldsymbol{R}\\boldsymbol{Z}_{i^{\\prime}}\\boldsymbol{Z}_i^{\\prime}],i,i^{\\prime}=1,2,\\ldots,k+1\\)，其中 \\(i=k+1\\) 对应于 \\(\\boldsymbol \\varepsilon\\) 以及 \\(\\boldsymbol Z_{k+1}=\\boldsymbol I_n\\)， \\[\\boldsymbol R=\\boldsymbol{\\Sigma}^{-1}[\\boldsymbol I_n-\\boldsymbol{X}(\\boldsymbol X^{\\prime}\\boldsymbol{\\Sigma}^{-1}\\boldsymbol{X})^-\\boldsymbol{X}^{\\prime}]\\boldsymbol{\\Sigma}^{-1}\\] 以及 \\(\\boldsymbol q\\) 的元素为 \\(\\boldsymbol{q}_i=\\boldsymbol{y}^{\\prime}\\boldsymbol{R}\\boldsymbol{Z}_i\\boldsymbol{Z}_i^{\\prime}\\boldsymbol{R}\\boldsymbol{y},{i}=1,{2},\\ldots,{k}+1\\). 解取决于 \\(\\boldsymbol \\Sigma\\) 的元素，对于 MINQUE 解，通常选择方差为 1，协方差为 0. 如果模型是均衡的，解通常不依赖于为 \\(\\boldsymbol \\Sigma\\) 选择的值，并且过程在一次迭代中收敛。不能保证系统的解提供参数空间中的值。请确保使用提供非负估计值的解，因为需要在分析模型的固定部分时使用这些估计。一次迭代 (One-iteration) MINQUE 估计在一些软件包中实现（称为零迭代 (zero iteration)），第 23 章中讨论的两个例子用此估计进行了计算。 22.3 混合模型固定效应部分的分析 混合模型固定效应部分的分析包括如下所述的模型固定效应部分分析的所有方面。 22.3.1 估计 有多种方法可以估计混合模型中 \\(\\boldsymbol \\beta\\) 的可估函数。一般线性混合模型可表示为 \\[\\boldsymbol y=\\boldsymbol X\\boldsymbol{\\beta}+\\boldsymbol \\varepsilon\\quad\\mathrm{~where~Var}(\\boldsymbol \\varepsilon)=\\boldsymbol{\\Sigma}\\] 以及 \\[\\boldsymbol{\\Sigma}={\\sigma}_1^2\\boldsymbol{Z}_1\\boldsymbol{Z}_2^{\\prime}+{\\sigma}_2^2\\boldsymbol{Z}_2\\boldsymbol{Z}_2^{\\prime}+\\cdots+{\\sigma}_k^2\\boldsymbol{Z}_k\\boldsymbol{Z}_k^{\\prime}+{\\sigma}_\\varepsilon^2\\boldsymbol{I}_N\\] 线性组合 \\(\\boldsymbol a^\\prime \\boldsymbol \\beta\\) 对于该混合模型是可估的，当且仅当存在一个向量 \\(\\boldsymbol c\\) 使得 \\(E(\\boldsymbol c^\\prime \\boldsymbol y) = \\boldsymbol a^\\prime \\boldsymbol \\beta\\) 时。该定义与一般线性模型的定义相同（参见第 6 章）。\\(\\boldsymbol a^\\prime \\boldsymbol \\beta\\) 的估计是 \\(\\boldsymbol a^\\prime \\hat {\\boldsymbol \\beta}\\)，为 \\(\\boldsymbol \\beta\\) 的可估函数，其中 \\(\\hat {\\boldsymbol \\beta}\\) 是 \\(\\boldsymbol \\beta\\) 的任意估计。 \\(\\boldsymbol a^\\prime \\boldsymbol\\beta\\) 的普通最小二乘估计 (ordinary least squares estimator) 为 \\(\\boldsymbol a^\\prime \\hat{\\boldsymbol\\beta}_{LS}\\) ，其中 \\(\\boldsymbol{\\hat{\\beta}}_{LS}=(\\boldsymbol{X}^{\\prime}\\boldsymbol{X})^-\\boldsymbol{X}^{\\prime}\\boldsymbol{y}\\) 或者正规方程 \\(\\boldsymbol{X&#39;X\\hat{\\boldsymbol{\\beta}}}=\\boldsymbol{X&#39;y}\\) 的其他解 \\(\\hat{\\boldsymbol \\beta}\\)32。\\(\\boldsymbol \\beta\\) 的最小二乘估计不依赖于 \\(\\boldsymbol y\\) 的协方差阵；也就是说，它不依赖于 \\(\\boldsymbol \\Sigma\\). 如果 \\(\\boldsymbol \\Sigma\\) 的元素已知（即，如果 \\(\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_k^2\\) 和 \\(\\sigma_\\varepsilon^2\\) 已知），则 \\(\\boldsymbol a^\\prime \\boldsymbol\\beta\\) 的最佳线性无偏估计 (best linear unbiased estimator, BLUE) 为 \\(\\boldsymbol a^\\prime \\hat{\\boldsymbol\\beta}_{BLUE}\\)，其中 \\(\\hat{\\boldsymbol\\beta}_{BLUE} = \\left(\\boldsymbol{X&#39;\\Sigma}^{-1}\\boldsymbol{X}\\right)^-\\boldsymbol{X&#39;\\Sigma}^{-1}\\boldsymbol{y}\\) 或者 \\(\\boldsymbol{X&#39;\\Sigma^{-1}}\\boldsymbol{X\\hat{\\beta}}_{BLUE}\\boldsymbol{=X&#39;\\Sigma^{-1}y}\\) 中的任何其他解 \\(\\hat{\\boldsymbol \\beta}_{BLUE}\\). 对于大多数均衡设计和一些简单的不均衡设计，\\(\\boldsymbol{\\hat{\\beta}}_{BLUE}=\\boldsymbol{\\hat{\\beta}}_{LS}\\). 因此，对于这些设计，\\(\\boldsymbol a^\\prime \\boldsymbol\\beta\\) 的 BLUE 是 \\(\\boldsymbol a^\\prime \\hat{\\boldsymbol\\beta}_{LS}\\)，其中 \\(\\hat{\\boldsymbol{\\beta}}_{LS}=(\\boldsymbol{X}^{\\prime}\\boldsymbol{X})^{-}\\boldsymbol{X}^{\\prime}\\boldsymbol{y}\\)，它不依赖于方差分量。 当设计不均衡并且方差分量未知时，生活就不那么容易了 (life is not so easy). 由于 BLUE 不存在（因为它取决于未知方差），因此必须获得加权最小二乘估计 (weighted least squares estimator)，其中 \\(\\hat{\\boldsymbol\\Sigma}\\) 用作加权矩阵。协方差阵估计为 \\[\\hat{\\boldsymbol{\\Sigma}}=\\hat{{\\sigma}}_1^2\\boldsymbol Z_1\\boldsymbol Z_1^{\\prime}+\\hat{{\\sigma}}_2^2\\boldsymbol Z_2\\boldsymbol Z_2^{\\prime}+\\cdots+\\hat{{\\sigma}}_k^2\\boldsymbol Z_k\\boldsymbol Z_k^{\\prime}+\\hat{{\\sigma}}_\\varepsilon^2\\boldsymbol I_N\\] 其中，\\(\\hat{{\\sigma}}_1^2,\\hat{{\\sigma}}_2^2,\\ldots,\\hat{{\\sigma}}_k^2\\) 和 \\(\\hat{{\\sigma}}_\\varepsilon^2\\) 是使用第 22.2 节中讨论的方法之一获得的方差分量估计。\\(\\boldsymbol a^\\prime \\boldsymbol\\beta\\) 的加权最小二乘估计或 \\(\\boldsymbol a^\\prime \\boldsymbol\\beta\\) 的估计的最佳线性无偏估计 (estimated BLUE, EBLUE) 是 \\(\\boldsymbol a^\\prime \\hat{\\boldsymbol\\beta}_W\\)，其中 \\(\\boldsymbol{\\hat{\\beta}}_W=\\left(\\boldsymbol{X}^{\\prime}{\\hat{\\boldsymbol{\\Sigma}}}^{-1}\\boldsymbol{X}\\right)^{-}\\boldsymbol{X&#39;}{\\hat{\\boldsymbol{\\Sigma}}}^{-1}\\boldsymbol{y}\\) 或者 \\({\\boldsymbol X&#39;\\hat{\\boldsymbol\\Sigma}^{-1}}\\boldsymbol{X\\hat{\\beta}}_{W}={\\boldsymbol X&#39;\\hat{\\boldsymbol\\Sigma}^{-1}\\boldsymbol y}\\) 的其他解 \\(\\boldsymbol{\\hat{\\beta}}_W\\). 对于大多数设计，随着样本量的增加，\\(\\boldsymbol a^\\prime \\hat{\\boldsymbol\\beta}_W\\) 收敛于 \\(\\boldsymbol a^\\prime {\\boldsymbol\\beta}\\). 为了确保收敛，必须注意，随着样本量的增加，参数的数量不能趋于无穷大。\\(\\boldsymbol a^\\prime \\hat{\\boldsymbol\\beta}_W\\) 的大样本方差等于 \\(\\mathrm{Var}(\\boldsymbol a^{\\prime}\\boldsymbol{\\hat{\\beta}}_W)=\\boldsymbol a^{\\prime}\\left(\\boldsymbol{X&#39;\\hat{\\Sigma}}^{-1}\\boldsymbol{X}\\right)^-\\boldsymbol{a}\\). 这种对 \\(\\boldsymbol a^\\prime \\hat{\\boldsymbol\\beta}_W\\) 方差的近似没有考虑方差分量估计的变异性。Kackar and Harville (1984) 表明，\\(\\boldsymbol a^{\\prime}\\left(\\boldsymbol{X&#39;\\hat{\\Sigma}}^{-1}\\boldsymbol{X}\\right)^-\\boldsymbol{a}\\) 太小，需要进行调整，因为方差分量的真实值被各自的估计值取代。Kackar and Harville (1984) 和 Kenward and Roger (1997) 使用关于未知方差分量的泰勒级数展开来调整固定效应的标准误估计（该近似超出了本文的范围）。使用 SAS-Mixed 中的 DDFM = KR 选项可为固定效应参数的估计提供调整后的标准误估计。该选项还通过将 Satterthwaite 方法应用于 KR 调整的标准误估计来估计与标准误关联的自由度。 最大似然法也可以用来获得 \\(\\boldsymbol a^\\prime \\boldsymbol\\beta\\) 的估计。\\(\\boldsymbol a^\\prime \\boldsymbol\\beta\\) 的最大似然估计为 \\(\\boldsymbol a^\\prime \\hat{\\boldsymbol\\beta}_{ML}\\)，其中 \\(\\hat{\\boldsymbol\\beta}_{ML}\\) 是未受限似然方程组 (unrestricted likelihood equations) 的解。\\(\\boldsymbol a^\\prime \\hat{\\boldsymbol\\beta}_{ML}\\) 的方差为 \\(\\boldsymbol a^{\\prime} \\boldsymbol W \\boldsymbol a\\)，其中 \\(\\boldsymbol W\\) 是 \\(\\hat{\\boldsymbol\\beta}_{ML}\\) 对应的信息矩阵的广义逆的划分33。第 23 章中的示例演示了均衡和不均衡设计的上述估计。 22.3.2 置信区间的构建 利用 \\(\\boldsymbol a^\\prime \\hat{\\boldsymbol\\beta}_W\\) 的渐近抽样分布 \\(\\boldsymbol a^{\\prime}\\boldsymbol{\\hat{\\beta}}_W\\thicksim N\\left[\\boldsymbol a^{\\prime}\\boldsymbol{\\beta},\\boldsymbol{a}^{\\prime}\\left(\\boldsymbol X^{\\prime}\\boldsymbol{\\hat{\\Sigma}}^{-1}\\boldsymbol X\\right)^-\\boldsymbol{a}\\right]\\)，可以获得关于 \\(\\boldsymbol a^\\prime \\boldsymbol\\beta\\) 可估函数的 \\((1 - \\alpha)100\\%\\) 置信区间，其中 \\(\\boldsymbol a^\\prime \\boldsymbol\\beta\\) 是 \\(\\boldsymbol\\beta\\) 的可估计函数。\\(\\boldsymbol a^\\prime \\hat{\\boldsymbol\\beta}_W\\) 的标准误估计 \\(\\widehat{s.e.}\\left(\\boldsymbol a^\\prime \\hat{\\boldsymbol\\beta}_W\\right)=\\sqrt{\\boldsymbol{a}^{\\prime}\\left(\\boldsymbol X^{\\prime}\\boldsymbol{\\hat{\\Sigma}}^{-1}\\boldsymbol X\\right)^-\\boldsymbol{a}}\\). 此时应使用标准误估计的 Kackar-Harville 型调整。通过使用 Satterthwaite 近似的推广 (Geisbrecht and Burns, 1985) 获得近似自由度： \\[\\hat{v}=\\frac{2\\left[\\boldsymbol a^{\\prime}\\left(\\boldsymbol X^{\\prime}\\hat{\\boldsymbol \\Sigma}^{-1}\\boldsymbol X\\right)^-\\boldsymbol a\\right]^2}{\\widehat{\\mathrm{Var}}\\left[\\boldsymbol a^{\\prime}\\left(\\boldsymbol X^{\\prime}\\hat{\\boldsymbol \\Sigma}^{-1}\\boldsymbol X\\right)^-\\boldsymbol a\\right]}\\] 因此 \\(\\boldsymbol a^\\prime \\boldsymbol\\beta\\) 的 \\((1 - \\alpha)100\\%\\) 近似置信区间为 \\[{\\boldsymbol a&#39;\\hat{\\boldsymbol{\\beta}}}_W\\pm\\left(t_{\\alpha/2,\\hat{v}}\\right)\\sqrt[]{\\boldsymbol{a&#39;}\\left(\\boldsymbol{X&#39;\\hat{\\boldsymbol{\\Sigma}}}^{-1}\\boldsymbol{X}\\right)^-\\boldsymbol{a}}\\] 可以关于一组可估线性组合 \\(\\boldsymbol a_1^\\prime \\hat{\\boldsymbol\\beta},\\boldsymbol a_2^\\prime \\hat{\\boldsymbol\\beta},\\ldots,\\boldsymbol a_m^\\prime \\hat{\\boldsymbol\\beta}\\) 构造一组同时置信区间，但需要近似每个线性组合的自由度。然后可以使用第 3 章的技术对多重比较进行调整。 22.3.3 假设检验 通常，假设检验为固定效应的线性组合提供适当的推断过程。为检验 \\(H_0{:\\boldsymbol{H\\beta}}=\\boldsymbol{b}\\mathrm{~vs~}H_a{:\\boldsymbol{H\\beta}}\\neq\\boldsymbol{b}\\) 计算统计量 \\[Q=(\\boldsymbol H\\hat{\\boldsymbol \\beta}_W-\\boldsymbol b)^{\\prime}\\left[\\boldsymbol H\\left(\\boldsymbol X^{\\prime}\\hat{\\boldsymbol \\Sigma}^{-1}\\boldsymbol X\\right)^{-}\\boldsymbol H^{\\prime}\\right]^{-1}(\\boldsymbol H\\hat{\\boldsymbol \\beta}_W-\\boldsymbol b)\\] 在原假设条件下，\\(Q\\) 的渐进抽样分布为 \\(\\chi^2_q\\)，其中 \\(q=\\text{rank}(\\boldsymbol H)\\). 即 \\(q\\) 是 \\(\\boldsymbol H\\) 中 \\(\\boldsymbol \\beta\\) 的线性独立线性组合的个数。小样本检验统计量为 \\(F_c = Q/v\\)，其中 v 是与 \\(\\boldsymbol H\\left(\\boldsymbol X^{\\prime}\\hat{\\boldsymbol \\Sigma}^{-1}\\boldsymbol X\\right)^{-}\\boldsymbol H^{\\prime}\\) 相关的近似自由度。近似自由度 (SAS Institute, Inc., 1999) 是通过在 \\(\\boldsymbol H\\left(\\boldsymbol X^{\\prime}\\hat{\\boldsymbol \\Sigma}^{-1}\\boldsymbol X\\right)^{-}\\boldsymbol H^{\\prime}\\) 上进行谱分解来计算的：\\(\\boldsymbol H\\left(\\boldsymbol X^{\\prime}\\hat{\\boldsymbol \\Sigma}^{-1}\\boldsymbol X\\right)^{-}\\boldsymbol H^{\\prime}=\\boldsymbol P^{\\prime}\\boldsymbol \\Delta \\boldsymbol P\\)，其中 \\(\\boldsymbol \\Delta\\) 是 q × q 对角 阵，对角元为 \\(\\boldsymbol H\\left(\\boldsymbol X^{\\prime}\\hat{\\boldsymbol \\Sigma}^{-1}\\boldsymbol X\\right)^{-}\\boldsymbol H^{\\prime}\\) 的特征根，\\(\\boldsymbol P\\) 是包含相应特征向量的 q × q 矩阵。令 \\(\\boldsymbol h_s\\) 为 \\(\\boldsymbol{PH}\\) 的第 s 行，则 \\(v_s=2d_s^2/(\\boldsymbol \\xi_s^{\\prime}\\boldsymbol \\Omega\\boldsymbol \\xi_s)\\)34 其中 \\[\\boldsymbol \\xi_s=\\frac{\\partial\\left[\\boldsymbol{h&#39;}_s\\left(\\boldsymbol{X&#39;\\Sigma}^{-1}\\boldsymbol{X}\\right)^-\\boldsymbol{h}_s\\right]}{\\partial\\boldsymbol{\\sigma}}\\] 为关于每个方差分量的导数向量，以及 \\(\\boldsymbol\\Omega\\) 为方差分量估计 \\(\\hat{\\boldsymbol \\sigma}\\) 的渐近协方差阵。那么 \\[\\zeta=\\sum_{s=1}^q\\frac{V_s}{V_s-2}\\mathrm{In}(v_s&gt;2)\\] 其中指示函数 \\(\\mathrm{In}(v_s &gt; 2)\\) 删除 \\(v_s \\le 2\\) 的项。那么与 \\(F_c\\) 相关的分母自由度的近似数为 \\[v=\\begin{cases}\\frac{2\\zeta}{\\zeta-q}&amp;\\mathrm{if~}\\zeta&gt;q\\\\0&amp;\\mathrm{if~}\\zeta&gt;q&amp;\\end{cases}\\] 第 23 章讨论了示例。 22.4 最佳线性无偏预测 在某些情况下，预测随机变量的值或预测研究中使用的随机效应的值是有意义的。假设有线性模型 \\(\\boldsymbol y=\\boldsymbol X\\boldsymbol{\\beta}+\\boldsymbol \\varepsilon\\)，其中 \\(\\mathrm{Var}(\\varepsilon) = \\boldsymbol \\Sigma\\). 假设有一个随机变量 \\(\\boldsymbol\\omega\\)，其值未知，但假设 \\(\\boldsymbol\\omega\\thicksim N(\\boldsymbol k^\\prime\\boldsymbol\\beta,\\boldsymbol \\sigma_\\omega^2)\\) 和 \\(\\operatorname{Cov}(\\boldsymbol y,\\boldsymbol\\omega)=\\boldsymbol c\\)。目的是预测 \\(\\boldsymbol\\omega\\) 的值。\\(\\boldsymbol\\omega\\) 的预测值称为最佳线性无偏预测 (best linear unbiased predictor, BLUP)，当 \\(\\tilde{\\boldsymbol{\\omega}}=\\boldsymbol{a&#39;y}+b\\) \\(E(\\tilde{\\boldsymbol\\omega})=\\boldsymbol k^{\\prime}{\\boldsymbol\\beta}\\) 以及 \\(E(\\tilde{\\boldsymbol\\omega}-\\boldsymbol\\omega)^2\\) 被最小化 所得的 \\(\\boldsymbol\\omega\\) 的 BLUP 为 \\(\\tilde{\\boldsymbol{\\omega}}=\\boldsymbol{c&#39;\\Sigma}^{-1}(\\boldsymbol{y}-\\boldsymbol{X}\\boldsymbol{\\hat{\\beta}}_{BLUE})+\\boldsymbol{k&#39;}\\boldsymbol{\\hat{\\beta}}_{BLUE}\\). 当 \\(\\boldsymbol \\Sigma\\) 的元素未知且需要估计时，\\(\\boldsymbol\\omega\\) 的最佳线性无偏预测估计 (estimated BLUP, EBLUP) 为 \\[\\hat{\\tilde{\\boldsymbol \\omega}}=c^{\\prime}\\boldsymbol{\\hat{\\Sigma}}^{-1}(\\boldsymbol{y}-\\boldsymbol{X}\\boldsymbol{\\hat{\\beta}}_W)+\\boldsymbol{k}^{\\prime}\\boldsymbol{\\hat{\\beta}}_W\\] 如果 \\(\\boldsymbol{k}^{\\prime}\\boldsymbol{\\beta}=0\\) 那么 \\(\\hat{\\boldsymbol{\\tilde{\\omega}}}=\\boldsymbol{c}^{\\prime}\\boldsymbol{\\hat{\\Sigma}}^{-1}(\\boldsymbol{y}-\\boldsymbol{X}\\boldsymbol{\\hat{\\beta}}_W)\\) 对于一般线性混合模型，\\(\\boldsymbol{y}=\\boldsymbol{X\\beta}+\\boldsymbol{Z}\\boldsymbol{u}+\\boldsymbol{\\varepsilon}\\) 其中 \\(\\boldsymbol u \\thicksim N(\\boldsymbol 0,\\boldsymbol G)\\) 和 \\(\\boldsymbol \\varepsilon \\thicksim N(\\boldsymbol 0, \\boldsymbol R)\\)，\\(\\boldsymbol y\\) 和 \\(\\boldsymbol u\\) 之间的协方差为 \\(\\operatorname{Cov}(\\boldsymbol y,\\boldsymbol u)=\\boldsymbol G\\boldsymbol{Z}^{\\prime}\\) 且 \\(\\boldsymbol u\\) 的 BLUP 为 \\(\\tilde{\\boldsymbol{u}}=\\boldsymbol G\\boldsymbol{Z}^{\\prime}\\boldsymbol{\\Sigma}^{-1}(\\boldsymbol{y}-\\boldsymbol{X}\\boldsymbol{\\hat{\\beta}})\\). 22.5 混合模型方程组 Henderson (1984) 开发了混合模型方程组 (mixed model equations)，其解可以同时得出 \\(\\boldsymbol \\beta\\) 可估计函数 \\(\\boldsymbol a^\\prime \\boldsymbol\\beta\\) 的 BLUE 以及随机效应 \\(\\boldsymbol u=(\\boldsymbol u_1^{\\prime},\\boldsymbol u_2^{\\prime},\\ldots,\\boldsymbol u_k^{\\prime})^{\\prime}\\) 的 BLUPs. 将混合模型表示为 \\(\\boldsymbol{y}=\\boldsymbol{X\\beta}+\\boldsymbol{Z}\\boldsymbol{u}+\\boldsymbol{\\varepsilon}\\)，其中 \\[\\begin{aligned} \\boldsymbol{Z}\\boldsymbol u&amp;=\\boldsymbol{Z}_1\\boldsymbol u_1+\\boldsymbol{Z}_2\\boldsymbol u_2+\\cdots+\\boldsymbol{Z}_k\\boldsymbol u_k \\\\ \\boldsymbol u_i&amp;\\thicksim N(\\boldsymbol 0,\\sigma_i^2\\boldsymbol I_{n_i}),\\quad i=1,2,\\ldots,k \\\\ \\boldsymbol{\\varepsilon}&amp;\\thicksim N(\\boldsymbol{0},{\\sigma}_\\varepsilon^2\\boldsymbol{I}_N) \\end{aligned}\\] 其中 \\(\\boldsymbol{u}_1,\\boldsymbol{u}_2,\\ldots,\\boldsymbol{u}_k,\\boldsymbol{\\varepsilon}\\) 为独立随机变量。 注意到 \\[\\boldsymbol{u}=\\begin{bmatrix}\\boldsymbol{u}_1\\\\\\boldsymbol{u}_2\\\\\\vdots\\\\\\boldsymbol{u}_k\\end{bmatrix}\\thicksim N(\\boldsymbol{0},\\boldsymbol{G})\\] 其中 \\[\\boldsymbol{G}=\\begin{bmatrix}{\\sigma}_1^2\\boldsymbol{I}_{n_1}&amp;0&amp;\\cdots&amp;0\\\\0&amp;{\\sigma}_2^2\\boldsymbol{I}_{n_2}&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;{\\sigma}_k^2\\boldsymbol{I}_{n_k}\\end{bmatrix}\\] 使用这些假设，\\(\\boldsymbol y\\) 的边际分布可以表示为 \\(\\boldsymbol y\\thicksim N(\\boldsymbol X\\boldsymbol{\\beta},\\boldsymbol{\\Sigma})\\) 其中 \\[\\mathrm{Var}(\\boldsymbol y)=\\boldsymbol{\\Sigma}=\\sum_{i=1}^k{\\sigma}_i^2\\boldsymbol{Z}_i\\boldsymbol{Z}_i^{\\prime}+\\boldsymbol{\\sigma}_\\varepsilon^2\\boldsymbol{I}=\\boldsymbol{Z}\\boldsymbol{G}\\boldsymbol{Z}^{\\prime}={\\sigma}_\\varepsilon^2\\boldsymbol{I}_N\\] 该模型及其假设意味着 \\(\\operatorname{Cov}(\\boldsymbol{y},\\boldsymbol{u})=\\boldsymbol{G}\\boldsymbol{Z}^{\\prime}\\). 使用上述信息，\\(\\boldsymbol y\\) 和 \\(\\boldsymbol u\\) 的联合分布为 \\[\\begin{bmatrix}\\boldsymbol{u}\\\\\\boldsymbol{y}\\end{bmatrix}\\thicksim N\\left(\\begin{bmatrix}\\boldsymbol{0}\\\\\\boldsymbol{X}\\boldsymbol{\\beta}\\end{bmatrix},\\begin{bmatrix}\\boldsymbol{G}&amp;\\boldsymbol{G}\\boldsymbol{Z}^{\\prime}\\\\\\boldsymbol{Z}\\boldsymbol{G}^{\\prime}&amp;\\boldsymbol{\\Sigma}\\end{bmatrix}\\right)\\] 给定 \\(\\boldsymbol u\\) 的 \\(\\boldsymbol y\\) 的条件分布是 \\(\\boldsymbol{y}|\\boldsymbol{u}\\sim N(\\boldsymbol{X\\beta}+\\boldsymbol{Zu},\\sigma_\\varepsilon^2\\boldsymbol{I})\\) 以及 \\(\\boldsymbol u\\) 的边际分布为 \\(\\boldsymbol{u}\\thicksim N(\\boldsymbol{0},\\boldsymbol{G})\\). 因此，\\(\\boldsymbol y\\) 和 \\(\\boldsymbol u\\) 的联合分布可以表示为给定 \\(\\boldsymbol u\\) 的 \\(\\boldsymbol y\\) 的条件分布与 \\(\\boldsymbol u\\) 的边际分布的乘积，如 \\[\\begin{aligned} h(\\boldsymbol y,\\boldsymbol u)&amp;=f(\\boldsymbol y|\\boldsymbol u)g(\\boldsymbol u) \\\\ &amp;=[2\\pi\\sigma_\\varepsilon^2]^{-(N/2)}\\exp\\left[-\\frac1{2\\sigma_\\varepsilon^2}\\left(\\boldsymbol y-\\boldsymbol X\\boldsymbol{\\beta}-\\boldsymbol Z\\boldsymbol{u}\\right)^{\\prime}\\left(\\boldsymbol y-\\boldsymbol X\\boldsymbol{\\beta}-\\boldsymbol Z\\boldsymbol{u}\\right)\\right][2\\pi]^{-(q/2)}|\\boldsymbol{G}|^{-1/2}\\exp(-\\frac12\\boldsymbol{u}\\boldsymbol G^{-1}\\boldsymbol{u}) \\end{aligned}\\] 其中 \\(q=n_1+n_2+\\ldots,n_k\\). 为导出混合模型方程（其解提供了 \\(\\boldsymbol \\beta\\) 可估函数的 BLUE 和 \\(\\boldsymbol u\\) 的 BLUPs），Henderson (1984) 关于 \\(\\boldsymbol \\beta\\) 和 \\(\\boldsymbol u\\) 对 \\(-2\\log[f(\\boldsymbol y|\\boldsymbol u)g(\\boldsymbol u)]\\) 进行求导35： \\[\\begin{aligned} -2\\log[f(\\boldsymbol y|\\boldsymbol u)g(\\boldsymbol u)] =&amp;\\,(N+q)\\mathrm{log}(2\\pi)+N\\mathrm{log}(\\sigma_\\varepsilon^2)+\\mathrm{log}|\\boldsymbol G| \\\\ &amp;+\\frac1{\\sigma_\\varepsilon^2}(\\boldsymbol y-\\boldsymbol X\\boldsymbol{\\beta}-\\boldsymbol Z\\boldsymbol{u})^{\\prime}(\\boldsymbol y-\\boldsymbol X\\boldsymbol{\\beta}-\\boldsymbol Z\\boldsymbol{u})+\\boldsymbol u^{\\prime}\\boldsymbol G^{-1}\\boldsymbol{u} \\\\ =&amp;\\,h\\mathrm{~(say)} \\end{aligned}\\\\ \\frac{\\partial h}{\\partial\\boldsymbol{\\beta}}=\\frac2{\\sigma_\\varepsilon^2}\\boldsymbol X^{\\prime}(\\boldsymbol y-\\boldsymbol X\\boldsymbol{\\beta}-\\boldsymbol Z\\boldsymbol{u}),\\quad\\frac{\\partial h}{\\partial\\boldsymbol{u}}=\\frac2{\\sigma_\\varepsilon^2}\\boldsymbol Z^{\\prime}(\\boldsymbol y-\\boldsymbol X\\boldsymbol{\\beta}-\\boldsymbol Z\\boldsymbol{u})+2\\boldsymbol G^{-1}\\boldsymbol{u}\\] 将导数设置为零提供混合模型方程组 \\[\\begin{bmatrix}\\boldsymbol X^{\\prime}\\boldsymbol X&amp;\\boldsymbol X^{\\prime}\\boldsymbol{Z}\\\\\\boldsymbol{Z^{\\prime}}\\boldsymbol X&amp;(\\boldsymbol{Z^{\\prime}}\\boldsymbol{Z}+\\sigma_\\varepsilon^2\\boldsymbol{G^{-1}})\\end{bmatrix}{\\begin{bmatrix}\\hat{\\boldsymbol \\beta}_{BLUE}\\\\\\tilde{\\boldsymbol u}\\end{bmatrix}}={\\begin{bmatrix}\\boldsymbol X^{\\prime}\\boldsymbol y\\\\\\boldsymbol Z^{\\prime}\\boldsymbol{u}\\end{bmatrix}}\\] 如果 \\(\\boldsymbol \\varepsilon\\)（残差）的方差是 \\(\\boldsymbol R\\)，则混合模型方程组变为 \\[\\begin{bmatrix}\\boldsymbol X^{\\prime}\\boldsymbol R^{-1}\\boldsymbol X&amp;\\boldsymbol X^{\\prime}\\boldsymbol R^{-1}\\boldsymbol Z\\\\\\boldsymbol Z^{\\prime}\\boldsymbol R^{-1}\\boldsymbol X&amp;(\\boldsymbol Z^{\\prime}\\boldsymbol R^{-1}\\boldsymbol Z+\\boldsymbol G^{-1})\\end{bmatrix}\\begin{bmatrix}\\hat{\\boldsymbol\\beta}_{BLUE}\\\\\\tilde{\\boldsymbol u}\\end{bmatrix}=\\begin{bmatrix}\\boldsymbol X^{\\prime}\\boldsymbol R^{-1}\\boldsymbol y\\\\\\boldsymbol Z^{\\prime}\\boldsymbol R^{-1}\\boldsymbol u\\end{bmatrix}\\] 混合模型方程组的解为 \\[\\hat{\\boldsymbol{\\beta}}=\\left(\\boldsymbol X^{\\prime}{\\boldsymbol{\\Sigma}}^{-1}\\boldsymbol X\\right)^{-}\\boldsymbol X^{\\prime}{\\boldsymbol{\\Sigma}}^{-1}\\boldsymbol y\\quad\\mathrm{and}\\quad\\tilde{\\boldsymbol{u}}=\\boldsymbol G\\boldsymbol Z^{\\prime}{\\boldsymbol{\\Sigma}}^{-1}(\\boldsymbol y-\\boldsymbol X\\hat{\\boldsymbol{\\beta}})\\] 通常，\\(\\boldsymbol{\\Sigma}\\) 的元素是未知的，需要进行估计，因此估计的 BLUE（EBLUE）和估计的 BLUP（EBLUP）为 \\[\\boldsymbol{\\hat{\\beta}_W}=\\left(\\boldsymbol X^{\\prime}\\hat{\\boldsymbol{\\Sigma}}^{-1}\\boldsymbol X\\right)^-\\boldsymbol{X}^{\\prime}\\boldsymbol{\\hat{\\Sigma}}^{-1}\\boldsymbol{y}\\quad\\mathrm{and}\\quad\\hat{\\tilde{\\boldsymbol u}}=\\boldsymbol{\\hat{G}}\\boldsymbol{Z}^{\\prime}\\boldsymbol{\\hat{\\Sigma}}^{-1}(\\boldsymbol{y}-\\boldsymbol{X}\\boldsymbol{\\hat{\\beta}})\\] 22.6 结束语 本章介绍了一个混合模型的理论发展，用于描述实验中的处理和设计结构，其中涉及固定效应和随机效应。混合模型的分析包括方差分量以及固定效应参数函数的估计和推断。对于模型的随机效应部分，可以使用平方和方法而不是方差分量估计的渐近抽样分布来进行假设检验。为了对固定效应进行推断，对模型的固定效应部分进行了分析。可以使用可估函数的估计的渐近抽样分布或近似 \\(F\\) 统计量（其中分母自由度通过 Satterthwaite 型近似确定）来执行置信区间和假设检验。还讨论了随机效应的最佳线性无偏预测以及混合模型方程组。 22.7 练习 原文：The ordinary least squares estimator of \\(\\boldsymbol a^\\prime \\boldsymbol\\beta\\) is \\(\\boldsymbol a^\\prime \\hat{\\boldsymbol\\beta}_{LS}\\) where \\(\\boldsymbol{\\hat{\\beta}}_{LS}=(\\boldsymbol{X}^{\\prime}\\boldsymbol{X})^-\\boldsymbol{X}^{\\prime}\\boldsymbol{y}\\) or some other solution for \\(\\hat{\\boldsymbol \\beta}\\) to the normal equations \\(\\boldsymbol{X&#39;X\\hat{\\boldsymbol{\\beta}}}=\\boldsymbol{X&#39;y}\\).↩︎ 原文：where \\(\\boldsymbol W\\) is the partition of the generalized inverse of the information matrix corresponding to \\(\\hat{\\boldsymbol\\beta}_{ML}\\).↩︎ 译者也不清楚此式中 \\(d_s\\) 的来源。↩︎ 原文：Henderson (1984) differentiated \\(-2\\log[f(\\boldsymbol y|\\boldsymbol u)g(\\boldsymbol u)]\\) with respect to \\(\\boldsymbol \\beta\\) and \\(\\boldsymbol u\\) to derive the mixed model equations whose solution provides the BLUE of estimable functions of \\(\\boldsymbol \\beta\\) and BLUPs of \\(\\boldsymbol u\\) as↩︎ "],["chap23.html", "第 23 章 案例研究：混合模型 23.1 双向混合模型 23.2 不均衡双向混合模型 23.3 不均衡双向数据集的 JMP 分析 23.4 结束语 23.5 练习", " 第 23 章 案例研究：混合模型 “Natural selection is a mechanism for generating an exceedingly high degree of improbability.” - R. A. Fisher 第 22 章讨论了均衡和不均衡混合模型的数据分析方法。本章针对每种情况都通过实例进行了详细分析。不均衡情况的数据是通过从均衡情况的数据中随机删除一些观测值而获得的。该研究涉及一家公司，该公司希望更换其一家工厂中用于制造某种部件的机器。有三种不同品牌的机器可供选择，因此管理层设计了一项实验，以评估当由公司自己的员工操作时，这三台机器的生产率。从受过操作此类机器培训的员工中随机选择了六名员工。每个被选中的员工都需要在三个不同的班次中操作每台机器。记录的数据是整体生产率得分，考虑了生产部件的数量和质量。数据在表 23.1 中给出。 表 23.1: 机器-人示例的生产率得分 x 23.1 双向混合模型 本实验的处理结构是双向的，机器 (machine) 是固定效应，人 (person) 是随机效应。设计结构为完全随机设计。用于描述在 n 个不同轮班期间每个操作 t 台机器的 b 个人的数据的双向混合模型为 \\[y_{ijk}=\\mu+\\tau_i+p_j+(\\tau p)_{ij}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,b,\\quad k=1,2,\\ldots,n\\] 其中，\\(\\mu\\) 表示由工人总体操作的一组品牌机器的平均生产率得分，\\(\\tau_i\\) 表示第 i 台机器对生产率得分的效应，\\(p_j\\) 表示第 j 个人对生产率得分的随机效应，\\((\\tau p)_{ij}\\) 表示特定于第 j 个人操作第 i 台机器时对生产率得分的随机交互效应，\\(\\varepsilon_{ijk}\\) 表示与第 j 个人第 k 次操作第 i 台机器相关的随机误差项，以及 \\(p_j,(\\tau p)_{ij},\\varepsilon_{ijk}\\) 为独立随机变量。 关于该模型中随机变量的额外假设为 \\[\\begin{aligned}p_j&amp;\\sim i.i.d.N(0,\\sigma_{person}^2)\\\\(\\tau p)_{ij}&amp;\\sim i.i.d.N(0,\\sigma_{m\\times p}^2)\\\\\\varepsilon_{ijk}&amp;\\sim i.i.d.N(0,\\sigma_{\\varepsilon}^2)\\end{aligned}\\] 假设 \\({\\varepsilon}_{ijk}\\thicksim i.i.d.N(0,{\\sigma}_{\\varepsilon}^2)\\) 意味着，当对 machine × person 的组合进行测量时，不同班次之间的时间间隔足够长，使得误差项不相关。 第一步是分析模型的随机效应部分。SAS®-Mixed 代码用于获得三个方差分量的矩法、REML、最大似然和 MINQUE0 估计。III 型平方和、均方及其相应的期望均方如表 23.2 所示。表 23.3 给出了方差分量的最大似然、REML、矩法和 MINQUE0 估计量。表 23.4 中的 SAS-Mixed 代码用于拟合双向混合模型，并获得方差分量的 REML 估计。通过指定 Method=ML, Method=MIVQUE0 和 Method=type3 获得其他三种方法的估计。 表 23.2: 使用 III 型平方和的均衡数据方差表分析 x 表 23.3: 使用 REML, ML, MIVQUE0 和矩法（III 型）来估计方差分量 x 表 23.4: 用于获取均衡数据集方差分量 REML 估计的 SAS Mixed 代码 x 第一个要检验的假设是 \\(H_0\\colon{\\sigma}_{m\\times p}^2=0\\text{ vs }H_a\\colon{\\sigma}_{m\\times p}^2&gt;0\\). 通过使用表 23.2 中的期望均方构建的用于检验该假设的统计量为 \\[F_{m\\times p}=\\frac{MSPerson\\times Machine}{MSResidual}=46.13\\] 与该 \\(F\\) 检验相关的显著性水平小于 0.0001，说明有强有力的证据表明 \\({\\sigma}_{m\\times p}^2\\) 非零，是数据变异性的重要因素。如果 machine × person 交互方差分量等于零，则表明三台机器的所有员工（而不仅仅是样本中的员工）之间的生产率差异相似。这也表明，三台机器之间的生产率差异对所有员工（不仅仅是样本中的员工）来说是相似的。换句话说，推断是针对所有可能的员工的总体，而不仅仅是从公司所有员工中随机选择的员工。 对显著的 machine × person 交互方差分量的解释是，机器之间的生产率差异取决于使用机器的人。对大的 machine × person 交互方差分量的一种解释是，有些人更适合某些机器，而不是其他机器。在数据中，可以看到 pearson 6 在 machine 1 和 2 上的表现不如样本中的其他人，但 pearson 6 在 machine 3 上的表现与样本中的其它人差不多。要检验的第二个假设是 \\(H_0\\colon{\\sigma}_{p}^2=0\\text{ vs }H_a\\colon{\\sigma}_{p}^2&gt;0\\). 同样，检验这一假设的统计量是通过使用表 23.2 中的期望均方构建的，并由下式给出 \\[F_p=\\frac{MSPerson}{MSPerson\\times Machine}\\] 与 \\(H_0\\colon{\\sigma}_{p}^2=0\\text{ vs }H_a\\colon{\\sigma}_{p}^2&gt;0\\) 相关的显著性水平为 0.0089，表明工厂员工的生产率得分存在相当大的差异。培训项目可以减少员工之间的差异。 表 23.3 显示了四种方法的方差分量估计。对于 REML、MIVQUE0 和 III 型，方差分量的估计是相同的，但对于 person 和 machine × person 方差分量，ML 的估计要小一些。 Satterthwaite 近似可用于确定在构建关于方差分量置信区间时使用的自由度。第一步是将方差分量的估计表示为表 23.2 中的均方的线性组合。\\({{\\sigma}}_p^2\\) 的矩法估计为 \\(\\hat{{\\sigma}}_p^2=\\frac19{ MSPerson }-\\frac19{ MSPerson }\\times Machine=22.8584\\). 通过 Satterthwaite 近似获得的近似卡方分布的自由度为 \\[v=\\frac{(\\hat{\\sigma}_p^2)^2}{\\frac{[\\frac19MSPerson]^2}5+\\frac{[\\frac19MSPerson\\times Machine]^2}{10}}=3.38035\\] 95% 置信区间的分位数为 \\[\\chi_{.025,3.38}^2=10.0467\\quad\\mathrm{~and~}\\quad\\chi_{.975,3.38}^2=0.30725\\] 因此，\\({{\\sigma}}_p^2\\) 的 95% 置信区间为 \\[\\frac{3.38035(22.8584)}{10.0467}\\leq\\sigma_p^2\\leq\\frac{3.38035(22.8584)}{0.30725}\\] 或 \\[7.69102\\leq\\sigma_p^2\\leq251.486\\] \\({{\\sigma}}_p^2\\) 的 95% 置信区间为 \\(2.773\\leq\\sigma_p^2\\leq15.858\\). 表 23.5 给出了 III 型分析的协方差参数估计。方差分量的估计和标准误的估计在前两列中。Z-value 列给出了每个估计与其相应的标准误估计的比值，Pr Z 列是与 Z-value 相对应的双侧显著性水平。Lower 和 Upper 列是使用 Wald 区间计算的置信区间；即，\\(\\hat{{\\sigma}}^2\\pm Z_{0.025}[\\widehat{s.e.}(\\hat{{\\sigma}}^2)]\\). 当与待估方差分量相关的自由度数量较大时，Wald 置信区间才适用。关于 \\({\\sigma}_{{\\varepsilon}}^{{2}}\\) （残差）的置信区间基于 36 个自由度的卡方分布。表 23.6 包含来自 REML 分析的协方差参数估计。 表 23.5: 根据 III 型分析的协方差参数估计 x 表 23.6: 来自 REML 分析的协方差参数估计，包括用于计算置信区间的计算自由度 x 表 23.5 和 23.6 中方差分量估计及其标准误估计是相同的，但 Pr Z 列不同。表 23.6 中的显著性水平是单侧的（而且应该是单侧的）。计算出的自由度 \\(df=2(\\text{Z-value})^2\\) 与使用矩法估计计算出的自由度相同。残差方差分量的置信区间基于 36 个自由度的卡方分布。因此，对于均衡设计，REML、MIVQUE0 和矩法估计得到的方差分量的信息在与单个估计相关的近似自由度方面是相同的，但是 Wald 法被用于构建 person 和 machine × person 的置信区间，这两个方差分量是从矩法估计得来的，而对于 REML 和 MIVQUE0，则使用了更合适的 Satterthwaite 近似法。 估计和检验混合模型中固定效应假设所需的方法取决于数据是均衡的还是不均衡的。第 22.3 节讨论了不均衡设计的方法。 一般混合模型可以表示为 \\[\\boldsymbol y=\\boldsymbol X\\boldsymbol{\\beta}+\\boldsymbol Z_1\\boldsymbol u_1+\\boldsymbol Z_2\\boldsymbol u_2+\\cdots+\\boldsymbol Z_k\\boldsymbol u_k+\\boldsymbol{\\varepsilon}\\] 其中 \\(\\boldsymbol{X}=[\\boldsymbol{j},\\boldsymbol{X}_1],\\boldsymbol{\\beta}=({\\mu},\\tau_1,\\tau_2,\\ldots,\\tau_t)&#39;\\) 如果协方差阵 \\[\\boldsymbol{\\Sigma}={\\sigma}_1^2\\boldsymbol{Z}_1\\boldsymbol{Z}_1&#39;+{\\sigma}_2^2\\boldsymbol{Z}_2\\boldsymbol{Z}_2&#39;+\\cdots+{\\sigma}_k^2\\boldsymbol{Z}_k\\boldsymbol{Z}_k&#39;+{\\sigma}_\\varepsilon^2\\boldsymbol{I}\\] 的元素是已知的；即，方差分量是已知的，可估函数 \\(\\boldsymbol a&#39;\\boldsymbol \\beta\\) 的 BLUE (best linear unbiased estimate) 为 \\[\\boldsymbol a&#39;\\hat{\\boldsymbol\\beta}_{BLUE} = \\boldsymbol a&#39;\\left(\\boldsymbol{X&#39;\\Sigma}^{-1}\\boldsymbol{X}\\right)^-\\boldsymbol{X&#39;\\Sigma}^{-1}\\boldsymbol{y}\\] 对于大多数均衡混合模型，\\(\\boldsymbol a&#39;\\boldsymbol \\beta\\) 的估计简化为 \\[\\boldsymbol a&#39;\\hat{\\boldsymbol\\beta}_{BLUE} = \\boldsymbol a&#39;\\left(\\boldsymbol{X&#39;}\\boldsymbol{X}\\right)^-\\boldsymbol{X&#39;}\\boldsymbol{y}\\] 下一个例子展示了均衡双向混合模型的这种简化。模型可以重新参数化为 \\[y_{ijk}=\\mu_i+p_j+(\\tau p)_{ij}+\\varepsilon_{ijk}\\] 其中 \\(\\mu_i=\\mu+\\tau_i\\) 且 \\(\\boldsymbol X_1\\) 为模型固定效应部分 \\(\\boldsymbol{\\mu}=(\\mu_1,\\mu_2,\\ldots,\\mu_t)^{\\prime}\\) 相应的 nbt × t 设计矩阵。 注意到 \\[\\boldsymbol{X}_1=\\begin{bmatrix}\\boldsymbol{j}_{nb}&amp;0&amp;0&amp;\\cdots&amp;0\\\\0&amp;\\boldsymbol{j}_{nb}&amp;0&amp;\\cdots&amp;0\\\\0&amp;0&amp;\\boldsymbol{j}_{nb}&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\0&amp;0&amp;0&amp;\\cdots&amp;\\boldsymbol{j}_{nb}\\end{bmatrix}=\\boldsymbol{j}_n\\otimes\\boldsymbol{j}_b\\otimes\\boldsymbol{I}_t\\] 均衡模型的协方差阵为 \\[\\boldsymbol{\\Sigma}=\\sigma_p^2(\\boldsymbol{J}_n\\otimes\\boldsymbol{I}_b\\otimes\\boldsymbol{J}_t)+\\sigma_{m\\times p}^2(\\boldsymbol{J}_n\\otimes\\boldsymbol{I}_b\\otimes\\boldsymbol{I}_t)+\\sigma_\\varepsilon^2(\\boldsymbol{I}_n\\otimes\\boldsymbol{I}_b\\otimes\\boldsymbol{I}_t)\\] 可以表示为 \\[\\boldsymbol{\\Sigma}=\\lambda_1\\left(\\frac1n\\boldsymbol{J}_n\\otimes\\boldsymbol{I}_b\\otimes\\frac1t\\boldsymbol{J}_t\\right)+\\lambda_2\\left[\\frac1n\\boldsymbol{J}_n\\otimes\\boldsymbol{I}_b\\otimes\\left(\\boldsymbol{I}_t-\\frac1t\\boldsymbol{J}_t\\right)\\right]+\\lambda_3\\left[\\left(\\boldsymbol{I}_n-\\frac1n\\boldsymbol{J}_n\\right)\\otimes\\boldsymbol{I}_b\\otimes\\boldsymbol{I}_t\\right]\\] 其中 \\(\\lambda_1=nt\\sigma_p^2+n\\sigma_{m\\times p}^2+\\sigma_\\varepsilon^2,\\lambda_2=n\\sigma_{m\\times p}^2+\\sigma_\\varepsilon^2\\) 以及 \\(\\lambda_3=\\sigma_\\varepsilon^2\\). 可以证明 \\[\\boldsymbol{\\Sigma}^{-1}=\\frac1{\\lambda_1}\\bigg(\\frac1n\\boldsymbol{J}_n\\otimes\\boldsymbol{I}_b\\otimes\\frac1t\\boldsymbol{J}_t\\bigg)+\\frac1{\\lambda_2}\\bigg[\\frac1n\\boldsymbol{J}_n\\otimes\\boldsymbol{I}_b\\otimes\\bigg(\\boldsymbol{I}_t-\\frac1t\\boldsymbol{J}_t\\bigg)\\bigg]+\\frac1{\\lambda_3}\\bigg[\\bigg(\\boldsymbol{I}_n-\\frac1n\\boldsymbol{J}_n\\bigg)\\boldsymbol{\\otimes}\\boldsymbol{I}_b\\otimes\\boldsymbol{I}_t\\bigg]\\] 然后 \\(\\boldsymbol{X&#39;\\Sigma}^{-1}\\boldsymbol{X}_1\\) 和 \\(\\boldsymbol{X&#39;\\Sigma}^{-1}\\boldsymbol{y}\\) 简化为 \\[\\begin{aligned}\\boldsymbol{X}_1^{\\prime}\\boldsymbol{\\Sigma}^{-1}\\boldsymbol{X}_1&amp;=\\frac{n{b}}{{\\lambda}_1}\\bigg(\\frac1t\\boldsymbol{J}_t\\bigg)+\\frac{n{b}}{{\\lambda}_2}{\\bigg(\\boldsymbol{I}_t-\\frac1t\\boldsymbol{J}_t\\bigg)}\\\\\\boldsymbol{X}_1^{\\prime}\\boldsymbol{\\Sigma}^{-1}&amp;=\\frac1{{\\lambda}_1}\\boldsymbol{j}_n^{\\prime}\\otimes\\boldsymbol{j}_b^{\\prime}\\otimes\\frac1t\\boldsymbol{J}_t+\\frac1{{\\lambda}_2}\\boldsymbol{j}_n^{\\prime}\\otimes\\boldsymbol{j}_b^{\\prime}\\otimes\\bigg(\\boldsymbol{I}_t-\\frac1t\\boldsymbol{J}_t\\bigg)\\end{aligned}\\] 接着可以证明 \\[(\\boldsymbol X_1^{\\prime}\\boldsymbol \\Sigma^{-1}\\boldsymbol X_1)^{-1}=\\frac{\\lambda_1}{nb}{\\left(\\frac1t\\boldsymbol J_t\\right)}+\\frac{\\lambda_2}{nb}{\\left(\\boldsymbol I_t-\\frac1t\\boldsymbol J_t\\right)}\\] 因此 \\(\\boldsymbol \\mu\\) 的估计为36 \\[\\hat{\\boldsymbol\\mu}=(\\boldsymbol X_1^{\\prime}\\boldsymbol\\Sigma^{-1}\\boldsymbol X_1)^{-1}\\boldsymbol X_1^{\\prime}\\boldsymbol\\Sigma^{-1}\\boldsymbol y=\\left(\\frac1n\\boldsymbol j^{\\prime}_n\\otimes\\frac1b\\boldsymbol{j}_b^{\\prime}\\otimes\\boldsymbol{I}_t\\right)\\boldsymbol{y}=(\\boldsymbol X_1^{\\prime}\\boldsymbol{X}_1)^{-1}\\boldsymbol{X}_1^{\\prime}\\boldsymbol{y}\\] 因此，\\({\\mu}\\) 的估计值为 \\(\\hat{\\mu}_i=\\bar{y}_{i\\cdot\\cdot},i=1,2,\\ldots,t\\). \\(\\hat{\\boldsymbol\\mu}\\) 的方差为 \\[\\mathrm{Var}(\\hat{\\boldsymbol\\mu})=(\\boldsymbol X_1^{\\prime}\\boldsymbol{\\Sigma}^{-1}\\boldsymbol{X}_1)^{-1}=\\frac{{\\sigma}_\\varepsilon^2+n{\\sigma}_{m\\times p}^2+nt{\\sigma}_p^2}{nb}\\biggl(\\frac1t\\boldsymbol{J}_t\\biggr)+\\frac{{\\sigma}_\\varepsilon^2+n{\\sigma}_{m\\times p}^2}{nb}\\biggl(\\boldsymbol{I}_t-\\frac1t\\boldsymbol{J}_t\\biggr)\\] 因此 \\(\\hat{\\mu}_i\\) 的方差为 \\[\\mathrm{Var}(\\hat{\\mu}_i)=\\frac{\\sigma_\\varepsilon^2+n\\sigma_{m\\times p}^2+n\\sigma_p^2}{nb}\\] 对于机器-人的例子，每个机器均值的方差为 \\[\\mathrm{Var}(\\hat{\\mu}_i)=\\frac{\\sigma_\\varepsilon^2+3\\sigma_{m\\times p}^2+3\\sigma_p^2}{18}\\] 对比 \\(\\boldsymbol{a}^{\\prime}\\boldsymbol{\\mu}\\)（其中 \\(\\boldsymbol{a&#39;j}_t=\\boldsymbol{0}\\)）的估计为 \\(\\boldsymbol{a}^{\\prime}\\hat{\\boldsymbol{\\mu}}\\)，其方差为 \\[\\operatorname{Var}(\\boldsymbol a^{\\prime}\\hat{\\boldsymbol \\mu})=\\frac{\\sigma_\\varepsilon^2+n\\sigma_{m\\times p}^2}{nb}\\boldsymbol{a&#39;a}\\] 差值 \\(\\mu_i-\\mu_{i^{\\prime}}\\left(i\\neq i^{\\prime}\\right)\\) 的估计为 \\(\\hat{\\mu_i}-\\hat{\\mu}_{i^{\\prime}}\\)，其方差为 \\[\\mathrm{Var}(\\hat{\\mu}_i-\\hat{\\mu}_{i^{\\prime}})=2{\\left[\\frac{\\sigma_\\varepsilon^2+n\\sigma_{m\\times p}^2}{nb}\\right]}\\] 两个机器均值之差的标准误估计为 \\[\\widehat{s.e.}_{\\mu_i-\\mu_{i^\\prime}}=\\sqrt{\\frac{2(MSPerson\\times Machine)}{18}}=2.177\\] 表 23.7 包含机器均值估计、标准误估计、\\(t\\) 值和显著性水平，用于检验单个均值是否等于零。机器均值之间的成对差值如表 23.8 所示，其中包括差值估计、标准误估计、\\(t\\) 值和显著水平。用于比较两个均值的 \\(LSD_{0.05}\\) 值计算为 \\[LSD_{0.05}=(t_{0.025,10})(\\widehat{s.e}._{\\hat{\\mu}_i-\\hat{\\mu}_{i^\\prime}})=2.228(2.177)=4.85\\] 表 23.7: 均衡数据集的机器均值和标准误估计 x 表 23.8: 均衡数据集的机器均值之间的成对差值 x 所有的差值都大于 4.85，因此 LSD 显示机器均值彼此之间都有显著差异。 为了检验等均值假设，\\(H_0\\colon\\mu_1=\\mu_2=\\mu_3\\mathrm{~vs~ }H_a\\colon(\\text{not }H_0)\\)，使用表 23.2 中的期望均方来构建检验统计量 \\[F_{mc}=\\frac{MSMachine}{MSPerson\\times Machine}=20.58\\] 与等均值假设对应的显著性水平为 0.0004。这个例子表明，对于均衡的情况，分析是非常简单的。然而，对不均衡情况的分析并不是那么容易。 23.2 不均衡双向混合模型 此例中表 23.1 的数据与均衡示例中的数据相同，只是随机删除了一些观测值。这样做是为了演示在分析不均衡数据集时出现的问题，并比较均衡和不均衡情况下的估计程序。描述此数据的模型与第 23.1 节中均衡数据集的模型相同，或者 \\[y_{ijk}=\\mu+\\tau_i+p_j+(\\tau p)_{ij}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,b,\\quad k=1,2,\\ldots,n_{ij}\\] 不均衡数据的方差分析表如表 23.9 所示。平方和是通过拟合常数法获得的，或 I 型平方和；即， \\[\\begin{aligned}SSMachine&amp;=R(\\tau|\\mu)\\\\SSPerson&amp;=R(p|\\mu,\\tau)\\\\SSPerson\\times Machine&amp;=R((\\tau p)|\\mu,\\tau,p)\\end{aligned}\\] 表 23.9 包含了相应的期望均方。 表 23.9: 不均衡数据集基于 I 型平方和的方差分析表 x 首先，考虑估计 \\(\\sigma_p^2\\). 在不均衡的情况下，MSPerson 和 MSPerson × Machine 的期望均方中的 \\(\\sigma_{m\\times p}^2\\) 系数不相同。因此为了估计 \\(\\sigma_p^2\\)，我们需要找到一个关于所有三个期望均方的函数，该函数等于 \\(\\sigma_p^2\\). 可以证明 \\[\\begin{aligned} \\tilde{\\mathcal{\\sigma}}_p^2 &amp;=\\frac1{7.219}{\\left[(\\tilde{\\sigma}_\\varepsilon^2+2.5866\\tilde{\\sigma}_{m\\times p}^2+7.2190\\tilde{\\sigma}_p^2)-\\frac{2.5866}{2.3162}(\\tilde{\\sigma}_\\varepsilon^2+2.3162\\tilde{\\sigma}_{m\\times p}^2)+\\left(\\frac{2.5866}{2.3162}-1\\right)\\tilde{\\sigma}_\\varepsilon^2\\right]} \\\\ &amp;=\\frac1{7.219}{\\left[(\\tilde{\\sigma}_\\varepsilon^2+2.5866\\tilde{\\sigma}_{m\\times p}^2+7.2190\\tilde{\\sigma}_p^2)-1.1167(\\tilde{\\sigma}_\\varepsilon^2+2.3162\\tilde{\\sigma}_{m\\times p}^2)+(0.1167)\\tilde{\\sigma}_\\varepsilon^2\\right]} \\\\ &amp;=\\frac1{7.219}[{E}(MSPerson)-1.1167{E}(MSPerson\\times\\text{М}SMachine)+(0.1167){E}(MSResidual)] \\end{aligned}\\] I 型平方和的矩法方程组为 \\[\\begin{aligned} \\text{MSPerson}&amp; =\\tilde{\\sigma}_\\varepsilon^2+2.5866\\tilde{\\sigma}_{m\\times p}^2+7.2190\\tilde{\\sigma}_p^2 \\\\ \\text{MSPerson × Machine}&amp; =\\tilde{\\sigma}_\\varepsilon^2+2.3162\\tilde{\\sigma}_{m\\times p}^2 \\\\ MSResidual&amp;=\\tilde{\\sigma}_\\varepsilon^2 \\end{aligned}\\] 同时求解上述方程组给出了每个方差分量的 I 型矩法估计为 \\[\\begin{aligned} \\tilde{{\\sigma}}_p^2&amp; =\\frac1{7.219}[MSPerson-1.1167 MSPerson\\times Machine+0.1167MSResidual] \\\\ &amp;=\\frac1{7.219}{\\left[201.7527-1.1167(40.4315)+0.1167(0.8726)\\right]}=21.7073 \\\\ \\tilde{{\\sigma}}_{m\\times p}^2&amp; =\\frac1{2.3162}[MSPerson\\times Machine-MSResidual] \\\\ &amp;=\\frac1{2.3162}{\\left[40.4315-0.8726\\right]}{=17.0792} \\\\ \\tilde{{\\sigma}}_\\varepsilon^2&amp;=MSResidual=0.8726 \\end{aligned}\\] 表 23.10 – 23.13 给出了从 REML, ML, MIVQUE0, I 型, II 型和 III 型方法获得的方差分量估计。使用 MIVQUE0 法的残差方差分量的解是 0.（如果在 SAS-Mixed 中使用 nobound 选项，则解为负。如果有一个我们应该始终能够估计的方差分量，那就是残差）表 23.13 中的总结表明，REML 方法似乎处于其他方法估计的中间。 表 23.10: 不均衡数据集残差方差分量的估计 x 表 23.11: 不均衡数据集 Person 方差分量的估计 x 表 23.12: 不均衡数据集 Person × machine 方差分量的估计 x 表 23.13: 不均衡数据集方差分量估计的总结 x 用于获得这些结果的 SAS-Mixed 代码如表 23.14 所示，其中 Method=REML 可替换为 ML, MIVQUE0, type1, type2 或 type3，以产生其他结果。这些表格包含方差分量估计、标准误估计、重新计算的自由度、置信区间和重新计算的 Satterthwaite 置信区间。回想一下，REML, ML 和 MIVQUE0 的方差分量置信区间是基于使用 \\(df=2(\\text{Z-value})^2\\) 的卡方分布的。lower 和 newlower 以及 upper 和 newupper 对于这些方法是相同的。当 Method 为 I 型、II 型或 III 型时，使用 Wald 区间为方差分量（残差除外）提供区间。newlower 和 newupper 是重新计算的置信区间，将是所选的区间。 表 23.14: 用于生成不均衡数据集 REML 估计和分析的 SAS Mixed 代码 x 表 23.9 中的 \\(F\\) 统计量可用于检验关于方差分量的假设。用于检验 \\(H_0\\colon{\\sigma}_{p}^2=0\\text{ vs }H_a\\colon{\\sigma}_{p}^2&gt;0\\) 的统计量是 \\(F=4.48\\)，分子自由度为 5，分母自由度为 9.9549. 显著性水平为 0.0003. 用于检验 \\(H_0\\colon{\\sigma}_{m\\times p}^2=0\\text{ vs }H_a\\colon{\\sigma}_{m\\times p}^2&gt;0\\) 的统计量是 \\(F=46.34\\)，分子自由度为 10，分母自由度为 26. 显著性水平小于 0.0001. 似然比检验也可用于检验关于方差分量的假设。该过程包括获取完全模型方差分量的 ML 估计，并计算 -2 log(full likelihood function)，如表 23.15 所示。为了检验 \\(H_0\\colon{\\sigma}_{m\\times p}^2=0\\text{ vs }H_a\\colon{\\sigma}_{m\\times p}^2&gt;0\\)，我们需要拟合一个不含 person × machine 的模型，并计算 -2 log(reduced likelihood function). 似然比检验统计量计算为 LR test = -2 log(reduced likelihood function) - [-2 log(full likelihood function)]，等于 55.5665，并且渐近分布于自由度为 1 的卡方分布。此检验的显著性水平小于 0.0001. 为了检验 \\(H_0\\colon{\\sigma}_{m\\times p}^2=0\\text{ vs }H_a\\colon{\\sigma}_{m\\times p}^2&gt;0\\)，我们需要拟合一个不含 person 的模型，并计算 -2 log(reduced likelihood function). 似然比检验统计量计算为 LR test = -2 log(reduced likelihood function) - [-2 log(full likelihood function)]，等于 6.4226，并且渐近分布于自由度为 1 的卡方分布。此检验的显著性水平为 0.0113. 表 23.15: 关于 \\({\\sigma}_{p}^2\\) 和 \\({\\sigma}_{g}^2\\) 假设的似然比检验的三种模型的方差分量的 ML 估计 x 固定效应参数的估计计算为 \\[\\hat{\\boldsymbol{\\beta}}_W=\\left(\\boldsymbol X^{\\prime}\\hat{\\boldsymbol{\\Sigma}}^{-1}\\boldsymbol X\\right)^{-}\\boldsymbol X^{\\prime}\\hat{\\boldsymbol{\\Sigma}}^{-1}\\boldsymbol y\\] 其中 \\(\\hat{\\boldsymbol{\\Sigma}}\\) 是在通过特定方法估计方差分量时，在方差分量估计处评估得到的协方差阵估计37，以及 \\(\\hat{\\boldsymbol{\\beta}}\\) 的方差-协方差阵为 \\(\\mathrm{Var}({\\hat{\\boldsymbol\\beta}})=\\left({\\boldsymbol{X&#39;\\Sigma}}^{-1}\\boldsymbol{X}\\right)^-\\). 对于每种估计方差分量的方法，都获得了机器等均值的检验。表 23.16 总结了固定效应的 III 型检验。MIVQUE0 结果没有用处。REML 的分母自由度为 10.1，接近于均衡数据集的 10。ML 方法分母自由度太大，而 I–III 型方法太少。 表 23.16: 不均衡数据集固定效应 III 型检验的总结 x 表 23.17 - 23.19 包含了机器均值的估计。REML 与 I 型、II 型或 III 型结果之间没有太大差异。表 23.20 – 23.22 包含了在每种估计方差分量方法下，每对机器均值之差的估计。由于 REML 的分母自由度大约等于 10（如果数据集是均衡的，则这是预期结果），因此这些方法的结果之间存在差异。REML 方法似乎提供了最全面的结果。 表 23.17: Machine 1 均值的估计 x 表 23.18: Machine 2 均值的估计 x 表 23.19: Machine 3 均值的估计 x 表 23.20: Machine 1 和 2 均值之差的估计 x 表 23.21: Machine 1 和 3 均值之差的估计 x 表 23.22: Machine 2 和 3 均值之差的估计 x 表 23.23 显示了基于 REML 估计的等均值假设 \\(H_0{:}\\mu_1=\\mu_2=\\mu_3\\mathrm{~vs~}H_a{:}(\\text{not }H_a)\\) 的检验，其中基于 2 个分子自由度和 10.1 个分母自由度计算的 \\(F\\) 值为 19.96. 均衡数据集分析的分母自由度为 10（对应于 machine × person 交互的自由度），因此 10.1 是一个近似值。 表 23.23: 不均衡数据集等机器均值的 III 型检验 x 表 23.20 – 23.22 中的结果是每对机器均值之间的成对差值。同样，基于方差分量估计的 REML 方法的结果似乎是最好的，因为成对比较的自由度是 10.2, 10.1 和 10，这些值接近 10，就好像均衡分析的情况一样。 23.3 不均衡双向数据集的 JMP 分析 使用 JMP® 对不均衡数据集的分析包括构建如图 23.1 所示的数据表。变量 machine, person 和 rep 被定义为名义的，并且 rating 是连续的。fit model 界面如图 23.2 所示，其中 rating 已被选为 “Y” 变量，machine 是一种固定效应，person 以及 person 与 machine 的交互是随机效应。选择 REML 方法作为估计方差分量的方法。方差分量的 REML 估计以及标准误估计和 Wald 置信区间如图 23.3 所示。等均值假设 \\(H_0{:}\\mu_1=\\mu_2=\\mu_3\\mathrm{~vs~}H_a{:}(\\text{not }H_a)\\) 的检验如图 23.4 所示，其中基于 2 个分子自由度和 10.11 个分母自由度计算的 \\(F\\) 值为 19.9639. 图 23.1: JMP 数据表屏幕 图 23.2: JMP fit model 界面，包含响应变量和模型效应 图 23.3: JMP 方差分量的 REML 估计 图 23.4: JMP 机器效应检验 最小二乘均值及其标准误估计如图 23.5 所示。使用 LSD 多重比较方法对均值进行成对比较，结果包括差值、标准误估计和 95% 置信区间，如图 23.6 所示。使用 JMP 的 estimate 过程的结果与使用 REML 方法的 SAS Mixed 的结果相同，同之处在于置信区间是使用 Wald 法构建的，而不是使用 Satterthwaite 近似法。 图 23.5: 机器最小二乘均值和标准误估计 图 23.6: 机器均值的 LSD 多重比较 23.4 结束语 对于均衡数据集，只要方差分量的解为正，REML, MIVQUE0 和矩法这三种估计方差分量的方法就能提供相同的结果。这些方法对于固定效应的分析也提供相同的结果。当数据集不均衡衡时，REML 方法似乎为固定效应的分析提供了最佳结果。主要指标是，使用方差分量的 REML 估计来比较机器均值的误差自由度与均衡数据集的误差自由度相似38。使用 REML 选项的 JMP 提供的结果与使用 REML 方法的 SAS-Mixed 获得的方差分量和固定效应的估计相同。不幸的是，关于方差分量构建的置信区间使用了 Wald 法，这仅当与每个方差分量的估计相关联的自由度数量很大时才适用。对于小样本量数据集，使用 Satterthwaite 自由度近似的卡方置信区间优于 Wald 法提供的置信区间。 23.5 练习 原书在此处上下文中关于 \\(\\boldsymbol\\mu\\) 和 \\(\\mu\\) 的加粗以及角标较为混乱，此处译者做了修改。↩︎ 原文：where \\(\\hat{\\boldsymbol{\\Sigma}}\\) is the estimated covariance matrix evaluated at the estimates of the variance components from the specified method of estimating the variance components.↩︎ 原文：The main indicator is that the error degrees of freedom for comparing the machine means using the REML estimates of the variance components were similar to those for the balanced data set.↩︎ "],["chap24.html", "第 24 章 分析裂区型设计的方法 24.1 介绍 24.2 模型定义和参数估计 24.3 均值间比较的标准误 24.4 计算均值差标准误的一般方法 24.5 其他示例 24.6 样本量和功效考虑 24.7 使用 JMP 进行计算：示例 24.7 24.8 结束语 24.9 练习", " 第 24 章 分析裂区型设计的方法 “Numerical quantities focus on expected values, graphical summaries on unexpected values.” - John Tukey 24.1 介绍 裂区型设计 (split-plot type design) 涉及一种具有多个实验单元尺寸的设计结构，其中较小尺寸的实验单元嵌套在较大尺寸的实验单元内。第 5 章介绍了裂区设计结构的一些示例，包括分层设计结构类 (class of hierarchal design structures). 裂区型设计结构的设计和分析存在两个主要问题。第一个问题包括选择和/或识别设计结构中使用的不同尺寸的实验单元，然后将处理从处理结构分配到设计结构中的不同实验单元尺寸。成功识别不同尺寸的实验单元对于指定可以描述结果数据的适当模型至关重要。第二个问题是构建适当的模型来描述处理和设计结构的相关特征。能够识别与每种尺寸的实验单元相关的变异源是很重要的。这些变异源用于计算各自的误差项，所述误差项用于计算均值估计的标准误估计 (estimates of the standard errors of estimated means) 以及用于均值之间的成对比较。由于这些设计结构涉及一个以上尺寸的实验单元，因此固定效应参数的标准误估计及其之间的比较涉及一个或多个变异源。裂区型设计模型的一个非常重要的特征是，它们是第 26 章中讨论的重复测量模型构建的基本模型。第 5 章介绍了几个概念的例子。 第 24.1 节解释了具有两种尺寸实验单元的裂区或分层设计结构的设计和分析，第 24.2 节描述了与固定效应相关的标准误的确定和估计。第 24.3 节讨论了在一般裂区设计结构中确定适当标准误及其对固定效应参数估计的一般方法。均值对比的标准误的计算在第 24.4 节中讨论。第 24.5 节介绍了裂区设计结构的四个示例，其中每个示例都演示了分析此类设计的一些显著特征。第 24.6 节讨论了裂区设计结构样本量的确定和功效的计算。本章给出了使用 SAS®-Mixed 和 JMP® 的分析，其中 JMP 分析如第 24.7 节所示。 构建裂区设计模型的关键概念是识别实验单元的不同尺寸，然后确定相应的设计结构和处理结构。整体模型是通过整合为每种尺寸的实验单元开发的模型而构建的。第 5 章中给出了模型构建的几个例子，但没有说明模型的基本假设。这些假设是，表示各种实验单元误差项的分量都是独立分布的，均值为零，并具有相关的方差 (associated variance)（更一般的假设请参见第 26 章）。在理想条件下，误差项呈正态分布。分析的目的是利用模型假设来获得总体参数的估计，并对其进行推断。在以下示例中，将使用矩法和 REML 方法来演示估计固定效应标准误所需的计算。在实践中，REML 是可在大多数情况下推荐使用的方法。 24.1.1 示例 24.1：面包配方和烘焙温度 烤面包的过程包括根据配方 (recipe) 的规格混合一批面包面团，将面团放入烤盘（容器）中，让面包发酵，然后将装有面包面团的烤盘放入烤箱 (oven) 中，在特定的温度 (temperature) 和时间组合下进行烘烤。每个烤箱都足够大，可以同时放入四个装有面包面团的烤盘。我们设计了一项实验，以评估四种不同的面包配方在三种不同温度下的烘烤效果，其中测量的响应是最终面包的体积。过程是，根据这四种配方分别制作面团，并将每种配方的一个面包放入设定为特定温度的单个烤箱中。这些批次在烤箱中放置指定的时间长度，然后将面包冷却至室温后再测量其体积。表 24.1 中的数据是在三天内重复该过程时，由四种配方和三种温度制成的面包的体积。在设计结构中，天 (day) 被视为一个区组因子。 表 24.1: 示例 24.1 各种配方和温度下的面包体积 (cm3) x 图 24.1 中的图表演示了为烤箱分配温度的过程，因此烤箱是温度水平的实验单元（请注意，配方不包括在该过程的此步骤中）。与烤箱尺寸实验单元相关的设计是随机完全区组设计结构（三天）中的单向处理结构（三个温度水平）。可用于描述每个烤箱内四个面包的平均面包体积（即每个烤箱一次观测）的模型是 \\[y_{ik}^o=\\mu_i^o+d_k^o+o_{ik}^o\\] 其中 \\(y_{ik}^o\\) 表示观测到的平均面包体积，\\(\\mu_{i}^o\\) 表示第 i 个温度水平的平均面包体积，\\(d_{k}^o\\) 表示第 k 天的随机效应，\\(o_{ik}^o\\) 表示第 i 个温度和第 k 天的随机烤箱效应。假设 \\(d_{k}^o\\thicksim i.i.d.N(0,\\sigma_d^2),o_{ik}^o\\thicksim i.i.d.N(0,\\sigma_o^2)\\) 并且所有 \\(d_{k}^o,o_{ik}^o\\) 独立。与烤箱模型相关的方差分析显示在表 24.2 中，其中烤箱误差项计算为温度与天的交互均方。 图 24.1: 显示每天将温度随机化到烤箱的示意图 表 24.2: 烤箱水平分析的方差分析表 x 图 24.2 中的图表显示了将配方分配到每个烤箱内的位置。一天内的烤箱是四个配方的一个区组。每个配方提供一条面包。面包设计是一个单向处理结构（四个配方），采用随机完全区组设计结构，共有九个区组（三天中每天三个区组或烤箱）。 图 24.2: 显示每天将配方随机化到一个烤箱内的位置的示意图 如果所有烤箱处于相同温度，则数据结构将是随机完全区组设计结构中的单向处理结构。但并非所有烤箱都经相同处理，三个烤箱设置为 325°F，三个设置为 340°F，三个设置为 355°F。接下来通过考虑 325°F 的所有数据来简化设计，如图 24.3 所示。所得数据来自具有三个区组的随机完全区组设计结构中的单向处理结构。该数据的误差项是配方与天的交互作用。可用于描述 325°F 烤箱数据的模型是 \\[y_{jk}^+=\\mu_j^++o_k^++\\varepsilon_{jk}^+\\] 其中 \\(y_{jk}^+\\) 表示第 k 天在第 j 个配方的 325°F 烤箱中观测到的面包体积，\\(\\mu_{j}^+\\) 表示第 j 个配方的平均面包体积，\\(o_{ik}^o\\) 表示第 k 天使用的烤箱的随机效应，以及 \\(\\varepsilon_{jk}^+\\) 表示第 j 个配方和第 k 天的随机面包效应。假设 \\(o_k^+\\thicksim i.i.d.N(0,\\sigma_0^2),\\varepsilon_{jk}^+\\thicksim i.i.d.N(0,\\sigma_\\varepsilon^2)\\) 且所有 \\(o_k^+,\\varepsilon_{jk}^+\\) 独立分布。与面包模型相关的方差分析显示在表 24.3 中，其中面包误差项根据天与配方的交互均方来估计。 图 24.3: 325°F 烤箱设计的一部分 表 24.3: 325°F 下面包体积数据的方差分析表 x 测量面包间变异性的误差项是通过合并三天内不同温度下的配方与天交互作用计算得出的 (The error term that measures the loaf to loaf variability is computed by pooling the recipe by day interaction across the three temperatures)，得到 Error(loaf)=Recipe × Day(Temperature). 将这两个模型结合起来得到模型 \\[y_{ijk}=\\mu_{ij}+d_k+o_{ik}+\\varepsilon_{ijk},\\quad i=1,2,3,\\quad j=1,2,3,4,\\quad k=1,2,3\\] 其中 \\({\\mu}_{ij}={\\mu}+T_i+R_j+(TR)_{ij}\\)，\\(T_i\\) 表示第 i 个温度的效应，\\(R_i\\) 表示第 j 个配方的效应，\\((TR)_{ij}\\) 表示温度与配方交互作用，\\(d_k\\) 表示第 k 天的效应，\\(o_{ik}\\) 表示第 k 天的第 i 个烤箱的效应，以及 \\(\\varepsilon_{ijk}\\) 表示误差项。在理想条件下 \\(d_k\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{day}}^2),o_{ik}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{oven}}^2),\\varepsilon_{ijk}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{loaf}}^2)\\)，且所有 \\(d_k,o_{ik},\\varepsilon_{ijk}\\) 独立分布。烤箱是整区 (whole plot) 或较大尺寸的实验单元，面包是子区 (subplot) 或裂区 (split-plot) 或较小尺寸的实验单元。 该模型可以用实验单元的尺寸表示为 \\[\\begin{aligned}y_{ijk}=&amp;\\mu_{ij}+d_k+T_i+o_{ik} &amp;&amp;\\}\\quad\\text{whole-plot or oven part of the model} \\\\&amp;+R_j+(TR)_{ij}+\\varepsilon_{ijk}&amp;&amp;\\}\\quad\\text{subplot or loaf part of the model}\\end{aligned}\\] 结合表 24.2 和 24.3 中的方差分析表给出表 24.4 中该模型的方差分析表。预期望均方决定了计算固定效应检验统计量的适当分母。Error(oven) 用作检验温度主效应的误差，Error(loaf) 用作检验配方主效应和配方与温度交互效应的误差。表 24.5 中列出了面包体积数据的 SAS-Mixed 代码和方差分析结果表。有迹象表明存在显著的温度与配方交互作用 (p = 0.0021)，因此应进一步比较 temperature × recipe 的双向均值（参见第 24.2 节） 表 24.4: 示例 24.1 面包体积数据的方差分析表 x 表 24.5: 示例 24.1 面包体积数据的方差分析表和 SAS-Mixed 代码 x 24.1.2 示例 24.2：在不同肥力条件下生长的小麦品种 图 24.4 中的数据是在四种不同的肥力条件 (fertility regimes) 下（A1, A2, A3 和 A4）种植的两种小麦（B1 和 B2）的产量（单位为磅）。田地被分成两个区组 (blocks)，每个区组有四个整区 (whole plots). 每个肥料 (fertilizer) 水平被随机分配到每个区组内的一个整区。因此，整区设计由一个单向处理结构（肥料的四个水平）组成，该结构是一个具有两个区组的随机完全区组设计结构。每个区组包含四个整区实验单元，这些单元被分成两部分（称为子区，subplots）。每种小麦被随机分配到每个整区内的一个子区。子区设计由单向处理结构（两个品种）和随机完全区组设计组成，共有八个区组，每个区组包含两个子区实验单元。可用于描述这些数据的模型是 \\[y_{ijk}=\\mu_{ij}+b_k+w_{ik}+\\varepsilon_{ijk},\\quad i=1,2,3,4,\\quad j=1,2,k=1,2\\] 其中，\\(\\mu_{ij}\\) 表示第 i 个肥料水平和第 j 个品种的预期响应（产量），\\(y_{ijk}\\) 表示第 k 个肥料水平和第 j 个品种的观测产量（响应），\\(b_k\\) 表示假设分布为 \\(i.i.d.N(0,\\sigma_{\\mathrm{block}}^2)\\) 的区组效应，\\(w_{ik}\\) 表示假设分布为 \\(i.i.d.~N(0,~\\sigma_{wp}^2)\\) 的整区误差，以及 \\(\\varepsilon_{ijk}\\) 表示假设分布为 \\(i.i.d.~N(0,~\\sigma_{\\varepsilon}^2)\\) 的子区误差。还假设所有 \\(b_k,w_{ik},\\varepsilon_{ijk}\\) 独立分布。平均响应可以使用效应模型表示为 \\(\\mu_{ij}=\\mu+F_i+V_j+(FV)_{ij}\\). 该效应模型的方差分析表见表 24.6. 三个固定效应比较的 \\(F\\) 检验的分母由期望均方确定；也就是说，Error(whole plot) 用于检验肥料主效应，Error(subplot) 用于检验通过品种主效应和肥料与品种交互效应。表 24.7 给出了 SAS Mixed 代码和使用 III 型平方和的数值结果，表 24.8 给出了使用 REML 选项的结果。这两种分析的固定效应的 \\(F\\) 检验是相同的，因为数据集是均衡的，并且两个方差分量的估计都大于零。 图 24.4: 品种与肥力条件的裂区示例数据 表 24.6: 示例 24.2 小麦产量数据的方差分析表 x 表 24.7: 示例 24.2 小麦产量数据使用 III 型平方和的方差分析表 x 表 24.8: 示例 24.2 小麦产量数据使用 REML 的方差分析表 x 24.2 模型定义和参数估计 考虑随机完全区组整区设计结构的裂区设计，其中具有 r 个区组、整区因子 A 有 a 个水平以及子区因子 C 有 c 个水平，其一般模型可以表达为： \\[y_{ijk}=\\mu+\\alpha_i+b_k+w_{ik}+\\gamma_j+(\\alpha\\gamma)_{ij}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,a,\\quad j=1,2,\\ldots,c,\\quad k=1,2,\\ldots,r\\] 其中，\\(y_{ijk}\\) 是观测到的响应，\\(b_k\\) 表示第 k 个区组效应，假设其分布为 \\(N(0,\\sigma_B^2)\\)，\\(w_{ik}\\) 表示整区误差，假设其分布为 \\(N(0,\\sigma_w^2)\\)，\\(\\varepsilon_{ijk}\\) 表示子区误差，假设其分布为 \\(N(0,\\sigma_\\varepsilon^2)\\). 还假设所有的 \\(b_k,w_{ik},\\varepsilon_{ijk}\\) 都是独立分布的。值得注意的是，最重要的假设是所有的 \\(b_k,w_{ik},\\varepsilon_{ijk}\\) 都是独立分布的。幸运的是，由于固定效应因子被随机分配到其适当尺寸的实验单元，这一假设可以通过随机化过程得到保证。该模型中的固定效应包括总均值 \\(\\mu\\)，整区因子（A）的效应 \\(\\alpha_i\\)、子区因子（C）的效应 \\(\\gamma_j\\)，以及整区因子水平和子区因子水平之间的交互效应 \\((\\alpha\\gamma)_{ij}\\). 均值模型可以用效应模型表示为 \\(\\mu_{ij}=\\mu+\\alpha_i+\\gamma_j+(\\alpha\\gamma)_{ij}\\). 表 24.9 给出了这个一般模型的方差分析表，包括变异来源、自由度和期望均方。 表 24.9: 24.1 节一般裂区模型的方差分析表 x 整区误差计算为 Block × A 交互作用，子区误差是通过合并 A 的所有水平下 Block × C 交互作用计算得出的，记作 Block × C(A). 用于获得方差分量矩法估计的方程组为 \\[\\begin{aligned} \\text{MSBlock}&amp; =\\tilde{{\\sigma}}_\\varepsilon^2+c\\tilde{{\\sigma}}_w^2+ac\\tilde{{\\sigma}}_B^2 \\\\ \\text{MSError(whole plot)}&amp; =\\tilde{\\sigma}_\\varepsilon^2+c\\tilde{\\sigma}_w^2 \\\\ MSError(subplot)&amp;=\\tilde{\\sigma}_\\varepsilon^2 \\end{aligned}\\] 这些方程的矩法解是 \\[\\begin{aligned} \\tilde{{\\sigma}}_\\varepsilon^2&amp; =MSError(subplot) \\\\ \\tilde{{\\sigma}}_w^2&amp; =\\frac{MSError(wholeplot)-MSError(subplot)}c \\\\ \\tilde{{\\sigma}}_B^2&amp; =\\frac{MSBlock-MSError(wholeplot)}{ac} \\end{aligned}\\] 方差分量的矩法估计为 \\[\\begin{aligned} &amp;\\hat{{\\sigma}}_\\varepsilon^2 =\\tilde{\\sigma}_\\varepsilon^2 \\\\ &amp;\\hat{{\\sigma}_w^2} =\\begin{cases}\\tilde{{\\sigma}}_w^2&amp;\\operatorname{~if~}\\tilde{{\\sigma}}_w^2&gt;0\\\\0&amp;\\operatorname{~if~}\\tilde{{\\sigma}}_w^2\\leq0&amp;\\end{cases} \\\\ &amp;\\hat{{\\sigma}}_{B}^{2} =\\begin{cases}\\tilde{{\\sigma}}_B^2&amp;\\mathrm{~if~}\\tilde{{\\sigma}}_B^2&gt;0\\\\0&amp;\\mathrm{~if~}\\tilde{{\\sigma}}_B^2\\leq0&amp;\\end{cases} \\end{aligned}\\] \\(\\mu_{ij},\\bar{\\mu}_{i\\cdot},\\bar{\\mu}_{\\cdot j}\\) 的估计分别为 \\(\\bar{{y}}_{ij\\cdot},\\bar{{y}}_{i{\\cdot\\cdot}},\\bar{{y}}_{\\cdot j\\cdot}\\). A 水平之间的比较是整区间比较 (between whole plot comparisons)，用于检验 A 水平相等性的适当 \\(F\\) 统计量是 \\(F_A=MSA/MSError(whole plot)\\). C 水平之间的比较和 A × C 交互作用的比较是整区内比较 (within whole plot comparisons) 或整区内的子区间比较 (between subplot comparisons within a whole plot)，并且适当的 \\(F\\) 统计量是 \\(F_C=MSC/MSError(subplot)\\) 和 \\(F_{A×C}=MSA×C/MSError(subplot)\\). 这些 \\(F\\) 统计量是通过查看表 24.9 中的期望均方来构建的。 一旦计算出 \\(F\\) 检验以确定均值之间是否存在显著差异，下一步就是进行多重比较以确定差异发生的位置。以下部分介绍了计算裂区设计的各种均值差异的标准误的方法。 24.3 均值间比较的标准误 使用处理均值或处理组合均值的对比来研究处理效应，特别是当方差分析表明一种或多种固定效果与零显著不同时。样本均值对比的标准误是必要的，以确定均值对比是否等于零，或者构造关于均值对比的置信区间。通常，对比涉及两个均值的比较。因此，本节讨论了两个均值的比较，而一般的对比将在第 24.4 节中讨论。 为了演示确定适当标准误的方法，使用了一般裂区设计模型，其中整区设计是随机完全区组设计中的单向处理结构，子区处理结构涉及单向处理结构。这种情况下相应的效应模型可以表示为 \\[y_{ijk}=\\mu+\\alpha_i+b_k+iv_{ik}+\\gamma_j+(\\alpha\\gamma)_{ij}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,a,\\quad j=1,2,\\ldots,c,\\quad k=1,2,\\ldots,r\\] 均值模型可以表示为 \\[y_{ijk}=\\mu_{ij}+b_k+w_{ik}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,a,~j=1,2,\\ldots,c,~k=1,2,\\ldots,r\\] 其中各项如第 24.1 节所述。 根据 A 水平和 C 水平之间是否存在任何交互作用，我们可能会感兴趣于四种类型的比较。如果没有交互作用，则有兴趣将 A 的水平相互比较，并将 C 的水平相互比较。 为比较 C 的水平，需要比较两个 \\(\\bar{\\mu}_{\\cdot j}\\)，这是由 \\(\\bar{{y}}_{\\cdot j\\cdot}\\) 估计的。确定适当标准误的过程涉及用模型的一些量来表示 \\(\\bar{{y}}_{\\cdot j\\cdot}\\)，这些量是通过对 i 和 k 求和得到的39。C 的第 j 个主效应均值的模型是 \\(\\bar{y}_{{\\cdot}j{\\cdot}}=\\bar{{\\mu}}_{{\\cdot}j}+\\bar{b}_{{\\cdot}}+\\bar{{w}}_{{\\cdot}\\cdot}+\\bar{{\\varepsilon}}_{{\\cdot}j{\\cdot}}\\). 考虑差值 \\(\\bar{{\\mu}}_{\\cdot1}-\\bar{{\\mu}}_{\\cdot2}\\)， 其估计为 \\(\\bar{y}_{\\cdot 1\\cdot}-\\bar{y}_{\\cdot 2\\cdot}\\)，可以用关于 C 的均值模型表示为 \\(\\bar{y}_{\\cdot1\\cdot}-\\bar{y}_{\\cdot2\\cdot}=\\bar{\\mu}_{\\cdot1}-\\bar{\\mu}_{\\cdot2}+\\bar{\\varepsilon}_{\\cdot1\\cdot}-\\bar{\\varepsilon}_{\\cdot2\\cdot}\\)，因为涉及 \\(\\bar{b}_{{\\cdot}}+\\bar{{w}}_{{\\cdot}\\cdot}\\) 的项抵消了；也就是说，比较 \\(\\bar{y}_{\\cdot1\\cdot}-\\bar{y}_{\\cdot2\\cdot}\\) 不取决于整区误差，也不取决于区组误差。\\(\\bar{y}_{\\cdot1\\cdot}-\\bar{y}_{\\cdot2\\cdot}\\) 的方差可以证明等于 \\[\\mathrm{Var}(\\bar{y}_{\\cdot1\\cdot}-\\bar{y}_{\\cdot2\\cdot})=\\mathrm{Var}(\\bar{\\varepsilon}_{\\cdot1\\cdot}-\\bar{\\varepsilon}_{\\cdot2\\cdot})=\\frac{2\\sigma_\\varepsilon^2}{ar}\\] 其中均值 \\(\\bar{\\varepsilon}_{\\cdot1\\cdot}\\) 的方差为 \\(\\mathrm{Var}(\\bar{{\\varepsilon}}_{\\cdot1\\cdot})=\\sigma_\\varepsilon^2/ar\\) 其中 ar 为均值中的观测次数。类似地，对任何 \\(j\\ne j^\\prime\\)，\\(\\mathrm{Var}(\\bar{y}_{\\cdot j\\cdot}-\\bar{y}_{\\cdot j^\\prime\\cdot})=2\\sigma_\\varepsilon^2/ar\\)。\\(\\bar{y}_{\\cdot j\\cdot}-\\bar{y}_{\\cdot j^\\prime\\cdot}\\) 的标准误估计为 \\[\\widehat{s.e.}(\\bar{y}_{.j.}-\\bar{y}_{.j&#39;.})=\\sqrt{\\frac{2\\hat{\\sigma}_{\\varepsilon}^2}{ar}}=\\sqrt{\\frac{2MSError(subplot)}{ar}}\\quad\\text{for all }j\\neq j&#39;\\] 基于 a(c-1)(r-1) 自由度。如果要进行多重比较（见第 3 章），a(c-1)(r-1) 是在确定所需多重比较程序的分位数时需要使用的自由度。为了简单起见，计算 LSD 值，但 LSD 值可能不是用于给定情况的合适方法。用于比较两个子区处理均值的 LSD 值为 \\[\\mathrm{LSD}_\\alpha=[t_{\\alpha/2,a(c-1)(r-1)}]\\widehat{s.e.}(\\bar{y}_{\\cdot j\\cdot}-\\bar{y}_{\\cdot j^{\\prime}\\cdot})\\] 为了比较 A 的水平，需要比较由 \\(\\bar{{y}}_{i\\cdot \\cdot}\\) 估计的 \\(\\bar{{\\mu}}_{i\\cdot}\\). 量 \\(\\bar{{\\mu}}_{i\\cdot}\\) 可以用一般模型表示，通过对 j 和 k 求和，得到 \\(\\bar{y}_{i\\cdot\\cdot}=\\bar{\\mu}_{i\\cdot}+\\bar{b}_{\\cdot}+\\bar{w}_{i\\cdot}+\\bar{\\varepsilon}_{ij\\cdot\\cdot}\\) 对比 \\(\\bar{{\\mu}}_{1\\cdot}-\\bar{{\\mu}}_{2\\cdot}\\) 的估计为 \\(\\bar{{y}}_{1\\cdot \\cdot}-\\bar{{y}}_{2\\cdot \\cdot}\\)，可以用关于 \\(\\bar{{y}}_{i\\cdot \\cdot}\\) 的模型表示为 \\(\\bar{y}_{1\\cdot\\cdot}-\\bar{y}_{2\\cdot\\cdot}=\\bar{\\mu}_{1\\cdot}-\\bar{\\mu}_{2\\cdot}+\\bar{w}_{1\\cdot}-\\bar{w}_{2\\cdot}+\\bar{\\varepsilon}_{1\\cdot\\cdot}-\\bar{\\varepsilon}_{2\\cdot\\cdot}\\). 这种比较取决于整区和子区方差分量。\\(\\bar{y}_{1\\cdot\\cdot}-\\bar{y}_{2\\cdot\\cdot}\\) 的方差为 \\[\\begin{aligned} \\mathrm{Var}(\\bar{y}_{1\\cdot\\cdot}-\\bar{y}_{2\\cdot\\cdot}) &amp;=\\operatorname{Var}(\\bar{w}_{1\\cdot}-\\bar{w}_{2\\cdot}+\\bar{\\varepsilon}_{1\\cdot\\cdot}-\\bar{\\varepsilon}_{2\\cdot\\cdot}) \\\\ &amp;=\\frac{2\\sigma_w^2}r+\\frac{2\\sigma_\\varepsilon^2}{rc} \\\\ &amp;=\\frac{2(\\sigma_\\varepsilon^2+c\\sigma_w^2)}{rc} \\end{aligned}\\] \\(\\bar{y}_{1\\cdot\\cdot}-\\bar{y}_{2\\cdot\\cdot}\\) 的标准误估计为 \\[\\widehat{s.e.}(\\bar{y}_{1\\cdot\\cdot}-\\bar{y}_{2\\cdot\\cdot})=\\sqrt{\\frac{2(\\hat{\\sigma}_\\varepsilon^2+c\\hat{\\sigma}_w^2)}{rc}}=\\sqrt{\\frac{2MSError(wholeplot)}{rc}}\\] 基于 (r-1)(a-1) 个自由度。比较两个整区处理均值的 LSD 值为 \\(\\mathrm{LSD}_\\alpha=[t_{\\alpha/2,(a-1)(r-1)}]\\widehat{\\mathrm{s.e.}}(\\bar{y}_{1\\cdot\\cdot}-\\bar{y}_{2\\cdot\\cdot})\\) 当存在显著的 A × C 交互作用时，比较通常必须基于双向单元格均值的集合。在研究这些单元格均值时，必须考虑两种不同类型的比较。第一种类型出现在比较同一整区处理（A）水平下的两个子区处理（C）均值时，例如 \\(\\mu_{11}-\\mu_{12}\\). \\(\\mu_{11}-\\mu_{12}\\) 的最佳估计为 \\(\\bar{y}_{11\\cdot}-\\bar{y}_{12\\cdot}\\). 通过在一般模型中关于 k 求和，\\(\\bar{y}_{ij\\cdot}\\) 可表示为 \\({\\bar{y}}_{ij{\\cdot}}={\\mu}_{ij}+\\bar{b}_\\cdot+\\bar{w}_{i{\\cdot}}+{\\bar{\\varepsilon}}_{ij{\\cdot}}\\)，以及 \\(\\bar{y}_{11\\cdot}-\\bar{y}_{12\\cdot}\\) 的方差为 \\(\\mathrm{Var}(\\bar{y}_{11\\cdot}-\\bar{y}_{12\\cdot})=\\mathrm{Var}(\\bar{w}_{1{\\cdot}}+\\bar{{\\varepsilon}}_{11{\\cdot}}-\\bar{w}_{1{\\cdot}}\\bar{{\\varepsilon}}_{12\\cdot})=2{\\sigma}_{{\\varepsilon}}^2/r\\). 因此，在整区处理的相同水平上，子区处理间比较的方差仅取决于子区误差。\\(\\bar{y}_{11\\cdot}-\\bar{y}_{12\\cdot}\\) 标准误估计为 \\[\\widehat{s.e.}(\\bar{y}_{11\\cdot}-\\bar{y}_{12\\cdot})=\\sqrt{\\frac{2\\hat{\\sigma}_\\varepsilon^2}r}=\\sqrt{\\frac{2MSError(subplot)}r}\\] 相应的 LSD 值为 \\(\\mathrm{LSD}_{\\alpha}=[t_{\\alpha/2,a(r-1)(c-1)}]\\widehat{s.e.}(\\bar{y}_{1\\cdot}-\\bar{y}_{1\\cdot2})\\). 该 LSD 值可用于在整区处理的相同水平上比较任何一对子区处理。 第二种类型的比较发生在相同或不同子区处理水平下比较两个整区处理，例如 \\(\\mu_{11}-\\mu_{21}\\) 或 \\(\\mu_{11}-\\mu_{22}\\). 这两种类型的比较具有相同的标准误。\\(\\mu_{11}-\\mu_{21}\\) 的最佳估计为 \\(\\bar{y}_{11\\cdot}-\\bar{y}_{21\\cdot}\\)，用一般模型可表示为 \\(\\bar{y}_{11\\cdot}-\\bar{y}_{21\\cdot}={\\mu}_{11}-{\\mu}_{21}+\\bar{{w}}_{1\\cdot}-\\bar{{w}}_{2{\\cdot}}+\\bar{{\\varepsilon}}_{11{\\cdot}}-\\bar{{\\varepsilon}}_{21{\\cdot}}\\). 那么 \\[\\begin{aligned} \\mathrm{Var}(\\bar{y}_{11\\cdot}-\\bar{y}_{21\\cdot}) =&amp;\\operatorname{Var}(\\bar{w}_{1\\cdot}-\\bar{w}_{2\\cdot}+\\bar{\\varepsilon}_{11\\cdot}-\\bar{\\varepsilon}_{21\\cdot}) \\\\ =&amp;\\frac{2\\sigma_w^2}r+\\frac{2\\sigma_\\varepsilon^2}r \\\\ =&amp;\\frac{2(\\sigma_\\varepsilon^2+\\sigma_w^2)}r \\end{aligned}\\] 这种比较取决于整区和子区方差分量。 \\(\\sigma_\\varepsilon^2+\\sigma_w^2\\) 的一个无偏估计为 \\[\\widehat{\\sigma_\\varepsilon^2+\\sigma_w^2}=\\frac{MSError(wholeplot)+(c-1)MSError(subplot)}c\\] 有关 \\(\\widehat{\\sigma_\\varepsilon^2+\\sigma_w^2}\\) 的抽样分布不是卡方分布，而是卡方分布的线性组合。有关 \\(\\widehat{\\sigma_\\varepsilon^2+\\sigma_w^2}\\) 的自由度可使用 Satterthwaite 近似估计为 \\[\\hat{v}=\\frac{\\left(\\widehat{\\sigma_\\varepsilon^2+\\sigma_w^2}\\right)^2}{\\frac{\\begin{bmatrix}MSE(wholeplot)/c\\end{bmatrix}^2}{(r-1)(a-1)}+\\frac{\\left[\\frac{c-1}cMSE(subplot)\\right]^2}{a(r-1)(c-1)}}\\] 在相同或不同子区处理下比较两个整区处理的近似 LSD 值为 \\[\\mathrm{LSD}_\\alpha=(t_{\\alpha/2,\\hat{v}})\\sqrt{\\frac{2(\\widehat{\\sigma_\\varepsilon^2+\\sigma_w^2})}r}\\] 对于示例 24.1（表 24.1）中的数据，表 24.10 中给出了温度均值、配方均值和温度与配方均值。四种类型比较的标准误估计计算如下： 表 24.10: 表 24.1 中数据的配方、温度以及配方与温度组合的均值 x 比较配方的主效应均值：标准误估计为 \\[\\widehat{s.e.}(\\bar{y}_{\\cdot1\\cdot}-\\bar{y}_{\\cdot2\\cdot})=\\sqrt{\\frac{2(657.87)}{3(3)}}=12.09\\] 并且该标准误估计基于 18 个自由度。注意到 \\(t_{0.025,18}=2.101\\)，因此用于比较配方主效应均值的 5% LSD 值为 \\(\\text{LSD}_{0.05}=2.101(12.09)=25.40\\). 比较温度主效应均值：标准误估计为 \\[\\widehat{s.e.}(\\bar{y}_{1\\cdot\\cdot}-\\bar{y}_{2\\cdot\\cdot})=\\sqrt{\\frac{2\\left(4096.42\\right)}{3(4)}}=26.13\\] 并且该标准误估计基于 4 个自由度。那么 \\(t_{0.025,4}=2.776\\) 用于比较温度主效应均值的 5% LSD 值为 \\(\\text{LSD}_{0.05}=2.776(26.13) = 72.55\\). 在相同温度水平下比较配方均值：标准误估计为 \\[\\widehat{s.e.}(\\bar{y}_{11\\cdot}-\\bar{y}_{12\\cdot})=\\sqrt{\\frac{2(657.87)}3}=20.94\\] 并且该估计的标准误差基于 18 个自由度。因此，在相同温度水平下比较两个配方均值的 5% LSD 值为 \\(LSD _{0.05}=2.101(20.94)=43.99\\). 比较相同或不同配方水平下的温度均值：标准误估计为 \\[\\widehat{s.e.}(\\bar{y}_{11\\cdot}-\\bar{y}_{21\\cdot})=\\sqrt{\\frac{2\\left[\\frac144096.42+\\frac{(4-1)}4657.87\\right]}3}=\\sqrt{\\frac{2\\left[1517.51\\right]}3}=31.80\\] 基于 \\[\\hat{v}=\\frac{\\left(1517.51\\right)^2}{\\frac{\\left(\\frac144096.42\\right)^2}4+\\frac{\\left(\\frac34657.87\\right)^2}{18}}=8.35\\] 个自由度。注意到 \\(t_{0.025,8.35}=2.289\\)，因此，比较处于不同温度水平的两均值的 5% LSD 值为 \\(LSD _{0.05}=2.289(31.80) = 72.79\\). 接下来描述了为裂区型设计计算标准误的一般过程。 24.4 计算均值差标准误的一般方法 将上述技术应用于涉及多种实验单元尺寸的比较的标准误计算并不总是那么直接。本节描述了一种计算标准误和近似自由度的一般方法，该方法可应用于更复杂的情况。普通读者 (casual reader) 可以跳过这一节。该方法通过模型示例进行描述。 \\[y_{ijk}=\\mu+\\alpha_i+b_k+w_{ik}+\\gamma_j+(\\alpha\\gamma)_{ij}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,a,\\quad j=1,2,\\ldots,c,\\quad k=1,2,\\ldots,r\\] 基本上，该技术包括将给定的均值比较表示为分量 (components) 的和，其中每个分量是仅涉及一个实验单元尺寸的均值的比较。然后，比较的分量是独立分布的，比较的方差是通过将各分量的方差相加得到的。例如，\\({\\mu_{11}}-{\\mu_{21}}\\) 可表示为 \\[\\mu_{11}-\\mu_{21}=(\\bar{\\mu}_{1\\cdot}-\\bar{\\mu}_{2\\cdot})+[(\\mu_{11}-\\bar{\\mu}_{1\\cdot})-(\\mu_{21}-\\bar{\\mu}_{2\\cdot})]\\] 分量 \\((\\bar{\\mu}_{1\\cdot}-\\bar{\\mu}_{2\\cdot})\\) 是整区比较，分量 \\([(\\mu_{11}-\\bar{\\mu}_{1\\cdot})-(\\mu_{21}-\\bar{\\mu}_{2\\cdot})]\\) 是子区比较。这些分量的估计为 \\(\\hat{\\bar{{\\mu}}}_{1\\cdot}-\\hat{\\bar{{\\mu}}}_{2\\cdot}=\\bar{{y}}_{1\\cdot\\cdot}-\\bar{{y}}_{2\\cdot\\cdot}\\) 和 \\((\\hat{\\mu}_{11}-\\hat{\\bar{\\mu}}_{1\\cdot})-(\\hat{{\\mu}}_{21}-\\hat{\\bar{\\mu}}_{2\\cdot})=(\\bar{y}_{11\\cdot}-\\bar{y}_{1\\cdot\\cdot})-(\\bar{y}_{21\\cdot}-\\bar{y}_{2\\cdot\\cdot})\\). \\({\\mu_{11}}-{\\mu_{21}}\\) 的估计为 \\[\\begin{aligned} \\hat{{\\mu}}_{11}-\\hat{{\\mu}}_{21}&amp; =\\hat{\\bar{\\mu}}_{1\\cdot}-\\hat{\\bar{\\mu}}_{2\\cdot}+(\\hat{\\mu}_{11}-\\hat{\\bar{\\mu}}_{1\\cdot})-(\\hat{\\mu}_{21}-\\hat{\\bar{\\mu}}_{2\\cdot}) \\\\ &amp;=\\bar{y}_{11\\cdot}-\\bar{y}_{21\\cdot} \\end{aligned}\\] 由于从模型的整区部分计算出的比较与从子区部分计算出的比较是独立分布的，因此 \\(\\hat{{\\mu}}_{11}-\\hat{{\\mu}}_{21}\\) 的方差是 \\[\\mathrm{Var}(\\hat{\\mu}_{11}-\\hat{\\mu}_{21})=\\mathrm{Var}(\\bar{y}_{1\\cdot\\cdot}-\\bar{y}_{2\\cdot\\cdot})+\\mathrm{Var}[(\\bar{y}_{11\\cdot}-\\bar{y}_{1\\cdot\\cdot})-(\\bar{y}_{21\\cdot}-\\bar{y}_{2\\cdot\\cdot})]\\] 量 \\(\\bar{y}_{1\\cdot\\cdot}-\\bar{y}_{2\\cdot\\cdot}\\) 可用一般模型表示为 \\(\\bar{y}_{1\\cdot\\cdot}-\\bar{y}_{2\\cdot\\cdot}=\\bar{\\mu}_{1\\cdot}-\\bar{\\mu}_{2\\cdot}+\\bar{w}_{1\\cdot}-\\bar{w}_{2\\cdot}+\\bar{\\varepsilon}_{1\\cdot\\cdot}-\\bar{\\varepsilon}_{2\\cdot\\cdot}\\)，其方差为 \\[\\begin{aligned} \\mathrm{Var}(\\bar{y}_{1\\cdot\\cdot}-\\bar{y}_{2\\cdot\\cdot}) &amp;=\\operatorname{Var}(\\bar{w}_{1\\cdot}-\\bar{w}_{2\\cdot}+\\bar{\\varepsilon}_{1\\cdot\\cdot}-\\bar{\\varepsilon}_{2\\cdot\\cdot}) \\\\ &amp;=\\frac2{rc}(\\sigma_\\varepsilon^2+c\\sigma_w^2) \\end{aligned}\\] \\(\\mathrm{Var}(\\bar{y}_{1\\cdot\\cdot}-\\bar{y}_{2\\cdot\\cdot})\\) 的一个估计为 \\((2/rc) MSError(WholePlot)\\). 量 \\((\\bar{y}_{11\\cdot}-\\bar{y}_{1\\cdot\\cdot})-(\\bar{y}_{21\\cdot}-\\bar{y}_{2\\cdot\\cdot})\\) 可用一般模型表示为 \\[\\begin{aligned}(\\bar{y}_{11}.-\\bar{y}_{1\\cdot\\cdot})-(\\bar{y}_{21\\cdot}-\\bar{y}_{2\\cdot\\cdot})=&amp;(\\mu_{11}+\\bar{b}_{\\cdot}+\\bar{w}_{1\\cdot}+\\bar{\\varepsilon}_{11\\cdot})-(\\bar{\\mu}_{1\\cdot}+\\bar{b}_{\\cdot}+\\bar{w}_{1\\cdot}+\\bar{\\varepsilon}_{1\\cdot\\cdot})\\\\&amp;-(\\mu_{21}+\\bar{b}_{\\cdot}+\\bar{w}_{2\\cdot}+\\bar{\\varepsilon}_{21\\cdot})+(\\bar{\\mu}_{2\\cdot}+\\bar{b}_{\\cdot}+\\bar{w}_{2\\cdot}+\\bar{\\varepsilon}_{2\\cdot\\cdot})\\\\ =&amp;[(\\mu_{11}-\\bar{\\mu}_{1\\cdot})-(\\mu_{21}-\\bar{\\mu}_{2\\cdot})]+[(\\bar{\\varepsilon}_{11\\cdot}-\\bar{\\varepsilon}_{1\\cdot\\cdot})-(\\bar{\\varepsilon}_{21\\cdot}-\\bar{\\varepsilon}_{2\\cdot\\cdot})] \\end{aligned}\\] 方差为 \\[\\begin{aligned} \\mathrm{Var}[(\\bar{y}_{11\\cdot}-\\bar{y}_{1\\cdot\\cdot})-(\\bar{y}_{21\\cdot}-\\bar{y}_{2\\cdot\\cdot})]&amp; =\\mathrm{Var}[(\\bar{{\\varepsilon}}_{11{\\cdot}}-\\bar{{\\varepsilon}}_{1{\\cdot\\cdot}})-(\\bar{{\\varepsilon}}_{21{\\cdot}}-\\bar{{\\varepsilon}}_{2{\\cdot\\cdot}})] \\\\ &amp;=\\frac{2(c-1)}{cr}\\sigma_\\varepsilon^2 \\end{aligned}\\] \\(\\mathrm{Var}[(\\bar{y}_{11\\cdot}-\\bar{y}_{1\\cdot\\cdot})-(\\bar{y}_{21\\cdot}-\\bar{y}_{2\\cdot\\cdot})]\\) 的一个估计为 \\[\\widehat{\\mathrm{Var}}[(\\bar{y}_{11\\cdot}-\\bar{y}_{1\\cdot\\cdot})-(\\bar{y}_{21\\cdot}-\\bar{y}_{2\\cdot\\cdot})]=\\frac{2(c-1)}{rc}MSError(subplot)\\] 将整区分量方差与子区分量方差相结合产生 \\[\\mathrm{Var}[\\bar{y}_{11\\cdot}-\\bar{y}_{21\\cdot}]=\\left(\\frac2{rc}\\right)(\\sigma_\\varepsilon^2+c\\sigma_w^2)+\\frac{2(c-1)}{rc}\\sigma_\\varepsilon^2\\] \\(\\bar{y}_{11\\cdot}-\\bar{y}_{21\\cdot}\\) 的标准误估计为 \\[s.e.[\\bar{y}_{11\\cdot}-\\bar{y}_{21\\cdot}]=\\sqrt{\\left(\\frac2{rc}\\right)MSE(wholeplot)+\\frac{2(c-1)}{rc}MSE(subplot)}\\] 有关 \\(s.e.[\\bar{y}_{11\\cdot}-\\bar{y}_{21\\cdot}]\\) 的自由度可用 Satterthwaite 近似获得 \\[\\begin{aligned}\\hat{v}&amp;=\\frac{\\left\\{\\left(\\frac2{rc}\\right)[MSE(wholeplot)]+\\frac{2(c-1)}{rc}[MSE(subplot)]\\right\\}^2}{\\frac{\\left\\{\\left(\\frac2{rc}\\right)[MSE(wholeplot)]\\right\\}^2}{(a-1)(r-1)}+\\frac{\\left\\{\\frac{2(c-1)}{rc}[MSE(subplot)]\\right\\}^2}{a(r-1)(c-1)}}\\end{aligned}\\] 用一些简单的代数可以证明上面的 \\(s.e.[\\bar{y}_{11\\cdot}-\\bar{y}_{21\\cdot}]\\) 与第 24.2 节中得到的结果相同。 24.4.1 通过一般对比进行比较 可以为第 24.2 节中讨论的每个比较构建均值的一般对比。C 的水平或 \\(\\bar\\mu_{\\cdot j}\\) 之间的对比为 \\[\\theta=d_1\\bar{\\mu}_{\\cdot1}+d_2\\bar{\\mu}_{\\cdot2}+\\cdots+d_c\\bar{\\mu}_{\\cdot c}\\mathrm{~where~}\\sum_{j=1}^cd_j=0\\] 该对比的一个估计为 \\(\\hat\\theta=d_1\\bar{y}_{\\cdot1\\cdot}+d_2\\bar{y}_{\\cdot2\\cdot}+\\cdots+d_c\\bar{y}_{\\cdot c\\cdot}\\)，方差为 \\[\\mathrm{Var}(\\hat{\\theta})=\\frac{\\sigma_\\varepsilon^2}{ar}\\sum_{j=1}^cd_j^2\\] \\(\\hat\\theta\\) 的标准误估计为 \\[\\widehat{s.e.}(\\hat{\\theta})=\\sqrt{\\frac{MSError(subplot)}{ar}\\sum_{j=1}^cd_j^2}\\] A 的水平或 \\({\\bar{\\mu}}_{i\\cdot}\\) 的对比为 \\({\\tau}={h}_1{\\bar{\\mu}}_{1\\cdot}+{h}_2{\\bar{\\mu}}_{2\\cdot}+\\cdots+{h}_a{\\bar{\\mu}}_{a\\cdot}\\)，其中 \\(\\sum_{i=1}^a{h}_i=0\\)；它的估计为 \\(\\hat{\\tau}={h}_1{\\bar{y}}_{1\\cdot\\cdot}+{h}_2{\\bar{y}}_{2\\cdot\\cdot}+\\cdots+{h}_a{\\bar{y}}_{a\\cdot\\cdot}\\)，方差为 \\[\\mathrm{Var}(\\hat{\\tau})=\\left(\\frac{\\sigma_\\varepsilon^2+c\\sigma_w^2}{rc}\\right)\\sum_{i=1}^ah_i^2\\] \\(\\hat{\\tau}\\) 的标准误估计为 \\[\\widehat{s.e.}(\\hat{\\tau})=\\sqrt{\\left(\\frac{MSError(wholeplot)}{rc}\\right)\\sum_{i=1}^ah_i^2}\\] 在整区处理相同水平上子区处理的对比，即，\\(\\mu_{i1},\\mu_{i2},\\ldots,\\mu_{ic}\\) 的一个对比为 \\(\\delta_i=s_1\\mu_{i1}+s_2\\mu_{i2}+\\cdots+s_c\\mu_{ic}\\)，其中 \\(\\Sigma_{j=1}^cs_j=0\\). 它的估计为 \\(\\hat\\delta_i=s_1\\bar y_{i1\\cdot}+s_2\\bar y_{i2\\cdot}+\\cdots+s_c\\bar y_{ic\\cdot}\\)，方差为 \\[\\mathrm{Var}(\\hat{\\delta}_i)=\\frac{\\sigma_\\varepsilon^2}r\\sum_{j=1}^cs_j^2\\] \\(\\hat{\\delta}_i\\) 的标准误估计为 \\[\\widehat{s.e.}(\\hat{\\delta}_i)=\\sqrt{\\frac{MSError(subplot)}r\\sum_{j=1}^cs_j^2}\\] 在子区处理相同水平上整区处理的对比，即，\\({\\mu}_{1{j}},{\\mu}_{2{j}},\\ldots,{\\mu}_{{a}{j}}\\) 的一个对比为 \\({\\lambda}_j={u}_1{\\mu}_{1{j}}+{u}_2{\\mu}_{2{j}}+\\cdots+{u}_a{\\mu}_{{a}{j}}\\)，其中 \\({\\Sigma}_{i=1}^a{u}_i=0\\). 它的估计为 \\(\\hat\\lambda_j=u_1\\bar y_{1j\\cdot}+u_2\\bar y_{2j\\cdot}+\\cdots+u_a\\bar y_{aj\\cdot}\\)，方差为 \\[\\mathrm{Var}(\\hat{\\lambda}_j)=\\frac{(\\sigma_\\varepsilon^2+\\sigma_w^2)}r\\sum_{i=1}^au_i^2\\] \\(\\hat{\\lambda}_j\\) 的标准误估计为 \\[\\widehat{s.e.}(\\hat{\\lambda}_j)=\\sqrt{\\frac{(\\hat{\\sigma}_\\varepsilon^2+\\hat{\\sigma}_w^2)}r\\sum_{i=1}^au_i^2}\\] 其中 \\[\\hat{\\sigma}_\\varepsilon^2+\\hat{\\sigma}_w^2=\\frac{MSError(wholeplot)+(c-1)MSError(subplot)}c\\] 有关 \\(\\hat{\\sigma}_\\varepsilon^2+\\hat{\\sigma}_w^2\\) 的自由度是通过 Satterthwaite 近似（见第 24.2 节）获得的 \\[\\hat{v}=\\frac{(\\hat{\\sigma}_\\varepsilon^2+\\hat{\\sigma}_w^2)^2}{\\frac{\\left[\\frac1cMSE(wholeplot)\\right]^2}{(r-1)(a-1)}+\\frac{\\left[\\frac{c-1}cMSE(subplot)\\right]^2}{a(r-1)(c-1)}}\\] 接下来考虑 \\(\\mu_{ij}\\) 的任何线性组合，如 \\(\\sum_{i=1}^a\\sum_{j=1}^cg_{ij}\\mu_{ij}\\). 根据第 8 章，我们知道如果对于每个 j 有 \\({\\sum}_{i=1}^{{a}}{g}_{ij}={0}\\) 且对于每个 i 有 \\({\\sum}_{j=1}^{{c}}{g}_{ij}={0}\\)，则这样的对比是交互作用对比。可以证明 \\[\\begin{aligned} \\mathrm{Var}\\left(\\sum_{i=1}^a\\sum_{j=1}^cg_{ij}\\bar{y}_{ij\\cdot}\\right)&amp; =\\mathrm{Var}\\left(\\sum_{i=1}^a\\sum_{j=1}^cg_{{ij}}\\left(\\bar{b}_\\cdot+\\bar{w}_{i\\cdot}+\\bar{\\varepsilon}_{{ij\\cdot}}\\right)\\right)=\\mathrm{Var}\\left[\\sum_{i=1}^a\\sum_{j=1}^c\\left(g_{{ij}}\\bar{b}_\\cdot+g_{_{ij}}\\bar{w}_{{i\\cdot}}+g_{{ij}}\\bar{\\varepsilon}_{{ij\\cdot}}\\right)\\right] \\\\ &amp;=\\mathrm{Var}\\left[\\sum_{i=1}^a\\sum_{j=1}^c(g_{ij}\\bar{b}_\\cdot)\\right]+\\mathrm{Var}\\left[\\sum_{i=1}^a\\sum_{j=1}^c(g_{ij}\\bar{w}_{i\\cdot})\\right]+\\mathrm{Var}\\left[\\sum_{i=1}^a\\sum_{j=1}^c(g_{ij}\\bar{\\varepsilon}_{ij.})\\right] \\\\ &amp;=(g_{\\cdot\\cdot})^2\\frac{\\sigma_B^2}r+\\left[\\sum_{i=1}^a(g_{i\\cdot})^2\\right]\\frac{\\sigma_W^2}r+\\left[\\sum_{i=1}^a\\sum_{j=1}^c(g_{ij})^2\\right]\\frac{\\sigma_\\varepsilon^2}r \\end{aligned}\\] 如果 \\(\\sum_{i=1}^a\\sum_{j=1}^cg_{ij}\\mu_{ij}\\) 是交互作用对比，则 \\[\\mathrm{Var}\\Bigg(\\sum_{i=1}^a\\sum_{j=1}^cg_{ij}\\bar{y}_{ij\\cdot}\\Bigg)=\\Bigg[\\sum_{i=1}^a\\sum_{j=1}^c(g_{ij})^2\\Bigg]\\frac{\\sigma_\\varepsilon^2}r\\] 其方差估计为 \\[\\mathrm{Var}\\left(\\sum_{i=1}^a\\sum_{j=1}^cg_{ij}\\bar{y}_{ij\\cdot}\\right)=\\left[\\sum_{i=1}^a\\sum_{j=1}^c(g_{ij})^2\\right]\\frac{\\hat{\\sigma}_\\varepsilon^2}r\\] 相应的自由度为 a(r-1)(c-1). 接下来考虑由 \\(\\bar y_{i\\cdot}\\) 定义的 \\(A_{i\\cdot}\\) 主效应均值。作为 \\(\\sum_{i=1}^a\\sum_{j=1}^cg_{ij}\\bar{y}_{ij\\cdot}\\) 的一个特例，我们可以通过下式得到这个主效应均值 \\[g_{ij}=\\begin{cases}\\frac1c\\quad\\mathrm{if~}i=i^{\\prime}\\quad\\mathrm{~for~}j=1,2,...,c\\\\0\\quad\\mathrm{otherwise}\\end{cases}\\] 那么 \\((g_{\\cdot\\cdot})^2=1\\) 以及 \\(\\sum_{i=1}^a(g_{i\\cdot})^2=(g_{i^\\prime \\cdot})^2=1\\)，以及 \\[\\sum_{i=1}^a\\sum_{j=1}^c(g_{ij})^2=\\sum_{j=1}^c(g_{i&#39;j})^2=\\sum_{j=1}^c(\\frac1c)^2=\\frac1c\\] 因此 \\[\\mathrm{Var}(\\bar{y}_{i\\cdot\\cdot})=\\frac{\\sigma_B^2}r+\\frac{\\sigma_W^2}r+\\frac{\\sigma_\\varepsilon^2}{rc}=\\frac1{rc}(\\sigma_\\varepsilon^2+c\\sigma_W^2+c\\sigma_B^2)\\] 注意到 A 主效应均值的方差估计取决于区组、整区和子区方差分量。类似地，可以证明 C 主效应均值 \\(\\bar y_{\\cdot j\\cdot}\\) 的方差估计为 \\[\\mathrm{Var}(\\bar{y}_{\\cdot j\\cdot})=\\frac{\\sigma_B^2}r+\\frac{\\sigma_W^2}r+\\frac{\\sigma_\\varepsilon^2}{ra}=\\frac1{ra}(\\sigma_\\varepsilon^2+a\\sigma_W^2+a\\sigma_B^2)\\] 最后，\\(\\mu_{ij}\\) 的估计为 \\(\\bar y_{ij\\cdot}\\)，其方差为 \\[\\mathrm{Var}(\\bar{y}_{ij\\cdot})=\\frac{\\sigma_B^2}r+\\frac{\\sigma_W^2}r+\\frac{\\sigma_\\varepsilon^2}r=\\frac1r(\\sigma_\\varepsilon^2+\\sigma_W^2+\\sigma_B^2)\\] 注意，与这三个方差分量函数的每个估计相关的自由度将需要通过 Satterthwaite 法来估计。 许多研究人员使用效应模型而不是均值模型来描述他们的数据。重要的是能够将均值模型的对比表示为其在效应模型参数中的相应对比。例如，\\(\\delta_i\\) 的表达式为 \\[\\begin{aligned} {\\delta}_i&amp; =\\sum_{j=1}^cs_j\\mu_{ij} \\\\ &amp;=\\sum_{j=1}^cs_j[\\mu+\\alpha_i+\\gamma_j+(\\alpha\\gamma)_{ij}] \\\\ &amp;=\\sum_{j=1}^cs_j\\mu+\\sum_{j=1}^cs_j\\alpha_i+\\sum_{j=1}^cs_j\\gamma_j+\\sum_{j=1}^cs_j(\\alpha\\gamma)_{ij} \\\\ &amp;=\\mu\\sum_{j=1}^cs_j+\\alpha_i\\sum_{j=1}^cs_j+\\sum_{j=1}^cs_j\\gamma_j+\\sum_{j=1}^cs_j(\\alpha\\gamma)_{ij} \\\\ &amp;=\\sum_{j=1}^cs_j\\gamma_j+\\sum_{j=1}^cs_j(\\alpha\\gamma)_{ij}\\quad\\mathrm{~since~}\\sum_{j=1}^cs_j=0 \\end{aligned}\\] 因此，这种均值的对比涉及 \\(\\gamma_j\\) 和 \\((\\alpha\\gamma)_{ij}\\). 使用 SAS Mixed 进行对比的示例将在本章后面进行说明。 上面给出的估计和估计的标准误可以用于通过 \\(t\\) 检验来检验假设，并/或构建关于固定效应参数可估函数的置信区间。感兴趣的对比可能有多种选择。例如，如果一个因素的水平是定量的，可以使用线性、二次等对比来研究均值参数的可能趋势。其他对比可能包括将一组对照与每种处理进行比较。 24.5 其他示例 24.5.1 示例 24.3：水分和肥料 表 24.11: 示例 24.3 每盆中的干物质量的测量 x 表 24.11 中的数据来自一个实验，该实验测量了在不同水分 (moisture) 水平和不同肥料 (fertilizer) 量下种植的小麦植株的干物质量 (amount of dry matter). 实验中有 48 个不同的泥炭盆 (peat pots) 和 12 个塑料托盘 (plastic trays)；每个托盘可以放入四个盆。水分处理包括每天向托盘中添加 10, 20, 30 或 40 毫升的水，水被泥炭盆吸收。水分水平随机分配给托盘。托盘是大型实验单元或整区，整区设计是完全随机设计结构中的单向处理结构（四个水分水平）。肥料水平为每盆 2, 4, 6 或 8 毫克。四个肥料水平随机分配给每个托盘中的四个盆，以便每个肥料水平在每个托盘中出现一次。盆是最小的实验单元或裂区或子区，子区设计是随机完全区组设计结构中的单向处理结构（四个肥料水平），其中 12 个托盘是区组。在每个盆中种植小麦种子，30 天后测量每个盆中生长的小麦植株的干物质量。可用于描述分配给第 i 个水分水平和第 j 个肥料水平的第 k 个托盘中盆的干物质量的模型是 \\[y_{ijk}=\\mu_{ij}+t_{ik}+p_{ijk},\\quad i=1,2,3,4;~j=1,2,3,4;~k=1,2,3\\] \\(\\mu_{ij}\\) 是水分水平 i 与肥料水平 j 的平均干物质，\\(t_{ik}\\) 是分布为 \\(i.i.d.N(0,\\sigma^2_{\\text{tray}})\\) 的托盘误差项，\\(p_{ijk}\\) 是分布为 \\(i.i.d.N(0,\\sigma^2_{\\text{plot}})\\) 的盆误差项。请注意，\\(p_{ijk}\\) 等价于该模型中的残差。方差分析表如表 24.12 所示，其中显示了显著的水分与肥料交互作用。由于水分和肥料之间存在交互作用，因此在进行推断时使用表24.13 中给出的处理组合平均值。由于水分水平和肥料水平是等距的定量水平，正交多项式可以很容易地用于研究每一水分水平的肥料水平趋势和每一肥料水平的水分水平趋势。测量第 i 个水分水平下肥料的线性和二次趋势的对比（相同整区处理下的子区处理的对比）为 \\[\\begin{aligned}\\delta_{LinF|{M}_i}&amp;=-3\\mu_{i1}-\\mu_{i2}+\\mu_{i3}+3\\mu_{i4},\\quad &amp;&amp;i=1,2,3,4\\\\\\delta_{QuadF|{M}_i}&amp;=\\mu_{i1}-\\mu_{i2}-\\mu_{i3}+\\mu_{i4},\\quad &amp;&amp;i=1,2,3,4\\end{aligned}\\] 它们的估计分别为 \\[\\begin{aligned}\\hat{\\delta}_{LinF|M_i}&amp;=-3\\bar{y}_{i\\cdot1}-\\bar{y}_{i\\cdot2}+\\bar{y}_{i\\cdot3}+3\\bar{y}_{i\\cdot4},\\quad &amp;&amp;i=1,2,3,4,\\\\\\hat{\\delta}_{QuadF|M_i}&amp;=\\bar{y}_{i\\cdot1}-\\bar{y}_{i\\cdot2}-\\bar{y}_{i\\cdot3}+\\bar{y}_{i\\cdot4},\\quad &amp;&amp;i=1,2,3,4\\end{aligned}\\] 这些对比的方差分别为 \\[\\begin{aligned} \\mathrm{Var}(\\hat{\\delta}_{LinF|M_i})&amp; =\\frac{\\sigma_p^2}3[(-3)^2+(-1)^2+1^2+3^2] \\\\ &amp;=\\frac{20{\\sigma}_p^2}3 \\\\ \\mathrm{Var}(\\hat{\\delta}_{QuadF|M_i})&amp; =\\frac{\\sigma_p^2}3[(-1)^2+(-1)^2+1^2+1^2] \\\\ &amp;=\\frac{4{\\sigma}_p^2}3 \\end{aligned}\\] 表 24.12: 水分和肥料示例干物质量的方差分析表 x 表 24.13: 肥料与水分的干物质量单元格均值 x 标准误估计是通过将各自方差的平方根中的 \\(\\sigma^2_p\\) 替换为 \\(MSError(pot)\\) 来获得的。表 24.14 中给出了评估这些对比的 SAS-Mixed 代码。表 24.15 中给出了每种水分水平的肥料线性趋势和二次趋势的估计以及相应的标准误估计和 \\(t\\) 统计量（检验趋势是否为零）。 表 24.14: 带 estimate 语句的 SAS-Mixed 代码，用于评估线性和二次趋势 x 表 24.15: 每种水分水平下肥料线性和二次趋势的估计 x 注释: 线性和二次趋势的标准误估计分别为 2.239 和 1.001. 将 \\(t\\) 值与 \\(t_{lpha/2,24}\\) 进行比较 测量每个肥料水平下水分的线性和二次趋势的对比（相同子区处理下的整区处理的对比）为 \\[\\begin{aligned}\\lambda_{LinM|F_j}&amp;=-3\\mu_{1j}-\\mu_{2j}+\\mu_{3j}+3\\mu_{4j},\\quad &amp;&amp;j=1,2,3,4\\\\ \\lambda_{QuadM|F_j}&amp;=\\mu_{1j}-\\mu_{2j}-\\mu_{3j}+\\mu_{4j},\\quad &amp;&amp;j=1,2,3,4\\end{aligned}\\] 每种水分水平下肥料水平的估计和相应的方差为 \\[\\begin{aligned}\\hat{\\lambda}_{LinM|F_j}&amp;=-3\\bar{y}_{1j\\cdot}-\\bar{y}_{2j\\cdot}+\\bar{y}_{3j.}+3\\bar{y}_{4j\\cdot},\\quad &amp;&amp;j=1,2,3,4\\\\\\hat{\\lambda}_{QuadM|F_k}&amp;=\\bar{y}_{1j\\cdot}-\\bar{y}_{2j\\cdot}-\\bar{y}_{3j\\cdot}+\\bar{y}_{4j\\cdot},\\quad &amp;&amp;j=1,2,3,4\\end{aligned}\\] 以及 \\[\\begin{aligned} \\mathrm{Var}(\\hat{\\lambda}_{LinM|F_k}) &amp;=\\frac{\\sigma_{\\mathrm{pot}}^2+\\sigma_{\\mathrm{tray}}^2}3(3^2+1^2+1^2+3^2) \\\\ &amp;=\\frac{20(\\sigma_{\\mathrm{pot}}^2+\\sigma_{\\mathrm{tray}}^2)}3 \\\\ \\mathrm{Var}(\\hat{\\lambda}_{QuadM|F_k}) &amp;=\\frac{\\sigma_{\\mathrm{pot}}^2+\\sigma_{\\mathrm{tray}}^2}3(1^2+1^2+1^2+1^2) \\\\ &amp;=\\frac{4(\\sigma_{\\mathrm{pot}}^2+\\sigma_{\\mathrm{tray}}^2)}3 \\end{aligned}\\] 在各个方差的平方根中将标准误估计 \\(\\sigma_{\\mathrm{pot}}^2+\\sigma_{\\mathrm{tray}}^2\\) 替换为 \\(\\hat{\\sigma}_{\\mathrm{pot}}^2+\\hat{\\sigma}_{\\mathrm{tray}}^2=\\frac{MSError(tray)+(4-1)MSError(pot)}4\\). Satterthwaite 近似可用于获得与 \\(\\hat{\\sigma}_{\\mathrm{pot}}^2+\\hat{\\sigma}_{\\mathrm{tray}}^2\\) 相关的近似自由度。对于这个例子 \\[\\hat{\\sigma}_{\\mathrm{pot}}^2+\\hat{\\sigma}_{\\mathrm{tray}}^2=\\frac{3.406+(4-1)0.752}4=1.416\\] 基于 \\(\\hat v\\) 个自由度，其中 \\[\\hat{v}=\\frac{[3.406+(4-1)0.752]^2}{\\frac{[3.406]^2}8+\\frac{[(4-1)0.752]^2}{24}}=19.3\\] 表 24.15 给出了每种水分水平下肥料线性和二次趋势的估计以及相应的标准误估计和 \\(t\\) 统计量。表 24.15 显示，每种水分水平对肥料都有线性的响应，没有显著的二次趋势。表 24.16 显示，每种肥料水平对水分都有线性和二次响应。图 24.5 和 24.6 中的图表显示了每种水分水平对肥料的响应以及每种肥料水平对水分的响应。使用 Satterthwaite 近似来确定表 24.16 中给出的近似自由度。 图 24.5: 各水分水平下干物质量均值关于肥料水平的图形 图 24.6: 各肥料水平下干物质量均值关于水分水平的图形 表 24.16: 每种肥料水平水分线性和二次趋势的估计 x 注释: 线性和二次趋势的标准误估计分别为 3.072 和 1.374. 将 \\(t\\) 值与 \\(t_{lpha/2,19.3}\\) 进行比较 24.5.2 示例 24.4：具有裂区误差的回归 表 24.17: 完全回归模型的 SAS 混合代码和协方差参数估计 x 示例 24.3 中的水分和肥料水平是定量水平，因此可能有兴趣研究是否可以构建一个回归模型来描述数据。由于数据是相关的 (correlated)，因此这与通常的回归情况不同。需要混合模型软件来进行计算。为了获得适当的分析，需要将水分作为回归模型中的连续变量，并在 random 语句中作为 class 变量。Mst 用于表示作为连续变量的水分，mstblk（等于 mst）用于表示 class 变量。表 24.17 包含 SAS-Mixed 代码，其中 model 语句是水分（mst）和肥料（fr）的一般三次回归模型。random 语句纳入托盘误差项，并将相关结构强加给数据。表 24.17 给出了方差分量的估计，表 24.18 给出了回归系数的解。大多数显著性水平都相当大，大多数显著性水平都相当大，因此进行了几步删除过程（SAS-Mixed 中没有自动过程），直到所有剩余变量的系数都显著不同于零。缩减模型为 \\[DM_{ijk}=\\beta_0+\\beta_1mst_i+\\beta_2fr_j+\\beta_3(mst_i)(fr_j)+\\beta_4(mst_i)^2(fr_j)+\\beta_5(mst_i)(fr_j)^2+t_{ik}+p_{ijk}\\] 确定缩减模型是否充分描述了数据是令人感兴趣的，因此构造了一个欠拟合检验 (test for lack of fit). 设 frx=fr，并将 frx 包含在 class 语句中。在缩减模型中包括 mstblk × frx，如表 24.19 所示。表 24.20 的方差分析表中与 mstblk × frx 对应的 \\(F\\) 检验提供了缩减模型的欠拟合检验。在这种情况下，与欠拟合检验相对应的显著性水平为 0.5561，表明缩减模型充分描述了数据。表 24.21 中的代码显示了缩减模型并显示了协方差参数的估计，回归系数的估计如表 24.22 所示。与完全模型相比，缩减模型的托盘误差项略小，而残差或盆方差相似。缩减模型的预测值如图24.7 所示，水分与肥料单元格均值如图 24.8 所示。正如从拟合度检验的结果中所预期的那样，回归模型充分描述了单元格均值。 表 24.18: 全响应面模型参数的解 x 表 24.19: 用于缩减回归模型欠拟合检验的 SAS-Mixed 代码 x 表 24.20: 在 MSTBLK × FXR 中的欠拟合检验 x 表 24.21: 最终回归模型的 SAS 混合代码和协方差参数估计 x 表 24.22: 缩减回归模型参数的解 x 图 24.7: 干物质量随水分和肥料变化的预测曲面 图 24.8: 肥料和水分组合的均值 24.5.3 示例 24.5：混乱的裂区设计 表 24.23: 分配给每个区组内每个整区的品种与除草剂的组合 x 两名研究人员设计了一项研究，评估三种大豆品种 (variates) 对四种不同类型除草剂 (herbicides) 的响应。在 1 号试验点，第一名研究人员在两次重复中使用了裂区试验设计，其中大豆品种为整区的水平，除草剂为子区的水平。在 2 号试验点，第二名研究人员在两次重复中使用了裂区试验设计，但将除草剂水平分配给了整区，将品种水平分配给子区。希望进行组合分析 (combined analysis )，但由于两种设计非常不同，因此似乎不可能进行组合分析。然而，请记住，从第 5 章中可以看出，裂区设计结构无非是一个不完全区组设计，其中整区是不完全区组设计的区组。14 个整区或不完全区组中的每一个整区的处理组合如表 24.23 所示，其中 Vx × y 表示含有除草剂 y 的品种 x. 前八个整区（来自 1 号试验点）是尺寸为三的不完全区组，后六个整区是尺寸为 4 的不完全区组。使用如下模型可以完成组合分析 \\[y_{ijkl}=\\mu_{kl}+b_i+w_{ij}+\\varepsilon_{ijkl}\\] 其中 \\(\\mu_{kl}\\) 是第 k 个品种和第 l 个除草剂的平均响应。\\(b_i\\thicksim i.i.d.~N(0,\\sigma_{blk}^2)\\) 每个试验点内的大区效应 (large block effects)，\\(w_{ij}\\thicksim i.i.d.~N(0,~\\sigma_{wp}^2)\\) 为整区或不完全区组效应，以及 \\({\\varepsilon_{ijkl}}\\thicksim{i.i.d.N(0,\\sigma_\\varepsilon^2)}\\) 为子区效应。数据见表 24.24 和 24.25，SAS-Mixed 代码和协方差参数估计见表 24.26. model 语句包含了品种（V）、除草剂（H）和品种与除草剂交互作用的处理结构。random 语句包含区组（试验点内的重复）和区组内的整区（不完全区组）。固定效应检验如表 24.27 所示，均值如表 24.28 所示。大豆品种和除草剂之间存在显著的交互作用，因此需要使用单元格均值进行比较。对于每个品种内除草剂水平的比较，差异标准误估计为 3.33，自由度为 26.1. 对于每种除草剂内品种的比较，差异标准误估计为 3.26，自由度为 24.7. 表 24.24: 示例 24.5 中来自 1 号试验点的数据。其中 H 和 V 分别表示除草剂和品种，表中的条目是大豆的重量 x 表 24.25: 示例 24.5 中来自 2 号试验点的数据。其中 H 和 V 分别表示除草剂和品种，表中的条目是大豆的重量 x 表 24.26: 示例 24.5 的 SAS-Mixed 代码和协方差参数估计 x 表 24.27: 示例 24.5 固定效应检验 x 表 24.28: 示例 24.5 品种与除草剂单元格均值、品种均值和除草剂均值的估计 x 24.5.4 示例 24.6：裂-裂区设计 裂-裂区设计 (split-split-plot design) 有三种尺寸的实验单元，即整区 (whole plot)、子区 (subplot) 和次子区 (subsubplot)，其中整区、子区和次子区分别是最大、中等和最小尺寸的实验单元。本研究旨在评估两种饲料 (rations)（普通玉米和高油玉米）、两种温度（3°C 和 6°C）和三种包装类型（真空、二氧化碳和低氧）的组合对肉嫩度的影响。二十头阉公牛 (steers) 随机分配了两种饲料（每种饲料 10 头）。屠宰时，动物被一分为二，从每侧 (side) 提取一块腰肉。腰肉被随机分配到两种储存温度中的一种。储存 10 天后，从每块腰肉上切下三块牛排，并将包装 (packaging) 水平分配给其中一块牛排。牛排被放入展示柜中再放置 7 天。置于展示柜 7 天后，从每块牛排上获得五个芯 (cores)，并测量剪切每个芯所需的力。表 24.29 中的数据是五个芯的平均值。由于一些包装问题，导致一些牛排不能代表真实状态，因此它们被从数据集中删除。 表 24.29: 示例 24.6 剪切力数据 x 本研究涉及三种尺寸的实验单元。动物是被分配饲料水平的实验单元。动物的侧是温度水平的实验单元，牛排是包装水平的实验单元。可以用来描述剪切力 (shear forces) (\\(f_{ijkl}\\))的模型是 \\[f_{ijkl}=\\mu_{ikl}+a_{ij}+s_{ijk}+\\varepsilon_{ijkl}\\quad i=1,2,j=1,2,\\ldots,10,k=1,2,l=1,2,3\\] 其中 \\(\\mu_{ikl}\\) 表示第 i 种饲料、第 k 种温度、第 l 种包装的平均响应，\\(a_{ij}\\thicksim i.i.d.~N(0,\\sigma_{\\mathrm{animal}}^2)\\) 表示动物误差，\\(s_{ijk}\\thicksim i.i.d.~N(0,\\sigma_{\\mathrm{side}}^2)\\) 表示侧误差，\\({\\varepsilon_{ijkl}}\\thicksim i.i.d.~N(0,\\sigma_{\\mathrm{steak}}^2)\\) 表示牛排误差。 动物误差项可以通过忽略处理结构中的温度和包装部分来获得。动物设计是一个完全随机设计结构中的单向处理结构，其中每个饲料分配了 10 只动物。因此，动物误差项是通过在相同饲料内经相同处理的动物之间的变异来计算的，其中合并了所有饲料 (the animal error term is computed as the variation among animals treated alike within a ration pooled across rations)，记作 animal(ration). 侧误差项是通过仅考虑分配了饲料 1 的动物并忽略包装效应来获得的。在饲料 1 内的每只动物针对两种温度形成尺寸为 2（两侧）的区组，因此侧设计是随机完全区组设计结构中（饲料 1 内的 10 只动物）的单向处理结构（两种温度）。因此，侧误差项是通过在同一饲料内的温度与动物交互作用来计算的，其中合并了所有饲料 (side error term is computed as the temperature by animal interaction within a ration pooled across rations)，记作 temp × animal(ration). 残差是牛排误差项，但其形式可以通过考虑来自饲料 1 和温度为 3°C 的数据来获得。来自饲料 1 并分配了 3°C 的动物的侧是三种包装类型的区组因子。牛排设计是随机完全设计结构中（分配了饲料 1 并在 3°C 下储存的动物的 10 个侧面）的单向处理结构（三个包装水平）。包装与动物交互作用是这部分数据的误差项。残差的计算形式是 package × animal(temp ration). 如果数据集是均衡的，则动物误差、侧误差和牛排误差项的自由度分别为 18, 18, 72. 为剪切力数据拟合裂-裂区模型的 SAS-Mixed 代码在表 24.30 中，其中 random 语句包含 animal(ration) 和temp × animal(ration)，分别表示整区误差和子区误差。协方差参数的估计也包含在表 24.30 中。固定效应检验在表 24.31 中给出，其中存在显著的 ration × temperature 和 ration × packaging交互作用。ration × temperature 的平均值在表 24.32 中给出，它们之间的成对比较在表 24.33 中给出。在 lsmeans 语句中使用了 adjust = Tukey 选项，以提供 Tukey 多重比较方法的调整 \\(p\\) 值。比较饲料内温度的标准误估计约为 0.45，而比较温度内饲料的标准误估计约为 0.679. 比较饲料内的温度是动物内比较 (within-animal comparisons)，而比较温度内的饲料是动物间比较 (between-animal comparisons)，因此具有较大的标准误估计。表 24.34 和 24.35 包含 ration × packaging 的均值和均值的成对比较。比较饲料内包装的标准误估计约为 0.49，而比较包装内饲料的标准误估计约为 0.71. 包装的比较是在动物的一侧进行的，而饲料的比较是在动物之间进行的，从而解释了两个标准误估计的大小差异。 表 24.30: 示例 24.6 的 SAS-Mixed 代码和协方差参数估计 x 表 24.31: 示例 24.6 固定效应检验 x 表 24.32: 示例 24.6 饲料与温度的力均值 x 表 24.33: 饲料与温度的力均值的成对比较，其中 Tukey 调整用于多重比较 x 表 24.34: 示例 24.6 饲料与包装的力均值 x 表 24.35: 饲料与包装的力均值的成对比较，其中 Tukey 调整用于多重比较 x 24.6 样本量和功效考虑 特定研究所需的样本量取决于最有趣的比较。用于检测两均值之差为 \\(\\delta\\) 的基本样本量方程，其中差异的方差为 \\(2\\sigma^2 /n\\)，\\(\\hat\\sigma^2\\) 是基于 v 个自由度的 \\(\\sigma^2\\) 的估计，第一类错误率为 \\(\\alpha\\)，第二类错误率为 \\(\\beta\\)，其公式为 \\[n=\\frac{2\\hat{\\sigma}^{2}}{\\delta^{2}}[t_{\\alpha/2,v}+t_{\\beta,v}]^{2}\\] 样本量方程可用于评估检验的功效，方法是求解 \\(t_{\\beta,v}\\)，然后确定功效为 \\(1-\\beta\\) 的值。\\(t_{\\beta,v}\\) 的方程为 \\[t_{\\beta,v}=\\sqrt{\\frac{n\\delta^2}{2\\hat{\\sigma}^2}}-t_{\\alpha/2,v}\\] 对于示例 24.6，假设感兴趣的是检测在某一温度水平下，饲料均值之间是否存在 1.5 个力单位的差异。表示第一个温度下两种饲料差异的参数是 \\(\\bar{{\\mu}}_{11\\cdot}-\\bar{{\\mu}}_{21\\cdot}\\). 如果数据集是均衡的，则 \\(\\bar{{\\mu}}_{11\\cdot}-\\bar{{\\mu}}_{21\\cdot}\\) 的最佳估计为 \\(\\bar{{f}}_{1\\cdot1\\cdot}-\\bar{{f}}_{2\\cdot2\\cdot}\\). \\(\\bar{{f}}_{i\\cdot k}\\) 的模型为 \\(\\bar{f}_{i\\cdot k\\cdot}=\\bar{\\mu}_{ik\\cdot}+\\bar{a}_{i\\cdot}+\\bar{s}_{i\\cdot k}+\\bar{\\varepsilon}_{i\\cdot k\\cdot}\\) 以及 \\(\\bar{{f}}_{1\\cdot1\\cdot}-\\bar{{f}}_{2\\cdot2\\cdot}\\) 的模型为 \\(\\bar{{\\mu}}_{11{\\cdot}}-\\bar{{\\mu}}_{21{\\cdot}}+\\bar{{a}}_{1{\\cdot}}-\\bar{{a}}_{2{\\cdot}}+\\bar{s}_{1\\cdot1}-\\bar{s}_{2\\cdot1}+\\bar{\\varepsilon}_{1\\cdot1\\cdot}-\\bar{\\varepsilon}_{2\\cdot1\\cdot}\\) 所需的样本量是每种饲料的动物数量，因为侧的数量以及每侧的牛排数量分别固定为 2 和 3. \\(\\bar{{f}}_{1\\cdot1\\cdot}-\\bar{{f}}_{2\\cdot2\\cdot}\\) 的方差为 \\[\\begin{aligned} \\mathrm{Var}(\\bar{f}_{1{\\cdot}1{\\cdot}}-\\bar{f}_{2{\\cdot}1{\\cdot}})&amp; =\\frac{2\\sigma_{\\mathrm{animal}}^2}n+\\frac{2\\sigma_{\\mathrm{side}}^2}n+\\frac{2\\sigma_{\\mathrm{steak}}^2}{3n} \\\\ &amp;=\\frac2{3n}(\\sigma_{\\mathrm{steak}}^2+3\\sigma_{\\mathrm{side}}^2+3\\sigma_{\\mathrm{animal}}^2) \\end{aligned}\\] 令第一类错误和第二类错误分别为 \\(\\alpha,\\beta\\)，检测出两均值之差为 \\(\\delta\\) 所需的每种饲料的动物数量为 \\[n=\\frac23(\\hat{\\sigma}_{\\mathrm{steak}}^2+3\\hat{\\sigma}_{\\mathrm{side}}^2+3\\hat{\\sigma}_{\\mathrm{animal}}^2)[t_{\\alpha/2,\\hat{v}}+t_{\\beta,\\hat{v}}]^2/\\delta^2\\] 其中 \\[\\hat{{\\sigma}}_{\\mathrm{steak~}}^2+3\\hat{{\\sigma}}_{\\mathrm{side~}}^2+3\\hat{{\\sigma}}_{\\mathrm{animal}}^2\\] 是 \\({{\\sigma}}_{\\mathrm{steak~}}^2+3{{\\sigma}}_{\\mathrm{side~}}^2+3{{\\sigma}}_{\\mathrm{animal}}^2\\) 的估计，基于 \\(\\hat v\\) 个自由度。使用均衡数据集的三个误差项的期望均方为 \\[\\begin{aligned} E[MSAnimal(Ration)]&amp;=\\sigma_{\\text{steak}}^2+3\\sigma_{\\text{side}}^2+6\\sigma_{\\text{animal}}^2\\\\ E[MSTemp\\times Animal(Ratiоn)]&amp;=\\sigma_\\mathrm{steak}^2+3\\sigma_\\mathrm{side}^2 \\\\ E[MSPack\\times Animal(Теmp* Ratiоn)]&amp;=\\sigma_{\\mathrm{steak}}^2 \\end{aligned}\\] \\({{\\sigma}}_{\\mathrm{steak~}}^2+3{{\\sigma}}_{\\mathrm{side~}}^2+3{{\\sigma}}_{\\mathrm{animal}}^2\\) 的一个无偏估计为 \\[\\hat{\\sigma}_{\\mathrm{steak}}^2+3\\hat{\\sigma}_{\\mathrm{side}}^2+3\\hat{\\sigma}_{\\mathrm{animal}}^2=\\frac12MSAnimal(Ration)+\\frac12MSTemp\\times Animal(Ration)\\] 其近似自由度可通过 Satterthwaite 法获得 \\[\\hat{v}=\\frac{(\\hat{\\sigma}_{\\mathrm{steak}}^2+3\\hat{\\sigma}_{\\mathrm{side}}^2+3\\hat{\\sigma}_{\\mathrm{animal}}^2)^2}{\\frac{[\\frac12\\textit{MSAnimal}(Ration)]^2}{18}+\\frac{[\\frac12\\textit{MSTemp}\\times Animal(Ration)]^2}{18}}\\] 当数据集不均衡时，可以使用来自 REML 的方差分量及其相应渐近协方差阵的估计来评估近似自由度。令 \\(f(\\sigma_\\varepsilon^2,\\sigma_\\mathrm{side}^2,\\sigma_\\mathrm{animal}^2)\\) 表示要待估的方差分量函数。\\(f(\\sigma_\\varepsilon^2,\\sigma_\\mathrm{side}^2,\\sigma_\\mathrm{animal}^2)\\) 的估计为 \\(f(\\hat\\sigma_\\varepsilon^2,\\hat\\sigma_\\mathrm{side}^2,\\hat\\sigma_\\mathrm{animal}^2)\\)，以及近似方差为 \\[\\mathrm{Var}\\Bigl[f(\\hat{\\sigma}_\\varepsilon^2,\\hat{\\sigma}_\\mathrm{side}^2,\\hat{\\sigma}_\\mathrm{animal}^2)\\Bigr]=\\begin{bmatrix}\\frac{\\partial f}{\\partial\\sigma_\\varepsilon^2}\\quad\\frac{\\partial f}{\\partial\\sigma_\\mathrm{side}^2}\\quad\\frac{\\partial f}{\\partial\\sigma_\\mathrm{animal}^2}\\end{bmatrix}\\mathrm{Var}\\Bigl[\\hat{\\sigma}_\\varepsilon^2,\\hat{\\sigma}_\\mathrm{side}^2,\\hat{\\sigma}_\\mathrm{animal}^2\\Bigr]\\begin{bmatrix}\\frac{\\partial f}{\\partial\\sigma_\\varepsilon^2}\\\\\\frac{\\partial f}{\\partial\\sigma_\\mathrm{side}^2}\\\\\\frac{\\partial f}{\\partial\\sigma_\\mathrm{animal}^2}\\end{bmatrix}\\] 在方差分量的 REML 估计处评估 \\(\\mathrm{Var}\\Bigl[f(\\hat{\\sigma}_\\varepsilon^2,\\hat{\\sigma}_\\mathrm{side}^2,\\hat{\\sigma}_\\mathrm{animal}^2)\\Bigr]\\)，并计算 \\[\\begin{aligned}Z=\\frac{f(\\hat{\\sigma}_\\varepsilon^2,\\hat{\\sigma}_\\mathrm{side}^2,\\hat{\\sigma}_\\mathrm{animal}^2)}{\\sqrt{\\widehat{\\text{Var}}\\left[f(\\hat{\\sigma}_\\varepsilon^2,\\hat{\\sigma}_\\mathrm{side}^2,\\hat{\\sigma}_\\mathrm{animal}^2)\\right]}}\\end{aligned}\\] 则与 \\(f(\\hat\\sigma_\\varepsilon^2,\\hat\\sigma_\\mathrm{side}^2,\\hat\\sigma_\\mathrm{animal}^2)\\) 相关的 Satterthwaite 近似自由度为 \\(\\hat v=2Z^2\\). 对于示例 24.6，使用分析结果并确定检测 1.5 剪切单位差异所需的动物数量，第一类和第二类错误率分别为 0.05 和 0.05. 表 24.30 中方差分量的估计为 \\(\\hat{\\sigma}_{\\mathrm{animal}}^2=1.2434,\\hat{\\sigma}_{\\mathrm{side}}^2=0.1992,\\hat{\\sigma}_{\\mathrm{steak}}^2=1.7529\\). \\({\\sigma}_\\mathrm{steak}^2+3{\\sigma}_\\mathrm{side}^2+3{\\sigma}_{\\mathrm{animal}}^2\\) 的估计为 6.08086. 方差分量渐近协方差阵的估计如表 24.36 所示，为 \\[\\widehat{\\text{Var}}\\begin{bmatrix}\\hat{{\\sigma}}_\\mathrm{arimal}^2\\\\\\hat{{\\sigma}}_\\mathrm{side}^2\\\\\\hat{{\\sigma}}_\\mathrm{steak}^2\\end{bmatrix}=\\begin{bmatrix}0.3723&amp;-0.06154&amp;0.002209\\\\-0.06154&amp;0.1305&amp;-0.05370\\\\0.002209&amp;-0.05370&amp;0.1296\\end{bmatrix}=\\hat{\\boldsymbol V}\\] 表 24.36: 示例 24.6 方差分量估计的渐近协方差阵 x 则 \\({\\hat\\sigma}_\\mathrm{steak}^2+3{\\hat\\sigma}_\\mathrm{side}^2+3{\\hat\\sigma}_{\\mathrm{animal}}^2\\) 的近似方差为 \\[\\widehat{\\mathrm{Var}}(\\hat{\\sigma}_{\\mathrm{steak}}^2+3\\hat{\\sigma}_{\\mathrm{side}}^2+3\\hat{\\sigma}_{\\mathrm{animal}}^2)=\\begin{bmatrix}3&amp;3&amp;1\\end{bmatrix}\\hat{\\boldsymbol V}\\begin{bmatrix}3\\\\3\\\\1\\end{bmatrix}=3.23805\\] 以及 \\(Z\\) 分数为 \\[Z=\\frac{\\hat{\\sigma}_\\mathrm{steak}^2+3\\hat{\\sigma}_\\mathrm{side}^2+3\\hat{\\sigma}_\\mathrm{animal}^2}{\\sqrt{\\widehat{\\mathrm{Var}}(\\hat{\\sigma}_\\mathrm{steak}^2+3\\hat{\\sigma}_\\mathrm{side}^2+3\\hat{\\sigma}_\\mathrm{animal}^2)}}=3.379\\] 因此与 \\(\\hat{\\sigma}_{\\mathrm{steak}}^2+3\\hat{\\sigma}_{\\mathrm{side}}^2+3\\hat{\\sigma}_{\\mathrm{animal}}^2\\) 相关的自由度为 \\(2(3.379)^2=22.8\\). 样本量估计为每种饲料下的动物 \\(n=\\frac23(6.08086)[t_{0.025,22.8}+t_{0.05,22.8}]^2/1.5^2=25.8\\) 或 \\(n=26\\). 该研究每种饲料下有 10 只动物，在同一温度下的饲料间，检验 1.5 个单位的剪切力差异的功效通过下式计算40 \\[t_{\\beta,\\hat{v}}=\\sqrt{\\frac{10\\delta^2}{3(\\hat{\\sigma}_{\\mathrm{seak}}^2+3\\hat{\\sigma}_{\\mathrm{side}}^2+3\\hat{\\sigma}_{\\mathrm{animal}}^2)}}-t_{\\alpha/2,\\hat{v}}=\\sqrt{\\frac{10(1.5)^2}{3(6.08086)}}-2.069=0.2869\\] 当 \\(\\alpha=0.05\\) 时 \\(\\beta=0.388\\)，提供了 \\(1-\\beta=0.612\\) 的功效；即，每种饲料下有 10 只动物，当两种饲料均值实际相差 1.5 个单位时，有 61% 的机会确定这两种饲料有显著差异。 第二个样本量问题是，在相同包装下对两种饲料水平进行平均，确定检测出两个温度均值之间 1.5 个剪切力单位的差异所需的动物数量41。感兴趣的比较为 \\(\\bar{{\\mu}}_{\\cdot11}-\\bar{{\\mu}}_{\\cdot21}\\). 评估差值方差所需的模型是 \\(\\bar{f}_{\\cdot\\cdot kl}=\\bar{\\mu}_{\\cdot kl}+\\bar{a}_{\\cdot\\cdot}+{\\bar{s}}_{\\cdot\\cdot k}+{\\bar{\\varepsilon}}_{\\cdot\\cdot jk}\\). 差值的方差为 \\[\\begin{aligned} \\mathrm{Var}(\\bar{f}_{\\cdot\\cdot11}-\\bar{f}_{\\cdot\\cdot21}) =\\text{ Var}(\\bar{s}_{{\\cdot\\cdot}1}-\\bar{s}_{\\cdot\\cdot2}+\\bar{{\\varepsilon}}_{\\cdot\\cdot11}-\\bar{{\\varepsilon}}_{\\cdot\\cdot21}) \\\\ =\\frac{2{\\sigma_\\mathrm{side}}^2}{2n}+\\frac{2{\\sigma_\\mathrm{steak}}^2}{2n} \\\\ =\\frac2{2n}(\\sigma_{\\mathrm{side}}^2+\\sigma_{\\mathrm{steak}}^2) \\end{aligned}\\] 每种饲料的动物数量为 \\(n=\\frac22(\\hat{\\sigma}_{\\mathrm{steak}}^2+\\sigma_{\\mathrm{side}}^2)[t_{0.025,49.9}+t_{0.05,49.9}]^2/1.5^2=11.8\\)，其中使用上述程序将自由度确定为 49.9. 存在多种可能重要的比较，因此需要为每个比较确定样本量，所需动物数量或整区数量可以基于每个被认为重要的比较所需动物数量的最大值来确定。 24.7 使用 JMP 进行计算：示例 24.7 图 24.9: 示例 24.7 前 32 个观测数据 图 24.10: 示例 24.7 后 16 个观测数据 图 24.9 和 24.10 中的数据集来自 JMP 表，其中包含名义变量 block, variety, fert 和 rate。实验设计包括四个整区的四个区组，其中两种小麦品种 (varieties) 和两个肥料 (fertilizer) 水平的组合被随机分配给整区。每个整区被分成三个子区，三个播撒率 (seeding rate) 水平被随机分配给三个子区。整区设计是随机完全区组设计结构（四个区组）中的双向处理结构（品种与肥料水平）。由于不可控的昆虫破坏，存在一些缺失的数据点，但以下对结构的评估是在假设没有缺失数据点的情况下进行的。整区设计的方差分析表由表 24.37 给出。整区误差是根据处理结构与设计结构交互作用计算得出的。在这种情况下，存在一个具有四个处理组合的双向处理结构，因此整区误差由 (4-1)(4-1) = 9 个自由度组成。接下来，比较品种一和肥料 1 的播撒率水平。所得设计是在随机完全区组设计结构中的单向处理结构，方差分析表在表 24.38 中给出。子区误差自由度是根据区组与速率交互作用计算得出的，提供 6 个自由度。品种和肥料有四种组合，每种组合为子区误差提供 6 个自由度。合并这四组 6 个自由度为子区误差提供 (4)(6) = 24 个自由度。可用于描述该数据的模型是 \\[y_{ijkl}=\\mu_{ijl}+b_k+zv_{ijk}+\\varepsilon_{ijkl}\\quad i=1,2,j=1,2,k=1,2,3,4,l=1,2,3\\] 其中 \\(b_k\\thicksim i.i.d.N(0,\\sigma_{blk}^2),w_{ijk}\\thicksim i.i.d.N(0,\\sigma_{ivp}^2),\\varepsilon_{ijkl}\\thicksim i.i.d.N(0,\\sigma_{sp}^2)\\) 以及 \\(\\mu_{ijl}\\) 表示品种 i, 肥料 j 和播撒率 l 的平均值。 表 24.37: 示例 24.7 的整区分析 x 表 24.38: 比较品种 1 和肥料 1 的播种率的方差分析 x 包含两个误差项和期望均方的方差分析表在表 24.39 中显示。JMP fit model 界面如图 24.11 所示。通过使用 attributes 按钮，将 block 和 block × variety × fert 项定义为 random 效应。默认的估计方法是 REML，但可以通过更改 method 按钮来使用 III 型平方和。单击 run model 按钮以获取分析。图 24.12 包含方差分量的估计和固定效应的分析。与 SAS-Mixed 不同，关于方差分量的置信区间是使用 Waldner 区间而不是 Satterthwaite 近似区间计算的。所有涉及率的效应都是显著的，包括三向交互作用，因此需要解决 variety × fert × rate 三向均值。点击 effects 按钮可提供每个效应的最小二乘均值表，如图 24.13 - 24.15 所示。least square means 选项如图 24.16 所示。tables 选项是默认选项。plots 选项提供平均值的折线图。contrasts 选项可以构建感兴趣的最小二乘均值的对比。Tukey HSD 选项为多重比较提供 Tukey 调整，slice 选项为交互中每个效应的每个水平提供等均值检验。图 24.17 中的结果是 Tukey HSD 选项结果的一部分，提供了线条或字母。由于研究中有缺失数据，这些字母可能会导致一些矛盾。例如，均值 2, 2, 10 与均值 2, 2, 6 显著不同（见 A 和 B），但 2, 2, 10 与 1, 2, 4 没有显著不同（见 C），即使 2, 2, 6 的均值大于 1, 2, 4 的均值。缺失数据会导致比较的方差不同，这反过来又会提供不完全排序的多重比较，如上所示42。 表 24.39: 示例 24.7 的方差分析表（假设没有缺失数据） x 图 24.11: 示例 24.7 fit model 界面 图 24.12: 示例 24.7 方差分量估计 (REML) 和固定效应检验 图 24.13: 示例 24.7 品种、肥料及其交互作用的最小二乘均值 图 24.14: 率及其与品种和肥料交互作用的最小二乘均值 图 24.15: 品种与肥料与率的交互作用的最小二乘均值 图 24.16: 效应的 least square means 选项 图 24.17: 三项交互作用的最小二乘均值，通过 Tukey’s method，字母指示了分组 图 24.18 包含将 Tukey HSD 选项应用于 Variety × Fert 均值的完整结果集。该表包含差异估计、每个差异的标准误估计以及每个差异 95% 置信区间的上限和下限。当置信区间不包括零时，结果显示为红色。所有这些置信区间都包括零，因此它们以黑色显示。可以通过在图 24.19 中显示的对比表上为每个均值选择系数来评估最小二乘平均值的对比。 图 24.18: 示例 24.7 品种与肥料均值的多重比较，Tukey’s method 的计算 图 24.19: 最小二乘均值的 contrast 选项窗口 此示例显示了可用于使用 JMP 软件分析裂区型设计的一些选项。本章中描述的所有数据集和模型都可以使用 JMP 的 fit model 界面进行分析。 24.8 结束语 在本章中，详细讨论了裂区设计，并使用 SAS Mixed 和 JMP 进行了分析。所讨论设计的方差分析表涉及多个误差项，并且描述了能够构造每个误差项的适当表示的方法。各种估计的标准误估计可能涉及多个误差项。提出了计算实验者可能感兴趣的各种类型比较的标准误估计的方法。标准误估计也可用于进行多重比较。当因子的水平是定量的时，描述了估计线性、二次和类似趋势的方法。演示了样本量和功效方法。详细讨论了七个示例。 24.9 练习 原文：The process of determining the appropriate standard error involves expressing \\(\\bar{{y}}_{\\cdot j\\cdot}\\) in terms of the quantities in the model obtained by summing over i and k.↩︎ 译者注：通过最左边和最右边解出 \\(\\beta\\)，例如在 R 中通过命令 pt(0.2869,22.8) 求解。↩︎ 原文：The second sample size problem is to determine the number of animals required to detect a difference of 1.5 shear force units between two temperature means at the same level of packaging averaged over the two levels of ration.↩︎ 原文：Missing data cause the variances of comparisons to be different, which in turn can provide multiple comparisons that are not completely ordered as demonstrated above.↩︎ "],["chap25.html", "第 25 章 分析条区型设计的方法 25.1 条区设计和模型的描述 25.2 推断技术 25.3 示例：氮与灌溉 25.4 示例：含裂区的条区 1 25.5 示例：含裂区的条区 2 25.6 示例：含裂区的条区 3 25.7 示例：含裂区的条区 4 25.8 条-条区的设计与分析：基于 JMP7 25.9 结束语 25.10 练习", " 第 25 章 分析条区型设计的方法 条区 (strip-plot) 设计结构常用于实验单元以矩形排列的情况，例如田间、布料上或一摞笼子中。在第 5 章中，条区设计被描述为基本设计结构之一，其分析细节在本章中进行讨论。当一个因素的水平应用于每个矩形的行 (row)，而另一个因素的水平应用于每个矩形的列 (column) 时，就形成了条区设计结构。因此，当处理方法不允许对实验单元进行单独处理，而是按组（如整行或整列的单元）进行处理时，这种设计非常有用。条区设计结构也适用于在一系列步骤中处理实验单元的实验，其中在每个步骤中一起处理一组实验单元。本章讨论了六个示例，以演示复杂设计结构的分析方法。第一个涉及灌溉和氮的水平的示例用于展示最简单条区设计的基本分析。其余大部分示例涉及条区设计与裂区设计结构的不同组合。最后一个示例涉及条-条区 (strip-strip-plot) 设计结构。 25.1 条区设计和模型的描述 条区设计结构类似于裂区设计结构，但实验单元构建方式不同。条区设计至少包含双向处理结构，其中基本实验单元以矩形集合的形式安排。每个矩形具有 a 行，其中 a 是第一因素（A）的水平数；同时具有 c 列，其中 c 是第二因素（C）的水平数。第一因素 A 的各个水平随机分配至矩形的各行，使得同一行内的所有实验单元接受相同的 A 水平，并一起进行处理。第二因素 C 的各个水平则随机分配至矩形的各列，使得同一列内的所有实验单元接受相同的 C 水平，并一起进行处理。图 25.1 展示了将 A 的各个水平分配给行以及将 C 的各个水平分配给列的示意图，在该图中共有 r 个矩形，代表被分区的重复 (blocked replicates). 这一分配过程生成了一种具有三种尺寸实验单元的设计。行是因子 A 的实验单元，列是因子 C 的实验单元，而单元格则是 A × C 交互作用的实验单元。 图 25.1: 两个因子的水平分配给排列成矩形的实验单元的条（行和列） 可视化适当分析的一个简单方法是首先忽略因子 C 的各个水平，只观察那些将因子 A 的水平分配给各行的矩形，如图 25.2 所示。行设计由随机完全区组设计结构中的单向处理结构组成。可用于描述行设计数据的模型是 \\[y_{ik}=\\mu_i^r+b_k^r+e_{ik}^r,\\quad i=1,2,\\ldots,a,\\quad k=1,2,\\ldots,r\\] 其中区组效应 \\(b_k^r\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{block}}^2)\\)，行效应 \\(e_{ik}^r\\thicksim i.i.d.~N(0,\\sigma_{\\mathrm{row}}^2)\\). 图 25.2: 将 A 的水平分配给每个矩形的行 表 25.1 给出了行设计的方差分析表，其中行误差项计算为 rectangle × A 交互作用。 表 25.1: 条区设计结构行部分的方差分析 x 接下来，忽略因子 A 的各个水平，仅关注那些将因子 C 的水平分配给各列的矩形，如图 25.3 所示。列设计包含了在一个随机完全区组设计结构中的单向处理结构。可用于描述列设计数据的模型是 \\[y_{jk}=\\mu_j^c+b_k^c+e_{jk}^c\\quad i=1,2,\\ldots,c,k=1,2,\\ldots,r\\] 图 25.3: 将 C 的水平分配给每个矩形的列 其中区组效应 \\(b_k^c\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{block}}^2)\\)，行效应 \\(e_{ik}^c\\thicksim i.i.d.~N(0,\\sigma_{\\mathrm{column}}^2)\\). 列设计的方差分析表如表 25.2 所示，其中列误差项计算为 rectangle × C 交互作用。因子 A 水平的比较是行间比较 (between-row comparisons)，因子 C 水平的比较则是列间比较 (between-column comparisons)，但 A × C 交互作用的测量是行内比较与列内比较。因此，测量 A × C 交互作用的实验单元的尺寸是与矩形内的单元相对应的行和列的交点43。 表 25.2: 条区设计结构列部分的方差分析 x 描述处理结构中具有两个因素的条区设计结构的模型是 \\[y_{ijk}=\\mu+b_k+\\alpha_i+r_{ik}+\\gamma_j+c_{jk}+(\\alpha\\gamma)_{ij}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,a,\\quad j=1,2,\\ldots,c,\\quad k=1,2,\\ldots,r\\] 其中 \\(\\mu\\) 表示总均值效应，\\(\\alpha_i\\) 表示 A 的第 i 个水平的效应，\\(\\gamma_j\\) 表示 C 的第 j 个水平的效应，\\((\\alpha\\gamma)_{ij}\\) 表示因子 A 和 C 的交互效应，\\(b_k\\) 表示第 k 个区组的效应并假定 \\(b_k\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{block}}^2)\\)，\\(r_{ik}\\) 表示第 k 个区组内第 i 行的效应并假定 \\(r_{ik}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{row}}^2)\\)，\\(c_{jk}\\) 表示第 k 个区组内第 j 列的效应并假定 \\(c_{jk}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{column}}^2)\\)，以及 \\(\\varepsilon_{ijk}\\) 表示第 k 个区组第 ij 个单元格的随机效应并假定 \\({\\varepsilon}_{ijk}\\thicksim i.i.d.~N(0,{\\sigma}_{\\mathrm{cell}}^2)\\). 此外，假设所有随机项都是独立分布的。 表 25.3: 双向处理结构条区设计结构的方差表分析 x 行误差被计算为 A 与区组交互作用，列误差项被计算为 C 与区组交互作用，单元格误差项被计算为 A 与 C 与区组的三向交互作用。方差分析表如表 25.3 所示，它是通过将表 25.1 和 25.2 中的条目与 AC交互作用和单元格误差项相结合而构建的。条区模型可以表示为均值模型，如下所示 \\[y_{ijk}=\\mu_{ij}+b_k+r_{ik}+c_{jk}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,a,j=1,2,\\ldots,c,\\quad k=1,2,\\ldots,r\\] 其中 \\(\\mu_{ij}=\\mu+\\alpha_i+\\gamma_j+(\\alpha\\gamma)_{ij}\\). 对于均衡的数据集，单元格均值的估计为 \\(\\hat{\\mu}_{ij}=\\bar{y}_{ij\\cdot}\\)，涉及 \\(\\mu_{ij}\\) 的各种对比、总和或均值是通过取 \\(\\hat \\mu_{ij}\\) 的相应对比、总和或均值来估计的。方差分量的矩法解是通过将表 25.3 中的均方与预期均方相等而生成的方程组获得的 \\[\\begin{aligned} \\tilde{\\sigma}_{\\mathrm{cell}}^2&amp; =\\text{MSError(cell)} \\\\ \\tilde{{\\sigma}}_{\\mathrm{row}}^2&amp; =\\frac{MSError(row)-MSError(cell)}c \\\\ \\tilde{{\\sigma}}_{\\mathrm{column}}^2&amp; =\\frac{MSError(column)-MSError(cell)}a \\\\ \\tilde{{\\sigma}}_{\\mathrm{block}}^2&amp; =\\frac{MSBlock-MSError(column)-MSError(row)+MSError(cell)}{ac} \\end{aligned}\\] 方差分量的估计为 \\[\\begin{aligned} \\hat{{\\sigma}}_{\\mathrm{cell}}^2&amp;= \\tilde{{\\sigma}}_{\\mathrm{cell}}^2 \\\\ \\hat{\\sigma}_{\\mathrm{row}}^2&amp;= \\begin{cases}\\tilde{{\\sigma}}_\\mathrm{row}^2&amp;&amp;\\mathrm{if~}\\tilde{{\\sigma}}_\\mathrm{row}^2&gt;0\\\\0&amp;&amp;\\mathrm{if~}\\tilde{{\\sigma}}_\\mathrm{row}^2\\leq0\\end{cases} \\\\ \\hat{{\\sigma}}_{\\mathrm{column}}^2&amp;= \\begin{cases}\\tilde{{\\sigma}}_\\mathrm{column}^2&amp;&amp;\\mathrm{if~}\\tilde{{\\sigma}}_\\mathrm{column}^2&gt;0\\\\0&amp;&amp;\\mathrm{if~}\\tilde{{\\sigma}}_\\mathrm{column}^2\\leq0\\end{cases} \\\\ \\hat{{\\sigma}}_{\\mathrm{block}}^2&amp;= \\begin{cases}{\\tilde{\\sigma}}_\\mathrm{block}^2&amp;&amp;\\mathrm{if~}{\\tilde{\\sigma}}_\\mathrm{block}^2&gt;0\\\\0&amp;&amp;\\mathrm{if~}{\\tilde{\\sigma}}_\\mathrm{block}^2\\leq0\\end{cases} \\end{aligned}\\] 在对该模型的参数进行推断时必须小心，因为该模型涉及三个误差项，每个实验单元尺寸对应一个误差项。下一节将讨论对假设的必要检验和在均值之间进行比较的适当标准误。 25.2 推断技术 表 25.3 中的期望均方列提供了构建检验统计量所需的信息，以推断因子的效应。为检验无交互假设 \\(H_{0AC}\\colon\\mu_{ij}-\\mu_{ij}-\\mu_{ij}+\\mu_{ij}=0\\text{ for all }i\\neq i&#39;\\text{ and }j\\neq j&#39;\\text{ vs }H_{aAC}:\\text{ (not }H_{0AC})\\)，将 A × C 均方除以 MSError(cell). 为检验因子 A 的等主效应均值假设 \\(H_{0A}\\colon\\bar{{\\mu}}_{1\\cdot}=\\bar{{\\mu}}_{2\\cdot}=\\cdots=\\bar{{\\mu}}_{a\\cdot}\\mathrm{~vs~}H_{aA}{:}(\\text{nоt }H_{0A})\\)，将因子 A 的均方除以 MSError(row). 为检验因子 C 的等主效应均值假设 \\(H_{0C}\\colon\\bar{{\\mu}}_{\\cdot 1}=\\bar{{\\mu}}_{\\cdot2}=\\cdots=\\bar{{\\mu}}_{\\cdot c}\\mathrm{~vs~}H_{aC}{:}(\\text{nоt }H_{0C})\\)，将因子 C 的均方除以 MSError(column). 至于第 24 章中讨论的裂区设计，其中有四个具有不同标准误的均值比较，而在条区设计中则存在六种具有不同标准误的均值比较。表 25.4 给出了比较、比较的估计（基于均衡数据集）和比较方差。使用第 24 章中描述的方法来获得单元格均值的每个对比的特定方差。为了演示这一点，两个均值差的方差，其中 A 和 C 的水平对于两个均值都不同，例如 \\(\\mu_{12}-\\mu_{34}\\)，需要首先获得 \\(\\hat\\mu_{ij}=\\bar y_{ij\\cdot}\\) 的模型表示，该表示为 \\(\\hat{{\\mu}}_{ij}={\\mu}_{ij}+\\bar{{b}}_\\cdot+\\bar{{r}}_{i{\\cdot}}+\\bar{{c}}_{j{\\cdot}}+\\bar{{\\varepsilon}}_{i{j}}\\). 那么 \\(\\hat\\mu_{12}-\\hat\\mu_{34}\\) 的模型为 \\[\\hat{\\mu}_{12}-\\hat{\\mu}_{34}=\\bar{y}_{12\\cdot}-\\bar{y}_{34\\cdot}=\\mu_{12}-\\mu_{34}+\\bar{r}_{1\\cdot}-\\bar{r}_{3\\cdot}+\\bar{c}_{2\\cdot}-\\bar{c}_{4\\cdot}+\\bar{\\varepsilon}_{12\\cdot}-\\bar{\\varepsilon}_{34\\cdot}\\] 表 25.4: 裂区设计的比较、估计和方差估计，其中 \\(i \\ne m\\) 和 \\(j \\ne n\\) x \\(\\mu_{12}-\\mu_{34}\\) 的估计为 \\(\\bar y_{12\\cdot}-\\bar y_{34\\cdot}\\)，\\(\\hat\\mu_{12}-\\hat\\mu_{34}\\) 的方差为 \\[\\begin{aligned} \\mathrm{Var}(\\hat{\\mu}_{12}-\\hat{\\mu}_{34})&amp; =\\mathrm{Var}(\\bar{r}_1.-\\bar{r}_3.+\\bar{c}_2.-\\bar{c}_4.+\\bar{\\varepsilon}_{12.}-\\bar{\\varepsilon}_{34.}) \\\\ &amp;=\\frac{2\\sigma_\\mathrm{row}^2}r+\\frac{2\\sigma_\\mathrm{column}^2}r+\\frac{2\\sigma_\\mathrm{cell}^2}r \\\\ &amp;=\\frac{2(\\sigma_{\\mathrm{cell}}^2+\\sigma_{\\mathrm{column}}^2+\\sigma_{\\mathrm{row}}^2)}{r} \\end{aligned}\\] \\(\\hat\\mu_{12}-\\hat\\mu_{34}\\) 方差估计为 \\[\\widehat{\\mathrm{Var}}(\\hat\\mu_{12}-\\hat\\mu_{34}) =\\frac{2(\\hat\\sigma_{\\mathrm{cell}}^2+\\hat\\sigma_{\\mathrm{column}}^2+\\hat\\sigma_{\\mathrm{row}}^2)}{r}\\] 当 \\(\\tilde{\\sigma}_{\\mathrm{row}}^2&gt;0\\) 以及 \\(\\tilde{\\sigma}_{\\mathrm{column}}^2&gt;0\\) 时，该方差估计为 \\[\\widehat{\\mathrm{Var}}(\\hat{\\mu}_{12}-\\hat{\\mu}_{34})=\\frac2{acb}\\left[aMSError(row)+cMSError(column)+(ac-a-c)MSError(cell)\\right]\\] 表 25.4 给出了六种类型的比较、它们的估计及其相应的方差。表 25.5 给出了比较的标准误估计，其中自由度对应于通过使用 Satterthwaite 近似计算的单个均方或均方组合的自由度，如下 \\[\\begin{aligned} \\hat{{\\omega}}_{1}&amp;=\\frac{\\left[MSError(column)+(c-1)MSError(cell)\\right]^2}{\\left[MSError(column)\\right]^2}+\\frac{\\left[(c-1)MSError(cell)\\right]^2}{(a-1)(c-1)(r-1)} \\\\ \\hat{{\\omega}} _2&amp;=\\frac{[MSError(row)+(a-1)MSError(cell)]^2}{\\frac{[MSError(row)]^2}{(a-1)(r-1)}+\\frac{[(a-1)MSError(cell)]^2}{(a-1)(c-1)(r-1)}} \\\\ \\hat{{\\omega}}_{3} &amp;=\\frac{[aMSError(row)+cMSError(column)+(ac-a-c)MSError(cell)]^2}{\\frac{[aMSError(row)]^2}{(a-1)(r-1)}+\\frac{[cMSError(column)]^2}{(c-1)(r-1)}+\\frac{[(ac-a-c)MSError(cell)]^2}{(a-1)(c-1)(r-1)}} \\end{aligned}\\] 表 25.5: 裂区设计比较的标准误估计，附带相关自由度，其中 \\(i \\ne m\\) 和 \\(j \\ne n\\) x 当有缺失的数据时，根据缺失数据的模式，会有更多不同类型的标准误。 25.3 示例：氮与灌溉 图 25.4: 氮肥和灌溉条区的田间布局、处理分配和数据 一项实验被开展以研究两种灌溉方法 (irrigation) 及三个不同氮肥 (nitrogen) 水平对小麦产量的影响和关系。实验采用四个区组或矩形布局，并按照随机化方案分配处理，其产量结果见图 25.4 所示。这些数据的 SAS®-Mixed 代码以及 III 型平方和分析的方差分析表见表 25.6。比较氮肥水平、比较灌溉方法水平以及评估氮肥与灌溉交互作用的 \\(F\\) 值分别为 60.13, 52.18 和 33.12. 这六种比较类型的标准误估计及其相应的自由度或近似自由度在表 25.7 中给出。最后三项比较涉及误差项的组合，因此自由度进行了近似计算。表 25.8 给出了用于提供方差分量的 REML 估计的 SAS-Mixed 代码，同时还提供了方差分量的估计。固定效应检验的结果显示在表 25.9 中。表 25.9 中的结果与表 25.6 中 III 型分析的结果一致。由于数据集是均衡的，并且方差分量的所有估计均大于零，这些检验结果是一致的。表 25.7 中用于比较氮肥水平、灌溉水平以及其他四种比较类型的 SAS-Mixed 代码及 estimate 语句在表 25.10 中给出。再次强调，这里有六种不同类型的比较，且每种都有各自的标准误估计。 表 25.6: 为氮肥和灌溉示例提供 III 型平方和分析的 SAS-Mixed 代码 x 表 25.7: 氮肥和灌溉数据的六个比较、标准误估计和自由度，其中 \\(i \\ne m\\) 和 \\(j \\ne n\\) x 表 25.8: 为氮肥和灌溉示例提供 REML 分析的 SAS-Mixed 代码 x 表 25.9: 氮肥和灌溉示例 REML 分析的固定效应检验 x 表 25.10: 在 SAS-Mixed REML 分析中使用 Estimate 语句来评估六种类型的比较 x 涉及多个尺寸实验单元设计的推断问题之一是，单元格均值的各种比较涉及不同的标准误估计。不可能通过提供单一的 LSD 值来总结这些类型的数据，就像完全随机和随机完全区组设计结构的情况一样。 25.4 示例：含裂区的条区 1 图 25.5: 田间区组之一的布局，氮肥和灌溉为条区，品种为裂区 第 25.3 节中的设计可以扩展到每个单元格内有三种小麦品种 (varieties) 的情况，如图 25.5 所示。图 25.5 中没有显示随机化过程，但实际上，灌溉水平被随机分配到矩形的列，氮肥水平被随机分配到矩形的行，而品种则被随机分配到由每个矩形内部行与列相交形成的单元格内的三个区 (plots) 中。如果对品种水平进行平均，则氮肥与灌溉的分析结果与表 25.3 或表 25.6 中的结果相同。品种水平是每个单元格内的子区 (subplots)，品种的任何比较都是单元格内或子区间比较 (within-cell or between-subplot comparisons). 可用于描述该数据的模型是 \\[y_{ijkl}=\\mu_{ijk}+b_l+r_{il}+c_{jl}+d_{ijl}+\\varepsilon_{ijkl},\\quad i=1,2,j=1,2,3,k=1,2,3,l=1,2,3,4\\] 其中 \\(\\mu_{ijk}\\) 表示第 i 种灌溉，第 j 种氮肥和第 k 种品种的均值，\\(b_l\\) 表示第 l 个区组（矩形）的效应并假设 \\(b_l\\sim i.i.d.N(0,\\sigma_{\\mathrm{block}}^2)\\)，\\(c_{jl}\\) 表示第 l 个区组内第 i 行的效应并假设 \\(c_{jl}\\sim i.i.d.N(0,\\sigma_{\\mathrm{column}}^2)\\)，\\(d_{ijl}\\) 与第 l 个区组内第 ij 个单元格相关的随机效应 \\(d_{ijl}\\sim i.i.d.N(0,\\sigma_{\\mathrm{cell}}^2)\\)，以及 \\(\\varepsilon_{ijkl}\\) 与分配给第 l 个区组内第 ij 个单元格的第 k 种品种相关的子区随机效应并假设 \\({\\varepsilon}_{ijkl}\\thicksim i.i.d.N(0,{\\sigma}_{\\mathrm{subplot}}^2)\\). 表 25.11 给出了该模型的方差分析，表 25.12 给出了可用于拟合该模型的 SAS-Mixed 代码。行误差项是 block × nit，列误差项是 block × irr，单元格误差是 block × nit × irr. 残差是子区误差项，是通过 variety 与 block 交互作用来计算的，其中合并了所有 nit 和 irr 的水平 (the variety by block interaction pooled across the levels of nit and irr). 表 25.11: 含裂区的条区设计结构方差分析表 x 表 25.12: 为第 25.4 节中的条-裂区 (strip-split-plot) 数据集拟合模型的 SAS-Mixed 代码 x 25.5 示例：含裂区的条区 2 图 25.6: 田间区组之一的布局，氮肥和灌溉为条区，品种为氮肥水平的裂区，品种在灌溉水平下构成了条区 另一种（不同于第 25.4 节所述的）将品种水平纳入研究的方法在图 25.6 中展示。在每个氮肥水平下，品种水平跨越了灌溉的两个水平。品种水平是氮肥水平的子区，但品种水平和氮肥水平在灌溉水平下构成了条区44。通过在每个单元格内合并品种水平，得到的灌溉与氮肥的分析结果与第 25.3 节中的相同。设计中氮肥与品种部分可通过在每个氮肥品种组合内合并灌溉水平来获得。由此产生的设计是一个裂区设计，其中氮肥水平构成整区因子，品种水平构成子区因子。裂区分析的方差表在表 25.13 中展示。整区误差与行误差相同，计算为区组与氮肥交互作用。子区或子行 (subrow) 或 1/3 行误差计算为 block × variety 交互作用，其中合并了所有灌溉水平。接下来考虑仅来自氮肥水平 1 的数据。在这种情况下，得到的设计是一个涉及灌溉和品种水平的条区设计。对应的条区方差分析表在表 25.14 中列出。我们感兴趣的误差项是品种与灌溉交点处的子单元格 (subcell) 误差，这被计算为 block × irrigation × variety 交互作用，具有 6 个自由度。这些误差在氮肥水平之间进行合并，产生了 18 个自由度。nitrogen × irrigation × variety 交互作用也是一个子单元格比较。因此，block × nitrogen × irrigation × variety 交互作用提供了额外的 12 个子单元格误差自由度，使子单元格误差项共有 30 个自由度。表 25.15 中的方差分析表展示了变异源及其相应的自由度。 表 25.13: 第 25.5 节中示例分析的裂区部分 x 表 25.14: 第 25.5 节中氮肥第一水平的灌溉和品种数据 x 表 25.15: 第 25.5 节条-裂区 (strip-split-plot) 设计的方差分析表 x 25.6 示例：含裂区的条区 3 图 25.7: 田间区组之一的图形：行分配了除草剂和氮肥的不同水平，列分配了品种的不同水平，单元格分配了播撒率的不同水平 图 25.7 显示，三个品种被分配到矩形的列，除草剂 (herbicide) 和氮的组合被分配到矩形的行，播撒率 (seeding rates) 的水平被分配到单元格内的子区。假设设计由四个这样的区组组成。品种形成氮和除草剂水平组合的条区45，播撒率是单元格内的子区。行的双向处理结构是该设计的独特之处。该结构指出，任何类型的处理结构都可以与设计结构的任何特征相关联。方差分析表列于表 25.16 中，其中行误差是通过合并 block × herbicide, block c nitrogen 和 block × herbicide × nitrogen 交互作用来计算的，提供九个自由度。列误差项由 block × variety 交互作用计算。单元格误差项是通过合并 block × variety × herbicide, block × variety × nitrogen 和 block × variety × herbicide × nitrogen 交互作用来计算的，这些为单元格误差项提供了 18 个自由度。子区误差是通过计算每个 herbicide, nitrogen 和 variaty 组合的 block × seeding 交互作用得到的，然后跨 herbicide, nitrogen 和 variety 的水平合并这些交互作用46，为残差提供 72 个自由度。 表 25.16: 第 25.5 节条-条区设计的方差分析 x 25.7 示例：含裂区的条区 4 图 25.8: 田间区组之一的布局，将品种和播种率作为整区，将条区中的除草剂和氮肥水平作为子区 这个实验涉及研究两种品种、两种播撒率、两种除草剂和两种氮肥对玉米产量的影响。图 25.8 显示了实验单元的四个区组中的一个是如何处理的。品种和播撒率的水平被分配给每个区组内的四个大方块 (squares). 在每个方块内，除草剂和氮肥的水平形成一个条区。条区部分是大方块的子区。如果忽略氮肥和除草剂的水平，品种和播撒率的设计是一个随机完全区组设计结构中的双向处理结构。误差项通过处理结构与区组交互作用计算，其中合并了 block × variety, block × seeding rate 和 block × variety × seeding rate 交互作用得出，共提供 9 个自由度。可以在 SAS-Mixed 中使用 variety × seeding × block 获得大区组 (big block) 误差项，该程序将自动进行合并。表 25.17 给出了大区组部分的方差分析表。对于品种 1 和播撒率 1，除草剂和氮肥的水平提供了一个条区设计，其方差分析总结在表 25.18 中。误差项是通过合并品种和播撒率的四种组合得出的，为 Error(row/block)（区组内行的误差）, Error(column/block)（区组内列的误差）和 Error(cell/block)（区组内单元格的误差）提供了 12 个自由度。SAS-Mixed 代码和完整的方差分析表显示在表 25.19 中。误差项的计算方法如下：Error(big squares) = Variety × Seeding × Block, Error(row/ block) = Herbicide × Block(Variety Seeding), Error(column/block) = Nitrogen × Block(Variety Seeding), and Error(cell/block) = Nitrogen × Herbicide × Block(Variety Seeding). 表 25.17: 第 25.7 节中示例的大区组方差分析 x 表 25.18: 第 25.7 节中示例，来自品种 1 和播撒率 1 的除草剂和氮肥数据的条区方差分析 x 表 25.19: 第 25.7 节示例中裂区中的条区的 SAS Mixed 代码和方差分析 x 25.8 条-条区的设计与分析：基于 JMP7 图 25.9: 应用温度、清洁和冲洗水平的过程 图 25.10: 三维矩形展示：清洁水平的分配给行，冲洗水平分配给列，温度水平分配给层。数字对应于图 25.9 中的硅片编号 当实验单元被组织成具有行、列和层 (tiers) 的三维矩形时，就会出现条形-条形-图设计结构。半导体行业的某个实验被用来演示条-条区 (split-split plot) 设计结构。该实验包括评估三个因素，每个因素在各自独立的工艺步骤中出现；也就是说，该实验涉及三个步骤。第一步是在硅片 (silicon wafer)（直径 20 厘米，厚度 0.2 厘米）表面添加一层氧化物。通过将硅片放入设定特定温度的炉子中，对硅片表面施加氧化层。研究了两种温度水平。第二步是对硅片表面进行抛光 (polishing) 或清洁 (cleaning)，以消除可能产生的任何凸起，评估了两种清洗方法。最后，第三步涉及冲洗 (washing off) 表面残留颗粒，这些颗粒可能会对正在构建的电路造成干扰。实验中包含了两种冲洗方法。在每个步骤中，均有四片硅片一同接受相应因素的处理。图 25.9 的示意图展示了八片硅片如何经过这三个步骤以及在每个步骤中硅片是如何分组的。图 25.10 是一个三维展示图，其中清洁的水平被分配到行，清洁后冲洗的水平被分配到列，温度的水平被分配到层。该研究重复了四次，产生了四个区组。清洁水平的实验单元是区组内的行，并且行误差项计算为 clean × block 交互作用。冲洗水平的实验单元是区组内的列，并且列误差项计算为 wash × block 交互作用。如果对温度水平进行求和，所得结构就是以清洁和冲洗作为两个因素的条区设计。清洁与冲洗交互作用的实验单元是来自两种温度下的两片硅片，而这两片硅片的误差计算为 clean × wash × block 的交互作用。温度水平的实验单元是三维矩形的层。层误差项计算为 temperature × block 交互作用。如果对清洁水平进行求和，所得结构就是以温度和冲洗作为两个因素的条区设计。温度与冲洗交互作用的实验单元是来自两个清洁水平的硅片，其误差项计算为 temperature × wash × block 交互作用。如果对冲洗水平进行求和，所得结构就是以温度和清洁作为两因素的条区。温度与清洁交互作用的实验单元是来自两个冲洗水平的两个硅片，并且两个冲洗硅片的误差计算为 temperature × clean × block 交互作用。测量温度、清洁与冲洗交互作用的实验单元是单个硅片，硅片误差计算为 temperature × clean × wash × block 交互作用。测量的响应是经三个步骤后在每个硅片上的九个位置（以埃为单位）测量的所得氧化物层的平均厚度。可用于描述厚度数据的模型是 \\[y_{ijkl}=\\mu_{ijk}+b_l+r_{il}+c_{jl}+t_{kl}+w_{ijl}^{2W}+w_{ikl}^{2C}+w_{jkl}^{2T}+\\varepsilon_{ijkl},\\quad i=1,2,j=1,2,k=1,2,l=1,2,3,4\\] \\(\\mu_{ijk}\\) 表示经水平 i 温度、水平 j 清洁和水平 k 冲洗的平均厚度，以及 \\[\\begin{aligned}&amp;b_{l}\\sim i.i.d.N(0,\\sigma_{\\mathrm{block}}^{2}),\\quad r_{il}\\sim i.i.d.N(0,\\sigma_{\\mathrm{row}}^{2}),\\quad c_{jl}\\sim i.i.d.N(0,\\sigma_{\\mathrm{column}}^{2})\\\\&amp;t_{kl}\\sim i.i.d.N(0,\\sigma_{\\mathrm{tier}}^{2}),\\quad w_{ijl}^{2W}\\sim i.i.d.N(0,\\sigma_{2\\text{washwafer}}^{2})\\\\&amp;w_{ikl}^{2\\text{С}} \\sim i . i . d . N ( 0 , \\sigma _ { 2\\text{cleanwafer}}^{2}),\\quad w_{jkl}^{2T}\\sim i.i.d.N(0,\\sigma_{2\\text{tempwafer}r}^{2})\\end{aligned}\\] 以及 \\[\\varepsilon_{ijkl}\\sim i.i.d.~N(0,\\sigma_{\\mathrm{wafer}}^2)\\] 方差分析在表 25.20 中给出，其中 w, 2Tw, 2Cw 和 2Ww 分别表示硅片、两个温度硅片、两个清洁硅片和两个冲洗硅片。每个因子效应都有自己的一组实验单元和相应的误差项。 表 25.20: 第 25.8 节条-条区设计的方差分析 x 图 25.11 包含了数据集，而图 25.12 是 JMP model specification 界面。通过使用 Attributes 按钮，将所有涉及 block 的交互作用定义为随机效应。图 25.13 展示了固定效应的 REML 方差成分估计以及 III 型检验结果。存在显著的 temperature × clean × wash 交互作用，因此需要评估这些单元格均值。图 25.14 给出了三向交互作用的最小二乘均值以及表示显著差异的字母标记。查看三向交互作用均值两两比较的另一种方式是绘制所有两两差值，从最大到最小排序，并附带差异的置信区间。图 25.15 是两两差异的展示。由于差异的方差取决于比较类型，所以置信区间的宽度不全相等。相比于表 25.4 中展示的条区设计的不同方差数量，条-条区设计的不同方差数量要多得多。 图 25.11: 第 25.8 节中示例的三步过程的数据集 图 25.12: 第 25.8 节中示例的三步过程的 fit model 界面 图 25.13: 三步过程的方差分量估计和固定效应检验 图 25.14: 带字母标记的三向最小二乘均值 图 25.15: 三步过程的三向最小二乘均值差异的图形表示 25.9 结束语 条区设计是一种基本的设计结构，本章讨论的例子说明了可能出现的一些复杂性。包含多个例子是为了让读者能够掌握一种针对复杂设计进行恰当分析的方法。条区设计结构被用来展示仅仅通过向实验单元分配因子水平的方式，就能产生多种尺寸的实验单元。对基本条区进行了分析，以演示在进行各种均值比较时计算标准误估计的复杂性。显然，随着设计的复杂化，有许多不同的标准误需要评估，条区和裂区的组合设计以及条条区设计都证明了这一点。样本量和功效计算可以使用第 25 章中描述的方法，并结合所关注比较的标准误估计来进行。 25.10 练习 原文：Thus the size of the experimental unit on which the A × C interaction is measured is the intersection of a row and a column which corresponds to a cell within the rectangle.↩︎ 原文：The levels of variety are subplots for the levels of nitrogen, but the levels of variety and the levels of nitrogen are strip-plots with the levels of irrigation.↩︎ 原文：The varieties form a strip plot with the combination of levels of nitrogen and herbicide.↩︎ 原文：The subplot error is obtained by computing the block × seeding rate interaction for each combination of herbicide, nitrogen, and variety and then pooling these interactions across the levels of herbicide, nitrogen, and variety.↩︎ "],["chap26.html", "第 26 章 分析重复测量实验的方法 26.1 模型指定和理想条件 26.2 时间的裂区分析 26.3 使用 SAS-Mixed 程序的数据分析 26.4 结束语 26.5 练习", " 第 26 章 分析重复测量实验的方法 与使用裂区设计的实验一样，使用重复测量设计 (repeated measures designs) 的实验具有涉及多个尺寸的实验单元的结构。例如，可以随时间测量个体 (subject47)，其中时间是实验处理结构中的因素之一。通过在几个不同的时间测量个体，个体本质上被 “分裂” 成多个部分（时间间隔），并测量每个部分的响应。较大的实验单元是个体或时间间隔的集合。较小的单元是个体接受处理的时间间隔，或只是时间测量之间的间隔48。 重复测量设计不同于裂区设计，因为一个或多个因素的水平不能随机分配到实验中一个或多个实验单元的尺寸。在这种情况下，时间的水平不能随机分配到时间间隔，因此像裂区实验一样分析重复测量实验可能是无效的。由于这种非随机分配方式，相应实验单元误差的协方差阵的结构可能不符合常规裂区实验所对应协方差阵结构。将重复测量实验视为裂区实验进行分析通常称为时间的裂区分析 (split-plot in time analysis). 第 26.1 节描述了重复测量模型，给出了必要的假设，这些假设使时间的裂区方差分析 (split-plot in time analysis of variance) 有效。第 26.2 节给出了三个示例，演示了用于时间的裂区方差分析的计算，包括用于在均值之间进行各种比较的标准误的计算。第 27 章提出了当不满足时间的裂区分析的假设时分析重复测量实验的方法。此外，还提出了一些方法，可以检验时间的裂区分析的假设是否满足。 26.1 模型指定和理想条件 重复测量设计可以应用于多种情况。下一节将分析的示例 26.1 研究了三种药物对心率的影响，其中每种药物对八个人进行了给药。然后在给药后的 5, 10, 15 和 20 分钟测量每个人的心率。 在简单重复测量实验的一般模型中，\\(n_i\\) 名个体被随机分配处理 i，每个个体在 p 个时间点进行测量。表 26.1 说明了简单重复测量实验的布局。 表 26.1: 一个简单重复测量实验的布局 x 当使用时间的裂区这种表述时，较大尺寸的实验单元是个体，较小尺寸的实验单元是时间间隔。描述每个测量响应的模型类似于完全随机设计中的裂区模型，由 \\[\\begin{equation} y_{ijk}=\\mu+\\alpha_i+\\delta_{ik}+\\tau_j+(\\alpha\\tau)_{ij}+\\varepsilon_{ijk} \\tag{26.1} \\end{equation}\\] 或 \\[y_{ijk}=\\mu_{ij}+\\delta_{ik}+\\varepsilon_{ijk}\\] 给出。其中 \\(\\mu+\\alpha_i+\\delta_{ik}\\) 表示模型的个体部分，\\(\\tau_j+(\\alpha\\tau)_{ij}+\\varepsilon_{ijk}\\) 是模型的个体内（时间间隔）部分。在时间 j 处的处理 i 的均值为 \\[\\mu_{ij}=\\mu+\\alpha_i+\\tau_j+(\\alpha\\tau)_{ij}\\] \\(\\delta_{ik}\\) 表示个体误差分量，\\(\\varepsilon_{ijk}\\) 表示个体间 (within-subject)（时间间隔）误差。时间的裂区分析的理想条件为 \\(\\delta_{ik}\\) 独立同分布于 \\(N(0,\\sigma_{\\delta}^{2})\\) \\(\\varepsilon_{ijk}\\) 独立同分布于 \\(N(0,\\sigma_\\varepsilon^2)\\) 所有 \\(\\delta_{ik}\\) 和 \\(\\varepsilon_{ijk}\\) 相互独立 请注意，这些假设与在完全随机设计中对裂区实验进行分析时所做的假设相同（见第 24 章）。这种假设可能并不总是适用于重复测量设计。然而，在更一般的条件下，裂区分析也是正确的分析。更一般的条件将在第 27 章中给出。 在示例 26.3 中，研究了家庭成员的态度是否与其居住环境（乡村或城市）有关。研究所需的家庭类型包括三位成员：儿子、父亲和母亲。随后，从城市环境中随机选择了 10 个这样的家庭，从乡村环境中随机选择了 7 个这样的家庭。确定了每个家庭成员对道德问题的态度。此外，研究还关注态度是否会随着时间发生变化；因此，在 0 个月、6 个月和 12 个月的时间点对每个人进行了测量。该设计中共有三种尺寸的实验单元：对应于环境处理效应的实验单元是家庭；对应于家庭成员效应的实验单元是个人；而对应于时间的实验单元是 6 个月的时间间隔。描述态度的模型具有三个误差分量，分别对应实验中的每种实验单元尺寸。模型为 \\[\\begin{aligned} Y_{ijkm}&amp; =\\mu+\\alpha_{i}+f_{im} &amp;&amp;\\text{family experimental unit}\\\\ &amp;+\\beta_j+(\\alpha\\beta)_{ij}+p_{ijm} &amp;&amp;\\text{person experimental unit}\\\\ &amp;+\\tau_k+(\\alpha\\tau)_{ik}+(\\beta\\tau)_{jk}+(\\alpha\\beta\\tau)_{ijk}+\\varepsilon_{ijkm}&amp;&amp;\\text{time interval experimental unit} \\end{aligned}\\] 或 \\[\\begin{equation} y_{ijkm}=\\mu_{ijk}+f_{im}+p_{ijm}+\\varepsilon_{ijkm} \\tag{26.2} \\end{equation}\\] 在上述模型中，\\(i=1,2;j=1,2,3;k=1,2,3;m=1,2,\\ldots,n_i\\)，其中 \\(n_1=10,n_2=7\\). 误差项为，\\(f_{im}\\) 表示环境内家庭误差、\\(p_{ijm}\\) 表示家庭内个人误差，\\(\\varepsilon_{ijkm}\\) 表示个人内时间误差。请注意，本实验有两组重复测量，三个家庭成员形成一组重复测量值，因为家庭成员的指定不能随机分配给家庭成员49，时间形成第二组重复测量。如果两组重复测量都满足传统的裂区型假设，那么上述模型中误差项的理想条件是 \\(f_{im}\\) 独立同分布于 \\(N(0,\\sigma_f^2)\\). \\(p_{ijm}\\) 独立同分布于 \\(N(0,\\sigma_p^2)\\). \\(\\varepsilon_{ijkm}\\) 独立同分布于 \\(N(0,\\sigma_\\varepsilon^2)\\). 所有 \\(f_{im},p_{ijm}\\) 和 \\(\\varepsilon_{ijkm}\\) 相互独立 第 27 章将探讨家庭成员示例的一种分析方法，该方法不需要满足理想条件。 26.2 时间的裂区分析 通常的时间的裂区方差分析是指第 24 章和第 25 章中讨论的裂区和条区设计的分析。这种分析可由大多数计算机程序包提供。如果满足理想条件，则这些分析提供了有效的 \\(F\\) 检验。 本节中使用了三个例子来演示重复测量设计的分析，并展示如何确定感兴趣效应的估计及其标准误估计（进行各种多重比较所必需的），并提供研究各种均值之间对比的方法。这里使用的例子也在第 24 章中用于演示当模型误差项不满足理想条件时所需的技术。 26.2.1 示例 26.1：药物对心率的影响 进行了一项涉及 t 种药物的实验，以研究每种药物对人类心率的影响。给药后，每隔五分钟测量一次每个人的心率，总共 p 次。在研究开始时，n 名女性受试者被随机分配每种药物。使用类似于等式 (26.1) 的模型来描述数据。模型为 \\[y_{ijk}=\\mu+\\alpha_i+\\delta_{ik}+\\tau_j+(\\alpha\\tau)_{ij}+\\varepsilon_{ijk},~i=1,2,\\ldots,t;~j=1,2,\\ldots,p;~k=1,2,\\ldots,n\\] 该模型有两个误差项：\\(\\delta_{ik}\\) 表示个体误差分量，\\(\\varepsilon_{ijk}\\) 表示时间误差分量。时间的裂区分析的理想条件为 \\(\\delta_{ik}\\) 独立同分布于 \\(N(0,\\sigma_\\delta^2)\\). \\(\\varepsilon_{ijk}\\) 独立同分布于 \\(N(0,\\sigma_\\varepsilon^2)\\). 所有 \\(\\delta_{ik}\\) 和 \\(\\varepsilon_{ijk}\\) 相互独立 表 26.2 给出了示例 26.1 的时间的裂区方差分析表。 表 26.2: 示例 26.1 的方差表分析 x 在表 26.2 中，\\(Q_{Drug},Q_{Time}\\) 和 \\(Q_{Drug\\times Time}\\) 分别是测量药物效应、时间效应和药物 × 时间交互效应的非中心参数。当且仅当相应的效应等于零时，这些 \\(Q\\) 值为零。 为检验 \\(H_{01}\\colon Q_{Drug}=0\\)，拒绝 \\(H_{01}\\) 如果 \\[F=\\frac{MSDrug}{MSError(Subject)}&gt;F_{\\alpha,t-1,t(n-1)}\\] 为检验 \\(H_{02}\\colon Q_{Time}=0\\)，拒绝 \\(H_{02}\\) 如果 \\[F=\\frac{MSTime}{MSError(Time)}&gt;F_{\\alpha,p-1,t(p-1)(n-1)}\\] 为检验 \\(H_{03}\\colon Q_{Drug\\times Time}=0\\)，拒绝 \\(H_{03}\\) 如果 \\[F=\\frac{MSDrug\\times Time}{MSError(Time)}&gt;F_{\\alpha,(t-1)(p-1),t(p-1)(n-1)}\\] 与裂区实验类似，两个方差分量的矩法解由下式给出 \\[\\begin{aligned}\\tilde{{\\sigma}}_\\varepsilon^2&amp;=MSError(Time)\\\\\\tilde{{\\sigma}}_\\delta^2&amp;=\\frac{MSError(Subject)-\\tilde{{\\sigma}}_\\varepsilon^2}p\\end{aligned}\\] 那么两个方差分量的估计为 \\[\\begin{aligned}\\hat{\\sigma}_\\varepsilon^2&amp;=\\tilde{\\sigma}_\\varepsilon^2\\\\\\hat{\\sigma}_\\delta^2&amp;=\\begin{cases}\\tilde{\\sigma}_\\delta^2&amp;\\mathrm{if~}\\tilde{\\sigma}_\\delta^2&gt;0\\\\0&amp;\\mathrm{if~}\\tilde{\\sigma}_\\delta^2\\leq0&amp;\\end{cases}\\end{aligned}\\] 当在数据中发现显著效应时，通常希望对各种均值进行相互比较。如果没有药物与时间的交互作用，那么我们通常会想要比较药物主效应的均值和时间主效应的均值。如果交互效应显著，那么可能希望在同一时间点上对不同药物之间的均值进行比较，或者对每种药物在不同时间点上的均值进行比较。\\(\\mu_{ij},\\bar{\\mu}_{i\\cdot},\\bar{\\mu}_j\\) 和 \\(\\bar{\\mu}_{\\cdot\\cdot}\\) 的估计分别为 \\(\\hat{{\\mu}}_{ij}=\\bar{{y}}_{ij\\cdot},\\hat{\\bar{{\\mu}}}_{i\\cdot}=\\bar{{y}}_{i\\cdot\\cdot},\\hat{\\bar{{\\mu}}}_{\\cdot j}=\\bar{{y}}_{\\cdot j\\cdot}\\) 和 \\(\\hat{{\\bar{\\mu}}}_{\\cdot\\cdot}=\\bar{{y}}_{\\cdot\\cdot\\cdot}\\). 由于重复测量设计涉及多种尺寸的实验单元和多个误差项，因此每次比较的方差可能涉及各误差项方差的不同函数，因此需要确定。表 26.3 给出了重复测量实验中均值参数各种函数的最佳估计及其各自的标准误估计。 表 26.3: 各种参数函数、最佳估计和的标准误估计 x 最后，\\(\\mu_{ij}-\\mu_{i&#39;j}-\\mu_{ij&#39;}+\\mu_{i&#39;j&#39;}\\) 的估计为 \\(\\hat{\\mu}_{ij}-\\hat{\\mu}_{i&#39;j}-\\hat{\\mu}_{ij&#39;}+\\hat{\\mu}_{i&#39;j&#39;}\\)，当 \\(i\\ne i&#39;,j\\ne j&#39;\\) 时，标准误估计为 \\(\\sqrt{(4\\hat{\\sigma}_{\\varepsilon}^{2}/n)}\\). 可以使用最佳估计与其标准误估计的比值来对上述每个参数函数进行推断。每个比值要么具有 \\(t\\) 分布，要么可以通过 \\(t\\) 分布来近似。对于那些标准误估计仅涉及 \\(\\hat \\sigma^2_\\varepsilon\\) 的比值，该比率具有精确的 \\(t\\) 分布，自由度为 t(n - 1)(p - 1). 对于那些标准误估计为 \\(\\sqrt{(\\hat{\\sigma}_{\\varepsilon}^{2}+p\\hat{\\sigma}_{\\delta}^{2})}\\) 倍数的比值，该比值也具有精确的 \\(t\\) 分布，但自由度为 t(n - 1). 最后，对于那些标准误估计为 \\(\\sqrt{(\\hat{\\sigma}_{\\varepsilon}^{2}+\\hat{\\sigma}_{\\delta}^{2})}\\) 倍数的比值，该比率具有近似 \\(t\\) 分布，其自由度必须通过 Satterthwaite 法进行近似。 一般来说，令 \\({\\varphi}=\\sum_{i=1}^{t}{\\sum}_{j=1}^{p}{c}_{i{j}}{\\mu}_{i{j}}\\) 为 \\(\\mu_{ij}\\) 的任何线性组合，那么 \\(\\hat \\mu_{ij}\\) 的相同线性组合 \\({\\hat\\varphi}=\\sum_{i=1}^{t}{\\sum}_{j=1}^{p}{c}_{i{j}}{\\hat\\mu}_{i{j}}\\) 是其最佳估计。对于 \\(k,c_1,c_2\\) 的某种取值，\\(\\hat \\phi\\) 的方差估计等于 \\(k[c_1{\\hat{\\sigma}}_1^2+c_2{\\hat{\\sigma}}_2^2]\\)，其中 \\(v_i\\hat{\\sigma}_i^2/\\sigma_i^2\\) 独立分布于 \\(\\chi^2(v_i)\\)，其中 \\(i=1,2\\). 那么 \\({(\\widehat{\\phi}-\\phi)}\\widehat{s.e.}(\\widehat{\\phi})\\) 近似为 \\(t(\\hat v)\\)，其中 \\[\\hat{v}=\\frac{(c_1\\hat{\\sigma}_1^2+c_2\\hat{\\sigma}_2^2)^2}{(c_1^2\\hat{\\sigma}_1^2/v_1)+(c_2^2\\hat{\\sigma}_2^2/v_2)}\\] 对于正在考虑的例子，\\(\\hat{{\\sigma}}_1^2\\) 是自由度为 \\(v_1=t(n-1)\\) 的 MSError(Subject)，\\(\\hat{{\\sigma}}_2^2\\) 是自由度为 \\(v_2=t(n-1)(p-1)\\) 的 MSError(Time). 此外，对于那些标准误估计为 \\(\\hat{{\\sigma}}_\\varepsilon^2+\\hat{{\\sigma}}_\\delta^2\\) 倍数的比值，则 \\(c_1 = 1/p\\) 且 \\(c_2 = (p - 1)/p\\). 接下来考虑药物主效应均值的线性对比 \\(\\sum_{i=1}^tc_i\\bar{\\mu}_{i\\cdot}\\)。这种对比的标准误估计为 \\[\\sqrt{\\frac{(\\hat{\\sigma}_\\varepsilon^2+p\\hat{\\sigma}_\\delta^2)\\sum_{i=1}^tc_i^2}{np}}\\] 因此 \\[\\frac{\\sum_{i=1}^tc_i\\hat{\\bar{{\\mu}}}_{i\\cdot}-\\sum_{i=1}^tc_i\\bar{{\\mu}}_{i\\cdot}}{\\sqrt{\\frac{(\\hat{{\\sigma}}_\\varepsilon^2+p\\hat{{\\sigma}}_\\delta^2)\\sum_{i=1}^tc_i^2}{np}}}\\sim t[t(n-1)]\\] 考虑时间主效应均值的线性对比 \\(\\sum_{i=1}^td_j\\bar{\\mu}_{\\cdot j}\\)。这种对比的标准误估计是 \\[\\sqrt{\\frac{\\hat{{\\sigma}}_\\varepsilon^2\\sum_{j=1}^pd_j^2}{nt}}\\] 因此 \\[\\frac{\\sum_{j=1}^pd_j\\hat{{\\bar{\\mu}}}_{\\cdot j}-\\sum_{j=1}^pd_j{{\\bar{\\mu}}}_{\\cdot j}}{\\sqrt{\\frac{{\\hat{\\sigma}}_\\varepsilon^2\\sum_{j=1}^pd_j^2}{nt}}}\\sim t[t(n-1)(p-1)]\\] 这种对比可用于检查随时间变化的线性、二次和类似趋势。 如果存在药物 × 时间交互作用，那么我们需要比较每个时间段的药物和/或比较每种药物的时间段。也就是说，可以考虑 j 的每种可能性的 \\(\\mu_{ij}\\) 中的对比，和/或 i 的每种可能性的 \\(\\mu_{ij}\\) 中的对比。对于前者，可以证明，对于每个 j \\[\\frac{\\sum_{i=1}^tc_i\\hat{{\\mu}}_{ij}-\\sum_{i=1}^tc_i\\mu_{ij}}{\\sqrt{\\frac{(\\hat{\\sigma}_\\varepsilon^2+\\hat{\\sigma}_\\delta^2)\\sum_{i=1}^tc_i^2}n}}\\] 近似分布于自由度为 \\(\\hat v\\) 的 \\(t\\) 分布。对于后者，可以证明，对于每个 i \\[\\frac{\\sum_{i=1}^td_j{\\hat{\\mu}}_{ij}-\\sum_{i=1}^td_j{\\mu}_{ij}}{\\sqrt{\\frac{{\\hat{\\sigma}}_\\varepsilon^2\\sum_{i=1}^td_j^2}n}}\\] 正好是自由度为 t(n - 1)(p - 1) 的 t 分布。这两个结果可以用来检验假设，并为行内或列内的 \\(\\mu_{ij}\\) 的对比构造置信区间。 表 26.4 中的数据用于演示上述分析。在这个实验中，有三种药物，每种药物八个人，以及四个时间段。方差分析表见表 26.5. 存在显著的时间与药物交互作用；因此，我们需要对每种药物的不同时间进行比较，并在每个时间点对不同药物进行比较。 表 26.4: 示例 26.1 的心率数据 x 注释: \\(T_i\\) 表示第 i 个时间段 表 26.5: 数据表 26.4 的方差分析表 x 注释: Q 表示相应的非中心参数 为比较每种药物的不同时间，两均值之差的标准误估计（见表 26.3）为 \\[\\widehat{s.e.}(\\hat{\\mu}_{ij}-\\hat{\\mu}_{íj})=\\sqrt{2\\hat{\\sigma}_\\varepsilon^2/n}=\\sqrt{2(7.45)/8}=1.365\\] 每种药物中用于比较时间均值的 5% LSD 值为 \\[\\mathrm{LSD}_{0.05}=t_{0.025,63}[\\widehat{s.e.}(\\hat{\\mu}_{ij}-\\hat{\\mu}_{i^{\\prime}j})]=(2.00)(1.365)=2.730\\] 表 26.6 中给出了相同药物中时间均值的比较。 表 26.6: 表 26.6 中数据在相同药物中时间均值比较 x 注释: 在 5% 的显著水平上，在一列内具有相同字母的均值没有显著差异。\\(\\text{LSD}_{0.05}=2.730\\). 由于时间水平是定量的且等距的，因此可以使用正交多项式来检查对每种药物的响应的线性和二次趋势。第一种药物的线性时间趋势的测量值为 \\(\\theta_{LT_1}=-3\\mu_{11}-1\\mu_{12}+1\\mu_{13}+3\\mu_{14}\\)，其估计为 \\[\\hat{\\theta}_{LT_1}=-3(70.50)-1(80.50)+1(81.00)+3(73.13)=8.39\\] 相应的标准误估计为 \\[\\widehat{s.e.}(\\hat{{\\theta}}_{LT_1})=\\sqrt{\\frac{{\\hat{\\sigma}}_\\varepsilon^2\\sum_{i=1}^td_j^2}n}=\\sqrt{\\frac{7.45(9+1+1+9)}8}=4.316\\] 相应的 \\(t\\) 统计量为 \\(t_c=8.39/4.316=1.94\\). 第一种药物的时间二次趋势的测量为 \\[\\theta_{QT_1}=1{\\mu}_{11}-1{\\mu}_{12}-1{\\mu}_{13}+1{\\mu}_{14}\\] 其估计为 \\[\\hat{\\theta}_{QT_1}=1\\hat{\\mu}_{11}-1\\hat{\\mu}_{12}-1\\hat{\\mu}_{13}+1\\hat{\\mu}_{14}=70.50-80.50-81.00+73.13=-17.87\\] 其标准误估计为 \\[\\widehat{s.e.}(\\hat{\\theta}_{LT_1})=\\sqrt{\\frac{\\hat{{\\sigma}}_\\varepsilon^2\\sum_{i=1}^td_j^2}n}=\\sqrt{\\frac{7.45(1+1+1+1)}8}=1.930\\] 相应的 \\(t\\) 统计量为 \\(t_c=-17.87/1.930=9.259\\). 表 26.7: 表 26.4 中数据每种药物的线性和二次趋势估计 x 注释: 括号中的值是相应的 \\(t\\) 统计量 图 26.1: 心率数据中每种药物各时间点的均值 表 26.7 总结了所有药物在时间上的线性和二次趋势。药物 BWW9 呈负线性趋势，药物 AX23 呈强二次趋势。图 26.1 中的图表显示了这些关系。为了在每个时间点相互比较药物，标准误估计为 \\(\\widehat{s.e.}(\\hat{{\\mu}}_{ij}-\\hat{{\\mu}}_{i&#39;j})=\\sqrt{[2(\\hat{{\\sigma}}_\\varepsilon^2+\\hat{{\\sigma}}_\\delta^2)/n]}\\). 为了评估这个量，必须估计每个方差分量。可以得到 \\[\\hat{{\\sigma}}_\\varepsilon^2=MSError(Time)=7.45\\] 和 \\[\\hat{\\sigma}_\\delta^2=\\frac{MSError(Subject)-\\tilde{\\sigma}_\\varepsilon^2}p=\\frac{111.33-7.45}4=25.97\\] 那么 \\[\\widehat{s.e.}(\\hat{\\mu}_{ij}-\\hat{\\mu}_{i^{\\prime}j})=\\sqrt{2(\\hat{\\sigma}_\\varepsilon^2+\\hat{\\sigma}_\\delta^2)/n}=\\sqrt{\\frac{2(7.45+25.97)}8}=2.891\\] 该标准误估计的 Satterthwaite 自由度估计为 \\[\\hat{v}=\\frac{[c_1\\hat{\\sigma}_1^2+c_2\\hat{\\sigma}_2^2]^2}{\\frac{c_2^2\\hat{\\sigma}_1^4}{v_1}+\\frac{c_2^2\\hat{\\sigma}_2^4}{v_2}}=\\frac{[\\frac14(111.33)+\\frac34(7.45)]^2}{\\frac{\\frac1{16}(111.33)^2}{21}+\\frac{\\frac9{16}(7.45)^2}{63}}=\\frac{(33.42)^2}{36.888+0.496}=29.9\\] 在每个时间点将对药物均值彼此比较的 5% 显著性水平下的近似 LSD 为 \\[\\mathrm{LSD}_{0.05}=t_{0.025,29.9}\\times\\widehat{s.e.}(\\hat{\\mu}_{ij}-\\hat{\\mu}_{i^{\\prime}j})=(2.042)(2.891)=5.903\\] 表 26.8 给出了各时间点药物之间的比较。 表 26.8: 表 26.4 中数据各时间点药物之间的比较 x 注释: 在 5% 的显著性水平上，在一行中具有相同字母的均值没有显著差异。\\(\\text{LSD}_{0.05}=5.903\\) 假设药物 AX23 和 BWW9 是实验性的，我们想在每个时间点将它们的平均值与对照进行比较。在时间 1，与该比较相关的对比为 \\(\\theta=\\mu_{11}+\\mu_{21}-2\\mu_{31}\\). 其估计为 \\({\\hat{\\theta}}=70.5+81.75-2\\times72.75=6.75\\)，标准误估计为 \\[\\widehat{s.e.}\\left(\\hat{\\theta}\\right)=\\sqrt{\\frac{(\\hat{\\sigma}_{\\varepsilon}^{2}+\\hat{\\sigma}_{\\delta}^{2})\\sum_{i=1}^{t}c_{i}^{2}}n}=\\sqrt{\\frac{(7.45+25.97)(1+1+4)}8}=5.006\\] 相应的 \\(t\\) 统计量为 \\(t_c=6.75/4.088=1.651\\). 我们无法拒绝 \\(H_0{:{\\theta}}=0\\) 因为 \\(t_{0.025,29.9}=2.042\\). 表 26.9 给出了在每个时间段两种实验药物的平均值与对照药物的比较。结果表明，在 5% 显著水平下，在最后三个时间间隔，药物的平均值有显著性差异，但在时间 1 时没有差异。 表 26.9: 在每个时间点药物 AX23 和 BWW9 的平均值与对照组的比较 x 注释: * 表示在 5% 水平下显著，\\(t_{0.025,29.9}=2.042\\) 26.2.2 示例 26.2：一个复杂的舒适度实验 一位工程师有三种环境 (environments) 来检验两种类型的衣物 (clothing). 由于男性和女性对环境的反应也有所不同，因此性别 (sex) 也被视为一个因素。四人（两名男性和两名女性）被放入一个环境室 (chamber)（该室分配了三种环境之一）。一名男性和一名女性着衣物类型 1，另一名男性和女性则着衣物类型 2. 每个人的舒适度评分在 1 小时、2 小时和 3 小时结束时都被记录下来。该实验的数据如表 26.10 所示。实验单元有三种大小。最大的实验单元是一个室，或等价地，四个人的组。室实验单元的实验设计是完全随机设计结构中的单向处理结构（环境是处理），每个环境水平有三次重复。中等大小的实验单元是一个人 (person). 一个人的实验设计是随机完全区组设计结构中的双向处理结构（性别 × 衣物），共有九个区组（每个区组包含四个实验单元（人）。最小的实验单元是一个 1 小时的时间间隔，我们将其称为小时 (hour). 小时的实验设计是随机完全区组设计结构中的单向处理结构（时间），共有 36 个区组【每个区组包含三个实验单元（1 小时时间间隔）】。 表 26.10: 示例 26.2 舒适性实验的数据 x 该实验的模型为（其中模型被分为与三种尺寸的实验单元相对应的部分，并假设小时测量满足时间的裂区假设） \\[\\begin{aligned} Y_{ijkmn} =&amp;\\,{\\mu}+E_{i}+{r}_{in} &amp;&amp; \\text{Chamber part} \\\\ &amp;+S_j+C_k+(SC)_{jk}+(ES)_{ij}+(EC)_{ik}+(ESC)_{ijk}+p_{ijkn}&amp;&amp; \\text{Person part} \\\\ &amp;+T_m+(ET)_{im}+(ST)_{jm}+(CT)_{km}+(SCT)_{jkm}+(EST)_{ijm}+(ECT)_{ikm}&amp;&amp;\\text{Hour part} \\\\ &amp;+(ESCT)_{ijkm}+E_{ijkmn} \\end{aligned}\\] 其中，E 表示环境，S 表示性别，C 表示衣服类型，T 表示时间，\\(r_{in}\\) 表示随机室效应并假定其分布为 \\(i.i.d. N(0, \\sigma_r^2)\\)，\\(p_{ijkn}\\) 表示假定在随机人效应并假定其分布为 \\(i.i.d. N(0, \\sigma_p^2)\\)，\\(\\varepsilon_{ijkmn}\\) 表示给定小时的测量误差并假定其分布为 \\(i.i.d. N(0, \\sigma_\\varepsilon^2)\\)。此外，所有 \\(r_{in},p_{ijkn},\\varepsilon_{ijkmn}\\) 都是独立分布的误差项。 表 26.11 给出了在上述误差项假设下的方差分析表。\\(F\\) 统计量是在期望均方的指导下计算的。 表 26.11: 示例 26.2 方差分析表 x 注释: 表中的所有数值都四舍五入为两位有效数字，但计算是以双精度进行的。\\(Q_\\ell\\) 表示对应于给定效果的非中心参数 表 26.11 中的误差平方和计算如下 \\[ \\begin{aligned} SSERROR(PERSON) =&amp;\\,Replication \\times Sex \\times Clothing(Environment) SS\\\\ &amp;+ Replication \\times Sex(Environment) SS\\\\ &amp;+ Replication \\times Clothing(Environment) SS \\end{aligned} \\] 以及 \\[SSERROR(CHAMBER)=Chamber(Environment)SS\\] 分析的下一步是进行必要的比较。如果选择 \\(\\alpha = 0.01\\) 作为 I 类错误概率，则存在两个显著的交互作用：Environment × Time 和 Sex × Clothing. 对于 Sex × Clothing 交互作用，我们需要比较四种 Sex × Clothing 的均值。由于两种处理均应用于相同尺寸的实验单元（人），因此只需计算一个标准误。 令 \\[\\begin{aligned}\\mu_{ijkm}=&amp;\\,\\mu+E_i+S_j+C_k+(SC)_{jk}+(ES)_{ij}+(EC)_{ik}+(ESC)_{ijk}+T_m+(ET)_{im}\\\\&amp;+(ST)_{jm}+(CT)_{km}+(SCT)_{jkm}+(EST)_{ijm}+(ECT)_{ikm}+(ESCT)_{ijkm}\\end{aligned}\\] 差值 \\(\\bar{{\\mu}}_{\\cdot jk{\\cdot}}-\\bar{{\\mu}}_{\\cdot j&#39;{k&#39;\\cdot}}\\) 可被估计为 \\(\\bar{Y}_{\\cdot jk\\cdot\\cdot}-\\bar{Y}_{\\cdot j^{\\prime}k^{\\prime}\\cdot\\cdot}\\)，\\(\\bar{Y}_{\\cdot jk\\cdot\\cdot}-\\bar{Y}_{\\cdot j^{\\prime}k^{\\prime}\\cdot\\cdot}\\) 的标准误估计为 \\[\\widehat{s.e.}(\\bar{Y}_{\\cdot jk\\cdot\\cdot}-\\bar{Y}_{\\cdot j^{\\prime}k^{\\prime}\\cdot\\cdot})=\\sqrt{\\frac{2MSERROR(PERSON)}{3\\cdot3\\cdot3}}=\\sqrt{\\frac{2\\cdot(0.58)}{27}}=0.207\\] 自由度为 18. 1% 显著性水平下的 Fisher’s LSD 为 \\[(t_{0.005,18})\\mathrm{~}\\widehat{s.e.}(\\bar{Y}_{\\cdot jk\\cdot\\cdot}-\\bar{Y}_{\\cdot j^{\\prime}k^{\\prime}\\cdot\\cdot})=2.878\\cdot0.207=0.596\\] 表 26.12 列出了 Sex × Clothing 的均值，所有这些都彼此显著不同。 表 26.12: 示例 26.2 带 LSD 的 Sex × Clothing 均值 x 注释: \\(\\text{LSD}_{0.01} = 0.595\\). 所有均值基于 27 个观测 Environment × Time 交互作用涉及两个不同尺寸的实验单元；因此，有两种类型的比较。首先，可以比较每个环境的两个时间平均值，并且可以检查每个环境的时间平均值之间的线性和二次趋势。其次，人们可以在每个时间点对环境进行比较。 相同环境下两个时间均值比较的标准误为 \\[s.e.(\\bar{Y}_{i\\cdot\\cdot m\\cdot}-\\bar{Y}_{i\\cdot\\cdot m^{\\prime}\\cdot})=s.e.\\left[(\\bar{r}_{i\\cdot}-\\bar{r}_{i\\cdot})+(\\bar{p}_{i\\cdot\\cdot\\cdot}-\\bar{p}_{i\\cdot\\cdot\\cdot})+(\\bar{\\varepsilon}_{i\\cdot\\cdot m\\cdot}-\\bar{\\varepsilon}_{i\\cdot\\cdot{m^{\\prime}}\\cdot})\\right]=s.e.\\left[(\\bar{\\varepsilon}_{i\\cdot\\cdot m\\cdot}-\\bar{\\varepsilon}_{i\\cdot\\cdot{m^{\\prime}}\\cdot})\\right]=\\sqrt{\\frac{2\\sigma_\\varepsilon^2}{2\\cdot2\\cdot3}}\\] 以及 \\[\\widehat{s.e.}\\left(\\bar{Y}_{i\\cdot\\cdot m\\cdot}-\\bar{Y}_{i\\cdot\\cdot m^{\\prime}\\cdot}\\right)=\\sqrt{\\frac{2\\hat{\\sigma}_\\varepsilon^2}{2\\cdot2\\cdot3}}=\\sqrt{\\frac{2(0.06)}{12}}=0.01\\] 同一环境下两时间点比较的 1% LSD 值为 \\(t_{0.005,48}(0.01)=2.682(0.01) = 0.268\\). 表 26.13 包含 Environment × Time 均值以及每个环境的时间之间的比较。 表 26.13: 示例 26.2 在每个环境下比较时间的 Environment × Time 均值 x 注释: 在给定的环境（列）中，相同字母的时间均值没有显著差异；\\(\\text{LSD}_{0.01}=0.268\\) 由于时间的三个水平的间隔相等，因此可以使用正交多项式来测量每个环境随时间的线性和二次趋势。环境 1 的线性趋势通过 \\(\\hat{\\theta}_{LT_1}=-\\bar{Y}_{1\\cdot\\cdot1\\cdot}+0\\bar{Y}_{1\\cdot\\cdot2\\cdot}+\\bar{Y}_{1\\cdot\\cdot3\\cdot}=-15.11+12.01=-3.10\\) 来测量，其标准误估计为 \\[s.e.\\left(\\hat{\\theta}_{LT_1}\\right)=\\sqrt{\\frac{\\hat{\\sigma}_\\varepsilon^2[(-1)^2+(1)^2]}{12}}=\\sqrt{\\frac{(0.06)(2)}{12}}=0.1\\] 相应的 \\(t\\) 统计量为 \\(t_c = -3.10/0.1 = -31.0\\)，自由度为 48. 环境 1 中时间点的二次趋势通过 \\(\\hat{{\\theta}}_{QT_{1}}=1\\bar{Y}_{1{\\cdot\\cdot}1{\\cdot}}-2\\bar{Y}_{1{\\cdot\\cdot}2{\\cdot}}+1\\bar{Y}_{1{\\cdot\\cdot}3{\\cdot}}=15.11 - 2(9.11) + 12.01 = 8.90\\) 来测量。其标准误估计由下式给出 \\[s.e.\\left(\\hat{\\theta}_{{Q}T_1}\\right)=\\sqrt{\\frac{\\hat{\\sigma}_{\\varepsilon}^2[(1)^2+(-2)^2+(1)^2]}{12}}=\\sqrt{\\frac{(0.06)(6)}{12}}=0.173\\] 相应的 \\(t\\) 统计量为 \\(t_c = 8.90/0.173 = -51.45\\)，自由度为 48. 表 26.14 给出了每种环境的线性和二次趋势。环境 1 和 2 存在显著的线性和二次趋势，但环境 3 则没有。图 26.2 展示了这些关系。 表 26.14: 示例 26.2 种环境的线性和二次趋势的度量 x 注释: \\(t\\) 值在括号中 图 26.2: 舒适度数据每种环境下各时间点的响应 第二种 Environment × Time 比较是对同一时间或不同时间的不同环境进行比较。这种比较的标准误是 \\[\\begin{aligned} s.e.\\left(\\bar{Y}_{i\\cdot\\cdot m\\cdot}-\\bar{Y}_{i^{\\prime}\\cdot\\cdot m\\cdot}\\right)&amp; =s.e.\\left[(\\bar{r}_{i\\cdot}-\\bar{r}_{i&#39;\\cdot})+(\\bar{p}_{i\\cdot\\cdot m}-\\bar{p}_{i&#39;\\cdot\\cdot m})+(\\bar{\\varepsilon}_{i\\cdot\\cdot m\\cdot}-\\bar{\\varepsilon}_{i&#39;\\cdot\\cdot m\\cdot})\\right] \\\\ &amp;=\\sqrt{\\frac{2\\sigma_r^2}3+\\frac{2\\sigma_p^2}{2\\cdot2\\cdot3}+\\frac{2\\sigma_\\varepsilon^2}{2\\cdot2\\cdot3}}=\\sqrt{\\frac2{12}(\\sigma_\\varepsilon^2+\\sigma_p^2+4\\sigma_r^2)} \\end{aligned}\\] 量 \\(\\sigma_\\varepsilon^2+\\sigma_p^2+4\\sigma_r^2\\) 可以通过 \\((1/3) MSERROR(CHAMBER) + (2/3) MSERROR(HOUR)\\) 来估计。因此 Satterthwaite 自由度估计为 \\[\\hat{v}=\\frac{[c_1\\hat{\\sigma}_1^2+c_2\\hat{\\sigma}_2^2]^2}{\\frac{c_1^2\\hat{\\sigma}_1^4}{v_1}+\\frac{c_2^2\\hat{\\sigma}_2^4}{v_2}}=\\frac{[\\frac13(29.21)+\\frac23(0.06)]^2}{\\frac{\\frac19(29.21)^2}{6}+\\frac{\\frac49(0.06)^2}{48}}=\\frac{(9.777)^2}{15.800+0.006}=6.05\\] 因为 \\[\\sqrt{\\frac{2\\left[\\frac13MSERROR(Chamber)+\\frac23MSERROR(Hour)\\right]}{12}}=\\sqrt{\\frac{2\\left[\\frac13(29.21)+\\frac23(0.06)\\right]}{12}}=1.276\\] 用于比较每个时间点内的环境的 1% LSD 为 \\(\\mathrm{LSD}_{0.01}=t_{0.005,6}(1.276)=(3.707)(1.276) = 4.73\\). 表 26.15 包含在同一时间不同环境之间进行的Fisher LSD比较的 Environment × Time 平均值。此示例说明了为什么在一组交互均值中进行比较时使用正确的误差项非常重要：两个 LSD 值可能差异极大。在此示例中，这两个值为 0.268 和 4.73. 因此，用于比较相同时间水平下环境的 LSD 0.01 值比用于比较相同环境下时间的 LSD0.01 值的 17 倍以上。 表 26.15: 用于在每个时间点比较环境均值的 Environment × Time 均值 x 注释: 在给定的时间（行）内，相同字母的环境均值没有显著差异；\\(\\text{LSD}_{0.01}=4.73\\) 为了演示如何使用第 24.3 中的信息来计算使用多于两种尺寸实验单元的情况下的标准误和相应的 \\(t\\) 统计量，我们构建了一个 LSD 来比较同一时间点内的环境和性别。假设感兴趣的比较为 \\(\\bar{{\\mu}}_{11{\\cdot}1}-\\bar{{\\mu}}_{22{\\cdot}1}\\). 对此的最佳估计为 \\(\\bar{Y}_{11{\\cdot}1{\\cdot}}-\\bar{Y}_{22{\\cdot}1{\\cdot}}=8.04\\). 接下来注意到该估计的方差是 \\[\\begin{aligned} \\mathrm{Var}(\\bar{Y}_{11{\\cdot}1{\\cdot}}-\\bar{Y}_{22{\\cdot}1{\\cdot}})&amp; =\\mathrm{Var}[(\\bar{r}_{1\\cdot}-\\bar{r}_{2\\cdot})+(\\bar{p}_{11\\cdot\\cdot}-\\bar{p}_{22\\cdot\\cdot})+(\\bar{\\varepsilon}_{11\\cdot\\cdot}-\\bar{\\varepsilon}_{22\\cdot\\cdot})] \\\\ &amp;=\\frac{2\\sigma_r^2}3+\\frac{2\\sigma_p^2}{2\\cdot3}+\\frac{2\\sigma_\\varepsilon^2}{2\\cdot3}=\\frac26(\\sigma_\\varepsilon^2+\\sigma_p^2+2\\sigma_r^2) \\end{aligned}\\] 括号内的量估计为 \\[\\begin{aligned}(1/6)&amp;MSERROR(CHAMBER)+(1/6)MSERROR(PERSON)\\\\&amp;+(2/3)MSERROR(HOUR)=(1/6)(29.21)+(1/6)(0.58)+(2/3)(0.06)=5.005\\end{aligned}\\] \\(\\bar{Y}_{11{\\cdot}1{\\cdot}}-\\bar{Y}_{22{\\cdot}1{\\cdot}}\\) 的标准误估计为 \\(\\widehat{s.e.}(\\bar{Y}_{11\\cdot1\\cdot}-\\bar{Y}_{22\\cdot1\\cdot})=\\sqrt{[2(5.005)/6]}=1.2916\\). 与该标准误估计相关的 Satterthwaite 自由度估计为 \\[\\frac{\\left[(\\frac16)(29.21)+(\\frac16)(0.58)+(\\frac23)(0.06)\\right]^2}{\\frac{(\\frac16)^2(29.21)^2}6+\\frac{(\\frac16)^2(0.58)^2}{18}+\\frac{(\\frac23)^2(0.06)^2}{48}}=\\frac{(5.005)^2}{3.9501+0.0005+0.00003}=\\frac{25.05}{3.9506}=6.34\\] 用于计算上述两个标准误的方法可以应用于其他情况，其中给定的比较可以划分为分量的总和，其中每个分量是仅针对一种尺寸的实验单元的比较。 26.2.3 示例 26.3：家庭态度 来自农村和城市环境的家庭的态度每六个月测量一次，为期三个时间段。数据来自 7 个农村家庭和 10 个城市家庭，每个家庭由一个儿子、父亲和母亲组成，如表 26.16 所示。用于描述数据的模型先前在等式 (26.2) 中给出。本节中的分析假设满足第 26.1 节中给出的理想条件。第 27 章将考虑不要求满足理想条件的更一般的分析。 表 26.16: 示例 26.3 的家庭态度研究数据 x 表 26.17 给出了与方程 (26.2) 中的模型相对应的方差分析表。如果我们在 \\(\\alpha=0.05\\) 下操作，则有四个显著的效应：Area, Person, Time 和 Area × Time. 表 26.17: 示例 26.3 的家庭态度数据的方差分析表 x 注释: \\(Q_\\ell\\) 表示对应于各个平方和的非中心参数 因此，我们希望进行三种比较：人与人之间、每个地区的时间之间以及每个时间的地区之间。 家庭成员之间比较的方差为 \\[\\begin{aligned} \\mathrm{Var}(\\bar{y}_{\\cdot j\\cdot\\cdot}-\\bar{y}_{\\cdot j&#39;\\cdot\\cdot}) &amp;=\\mathrm{Var}[(\\bar{f}_{\\cdot\\cdot}-\\bar{f}_{\\cdot\\cdot})+(\\bar{p}_{\\cdot j\\cdot}-\\bar{p}_{\\cdot j^{\\prime}\\cdot})+(\\bar{\\varepsilon}_{\\cdot j\\cdot\\cdot}-\\bar{\\varepsilon}_{\\cdot j^{\\prime}\\cdot\\cdot})] \\\\ &amp;=\\frac2{17}\\sigma_p^2+\\frac2{3\\cdot17}\\sigma_\\varepsilon^2=\\frac2{51}(\\sigma_\\varepsilon^2+3\\sigma_p^2) \\end{aligned}\\] 两个家庭成员均值差的标准误估计为 \\[\\widehat{s.e.}(\\bar{y}_{\\cdot j\\cdot\\cdot}-\\bar{y}_{\\cdot j&#39;\\cdot\\cdot})=\\sqrt{\\frac2{51}MSError(\\text{Person})}=\\sqrt{\\frac2{51}(25.512)}=0.9906\\] 5% LSD 值为 \\(LSD_{0.05}=2.042(0.99)=2.022\\). 表 26.18 总结了成对比较。指定地区内两个时间均值之差的方差为 \\[\\mathrm{Var}(\\bar{y}_{i\\cdot k\\cdot}-\\bar{y}_{i\\cdot k^{\\prime}\\cdot})=\\mathrm{Var}\\left[(\\bar{f}_{i\\cdot}-\\bar{f}_{i\\cdot})+(\\bar{p}_{i\\cdot}-\\bar{p}_{i\\cdot})+(\\bar{\\varepsilon}_{i\\cdot k}.-\\bar{\\varepsilon}_{i\\cdot k^{\\prime}\\cdot})\\right]=\\frac2{3n_{i}}\\sigma_{\\varepsilon}^{2}\\] 其中 \\(n_i\\) 表示地区 i 的家庭数量。 表 26.18: 示例 26.3 人均值的比较 x 注释: 在一列中具有相同字母的均值没有显著差异。\\(\\text{LSD}_{0.05}=2.022\\) 城市地区两时间比较的标准误估计为 \\[\\widehat{s.e.}(\\bar{y}_{1\\cdot k\\cdot}-\\bar{y}_{1\\cdot k^{\\prime}\\cdot})=\\sqrt{\\frac2{3n_1}\\hat{\\sigma}_\\varepsilon^2}=\\sqrt{\\frac2{30}(0.370)}=0.157\\] 以及在农村地区两时间比较的标准误估计为 \\[\\widehat{\\mathrm{s.e.}}(\\bar{y}_{2\\cdot k\\cdot}-\\bar{y}_{2\\cdot k^{\\prime}\\cdot})=\\sqrt{\\frac2{3n_2}\\hat{\\sigma}_\\varepsilon^2}=\\sqrt{\\frac2{21}(0.370)}=0.188\\] 相应的 5% LSD 为 \\(LSD_{0.05}(\\text{Urban})=1.987(0.157)=0.312\\) 和 \\(LSD_{0.05}(\\text{Rural})=1.987(0.188) = 0.374\\)。表 26.19 总结了多重比较。 表 26.19: 示例 26.3 在每个地区内时间均值的比较 x 注释: 在一列中具有相同字母的均值没有显著差异。农村的 \\(\\text{LSD}_{0.05}=2.022\\)，城市的 \\(\\text{LSD}_{0.05}=0.312\\) 接下来，在给定的时间点上，城市和农村均值之差的方差是 \\[\\begin{aligned} \\mathrm{Var}(\\bar{y}_{1\\cdot k\\cdot}-\\bar{y}_{2\\cdot k\\cdot})&amp; =\\text{Var}\\left[(\\bar{f}_{1\\cdot}-\\bar{f}_{2\\cdot})+(\\bar{p}_{1\\cdot}-\\bar{p}_{2\\cdot})+(\\bar{\\varepsilon}_{1\\cdot k\\cdot}-\\bar{\\varepsilon}_{2\\cdot k\\cdot})\\right] \\\\ &amp;=\\sigma_f^2\\left(\\frac1{10}+\\frac17\\right)+\\sigma_p^2\\left(\\frac1{3\\cdot10}+\\frac1{3\\cdot7}\\right)+\\sigma_\\varepsilon^2\\left(\\frac1{3\\cdot10}+\\frac1{3\\cdot7}\\right)=\\left(\\frac1{30}+\\frac1{21}\\right)(\\sigma_\\varepsilon^2+\\sigma_p^2+3\\sigma_f^2) \\end{aligned}\\] 上述表达式中方差分量的函数可以通过下式来估计 \\[(1/3)MSError(Family)+(2/3)MSError(Time)=(1/3)(54.155)+(2/3)(0.370)=18.2983\\] 因此，标准误估计为 \\[\\widehat{s.e.}(\\bar{y}_{1\\cdot k\\cdot}-\\bar{y}_{2\\cdot k\\cdot})=\\sqrt{\\left(\\frac1{30}+\\frac1{21}\\right)(18.2983)}=1.217\\] 与该估计相对应的 Satterthwaite 自由度估计是 \\[\\frac{\\left[(\\frac13)(54.155)+(\\frac23)(0.370)\\right]^2}{\\frac{(\\frac13)^2(54.155)^2}{15}+\\frac{(\\frac23)^2(0.370)^2}{90}}=\\frac{(18.2983)^2}{21.7242+0.0007}=\\frac{334.8278}{21.7249}=15.41\\] 因此，在给定时间点比较城市和农村的近似 5% LSD 值为 \\(LSD_{0.05}=2.131(1.217)=2.59\\)。表 26.20 总结了多重比较。可以使用示例 26.1 中描述的方法来研究每个地区中的时间的线性和二次趋势。 表 26.20: 示例 26.3 每个时间点下地区均值的比较 x 注释: 在一行中具有相同字母的均值没有显著差异。\\(\\text{LSD}_{0.05}=2.59\\) 26.3 使用 SAS-Mixed 程序的数据分析 本节说明对上一节中描述的三个示例中的每一个进行 SAS®-Mixed 分析。考虑表 26.4 中的数据。为了重现第 26.2 节所示的结果，可以使用表 26.21 中所示的 SAS 命令。 表 26.21: 用于分析表 26.4 中数据的 SAS-Mixed 代码 x 26.3.1 示例 26.1 应注意的一部分输出是提供两个方差分量 \\(\\sigma^2_\\varepsilon,\\sigma^2_\\delta\\) 的估计的部分。表 26.22 给出了估计值。可以看出，\\(\\hat\\sigma^2_\\varepsilon=7.45,\\hat\\sigma^2_\\delta=25.97\\). 表 26.22: 表 26.4 中数据的协方差参数估计 x 表 26.23 中给出了与表 26.5 中 ANOVA 相对应的检验。请注意，MIXED 程序没有提供误差平方和，但它确实给出了与表 26.5 中给出的相同的 \\(F\\) 统计量。 表 26.23: 表 26.4 中数据药物、时间和药物 × 时间的统计检验 x 药物主效应均值、时间主效应均值和药物时间双向均值如表 26.24 所示，这些均值的子集之间的成对比较如表 26.25 - 26.27 所示。表 26.28 中给出了可在 MIXED 程序中用于计算每种药物的线性和二次对比的 estimate 选项。这些选项的结果如表 26.29 所示。 表 26.24: 表 26.4 中数据药物、时间和药物 × 时间的均值 x 表 26.25: 表 26.4 中数据药物主效应均值和时间主效应均值之间的成对比较 x 表 26.26: 表 26.4 中数据在每种药物内时间均值的比较 x 表 26.27: 表 26.4 中数据在每个时间下药物均值的比较 x 表 26.28: 用于计算表 26.4 中数据中每种药物内时间的线性和二次对比的 Estimate 选项 x 表 26.29: 表 26.4 中数据中每种药物内时间的线性和二次对比 x 26.3.2 示例 26.2 本节提供复杂舒适度实验的 Mixed 分析。使用表 26.30 中所示的 SAS 命令对示例 26.2 中的数据进行分析。表 26.31 给出了与室、人和时间相对应的三个方差分量的估计。固定效应的 III 型检验如表 26.32 所示。表 26.33 给出了每种环境下时间的线性和二次对比。该表还包含时间 1 下的环境 1 与时间 2 下的环境 2 的比较，以说明如果有人对此类比较感兴趣，应该如何进行比较。表 26.34 给出了 Sex × Clothing 均值以及 Environment × Time 均值。表 26.35 - 26.37 提供了这些均值的不同子集之间的成对比较。 表 26.30: 用于分析复杂舒适度实验的 SAS 命令 x 表 26.31: 舒适度研究的室、人和时间方差分量估计 x 表 26.32: 复杂舒适度实验固定效应的 III 型检验 x 表 26.33: 舒适度研究中每种环境下时间的线性和二次对比 x 表 26.34: 舒适度研究中 Sex × Clothing 均值和 Environment × Time 均值 x 表 26.35: 舒适度研究中 Sex × Clothing 均值的成对比较 x 表 26.36: 舒适度研究中每种环境内时间的成对比较 x 表 26.37: 舒适度研究中每种环境内时间的成对比较 x 26.3.3 示例 26.3 本节提供家庭成员实验的 Mixed 分析。使用表 26.38 中所示的 SAS 命令对示例 26.3 中的数据进行分析。表 26.39 给出了与地区、家庭成员和时间相对应的三个方差分量的估计。固定效应的 III 型检验如表 26.40 所示。表 26.41 给出了 Area × Time 均值。表 26.42 提供了这些均值的不同子集之间的成对比较。 表 26.38: 用于分析家庭态度实验的 SAS 命令 x 表 26.39: 家庭态度实验的协方差参数估计 x 表 26.40: 家庭态度实验固定效应的 III 型检验 x 表 26.41: 家庭态度实验地区 × 时间双向均值检验 x 表 26.42: 家庭态度实验地区 × 时间双向均值的成对比较 x 26.4 结束语 本章针对涉及重复测量的三个示例（在这些示例中，时间的裂区假设成立），描述了重复测量设计的分析。讨论中包括了每个示例的模型和假设。给出了计算多重比较标准误的公式以及研究均值间各种对比的方法。在第 26.3 节中，使用 SAS-Mixed 程序进行了分析，可以与第 26.2 节中给出的结果进行比较。 26.5 练习 本书将 “subject” 译作个体，原因见介绍页的术语规范。↩︎ 原文：The smaller unit is the interval of time during which the subject is exposed to a treatment or an interval just between time measurements.↩︎ 原文：family member designation cannot be randomly assigned to family members. 译者注：这句话的意思是家庭成员的身份不可交换。如父母和孩子虽然都是三个 “人” ，但 “人” 的属性不同，例如是先有的爸爸再有的儿子，而不能反过来。↩︎ "],["chap27.html", "第 27 章 不满足理想条件时重复测量实验的分析 27.1 介绍 27.2 MANOVA 法 27.3 \\(p\\) 值调整法 27.4 混合模型法 27.5 总结 27.6 练习", " 第 27 章 不满足理想条件时重复测量实验的分析 重复测量设计涉及一个或多个步骤，其中研究人员不能将一个或更多因素的水平随机分配给实验单元。使用时间作为因素是无法使用随机化的最常见实验情况。例如，当在同一实验单元的多个时间点收集数据时，无法随机化时间点的顺序。时间 1 必须是第一个，时间 2 必须是第二个，依此类推。重复测量因子的这种非随机分配会影响实验单元之间的方差和协方差，第 26 章中描述的理想条件可能无效。本章介绍了当第 26 章中给出的理想条件不成立时，分析重复测量实验数据的策略。此外，还描述了允许检查第 26 章中描述的理想条件是否满足的程序。 27.1 介绍 考虑类似于表 26.1 中描述的实验情况。设 \\(y_{ijk}\\) 代表处理组 i 中个体50 k 在时间 j 观测到的响应，并设 \\[\\boldsymbol{y}_{ik}=\\begin{bmatrix}{y}_{i1k}\\\\{y}_{i2k}\\\\\\vdots\\\\{y}_{ipk}\\end{bmatrix}\\] 表示处理组 i 中个体 k 的响应向量。 可以用来描述这些数据的模型是 \\[y_{ijk}=\\mu+\\alpha_i+\\tau_j+\\gamma_{ij}+\\varepsilon_{ijk}^*,i=1,2,\\ldots,t;~j=1,2,\\ldots,p;~k=1,2,\\ldots,n_i\\] 令 \\[\\boldsymbol{\\varepsilon}_{ik}^*=\\begin{bmatrix}{\\varepsilon}_{i1k}^*\\\\{\\varepsilon}_{i2k}^*\\\\\\vdots\\\\{\\varepsilon}_{ipk}^*\\end{bmatrix}\\] 表示处理组 i 中个体 k 的误差向量。假设 \\(\\boldsymbol{\\varepsilon}_{ik}^*\\) 独立同分布于均值为 \\(\\boldsymbol 0\\) 和协方差矩阵为 \\(\\boldsymbol \\Sigma\\) 的 p 元正态分布。即 \\(\\boldsymbol \\varepsilon_{ik}^*\\sim i.i.d.N(\\boldsymbol{0},\\boldsymbol{\\Sigma}),i=1,2,\\ldots,t;k=1,2,\\ldots,n_i\\) 令 \\[\\boldsymbol{\\Sigma}=\\begin{bmatrix}{\\sigma}_{11}&amp;{\\sigma}_{12}&amp;\\cdots&amp;{\\sigma}_{1p}\\\\{\\sigma}_{21}&amp;{\\sigma}_{22}&amp;\\cdots&amp;{\\sigma}_{2p}\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\{\\sigma}_{p1}&amp;{\\sigma}_{p2}&amp;\\cdots&amp;{\\sigma}_{pp}\\end{bmatrix}\\] 表示重复测量向量的协方差阵。 定义 27.1 ♦ 若 \\(\\boldsymbol{\\Sigma}={\\lambda}\\boldsymbol{I}_t+\\boldsymbol{\\eta}\\boldsymbol{j}&#39;+\\boldsymbol{j}\\boldsymbol{\\eta}&#39;\\)，其中 \\(\\boldsymbol j\\) 是全 1 的 p × 1 向量，\\(\\boldsymbol \\eta\\) 是由常数组成的 p × 1 向量，则重复测量被认为满足 Huynh–Feldt (H–F) 条件（参见 Huynh and Feldt, 1970）。 当定义 27.1 成立时，\\(\\boldsymbol{\\Sigma}\\) 具有如下形式 \\[\\boldsymbol{\\Sigma}=\\begin{bmatrix}\\lambda+2{\\eta}_1&amp;{\\eta}_1+{\\eta}_2&amp;\\cdots&amp;{\\eta}_1+{\\eta}_p\\\\{\\eta}_2+{\\eta}_1&amp;\\lambda+2{\\eta}_2&amp;\\cdots&amp;{\\eta}_2+{\\eta}_p\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\{\\eta}_p+{\\eta}_1&amp;{\\eta}_p+{\\eta}_2&amp;\\cdots&amp;\\lambda+2{\\eta}_p\\end{bmatrix}\\] H-F 条件的一个特例是当重复测量具有复合对称协方差结构 (compound symmetry covariance structure, CS)，则对于 \\(\\sigma^2,\\rho\\) 的某种取值， \\[\\boldsymbol{\\Sigma}={\\sigma}^2{\\begin{bmatrix}1&amp;{\\rho}&amp;\\cdots&amp;{\\rho}\\\\{\\rho}&amp;1&amp;\\cdots&amp;{\\rho}\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\{\\rho}&amp;{\\rho}&amp;\\cdots&amp;1\\end{bmatrix}}\\] 请注意，第 26.1 节中讨论的时间的裂区分析 (split-plot-in-time analysis) 描述的理想条件是具有复合对称性的重复测量的协方差阵的特例，其中 \\(\\sigma^2=\\sigma_\\delta^2+\\sigma_\\varepsilon^2\\) 以及 \\(\\rho=\\sigma_\\delta^2/(\\sigma_\\delta^2+\\sigma_\\varepsilon^2)\\). 复合对称结构比时间的裂区结构更通用，因为复合对称结构中的 \\(\\rho\\) 可以为负。 如果满足 H-F 条件，那么许多涉及时间比较的重要问题可以通过分析重复测量实验来回答，就像分析满足第 26.1 节给出的理想条件的重复测量实验一样，并且如果重复测量满足复合对称性，则可以使用第 26 章中给出的时间的裂区分析方法。特别是，当且仅当重复测量满足定义 27.1 中给出的 H-F 条件时，时间主效应和时间 × 处理交互效应的时间的裂区检验才可以在统计上证明有效。此外，使用时间的裂区分析时，比较时间主效应的对比以及比较处理变量特定值内时间效应的对比都具有统计有效性。如果关注双向均值或边际均值，时间的裂区分析可以提供均值的正确估计，但标准误的估计是不正确的。 如果重复测量具有复合对称性且 \\(\\rho&gt;0\\)，则时间的裂区分析给出的所有结果都是正确的。在这种情况下，可以说 \\(\\varepsilon_{ik}^*=\\delta_{ik}+\\varepsilon_{ijk}\\)，其中 \\(\\delta_{ik}\\sim i.i.d.N(0,\\sigma_\\delta^2),\\varepsilon_{ijk}\\sim i.i.d.N(0,\\sigma_\\varepsilon^2)\\)，以及 \\(\\delta_{ik}\\) 和 \\(\\varepsilon_{ijk}\\) 是独立的。 提问：如果 H-F 条件不满足呢？ 在不满足 H–F 条件的情况下，可以考虑几种分析方法。一种总是合适的方法是将重复测量的向量视为多元响应向量，并使用多元方差分析 (multivariate analysis of variance, MANOVA) 方法。第二种是使用时间的裂区分析，但通过调整与相关效应均方相对应的自由度来调整 \\(p\\) 值51。第三种方法是使用 SAS®-Mixed 和 SAS®-Gilimix 程序中可用的混合模型方法，并对协方差结构进行建模。 多元方差分析方法在第 27.2 节中描述，调整自由度方法在第 27.3 节中讨论，混合模型方法将在第 27.4 节中讨论。 27.2 MANOVA 法 本节考虑使用多元方差分析法来分析重复测量实验。这些方法总是适用于以下情况 \\[\\boldsymbol\\varepsilon_{ik}^*\\sim i.i.d.\\mathrm{~}N(\\boldsymbol0,\\boldsymbol{\\Sigma}),\\quad i=1,2,\\ldots,t;\\mathrm{~}k=1,2,\\ldots,n_i\\] MANOVA 方法只能应用于给定实验单元上的所有重复测量都存在或全部缺失的实验，因为所使用的统计软件将自动从分析中删除一个或多个重复测量值缺失的任何实验单元。然而，对于其他两种方法，这并不存在问题。（对于它们，）分配给每个处理的实验单元数量无需均衡。要充分利用这一章节的内容，读者应需理解第 @chap(6) 章讨论的模型的矩阵形式。 具有类似于表 26.1 中给出的结构的重复测量实验的一般多元模型是式 (26.1) 中定义的模型的矩阵形式的推广。多元模型可以表示为 \\[\\begin{equation} \\boldsymbol Y=\\boldsymbol {XB}+\\boldsymbol E \\tag{27.1} \\end{equation}\\] 其中 \\(\\boldsymbol Y\\) 表示在实验中测量的所有数据。数据矩阵 \\(\\boldsymbol Y\\) 的每一行对应于特定的实验单元，每一列对应于一个重复测量中。因此 \\(\\boldsymbol Y\\) 是 N × p 矩阵，其中 \\(N=\\sum_{i=1}^t n_i\\). 矩阵 \\(\\boldsymbol X\\) 是假设秩为 t 的 N × r 设计矩阵。\\(\\boldsymbol B\\) 的每一列都是未知参数的 r × 1 向量，每一列对应于特定的重复测量。矩阵 \\(\\boldsymbol E\\) 是不可观测随机误差的 N × p 矩阵。假设 \\(\\boldsymbol E\\) 的行独立分布于 \\(N(\\boldsymbol{0},\\boldsymbol{\\Sigma})\\). 因此，当 \\(\\boldsymbol E\\) 中的行是独立的时，一行中的元素可以彼此相关 (correlated) 且可以具有不同的方差。 对于多元模型 (27.1)，可以检验以下形式的一般假设 \\[\\begin{equation} H_0{:\\boldsymbol{CBM}}=0\\mathrm{~vs~}H_a{:\\boldsymbol{CBM}}\\neq0 \\tag{27.2} \\end{equation}\\] 其中 \\(\\boldsymbol C\\) 是秩为 g 的 g × r 矩阵，\\(\\boldsymbol M\\) 是秩为 q 的 p × q 矩阵。 为了检验式 (27.2) 中的假设，首先需要求得矩阵 \\(\\boldsymbol B\\) 中参数的最小二乘估计以及观测到的残差平方和与叉乘矩阵 (cross-products matrix)52。分别记作 \\(\\hat{\\boldsymbol B}\\) 和 \\(\\hat{\\boldsymbol E}\\) ，并由以下式给出： \\[\\begin{equation} \\hat{\\boldsymbol B}=(\\boldsymbol X^{\\prime}\\boldsymbol X)^-\\boldsymbol X^{\\prime}\\boldsymbol Y\\quad\\mathrm{and}\\quad\\hat{\\boldsymbol E}=\\boldsymbol Y^{\\prime}[\\boldsymbol I-\\boldsymbol X(\\boldsymbol X^{\\prime}\\boldsymbol X)^-\\boldsymbol X^{\\prime}]\\boldsymbol Y \\tag{27.3} \\end{equation}\\] 用于检验等式 (27.2) 中的假设，似然比检验统计量 (likelihood ratio test statistic) 由下式给出 \\[\\begin{equation} \\Lambda=\\frac{|\\boldsymbol R|}{\\left|\\boldsymbol H+\\boldsymbol R\\right|} \\tag{27.4} \\end{equation}\\] 其中 \\[\\boldsymbol R=\\boldsymbol M&#39;\\hat{\\boldsymbol E}\\boldsymbol M,\\quad \\boldsymbol H=\\boldsymbol M^{\\prime}\\hat{\\boldsymbol B}\\boldsymbol C^{\\prime}\\left[\\boldsymbol C(\\boldsymbol X^{\\prime}\\boldsymbol X)^{-}\\boldsymbol C^{\\prime}\\right]^{-1}\\boldsymbol C \\hat{\\boldsymbol B} \\boldsymbol M\\] 以及 \\(|\\boldsymbol W|\\) 表示矩阵 \\(\\boldsymbol W\\) 的行列式。 这种统计量被称为 Wilks’ 似然比准则 (likelihood ratio criterion) (Morrison, 1976). \\(\\Lambda\\) 的抽样分布相当复杂，但对于大多数实际目的，可以获得一个近似 \\(\\alpha\\) 水平的检验，拒绝 \\(H_0\\) 当 \\[-\\left(N-t-\\frac{|q-g|+1}2\\right)\\mathrm{log}_{\\mathrm{e}}(\\Lambda)&gt;\\chi_{\\alpha,qg}^2\\] 只有当 \\(q\\) 和 \\(g\\) 都大于 \\(2\\) 才可使用的一个更好的近似是，拒绝 \\(H_0\\) 当 \\[F&gt;F_{\\alpha,qg,ab-c}\\] 其中 \\[F=\\frac{(1-\\Lambda^{1/b})(ab-c)}{qg\\Lambda^{1/b}}\\] 以及 \\[\\begin{align} &amp;a=N-t-\\frac{|q-s|+1}2 \\\\ &amp;b=\\left(\\frac{q^{2}s^{2}-4}{q^{2}+s^{2}-5}\\right)^{1/2} \\\\ &amp; c=\\frac{qs-2}2 \\\\ &amp;s=\\min(q,g) \\tag{27.5} \\end{align}\\] 而只要 \\(q = 1, 2\\) 或 \\(g = 1, 2\\)，式 (27.2) 就存在精确的 \\(F\\) 检验。这些检验如下 对于 \\(g = 1\\) 以及任何 \\(q\\)，拒绝 \\(H_0\\) 如果 \\[\\begin{equation} F=\\left(\\frac{1-\\Lambda}\\Lambda\\right)\\left(\\frac{N-t-q+1}q\\right)&gt;F_{\\alpha,q,N-t-q+1} \\tag{27.6} \\end{equation}\\] 对于 \\(q = 1\\) 以及任何 \\(g\\)，拒绝 \\(H_0\\) 如果 \\[\\begin{equation} F=\\left(\\frac{1-\\Lambda}\\Lambda\\right)\\left(\\frac{N-t}g\\right)&gt;F_{\\alpha,g,N-t} \\tag{27.7} \\end{equation}\\] 对于 \\(g = 2\\) 以及任何 \\(q &gt; 1\\)，拒绝 \\(H_0\\) 如果 \\[\\begin{equation} F=\\left(\\frac{1-\\sqrt{\\Lambda}}{\\sqrt{\\Lambda}}\\right){\\left(\\frac{N-t-q+1}q\\right)}{&gt;F_{\\alpha,2q,2(N-t-q+1)}} \\tag{27.8} \\end{equation}\\] 对于 \\(q = 2\\) 以及任何 \\(g &gt; 1\\)，拒绝 \\(H_0\\) 如果 \\[\\begin{equation} F=\\left(\\frac{1-\\sqrt{\\Lambda}}{\\sqrt{\\Lambda}}\\right)\\left(\\frac{N-t-1}g\\right)&gt;F_{\\alpha,2g,2(N-t-1)} \\tag{27.9} \\end{equation}\\] 多元方法的一个缺点是必须满足 \\(p &lt; N – t\\). 当 \\(p \\ge N – t\\) 时，通常可以将相邻的重复测量组合成 \\(p^*\\) 个新变量，或者仅分析重复测量尺寸为 \\(p^*\\) 的子集，其中 \\(p^* &lt; N – t\\). 为了说明本节中描述的分析，考虑进行一项实验，研究四种高粱 (sorghum) 品种和五种肥料 (fertilizer) 水平在叶面积指数53 (leaf area index) 上的差异，其中四种高粱品种用 V1, V2, V3 和 V4 表示，五个肥料水平用 1, 2, 3, 4 和 5 表示。还假设这 20 个品种 × 肥料的组合被随机分配到田间 20 个区 (plots). 对于此示例，假设肥料水平和品种之间不存在交互作用，并且可以使用基本的双向加性模型54来分析数据。最后，假设从植物出苗后两周开始，在五周内的每周对每个品种 × 肥料的区中进行叶面积指数的测量。获得的数据列于表 27.1 中。 表 27.1: 四个高粱品种的叶面积指数 x 对于表 27.1 中的数据，数据矩阵为 \\[\\boldsymbol Y=\\begin{bmatrix}5.00&amp;4.84&amp;4.02&amp;3.75&amp;3.13\\\\4.42&amp;4.30&amp;3.67&amp;3.29&amp;2.83\\\\4.42&amp;4.10&amp;3.46&amp;3.09&amp;2.82\\\\4.01&amp;3.89&amp;3.21&amp;2.89&amp;2.56\\\\3.36&amp;3.10&amp;2.67&amp;2.47&amp;2.16\\\\5.82&amp;5.60&amp;5.05&amp;4.72&amp;4.46\\\\5.73&amp;5.59&amp;5.00&amp;4.65&amp;4.42\\\\5.31&amp;5.19&amp;4.86&amp;4.44&amp;4.22\\\\4.92&amp;4.66&amp;4.56&amp;4.16&amp;3.99\\\\3.96&amp;3.86&amp;3.50&amp;3.13&amp;2.95\\\\5.65&amp;5.97&amp;5.27&amp;5.07&amp;4.52\\\\5.39&amp;5.49&amp;5.08&amp;4.87&amp;4.32\\\\5.15&amp;5.28&amp;4.93&amp;4.67&amp;4.15\\\\4.50&amp;4.89&amp;4.74&amp;4.49&amp;4.10\\\\3.75&amp;3.74&amp;3.55&amp;3.28&amp;3.00\\\\5.86&amp;5.60&amp;5.37&amp;5.00&amp;4.37\\\\5.82&amp;5.55&amp;5.29&amp;4.95&amp;4.07\\\\5.26&amp;5.06&amp;4.76&amp;4.48&amp;3.94\\\\4.87&amp;4.75&amp;4.55&amp;4.33&amp;3.83\\\\3.96&amp;3.76&amp;3.56&amp;3.18&amp;2.96\\end{bmatrix}\\] 参数矩阵为 \\[\\boldsymbol{B}=\\begin{bmatrix} \\mu^{(1)}&amp;\\mu^{(2)}&amp;\\mu^{(3)}&amp;\\mu^{(4)}&amp;\\mu^{(5)}\\\\ \\tau_1^{(1)}&amp;\\tau_1^{(2)}&amp;\\tau_1^{(3)}&amp;\\tau_1^{(4)}&amp;\\tau_1^{(5)}\\\\ \\tau_2^{(1)}&amp;\\tau_2^{(2)}&amp;\\tau_2^{(3)}&amp;\\tau_2^{(4)}&amp;\\tau_2^{(5)}\\\\ \\tau_3^{(1)}&amp;\\tau_3^{(2)}&amp;\\tau_3^{(3)}&amp;\\tau_3^{(4)}&amp;\\tau_3^{(5)}\\\\ \\tau_4^{(1)}&amp;\\tau_4^{(2)}&amp;\\tau_4^{(3)}&amp;\\tau_4^{(4)}&amp;\\tau_4^{(5)}\\\\ \\beta_1^{(1)}&amp;\\beta_1^{(2)}&amp;\\beta_1^{(3)}&amp;\\beta_1^{(4)}&amp;\\beta_1^{(5)}\\\\ \\beta_2^{(1)}&amp;\\beta_2^{(2)}&amp;\\beta_2^{(3)}&amp;\\beta_2^{(4)}&amp;\\beta_2^{(5)}\\\\ \\beta_3^{(1)}&amp;\\beta_3^{(2)}&amp;\\beta_3^{(3)}&amp;\\beta_3^{(4)}&amp;\\beta_3^{(5)}\\\\ \\beta_4^{(1)}&amp;\\beta_4^{(2)}&amp;\\beta_4^{(3)}&amp;\\beta_4^{(4)}&amp;\\beta_4^{(5)}\\\\ \\beta_5^{(1)}&amp;\\beta_5^{(2)}&amp;\\beta_5^{(3)}&amp;\\beta_5^{(4)}&amp;\\beta_5^{(5)}\\\\ \\end{bmatrix}\\] 其中 \\(\\tau\\) 对应不同品种，\\(\\beta\\) 对应不同肥料水平，设计矩阵为 \\[\\boldsymbol X=\\begin{bmatrix} 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\\\ 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\end{bmatrix} \\] 注意，\\(\\boldsymbol B\\) 的每一列代表数据矩阵 \\(\\boldsymbol Y\\) 的第 \\(j(j=1,2,3,4,5)\\) 个响应列的双向加性模型所需的参数，设计矩阵 \\(\\boldsymbol X\\) 是一个 20 × 10 矩阵且秩等于 8；因此 \\(N = 20,p = 10\\) 且 \\(t = 8\\)。式 (27.3) 给出的 \\(\\hat{\\boldsymbol B}\\) 的值为 \\[\\hat{\\boldsymbol{B}}=\\begin{bmatrix}3.350&amp;3.283&amp;3.003&amp;2.788&amp;2.150\\\\0.222&amp;0.106&amp;-0.198&amp;-0.260&amp;-0.312\\\\1.128&amp;1.040&amp;0.990&amp;0.874&amp;0.996\\\\0.868&amp;1.134&amp;1.110&amp;1.130&amp;1.006\\\\1.134&amp;1.004&amp;1.102&amp;1.042&amp;0.822\\\\1.395&amp;1.398&amp;1.173&amp;1.115&amp;0.982\\\\1.152&amp;1.128&amp;1.006&amp;0.940&amp;0.772\\\\0.847&amp;0.803&amp;0.748&amp;0.685&amp;0.645\\\\0.387&amp;0.443&amp;0.511&amp;0.483&amp;0.482\\\\-0.430&amp;-0.489&amp;-0.434&amp;-0.470&amp;-0.370\\end{bmatrix}\\] 以及式 (27.3) 中的 \\(\\boldsymbol E\\) 的值为 \\[\\hat{\\boldsymbol{E}}=\\begin{bmatrix}0.237&amp;0.171&amp;0.162&amp;0.228&amp;0.129\\\\0.171&amp;0.247&amp;0.163&amp;0.231&amp;0.135\\\\0.162&amp;0.163&amp;0.268&amp;0.303&amp;0.184\\\\0.228&amp;0.231&amp;0.303&amp;0.392&amp;0.241\\\\0.129&amp;0.135&amp;0.184&amp;0.241&amp;0.247\\end{bmatrix}\\] 等品种主效应均值检验由式 (27.4) 得出，通过取 \\[\\boldsymbol{C}=\\begin{bmatrix}0&amp;1&amp;-1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;1&amp;0&amp;-1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;1&amp;0&amp;0&amp;-1&amp;0&amp;0&amp;0&amp;0&amp;0\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{M}=\\begin{bmatrix}1\\\\1\\\\1\\\\1\\\\1\\\\1\\end{bmatrix}\\] 那么 \\(\\Lambda= 0.04345,g = 3,q = 1\\). 由于 \\(q = 1\\)，可以使用式 (27.7)，得到 \\[F=\\frac{1-0.04345}{0.04345}\\times\\frac{12}3=88.06\\] 具有 3 个和 12 个自由度。观察到的显著性水平 \\(\\hat\\alpha\\) 小于 0.0001. 等时间主效应均值的检验由式 (27.4) 得出，通过取 \\[\\boldsymbol{C}=\\begin{bmatrix}1&amp;\\frac14&amp;\\frac14&amp;\\frac14&amp;\\frac14&amp;\\frac15&amp;\\frac15&amp;\\frac15&amp;\\frac15&amp;\\frac15\\\\\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{M}=\\begin{bmatrix}1&amp;1&amp;1&amp;1\\\\-1&amp;0&amp;0&amp;0\\\\0&amp;-1&amp;0&amp;0\\\\0&amp;0&amp;-1&amp;0\\\\0&amp;0&amp;0&amp;-1\\end{bmatrix}\\] 可得到 \\(\\Lambda= 0.04345,g=1,q=4\\). 由于 \\(g = 1\\)，因此可以使用式 (27.6)，并得到 \\[\\begin{aligned}F=&amp;\\frac{1-0.00502}{0.00502}\\times\\frac94=445.96\\end{aligned}\\] 具有 4 个和 9 个自由度。观察到的显著性水平 \\(\\hat\\alpha\\) 小于 0.0001. 品种 × 时间交互作用的检验由式 (27.4) 得出，通过取 \\[\\boldsymbol{C}=\\begin{bmatrix}0&amp;1&amp;-1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;1&amp;0&amp;-1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;1&amp;0&amp;0&amp;-1&amp;0&amp;0&amp;0&amp;0&amp;0\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{M}=\\begin{bmatrix}1&amp;1&amp;1&amp;1\\\\-1&amp;0&amp;0&amp;0\\\\0&amp;-1&amp;0&amp;0\\\\0&amp;0&amp;-1&amp;0\\\\0&amp;0&amp;0&amp;-1\\end{bmatrix}\\] 可得到 \\(\\Lambda= 0.01426,g=1,q=4\\). 由于 g 和 q 都大于 1，可以使用式 (27.5)，其中 \\(s = 3,a = 11,b = 2.646\\) 以及 \\(c = 5\\). 那么 \\[F=\\frac{(1-0.01426^{1/2.646})(11\\times2.646-5)}{4\\times3\\times0.01426^{1/2.646}}=\\frac{(1-0.2006)(24.1060)}{12(0.2006)}=8.00\\] 具有 12 个和 24.1 个自由度。观察到的显著性水平 \\(\\hat\\alpha\\) 小于 0.0001. 请注意，等品种均值的检验与通过时间的裂区分析获得的检验相同。这是三个检验中唯一与通过时间的裂区分析获得的相应检验相同的检验。以类似的方式可以得到肥料主效应（\\(F=94.36\\)）和肥料 × 时间交互效应（\\(F=1.91\\)）的检验统计量。 \\(\\boldsymbol{B}\\) 中参数的许多特殊函数是可估的，并且可以对这些可估函数进行推断。\\(\\boldsymbol{B}\\) 中参数的大多数有趣的线性函数都可以写成 \\(\\boldsymbol{c&#39;Bm}\\) 的形式，其中 \\(\\boldsymbol{c}\\) 是 r × 1 向量，\\(\\boldsymbol{m}\\) 是 p × 1 向量。正如第 6 章中那样，当且仅当存在一个向量 \\(\\boldsymbol{u}\\) 使得 \\(\\boldsymbol{X^{\\prime}}\\boldsymbol{X}\\boldsymbol{u}=\\boldsymbol{c}\\) 时，\\(\\boldsymbol{c&#39;Bm}\\) 才是可估的。对于 \\(\\boldsymbol m\\) 没有限制。 \\(\\boldsymbol{c&#39;Bm}\\) 的最佳估计是 \\(\\boldsymbol{c&#39;\\hat Bm}\\)，其中 \\(\\boldsymbol{\\hat B}\\) 由式 (27.3) 中给出。 \\(\\boldsymbol{c&#39;\\hat Bm}\\) 的标准误估计由下式给出 \\[\\widehat{s.e.}(\\boldsymbol c^{\\prime}\\hat{\\boldsymbol B}\\boldsymbol m)=\\sqrt{\\boldsymbol c^{\\prime}(\\boldsymbol X^{\\prime}\\boldsymbol X)^-\\boldsymbol c\\cdot\\frac{{\\boldsymbol m^{\\prime}\\hat{\\boldsymbol E}\\boldsymbol m}}{N-t}}\\] 相应的自由度为 N-t. 因此，\\(\\boldsymbol{c&#39;Bm}\\) 的 \\((1 - \\alpha)100\\%\\) 置信区间由下式给出 \\[\\begin{equation} \\boldsymbol{c^{\\prime}\\hat{B}m}\\pm t_{\\alpha,N-t}\\left[\\widehat{s.e.}(\\boldsymbol{c^{\\prime}\\hat{B}m})\\right] \\tag{27.10} \\end{equation}\\] 用于检验 \\(H_0:\\boldsymbol{c&#39;Bm}=a_0\\) 的 \\(t\\) 统计量由下式给出 \\[\\begin{equation} t=\\frac{\\boldsymbol{c&#39;\\hat Bm}-a_0}{\\widehat{s.e.}(\\boldsymbol{c&#39;\\hat Bm})} \\tag{27.11} \\end{equation}\\] 如果 \\(t&gt;t_{\\alpha/2,N-t}\\) 则拒绝 \\(H_0\\). 例如，考虑估计 V1 的边际均值。对于此边际均值， \\[\\boldsymbol c&#39;=\\begin{bmatrix}1&amp;1&amp;0&amp;0&amp;0&amp;0.2&amp;0.2&amp;0.2&amp;0.2&amp;0.2\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{m}=\\begin{bmatrix}0.2\\\\0.2\\\\0.2\\\\0.2\\\\0.2\\end{bmatrix}\\] \\(\\boldsymbol{c&#39;\\hat Bm}\\) 的值为 3.496，其标准误估计为 0.0594. 利用式 (27.10) 可以得到 V1 边际均值的 95% 置信区间为 3.496 ± (2.179) (0.0594). 作为第二个例子，考虑估计表 27.1 中数据的时间 1 的 边际均值。对于此边际均值， \\[\\boldsymbol c^{\\prime}=[1\\quad0.25\\quad0.25\\quad0.25\\quad0.2\\quad0.2\\quad0.2\\quad0.2\\quad0.2]\\quad\\mathrm{and}\\quad\\boldsymbol{m}=\\begin{bmatrix}1\\\\0\\\\0\\\\0\\\\0\\end{bmatrix}\\] \\(\\boldsymbol{c&#39;\\hat Bm}\\) 的值为 4.858，其标准误估计为 0.0315. 作为第三个示例，考虑估计 V1 和 V2 边际均值之差。此时 \\[\\boldsymbol c^{\\prime}=\\begin{bmatrix}0&amp;1&amp;-1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{m}=\\begin{bmatrix}0.2\\\\0.2\\\\0.2\\\\0.2\\\\0.2\\end{bmatrix}\\] \\(\\boldsymbol{c&#39;\\hat Bm}\\) 的值为 -1.094，其标准误估计为 0.0840. 用于比较这两个边际平均值的 \\(t\\) 统计量为 \\(t = -1.094/0.0840 = 13.02\\)，其观察到的显著性水平为 \\(\\hat\\alpha &lt; 0.0001\\). 当使用 MANOVA 选项及其 M = 选项时，可以从 SAS®-GLM 程序获得上面给出的许多推断结果。为了说明这一点，使用表 27.2 中给出的 SAS 命令重新分析表 27.1 中的数据。第一个 MANOVA 选项用于获取 E^，第二个 MANOVA 选项用于获取比较品种主效应均值和肥料主效应均值的检验【注意，M = (0.2 0.2 0.2 0.2 0.2) 告诉 MANOVA 选项计算五次重复的时间测量平均值】。肥料 × 时间交互作用和品种 × 时间交互作用的检验是从第三个 MANOVA 选项获得的，其中 \\(\\boldsymbol M\\) 是时间对比的 4 × 5 矩阵。 表 27.2: 使用 MANOVA 分析表 27.1 中的数据的 SAS-GLM 代码 x 表 27.3 给出了从表 27.2 的多元方差分析中获得的 \\(\\hat{\\boldsymbol E}\\) 值。表 27.4 给出了肥料和品种主效应的 MANOVA 检验，表 27.5 给出了 MANOVA 交互检验。 表 27.3: 误差平方和和叉乘矩阵 x 表 27.4: 肥料和品种主效应检验 x 表 27.5: MANOVA 交互检验 x MANOVA 和 CONTRAST 选项都可以用来检验形如 \\(H_0{:\\boldsymbol{c&#39;Bm}}=0\\) 的假设。例如，通过将以下三个语句添加到表 27.2 中的 SAS 命令中 CONTRAST ‘V1-V2’ VARIETY 1 -1 0 0; MANOVA M=(.2 .2 .2 .2 .2) / PRINTE; MANOVA M=(1 0 0 0 0) / PRINTE; 我们可以从第一个 MANOVA 语句中获得对品种 1 和 2 主效应均值比较的 Wilks 统计量，以及从第二个 MANOVA 语句中对时间 1 处的品种 1 和品种 2 进行比较的 Wilks 统计量。通过在上述每个 MANOVA 命令中包含 PRINTE 选项，还可以获得 \\(\\boldsymbol {m&#39;\\hat E m}\\) 的值。表 27.6 给出了比较品种 1 主效应均值与品种 2 主效应均值的检验统计量 (\\(F = 169.4\\))。请注意，169.4 是本节前面给出的 \\(t\\) 统计量的平方。另请注意，当 \\({\\boldsymbol m}&#39; = [0.2 0.2 0.2 0.2 0.2]\\) 时，\\(\\boldsymbol {m&#39;\\hat E m} = 0.2115\\). 表 27.6: 比较品种 1 和品种 2 主效应均值的检验 x 27.3 \\(p\\) 值调整法 回想一下，当重复测量满足复合对称性假设时，重复测量实验的分析可以通过第 26 章中描述的时间的裂区方法获得。如果只考虑涉及时间因素差异的检验，那么当重复测量满足 H-F 条件时，时间的裂区检验也有效。第二种分析重复测量实验的方法已被证明比第 27.2 节中描述的基于 MANOVA 方法的分析更强大。该方法是在不满足 H-F 条件的情况下执行时间的裂区分析，并调整检验统计量的分子和分母自由度，从而产生调整的 \\(p\\) 值。 设 \\[\\boldsymbol{\\Sigma}=\\begin{bmatrix}{\\sigma}_{11}&amp;{\\sigma}_{12}&amp;\\cdots&amp;{\\sigma}_{1p}\\\\{\\sigma}_{21}&amp;{\\sigma}_{22}&amp;\\cdots&amp;{\\sigma}_{2p}\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\{\\sigma}_{p1}&amp;{\\sigma}_{p2}&amp;\\cdots&amp;{\\sigma}_{pp}\\end{bmatrix}\\] 为重复测量的协方差阵。令 \\[\\begin{equation} \\theta=\\frac{p^2(\\bar{\\sigma}_{ii}-\\bar{\\sigma}_{\\cdot\\cdot})^2}{(p-1)\\left[\\sum_{i=1}^p\\sum_{j=1}^p\\sigma_{ij}^2-2p\\sum_{i=1}^p\\bar{\\sigma}_{i\\cdot}^2+p^2\\bar{\\sigma}_{\\cdot\\cdot}^2\\right]} \\tag{27.12} \\end{equation}\\] 其中 \\[\\bar{\\sigma}_{ii}=\\frac1p{\\sum_{j=1}^p\\sigma_{ij}},\\quad\\bar{\\sigma}_{i\\cdot}=\\frac1p{\\sum_{j=1}^p\\sigma_{ij}},\\quad\\mathrm{and}\\quad\\bar{\\sigma}_{\\cdot\\cdot}=\\frac1{p^2}{\\sum_{i=1}^p{\\sum_{j=1}^p\\sigma_{ij}}}\\] Box (1954) 提出用 \\(\\theta\\) 来衡量 \\(\\boldsymbol \\Sigma\\) 偏离复合对称性的程度，并证明了 \\(1/(p - 1) &lt; \\theta &lt; 1\\). \\(\\theta\\)的值越小，\\(\\boldsymbol \\Sigma\\) 偏离复合对称性就越远。假设 \\(F_{TIME}\\) 和 \\(F_{TIME × TRT}\\) 分别是时间主效应和时间 × 处理交互作用的时间的裂区检验统计量，适用于表 26.1 所描述的重复测量场景。Box 表明，当 \\(\\boldsymbol \\Sigma\\) 关于复合对称性偏离了 \\(\\theta\\) 时，则，当没有时间效应时 \\[\\begin{equation} F_{TIME}\\text{ is approximately distributed as }F[\\theta(p-1),\\theta(N-t)(p-1)] \\tag{27.13} \\end{equation}\\] 以及当无交互效应时 \\[\\begin{equation} F_{TIME\\times TRT}\\text{ is approximately distributed as F}[\\theta(t-1)(p-1),\\theta(N-t)(p-1)] \\tag{27.14} \\end{equation}\\] 不幸的是，由于 \\(\\sigma_{ij}\\) 未知，所以 \\(\\theta\\) 未知。如果可以估计 \\(\\sigma_{ij}\\)，则可以估计 \\(\\theta\\). 已有 \\(\\theta\\) 的三种估计。第一个被称为 Box 保守估计。Box (1954) 建议保守的方法是取 \\(\\theta\\) 为其可能值的最小值。即，取 \\(\\theta = 1/(p - 1)\\). 这可能太保守，不予推荐。 Greenhouse 和 Geisser (1959) 提出了第二种可能性。令 \\(\\hat{\\boldsymbol{Q}}=\\boldsymbol{C\\hat{\\boldsymbol{\\Sigma}}}\\boldsymbol{C&#39;}\\) 其中 \\(\\boldsymbol{C}\\) 是满足 \\(\\boldsymbol{Cj} = \\boldsymbol 0\\) 且 \\(\\boldsymbol{CC&#39;} = \\boldsymbol I_{p-1}\\) 的任何 \\((p - 1) × p\\) 矩阵，其中 \\(\\boldsymbol j\\) 是全 1 的 p × 1 向量，而 \\(\\boldsymbol I_{p-1}\\) 是 (p - 1) × ( p - 1) 的单位阵。然后 \\[\\hat{{\\theta}}~=~\\frac{\\left(\\sum_{i=1}^{p-1}\\hat{{q}}_{ii}\\right)^2}{(p-1)\\sum_{i=1}^{p-1}\\sum_{j=1}^{p-1}\\hat{{q}}_{ij}^2}=\\frac{\\left[\\operatorname{tr}(\\hat{\\boldsymbol{Q}})\\right]^2}{(p-1)\\operatorname{tr}(\\hat{\\boldsymbol{Q}}\\hat{\\boldsymbol{Q}}^{\\prime})}\\] 是 \\(\\theta\\) 的 Greenhouse and Geisser (G–G) 估计，其中 \\(\\text{tr}(\\boldsymbol B)\\) 是矩阵 \\(\\boldsymbol B\\) 的迹。 Huynh and Feldt (1976) 提出了第三种估计 \\(\\theta\\) 的方法。他们的方法将 \\(\\theta\\) 估计为 \\[\\tilde{{\\theta}}=\\frac{N(p-1)\\hat{{\\theta}}-2}{(p-1)(N-r-(p-1)\\hat{{\\theta}})}\\] 其中 N 为总样本量，N - r 为时间的裂区分析中误差项的自由度。 可以注意到，Box 的修正是三种调整方法中最保守的，而 H–F 修正是三个调整方法中最不保守的。还应注意的是，如果 \\(\\theta\\) 的任何估计值大于 1，则在计算调整的 \\(p\\) 值时，在式 (27.13) 和 (27.14) 中用 1 代替 \\(\\theta\\)，因为不希望增加任何效应的自由度。 可以注意到，如果 \\(\\boldsymbol{\\Sigma}\\) 满足 H-F 条件，则对于某 \\(\\lambda\\)，\\(\\boldsymbol{C\\Sigma C&#39;}=\\lambda \\boldsymbol{I}\\). 当这为真时，我们说 \\(\\boldsymbol{C\\Sigma C&#39;}\\) 满足球形条件。此时 \\(H_0{:\\boldsymbol{C\\Sigma C&#39;}}=\\lambda\\boldsymbol{I}\\) 的似然比检验是可用的。似然比检验统计量由下式给出： \\[\\begin{equation} \\boldsymbol{\\Lambda}=\\frac{|\\hat{\\boldsymbol{Q}}|}{\\left[\\frac1{p-1}\\mathrm{tr}(\\hat{\\boldsymbol{Q}})\\right]^{p-1}} \\tag{27.15} \\end{equation}\\] 若 \\(-2\\log_{\\mathrm{e}}(\\Lambda)&gt;\\chi_{\\alpha,p(p-1)/2-1}^2\\) 则拒绝 \\(H_0\\). 存在许多矩阵 \\(\\boldsymbol C\\) 满足 $ = $ 和 \\(\\boldsymbol{CC&#39;} = \\boldsymbol I_{p-1}\\). 应当注意，\\(\\Lambda\\) 的值不取决于可能选择哪个可行的 \\(\\boldsymbol C\\) 矩阵。 例如，考虑表 27.1 中的数据。对于这些数据 \\[\\hat{\\boldsymbol E}=\\begin{bmatrix}0.237&amp;0.171&amp;0.162&amp;0.228&amp;0.129\\\\0.171&amp;0.247&amp;0.163&amp;0.231&amp;0.135\\\\0.162&amp;0.163&amp;0.268&amp;0.303&amp;0.184\\\\0.228&amp;0.231&amp;0.303&amp;0.392&amp;0.241\\\\0.129&amp;0.135&amp;0.184&amp;0.241&amp;0.247\\end{bmatrix}\\] 基于 12 个自由度。 因此， \\[\\begin{aligned} \\boldsymbol{\\hat{\\Sigma}}=\\frac1{12}\\boldsymbol{\\hat{E}}&amp; =\\frac{1}{12}\\begin{bmatrix}0.237&amp;0.171&amp;0.162&amp;0.228&amp;0.129\\\\0.171&amp;0.247&amp;0.163&amp;0.231&amp;0.135\\\\0.162&amp;0.163&amp;0.268&amp;0.303&amp;0.184\\\\0.228&amp;0.231&amp;0.303&amp;0.392&amp;0.241\\\\0.129&amp;0.135&amp;0.184&amp;0.241&amp;0.247\\end{bmatrix} \\\\\\\\ &amp;=\\begin{bmatrix}0.0198&amp;0.0143&amp;0.0135&amp;0.0190&amp;0.0108\\\\0.0143&amp;0.0206&amp;0.0136&amp;0.0193&amp;0.0113\\\\0.0135&amp;0.0136&amp;0.0223&amp;0.0253&amp;0.0153\\\\0.0190&amp;0.0193&amp;0.0253&amp;0.0327&amp;0.0201\\\\0.0108&amp;0.0113&amp;0.0153&amp;0.0201&amp;0.0206\\end{bmatrix} \\end{aligned}\\] 取 \\[\\boldsymbol{C}=\\begin{bmatrix}\\frac1{\\sqrt{2}}&amp;-\\frac1{\\sqrt{2}}&amp;0&amp;0&amp;0\\\\\\frac1{\\sqrt{6}}&amp;\\frac1{\\sqrt{6}}&amp;-\\frac2{\\sqrt{6}}&amp;0&amp;0\\\\\\frac1{\\sqrt{12}}&amp;\\frac1{\\sqrt{12}}&amp;\\frac1{\\sqrt{12}}&amp;-\\frac3{\\sqrt{12}}&amp;0\\\\\\frac1{\\sqrt{20}}&amp;\\frac1{\\sqrt{20}}&amp;\\frac1{\\sqrt{20}}&amp;\\frac1{\\sqrt{20}}&amp;-\\frac4{\\sqrt{20}}\\end{bmatrix}\\] 可得 \\[\\boldsymbol{Q}=\\boldsymbol{C}\\boldsymbol{\\hat{\\Sigma}}\\boldsymbol{C}^{\\prime}=\\begin{bmatrix}0.00592&amp;-0.00019&amp;-0.00003&amp;0.00013\\\\-0.00019&amp;0.00830&amp;0.00399&amp;0.00178\\\\-0.00003&amp;0.00399&amp;0.00486&amp;0.00078\\\\0.00013&amp;0.00178&amp;0.00078&amp;0.00875\\end{bmatrix}\\] 然后得到 \\(\\hat{{\\theta}}=0.795\\) 和 \\(\\tilde{{\\theta}}=1.747\\). 用于检验 \\(H_0{:\\boldsymbol{C\\Sigma C&#39;}}=\\lambda\\boldsymbol{I}\\) 的似然比检验统计量的值 \\[\\Lambda=\\frac{|\\hat{\\boldsymbol{Q}}|}{\\left[\\frac1{p-1}\\mathrm{tr}(\\hat{\\boldsymbol{Q}})\\right]^{p-1}}=\\frac{1.20895(10)^{-9}}{\\left(\\frac{0.027831}4\\right)^4}=0.5159\\] 因此 \\(-2\\log_e(\\Lambda)=1.32\\)，将其与 \\(\\chi_{0.05,9}^2=16.919\\) 比较，因此根据这些数据无法拒绝 \\(H_0{:\\boldsymbol{C\\Sigma C&#39;}}=\\lambda\\boldsymbol{I}\\). 假设表 27.1 中的数据是使用 SAS-GLM 程序进行时间的裂区分析。表 27.7 中给出了所使用的 SAS 命令。 表 27.7: 使用时间的裂区分析来分析表 27.1 中的数据的 SAS-GLM 代码 x 表 27.8 中给出了肥料和品种的主效应检验，表 27.9 中给出了时间主效应以及时间 × 肥料和时间 × 品种交互效应的检验以及 G–G 调整的自由度。调整的自由度是通过将原始的时间的裂区分析中的自由度分别与\\(\\hat\\theta\\) 相乘来计算的。表 27.8 中的检验无需调整。请注意，表 27.8 中的 \\(F\\) 统计量与前面给出的品种和肥料主效应的 MANOVA 检验统计量一致。即使使用了调整的自由度，表 27.9 中的所有显著概率仍小于 0.0001. 表 27.8: 时间的裂区主效应均值检验 x 表 27.9: 具有 G-G 调整自由度的时间的裂区检验 x SAS-GLM 程序及其 repeated 选项也可用于产生本节所述的分析以及 MANOVA 分析的一些结果。表 27.10 给出了可用于表 27.1 中数据分析的 SAS 命令。 表 27.10: 使用 repeated 选项分析表 27.1 中的数据的 SAS-GLM 代码 x 表 27.11 中标记为 “Orthogonal components” 的一行给出了 \\(H_0{:\\boldsymbol{C\\Sigma C&#39;}}=\\lambda\\boldsymbol{I}\\) 的检验。也就是说，这是对 H–F 条件是否满足的检验。表 27.12 给出了比较时间主效应的 MANOVA 检验，表 27.13 给出了时间与品种交互作用和时间与肥料交互作用的 MANOVA 检验，表 27.14 给出了品种与肥料主效应的检验。最后，表 27.15 给出了时间主效应的时间的裂区分析，以及时间与品种和时间与肥料交互作用。给出了三组不同的 \\(p\\) 值。它们是未调整的时间的裂区分析 \\(p\\) 值, Greenhouse–Geisser (G-G) 调整的 \\(p\\) 值和 Huyhn–Feldt (H–F) 调整的 \\(p\\) 值。还给出了 \\(\\hat \\theta=0.7954\\) 和 \\(\\tilde\\theta=1.7473\\). 表 27.11: 检验 \\(H_0{:\\boldsymbol{C\\Sigma C&#39;}}=\\lambda\\boldsymbol{I}\\) x 表 27.12: 时间主效应均值的 MONOVA 检验 x 表 27.13: 时间与肥料与品种的交互作用的 MONOVA 检验 x 表 27.14: 肥料与品种主效应检验 x 表 27.15: 调整 \\(p\\) 值的时间的裂区分析 x 27.4 混合模型法 再次考虑第 27.1 节中描述的符号，其中 \\[\\boldsymbol y_{ik}=\\begin{bmatrix}y_{i1k}\\\\y_{i2k}\\\\\\vdots\\\\y_{ipk}\\end{bmatrix}\\] 是处理组 i 中个体 k 的响应向量。假设误差向量 \\[\\begin{equation} \\boldsymbol \\varepsilon_{ik}^*\\thicksim\\mathrm{independent~}N(\\boldsymbol 0,\\boldsymbol{\\Sigma}_i),\\quad i=1,2,\\ldots,t;\\quad k=1,2,\\ldots,n_i \\tag{27.16} \\end{equation}\\] 设 \\(\\boldsymbol y\\) 是一个包含所有数据向量的向量。即 \\[\\boldsymbol y^{\\prime}=[\\boldsymbol y_{11}^{\\prime}\\quad \\boldsymbol y_{12}^{\\prime}\\quad\\ldots\\quad \\boldsymbol y_{1n_{1}}^{\\prime}\\quad \\boldsymbol y_{21}^{\\prime}\\quad \\boldsymbol y_{22}^{\\prime}\\quad\\ldots\\quad \\boldsymbol y_{2n_{2}}^{\\prime}\\quad\\ldots\\quad \\boldsymbol y_{t1}^{\\prime}\\quad \\boldsymbol y_{t2}^{\\prime}\\quad \\boldsymbol y_{t2}^{\\prime}\\quad\\ldots\\quad \\boldsymbol y_{tn_{t}}^{\\prime}]\\] 在式 (27.16) 的条件下， \\[\\boldsymbol V=\\mathrm{Cov}(\\boldsymbol y)=\\begin{bmatrix}\\boldsymbol{\\Sigma}_1&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}\\\\ \\boldsymbol{0}&amp;\\boldsymbol{\\Sigma}_1&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}\\\\ \\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ \\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{\\Sigma}_1&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}\\\\ \\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{\\Sigma}_2&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}\\\\\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\boldsymbol{\\Sigma}_2&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}\\\\\\vdots&amp;\\vdots&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\ddots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots\\\\\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{\\Sigma}_2&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}\\\\\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\ddots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots\\\\\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{\\Sigma}_t&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}\\\\\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{\\Sigma}_t&amp;\\cdots&amp;\\boldsymbol{0}\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\boldsymbol{0}&amp;\\cdots&amp;\\boldsymbol{\\Sigma}_t\\end{bmatrix}\\] 设 \\(\\boldsymbol{y}\\sim N(\\boldsymbol{X}\\boldsymbol{\\beta},V)\\)，或等价地 \\(\\boldsymbol{y}=\\boldsymbol{X\\beta}+\\boldsymbol{\\varepsilon}\\) 其中 \\(\\boldsymbol{\\varepsilon}\\sim N(\\boldsymbol{0},V)\\). 现假设 \\(\\boldsymbol V\\) 已知且 \\(\\boldsymbol\\ell&#39;\\boldsymbol \\beta\\) 可估。在这种情况下，可以证明 \\(\\boldsymbol\\ell&#39;\\boldsymbol \\beta\\) 的最佳估计是 \\(\\boldsymbol\\ell&#39;\\hat{\\boldsymbol \\beta}_\\boldsymbol V\\) 其中 \\(\\boldsymbol{\\hat{\\beta}}_V=(\\boldsymbol{X}^{\\prime}\\boldsymbol{V}^{-1}\\boldsymbol{X})^{-}\\boldsymbol{X&#39;}\\boldsymbol{V}^{-1}\\boldsymbol{y}\\). 此外，\\(\\boldsymbol\\ell&#39;\\hat{\\boldsymbol \\beta}_\\boldsymbol V\\) 的标准误可证明等于 \\(\\boldsymbol\\ell&#39;(\\boldsymbol{X&#39;V}^{-1}\\boldsymbol{X})^-\\boldsymbol\\ell\\). 估计 \\(\\boldsymbol\\ell&#39;\\hat{\\boldsymbol \\beta}_\\boldsymbol V\\) 称为 \\(\\boldsymbol\\ell&#39;\\boldsymbol \\beta\\) 的广义最小二乘估计 (generalized least squares estimator). 不幸的是，\\(\\boldsymbol V\\) 很少是已知的。但假设 \\(\\boldsymbol V\\) 可被估计为 \\(\\hat {\\boldsymbol V}\\)，那么 \\(\\boldsymbol\\ell&#39;\\boldsymbol \\beta\\) 可被估计为 \\(\\boldsymbol\\ell&#39;\\hat{\\boldsymbol \\beta}_\\boldsymbol V\\)，其中 \\(\\hat{\\boldsymbol \\beta}_\\boldsymbol V=\\left(\\boldsymbol{X}^{\\prime}\\hat {\\boldsymbol{V}}^{-1}\\boldsymbol{X}\\right)^{-}\\boldsymbol{X&#39;}\\hat {\\boldsymbol{V}}^{-1}\\boldsymbol{y}\\)，那么 \\(\\boldsymbol\\ell&#39;\\hat{\\boldsymbol \\beta}_\\boldsymbol V\\) 的一个标准误估计为 \\(\\widehat{s.e.}(\\boldsymbol\\ell&#39;\\hat{\\boldsymbol{\\beta}}_{\\hat{\\boldsymbol V}})=\\boldsymbol\\ell&#39;\\left(\\boldsymbol{X&#39;}\\hat{\\boldsymbol{V}}^{-1}\\boldsymbol{X}\\right)^{-}\\boldsymbol\\ell\\). 估计 \\(\\boldsymbol\\ell&#39;\\hat{\\boldsymbol \\beta}_\\boldsymbol V\\) 称为 \\(\\boldsymbol\\ell&#39;\\boldsymbol \\beta\\) 的广义最小二乘估计的估计 (estimated generalized least squares estimator). 用于检验 \\(\\boldsymbol{\\ell&#39;\\beta}=0\\) 的近似 \\(t\\) 统计量（其自由度也必须近似）为 \\[\\begin{equation} t=\\frac{\\boldsymbol\\ell^{\\prime}\\hat{\\boldsymbol\\beta}_{\\hat{\\boldsymbol V}}}{\\boldsymbol\\ell^{\\prime}(\\boldsymbol X^{\\prime}\\hat{\\boldsymbol V}^{-1}\\boldsymbol X)\\boldsymbol\\ell} \\tag{27.17} \\end{equation}\\] 假设要检验 \\(H_0{:\\boldsymbol{H\\beta}}=\\boldsymbol0\\mathrm{~vs~}H_a{:\\boldsymbol{H\\beta}}\\ne\\boldsymbol0\\)，其中 \\(\\boldsymbol{H}\\) 是秩为 q 的 q × p 矩阵。用于检验 \\(H_0\\) 的一个近似 \\(F\\) 统计量为 \\[\\begin{equation} F=\\frac{(\\boldsymbol H\\boldsymbol{\\hat{\\beta}}_{\\hat{\\boldsymbol V}})^{\\prime}\\left[\\boldsymbol H(\\boldsymbol X\\hat{\\boldsymbol V}^{-1}\\boldsymbol{\\boldsymbol X})^{-}\\boldsymbol{H}^{\\prime}\\right]^{-1}(\\boldsymbol H{\\hat{\\boldsymbol \\beta}}_{\\hat{\\boldsymbol V}})}q \\tag{27.18} \\end{equation}\\] 这个 \\(F\\) 统计量的分子自由度由 q 给出，分母自由度必须近似。近似方法超出了本书的范围，但可以推荐两种方法。如果没有缺失数据值，可以使用一种称为 Satterthwaite’s method 的方法。这是第二章中讨论的 Satterthwaite’s method 的推广。有关更多详细信息，请参见 Giesbrecht and Burns (1985), McLean and Sanders (1988) 和 Fai and Cornelius (1996). 当有缺失值时，应使用 Kenward–Roger’s method. 详见 Kenward and Roger (1997). 混合模型程序可用于获得 \\(\\boldsymbol\\Sigma_i\\) 的估计，由此可估计 \\(\\boldsymbol V\\). 所使用的估计方法是基于式 (27.16) 中的假设的似然方法，即 \\(\\boldsymbol y\\) 具有多元正态分布。这些方法超出了本书的范围，只是后面会有一些一般性的评论。\\(\\boldsymbol\\Sigma_i\\) 的估计取决于 \\(\\boldsymbol\\Sigma_i\\) 是否具有任何结构。可以考虑各种结构。相对流行的结构包括复合对称 (CS) 结构 、Hyuhn–Feldt 结构、AR(1) 结构、异质复合对称 (heterogeneous compound symmetry, HCS) 和异质 AR(1). 混合模型程序也可以处理 \\(\\boldsymbol\\Sigma_i\\) 毫无结构的非结构化 (unstructured, UN) 情况。一旦估计了 \\(\\boldsymbol V\\)，混合模型程序就可以计算 \\(\\boldsymbol\\ell&#39;\\hat{\\boldsymbol \\beta}_\\boldsymbol V\\) 及其标准误估计。表 27.16 给出了一些相对流行的用于重复测量的协方差结构。表 27.16 中的结构假设 t 个处理具有相同的参数。即，它假设所有的 \\(\\boldsymbol\\Sigma_i\\) 是相等的。也可以分别估计每个处理的协方差参数。 表 27.16: 用于重复测量实验的一些流行的协方差结构 x 综上所述，重复测量模型为 \\[\\begin{equation} y_{ijk}=\\mu+\\alpha_i+\\tau_j+\\gamma_{ij}+\\varepsilon_{ijk}^*,\\quad i=1,2,\\ldots,t;~j=1,2,\\ldots,p;~k=1,2,\\ldots,n_i \\tag{27.19} \\end{equation}\\] 其中 \\[\\boldsymbol{\\varepsilon}_{ik}^*=\\begin{bmatrix}{\\varepsilon}_{i1k}^*\\\\{\\varepsilon}_{i2k}^*\\\\\\vdots\\\\{\\varepsilon}_{ipk}^*\\end{bmatrix}\\] 是处理组 i 中个体 k 的误差向量，以及对于 \\(i=1,2,\\ldots,t;k=1,2,\\ldots,n_i\\)，\\(\\boldsymbol{\\varepsilon}_{ik}^*\\) 独立分布于 \\(N(\\boldsymbol 0,\\boldsymbol \\Sigma_i)\\). 通过向式 (27.19) 中的模型添加随机个体分量 (random subject component)，可以获得其他的协方差结构。这样的模型将由下式给出 \\[\\begin{equation} y_{ijk}=\\mu+\\alpha_i+\\delta_{ik}+\\tau_j+\\gamma_{ij}+\\varepsilon_{ijk}^*,i=1,2,\\ldots,t;~j=1,2,\\ldots,p;~k=1,2,\\ldots,n_i \\tag{27.20} \\end{equation}\\] 其中 \\(\\delta_{ik}\\thicksim i.i.d.N(0,\\sigma_\\delta^2),i=1,2,\\ldots,t;k=1,2,\\ldots,n_i\\). 在模型中添加随机个体分量会将重复测量的协方差结构改为 \\[\\left.\\mathrm{Cov}(y_{ik})=\\mathrm{Cov}\\left(\\begin{bmatrix}y_{i1k}\\\\y_{i2k}\\\\\\vdots\\\\y_{ipk}\\end{bmatrix}\\right.\\right)=\\sigma_\\delta^2\\boldsymbol{J}_p+\\boldsymbol{\\Sigma}_i\\] 其中 \\(\\boldsymbol{J}_p\\) 是全 1 的 p × p 矩阵。当 \\(\\Sigma_i\\) 满足复合对称性或 \\(\\Sigma_i\\) 具有非结构化形式时，添加随机个体分量没有任何影响，但对于许多其他协方差结构添加随机个体分量可能非常有用。 接下来讨论了用于拟合模型的两种方法，如式 (27.16) 和 (27.17) 中的方法。一种是确定模型参数的最大似然估计 (maximum likelihood, ML)，另一种是定义模型参数的受限最大似然估计 (restricted maximum likelihood estimates, REML). 这两种方法都是数值密集型的，通过这些方法拟合模型超出了本书的范围。尽管如此，下面将讨论这两种方法所涉及的一些问题。 27.4.1 最大似然法 可以基于 \\(\\boldsymbol y\\) 的分布形成似然函数，并将似然视为协方差矩阵 \\(\\boldsymbol V\\) 中的参数以及 \\(\\boldsymbol \\beta\\) 中固定效应的参数的函数。这种方法是数值密集型的，得到的估计可能不会产生感兴趣参数函数（如 \\(\\boldsymbol P&#39;\\boldsymbol\\beta\\)）的无偏估计，参数函数估计的分布性质可能是未知的，除非是渐近的。求解似然方程需要一个迭代过程，该迭代过程可能收敛，也可能不收敛，它可以收敛于局部最大值而不是全局最大值。ML 法的最大缺点是它倾向于低估方差-协方差参数，这导致固定效应估计的标准误估计太小。这导致 I 类错误率，并且置信区间未达到预期置信水平。有关双向混合模型的讨论，请参阅第 22 章。 27.4.2 受限最大似然法 受限最大似然法也是数值密集型的，并且除了渐近之外，估计的分布特性是未知的。然而，它优于 ML 方法，因为所得的感兴趣参数函数的估计具有较小的偏差，并且 REML 方法不会像 ML 方法那样低估方差-协方差参数。这导致固定效应估计的标准误估计更合适，从而得到更理想的 I 类错误率，以及往往更接近所需置信水平的置信区间。 考虑模型的矩阵形式，\\(\\boldsymbol{y}=\\boldsymbol{X\\beta}+\\boldsymbol{\\varepsilon}\\)，其中 \\(\\boldsymbol{\\varepsilon}\\sim N(\\boldsymbol{0},\\boldsymbol{V})\\). 令 \\(\\boldsymbol L\\) 为满足 \\(\\boldsymbol{LX} = \\boldsymbol 0\\) 的行满秩矩阵，并且有 \\(\\text{rank}(\\boldsymbol L) = n-\\text{rank}(\\boldsymbol X)\\)，其中 n 为 \\(\\boldsymbol y\\) 的维度。 设 \\(\\boldsymbol y^* = \\boldsymbol {Ly}\\). 那么 \\(\\boldsymbol y^*\\sim N(\\boldsymbol 0,\\boldsymbol{LVL}^{\\prime})\\). 由 \\(\\boldsymbol y^*\\) 形成的似然函数仅取决于方差-协方差参数。方差-协方差参数的 REML 估计是使受限似然函数达到最大化的参数值，该函数基于 \\(\\boldsymbol y^*\\) 的分布。一旦找到方差-协方差参数的估计，就可以估计 \\(\\boldsymbol V\\)，然后可以根据式 (27.17) 和 (27.18) 计算检验统计量。 作为使用混合模型方法的一种策略，通常建议首先利用 REML 确定重复测量值的方差-协方差矩阵的合适结构。一旦获得协方差阵结构后，就可以考虑关于固定效应参数可估函数的推断。有关双向混合模型的 REML 讨论，请参阅第 22 章。接下来将考虑选择重复测量协方差阵结构的一些可能性。 诸如 SAS-Mixed 等统计软件会计算几种统计量，它们提供了有用信息，有助于选择重复测量的协方差结构。第一个这样的统计量由 Akaike (1974) 提出，即著名 Akaiki’s Information Criterion (AIC). 第二个统计量由 Schwarz (1978) 提出，被称为 Schwarz’ Bayesian Criterion (BIC). 第三个由 Hurvich and Tsai (1989) 给出，通常表示为 AICC. 这三个准则都是 \\(-2\\log_{\\mathrm{e}}(\\hat{{L}})\\) 的函数，其中 \\(\\hat{\\boldsymbol{L}}\\) 是受限最大似然函数的最大值。这些准则的不同之处仅在于随着协方差结构中参数数量的增加，对 \\(-2\\log_{\\mathrm{e}}(\\hat{{L}})\\) 的惩罚方式不同。对于这三种准则，一般认为数值越小越好。令 \\(d\\) 表示所考虑协方差结构中的参数数量，\\(N\\) 表示个体数量，\\(N^*\\) 表示总观测次数减去设计矩阵 \\(\\boldsymbol X\\) 的秩。那么，这三种准则可以分别定义为： \\[\\begin{align} \\mathrm{AIC}&amp;=-2\\log_\\mathrm{e}(\\hat{\\boldsymbol{L}})+2d\\\\\\mathrm{BIC}&amp;=-2\\log_\\mathrm{e}(\\hat{\\boldsymbol{L}})+d[\\log_\\mathrm{e}(N)]\\\\\\mathrm{AICC}&amp;=-2\\log_\\mathrm{e}(\\hat{\\boldsymbol{L}})+2d[N^*/(N^*-d-1)] \\tag{27.21} \\end{align}\\] 当样本量相对较大时，还可以计算似然比检验 (LRT) 统计量，该统计量可以用于比较重复测量的两种协方差结构，只要零假设下的结构是备择假设下的结构的特例。例如，可以获得将复合对称结构与 H–F 结构或非结构化结构进行比较的 LRT 统计量，也可以获得将非结构化结构与 H–F 或 AR (1) 结构相比较的 LRT 统计量，但由于 AR(1) 结构与复合对称结构或 H-F 结构彼此之间并无特例之关系，因此无法直接通过 LRT 统计量将 AR(1) 结构与复合对称结构或 H-F 结构进行比较55。为了进行这样的比较，需要依赖于式 (27.21) 中的准则。 例如，再次考虑表 27.4 中的药物数据。将使用 SAS-Mixed 程序对这些数据进行各种分析。可以使用的基本 SAS 命令如表 27.17 所示。基础模型是一个包含药物效应、时间效应和药物-时间交互作用的双向模型。Repeated 语句表明时间是一个重复因子，Type = CS 选项表示拟合模型假设重复测量的协方差矩阵具有复合对称性，而 Subject = Person 选项则表明 Person 是数据集中的一项变量，用于识别构成特定个体的重复测量构成。请注意，对于这些数据，Person变量具有 1-24 的唯一值，每个个体一个值。注意：如果让 Person 变量在三个药物组中都取值 1-8，那么为了正确识别每个个体，就需要使用 Subject = Person(Drug)。最后，R 选项被用来在输出中提供 Person = 1 的协方差阵。请注意，该分析假设所有 24 个个体具有相同的协方差阵 \\(\\boldsymbol \\Sigma\\)，所以只需要打印第一个。如果希望获得第 1, 9, 17 号个体的协方差阵，则需要使用 R = 1, 9, 17 而不是仅使用 R. 表 27.17: 使用 repeated 选项分析表 27.4 中数据的 SAS-Mixed 代码 x 本例中使用的方法是重新拟合假设了各种协方差结构的模型，以便在考虑对药物和时间因素的推断时选择将使用的协方差结构。因此，使用表 27.18 中给出的每个 repeated 语句对本例中的数据进行重新分析。在每次分析中，语句 “ODS RTF SELECT R;” 用于获取 RTF 输出文件中的每个 \\(\\boldsymbol R\\) 矩阵，而 “ODS output FITSTATISTICS=FIT1;” 用于创建一个数据集，该数据集包含每次分析的各种拟合统计量。所获得的拟合统计量是 AIC, AICC 和 BIC，以及每个分析的 \\(-2\\log_{\\mathrm{e}}(\\hat{L})\\) 值。 表 27.18: 考虑不同 repeated 选项的协方差结构 x 表 27.18 中的前六个 repeated 语句对应于表 27.16 中给出的协方差结构。最后四个 repeated 语句包括 Group = Drug 选项，这会导致为每种药物拟合不同的协方差阵。每个药物组中的第一个人是编号为 1, 9 和 17 的人，R = 1,9,17 选项将这些的协方差阵估计置于输出中。 表 27.19 给出了假设复合对称时重复测量的协方差阵估计。请注意，\\(\\hat{{\\sigma}}^2=33.4182\\) 以及 \\[\\hat{\\rho}=\\frac{25.9702}{33.4182}=0.777\\] 表 27.20 给出了假设 H–F 条件下的协方差阵估计。此时 \\[\\begin{aligned} \\hat{\\sigma}^2+2\\hat{\\eta}_1 &amp;=28.5296 \\\\ \\hat{\\sigma}^2+2\\hat{\\eta}_2 &amp;=40.2442 \\\\ \\hat{\\eta}_1+\\hat{\\eta}_2 &amp;=26.9390 \\end{aligned}\\] 同时求解 \\(\\hat{\\sigma}^2,\\hat{\\eta}_1,\\hat{\\eta}_2\\) 得到 \\[\\hat{\\sigma}^2=7.4479,\\quad\\hat{\\eta}_1=10.5409,\\quad\\mathrm{and}\\quad\\hat{\\eta}_2=16.3982\\] 表 27.19: 复合对称 (CS) 的 \\(\\hat{\\boldsymbol \\Sigma}\\) x 表 27.20: H-F 条件的 \\(\\hat{\\boldsymbol \\Sigma}\\) x 表 27.21: 非结构化 (UN) 情况的 \\(\\hat{\\boldsymbol \\Sigma}\\) x 表 27.22: AR(1) 情况的 \\(\\hat{\\boldsymbol \\Sigma}\\) x 根据这些，以及 \\(\\boldsymbol \\Sigma\\) 的其他两个对角元，可以得到 \\[\\hat{\\eta}_3=15.2671,\\quad\\mathrm{~and~}\\quad\\hat{\\eta}_4=11.6326\\] 表 27.21 给出了假设为非结构化协方差阵的协方差阵估计。这与在 SAS-GLM 分析中包括 MANOVA/PRINTE 选项时获得的估计相同。 表 27.22 给出了假设 AR(1) 结构的协方差阵估计。此时 \\(\\hat{\\sigma}^2=32.4945\\) 以及 \\(\\hat{\\rho}=26.7309/32.4945=0.8226\\). 表 27.23 给出了假设异质复合对称结构的协方差阵估计。在这种情况下，可以得到 \\[\\begin{aligned} &amp;\\hat{\\sigma}_1^2 =31.1038_{\\prime} \\\\ &amp;\\hat{\\sigma}_2^2 =38.6218, \\\\ &amp;\\hat{\\sigma}_3^2=29.3752, \\\\ &amp;\\hat{\\sigma}_4^2=34.7840 \\end{aligned}\\] 以及 \\[\\hat{\\rho}=\\frac{27.0585}{\\sqrt{31.1038\\cdot38.6218}}=0.7807\\] 表 27.23: 具有异质方差的复合对称结构的 \\(\\hat{\\boldsymbol \\Sigma}\\) x 表 27.24 显示了异质 AR(1) 结构的结果。此时 \\[\\begin{aligned} \\hat{\\sigma}_1^2 &amp;=30.7872 \\\\ \\hat{\\sigma}_2^2 &amp;=39.3259 \\\\ \\hat{\\sigma}_3^2 &amp;=31.0182 \\\\ \\hat{\\sigma}_4^2 &amp;=32.4256 \\end{aligned}\\] 以及 \\[\\hat{\\rho}=\\frac{29.0118}{\\sqrt{30.7872\\cdot39.3256}}=0.8338\\] 表 27.24: 具有异质方差的 AR(1) 结构的 \\(\\hat{\\boldsymbol \\Sigma}\\) x 表 27.25 - 27.28 给出了假设每种药物的协方差阵不同时的协方差阵估计。表 27.25 为复合对称结构，表 27.26 为 H–F 结构，表 27.27 为非结构化结构，表 27.28 为 AR(1) 结构。每个单独的协方差参数估计留给读者去寻找。 表 27.25: 复合对称下每种药物的三个协方差阵估计 x 表 27.26: H-F 条件下每种药物的三个协方差阵估计 x 表 27.27: 非结构化条件下每种药物的三个协方差阵估计 x 表 27.28: AR (1) 条件下每种药物的三个协方差阵估计 x 表 27.29 显示了上面考虑的每个协方差结构的 AIC 值。可以看出，AIC 的最小值为 488.603，并且该最小值出现在 AR(1) 结构中。因此，在 AIC 下，AR(1) 结构将是最佳的协方差结构选择。 表 27.29: 每种协方差结构的 AIC x 表 27.30 显示了上面考虑的每个协方差结构的 AICC 值。可以看到，AICC 的最小值为 488.751，并且 AR(1) 结构也出现该最小值。因此，在 AICC 下，AR(1) 结构将是最佳的协方差结构选择。 表 27.30: 每种协方差结构的 AICC x 表 27.31 显示了上面考虑的每个协方差结构的 BIC 值。可以看到，BIC 的最小值为 490.959，并且该最小值出现在 AR(1) 结构中。因此，在 BIC 下，AR(1) 结构将是最佳的协方差结构选择。因此，在 AIC, AICC 和 BIC 这三个准则中，重复测量的首选协方差结构是 AR(1). 表 27.31: 每种协方差结构的 BIC x 表 27.32 给出了本例中考虑的每个协方差结构的 \\(-2\\log_{\\mathrm{e}}(\\hat{L})\\) 值。假设想要使用似然比检验来比较复合对称结构与 H-F 结构。这是可以做到的，因为复合对称性是 H-F 结构的特例。也就是说，假设我们要检验 \\(H_0:\\boldsymbol \\Sigma\\) 具有 CS 结构与 \\(H_a:\\boldsymbol \\Sigma\\)具有 H–F 结构。LRT 统计量的值是它们各自 \\(-2\\log_{\\mathrm{e}}(\\hat{L})\\) 值的差。在 \\(H_0\\) 下，该检验统计量近似卡方分布，其自由度为协方差结构参数数量之差。当 p = 4 时，CS 结构有两个参数，而 H–F 结构有 5 个参数。因此，卡方检验统计量为 \\(\\chi^2=488.797-487.034=1.763\\)，自由度为 5 - 2 = 3。结果观察到的显著性水平为 \\(\\hat\\alpha = 0.6230\\)，并且 \\(H_0\\) 不能被拒绝。 表 27.32: 每种协方差结构的 \\(-2\\log_{\\mathrm{e}}(\\hat{L})\\) x 作为使用 LRT 的第二个示例，请考虑将 AR(1) 结构与 ARH(1) 结构进行比较。那么当 p = 4 时，这两个结构中的参数数量分别为 2 和 5。这里 \\(\\chi^2=484.603-482.767=1.836\\)，具有 3 个自由度。卡方临界点是 \\({\\chi}_{0.05,3}^2=7.815\\)，并且由于 1.836 &lt; 7.815，因此无法拒绝 AR(1) 结构而选择 ARH(1) 结构。 作为第三个示例，考虑将 AR(1) 结构与 UN 结构进行比较。AR(1) 结构中的参数数量为 2，当 p = 4 时，UN 结构中的参数数量为 p(p + 1)/2 = 10。这里 \\(\\chi^2=484.603-477.372=7.231\\) 其中 10 - 2 = 8 个自由度。由此产生的观察到的显著性水平为 \\(\\hat \\alpha = 0.5119\\)，并且无法拒绝 AR(1) 结构而选择 UN 结构。 上述三个检验是可能的，因为其中一个协方差结构是另一个协方差结构的特例。无法给出将 AR(1) 与 CS 进行比较的 LRT，因为两者都不是另一者的特例。同样，人们无法获得将 ARH(1) 与 CSH 进行比较的 LRT. 在考虑固定效应检验之前，假设拟合一个协方差结构为 AR(1) 的模型，但将与个体对应的随机分量添加到模型中。也就是说，假设重复测量满足 AR(1) 结构，则对式 (27.20) 中的模型进行拟合。这相当于为重复测量选择协方差结构，该结构等于 \\[\\boldsymbol{\\Sigma}={\\sigma}_\\delta^2\\begin{bmatrix}1&amp;1&amp;1&amp;1\\\\1&amp;1&amp;1&amp;1\\\\1&amp;1&amp;1&amp;1\\\\1&amp;1&amp;1&amp;1\\\\1&amp;1&amp;1&amp;1\\end{bmatrix}+{\\sigma}^2\\begin{bmatrix}1&amp;{\\rho}&amp;{\\rho}^2&amp;{\\rho}^3\\\\{\\rho}&amp;1&amp;{\\rho}&amp;{\\rho}^2\\\\{\\rho}^2&amp;{\\rho}&amp;1&amp;{\\rho}\\\\{\\rho}^3&amp;{\\rho}^2&amp;{\\rho}&amp;1\\end{bmatrix}\\] 表 27.33 给出了用于在重复测量和随机个体效应上拟合具有 AR(1) 结构的模型的 SAS-Mixed 命令，表 27.34 给出了使用表 27.33 中的命令进行分析的拟合统计量的值。请注意，AIC, AICC 和 BIC 的值均大于没有随机个体效应的 AR(1) 结构模型的值。因此，对于这些药物数据，不建议添加随机个体项。此外，将具有随机个体项的模型与不具有随机个体项的模型进行比较的 LRT 统计量为 \\(\\chi^2=484.6-483.7=0.9\\). 向模型添加随机个体项会使参数数量增加 1。因此，\\(\\chi^2=484.6-483.7=0.9\\) 将与自由度为 1 的卡方临界点进行比较。这个临界点是 \\(\\chi_{0.05,1}^2=3.84\\)，并且向模型添加随机个体项并不会给出明显更好的拟合。 表 27.33: 用于向重复测量实验添加随机个体效应的 SAS-Mixed 命令 x 表 27.34: 具有随机个体效应的重复测量模型的拟合统计量 x 接下来分析数据以考虑有关药物和时间效应的推断。 SAS-Mixed 命令如表 27.35 所示。表 27.36 显示了式 (27.18) 给出的药物和时间主效应以及药物 × 时间交互作用的检验统计量。值得注意的是，药物与时间的交互作用非常显著。因此，双向药物 × 时间平均值应在每个药物组内和每个时间水平内相互比较。最小二乘均值列于表 27.37 中，表 27.38 中给出了每个时间水平下药物之间的成对比较，表 27.39 中给出了每种药物中时间水平之间的成对比较。 表 27.35: 用于分析固定效应的最终 SAS-Mixed 命令 x 表 27.36: III 型固定效应检验 x 表 27.37: 模型中每种效应的最小二乘均值 x 表 27.38: 每个时间水平下药物均值之间的比较，带有 Tukey-Kramer 调整显著性水平 x 表 27.39: 每种药物下时间均值之间的比较，带有 Tukey-Kramer 调整显著性水平 x 27.5 总结 本章考虑了三种替代方法，当时间的裂区分析不合适时，可使用这些方法来分析重复测量实验。考虑的方法包括多元方差分析法、调整 \\(p\\) 值法和混合模型法。人们选择使用哪种方法可能取决于可以使用的统计软件。当拥有可用的混合模型软件时，这种方法可能是最容易使用的方法。如果使用混合模型程序难以收敛，那么如果拥有允许使用多元方差分析法的统计软件，则可以考虑多元方差分析法。如果软件不适用于这两种方法，则可以考虑使用调整 \\(p\\) 值法。 27.6 练习 本书将 “subject” 译作个体，原因见介绍页的术语规范。↩︎ 原文：but adjust the p-values by adjusting the degrees of freedom corresponding to relevant effect mean squares.↩︎ 原文：one first needs the least squares estimates of the parameters in B and an observed residual sum-of-squares and cross-products matrix. 译者在此看得云里雾里的，这句话其实不重要，只需理解接下来的式表达即可。↩︎ 译者注，叶面积指数 = 总绿叶面积 / 土地面积。↩︎ 译者注，加性模型见第 7 章。↩︎ 译者注：这里 “特例” 的意思是，若以 “x&lt;y” 表示 x 是 y 的特例，则 “复合对称 &lt; H-F”，“复合对称 &lt; 非结构化”，“H-F &lt; 非结构化”，“AR(1) &lt; 非结构化”，但 AR(1) 与复合对称结构无特例之关系，AR(1) 也与 H-F 结构也无特例之关系，就无法利用 LRT 进行比较。特例之关系可结合表 27.16 看出。↩︎ "],["chap28.html", "第 28 章 案例研究：重复测量的复杂例子 28.1 复杂舒适度实验 28.2 家庭态度实验 28.3 多地点研究 28.4 练习", " 第 28 章 案例研究：重复测量的复杂例子 本章考虑了几个例子及其使用混合模型程序的统计分析。考虑的示例包括具有重复测量的裂区设计、重复测量中嵌套的重复测量以及多地点研究。 28.1 复杂舒适度实验 工程师在三种环境 (environments) 中测试两种类型的服装 (clothing). 由于男性和女性对环境的反应也不同，因此人 (person) 的性别被列为一个因素。四个人（两男两女）被放入一个环境室 (chambers)（分配了三种环境之一）。一名男性和一名女性着类型 1 的服装，另一名男性和女性着类型 2 的服装。在 1、2 和 3 小时结束时记录每个人的舒适度得分。本实验的数据如表 28.1 所示。实验单位分为三种尺寸。最大的实验单位是一个室，或者相当于一个四人小组。室实验单元的实验设计是完全随机设计结构中的单向处理结构（环境），在环境的每一水平具有三次重复。中型实验单位是一个人。一个人的实验设计是在九个区组（每个区组包含四个实验单元，人）中的随机完全区组设计结构中的双向处理结构（性别 × 服装）。最小的实验单位是 1 小时的时间间隔 (Hour)，这是一个重复的测量。小时的实验设计是在 36 个区组（每个区组包含 3 个实验单元，1 小时的时间间隔）的随机完全区组设计结构中的单向处理结构 (Time). 表 28.1: 复杂舒适度实验数据 x 该实验的模型为（其中模型被分为三个部分，对应于三种尺寸的实验单元，重复测量被视为时间的裂区因子） \\[\\begin{align} y_{ijkm\\ell}=&amp;\\,[\\mu+E_i+\\eta_{i\\ell\\ell}]+[S_j+C_k+(SC)_{jk}+(ES)_{ij}+(EC)_{ik}+(ESC)_{ijk}+\\delta_{ijk\\ell}]+[T_m+(ET)_{im}\\\\&amp;+(ST)_{jm}+(CT)_{km}+(SCT)_{jkm}+(EST)_{ijm}+(ECT)_{ikm}+(ESCT)_{ijkm}+\\varepsilon_{ijkm\\ell}] \\tag{28.1} \\end{align}\\] 其中 \\(E_i\\) 表示第 i 个环境，\\(S_j\\) 表示第 j 个性别，\\(C_k\\) 表示第 k 种服装，\\(T_m\\) 表示第 m 个时间点，\\(\\eta_{i\\ell}\\) 表示随机室效应且假定 \\(\\eta_{i\\ell}\\thicksim i.i.d.N(0,\\sigma_{\\eta}^{2})\\)，\\(\\delta_{ijk\\ell}\\) 表示随机人效应且假定 \\({\\delta_{ijk\\ell}}\\sim N(0,{\\sigma_\\delta^2})\\)，\\(\\varepsilon_{ijkm\\ell}\\) 表示给定小时的随机测量误差且假设 \\({\\varepsilon_{ijkm\\ell}}\\sim i.i.d.N(0,{\\sigma_{\\varepsilon}^2})\\). 还假设所有随机效应独立分布。还要注意，式 (28.1) 的第一个括号是模型的室部分，第二个括号是模型的人部分，而第三个括号是这个模型的小时部分。如果时间时间的裂区假设不合适，那么模型将是 \\[\\begin{align} y_{ijkm\\ell}=&amp;\\,\\mu+E_i+\\eta_{i\\ell}+S_j+C_k+(SC)_{jk}+(ES)_{ij}+(EC)_{ik}+(ESC)_{ijk}+T_m+(ET)_{im}+(ST)_{jm}\\\\&amp;+(CT)_{km}+(SCT)_{jkm}+(EST)_{ijm}+(ECT)_{ikm}+(ESCT)_{ijkm}+\\varepsilon_{ijkm\\ell} \\tag{28.2} \\end{align}\\] 其中假设 \\(\\eta_{i\\ell}\\thicksim i.i.d.N(0,\\sigma_\\eta^2)\\) 且 \\[\\left.{\\boldsymbol\\varepsilon}_{ijk\\ell}=\\begin{bmatrix}{\\varepsilon}_{ijk1\\ell}\\\\{\\varepsilon}_{ijk2\\ell}\\\\{\\varepsilon}_{ijk3\\ell}\\end{bmatrix}\\thicksim N_3\\left(\\begin{bmatrix}0\\\\0\\\\0\\end{bmatrix}\\right.,\\begin{bmatrix}{\\sigma}_{11}&amp;{\\sigma}_{12}&amp;{\\sigma}_{13}\\\\{\\sigma}_{21}&amp;{\\sigma}_{22}&amp;{\\sigma}_{23}\\\\{\\sigma}_{31}&amp;{\\sigma}_{32}&amp;{\\sigma}_{33}\\end{bmatrix}\\right)\\thicksim N_3(0,{\\boldsymbol\\Sigma})\\text{ (say)}\\] 并且分析将取决于为 \\(\\boldsymbol\\Sigma\\) 假设的结构。注意，式 (28.2) 中的模型与 (28.1) 中的模型相同，只是从模型中删除了对应于人的随机效应 \\(\\delta_{ijk\\ell}\\)。对于某些 \\(\\boldsymbol\\Sigma\\) 有时可能希望包括人随机效应，例如当 \\(\\boldsymbol\\Sigma\\) 具有 AR(1) 结构时。 如果希望执行时间的裂区分析，可使用的基本 SAS®-Mixed 代码如表 28.2 所示。这样的分析结果就留给读者去追寻了。这样的分析假设实验设计是裂-裂区设计，以室为整区实验单位，以人为子区实验单位，以时间测量为次子区实验单位。 表 28.2: 用于分析表 28.1 中数据的 SAS Mixed 代码，将重复测量因子视为时间的裂区因子 x 这里将采取的方法是将时间因子视为重复测量，然后考虑重复测量的各种协方差结构。然后，该设计将被描述为对子区因子（人）进行重复测量的裂区设计。表 28.3 显示了在假设重复测量的协方差结构具有复合对称性时使用的基本 SAS-Mixed 代码。请注意，Sex × Clo × Rep × Env 的组合对于每个人来说都是唯一的，因此此效应可用于识别出现重复测量的人。 表 28.3: 使用具有复合对称协方差结构的 `repeated`` 选项分析表 28.1 中数据的 SAS Mixed 代码 x 对于这些数据，考虑了重复测量的协方差阵的四种结构。所考虑的协方差结构是：复合对称，AR(1)，一个非结构化协方差阵以及人也被包括为随机效应的 AR(1) 重复测量协方差结构。对于其中的前三个，只需要更改表 28.3 中 repeated选项中的 “Type =”语句。为了将人也包括为随机因素，可以使用下面给出的 random 和 repeated 选项 RANDOM REP(ENV) SEX*CLO*REP*ENV; REPEATED TIME/SUBJECT=SEX*CLO*REP*ENV TYPE=AR(1); 表 28.4 中给出了所考虑的四个协方差结构中每一个的最终拟合统计量。 表 28.4: 四种协方差结构的拟合统计量 x 对表 28.4 中的 AIC, AICC 和 BIC 拟合统计量的检查表明，对于非结构化协方差矩阵假设，每一个都有其最小值。将复合对称与非结构化进行比较的卡方统计量为 \\(\\chi^2=117.7-107.5=10.2\\)，自由度为 6-2=4。相应的观察到的显著性水平为 \\(\\hat\\alpha=0.0372\\). 因此，非结构化明显优于复合对称。该示例的其余分析将假设重复测量的非结构化协方差阵。表28.5 中给出了产生固定效应分析表的 SAS-Mixed 代码。表 28.5 中所述分析的协方差参数估计如表 28.6 所示。从表 28.6 中可以看出 \\(\\hat{{\\sigma}}_{{\\eta}}^{2}=2.4047\\)，并且 \\[\\boldsymbol{\\Sigma}=\\begin{bmatrix}0.2157&amp;0.2256&amp;0.1248\\\\0.2256&amp;0.3525&amp;0.1894\\\\0.1248&amp;0.1894&amp;0.1462\\end{bmatrix}\\] 表 28.5: 使用非结构化协方差结构的 `repeated`` 选项分析表 28.1 中数据的 SAS Mixed 代码 x 表 28.6: 表 28.5 中分析的协方差参数估计 x 固定效应分析表见表 28.7。对表 28.7 的检查显示，显著的效应（\\(\\hat\\alpha&lt;0.05\\)）为：Sex, Clo, Env × Clo, Sex × Clo, Env × Sex × Clo, Time 和 Env × Time. 由于三向交互 Env × Sex × Clo 是显著的，我们应该研究这些三向均值之间有趣的成对比较。唯一涉及时间的显著性交互是环境与时间的交互，因此我们也应该研究这些双向均值之间的成对比较。除了上面描述的成对比较，分析还考虑了每种环境下时间均值之间的线性和二次比较。这里这样做是为了说明，读者需要自己确定这种比较是否对类似于本研究的研究感兴趣。需要附加到表 28.5 中的额外 SAS-Mixed 语句如表 28.8 所示。这些附加语句的结果如表 28.9 - 28.16 所示。 表 28.7: 固定效应分析 x 表 28.8: 用于获得感兴趣比较的额外 SAS-Mixed 语句 x 表 28.9 包含了每种环境下 Sex × Clothing 的四种组合和 Reps 的时间均值的线性和二次对比。对表 28.9 的检查表明，关于环境 1 和 2，线性和二次对比都具有统计学意义，环境 3 都不具有统计学意义。 表 28.9: 每种环境下时间的线性和二次对比 x 表 28.10 包含 Environment × Sex × Clothing 的最小二乘均值。这些均值是在 Reps 和 Time 上取均值。表 28.11 包含 Environment × Time 最小二乘均值，这些均值是在 Reps, Clothing 和 Sex 上取均值。有 12 个 Environment × Sex × Clothing 均值。如果要在这 12 个均值之间进行所有成对比较，则需要 66 个比较。然而，许多这样的成对比较对实验者来说并不有趣。通常情况下，我们感兴趣的那些比较往往是针对每两种因素的组合，对比另一个因素的各种可能性。也就是说，人们通常想要比较每个 Environment × Sex 组合的 Clothing 类型（六个比较）、每个 Environment × Clothing 组合的 Sex（六个对比）以及每个 Sex × Clothing 组合所处的 Environment（12个比较）。因此，在 66 个可能的比较中，总共有 24 个可能是实验者感兴趣的。这些比较的结果分别显示在表 28.12 - 28.14 中。 表 28.10: Environment × Sex × Clothing 三向最小二乘均值 x 表 28.11: Environment 和 Time 的双向最小二乘均值 x 通过查看表 28.12 中的比较可以发现，在不同 Environment × Sex 的每一种组合下，Clothing 类型都有显著差异；进一步分析表 28.13 表明，在每一种 Environment × Clothing 类型的组合中，男性和女性之间存在显著差异。最后，对表 28.14 的考察揭示了只有在 Sex = 1 且 Clo = 2 的情况下，Environment 1 和 2 才有显著差异；Sex = 2 且 Clo = 1 的情况下也是如此。 表 28.12: 不同 Environment × Sex 组合下 Clothing 类型的比较 x 表 28.13: 不同 Environment × Clothing 类型组合下 Sex 的比较 x 表 28.14: 不同 Sex × Clothing 类型组合下 Environment 的比较 x 如果要对 Environment × Time 这九种组合进行所有可能的成对比较，总共需要进行 36 次比较。但其中可能只有 18 次比较对实验者有意义。表 28.15 包含了在每个时间段内（这些均值是对 reps, Sex 和 clothing 进行平均后的结果）各 Environment 间的均值比较，而表 28.16 则包含了在每个环境下（这些均值同样是对 reps, Sex 和 clothing 进行平均后的结果）各个时间段的均值比较。通过观察表 28.15 可知，在 time 1 时，Environment 1 与 2, 3 都有显著差异，而 Environment 2 与 3 之间没有显著差异。在 time 2 和 3 时，这三个 Environment 彼此间均无显著差异。进一步分析表 28.16 可知，对于 Environment 1和 2 来说，所有 time 之间的差异都是显著的；而对于 Environment 3 而言，其在任何 time 之间都没有显著差异。 表 28.15: 每个时间点环境间的比较 x 表 28.16: 每环境下时间之间的比较 x 显示每次比较的 time 均值的图如图 28.1 所示。该图是由表 28.17 中所示的 SAS 命令创建的。对图的检查说明了有关表 28.16 的 time 比较的陈述。 图 28.1: 每种环境下响应随时间的变化 表 28.17: 获得每种环境下时间比较的图形的额外 SAS 语句 x 28.2 家庭态度实验 农村和城市环境中家庭的态度在三个时间段内每六个月测量一次。这些数据来自七个农村家庭和十个城市家庭，每个家庭都由一个儿子、一个父亲和一个母亲组成。数据在表 28.18 中给出。注意，在这个例子中，有两组重复测量数据，即三个时间段和三个家庭成员。家庭成员是一个重复测量，因为不能随机地将父亲、母亲和儿子分配给三个家庭成员。这个实验可以描述为一个完全随机设计的单向实验，包含两组重复测量数据，即家庭成员和嵌套在家庭成员中的时间。 表 28.18: 家庭态度研究数据 x 本实验的处理结构是三向处理结构，因素为地区（A：农村与城市）、家庭成员（M：儿子、父亲、母亲）和时间（T：1, 2, 3）。设计结构是完全随机设计，有两组重复测量。可代表该实验的一个模型由下式给出 \\[\\begin{align} y_{ijk\\ell}&amp;=\\mu+A_i+\\eta_{i\\ell}+M_j+(AM)_{ij}+\\delta_{ij\\ell}+T_k+(AT)_{ik}+(MT)_{jk}+(AMT)_{ijk}+\\varepsilon_{ijk\\ell}\\\\&amp;i=1,2;~j=1,2,3;~k=1,2,3 \\tag{28.3} \\end{align}\\] 在两组重复测量的时间的裂区假设下，令 \\(\\eta_{i\\ell}\\) 表示随机家庭效应且假设 \\(\\eta_{i\\ell}\\thicksim i.i.d.~N(0,~\\sigma_\\eta^2)\\)，\\({\\delta_{ijk\\ell}}\\) 表示随机人效应且假设 \\({\\delta_{ijk\\ell}}\\sim{N}(0,{\\sigma_\\delta^2})\\)，\\({\\varepsilon}_{ijk\\ell}\\) 表示给定时间段的测量误差且假设 \\({\\varepsilon_{ijk\\ell}}\\sim i.i.d.N(0,{\\sigma_{\\varepsilon}^{2}})\\). 在上述假设下执行分析的 SAS-Mixed 命令如表 28.19 所示。然而，如果读者愿意，则由他们来执行此分析。使用表 28.19 中的命令进行的分析与裂区实验的分析类似。参见示例 24.5。 表 28.19: 用于分析表 28.18 中日期的 SAS 命令，假设两组重复测量都满足时间的裂区假设 x 本节中考虑的分析将考虑模型 \\[\\begin{align} y_{ijk\\ell}&amp;=\\mu+A_i+M_j+(AM)_{ij}+T_k+(AT)_{ik}+(MT)_{jk}+(AMT)_{ijk}+\\varepsilon_{ijk\\ell}\\\\&amp;i=1,2;~j=1,2,3;~k=1,2,3 \\tag{28.4} \\end{align}\\] 令 \\[ \\boldsymbol \\varepsilon_{i\\ell}=\\begin{bmatrix}\\varepsilon_{i11\\ell}\\\\ \\varepsilon_{i12\\ell}\\\\ \\varepsilon_{i13\\ell}\\\\ \\varepsilon_{i21\\ell}\\\\ \\varepsilon_{i22\\ell}\\\\ \\varepsilon_{i23\\ell}\\\\ \\varepsilon_{i31\\ell}\\\\ \\varepsilon_{i32\\ell}\\\\ \\varepsilon_{i33\\ell}\\end{bmatrix} \\] 为第 i 个地区第 \\(\\ell\\) 个家庭的误差向量。 假设 \\(\\boldsymbol \\varepsilon_{i\\ell}\\sim N(\\boldsymbol 0,\\boldsymbol \\Sigma)\\)，统计分析将依赖于 \\(\\boldsymbol \\Sigma\\) 的结构。协方差阵 \\(\\boldsymbol \\Sigma\\) 为 9 × 9 的矩阵。这种设置忽略了重复测量的嵌套结构，并简单地假设有九个重复测量，并且第 27 章中考虑的所有结构在这里都是可能的。考虑到重复测量的嵌套的结构作了如下假设 \\[ \\boldsymbol \\varepsilon_{i\\ell}=\\operatorname{Var}\\left(\\begin{bmatrix}\\varepsilon_{i11\\ell}\\\\ \\varepsilon_{i12\\ell}\\\\ \\varepsilon_{i13\\ell}\\\\ \\varepsilon_{i21\\ell}\\\\ \\varepsilon_{i22\\ell}\\\\ \\varepsilon_{i23\\ell}\\\\ \\varepsilon_{i31\\ell}\\\\ \\varepsilon_{i32\\ell}\\\\ \\varepsilon_{i33\\ell}\\end{bmatrix}\\right)=\\begin{bmatrix}{\\theta}_{11}\\boldsymbol{V}&amp;{\\theta}_{12}\\boldsymbol{V}&amp;{\\theta}_{13}\\boldsymbol{V}\\\\{\\theta}_{21}\\boldsymbol{V}&amp;{\\theta}_{22}\\boldsymbol{V}&amp;{\\theta}_{23}\\boldsymbol V\\\\{\\theta}_{31}\\boldsymbol{V}&amp;{\\theta}_{32}\\boldsymbol{V}&amp;{\\theta}_{33}\\boldsymbol{V}\\end{bmatrix}=\\boldsymbol{\\Theta}\\otimes\\boldsymbol{V}\\mathrm{~(say)} \\] 其中 \\(\\boldsymbol{\\Theta}\\otimes\\boldsymbol{V}\\) 表示如下两个方差协方差阵的直积 (direct product)： \\[\\boldsymbol{\\Theta}=\\begin{bmatrix}\\theta_{11}&amp;\\theta_{12}&amp;\\theta_{13}\\\\\\theta_{21}&amp;\\theta_{22}&amp;\\theta_{23}\\\\\\theta_{31}&amp;\\theta_{32}&amp;\\theta_{33}\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{V}=\\begin{bmatrix}v_{11}&amp;v_{12}&amp;v_{13}\\\\v_{21}&amp;v_{22}&amp;v_{23}\\\\v_{31}&amp;v_{32}&amp;v_{33}\\end{bmatrix}\\] 当 \\(\\boldsymbol{\\Theta}\\) 是非结构化且 \\(\\boldsymbol{V}\\) 具有复合对称性、AR(1) 或非结构化时，SAS-Mixed 程序将允许用户选择此类协方差结构。将数据如同裂区实验一样分析相当于假设 \\(\\boldsymbol{\\Theta}\\) 和 \\(\\boldsymbol{V}\\) 都满足复合对称结构。 表 28.18 中的数据在四种不同的协方差结构下进行了分析，前三个是通过取对应于家庭成员的协方差阵和对应于时间的协方差阵的直积获得的。家庭成员考虑的结构是非结构化的，时间考虑的结构是复合对称、AR(1) 和非结构化。考虑的第四个协方差结构是非结构化 9 × 9 协方差阵，它将家庭成员和时间的所有组合视为九次重复测量。检查所得的拟合统计量，以确定在比较地区、家庭成员和时间的固定效应以及这些效应的所有可能的交互作用时要考虑的最佳协方差结构。表 28.20 中给出了所使用的 SAS-Mixed 命令，表 28.21 为续表。可能会注意到，所有分析中都使用了选项 DDFM = BETWITHIN，而不是 DDFM = KR。对于获得的拟合统计量，使用这两个选项中的哪一个并不重要。然而，如果要考虑对直积协方差结构下的固定效应进行检验，则使用 DDFM = KR 无法给出合理的结果，因为 9 × 9 协方差阵估计在直积结构下是奇异的。表 28.22 给出了拟合统计结果。在假设 \\(\\boldsymbol{V}\\) 具有复合对称性或 AR(1) 的两种情况下，Mixed 程序不会产生任何结果，因为获得了无限的似然值。发生这种情况的原因似乎是 Mixed 程序选择的协方差参数的默认起始值。包含 PARMS 选项以强制 Mixed 程序以不同的起始值开始。语句 PARMS 10, 1, 10, 1, 1, 10, .5; 为下列矩阵 \\[{\\boldsymbol\\Theta}=\\begin{bmatrix}{\\theta}_{11}&amp;{\\theta}_{12}&amp;{\\theta}_{13}\\\\{\\theta}_{21}&amp;{\\theta}_{22}&amp;{\\theta}_{23}\\\\{\\theta}_{31}&amp;{\\theta}_{32}&amp;{\\theta}_{33}\\end{bmatrix}\\quad\\mathrm{and}\\quad{\\boldsymbol V}=\\begin{bmatrix}1&amp;{\\rho}&amp;{\\rho}\\\\{\\rho}&amp;1&amp;{\\rho}\\\\{\\rho}&amp;{\\rho}&amp;1\\end{bmatrix}\\] 选择参数的起始值：\\(\\theta_{11}=10,\\theta_{21}=1,\\theta_{22}=10,\\theta_{31}=1,\\theta_{32}=1,\\theta_{33}=10,\\rho=0.5\\). 不失一般性，\\(\\boldsymbol{V}\\) 中的对角线元可以视为等于 1。相同的起始值也用于 \\(\\boldsymbol{V}\\) 具有 AR(1) 结构时的情况。在这种情况下 \\[\\boldsymbol{V}=\\begin{bmatrix}1&amp;{\\rho}&amp;{\\rho}^2\\\\{\\rho}&amp;1&amp;{\\rho}\\\\{\\rho}^2&amp;{\\rho}&amp;1\\end{bmatrix}\\] 同样不失一般性，\\(\\boldsymbol{V}\\) 中的对角线元素可以视为等于 1. 表 28.20: 用于比较协方差结构的 SAS 命令 x 表 28.21: 用于比较协方差结构的 SAS 命令（续） x 检查表 28.22 中的 AIC, AICC 和 BIC 值发现，当 \\(\\boldsymbol{\\Theta}\\) 是非结构化的，\\(\\boldsymbol{V}\\) 具有复合对称性时，协方差结构 \\(\\boldsymbol{\\Theta}\\otimes\\boldsymbol{V}\\) 这三个准则在下均达到了各自的最小值。这就是用于考虑固定效应参数推断的假设。 表 28.22: 家庭态度数据的拟合统计量 x 为了获得固定效应的检验，表 28.23 中给出了 SAS-Mixed 命令。由于 SAS-Mixed 程序按字母顺序对 Classes 语句中的变量进行排序，因此在此分析之前对数据进行了排序。对数据进行排序有助于将协方差参数估计与适当的家庭成员相匹配。协方差参数的估计值如表 28.24 所示。注意到 \\[\\hat{{\\boldsymbol\\Theta}}=\\begin{bmatrix}\\hat{{\\theta}}_{_{FF}}&amp;\\hat{{\\theta}}_{_{FM}}&amp;\\hat{{\\theta}}_{_{FS}}\\\\\\hat{{\\theta}}_{_{MF}}&amp;\\hat{{\\theta}}_{_{MM}}&amp;\\hat{{\\theta}}_{_{MS}}\\\\\\hat{{\\theta}}_{_{SF}}&amp;\\hat{{\\theta}}_{_{SM}}&amp;\\hat{{\\theta}}_{_{SS}}\\end{bmatrix}=\\begin{bmatrix}8.1570&amp;2.7308&amp;1.2415\\\\2.7508&amp;9.7410&amp;2.6035\\\\1.2415&amp;2.6035&amp;14.7547\\end{bmatrix}\\quad\\mathrm{and}\\quad\\hat{{\\rho}}=0.9637\\] \\(\\hat{{\\boldsymbol\\Theta}}\\) 中的下标已更改为对应于父亲 (F)、母亲 (M) 和儿子 (S)。表 28.25 中给出了 9 × 9 协方差矩阵 \\(\\boldsymbol{\\Theta}\\otimes\\boldsymbol{V}\\) 的估计结果，表 28.26 中展示了对固定效应的检验。 表 28.23: 用于获得固定效应检验表和协方差参数估计的 SAS 命令 x 表 28.24: 协方差参数估计 x 表 28.25: 每个家庭下的协方差阵估计 x 对表 28.26 的检查表明，A, M, T 和 A × T 具有统计显著性。为了探究这些效应，我们应该看看家庭成员 (M) 的主效应均值和地区与时间的双向均值 (A × T). 表 28.26: 固定效应检验 x 表 28.27 所展示了用于计算相应的最小二乘均值并在它们之间进行成对比较的 SAS-Mixed 命令。这些命令应附加到表 28.23 中的命令中。 M 和 A × T 的最小二乘均值分别显示在表 28.28 和 28.29 中。表 28.30 - 28.32 给出了这些均值之间有趣的成对比较。对表 28.28 和 28.30 的检查表明，儿子的均值显著小于父母的均值，并且父亲和母亲的均值彼此没有显著差异。 表 28.27: 用于获得最小二乘均值及其之间的成对比较的额外 SAS 命令 x 表 28.28: 家庭成员最小二乘均值 x 对表 28.29 的检查表明，农村家庭和城市家庭的均值随着时间的推移而增加。然而，对表 28.31 的检查显示，农村家庭的 0 个月和 6 个月均值没有显著差异，但均显著小于 12 个月均值。对于城市家庭来说，所有时间均值彼此均有显著差异。对表 28.32 的检验表明，城市家庭在 0 个月和 12 个月时的均值显著小于农村家庭。农村家庭与城市家庭 6 个月均值的差异不足以达到 0.05 水平的显著性。 表 28.29: 地区和时间组合的双向最小二乘均值 x 表 28.30: 家庭成员比较 x 表 28.31: 每个地区内的时间比较 x 表 28.32: 每个时间下的地区比较 x 28.3 多地点研究 本节考虑涉及三种药物的实验，其中每个个体在三个不同的时间点重复测量。数据由三名不同的研究人员（或在三个不同的中心）收集。数据如表 28.33 所示。请注意，有很多缺失的数据点，如空单元格所示。 表 28.33: 多地点药物实验 x 该分析假设中心 (center) 和个体是随机效应，药物和时间是固定效应。如果假设重复测量满足时间的裂区假设，则表 28.33 中数据的模型为 \\[\\begin{equation} y_{ijk\\ell}=\\mu+\\eta_i+D_j+\\delta_{ij\\ell}+T_k+(DT)_{jk}+\\varepsilon_{ijk\\ell} \\tag{28.5} \\end{equation}\\] 其中 \\(D_j\\) 表示第 j 种药物，\\(T_k\\) 表示地 k 个时间效应，\\((DT)_{ij}\\) 表示时间与药物的交互作用。此外，\\(\\eta_i\\) 表示中心随机效应且假设 \\(\\eta_i\\thicksim i.i.d.N(0,\\sigma_\\eta^2)\\)，\\(\\delta_{ij\\ell}\\) 表示第 i 个中心的第 j 种药物的第 \\(\\ell\\) 个个体的随机个体效应，且假设 \\({\\delta}_{ij\\ell}\\thicksim N(0,{\\sigma}_\\delta^2)\\). 最后，\\(\\varepsilon_{ijk\\ell}\\) 表示与第 i 个中心的第 j 种药物的第 \\(\\ell\\) 个个体第 i 个中心的第 j 种药物的第 \\(\\ell\\) 个个体的第 \\(\\ell\\) 个时间相关的随机误差，且假设 \\(\\varepsilon_{ijk\\ell}\\sim i.i.d.N(0,\\sigma_{\\varepsilon}^2)\\). 还假设所有随机效应都是独立分布的。 如果时间的裂区假设不合适，则模型将为 \\[\\begin{equation} y_{ijk\\ell}=\\mu+\\eta_i+D_j+T_k+(DT)_{jk}+\\varepsilon_{ijk\\ell} \\tag{28.6} \\end{equation}\\] 其中假设 \\(\\eta_i\\thicksim i.i.d.N(0,\\sigma_\\eta^2)\\) 以及 \\[\\left.{\\boldsymbol\\varepsilon}_{ij\\ell}=\\begin{bmatrix}{\\varepsilon}_{ij1\\ell}\\\\{\\varepsilon}_{ij2\\ell}\\\\{\\varepsilon}_{ij3\\ell}\\end{bmatrix}\\thicksim N_3\\left(\\begin{bmatrix}0\\\\0\\\\0\\end{bmatrix}\\right.,\\begin{bmatrix}{\\sigma}_{11}&amp;{\\sigma}_{12}&amp;{\\sigma}_{13}\\\\{\\sigma}_{21}&amp;{\\sigma}_{22}&amp;{\\sigma}_{23}\\\\{\\sigma}_{31}&amp;{\\sigma}_{32}&amp;{\\sigma}_{33}\\end{bmatrix}\\right)\\thicksim N_3(\\boldsymbol{0},{\\boldsymbol\\Sigma})\\text{ (say)}\\] 分析将取决于 \\(\\boldsymbol\\Sigma}\\) 的假设结构。请注意，式 (28.6) 中的模型与 (28.5) 中的模型相同，只是与个体对应的随机效应 \\(\\delta_{ij\\ell}\\) 已从模型中删除。人们可能还希望将人作为某些 \\(\\boldsymbol\\Sigma}\\) 的随机效应，例如当 \\(\\boldsymbol\\Sigma}\\) 具有 AR(1) 结构时。 考虑了重复测量的四种协方差结构：非结构化、复合对称、AR(1) 和 AR(1) 加随机个体效应。对于非结构化假设，BIC 准则最小，而对于 AR(1) 加随机个体效应结构，AIC 和 AICC 都是最小的。对于后一种结构，\\(\\rho\\) 的估计为 –0.3141，从哲学角度来看这似乎没有意义，因为这意味着第一个和第二个时间点之间的相关性为负，但第一和第三个时间点间的相关性是正的，这似乎不合理。因此，通过假设重复测量具有非结构化协方差结构，可以获得对固定效应的推断。 表 28.34 中给出了用于获得固定效应推断的 SAS-Mixed 命令。协方差参数的估计如表 28.35 所示，混合效应的假设检验如表 28.36 所示。对表 28.36 的检查表明，药物和时间的主效应都是显著的，而药物与时间交互效应不显著。因此，可以在药物和时间的主效应均值之间进行比较。表 28.37 给出了药物主效应均值，表 28.38 给出了药物主效应均值之间的成对比较。对这两个表的检查表明，药物 1 的均值显著小于药物 2 的均值和药物 3 的均值。此外，药物 2 和药物 3 的均值之间没有显著差异。表 28.39 给出了时间主效应均值，表 28.40 给出了时间均值之间的成对比较。时间均值着随着时间的推移而增加，所有成对比较都具有统计学意义。 表 28.34: 用于分析表 28.33 中数据的 SAS 命令 x 表 28.35: 协方差参数估计 x 表 28.36: 固定效应假设检验 x 表 28.37: 药物最小二乘均值 x 表 28.38: 药物主效应均值的成对比较 x 表 28.39: 时间最小二乘均值 x 表 28.40: 时间主效应均值的成对比较 x 28.4 练习 "],["chap29.html", "第 29 章 交叉设计的分析 29.1 定义，假设和模型 29.2 两时期/两处理交叉设计 29.3 具有两个以上时期的交叉设计 29.4 具有两种以上处理的交叉设计 29.5 小结", " 第 29 章 交叉设计的分析 交叉设计 (crossover design) 用于比较按序列给予实验单元（如动物或人）的处理。也就是说，每个实验单元按照预定的序列进行每种处理。交叉设计的目的是通过观察应用于同一实验单元的处理，消除比较处理时实验单元之间的差异。 尽管交叉设计消除了处理比较中实验单元之间的差异，但其他问题可能会以延滞 (carryover) 或残余 (residual) 效应的形式出现。例如，当首先给予处理 \\(A\\) 并且在应用处理 \\(B\\) 时其效应尚未消失，就会出现延滞效应。如果 \\(A\\) 的滞留效应 (lingering effect) 干扰了个体对处理 \\(B\\) 的响应（或正向或负向），那么处理 \\(A\\) 对处理 \\(B\\) 有残余效应。 交叉设计模型必须包含序列效应、时期效应、处理效应、延滞效应、实验单元误差项和时间间隔误差项。第一节讨论了一般模型及其假设，最后两节分别讨论了两个时期和两个以上时期两个处理的交叉设计。 在一般的交叉设计中，比较 \\(t\\) 个处理，其中在每个实验单元上观察每个处理；也就是说，这些处理以特定的序列应用于实验单元。实验者构建 \\(t\\) 个处理的 \\(s\\) 个序列，并将实验单元随机分配给第 \\(i\\) 个序列。表 29.1 包含一组可应用于实验单元的三种处理的序列。将序列分配给个体（可能的实验单元）意味着个体是序列的实验单元；将处理分配给时间间隔意味着该时间间隔是处理的实验单元。 表 29.1: 对实验单元应用三种处理（A、B 和 C）的可能序列集 x 29.1 定义，假设和模型 描述在第 \\(i\\) 个时期内分配给第 \\(j\\) 个序列的第 \\(\\ell\\) 只动物的观测结果的响应的模型为 \\[\\begin{align} y_{ijk\\ell}&amp;=\\mu+S_i+\\delta_{i\\ell}+P_j+T_k+\\varepsilon_{ijk\\ell}\\\\i&amp;=1,2,\\ldots,s,j=1,2,\\ldots,p,k=1,2,\\ldots,t,\\mathrm{~and~}\\ell=1,2,\\ldots,n_j \\tag{29.1} \\end{align}\\] 在上述模型中，\\(S_i\\) 是第 \\(i\\) 个序列的效应，\\(P_j\\) 是第 \\(j\\) 个时期的效应，\\(T_k\\) 是第 \\(k\\) 个处理的效应，其中 \\(k\\) 的值由第 \\(i\\) 个序列和第 \\(j\\) 个时期的 \\(i,j\\) 组合确定。在理想条件下，将有 \\(\\delta_{i\\ell}\\sim i.i.d.N(0,\\sigma_{\\delta}^{2}),\\varepsilon_{ijk\\ell}\\sim i.i.d.N(0,\\sigma_{\\varepsilon}^{2})\\)，并且所有 \\(\\delta_{i\\ell}\\) 和 \\(\\varepsilon_{ijk\\ell}\\) 彼此独立。 误差项 \\(\\delta_{i\\ell}\\) 和 \\(\\varepsilon_{ijk\\ell}\\) 的理想条件对于进行适当的分析非常重要。由于实验单元是随机分配给序列的，因此适当的假设是 \\(\\delta_{i\\ell}\\sim i.i.d.N(0,\\sigma_{\\delta}^{2})\\). 由于 \\(\\varepsilon_{ijk\\ell}\\) 是时间间隔的误差，并且在某种意义上是重复测量误差，因此这些误差可能不是独立分布的。上面给出的理想条件相当于假设时间时期误差的协方差阵满足复合对称条件（参见 27.1 节）。在这种情况下，可以使用通常的独立的 \\(\\delta_{i\\ell}\\) 和 \\(\\varepsilon_{ijk\\ell}\\) 方差分析方法来分析观测数据。复合对称性假设对于两时期设计是必须满足的，对于许多三时期设计也可能是满足的。时间序列误差结构可能更适合具有三个或更多时期的交叉设计，并且应该使用第 27 章中讨论的方法。 两时期/两处理交叉设计 (two-period/two-treatment crossover design) 在 29.2 节中描述，具有两个以上处理或两个以上时期的设计在 29.3 和 29.4 节中描述。 29.2 两时期/两处理交叉设计 考虑具有两个处理序列（\\(AB\\) 和 \\(BA\\)）的两时期/两处理交叉设计，其中 \\(AB\\) 意味着处理 \\(A\\) 在第 \\(1\\) 时期分配到一个实验单元，处理 \\(B\\) 在第 \\(2\\) 时期分配到同一实验单元。同样，\\(BA\\) 序列意味着处理 \\(B\\) 在时期 \\(1\\) 被分配到实验单元，处理 \\(A\\) 在时期 \\(2\\) 被分配给相同的实验单元。还假设有 \\(n_1\\) 个实验单元分配给 \\(AB\\) 序列，且有 \\(n_2\\) 个实验单元分配给 \\(BA\\) 序列。令观测到的响应的模型为 \\[\\begin{align} y_{ijk\\ell}&amp;=\\mu+S_i+\\delta_{i\\ell}+P_j+T_k+\\varepsilon_{ijk\\ell}\\\\i&amp;=AB,BA,~j=1,2,~k=A,B,~\\mathrm{and}~\\ell=1,2,\\ldots,n_i \\tag{29.2} \\end{align}\\] 其中下标 \\(k\\) 的值由序列 \\(i\\) 和时期 \\(j\\) 的组合确定。令 \\[\\mu_{ij}=\\mu+S_i+P_j+T_k\\] 是对应于第 \\(i\\) 个序列和第 \\(j\\) 个时期的单元均值的模型。令 \\(\\hat \\mu_{ij}\\) 为第 \\((i,j)\\) 单元格中所有观测值的观测均值。注意到 \\[\\begin{align} \\hat \\mu_{11}=\\bar y_{11\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+P_1+T_A\\\\ \\hat \\mu_{12}=\\bar y_{12\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+P_2+T_B\\\\ \\hat \\mu_{21}=\\bar y_{21\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+P_1+T_B\\\\ \\hat \\mu_{22}=\\bar y_{22\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+P_2+T_A \\tag{29.3} \\end{align}\\] 从式 (29.3) 可看出 \\[\\begin{align} \\hat {\\bar\\mu}_{1\\cdot}&amp;=\\frac{\\bar y_{11\\cdot\\cdot}+\\bar y_{12\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+\\bar P_\\cdot+\\frac{T_A+T_B}{2}\\\\ \\hat {\\bar\\mu}_{2\\cdot}&amp;=\\frac{\\bar y_{21\\cdot\\cdot}+\\bar y_{22\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+\\bar P_\\cdot+\\frac{T_A+T_B}{2}\\\\ \\hat {\\bar\\mu}_{\\cdot 1}&amp;=\\frac{\\bar y_{11\\cdot\\cdot}+\\bar y_{21\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+\\bar S_{\\cdot}+\\bar P_1+\\frac{T_A+T_B}{2}\\\\ \\hat {\\bar\\mu}_{\\cdot 2}&amp;=\\frac{\\bar y_{12\\cdot\\cdot}+\\bar y_{22\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+\\bar S_{\\cdot}+\\bar P_2+\\frac{T_A+T_B}{2} \\tag{29.4} \\end{align}\\] 另请注意，两个序列的均值差 \\(\\hat {\\bar\\mu}_{1\\cdot}-\\hat {\\bar\\mu}_{2\\cdot}\\) 估计 \\(S_{AB} - S_{BA}\\)，即两个序列参数之差。时期 \\(1\\) 和时期 \\(2\\) 的均值差 \\(\\hat {\\bar\\mu}_{\\cdot1}-\\hat {\\bar\\mu}_{\\cdot2}\\) 估计 \\(P_1 - P_2\\). 最后，为了估计两种处理之差 \\(T_A - T_B\\)，可以使用 \\((\\hat {\\bar\\mu}_{11}-\\hat {\\bar\\mu}_{12}-\\hat {\\bar\\mu}_{21}+\\hat {\\bar\\mu}_{22})/2\\) 。在理想条件下，可以证明 \\[\\begin{equation} \\begin{bmatrix}\\hat{\\mu}_{11}\\\\\\hat{\\mu}_{12}\\\\\\hat{\\mu}_{21}\\\\\\hat{\\mu}_{22}\\end{bmatrix}\\thicksim N\\left(\\begin{bmatrix}\\mu_{11}\\\\\\mu_{12}\\\\\\mu_{21}\\\\\\mu_{22}\\end{bmatrix},\\,\\begin{bmatrix}\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\delta^2}{n_1}&amp;0&amp;0\\\\\\\\\\frac{\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\epsilon^2+\\sigma_\\delta^2}{n_1}&amp;0&amp;0\\\\\\\\0&amp;0&amp;\\frac{\\sigma_\\epsilon^2+\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\delta^2}{n_2}\\\\\\\\0&amp;0&amp;\\frac{\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\epsilon^2+\\sigma_\\delta^2}{n_2}\\end{bmatrix}\\right) \\tag{29.5} \\end{equation}\\] 从式 (29.5) 可证明 \\[\\begin{aligned}&amp;\\hat{\\bar{\\mu}}_{1\\cdot}-\\hat{\\bar{\\mu}}_{2\\cdot}\\thicksim N\\bigg[S_{AB}-S_{BA},\\bigg(\\frac{\\sigma_{\\varepsilon}^{2}+2\\sigma_{\\delta}^{2}}{2}\\bigg)\\bigg(\\frac{1}{n_{1}}+\\frac{1}{n_{2}}\\bigg)\\bigg]\\\\&amp;\\hat{\\bar{\\mu}}_{\\cdot1}-\\hat{\\bar{\\mu}}_{\\cdot2}\\thicksim N\\bigg[P_1-P_2,\\frac{\\sigma_{\\varepsilon}^{2}}{2}\\bigg(\\frac{1}{n_1}+\\frac{1}{n_2}\\bigg)\\bigg]\\\\&amp;\\frac{\\hat\\mu_{11}-\\hat\\mu_{12}-\\hat\\mu_{21}+\\hat\\mu_{22}}{2}\\thicksim N\\bigg[T_A-T_B,\\frac{\\sigma_{\\varepsilon}^{2}}{2}\\bigg(\\frac{1}{n_1}+\\frac{1}{n_2}\\bigg)\\bigg]\\end{aligned}\\] 与本节讨论的两期/两处理交叉设计相对应的方差分析表的形式如表 29.2 所示。用于检验 \\(H_0: T_A = T_B\\) 的 \\(F\\) 统计量由 \\(F = TMS/WSEMS\\) 给出，其中 \\(TMS\\) 是表 29.2 中的处理均方 (treatment mean square)，\\(WSEMS\\) 是个体内误差均方 (within subject error mea square). 若 \\(F&gt;F_{\\alpha,1,n_1+n_2-2}\\) 则拒绝 \\(H_0\\). \\(T_A-T_B\\) 的 \\((1-\\alpha)100\\%\\) 置信区间由 \\[\\frac{\\hat{\\mu}_{11}-\\hat{\\mu}_{12}-\\hat{\\mu}_{21}+\\hat{\\mu}_{22}}2\\pm t_{\\alpha,v}\\sqrt{\\frac{\\hat\\sigma_{\\varepsilon}^2}2{\\left(\\frac1{n_1}+\\frac1{n_2}\\right)}}\\] 给出。其中 \\(v=n_1+n_2-n\\) 且 \\(\\hat\\sigma_\\varepsilon^2=WSEMS\\). 作为一个例子，考虑 Grizzle (1965) 使用的数据。数据如表 29.3 所示。使用表 29.4 中所示的命令通过 SAS®-GLM 程序分析数据。 表 29.2: 两期/两处理交叉实验的方差分析表 x 表 29.3: Grizzle (1965) 数据 Seq Period Trt Person Y AB 1 A 11 0.2 AB 2 B 11 1 AB 1 A 12 0 AB 2 B 12 -0.7 AB 1 A 13 -0.8 AB 2 B 13 0.2 AB 1 A 14 0.6 AB 2 B 14 1.1 AB 1 A 15 0.3 AB 2 B 15 0.4 AB 1 A 16 1.5 AB 2 B 16 1.2 BA 1 B 21 1.3 BA 2 A 21 0.9 BA 1 B 22 -2.3 BA 2 A 22 1 BA 1 B 23 0 BA 2 A 23 0.6 BA 1 B 24 -0.8 BA 2 A 24 -0.3 BA 1 B 25 -0.4 BA 2 A 25 -1 BA 1 B 26 -2.9 BA 2 A 26 1.7 BA 1 B 27 -1.9 BA 2 A 27 -0.3 BA 1 B 28 -2.9 BA 2 A 28 0.9 表 29.4: 用于分析表 29.3 中数据的 SAS-GLM 代码 x 表 29.5 显示了模型的方差分析，并给出了 \\(WSEMS\\) 的值 \\(\\hat \\sigma_\\varepsilon^2 = 1.245\\). 表 29.6 给出了 \\(H_0:T_A = T_B\\) 的检验： 以及个体间误差均方 \\(BSEMS = \\hat \\sigma_{\\varepsilon} ^2 + 2\\hat \\sigma_{\\delta}^2 = 1.001\\). \\(H_0\\) 观察到的显著性水平为 \\(\\hat \\alpha = 0.1165\\). 表 29.7 中显示了处理 \\(A\\) 和 \\(B\\) 的最小二乘均值，以及比较处理 \\(A\\) 和处理 \\(B\\) 时观察到的显著性水平 \\(\\hat \\alpha = 0.1165\\)。方差分析表中各行的预期均方如表 29.8 所示。如果想求出双向序列×时期的估计值，可以使用表 29.9 中的命令。双向均值如表 29.10 所示。 表 29.5: 具有个体内误差均方的模型方差分析 x 表 29.6: 表 29.3 中数据的 III 型方差分析表 x 表 29.7: 处理主效应均值 x 表 29.8: 表 29.3 中数据的预期均方表 x 表 29.9: 用于分析表 29.3 中数据的 SAS-GLM 代码 x 表 29.10: 序列×时期均值 x 表 29.3 中的数据也可以使用表 29.11 中所示的命令通过 SAS Mixed 程序进行分析。由于 GLM 分析中受试者间误差均方小于受试者内误差均方，因此结果与 GLM 分析获得的结果略有不同。因此，Mixed 程序将与个体相对应的方差分量估计为 \\(\\hat \\sigma _\\delta ^2 = 0\\)，而 GLM 将使用矩准则方法估计相同的方差分量： \\[\\hat\\sigma_\\delta^2=\\frac{BSEMS-WSEMS}2=\\frac{1.005-1.245}2=\\frac{-0.240}2=-0.120\\] 目前未给出使用表 29.11 中的代码的结果，感兴趣的读者需要运行表 29.11 中的代码。 表 29.11: 用于分析表 29.3 中数据的 SAS-Mixed 代码 x 上述分析假设第一时期的处理不会影响第二时期的观测结果。接下来考虑存在延滞的情况。当存在延滞时，可以假设 \\[\\begin{align} \\hat \\mu_{11}=\\bar y_{11\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+P_1+T_A\\\\ \\hat \\mu_{12}=\\bar y_{12\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+P_2+T_B+\\lambda_A\\\\ \\hat \\mu_{21}=\\bar y_{21\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+P_1+T_B\\\\ \\hat \\mu_{22}=\\bar y_{22\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+P_2+T_A+\\lambda_B \\tag{29.6} \\end{align}\\] 其中 \\(\\lambda_A\\) 是序列 \\(AB\\) 的参数，对应于从时期 \\(1\\) 施加的处理 \\(A\\) 到时期 \\(2\\) 的延滞，而 \\(\\lambda_B\\) 是序列 \\(BA\\) 的参数，对应于从时期 \\(1\\) 施加的处理 \\(B\\) 到时期 \\(2\\) 的延滞。 从式 (29.6) 可看出 \\[\\begin{align} \\hat {\\bar\\mu}_{1\\cdot}&amp;=\\frac{\\bar y_{11\\cdot\\cdot}+\\bar y_{12\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+\\bar P_\\cdot+\\frac{T_A+T_B}{2}+\\frac{\\lambda_A}{2}\\\\ \\hat {\\bar\\mu}_{2\\cdot}&amp;=\\frac{\\bar y_{21\\cdot\\cdot}+\\bar y_{22\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+\\bar P_\\cdot+\\frac{T_A+T_B}{2}+\\frac{\\lambda_B}{2}\\\\ \\hat {\\bar\\mu}_{\\cdot 1}&amp;=\\frac{\\bar y_{11\\cdot\\cdot}+\\bar y_{21\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+\\bar S_{\\cdot}+\\bar P_1+\\frac{T_A+T_B}{2}\\\\ \\hat {\\bar\\mu}_{\\cdot 2}&amp;=\\frac{\\bar y_{12\\cdot\\cdot}+\\bar y_{22\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+\\bar S_{\\cdot}+\\bar P_2+\\frac{T_A+T_B}{2}+\\frac{\\lambda_A+\\lambda_B}{2} \\tag{29.7} \\end{align}\\] 当 \\(\\lambda_A\\ne \\lambda_B\\) 时，延滞就存在。也就是说，在无延滞的情况下，\\(\\lambda_A\\) 和 \\(\\lambda_B\\) 实际上不必等于零，它们只需要彼此相等。在 \\(\\lambda_A= \\lambda_B\\) 的情况下，\\(\\lambda_A\\) 和 \\(\\lambda_B\\) 与时期效应混淆 (confounded)，不需要将参数包括在模型中 (29.2) 中。在存在延滞的情况下，两个序列差的均值 \\(\\hat {\\bar\\mu}_{1\\cdot}-\\hat {\\bar\\mu}_{2\\cdot}\\) 估计 \\(S_{AB}-S_{BA}+[(\\lambda_A-\\lambda_B)/2]\\)。时期 \\(1\\) 和时期 \\(2\\) 差的均值 \\(\\hat {\\bar\\mu}_{\\cdot1}-\\hat {\\bar\\mu}_{\\cdot2}\\) 估计 \\(P_1-P_2+[(\\lambda_A+\\lambda_B)/2]\\) 。最后，\\((\\hat{\\mu}_{11}-\\hat{\\mu}_{12}-\\hat{\\mu}_{21}+\\hat{\\mu}_{22})/2\\) 估计 \\(T_A-T_B+[(\\lambda_A-\\lambda_B)/2]\\) 。在存在延滞的情况下，时期 \\(2\\) 的数据无助于估计两种处理的差异。当存在延滞时，必须通过 \\(\\hat \\mu_{11}-\\hat \\mu_{21}\\) 来估计 \\(T_A-T_B\\)，并且该估计仅取决于时期 \\(1\\) 的数据。还可以注意到，如果仅使用时期 \\(1\\) 的数据来估计处理效应，则时期 \\(1\\) 的模型可以简化为 \\[\\begin{equation} y_{k\\ell}=\\mu+T_k+\\varepsilon_{k\\ell}^*,~k=A,B,~\\mathrm{and~}~\\ell=1,2,\\ldots,n_i \\tag{29.8} \\end{equation}\\] 其中 \\(\\varepsilon_{k\\ell}^{*}=\\delta_{k\\ell}+\\varepsilon_{k\\ell}\\). 而且， \\[\\mathrm{Var}(\\hat{\\mu}_{11}-\\hat{\\mu}_{21})=(\\sigma_\\varepsilon^2+\\sigma_\\delta^2){\\left(\\frac1{n_1}+\\frac1{n_2}\\right)}\\] 表 29.12 显示了当存在延滞时，与两时期/两处理交叉设计相对应的方差分析表的形式。该表与表 29.2 具有相同的形式，除了预期均方列。 表 29.12: 两时期/两处理交叉实验的方差分析表 x 如果不存在延滞，那么个体被分配到哪个序列应该无关紧要。也就是说，从哲学上讲，\\(S_{AB}-S_{BA}\\) 应该等于零。因此，\\(F=SeqMS/BSEM\\) 给出的 \\(F\\) 统计量提供了是否存在延滞的测试。如果 \\(F&gt;F_{\\alpha,1,n1+n2-2}\\)，则可以得出结论，存在显著的延滞效应。需要注意的是，延滞检验是个体间的比较，因此该检验的功效不如基于个体内的比较。如果认为可能存在延滞效应，建议不要使用两时期/两处理的交叉设计。在某些情况下，实验者可能能够在交叉设计的两个阶段之间包括所谓的“洗脱” (wash-out) 阶段。洗脱期是指一段足够长的时间，以便在对实验单元进行第二种处理之前，第一时期中给予的处理的任何延滞效应将被消除或清除。同样极其重要的是，要注意在两时期/两处理交叉设计中的延滞问题在一些具有两个以上处理和/或两个以上时期的交叉设计中减少和/或消除。此类设计将在下一节中进行考虑。 作为可能存在延滞的两时期/两处理交叉实验的示例，再次考虑表 29.3 中显示的 Grizzle (1965) 数据。将使用 SAS-Mixed 程序（使用表 29.13 中显示的命令）分析数据。 表 29.13: 用于分析表 29.3 中数据的 SAS-Mixed 代码，当存在延滞时 x 第一组 Mixed 命令用于获得延滞检验和处理效应检验（如果没有任何显著的延滞）。这些命令还给出了处理主效应均值，如果没有延滞，则可以使用该均值。第二组命令使用不同的 random 语句，以获得序列×时期双向均值，包括 ESTIMATE 选项，以便从时期 \\(1\\) 数据中获得处理效应估计值。 表 29.14: 固定效应检验 x 表 29.14 给出了对表 29.13 中第一组 Mixed 命令的固定效应的检验。请注意，序列效应在 \\(0.0665\\) 水平下显著，表明存在一些延滞的证据。还请注意，处理效应仅在 \\(0.1002\\) 水平下显著。 处理主效应平均值见表 29.15，该表还比较了两种处理平均值。 表 29.15: 处理均值及两种处理均值差的检验 x 表 29.16 给出了表 29.13 中第二组 Mixed 命令的固定效应检验。请注意，序列的检验与表 29.14 中给出的检验相同。还请注意，序列×时期的检验与表 29.14 中处理的检验相同。表 29.17 给出了序列×时期均值，表 29.18 给出了仅来自时期 \\(1\\) 数据比较两种处理的检验。表 29.18 的检查显示，在表 29.7 中给出的分析中，延滞效应明显掩盖了部分处理效应，其中假设无延滞，因为处理效应不显著，而仅使用时期 \\(1\\) 数据的比较发现处理存在显著差异。 表 29.16: 固定效应的额外检验 x 表 29.17: 序列×时期双向均值 x 表 29.18: 处理 \\(A\\) 和处理 \\(B\\)，来自时期 \\(1\\) 的估计 x 29.3 具有两个以上时期的交叉设计 当没有延滞时，具有两个以上时期和/或两个以上处理的交叉设计的统计分析是简单的。当满足个体间误差和个体内误差的理想条件时，式 (29.1) 中的模型是合适的。表 29.4，29.9，和 29.11 仍然可以用来获得有用和有趣的统计量。由于没有延滞时的分析是直接的，本节集中讨论存在延滞的情况。 考虑的第一种情况是仍然有两种处理的情况，但涉及具有三个时期的序列。一种可能性是使用两个序列 \\(ABA\\) 和 \\(BAB\\). 对于 \\(ABA\\) 序列，实验单元将在时期 \\(1\\) 接受处理 \\(A\\)，在时期 \\(2\\) 接受处理 \\(B\\)，并在时期 \\(3\\)再次接受处理 \\(A\\). \\(BAB\\) 序列将进行类似处理。另一种可能性是使用两个序列 \\(ABB\\) 和 \\(BAA\\). 第三种可能性是使用所有这四个序列。也就是说，\\(ABA\\)、\\(BAB\\)、\\(ABB\\) 和 \\(BAA\\) 都将被使用。本节重点介绍使用两个序列 \\(ABA\\) 和 \\(BAB\\) 的交叉设计。其他的可能性也可以类似地分析。 表 29.19 确定了与 \\(ABA\\) 和 \\(BAB\\) 交叉设计的序列与时期组合相关的模型参数。 表 29.19: 三时期/两处理交叉设计的单元个均值参数 x 假设 \\(n_1\\) 个个体已被分配到 \\(ABA\\) 序列，\\(n2\\) 个个体已被分配到 \\(BAB\\) 序列。令 \\(y_{ij\\ell}\\) 为在从序列 \\(i\\) 时期 \\(j\\) 的个体 \\(\\ell\\) 中观察到的响应。令 \\(\\hat\\mu _{ij} = \\bar y_{ij\\cdot} , i = 1, 2; j = 1, 2, 3\\). 在式 (29.1) 中给出的模型误差项的理想条件下，可以证明： \\[\\begin{equation} \\begin{bmatrix}\\hat{\\mu}_{11}\\\\\\hat{\\mu}_{12}\\\\\\hat{\\mu}_{13}\\\\\\hat{\\mu}_{21}\\\\\\hat{\\mu}_{22}\\\\\\hat{\\mu}_{23}\\end{bmatrix}\\sim N\\left(\\begin{bmatrix}\\mu_{11}\\\\\\mu_{12}\\\\\\mu_{13}\\\\\\mu_{21}\\\\\\mu_{21}\\\\\\mu_{23}\\end{bmatrix},\\begin{bmatrix}\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\delta^2}{n_1}&amp;0&amp;0&amp;0\\\\\\frac{\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\delta^2}{n_1}&amp;0&amp;0&amp;0\\\\\\frac{\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\epsilon^2+\\sigma_\\delta^2}{n_1}&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\delta^2}{n_2}\\\\0&amp;0&amp;0&amp;\\frac{\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\delta^2}{n_2}\\\\0&amp;0&amp;0&amp;\\frac{\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_2}\\end{bmatrix}\\right) \\tag{29.9} \\end{equation}\\] 注意到对比 $$ \\[\\begin{aligned} \\begin{aligned}\\mu_{11}-\\frac12\\mu_{12}-\\frac12\\mu_{13}-\\mu_{21}+\\frac12\\mu_{22}+\\frac12\\mu_{23}\\end{aligned}&amp; =(\\mu+S_{ABA}+P_1-T_A)-\\frac12(\\mu+S_{ABA}+P_2+T_B+\\lambda_A) \\\\ &amp;-\\frac12(\\mu+S_{ABA}+P_3+T_A+\\lambda_B)-(\\mu+S_{BAB}+P_1+T_B) \\\\ &amp;+\\frac12(\\mu+S_{BAB}+P_2+T_A+\\lambda_B)+\\frac12(\\mu+S_{BAB}+P_3+T_B+\\lambda_A) \\\\ &amp;=T_{A}-T_{B} \\end{aligned}\\] $$ 因此，即使 \\(ABA\\)、\\(BAB\\) 交叉设计中存在延滞，两种处理的直接差异也可以通过下式来估计 \\[\\begin{equation} \\hat{\\mu}_{11}-\\frac12\\hat{\\mu}_{12}-\\frac12\\hat{\\mu}_{13}-\\hat{\\mu}_{21}+\\frac12\\hat{\\mu}_{22}+\\frac12\\hat{\\mu}_{23} \\tag{29.10} \\end{equation}\\] 还注意到 \\[\\begin{equation} \\mathrm{Var}\\left(\\hat{\\mu}_{11}-\\frac12\\hat{\\mu}_{12}-\\frac12\\hat{\\mu}_{13}-\\hat{\\mu}_{21}+\\frac12\\hat{\\mu}_{22}+\\frac12\\hat{\\mu}_{23}\\right)=\\frac32\\sigma_{\\varepsilon}^2\\left(\\frac1{n_1}+\\frac1{n_2}\\right) \\tag{29.11} \\end{equation}\\] 因此，式 (29.11) 中的对比是个体内对比，其方差仅取决于 \\(\\sigma^2_\\varepsilon\\). 一个可能感兴趣的问题是如何定义处理主效应均值？一种可能性是通过对表 29.19 中接受处理 \\(A\\) 的所有单元进行平均来估计 \\(A\\) 的主效应均值。也就是说，\\(A\\) 平均值为 \\((\\mu_{11} + \\mu_{22} + \\mu_{13})/3\\)，\\(B\\) 平均值为 \\((\\mu_{21} + \\mu_{12} + \\mu_{23})/3\\)。根据表 29.19 中定义的效应模型参数，这两个函数分别等于 \\[\\begin{aligned}\\mu+\\frac23S_{ABA}+\\frac13S_{BAB}+\\bar{P}_\\cdot+T_A+\\frac13(\\lambda_B+\\lambda_A)\\\\\\mu+\\frac13S_{ABA}+\\frac23S_{BAB}+\\bar{P}_\\cdot+T_B+\\frac13(\\lambda_A+\\lambda_B)\\end{aligned}\\] 这样的定义没有意义，因为这样的 \\(A\\) 均值和 \\(B\\) 均值的差等于 \\(\\frac{1}{3}S_{ABA}-\\frac{1}{3}S_{BAB}+T_A-T_B\\)，而不等于 \\(T_A-T_B\\). 也就是说，这样定义的 \\(A\\) 均值和 \\(B\\) 均值与序列效应混叠 (aliased). \\(A\\) 主效应均值的第二个定义是 \\[\\mu+\\bar{S}_\\cdot+\\bar{P}_\\cdot+T_A+\\frac13(\\lambda_B+\\lambda_A)\\] \\(B\\) 主效应均值类似地定义为 \\[\\mu+\\bar{S}_\\cdot+\\bar{P}_\\cdot+T_B+\\frac13(\\lambda_B+\\lambda_A)\\] 这样的定义是合理的，因为第一个等于表 29.19 中单元格均值的下列线性函数 \\[\\frac23\\mu_{11}-\\frac1{12}\\mu_{12}-\\frac1{12}\\mu_{13}-\\frac13\\mu_{21}+\\frac5{12}\\mu_{22}+\\frac5{12}\\mu_{23}\\] 第二个等于 \\[-\\frac13\\mu_{11}+\\frac5{12}\\mu_{12}+\\frac5{12}\\mu_{13}+\\frac23\\mu_{21}-\\frac1{12}\\mu_{22}-\\frac1{12}\\mu_{23}\\] 此外，这两个均值之差为 \\[\\mu_{11}-\\frac12\\mu_{12}-\\frac12\\mu_{13}-\\mu_{21}+\\frac12\\mu_{22}+\\frac12\\mu_{23}=T_A-T_B\\] 请注意，这与公式 (29.10) 中给出的单元格均值对比相同。单元格均值内的对比意味着延滞效应是 \\[\\begin{equation} \\mu_{11}-\\mu_{13}-\\mu_{21}+\\mu_{23}=\\lambda_A-\\lambda_B \\tag{29.12} \\end{equation}\\] 该对比估计的方差是 \\[\\begin{equation} \\mathrm{Var}(\\hat{\\mu}_{11}-\\hat{\\mu}_{13}-\\hat{\\mu}_{21}+\\hat{\\mu}_{23})=2\\sigma_{\\varepsilon}^2\\left(\\frac1{n_1}+\\frac1{n_2}\\right) \\tag{29.13} \\end{equation}\\] 且此对比也是个体内对比。 为了举例说明，请考虑表 29.20 中的数据，其中三名个体分配给 \\(ABA\\) 序列，另外三名个体分配给 \\(BAB\\) 序列。因此 \\(n_1 = n_2 = 3\\). 读取数据并计算序列×时期单元格均值的 SAS 代码如表 29.21 所示。单元平均值如表 29.22 所示。 因此，\\(A\\) 主效应平均值的估计由下式给出 \\[\\begin{aligned} \\frac23\\hat{\\mu}_{11}&amp; -\\frac1{12}\\hat{\\mu}_{12}-\\frac1{12}\\hat{\\mu}_{13}-\\frac13\\hat{\\mu}_{21}+\\frac5{12}\\hat{\\mu}_{22}+\\frac5{12}\\hat{\\mu}_{23} \\\\ &amp;=\\frac23(24.133)-\\frac1{12}(26.533)-\\frac1{12}(23.933)-\\frac13(26.367)+\\frac5{12}(26.233)+\\frac5{12}(24.833)=24.372 \\end{aligned}\\] \\(B\\) 主效应平均值的估计由下式给出 \\[\\begin{aligned}-\\frac13\\hat{\\mu}_{11}&amp;+\\frac5{12}\\hat{\\mu}_{12}+\\frac5{12}\\hat{\\mu}_{15}+\\frac23\\hat{\\mu}_{21}-\\frac1{12}\\hat{\\mu}_{22}-\\frac1{12}\\hat{\\mu}_{23}\\\\&amp;=-\\frac13(24.133)+\\frac5{12}(26.533)+\\frac5{12}(23.933)+\\frac23(26.367)-\\frac1{12}(26.233)-\\frac1{12}(24.833)=26.306\\end{aligned}\\] 表 29.20: \\(ABA/BAB\\) 交叉实验的数据 Seq Per Trt Person Y ABA 1 A 1 25.1 ABA 2 B 1 27.6 ABA 3 A 1 24.5 ABA 1 A 2 22 ABA 2 B 2 24.3 ABA 3 A 2 21.6 ABA 1 A 3 25.3 ABA 2 B 3 27.7 ABA 3 A 3 25.7 BAB 1 B 4 25.5 BAB 2 A 4 23.7 BAB 3 B 4 24.9 BAB 1 B 5 27.4 BAB 2 A 5 27.9 BAB 3 B 5 24.6 BAB 1 B 6 26.2 BAB 2 A 6 27.1 BAB 3 B 6 25 表 29.21: 用于获取表 29.20 中数据的序列×时期单元格均值的 SAS 代码 x 表 29.22: 序列×时期单元格均值 x \\(A\\) 均值与 \\(B\\) 均值之差为 \\[\\hat{\\tau}_A-\\hat{\\tau}_B=24.372-26.306=-1.934\\] 人们可以使用 SAS-Mixed 程序来估计处理均值、检验处理差异、检验延滞以及估计两处理/三时期交叉设计的方差分量。例如，为了分析表 29.20 中的数据，必须定义一个新变量来标识前一时期给予的处理。为了不消除第一时期数据，还必须为第一时期数据定义这个新变量。对于 \\(ABA\\) 序列，可以将这个新变量定义为在时期 \\(1\\)、\\(2\\) 和 \\(3\\) 中分别取值为 \\(O\\)、\\(A\\) 和 \\(B\\). 对于 \\(BAB\\) 序列，新变量将分别取值 \\(O\\)、\\(B\\) 和 \\(A\\). 表 29.23 中的 SAS 代码使用了一个名为 PRIORTRT 的新变量，该变量具有前几句中给出的属性。定义了这个新变量的数据如表 29.24 所示。可用于分析表 29.20 中数据的 SAS-Mixed 命令如表 29.25 所示。结果输出如表 29.20 至 29.29 所示。表 29.26 给出了方差分量的估计。从该表中可以看出，\\(\\sigma^2_\\delta=2.1378\\) 和 \\(\\sigma^2_\\varepsilon=0.7872\\). 表 29.27 给出了处理 \\(A\\) 和处理 \\(B\\) 之差的检验。表 29.27 中标记为 Trt 的行是检验 \\(H_{01}:\\tau_A=\\tau_B\\)，标记为 PRIORTRT 的行是检验 \\(H_{02}:\\lambda_A=\\lambda_B\\). 请注意，表 29.27 中标记为 PER 的行只有一个自由度。这可能看起来很奇怪，因为有三个时期。然而，在时期 \\(1\\) 和 \\(\\lambda_0\\) 之间存在完全混淆 (completely confounding)，因此标记为 PER 的行仅比较时期 \\(2\\) 和时期 \\(3\\). 也就是说，标记为 PER 的行检验 \\(H_{03}:P_2=P_3\\). 表 29.25 中的 CONTRAST 选项给出了一个检验统计量，将所有三个时期相互比较；即该 CONTRAST 选项检验 \\(H_{03}:P_1+\\lambda_0=P_2=P_3\\) 的结果。该选项的结果附在表 29.27 的底部。 表 29.23: 为表 29.20 中的数据创建 PRIORTRT 变量的 SAS 代码 x 表 29.24: 打印定义了 PRIORTRT 变量的新数据 x 表 29.25: 分析表 29.24 中数据的 SAS 代码 x 表 29.26: 方差分量估计 x 表 29.27: 固定效应检验 x 处理主效应均值的估计值如表 29.28 所示。请注意，SAS-Mixed 程序给出的值与表 29.22 中使用主效应平均值的第二定义计算的估计值相同。表 29.25 中两个 ESTIMATE 语句的结果如表 29.29 所示。这些估计的第一个 \\(\\tau_A-\\tau_B\\) 给出了估计值的标准误估计，并给出了用于检验 \\(H_{01}:\\tau_A=\\tau_B\\) 的 \\(t\\) 统计量以及检验观察到的显著性水平。第二个 ESTIMATE 语句估计 \\(\\lambda_A-\\lambda_B\\) 给出了估计值的标准误估计，并给出了用于检验 \\(H_{02}:\\lambda_A=\\lambda_B\\) 的 \\(t\\) 统计量以及检验观察到的显著性水平。读者应注意，表 29.29 中观察到的处理差异和延滞差异的显著性水平与表 29.27 中相应的观察到的显著性水平相同。处理差异估计的标准误估计可以通过将 (29.11) 中的 \\(\\sigma_\\varepsilon^2\\) 替换为 \\(\\hat\\sigma_\\varepsilon^2\\) 来计算，即 \\[\\begin{aligned} \\widehat{\\mathrm{Var}}\\left(\\hat{\\mu}_{11}-\\frac12\\hat{\\mu}_{12}-\\frac12\\hat{\\mu}_{13}-\\hat{\\mu}_{21}+\\frac12\\hat{\\mu}_{22}+\\frac12\\hat{\\mu}_{23}\\right)&amp; =\\frac32\\hat\\sigma_\\varepsilon^2\\left(\\frac1{n_1}+\\frac1{n_2}\\right) \\\\ &amp;=\\left(\\frac32\\right)(0.7872)\\left(\\frac13+\\frac13\\right)=0.7872 \\end{aligned}\\] 因此 \\(\\hat \\tau_A-\\hat \\tau_B\\) 标准误估计为 \\(√0.7872=0.8872\\). 类似地，可以通过将方程 (29.13) 中的 \\(\\sigma_\\varepsilon^2\\) 替换为 \\(\\hat\\sigma_\\varepsilon^2\\) 并取结果的平方根，来获得 \\(\\hat \\lambda_A-\\hat \\lambda_B\\) 的标准误估计。与这些的标准误估计中的每一个相关的自由度为 \\(2(n_1+n_2-2)=8\\). 表 29.28: 处理主效应均值 x 表 29.29: 从 Estimate 选项中检验处理和延滞效应 x 29.4 具有两种以上处理的交叉设计 接下来，考虑六个序列中的三处理/三时期交叉设计。设计序列为 \\(ABC,ACB,BAC,BCA,CAB,CBA\\). 所有这六个序列都是必需的，为了获得不会与延滞混叠的处理均值的直接比较。Williams (1949) 开发的设计在延滞效应方面是均衡的。Williams 交叉设计在延滞效应方面是均衡的，其特点是每次处理后都会进行完全相同次数的其他处理。 上面给出的六序列设计是 Williams 设计。在这六个序列的设计中，每个处理（字母）跟随另一个处理两次。还要注意，虽然具有序列 \\(ABC,BCA,CAB\\) 的三序列设计是拉丁方设计，但它不是 Williams 设计。在这种设计中，\\(A\\) 后面跟着 \\(B\\) 两次，但 \\(A\\) 后面永远不会跟着 \\(C\\). 同样，\\(B\\) 后面跟着 \\(C\\) 两次，但 \\(B\\) 后面从来没有跟着 \\(A\\)；\\(C\\) 后面跟着 \\(A\\) 两次，但 \\(C\\) 后面从来没有跟着 \\(B\\)。三个时期内三种处理的 Williams 设计必须使用 \\(ABC,ACB,BAC,BCA,CAB,CBA\\) 的所有六个序列。 假设有四处理和四时期，显然，24 序列设计具有处理 \\(A,B,C,D\\) 的所有 \\(24\\) 种可能的排序，这将是一个 Williams 设计。另一种四处理四时期的 Williams 设计的序列为 \\(ABCD,BDAC,CADB,DCBA\\). 设 \\(t\\) 为交叉设计中要使用的处理数和时期数。如果 \\(t\\) 是偶数，则 Williams 设计可以用一个特殊的 \\(t×t\\) 拉丁方设计来构建，如果 \\(t\\) 是奇数，Williams 设计可以通过使用两个特殊的拉丁方设计来构建。 表 29.30 给出了三时期/三处理 Williams 设计的单元格均值参数。为了表明当存在延滞时可以估计处理差异，可以证明对于表 29.30 中的单元格均值 \\[\\begin{align} &amp;(5\\mu_{11}-2\\mu_{12}-3\\mu_{13}+4\\mu_{21}+2\\mu_{22}-6\\mu_{23}-5\\mu_{31}+2\\mu_{32}+3\\mu_{33}-4\\mu_{41}-2\\mu_{41}\\\\&amp;+6\\mu_{43}-\\mu_{51}+4\\mu_{52}-3\\mu_{53}+\\mu_{61}-4\\mu_{62}+3\\mu_{63})/24=\\tau_A-\\tau_B \\tag{29.14} \\end{align}\\] 还注意到，也可以比较延滞效应， \\[\\begin{align} &amp;(\\mu_{11}+2\\mu_{12}-3\\mu_{13}+0\\mu_{21}+2\\mu_{22}-2\\mu_{23}-\\mu_{31}-2\\mu_{32}+3\\mu_{33}+0\\mu_{41}-2\\mu_{41}\\\\&amp;+2\\mu_{43}-\\mu_{51}+0\\mu_{52}+\\mu_{53}+\\mu_{61}+0\\mu_{62}-\\mu_{63})/8=\\lambda_A-\\lambda_B \\tag{29.15} \\end{align}\\] 还可以获得简化为 \\(\\tau_A-\\tau_C\\) 和 \\(\\tau_B-\\tau_C\\) 以及 \\(\\lambda_A-\\lambda_C\\) 和 \\(\\lambda_B-\\lambda_C\\) 的单元格均值参数的类似函数。 表 29.30: 六个序列的三时期/三处理交叉设计单元格均值参数 x 例如，考虑表 29.31 中的数据。这些数据来自六个序列的三时期/三处理交叉设计。有少数个体缺失数据。使用表 29.31 中的命令创建 SAS 数据集。这些命令还创建了一个延滞参数，该参数给出了上一时期的处理值。对于第一时期，该参数的值为“O”。数据最初使用 SAS-Mixed 软件进行分析，使用表 29.33 中的命令。表 29.34 给出了个体间和个体内方差分量的估计，即，\\(\\hat\\sigma^2_\\delta = 3.2278\\) 和 \\(\\hat\\sigma^2_\\varepsilon = 0.8934\\). 表 29.31: 三时期/三处理交叉设计的数据 x 表 29.32: 分析表 29.31 中数据的 SAS 代码 x 表 29.33: 分析表 29.31 中数据的 SAS 代码 x 表 29.34: 方差分量的估计 x 表 29.35 给出了固定效应的检验。对表 29.35 的检验表明，有一个很显著处理效应（\\(p &lt; 0.0001\\)）和显著的延滞效应（\\(p = 0.0306\\)）。表 29.36 和 29.37 给予 LSMEANS 选项的结果。值得注意的是，无论是处理还是先前处理的最小二乘均值都不可估 (not estimable)。原因是 SAS-Mixed 程序生成的模型参数函数是不可估的。 例如，SAS-Mixed 程序将处理 \\(A\\) 最小二乘均值定义为 \\[\\mu+\\frac{S_{ABC}+S_{ACB}+S_{BAC}+S_{BCA}+S_{CAB}+S_{CBA}}6+\\frac{P_1+P_2+P_3}3+\\tau_A+\\frac{\\lambda_A+\\lambda_B+\\lambda_C+\\lambda_O}4\\] 该函数不可估，因为 \\(P_1\\) 和 \\(\\lambda_O\\) 在模型中彼此完全混叠，因此，它们必须具有相同的乘数。在上式中，它们不具有相同的乘数，因为 \\(P_1\\) 的乘数等于 \\(1/3\\)，而 \\(\\lambda_O\\) 的乘数等于 \\(1/4\\). 处理 \\(A\\) 最小二乘均值的更好定义为 \\[\\begin{align} \\mu&amp;+\\frac{S_{ABC}+S_{ACB}+S_{BAC}+S_{BCA}+S_{CAB}+S_{CBA}}6+\\frac{P_1+P_2+P_3}3\\\\&amp;+\\tau_A+\\frac{2\\lambda_A+2\\lambda_B+2\\lambda_C+3\\lambda_O}9 \\tag{29.16} \\end{align}\\] 在该定义中，\\(P_1\\) 和 \\(\\lambda_O\\) 的乘数均等于 \\(1/3\\). 此外，由于四个延滞参数的乘数之和必须为 \\(1\\)，因此 \\(\\lambda_A,\\lambda_B,\\lambda_C\\) 的乘数必须等于 \\(2/9\\). 式 (29.16) 中的函数是可估计。以类似的方式，可以定义处理 \\(B\\) 和处理 \\(C\\) 的最小二乘均值，并且这些平均值之间的成对差异将不包括延滞参数。 表 29.35: 固定效应的检验 x 表 29.36: 处理最小二乘均值 x 表 29.37: 处理和延滞参数之间的成对比较 x 尽管在表 29.36 中处理最小二乘均值不可估，但成对差异是可估计的，处理和延滞参数之间的成对比较见表 29.37 。从表 29.37 可以看出， \\[\\hat{\\tau}_{A}-\\hat{\\tau}_{B}=0.8195,\\hat{\\tau}_{A}-\\hat{\\tau}_{C}=-3.0861,\\mathrm{and}\\,\\hat{\\tau}_{B}-\\hat{\\tau}_{C}=-3.9056\\] 相应的观察到的显著性水平为 \\(p = 0.0041\\)、\\(p &lt; 0.0001\\) 和 \\(p &lt; 0.0001\\). 因此，所有处理均值彼此之间存在显著差异。 从表 29.37 中还可以看出， \\[\\hat{\\lambda}_A-\\hat{\\lambda}_B=-0.7706,\\hat{\\lambda}_A-\\hat{\\lambda}_C=0.1842,\\mathrm{~and~}\\hat{\\lambda}_B-\\hat{\\lambda}_C=0.9548\\] 相应的观察到的显著性水平为 \\(p = 0.0557\\)、\\(p = 0.6380\\) 和 \\(p = 0.0118\\). 因此，处理 \\(A\\) 和 \\(C\\) 的延滞效应彼此相似，且均与处理 \\(B\\) 的延滞显著不同。 表 29.38 给出了额外的 SAS 代码，该代码使用与 (29.16) 中给出的处理 \\(A\\) 相似的定义计算处理最小二乘均值。表 29.38 中 SAS 命令的结果见表 29.39. 对表 29.39 的检查表明，处理 \\(C\\) 的平均值最大，其次是处理 \\(A\\) 和 \\(B\\). 还注意到，表 29.39 中给出的处理平均值和延滞效应之间的成对比较与表 29.37 中的相应比较完全相同。 表 29.38: 计算处理可估最小二乘均值的额外 SAS 代码 x 表 29.39: 表 29.38 中给出的命令的结果 x 29.5 小结 本章考虑了交叉设计，即每个个体随着时间的推移接受一系列处理。特定个体接受的一系列特殊处理被称为序列。当使用交叉设计时，需要考虑延滞问题。如果怀疑可能存在延滞，可以在进行下一次处理之前纳入洗脱期，以尽可能减少延滞的影响。当两时期/两处理交叉设计中存在延滞时，不能使用第二个时期的数据来估计处理差异。然而，当能够使用两个以上时期和/或两种以上处理时，无论是否存在延滞，都可以获得处理差异的估计。 "]]
