[["index.html", "混乱数据分析：设计的实验 介绍 本书框架", " 混乱数据分析：设计的实验 Wang Zhen 2024-02-25 介绍 混乱数据分析：设计的实验 为 Analysis of Messy Data Volume 1: Designed Experiments, 2nd edn 的翻译。 本书/翻译基于 Elegant Bookdown Template，进度还处于早期。尚未包括每章的练习。 本书探讨了多重比较程序、随机效应模型、混合模型、裂区实验和重复测量设计的各种技术。作者使用几个统计软件包简化了这些技术，并强调了设计结构和处理结构之间的区别。他们用例子介绍每一个主题，接着进行理论讨论，最后进行案例研究。本书向您展示如何有效地分析现实世界中的非标准数据集。 本书需要读者对统计学基本概念有一定的了解，并且最好有线性模型和实验设计的基础知识。在本书阅读过程中常常需要交替往返地进行查阅（或向前或向后）以获得完整的学习过程，出于此特殊结构，本书不适合作为入门级教科书，而是适合作为学习完线性模型和实验设计后的一本进阶学习资料或案头参考书。 本书涉及丰富且有趣的例子，如探究饮食对减肥的影响、房屋油漆承受环境条件的能力、油漆保护钢板耐高温的能力、氮和钾的组合如何影响玉米产量、豆子煮熟后的风味、磨小麦时辊缝对小麦粉的影响、温度如何影响面包烘焙后的体积、展示柜中的肉的颜色如何受温度、包装、光照类型及强度的影响……统计分析当然重要，但良好的设计是良好的分析的前提，本书在这些实例的设计和分析方面给予了连贯的解释，展示了丰富的图表，罗列了大量公式，详尽地阐明了分析步骤并给出了相应的软件代码。 站在巨人的肩膀上，才有了本书。希望你喜欢。 若有帮助，欢迎转发。能力不足，水平有限，望不吝批评：1210683652@qq.com 由于公式较多，每章可能需要加载数秒。 本书框架 作为开篇，第 1 章讨论了最简单的情况：具有同质误差的完全随机设计结构中的单向处理结构。在这类实验中，研究人员希望考察某（一）种因素对响应变量的影响，并假定响应变量在该因素的不同水平中的方差相等。 第 2 章接续第 1 章的基本结构，但将同质误差改为异质误差，即该因素可能会改变响应变量的方差。本章着重讨论了有关方差齐性检验的一系列技术。 第 3 章重点关注实验中常常出现的一个问题：如何控制多重比较中的各种错误率？本章回顾了多重比较的一系列技术并给出了建议。 第 4 章对实验设计基本概念进行了详尽的描述。并强调了重复和复制的区别，提醒研究者勿将子样本或重复测量误认为重复。此外本章还讨论了其他实验设计教科书较少着墨甚至忽略的内容：将设计实验的结构划分为处理结构和设计结构，并列举了这两种结构常用的类型。最后结合两种结构的划分讨论了一些示例。 第 5 章讨论了多水平设计结构这一重要概念，包括裂区设计、裂条设计、重复测量设计及这些设计的组合。本章重点介绍了当实验包含不止一种尺寸的实验单元时，如何识别每种尺寸的实验单元，这对于计算所需误差平方和的过程至关重要。通过大量的例子来阐述不同设计结构的这些过程。 第 6 章仅供对理论背景感兴趣的人阅读，介绍了最小二乘估计程序，并讨论了可估性的重要概念。还讨论了总体边际均值的定义和估计。 从第 7 章开始讨论实验处理结构的分析方法。第 7 章讨论的是均衡双向处理结构，给出了交互作用的定义并重点讨论了交互作用假设及它们的重要性。第 8 章是一个均衡双向实验案例的完整分析，首先关于主效应和交互效应分别给出了对比和正交对比的定义，最后以此概念分析了一个油漆铺路示例，最后讨论了在分析定量处理因素时如何利用正交多项式考察处理主效应均值的曲线趋势。 第 9-?? 章讨论对子类数量不等的双向处理结构的分析。第 9 章使用均值模型进行分析。 第 10 章讨论了交叉设计的分析。 "],["chap1.html", "第 1 章 最简单的情况：具有同质误差的完全随机设计结构中的单向处理结构 1.1 模型定义和假设 1.2 参数估计 1.3 线性组合的推断：检验与置信区间 1.4 示例：任务和脉搏率 1.5 几种线性组合的联合检验 1.6 示例：任务和脉搏率（续） 1.7 检验所有均值相等 1.8 示例：任务和脉搏率（续） 1.9 比较两种模型的一般方法：条件误差原理 1.10 示例：任务和脉搏率（续） 1.11 计算机分析 1.12 结束语 1.13 练习", " 第 1 章 最简单的情况：具有同质误差的完全随机设计结构中的单向处理结构 假设一名实验者想比较几种不同处理1的效应，例如不同药物对人们心率的影响或几种不同小麦品种的产量。通常，分析此类实验数据的第一步是使用一种称为单向方差分析模型的统计方法来刻画数据。单向方差分析所基于的模型是统计学领域中最有用的模型之一。许多实验情况只是该模型的特殊情况。其他看起来要复杂得多的模型通常可以被认为是单向模型。本章分为几个部分。在前两部分中，定义了单向模型，并讨论了其参数的估计。在 1.3 节和1.5节中，提供了处理效应特定线性组合的推断程序。在 1.7 节和 1.9 节中，我们介绍了开发检验统计量的两种基本方法。这两种方法在本书的其余部分被广泛使用。最后，在 1.11 中，我们讨论了使用上述技术可用的计算机分析。使用一个示例来演示每一节中描述的概念和计算。 1.1 模型定义和假设 假设含 \\(N\\) 个实验单元的样本是从可能的实验单元总体2中完全随机地选取的。实验单元被定义为施加处理并独立观察的基本单元。在第 4 章和第 5 章中可以找到对实验单元更完整的描述。 为了比较 \\(t\\) 种不同处理的效应，将 \\(N\\) 个实验单元的样本随机分为 \\(t\\) 组，使第 \\(i\\) 组中有 \\(n_i\\) 个实验单元，其中 \\(i=1,2,\\dots,t\\) 且 \\(N=\\sum_{i=1}^tn_i\\). 将实验单元随机分为 \\(t\\) 组应消除任何系统偏差。也就是说，随机性应该确保在施加处理之前，\\(t\\) 组实验单元在性质上是相似的。最后，\\(t\\) 个处理中的每个处理应随机分配到每组实验单元。等价地，可以使用一些随机化装置将实验单元随机分配到 \\(t\\) 个处理组，例如将 \\(n_1\\) 个标签置于表示处理1的碗中，将 \\(n_2\\) 个标签置于表示处理2的碗中，……，将 \\(n_t\\) 个标签置于表示处理t的碗中。混合标签，然后从碗中随机选择标签，以确定分配给每个实验单元的处理。这种在碗中使用标签的过程显然可以使用随机数生成的软件来执行。 设 \\(y_{ij}\\) 表示分配给第 \\(i\\) 种处理的第 \\(j\\) 个实验单元的反应。值 \\(y_{11},y_{12},\\dots,y_{1n_1}\\) 可以被认为是来自均值为 \\(m_1\\) 且方差为 \\(s^2_1\\) 的总体的大小为 \\(n_1\\) 的随机样本，值 \\(y_{21},y_{22},\\dots,y_{2n_1}\\) 可以被认为是来自均值为 \\(m_2\\) 且方差为 \\(s^2_2\\) 的总体的大小为 \\(n_2\\) 的随机样本，对于 \\(i = 3,4,\\dots,t\\) 也是如此。参数 \\(\\mu_i\\) 和 \\(\\sigma^2_i\\) 表示对实验单元的整个总体施加处理 \\(i\\) 时的总体均值和总体方差。 本章考虑了最简单的情况，即假设各处理之间的方差是同质的或相等的，即 \\(\\sigma^2_1= \\sigma^2_2=\\cdots = \\sigma^2_t\\). 也就是说，假设对实验单元施加第 \\(i\\) 个处理可能会影响响应的均值，但不会影响响应的方差。第 2 章讨论了等方差假设以及不等方差的方差分析。 一个好的统计分析的基本目标是估计模型的参数并对它们进行推断，推断的方法通常包括检验假设和构造置信区间。 有几种方法可以为上述情况下的数据编写模型。第一个要使用的模型称为 \\(\\mu_i\\) 模型或均值模型 (means model)。均值模型是： \\[y_{ij}=\\mu_{i}+\\varepsilon_{ij}\\quad i=1,2,\\dots,t,\\,j=1,2,\\dots,n_{i}\\] 其中假设了 \\[\\begin{equation} \\varepsilon_{ij}\\sim \\text{i.i.d.}\\,N(0,\\sigma^{2})\\quad i=1,2,\\ldots,t,\\,j=1,2,\\ldots,n_{i} \\tag{1.1} \\end{equation}\\] 记号 \\(\\varepsilon_{ij}\\sim \\text{i.i.d.}\\,N(0,\\sigma^{2})\\) 贯穿本书。它表示 \\(\\varepsilon_{ij}\\,(i=1,2,\\dots,t;\\,j=1,2,\\dots,n_i)\\) 独立同分布，每个 \\(\\varepsilon_{ij}\\) 的抽样分布是均值为 \\(0\\)，方差为 \\(s^2\\) 的正态分布。 1.2 参数估计 统计分析最重要的方面是得到每个实验单元的误差方差 \\(\\sigma^2\\) 的良好估计. 误差方差衡量实验的准确性——- \\(s^2\\) 越小，实验越准确。在任何实验或研究中，如果不了解实验误差方差，就不能做出任何在统计上有效的推论。 在上述情况下，当 \\(n_i &gt; 1\\) 时，第 \\(i(=1,2,\\dots,t)\\) 个样本提供 \\(\\sigma^2\\) 的估计。从第 \\(i\\) 种处理的数据中获得的 \\(\\sigma^2\\) 的估计值为 \\[\\hat{\\sigma}_i^2=\\sum_{j=1}^{n_j}\\frac{\\left(y_{ij}-\\overline{y}_{i\\cdot}\\right)^2}{n_i-1}\\] 这是 \\(\\sigma^2\\) 的一个无偏估计。其中 \\[\\overline{y}_{i\\cdot}=\\frac{\\sum_{j=1}^{n_i}y_{ij}}{n_i}\\] 第 \\(i\\) 个处理的 \\(\\sigma^2\\) 的估计值是 \\(\\sigma^2_i\\) ，基于 \\(n_i - 1\\) 个自由度，且 \\((n_i - 1)\\hat\\sigma_i^2/\\sigma^2\\) 的抽样分布是具有 \\(n_i - 1\\) 个自由度的卡方分布。 \\(\\sigma^2\\) 的这些 \\(t\\) 个独立估计值的加权平均提供了如下情况下 \\(\\sigma^2\\) 可能的最佳估计值：其中方差的每个估计值由其相应的自由度加权。\\(\\sigma^2\\) 的最佳估计为 \\[\\hat{\\sigma}^2=\\sum_{i=1}^t(n_i-1)\\hat{\\sigma}_i^2\\left/\\sum_{i=1}^t(n_i-1)\\right.\\] 出于计算目的，每个方差乘以其权重可以表示为 \\[(n_{i}-1)\\hat{\\sigma}_{i}^{2}=\\sum_{i=1}^{t}\\left(y_{ij}-\\overline{y}_{i\\cdot}\\right)^{2}=\\sum_{i=1}^{t}y_{ij}^{2}-n_{i}\\overline{y}_{i\\cdot}^{2}=\\sum_{i=1}^{t}y_{ij}^{2}-(y_{i.})^{2}/n_{i}=SS_{i}\\] 其中 \\(y_{i\\cdot}=\\sum_{j=1}^{n_{i}}y_{ij}\\). 则方差的合并估计 (pooled estimate) 为 \\[\\hat{\\sigma}^2=\\frac{SS_1+SS_2+\\cdots+SS_t}{(n_1-1)+(n_2-1)+\\cdots+(n_t-1)}=\\frac{\\sum_{i=1}^tSS_i}{N-t}\\] 方差 \\(\\sigma^2\\) 的合并估计值基于 \\(N-t\\) 个自由度，并且 \\((N-t)\\hat\\sigma^2/\\sigma^2\\) 的抽样分布是具有 \\(N-t\\) 个自由度的卡方分布，即，\\((N-t)\\hat\\sigma^2/\\sigma^2\\sim \\chi^2_{N-t}\\). 每个 \\(\\mu_i\\) 的最佳估计是 \\(\\hat{\\mu}_{i}=\\bar{y}_{i\\cdot},\\,i=1,2,\\dots,t\\). 在式 (1.1) 给出的假设下，\\(\\hat\\mu_i\\) 的抽样分布是正态分布，具有均值 \\(\\mu_i\\) 和方差 \\(\\sigma^2/n_i\\). 即， \\[\\begin{equation} \\hat{\\mu}_i\\sim N{\\left(\\mu_i,\\frac{\\sigma^2}{n_i}\\right)}\\quad i=1,2,\\ldots,t \\tag{1.2} \\end{equation}\\] 使用 \\(\\hat\\mu_i,\\hat\\sigma_i^2\\) 的抽样分布，那么 \\[\\begin{equation} t_{i}=\\frac{\\hat{\\mu}_{i}-\\mu_{i}}{\\sqrt{\\hat{\\sigma}^{2}/n_{i}}}\\sim t_{\\Tiny{N-t}}\\quad i=1,2,\\ldots,t \\tag{1.3} \\end{equation}\\] 也就是说，\\(t_i\\) 的抽样分布是具有 \\(N-t\\) 个自由度的 \\(t\\) 分布。此外，\\(\\mu_1,\\mu_2,\\dots,\\mu_t\\) 和 \\(\\sigma_i^2\\) 在统计上是独立的。 1.3 线性组合的推断：检验与置信区间 本节提供均值模型中参数线性函数的假设检验和置信区间。上一节中的结果可用于检验有关单个 \\(\\mu_i\\) 的假设。这些结果也可用于检验有关 \\(\\mu_i\\) 线性组合的假设或构造 \\(\\mu_i\\) 线性组合的置信区间。 对于涉及几种处理的实验，研究者选择研究中的处理是因为存在需要研究的有趣假设。这些有趣的假设形成了研究的目的。涉及处理的假设很可能涉及方法的特定线性组合。这些线性组合使研究者得以比较不同处理的效应，或者等价地，比较不同处理或总体的平均值。如下所示，其中 \\(c_1,c_2,\\dots,c_t\\) 和 \\(a\\) 为某组已知常数： \\[H_{01}{:}\\,\\sum_{i=1}^{t}c_{i}\\mu_{i}=a\\,\\mathrm{~vs.~}\\, H_{a1}{:}\\mathrm{~(not~}H_{01}{:})\\\\ H_{02}{:}\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\,\\mathrm{~vs.~}\\,H_{a2}{:}\\mathrm{~(not~}H_{02}{:})\\\\ H_{03}{:}\\,\\mu_i=\\mu_{i^\\prime}\\text{ for some }i\\neq i^{\\prime}\\mathrm{~vs.~}H_{a3}{:}\\mathrm{~(not~}H_{03}{:})\\] 对于 \\(H_{01}\\) 给出的线性组合，可以证明： \\[\\begin{equation} \\frac{\\sum_{i=1}^tc_i\\hat{\\mu}_i-\\sum_{i=1}^tc_i\\mu_i}{\\sqrt{\\hat{\\sigma}^2\\sum_{i=1}^tc_i^2/n_i}}\\thicksim t_{\\Tiny{N-t}} \\tag{1.4} \\end{equation}\\] 这个结果可以用来推断形式为 \\(\\sum_{i=1}^tc_i\\mu_i\\) 的线性组合。由于 \\(H_{03}\\) 中的假设可以写为 \\(H_{03}:\\,\\mu_i-\\mu_{i^\\prime}=0\\)，它是 \\(H_{01}\\) 的特殊情况，其中 \\(c_i=1,c_{i^\\prime}=-1\\)，且 \\(c_k=0\\) 如果 \\(k\\ne i\\) 或 \\(i^\\prime\\). \\(H_{02}\\) 的一个检验在 1.5 节给出。\\(\\sum_{i=1}^tc_i\\hat{\\mu}_i\\) 的标准误估计为 \\[\\begin{equation} \\widehat{s.e.}\\left(\\sum c_i\\hat{\\mu}_i\\right)=\\sqrt{\\hat{\\sigma}^2\\sum\\frac{c_i^2}{n_i}} \\tag{1.5} \\end{equation}\\] 为了检验 \\(H_{01}{:}\\,\\sum_{i=1}^{t}c_{i}\\mu_{i}=a\\,\\mathrm{~vs.~}\\, H_{a1}{:}\\mathrm{~(not~}H_{01}{:})\\)，计算 \\(t\\) 统计量： \\[\\begin{equation} t_c=\\frac{\\sum c_i\\hat{{\\mu}}_i-a}{\\widehat{s.e.}\\left(\\sum c_i\\hat{\\mu}_i\\right)} \\tag{1.6} \\end{equation}\\] 如果 \\(|t_{c}| &gt;t_{\\alpha/2,\\nu}\\)，其中 \\(v=N-t\\)，那么 \\(H_{01}\\) 在 \\(\\alpha100\\%\\)3显著性水平下被拒绝，其中 \\(t_{\\alpha/2,\\nu}\\) 是自由度为 \\(v\\) 的 \\(t\\) 分布的上 \\(\\alpha/2\\) 分位数4。\\(\\sum_{i=1}^{t}c_{i}\\mu_{i}\\) 的 一个 \\((1-\\alpha)100\\%\\) 置信区间为 \\[\\begin{equation} \\sum c_i\\hat{\\mu}_i\\pm t_{\\alpha/2,\\nu}\\widehat{s.e.}\\left(\\sum c_i\\hat{\\mu}_i\\right) \\tag{1.7} \\end{equation}\\] 1.4 示例：任务和脉搏率 表 1.1 中的数据来自一项实验，该实验旨在确定六种不同的工作任务如何影响工人的脉搏率。在这项实验中，\\(78\\) 名男性工人被随机分配到六个不同的组，每组 \\(13\\) 名工人。每组工人都接受了执行指定任务的培训。在培训后的选定一天，在工人完成指定任务 \\(1\\) 小时后测量他们的脉搏率。不幸的是，在训练过程中，一些个体退出实验，使得一些组包含少于 \\(13\\) 个个体。记录的数据表示 \\(20s\\) 内的心脏搏动次数，其中有 \\(N = 68\\) 个观测值，和为 \\(y = 2197\\). 表 1.1: 六项任务的脉搏数据和摘要信息 x 对于任务数据，\\(\\sigma^2\\) 的最佳估计为 \\[\\hat{\\sigma}^{2}=\\sum_{i=1}^{6}SS_{i}\\left(N-t\\right)=1,916.0761/62=30.9045\\] 基于 \\(62\\) 个自由度。\\(\\mu_i\\) 的最佳估计分别为 \\(\\hat\\mu_1 = 31.923,\\hat\\mu_2 = 31.083,\\hat\\mu_3 = 35.800,\\hat\\mu_4 = 38.000,\\hat\\mu_5 = 29.500\\) 和 \\(\\hat\\mu_6 = 28.818\\). 为了说明，假设研究者有兴趣回答以下关于任务均值线性组合的问题： 检验 \\(H_0:\\,\\mu_3=30\\,\\mathrm{~vs.~}\\,H_a:\\,\\mu_3\\ne30\\). 为 \\(\\mu_1\\) 构造 \\(95\\%\\) 置信区间。 检验 \\(H_0:\\,\\mu_4=\\mu_5\\,\\mathrm{~vs.~}\\,H_a:\\,\\mu_4\\ne\\mu_5\\). 检验 \\(H_0:\\,\\mu_1=(\\mu_2+\\mu_3+\\mu_4)/3\\,\\mathrm{~vs.~}\\,H_a:\\,\\mu_1\\ne(\\mu_2+\\mu_3+\\mu_4)/3\\). 为 \\(4\\mu_1-\\mu_3-\\mu_4-\\mu_5-\\mu_6\\) 构造 \\(90\\%\\) 置信区间。 这些问题可以通过应用本节的结果来回答。 a的结果。通过代入式 (1.6) 获得用于检验 \\(H_0:\\,\\mu_3=30\\) 的 \\(t\\) 统计量 \\[t_{c}=\\frac{\\hat{\\mu}_{3}-30}{\\widehat{s.e.}(\\hat{\\mu}_{3})}=\\frac{\\hat{\\mu}_{3}-30}{\\sqrt{\\hat{\\sigma}^{2}/n_{3}}}=\\frac{35.8-30.0}{\\sqrt{30.9045/10}}=3.30\\] 该 \\(t\\) 值的显著性概率是 \\(\\hat \\alpha = \\operatorname{Pr}\\{|t_c| &gt; 3.30\\} = 0.0016\\)，其中 \\(\\operatorname{Pr}\\{|t_c| &gt; 3.30\\}\\) 是具有 \\(62\\) 个自由度的 \\(t\\) 分布中 \\(3.30\\) 右侧的面积加上 \\(-3.30\\) 左侧的面积。上述 \\(\\hat\\alpha\\) 值是由电脑计算出来的，但也可由一些特别的手持计算器计算出来。没有电脑或计算器的读者，应比较 \\(t_c = 3.30\\) 与 \\(t_{\\alpha/2,62}\\) 来选择 \\(\\alpha\\). b的结果。\\(\\mu_1\\) 的 \\(95\\%\\) 置信区间由下式给出 \\[\\begin{aligned} \\hat{\\mu}_{1}\\pm t_{0.025,62}\\widehat{s.e.}(\\hat{\\mu}_{1})&amp; =31.923\\pm2.00\\sqrt{30.9045/13} \\\\ &amp;=31.923\\pm2.00\\times1.542 \\end{aligned}\\] 因此 \\(\\mu_1\\) 的 \\(95\\%\\) 置信区间为 \\(28.839&lt;\\mu_1&lt;35.007\\)，我们有 \\(95\\%\\) 的把握认为这个区间包含了未知的真实值 \\(\\mu_1\\). c的结果。为检验 \\(H_0:\\,\\mu_4=\\mu_5\\)，令 \\(l_1=\\mu_4-\\mu_5\\)，那么 \\(\\hat l_1=\\hat \\mu_4-\\hat\\mu_5=38.0-29.5=8.5\\)。由于 \\(c_1=c_2=c_3=c_6=0,c_4=1,c_5=-1\\)，那么 \\[\\widehat{s.e.}(\\hat{l}_{1})=\\sqrt{\\hat{\\sigma}^{2}\\sum_{i=1}^{6}c_{i}^{2}/n_{i}}=\\sqrt{30.9045{\\left(\\frac{1}{10}+\\frac{1}{12}\\right)}}=2.380\\] 用于检验 \\(H_0:\\,\\mu_4=\\mu_5\\) 的 \\(t\\) 统计量为 \\[t_c=\\frac{8.5}{2.380}=3.57\\] 该检验的显著性概率为 \\(\\hat\\alpha=0.0007\\). d的结果。检验 \\(H_0:\\,\\mu_1=(\\mu_2+\\mu_3+\\mu_4)/3\\) 等价于检验 \\(H_0:\\,\\mu_1-\\frac{1}{3}\\mu_2-\\frac{1}{3}\\mu_3-\\frac{1}{3}\\mu_4=0\\) 或检验 \\(H_0:\\,3\\mu_1-\\mu_2-\\mu_3-\\mu_4=0\\). 选择最后一个版本，计算稍微容易一些，并且 \\(t_c\\) 检验统计量的值相对于常数乘数是不变的。 令 \\(l_2=3\\mu_1-\\mu_2-\\mu_3-\\mu_4\\)，那么 \\[\\hat{l}_2=3\\hat{\\mu}_1-\\hat{\\mu}_2-\\hat{\\mu}_3-\\hat{\\mu}_4=3(31.923)-31.083-35.8-38.0=-9.114\\] \\(\\hat l_2\\) 的标准误估计为 \\[\\widehat{s.e.}(\\hat{l}_2)=\\sqrt{30.9045{\\left(\\frac9{13}+\\frac1{12}+\\frac1{10}+\\frac1{10}\\right)}}=5.491\\] 用于检验 \\(H_0:\\,3\\mu_1-\\mu_2-\\mu_3-\\mu_4=0\\) 的 \\(t\\) 统计量为 \\[t_c=\\frac{-9.114}{5.491}=-1.66\\] 该检验的显著性概率为 \\(\\hat\\alpha=0.1020\\). e的结果。令 \\(l_{3}=4\\mu_{1}-\\mu_{3}-\\mu_{4}-\\mu_{5}-\\mu_{6}\\). 那么 \\(\\hat{l}_{3}=-4.426\\) 且 \\(\\widehat{s.e.}(\\hat{l}_{3})=7.0429\\). \\(l_3\\) 的 \\(90\\%\\) 置信区间为 \\[\\hat{l}_{3}\\pm t_{0.05,62}\\widehat{s.e.}\\left(\\hat{l}_{3}\\right)=-4.426\\pm1.671\\times7.043=-4.426\\pm11.769\\] 因此 \\(90\\%\\) 置信区间为 \\(-16.195&lt;4\\mu_1-\\mu_3-\\mu_4-\\mu_5-\\mu_6&lt;7.343\\). 1.5 几种线性组合的联合检验 在许多情况下，研究人员希望检验关于处理效应或均值的几个线性组合的联合假设 (simultaneous hypothesis)。例如，涉及处理均值的 \\(k\\) 个线性独立线性组合 (linearly independent linear combinations) 的一般假设可以表示为： \\[\\begin{equation} H_0{:}\\quad\\begin{aligned}c_{11}\\mu_1+c_{12}\\mu_2+&amp;\\cdots+c_{1t}\\mu_t=a_1\\\\c_{21}\\mu_1+c_{22}\\mu_2+&amp;\\cdots+c_{2t}\\mu_t=a_2\\\\&amp;\\vdots\\\\c_{k1}\\mu_1+c_{k2}\\mu_2+&amp;\\cdots+c_{kt}\\mu_t=a_k\\end{aligned}\\quad\\mathrm{~vs.~}\\quad H_a{:}(\\operatorname{not}H_0) \\tag{1.8} \\end{equation}\\] 本节中给出的结果是用向量和矩阵来说明的。然而，对于有矩阵处理软件的读者来说，向量和矩阵的知识并不是真正必要的，因为大多数计算机甚至允许新手用户轻松地进行矩阵计算。 式 (1.8) 中的假设可以用矩阵表示法写为： \\[\\begin{equation} H_0{:}\\,\\boldsymbol{C}\\boldsymbol\\mu=\\boldsymbol a\\quad\\mathrm{~vs.~}\\quad H_a{:}\\,\\boldsymbol{C}\\boldsymbol\\mu\\neq\\boldsymbol a \\tag{1.9} \\end{equation}\\] 其中 \\[\\begin{equation} \\boldsymbol{C}=\\begin{bmatrix}c_{11}&amp;c_{12}&amp;\\cdots&amp;c_{1t}\\\\c_{21}&amp;c_{22}&amp;\\cdots&amp;c_{2t}\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\c_{k1}&amp;c_{k2}&amp;\\cdots&amp;c_{kt}\\end{bmatrix},\\quad\\boldsymbol{\\mu}=\\begin{bmatrix}\\mu_{1}\\\\\\mu_{2}\\\\\\vdots\\\\\\mu_{t}\\end{bmatrix},\\quad\\mathrm{and}\\quad\\boldsymbol{a}=\\begin{bmatrix}a_{1}\\\\a_{2}\\\\\\vdots\\\\a_{k}\\end{bmatrix} \\tag{1.10} \\end{equation}\\] 假设 \\(\\boldsymbol C\\) 中的 \\(k\\) 行是线性独立的，这意味着 \\(\\boldsymbol C\\) 中没有一行可以表示为其余行的线性组合。如果 \\(\\boldsymbol C\\) 中的 \\(k\\) 行不是线性独立的，那么总是可以选择 \\(\\boldsymbol C\\) 的子集：包含所有线性独立的行，它们包含关于所需假设的所有必要信息。 例如，假设你有三种处理，你希望检验 \\[H_0{:}\\,\\mu_1-\\mu_2=0,\\,\\mu_1-\\mu_3=0\\quad\\mathrm{and}\\quad\\mu_2-\\mu_3=0\\] 相应的 \\(\\boldsymbol C\\) 矩阵为 \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0\\\\1&amp;0&amp;-1\\\\0&amp;1&amp;-1\\end{bmatrix}\\] 但是 \\(\\boldsymbol C\\) 的第三行是第二行和第一行之间的差，因此这三行不是线性独立的。此时，一个等价的假设可以表述为 \\(H_{0}\\colon\\,\\mu_{\\mathrm{l}}-\\mu_{2}=0\\mathrm{~and~}\\mu_{\\mathrm{l}}-\\mu_{\\mathrm{3}}=0\\)，因为如果 \\(\\mu_1-\\mu_2=0\\) 且 \\(\\mu_1-\\mu_3=0\\)，那么 \\(\\mu_2-\\mu_3\\) 必为 \\(0\\). 下面的讨论使用 \\(\\boldsymbol C\\) 的行是线性独立的假设。 将样本均值向量表示为 \\(\\hat{\\boldsymbol \\mu}\\)，则 \\(\\hat{\\boldsymbol \\mu}\\) 抽样分布的矩阵表示为 \\[\\left.\\hat{\\boldsymbol{\\mu}}\\sim {N_t}(\\boldsymbol{\\mu},{\\sigma}^2\\boldsymbol{D})\\quad\\mathrm{~其中~}\\quad \\boldsymbol D=\\left[\\begin{array}{ccccc}1/n_1&amp;0&amp;\\cdots&amp;0\\\\0&amp;1/n_2&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;1/n_t\\end{array}\\right.\\right]\\] 此式读作：\\(t×1\\) 向量 \\(\\hat{\\boldsymbol \\mu}\\) 的元素的联合抽样分布为 \\(t\\) 元正态分布，其均值为 \\(\\boldsymbol \\mu\\)，方差和协方差由矩阵 \\(\\boldsymbol \\sigma^2\\boldsymbol D\\) 中的元素给出。\\(\\boldsymbol \\sigma^2\\boldsymbol D\\) 第 \\(i\\) 个对角元为 \\(\\hat\\mu_i\\) 的方差，非对角元 \\((i,\\,j)\\) 为 \\(\\hat\\mu_i,\\hat\\mu_j\\) 的协方差。 \\(\\boldsymbol C \\hat{\\boldsymbol \\mu}\\) 的抽样分布为 \\[\\boldsymbol C\\hat{\\boldsymbol{\\mu}}\\sim N_k(\\boldsymbol C\\boldsymbol{\\mu},\\sigma^2 \\boldsymbol {CDC}^{\\prime})\\] 偏离 \\(H_0\\) 的平方和或用于检验 \\(H_0{:}\\,\\boldsymbol C \\boldsymbol \\mu =\\boldsymbol a\\) 的平方和由下式给出 \\[\\begin{equation} SS_{H0}=(\\boldsymbol C\\boldsymbol{\\hat{\\mu}}-\\boldsymbol{a})^{\\prime}(\\boldsymbol{C}\\boldsymbol D\\boldsymbol{C}^{\\prime})^{-1}(\\boldsymbol{C}\\hat{\\boldsymbol{\\mu}}-\\boldsymbol{a}) \\tag{1.11} \\end{equation}\\] 基于 \\(k\\) 个自由度，即 \\(\\boldsymbol C\\) 线性无关行的数量。利用正态性假设，\\(SS_{H0}/\\sigma^2\\) 的抽样分布为自由度为 \\(k\\) 的非中心卡方分布，如果 \\(H_0\\) 为真，则 \\(SS_{H_0}/\\sigma^2\\sim\\chi^2_k\\). 用于检验 \\(H_0\\) 的统计量为 \\[F_c=\\frac{SS_{H0}/k}{\\hat{\\sigma}^2}\\] 若 \\(F_c&gt;F_{\\alpha,k,N-t}\\)，其中 \\(F_{\\alpha,k,N-t}\\) 是分子分母自由度分别为 \\(k\\) 和 \\(N-t\\) 的 \\(F\\) 分布的上 \\(\\alpha\\) 分位数，假设 \\(H_0{:}\\,\\boldsymbol C\\boldsymbol \\mu=\\boldsymbol \\alpha\\). 这里给出的结果是 Graybill (1976) 中定理 6.3.1 的特殊情况。 当 \\(H_0\\) 为真，\\(\\frac{SS_{H0}/k}{\\hat{\\sigma}^2}\\) 为 \\(\\sigma^2\\) 的无偏估计，然后将其与 \\(\\hat\\sigma^2\\) 进行比较，而无论 \\(H_0\\) 是否为真，\\(\\hat\\sigma^2\\) 又是 \\(\\sigma^2\\) 的无偏估计。因此若 \\(H_0\\) 为真，上面给出的 \\(F\\) 统计量应该接近 \\(1\\)。若 \\(H_0\\) 为假， \\(SS_{H0}/k\\) 是下式的无偏估计 \\[\\sigma^2+\\frac1k(\\boldsymbol C\\boldsymbol\\mu-\\boldsymbol a)^{\\prime}(\\boldsymbol C\\boldsymbol D\\boldsymbol C^{\\prime})^{-1}(\\boldsymbol C\\boldsymbol\\mu-\\boldsymbol a)\\] 因此，若 \\(H_0\\) 为假，则 \\(F\\) 统计量的值应大于 \\(1\\) 。若计算的 \\(F\\) 统计量显著大于 \\(1\\) ，则拒绝假设 \\(H_0\\). 1.6 示例：任务和脉搏率（续） 以下是 1.4 节示例中的信息总结，包含六项任务中每项任务的样本量和平均值。 任务 \\(i\\) \\(1\\) \\(2\\) \\(3\\) \\(4\\) \\(5\\) \\(6\\) \\(n_i\\) \\(13\\) \\(12\\) \\(10\\) \\(10\\) \\(12\\) \\(11\\) \\(\\bar y_{i\\cdot}\\) \\(31.9231\\) \\(31.0833\\) \\(35.8000\\) \\(38.0000\\) \\(29.5000\\) \\(28.8182\\) 方差的合并估计为 \\(\\hat\\sigma^2 = 30.9045\\)，基于 \\(62\\) 个自由度。与均值向量估计抽样分布相关的 \\(\\boldsymbol D\\) 矩阵为 \\[\\boldsymbol D=\\begin{bmatrix}\\frac1{13}&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;\\frac1{12}&amp;0&amp;0&amp;0&amp;0\\\\0&amp;0&amp;\\frac1{10}&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;\\frac1{10}&amp;0&amp;0\\\\0&amp;0&amp;0&amp;0&amp;\\frac1{12}&amp;0\\\\0&amp;0&amp;0&amp;0&amp;0&amp;\\frac1{11}\\end{bmatrix}\\] 假设研究者有兴趣联合检验以下假设 (simultaneously testing the following hypothesis)，该假设涉及任务均值的两个线性组合： \\[H_0{:}\\,\\mu_4-\\mu_5=4\\,\\mathrm{~and~}\\,3\\mu_1-\\mu_2-\\mu_3-\\mu_4=0\\,\\mathrm{~vs.~}\\,H_a{:}\\,(\\operatorname{not}H_0)\\] 提供 \\(SS_{H0}\\) 值所需的初步计算如下： \\[\\begin{aligned} \\boldsymbol{C\\hat{\\mu}}-\\boldsymbol{a}&amp; =\\begin{bmatrix}8.5-4\\\\-9.114-0\\end{bmatrix}=\\begin{bmatrix}4.500\\\\-9.114\\end{bmatrix} \\\\ \\boldsymbol C\\boldsymbol D \\boldsymbol C^\\prime&amp; =\\begin{bmatrix}\\dfrac{1}{10}+\\dfrac{1}{12}&amp;-\\dfrac{1}{10}\\\\-\\dfrac{1}{10}&amp;\\dfrac{9}{13}+\\dfrac{1}{12}+\\dfrac{1}{10}+\\dfrac{1}{10}\\end{bmatrix} \\\\ &amp;=\\begin{bmatrix}0.1833&amp;-0.1000\\\\-0.1000&amp;0.9756\\end{bmatrix} \\\\ (\\boldsymbol C \\boldsymbol D \\boldsymbol C^{\\prime})^{-1}&amp; =\\begin{bmatrix}5.7776&amp;0.5922\\\\0.5922&amp;1.0856\\end{bmatrix} \\end{aligned}\\] 以及 \\[SS_{H0}=(\\boldsymbol C\\hat{\\boldsymbol \\mu}-\\boldsymbol a)^{\\prime}(\\boldsymbol C\\boldsymbol D\\boldsymbol C^{\\prime})^{-1}(\\boldsymbol C\\hat{\\boldsymbol \\mu}-\\boldsymbol a)=158.602\\] 自由度为 \\(2\\). 检验统计量为 \\[F_c=\\frac{158.602/2}{30.9045}=2.566\\] 该 \\(F\\) 统计量的显著性概率为 \\(\\hat{\\alpha}=\\mathrm{Pr}\\{F&gt;2.566\\}=0.0850\\). 1.7 检验所有均值相等 大多数研究人员感兴趣的第一个假设通常是检验平均值是否同时相等。假设为 \\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\,\\mathrm{~vs.~}H_{a}{:}\\,(\\operatorname{not}H_{0})\\)。检验等均值假设可使用两个基本程序。对于本章讨论的特定情况，这两个程序给出相同的统计检验。然而，对于大多数混乱数据的情况（对于除单向外的处理结构），这两个程序可以给予不同的检验。第一个程序将在本节介绍，而第二个程序将在 1.9 节介绍。 等均值假设 \\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\) 与下列形式的假设等价：\\(H_{0}\\,\\colon\\mu_{1}-\\mu_{2}=0,\\mu_{1}-\\mu_{3}=0,\\ldots,\\mu_{1}-\\mu_{t}=0\\)，或与涉及 \\(\\mu_i\\) 的 \\(t - 1\\) 个线性独立线性组合的任何其它假设等价。对应于 \\(t - 1\\) 个成对差异集合的 \\(\\boldsymbol C\\) 矩阵和 \\(\\boldsymbol a\\) 向量为： \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0&amp;0&amp;\\cdots&amp;0\\\\1&amp;0&amp;-1&amp;0&amp;\\cdots&amp;0\\\\1&amp;0&amp;0&amp;-1&amp;\\cdots&amp;0\\\\1&amp;0&amp;0&amp;0&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\1&amp;0&amp;0&amp;0&amp;\\cdots&amp;-1\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{a}=\\begin{bmatrix}0\\\\0\\\\0\\\\0\\\\\\vdots\\\\0\\end{bmatrix}\\] 对应于 \\(\\mu_i\\) 的以下 \\(t - 1\\) 个线性无关线性组合的集合 \\(H_{0}{:}\\,\\mu_{1}-\\mu_{2}=0,\\mu_{1}+\\mu_{2}-2\\mu_{3}=0,\\mu_{1}+\\mu_{2}+\\mu_{3}-3\\mu_{4}=0,\\ldots,\\mu_{1}+\\mu_{2}+\\cdots-\\left(t-1\\right)\\mu_{t}=0\\) 的 \\(\\boldsymbol C\\) 和 \\(\\boldsymbol a\\) 向量为： \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0&amp;0&amp;\\cdots&amp;0\\\\1&amp;1&amp;-2&amp;0&amp;\\cdots&amp;0\\\\1&amp;1&amp;1&amp;-3&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;0\\\\1&amp;1&amp;1&amp;1&amp;\\cdots&amp;t-1\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{a}=\\begin{bmatrix}0\\\\0\\\\0\\\\\\vdots\\\\0\\end{bmatrix}\\] 存在许多其他矩阵使得 \\(\\boldsymbol C \\boldsymbol \\mu = \\boldsymbol 0\\) 当且仅当 \\(\\mu_1 = \\mu_2 = \\cdots = \\mu_t\\)；然而所有这些矩阵产生相同的偏离 \\(H_0\\) 的平方和以及相同的自由度 \\(t - 1\\)，因此产生相同的 \\(F\\) 统计量。对于这种特殊情况，式 (1.11) 总可以简化为： \\[\\begin{equation} SS_{H0:\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}}=\\sum_{i=1}^{t}n_{i}(\\overline{y}_{i.}-\\overline{y}_{..})^{2}=\\sum_{i=1}^{t}\\left(\\frac{y_{i.}^{2}}{n_{i}}\\right)-\\frac{y_{..}^{2}}{N} \\tag{1.12} \\end{equation}\\] 1.8 示例：任务和脉搏率（续） 对于 1.4 节中的任务和脉搏数据，使用式 (1.11) 和 (1.12) 可计算 \\(SS_{H0:\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}}\\). 使用式 (1.12) 可得到 \\[\\begin{aligned} SS_{H0}&amp; =\\frac{415^2}{13}+\\frac{373^2}{12}+\\frac{358^2}{10}+\\frac{380^2}{10}+\\frac{354^2}{12}+\\frac{317^2}{11}-\\frac{2197^2}{68} \\\\ &amp;=694.4386 \\end{aligned}\\] 自由度为 \\(t - 1 = 5\\). \\(F_c\\) 统计量的值为 \\[F_c=\\frac{694.4386/5}{30.9045}=4.49\\] 并且显著性概率为 \\(\\hat \\alpha = 0.0015\\). 然后，使用式 (1.11)，矩阵 \\(\\boldsymbol C\\)，向量 \\(\\boldsymbol a\\) 和矩阵 \\(\\boldsymbol D\\) 为 \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0&amp;0&amp;0&amp;0\\\\1&amp;0&amp;-1&amp;0&amp;0&amp;0\\\\1&amp;0&amp;0&amp;-1&amp;0&amp;0\\\\1&amp;0&amp;0&amp;0&amp;-1&amp;0\\\\1&amp;0&amp;0&amp;0&amp;0&amp;-1\\end{bmatrix},\\quad \\boldsymbol a=\\begin{bmatrix}0\\\\0\\\\0\\\\0\\\\0\\end{bmatrix}\\] \\[\\boldsymbol D=\\begin{bmatrix}\\frac{1}{13}&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;\\frac{1}{12}&amp;0&amp;0&amp;0&amp;0\\\\0&amp;0&amp;\\frac{1}{10}&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;\\frac{1}{10}&amp;0&amp;0\\\\0&amp;0&amp;0&amp;0&amp;\\frac{1}{12}&amp;0\\\\0&amp;0&amp;0&amp;0&amp;0&amp;\\frac{1}{11}\\end{bmatrix}\\] 接下来，计算式 (1.11) 中的各个量 \\[\\boldsymbol{C\\hat{\\boldsymbol{\\mu}}}-\\boldsymbol{a}=\\begin{bmatrix}0.844\\\\-3.877\\\\-6.077\\\\2.423\\\\3.105\\end{bmatrix}\\quad\\mathrm{and}\\quad\\boldsymbol{C}\\boldsymbol D\\boldsymbol{C}^{\\prime}=\\begin{bmatrix}\\frac{25}{156}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}\\\\\\frac1{13}&amp;\\frac{23}{130}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}\\\\\\frac1{13}&amp;\\frac1{13}&amp;\\frac{23}{130}&amp;\\frac1{13}&amp;\\frac1{13}\\\\\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac{25}{156}&amp;\\frac1{13}\\\\\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac1{13}&amp;\\frac{24}{143}\\end{bmatrix}\\] \\(\\boldsymbol{CDC&#39;}\\) 的逆为 \\[(\\boldsymbol{CDC&#39;})^{-1}=\\begin{bmatrix}9.882&amp;-1.765&amp;-1.765&amp;-2.118&amp;-1.941\\\\-1.765&amp;8.529&amp;-1.471&amp;-1.765&amp;-1.618\\\\-1.765&amp;-1.471&amp;8.529&amp;-1.765&amp;-1.618\\\\-2.118&amp;-1.765&amp;-1.765&amp;9.882&amp;-1.941\\\\-1.941&amp;-1.618&amp;-1.618&amp;-1.941&amp;9.221\\end{bmatrix}\\] 最后，平方和的值为 \\[SS_{H0}=(\\boldsymbol C\\hat{\\boldsymbol{\\mu}}-\\boldsymbol{a})^{\\prime}(\\boldsymbol C\\boldsymbol D\\boldsymbol{C}^{\\prime})^{-1}(\\boldsymbol{C}\\hat{\\boldsymbol{\\mu}}-\\boldsymbol{a})=694.4386\\] 这与使用式 (1.12) 计算的平方和相同。 显然，如果必须手工计算，这个公式并不容易使用。然而，在许多混乱数据的情况下，为了获得检验有意义假设的统计量，像这样的公式是必要的。幸运的是，通过利用计算机，可以为特定假设构造 \\(\\boldsymbol C\\)矩阵，然后可以让计算机进行繁琐的计算。 1.9 比较两种模型的一般方法：条件误差原理 计算检验统计量的第二个过程是比较两个模型的拟合度。在本节中，比较的两个模型是 \\(y_{ij} = \\mu_i + \\varepsilon_{ij}\\)，这叫做一般 (general) 或未缩简模型 (unreduced model)，\\(y_{ij} = \\mu_i + \\varepsilon_{ij}\\)，这是如果 \\(H_0:\\,\\mu_1 = \\mu_2 = \\cdots = \\mu_t = \\mu\\)（假设）成立时得到的模型。第一个模型称为完全模型 (full model) 或无约束模型 (unrestricted model)，第二个模型称为缩简模型 (reduced model) 或约束模型 (restricted model). 条件误差原理 (principle of conditional error) 用于比较两个模型，其中一个模型是通过对另一个模型的参数施加限制而获得的。该原理非常简单，要求获得完全模型和缩简模型的残差或误差平方和。令 \\(ESS_F\\) 表示拟合完全模型得到的误差平方和，\\(ESS_R\\) 表示拟合缩减模型得到的误差平方和。则由于假设的限制而导致的，或由于偏离零假设的平方和为 \\(SS_{H0}=ESS_R-ESS_F\\). \\(ESS_R\\) 和 \\(ESS_F\\) 的自由度由数据集中的观测总数与待估计的（基本）参数数量之差给出 [基本参数 (essential parameters) 将在第 6 章中讨论]。分别用 \\(df_R\\) 和 \\(df_F\\) 表示与 \\(ESS_R\\) 和 \\(ESS_F\\) 对应的自由度。对应于 \\(SS_{H0}\\) 的自由度为 \\(df_{H0} = df_R - df_F\\). 用于检验 \\(H_0\\) 的 \\(F\\) 统计量由下式给出： \\[F_c=\\frac{SS_{H0}/df_{H0}}{ESS_F/df_F}\\] 若 \\(F_{c}&gt;F_{\\alpha,df_{{H0}},df_{F}}\\)，则在显著性水平下拒绝 \\(H_0\\). 对于上面讨论的情况，\\(y_{ij} = \\mu_i + \\varepsilon_{ij}\\) 是完全模型而 \\(y_{ij} = \\mu + \\varepsilon_{ij}\\) 是缩简模型。完全模型的误差平方和为 \\[ESS_{F}=\\sum_{i=1}^{t}\\sum_{j=1}^{n_{i}}(y_{ij}-\\overline{y}_{i\\cdot})^{2}=(N-t)\\hat{\\sigma}^{2}\\] 其自由度 \\(df_F=N-t\\). 缩简模型的误差平方和为 \\[ESS_{_R}=\\sum_{i=1}^{t}\\sum_{j=1}^{n_{i}}(y_{_{ij}}-\\overline{y}_{\\cdot\\cdot})^{2}\\] 其自由度 \\(df_R=N-1\\). 因此，由于偏离 \\(H_0\\) 而产生的平方和为： \\[SS_{H0{:}\\,\\mu_1=\\mu_2=\\cdots=\\mu_t}=ESS_{R}-ESS_{F}=\\sum_{i=1}^{t}n_{i}(\\overline{y}_{i\\cdot}-\\overline{y}_{\\cdot\\cdot})^{2}\\] 其自由度为 \\(t-1\\). 这与式 (1.12) 得到的平方和相同。 在检验情况下感兴趣的平方和通常被放在一个叫做方差分析 (analysis of variance, ANOVA)表的表格中，这样的表格通常有类似于表 1.2 的形式，在 “source of variation” 栏下的条目被分组为多个集合。在给定的情况下，每组只使用一个标签，选择完全由实验者决定。 表 1.2: 单向模型检验均值相等的方差分析表 x 注释: df=degrees of freedom 表示自由度, SS=sum of square 表示平方和, MS=mean square 表示均方. 这些标准缩写贯穿本书 1.10 示例：任务和脉搏率（续） 条件误差原则也被称为模型比较程序，其过程相当灵活。例如，如果对检验任务和脉搏率数据的假设感兴趣，例如 \\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\mu_{3}\\,\\mathrm{~vs.~}\\,H_{a}\\colon\\,(\\mathrm{not}\\,H_{0})\\)，那么在 \\(H_0\\) 的条件下模型有如下形式 \\[\\begin{array}{ll}y_{ij}=\\mu_0+\\varepsilon_{ij}&amp;\\mathrm{~for~}i=1,2,3\\\\y_{ij}=\\mu_i+\\varepsilon_{ij}&amp;\\mathrm{~for~}i=4,5,6\\end{array}\\] 这样的模型可以使用大多数软件包来拟合，其中包含一个定性或分类变量，当任务为 \\(1,2,3\\) ，其值为 \\(0\\)，当任务为 \\(4,5,6\\) ，其值等于任务值. 1.11 计算机分析 将条件误差原理应用于 1.4 节的任务和脉搏率数据，以提供等均值假设的检验，\\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\mu_{3}=\\mu_{4}=\\mu_{5}=\\mu_{6}\\,\\mathrm{~vs.~}\\,H_{a}\\colon(\\mathrm{not}\\,H_{0})\\). 完全模型的误差平方和为 \\(ESS_F=1916.076\\), \\(df_F=62\\). 缩简模型的误差平方和为 \\(ESS_R=73593-(2197)^2/68=2610.545\\), \\(df_R=67\\). 因此，\\(SS_{H0}=2610.545-1916.076=694.439\\), \\(df_{H0}=67-62=5\\). 汇总这些计算的方差分析表如表 1.3 所示。 表 1.3: 任务和脉搏率数据检验均值相等的方差分析表 x 本章最后介绍了一些关于使用计算机和统计计算软件包（如SAS®、BMDP®、SYSTAT®、JMP®和SPSS®）的说明。前面章节中提供的所有方法和公式都可以在大多数计算机上轻松使用。如果计算机使用 MATLAB、SAS-IML 或 APL 等编程语言，则所需的矩阵计算很容易按照前面章节中给出的矩阵公式进行。SAS、JMP、BMDP、SYSTAT 和 SPSS 每个都包含程序，使用户能够生成自己的处理的线性组合，以检验假设。此外，这些包都提供了方差分析表、处理均值及其标准误的分析。表 1.4 包含 SAS-GLM 代码，其中包含检验任务和脉搏率数据所述假设所需的 estimate 语句和 contrast 的语句。estimate 语句用于评估均值的一个线性组合，提供的结果是对比的估计、其标准误估计并生成 \\(t\\) 统计量及其相应的显著性水平。contrast 语句用于评估均值的一个或多个线性组合，提供的结果是平方和、自由度和 \\(F\\) 统计量。对于SAS-GLM中的 estimate 和 contrast 语句，假设中的 \\(\\boldsymbol a\\) 的唯一值为零，也就是说，只能检验均值的线性组合等于零。 表 1.4: Proc GLM代码，用于拟合任务和脉搏率数据，并提供文本中描述的分析所需的 estimate 和 contrast 语句 x PROC GLM DATA=EX1; CLASS TASK; MODEL PULSE20=TASK/NOINT SOLUTION E; ESTIMATE ‘Ho: M4=M5’ TASK 0 0 0 1 -1 0; ESTIMATE ‘Ho: 3M1=M2+M3+M4’ TASK 3 -1 -1 -1 0 0; ESTIMATE ‘Ho: 3M1=M2+M3+M4_mn’ TASK 3 -1 -1 -1 0 0/DIVISOR=3; ESTIMATE ‘4M1-M3-M4-M5-M6_mn’ TASK 4 0 -1 -1 -1 -1/DIVISOR=4; CONTRAST ‘4M1-M3-M4-M5-M6_mn’ TASK 4 0 -1 -1 -1 -1; CONTRAST ‘M4=M5 &amp; 3M1=M2+M3+M4’ TASK 0 0 0 1 -1 0, TASK 3 -1 -1 -1 0 0; CONTRAST ‘EQUAL MEANS 1’ TASK 1 -1 0 0 0 0, TASK 1 0 -1 0 0 0, TASK 1 0 0 -1 0 0, TASK 1 0 0 0 -1 0, TASK 1 0 0 0 0 -1; 表 1.5 包含 SAS-IML 代码，为 1.6 节中检验的假设提供计算。通过用矩阵语言构造代码，可以得到 \\(\\boldsymbol C \\boldsymbol \\mu = \\boldsymbol a\\) 形式的任何假设的检验。 表 1.5: Proc IML代码执行 1.6 节中任务和脉搏率数据的计算 x 1.12 结束语 本章对单向方差分析模型进行了分析。提供了对不同处理的效应进行统计推断的一般程序，并对同质误差的情况进行了说明。介绍了获得实验设计模型的统计分析的两个基本程序。这些程序在本书的其余部分被广泛用于描述更复杂的模型设计的实验和更混乱的数据情况。还给出了同时比较所有处理效应均值的检验。这种检验可以被认为是统计分析的初始步骤。完成数据集分析所应使用的程序取决于是否拒绝处理均值相等的假设。 1.13 练习 本文将 “treatment” 统一翻译为 “处理” ，不论语境。↩︎ 本文将 “population” 统一翻译为 “总体”，不论语境。↩︎ 原文为 \\(\\alpha=100\\%\\)，应为笔误。↩︎ 原文为critical point，后同。↩︎ "],["chap2.html", "第 2 章 具有异质误差的完全随机设计结构中的单向处理结构 2.1 模型定义和假设 2.2 参数估计 2.3 方差齐性检验 2.4 示例：药物和错误 2.5 关于线性组合的推断 2.6 示例：药物和错误（续） 2.7 自由度的一般 Satterthwaite 近似 2.8 比较所有均值 2.9 结束语 2.10 练习", " 第 2 章 具有异质误差的完全随机设计结构中的单向处理结构 在本章中，考虑分配给实验单元的处理可能影响响应的方差以及均值的情况。从单向均值模型 \\(y_{ij} = \\mu_i + \\varepsilon_{ij}\\) 开始，其中 \\(i = 1,2,\\cdots,t;\\,j =1,2,\\cdots,n_i\\). 在第 1 章中，假设实验误差都具有相同的方差；也就是说，预期处理可能会改变抽样总体的均值，但不会改变方差。当处理影响方差和均值时，本章描述了一些分析数据的方法。在这种情况下，实验者想要回答的关于平均值的问题类型与第 1 章中的类似。也就是说， 所有均值都相等吗？ 是否可以在均值之间进行成对比较？ 是否可以检验形如 \\(\\sum_{i=1}^tc_i\\mu_i=a\\) 的假设并为 \\(\\sum_{i=1}^tc_i\\mu_i\\) 构造置信区间？ 此外，关于方差还存在可能感兴趣的问题，例如 所有方差都相等吗？ 是否存在组内方差相等而组间方差不相等的处理分组？ 在回答有关模型均值的问题之前，必须获得处理方差的适当描述。 方差齐性检验 (tests of homogeneity of variances) 用于回答有关各个处理的数据方差的问题。如果有两种处理，当方差不等时比较均值的问题通常被称为 Behrens–Fisher 问题。此外，异质误差方差被忽略比数据的非正态性带来了更严重的问题5。第一章中的程序在非正态性方面是稳健的，但在异质误差方差方面不是那么稳健。在之前考虑的分析中，假设总体方差都相等，这在许多情况下是合理的假设。当方差不相等时，分析数据的一种方法是简单地忽略它们不相等的事实，并计算在方差相等的情况下计算的相同的 \\(F\\) 统计量或 \\(t\\) 检验。也许令人惊讶的是，模拟研究表明，这些通常的检验都非常好，特别是当样本量都相等或几乎相等时。此外，如果较大的样本量对应于具有较大方差的处理或总体，那么用等方差假设计算的检验也相当好。事实上，通常的检验非常好，以至于许多统计学家甚至不建议对等方差进行检验。其他人试图找到一种能稳定处理方差的变换，即通过变换数据使处理方差相等。当方差不相等时，有一些技术可以在不等方差模型的框架内对均值进行比较。 以下小节描述了单向模型的处理方差相等性的检验程序，以及当方差不相等时分析处理均值的程序。当怀疑通常的技术时，应使用这些程序。接下来描述不等方差模型。 2.1 模型定义和假设 不等方差模型为 \\[\\begin{equation} y_{ij}=\\mu_{i}+\\varepsilon_{ij}\\quad\\mathrm{for}\\quad i=1,2,\\ldots,t,\\,j=1,2,\\ldots,n_{i}\\quad\\mathrm{and}\\quad\\varepsilon_{ij}\\sim\\text{independent}\\,N(0,\\sigma_{i}^{2}) \\tag{2.1} \\end{equation}\\] 其中 \\(\\varepsilon_{ij}\\sim\\text{independent}\\,N(0,\\sigma_{i}^{2})\\) 表示误差 \\(\\varepsilon_{ij}\\) 都是独立地服从正态分布，并且每个正态分布的方差取决于 \\(i\\)，对于每个总体或处理可能不同。 2.2 参数估计 模型中参数的最佳估计值： \\[\\hat{\\mu}_i=\\sum_{j=1}^{n_i}y_{ij}/n_i=\\bar{y}_{i\\cdot},\\quad i=1,2,\\ldots,t\\] 和 \\[\\hat\\sigma_i^2=\\frac{\\sum_{j=1}^{n_i}(y_{ij}-\\overline{y}_i)^2}{n_i-1},\\quad i=1,2,\\ldots,t\\] 与参数估计相关的抽样分布为 \\[\\hat{\\mu}_i\\thicksim\\text{independent}\\,N(\\mu_i,\\sigma_i^2/n_i),\\quad i=1,2,\\ldots,t\\] 和 \\[\\frac{\\left(n_i-1\\right)\\hat\\sigma_i^2}{\\sigma_i^2}\\thicksim\\text{independent }\\,\\chi_{n_i-1}^2,\\quad i=1,2,\\ldots,t\\] 这些抽样分布被用作建立方差相等性检验的基础，并在方差不相等时提供均值分析。 2.3 方差齐性检验 本节描述了检验等方差假设的五个程序 \\[H_{0}\\colon\\,\\sigma_{1}^{2}=\\sigma_{2}^{2}=\\cdots=\\sigma_{t}^{2}\\,\\mathrm{~vs.~}\\,H_{a}\\colon(\\mathrm{not~}H_{0}:)\\] 在尝试分析均值之前，应研究等方差假设。如果没有足够的证据得出方差不相等的结论，则可以使用第 1 章中的等方差模型来研究均值。如果有足够的证据认为方差不相等，则应使用 2.5 节中描述的程序来提供不等方差框架中的均值分析。建议当不等方差假设在 \\(\\alpha\\le0.01\\) 时被拒绝时使用不等方差模型。 2.3.1 Hartley’s F-Max Test 所描述的第一个检验被称为 Hartley’s F-max检验 (Hartley, 1950). 该检验要求所有样本具有相同的大小，即 \\(n_1 = n_2 = \\cdots= n_t\\). 该检验基于统计量 \\[F_{\\max}=\\frac{\\max_i\\{\\hat\\sigma_i^2\\}}{\\min_i\\{\\hat\\sigma_i^2\\}}\\] 附表 A.1 提供了 \\(\\alpha = 0.05\\) 和 \\(0.01\\) 时 \\(F_{\\max}\\) 的百分位点。若 \\(F_{\\max} &gt; F_{\\max,\\alpha,v,k}\\)，其中 \\(v = n - 1\\) 为与 \\(k\\) 个处理方差中的每一个相关的自由度，则拒绝零假设 \\(H_0\\). 如果 \\(n_i\\) 不都相等，则可以通过取 \\(n=\\max_i\\{n_i\\}-1\\) 来获得 \\(H_0\\,\\mathrm{~vs.~} H_a\\) 的“自由” (liberal)检验。这个检验是自由的，因为它假设所有处理都有相同的（最大）样本量，所以你会比选定的显著性水平 \\(\\alpha\\) 更频繁地拒绝零假设6。当样本量相差不大7时，此程序提供了合理的检验。它还可以防止人们进行通常的方差分析，即使方差分析不合适的可能性极小。{#sec2-4} 节中有一个说明该检验使用的示例。 2.3.2 Bartlett’s Test 方差齐性检验的第二个检验是 (Bartlett, 1937) 提出的检验，其优点是不要求 \\(n_i\\) 相等。Bartlett 检验统计量为 \\[\\begin{equation} U=\\frac1C{\\left[v\\log_\\mathrm{e}(\\hat\\sigma^2)-\\sum_{i=1}^tv_i\\log_\\mathrm{e}(\\hat\\sigma_i^2)\\right]} \\tag{2.2} \\end{equation}\\] 其中 \\[v=n_i-1,\\quad v=\\sum_{i=1}^tv_i,\\quad\\hat\\sigma^2=\\sum_{i=1}^tv_i\\hat\\sigma_i^2/v \\] 且 \\[C=1+\\frac1{3(t-1)}{\\left[\\sum_{i=1}^t\\frac1{v_i}-\\frac1v\\right]}\\] 如果 \\(U&gt;\\chi_{\\alpha,t-1}^2\\)，则拒绝等方差假设。方差齐性的前两个检验的缺点之一是它们对偏离正态性以及偏离等方差假设非常敏感。 2.3.3 Levene’s Test Levene (1960) 建议对来自单向均值或效应模型的残差绝对值进行单向方差分析。残差绝对值由 \\(z_{ij}=|y_{ij}-\\overline{y}_{i\\cdot}|,i=1,2,\\ldots,t;j=1,2,\\ldots,n_{i}\\) 给出。方差分析的 \\(F\\) 检验提供残差绝对值的处理均值相等性检验。如果均值不等，则有证据表明，一种处理的残差平均而言大于另一种处理的残差。残差可以指导哪些方差不相等，多重比较检验（见第 3 章）可以用来对这些均值进行成对比较。Levene’s Test 的一个改进是在方差分析中使用残差平方。 2.3.4 Brown and Forsythe’s Test Brown and Forsythe (1974) 使用 Levene 的过程，并通过对每个处理的观察值与中位数的偏差的绝对值进行单向方差分析来对其进行修改。中位数偏差的绝对值由 \\(u_{ij}=|y_{ij}-y_{i\\mathrm{med}}|,i=1,2,\\ldots,t;j=1,2,\\ldots,n_{i}\\) 给出。方差分析的 \\(F\\) 检验提供了偏差绝对值的处理均值相等性检验。如果均值不等，则有证据表明，一种处理的偏差平均而言大于另一种处理的偏差。偏离中位数的绝对值的均值可以提供关于哪些方差不等的指导，因为多重比较检验可以用于在这些均值之间进行成对比较。当数据的分布不对称时，这种利用中位数偏差的方法提供了比 Levene’s method 更大的功效。 2.3.5 O’Brien’s Test O’Brien (1979) 计算了一种得分 \\[\\begin{equation} r_{ij}=[(w+n_i-2)n_i(y_{ij}-\\overline{y}_{i\\cdot})^2-w\\hat\\sigma_i^2(n_i-1)]/[(n_i-1)(n_i-2)] \\tag{2.3} \\end{equation}\\] 其中 \\(w\\) 为权重参数。该程序是对计算出的得分进行方差分析。当 \\(w=0.5\\) 时，得分的均值是样本方差 \\(\\hat \\sigma^2_i\\)，因此得分均值的比较是数据方差的比较。 还有其他几种程序可用于使用参数和非参数方法来检验方差相等或尺度参数相等 [如 Conover et al. (1981) 和 Olejnik &amp; Algina (1987)]。McGaughey (2003) 提出了一种使用数据深度 (data depth) 概念的检验，并将该程序应用于单变量和多变量总体。数据深度超出了本书的范围。 2.3.6 一些建议 Conover (1981) 以及 Olejnik &amp; Algina (1987) 对方差检验的同质性进行了模拟研究，其中包括上述检验以及许多其他检验。研究表明，没有一种检验对所有情况都是稳健和具有最大功效的。根据 Olejnik 和 Algina，Levene’s Test 是 Conover 等人研究的更好的检验之一。O’Brien’s Test 似乎提供了一个合适的大小检验 (size test)，而不会损失太多功效。当分布具有重尾 (heavy tails) 时，Brown–Forsyth’s Test 似乎更好。根据他们的结果，我们提出以下建议： 如果分布具有较重的尾部，请使用 Brown–Forsyth’s test. 如果分布有些偏斜，请使用 O’Brien’s test. 如果数据几乎是正态分布的，那么任何检验都是合适的，包括 Bartlett’s 和 Hartley’s tests. Levene’s 和 O’Brien’s tests 可以很容易地进行定制，用于涉及多个因素的设计实验，包括协方差分析 (Milliken and Johnson, 2002). Levene’s, O’Brien’s 和 Brown–Forsyth’s tests 在正态分布数据方面几乎与 Bartlett’s 和 Hartley’s tests 一样好，在非正态分布的数据方面优于它们。Conover et al. 以及 Olejnik 和 Algina 讨论了一些非参数检验，但它们更难计算，并且上述推荐的检验几乎同样有效。下面是一个示例，其中演示了用于方差相等的每个检验。 2.4 示例：药物和错误 表 2.1 中的数据来自在两种可能的药物影响下对个体8进行的配对联想学习任务 (paired-association learning task) 实验。第1组为对照组（无药物），第2组给药1，第3组给药2，第4组同时给两种药。每组数据的样本量、总和、中位数、平均值和方差见表 2.1。 表 2.1: 配对联想学习任务实验数据 x F-max 统计量为 \\(F_\\max=16.286/1.867=8.723\\). 取 \\(k=t=4,v=7\\) 的自由 \\(5\\%\\) 临界点从表 A.1 得到。临界点为 \\(8.44\\)，由于 \\(8.723&gt;8.44\\)，以 \\(0.05\\) 的显著性水平拒绝 \\(H_{0}\\colon\\,\\sigma_{1}^{2}=\\sigma_{2}^{2}=\\cdots=\\sigma_{t}^{2}\\,\\mathrm{~vs.~}\\,H_{a}\\colon(\\mathrm{not~}H_{0}:)\\)，但不能在 \\(0.01\\) 的水平拒绝。 Bartlett’s test 的计算为： \\[C=1+\\frac1{3\\times3}{\\left(\\frac16+\\frac15+\\frac17+\\frac17-\\frac1{25}\\right)}\\] 且 \\[\\hat\\sigma^2=\\frac{6(16.2857)+5(1.8667)+7(9.6964)+7(2.7860)}{25}=7.7769\\] 因此 \\[\\begin{aligned} U&amp; =\\frac1C{\\left(v\\log_e\\hat\\sigma^2-\\sum_{i=1}^4v_i\\log_e\\hat\\sigma_i^2\\right)} \\\\ &amp;=\\frac1{1.068}[25\\log_{\\mathrm{e}}(7.7769)-6\\log_{\\mathrm{e}}(16.2857)-5\\log_{\\mathrm{e}}(1.8667) \\\\ &amp;-7\\log_{\\mathrm{e}}(9.6964)-7\\log_{\\mathrm{e}}(2.7860)] \\\\ &amp;=7.8111 \\end{aligned}\\] 与 \\(U\\) 相关的渐近抽样分布是基于自由度为 \\(3\\) 的卡方分布，检验的显著性水平为 \\(0.0501\\)，可以再次得出结论，方差在大约 \\(5\\%\\) 的显著性水平上是不相等的。 Levene’s test 的计算从残差或观测值与处理均值的偏差的计算开始。接下来，如表 2.2 所示计算残差的绝对值。最后，对残差的这些绝对值进行单向方差分析。所得到的 \\(F\\) 统计量的值为 \\(6.97\\)，其基于自由度 \\(3,25\\)。观察到的 Levene’s test 的显著性水平为 \\(0.0015\\). 在进行方差分析之前，可以通过对表 2.2 中的项目进行平方来获得 Levene’s test 的平方偏差或平方残差版本。在这种情况下，\\(F\\) 统计量的值为 \\(7.36\\)，观察到的显著水平为 \\(0.0011\\)（也基于自由度 \\(3,25\\)）。 表 2.2: 计算 Levene’s test 的 \\(z_{ij} = |y_{ij}-y_{i\\cdot}|\\) 值，其中 \\(y_{ij}\\) 来自表 2.1 x Brown–Forsyth’s test 统计量是通过计算观察值与处理中位数偏差的绝对值（中位数见表 2.1）获得的。表 2.3 包含了与中位数偏差的绝对值。接下来，单向方差分析提供的 \\(F\\) 统计量为 \\(5.49\\)，并且观察到的显著性水平是 \\(0.0049\\)（也基于自由度 \\(3,25\\)）。 表 2.3: 观测结果相对于处理中位数偏差的绝对值 x 表 2.4 包含使用式 (2.3) 计算的 \\(r_{ij}\\) 值，其中 \\(w = 0.5\\). 通过进行方差分析获得 O’Brien’s test 统计量。\\(F\\) 统计量的值为 \\(6.30\\)，观察到的显著性水平为 \\(0.0025\\). 使用 \\(w = 0.7\\)（计算未显示）的 \\(F\\) 统计量值为 \\(5.90\\)，观察到的显著性水平为 \\(0.0035\\). 每个 O’Brien’s test 都基于自由度 \\(3,25\\). 表 2.4: 使用 \\(w=0.5\\) 进行 O’Brien’s Test 的得分 x 每个检验统计量表明，有足够的证据得出方差不相等的结论。残差绝对值的组均值见表 2.5。这些处理的残差绝对值均值之间的成对比较见表 2.6。无药物和药物2的残差绝对值的平均值没有差异，药物1和同时给药没有差异，但是这两组之间存在差异。可以使用具有两个方差的简单模型来继续分析治疗均值。使用简单方差模型将提高一些关于均值检验的功效。两个方差模型和相应的均值比较将遵循使用四个方差的分析的讨论。 表 2.5: 残差绝对值均值 x 表 2.6: 残差绝对值组均值的成对比较 x 2.5 关于线性组合的推断 当方差 \\(\\sigma_i^2\\) 相差很大而无法应用第 1 章中讨论的检验和置信区间时，本节讨论了处理均值的任意线性组合 \\(\\sum_{i=1}^tc_i\\mu_i\\) 的假设检验和置信区间的构造问题。如果方差相等假设在 \\(0.01\\) 或 \\(1\\%\\) 水平被拒绝，建议使用本节和下一节中的程序。如果没有足够的证据证明方差不等，则可以使用第 1 章中的结果对处理均值进行推断。 \\(\\sum_{i=1}^tc_i\\mu_i\\) 的最佳估计为 \\(\\sum_{i=1}^tc_i\\hat \\mu_i\\)，其抽样分布为 \\[\\sum_{i=1}^tc_i\\hat{\\mu}_i\\sim N{\\left(\\sum_{i=1}^tc_i\\mu_i,\\sum_{i=1}^tc_i^2\\sigma_i^2/n_i\\right)}\\] 因此 \\[z=\\frac{\\sum_{i=1}^{t}c_{i}\\hat{{\\mu}}_{i}-\\sum_{i=1}^{t}c_{i}\\mu_{i}}{\\sqrt{\\sum_{i=1}^{t}c_{i}^{2}\\sigma_{i}^{2}/n_{i}}}\\sim N(0,1)\\] 当方差未知且不等时，一个明显可用于推断 \\(\\sum_{i=1}^tc_i\\mu_i\\) 的统计量为 \\[z=\\frac{\\sum_{i=1}^tc_i\\hat{\\mu}_i-\\sum_{i=1}^tc_i{\\mu}_i}{\\sqrt{\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2/n_i}}\\] 如果非零 \\(c_i\\) 对应的 \\(n_i\\) 都非常大，则可以合理地假设 \\(Z\\) 具有近似 \\(N(0,1)\\) 分布，因此 \\(Z\\) 可以用于推断 \\(\\sum_{i=1}^tc_i\\mu_i\\). 此时 \\(\\sum_{i=1}^tc_i\\mu_i\\) 的近似 \\((1 - \\alpha)100\\%\\) 置信区间由下式提供： \\[\\sum_{i=1}^tc_i\\hat{\\mu}_i\\pm z_{\\alpha/2}\\sqrt{\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2/n_i}\\] 如果\\(|z| &gt; z_{\\alpha/2}\\)，则在显著性水平 \\(\\alpha\\) 处拒绝 \\(H_0\\). 在其他情况下，注意 \\(z\\) 可以写为 \\[z=\\frac{\\left(\\sum_{i=1}^tc_i\\hat{{\\mu}}_i-\\sum_{i=1}^tc_i\\mu_i\\right)\\Big/\\sqrt{\\sum_{i=1}^tc_i^2\\sigma_i^2/n_i}}{\\sqrt{\\sum_{i=1}^tc_i^2\\hat{\\sigma}_i^2/n_i}\\Big/\\sqrt{\\sum_{i=1}^tc_i^2\\sigma_i^2/n_i}}\\] \\(z\\) 的分子具有标准正态分布，\\(z\\) 的分子和分母独立。\\(z\\) 的分布可以近似为 \\(t(v)\\) 分布，如果 \\(v\\) 的值可以使得 \\[V=v\\times\\frac{\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2\\big/n_i}{\\sum_{i=1}^tc_i^2\\sigma_i^2\\big/n_i}\\] 近似服从 \\(\\chi^2(v)\\). 为了在方差不等时得到 \\(V\\) 的分布的良好卡方近似，选择具有与 \\(V\\) 相同的前两阶矩的卡方分布。也就是说，为了在方差不等的情况下找到 \\(v\\)，求出 \\(v\\) 使得 \\(V\\) 的矩等于 \\(\\chi^2(v)\\) 分布的前两阶矩（这就是所谓的 Satterthwaite’s method ）。这导致自由度为： \\[{v}=\\frac{\\left(\\sum_{i=1}^tc_i^2\\sigma_i^2/n_i\\right)^2}{\\sum_{i=1}^t\\left[c_i^4\\sigma_i^4/n_i^2(n_i-1)\\right]}\\] 不幸的是，由于 \\(v\\) 取决于 \\(\\sigma_1^2,\\sigma_2^2,\\ldots,\\sigma_t^2\\)，因此无法精确确定。通常的程序是通过下式来估计 \\(v\\)： \\[\\begin{equation} \\hat{{v}}=\\frac{\\left(\\sum_{i=1}^tc_i^2\\hat{\\boldsymbol\\sigma}_i^2/n_i\\right)^2}{\\sum_{i=1}^t\\left[c_i^4\\hat{\\sigma}_i^4/n_i^2(n_i-1)\\right]} \\tag{2.4} \\end{equation}\\] 综上所述，拒绝 \\(H_0\\colon\\sum_{i=1}^tc_i\\mu_i=a\\,\\mathrm{~vs.~}H_a{:}\\sum_{i=1}^tc_i\\mu_i\\neq a\\)，如果 \\[\\left|t_c\\right|=\\frac{\\left|\\sum_{i=1}^tc_i\\hat{\\mu}_i-a\\right|}{\\sqrt{\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2/n_i}}&gt;t_{\\alpha/2,\\hat{v}}\\] 其中 \\(\\hat v\\) 由式 (2.4) 确定。\\(\\sum_{i=1}^tc_i\\mu_i\\) 近似 \\((1 - \\alpha)100\\%\\) 置信区间由下式给出 \\[\\sum_{i=1}^tc_i\\hat{\\mu}_i\\pm t_{\\alpha/2,\\hat{v}}\\sqrt{\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2/n_i}\\] 不幸的是，每当人们想要检验一个新的假设或构造另一个置信区间时，自由度 \\(\\hat v\\) 必须重新估计。可以证明 \\(n_*-1\\leq\\hat{v}\\leq t(n^*-1)\\) 其中 \\(n_*=\\min\\{n_1,n_2,\\ldots,n_t\\}\\) 且 \\(n^*=\\max\\{n_1,n_2,\\ldots,n_t\\}\\). 因此，如果 \\(|t_c|&gt;t_{\\alpha/2,n_*-1}\\)，则可以保证 \\(|t_c|&gt;t_{\\alpha/2,\\hat{v}}\\)；如果 \\(|t_c|&lt;t_{\\alpha/2,t(n^*-1)}\\)，则可以保证 \\(|t_c|&lt;t_{\\alpha/2,\\hat{v}}\\). 此时我们可以避免计算 \\(\\hat v\\). 当 \\(t_{\\alpha/2,t(n^*-1)}&lt;|\\left.t_c\\right|&lt;t_{\\alpha/2,n^*-1}\\)，为了确定是否应该拒绝或不拒绝被检验的零假设，必须计算 \\(\\hat v\\) 的值。为了获取置信区间，通常需要计算 \\(\\hat v\\). 接下来，用药物误差的示例来证明前面的结果。 2.6 示例：药物和错误（续） 考虑表 2.1 中的数据，假设实验者有兴趣回答以下问题： 平均而言，药物对学习有任何影响吗？ 当给予两种药物时，个体犯的错误是否比只给予一种药物时更多？ 两种药物对错误数量的影响是否不同？ 为了回答第一个问题，可以检验三个药物组的均值等于对照组均值的假设。 \\[H_{01}{:}\\,l_1=\\mu_1-\\frac{(\\mu_2+\\mu_3+\\mu_4)}3=0\\mathrm{~vs~}H_{a1}{:}\\,l_1\\neq0\\] 该线性组合的估计为 \\[\\hat{l}_1=\\hat{\\mu}_1-\\frac{\\hat{\\mu}_2+\\hat{\\mu}_3+\\hat{\\mu}_4}3=4.571-\\frac13(34.042)=-6.776\\] \\(\\hat l_1\\) 相应的标准误估计为 \\[\\begin{aligned} s.e.(\\hat{l}_1)&amp; =\\sqrt{\\sum_{i=1}^4\\left(\\frac{c_i^2\\hat\\sigma_i^2}{n_i}\\right)} \\\\ &amp;=\\sqrt{\\frac{\\hat\\sigma_1^2}7+\\frac19{\\left(\\frac{\\hat\\sigma_2^2}6\\right)}+\\frac19{\\left(\\frac{\\hat\\sigma_3^2}8\\right)}+\\frac19{\\left(\\frac{\\hat\\sigma_4^2}8\\right)}}\\\\ &amp;=\\sqrt{2.535}\\\\ &amp;=1.592 \\end{aligned}\\] 与此标准误估计相关的近似自由度通过使用 \\[\\sum_{i=1}^4\\frac{c_i^4\\hat\\sigma_i^4}{n_i^2(n_i-1)}=0.9052\\] 使得 \\[\\hat{v}=\\frac{(2.535)^2}{0.9052}=7.10\\] 检验统计量的值为 \\(t_c=-6.776/1.992=-4.256\\)，观察到的显著性水平为 \\(\\hat \\alpha= 0.0038\\). \\(l_1\\) 的 \\(95\\%\\) 置信区间为 \\[\\hat{l}_1\\pm t_{\\alpha/2,\\hat{v}}\\times\\widehat{s.e.}(\\hat{l}_1)=-6.776\\pm(2.365)(1.592)\\] 简化为 \\[-10.54&lt;\\mu_1-\\frac{\\mu_2+\\mu_3+\\mu_4}3&lt;-3.01\\] 下一个检验是看给予两种药物组的均值是否等于两种药物组的均值的均值。也就是检验 \\[H_{02}\\colon l_2=\\mu_4-\\frac{\\mu_2+\\mu_3}2=0\\,\\mathrm{~vs.~}H_{a2}{:}\\,l_2\\neq0\\] 该线性组合的估计为 \\[\\hat l_2=\\hat{\\mu}_4-\\frac{\\hat{\\mu}_2+\\hat{\\mu}_3}2=3.6042\\] 其估计标准误为 \\[\\begin{aligned} \\widehat{s.e.}(\\hat{l}_{2})&amp; =\\sqrt{\\sum_{i=1}^4\\left(\\frac{c_i^2\\hat\\sigma_i^2}{n_i}\\right)} \\\\ &amp;=\\sqrt{\\frac14\\!\\left(\\frac{\\hat\\sigma_2^2}6\\right)+\\frac14\\!\\left(\\frac{\\hat\\sigma_3^2}8\\right)+\\left(\\frac{\\hat\\sigma_4^2}8\\right)}\\\\ &amp;=\\sqrt{0.7290}\\\\ &amp;=0.8538 \\end{aligned}\\] 检验统计量的值为 \\(t_c = 3.6042/0.8538 = 4.221\\)，因为 \\(|t_c|&gt;t_{0.005,5}\\) 它在 \\(\\alpha=0.01\\) 水平下显著。此时 \\(\\hat v\\) 的值不需要用 \\(n_ *-1\\) 作为近似自由度来计算，计算出的 \\(\\hat v\\) 的值为 \\(16.8\\) ，这是构造 \\(l_2\\) 置信区间所需要的 最后，为了检验假设以查看两种药物的均值是否不同，检验 \\(H_0{:}\\,l_3 = \\mu_2 - \\mu_3 = 0 \\,\\mathrm{~vs.~} H_a{:}\\,l_3 = \\mu_2 - \\mu_3 \\ne 0\\). 该线性组合的估计值为 \\(\\hat l_3 = \\hat\\mu_2 - \\hat\\mu_3=3.042\\)，其标准误估计为 \\[\\widehat{s.e.}(\\hat{l}_3)=\\sqrt{\\sum_{i=1}^4\\left(\\frac{c_i^2\\hat\\sigma_i^2}{n_i}\\right)}=\\sqrt{\\left(\\frac{\\hat\\sigma_2^2}{6}\\right)+\\left(\\frac{\\hat\\sigma_3^2}8\\right)}=\\sqrt{1.523}=1.234\\] 近似自由度的计算通过使用： \\[\\sum_{i=1}^4\\frac{c_i^4\\hat\\sigma_i^4}{n_i^2(n_i-1)}=0.229\\] 使得 \\[\\hat{v}=\\frac{(1.523)^2}{0.229}=10.1\\] 因此，\\(t_c = 3.042/1.234 = 2.465\\)，观察到的显著性水平为 \\(\\hat\\alpha = 0.0334\\). 2.7 自由度的一般 Satterthwaite 近似 与估计标准误差相关的自由度的 Satterthwaite 近似由下式获得 \\[v=\\frac{2*(E\\{[\\widehat{s.e.}(\\hat{l})]^2\\})^2}{\\mathrm{Var}\\{[\\widehat{s.e.}(\\hat{l})]^2\\}}\\] 其中 \\([\\widehat{s.e.}(\\widehat{l})]^2\\) 用于估计 \\(E[s.e.(\\hat{l})]^2\\)，且 \\(\\mathrm{Var}[\\widehat{s.e.}(\\hat{l})]^2\\) 的值由 \\(\\sum_{i=1}^t\\left[c_i^4\\sigma_i^4/n_i^2(n_i-1)\\right]\\) 估计。对于更复杂的模型，\\(\\mathrm{Var}[\\widehat{s.e.}(\\widehat{l})]^2\\) 可以通过使用一阶泰勒级数 (Kendall and Stuart, 1952) 近似为 \\(\\boldsymbol q&#39;\\boldsymbol M \\boldsymbol q\\)，其中 \\(\\boldsymbol M\\) 是方差估计的渐近协方差矩阵估计，向量 \\(\\boldsymbol q\\) 的元素是 \\(E[s.e.(\\hat{l})]^2\\) 关于单个方差的一阶导数，即9 \\[q_{i}=\\frac{\\partial E[(s.e.(\\hat{l})]^{2}}{\\partial\\sigma_{i}^{2}},\\quad i=1,2,\\ldots,t\\] 根据各处理方差的估计值评估 \\(q_i\\) (Montgomery and Runger, 1993, 1994). 当每个样本的数据呈正态分布时，则 \\[\\frac{(n_i-1)\\hat\\sigma_i^2}{\\sigma_i^2}\\] 为中心卡方随机变量。因此 \\(E(\\hat\\sigma_i^2)=\\sigma_i^2\\) 且 \\(\\operatorname{Var}(\\hat\\sigma_i^2)=2\\sigma_i^4/(n_i-1)\\). 令感兴趣的线性组合为 \\(l=\\sum_{i=1}^{t}c_{i}\\mu_{i}\\)，其方差为 \\(\\sigma_{l}^{2}=\\sum_{i=1}^{t}c_{i}^{2}\\sigma_{i}^{2}/n_{i}\\)，则 \\(\\sigma_{l}^{2}\\) 关于 \\(\\hat \\sigma_{i}^{2}\\) 的偏导数为 \\[\\frac{\\partial\\sigma_l^2}{\\partial\\sigma_i^2}=\\frac{c_i^2}{n_i}\\] 使用泰勒级数一阶近似获得的 \\(\\sigma_{l}^{2}\\) 的近似方差为 \\[\\mathrm{Var}(\\sigma_l^2)=\\sum_{i=1}^t\\left[\\left[\\frac{c_i^2}{n_i}\\right]^2\\left[\\frac{2\\sigma_i^4}{n_i-1}\\right]\\right]^2\\] 下一步是用提供近似自由度的相应样本估计值替换总体方差 \\[\\hat{v}=\\frac{2*\\left(E\\{[\\widehat{s.e.}(\\hat{l})]^2\\}\\right)^2}{\\mathrm{Var}\\{[\\widehat{s.e.}(\\hat{l})]^2\\}}=\\frac{\\left(\\sum_{i=1}^tc_i^2\\hat\\sigma_i^2\\right)^2}{\\sum_{i=1}^tc_i^4\\hat\\sigma_i^4/[n_i^2(n_i-1)]}\\] 与上述 Satterthwaite 近似相同。 2.8 比较所有均值 如前所述，当方差不等时，通常的 \\(F\\) 检验非常稳健，前提是样本量几乎相等，或者假设较大的样本量对应于方差差异较大的总体样本。本节提供了两个等均值假设的附加检验。等均值假设的第一个检验 \\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\,\\mathrm{~vs.~}H_{a}\\colon\\,(\\operatorname{not}H_{0}{:})\\) ，由 Welch (1951) 给出，称为 Welch’s test。定义权重 \\(W_{i}=n_{i}/\\hat\\sigma_{i}^{2}\\)，令 \\(\\bar{y}^{*}=\\sum_{i=1}^{t}W_{i}\\bar{y}_{i\\cdot}\\big/\\sum_{i=1}^{t}W_{i}\\) 为样本均值的加权平均值，令 \\[\\Lambda=\\sum_{i=1}^{t}\\frac{(1-W_{i}/W_{\\cdot})^{2}}{n_{i}-1}\\] 其中 \\(W_\\cdot=\\sum_{i=1}^tW_{i\\cdot}\\). 那么 Welch’s test 统计量为 \\[\\begin{equation} F_c=\\frac{\\sum_{i=1}^tW_i\\frac{(\\bar{y}_i.-\\bar{y}^*)}{(t-1)}}{1+2(t-1)\\Lambda/(t^2-1)} \\tag{2.5} \\end{equation}\\] 它具有近似的 \\(F\\) 分布，分子分母自由度分别为 \\(v_{1}=t-1,\\,v_{2}=(t^{2}-1)/3\\Lambda\\). 因此当 \\(F_{c}&gt;F_{\\alpha,v_{1},v_{2}}\\)，拒绝零假设 \\(H_{0}\\colon\\,\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\). 式 (2.5) 的分子也可以计算为：\\([\\sum_{i=1}^{t}W_{i}\\bar{y}_{i\\cdot}^{2}-\\overline{W}\\bar{y}^{*2}]/(t-1)\\). 该程序使用 2.7 节中的数据进行了演示，初步计算见表 2.7. 表 2.7: 计算 Welch’s test 的量 x 根据以上信息计算 \\(W_\\cdot=7.341,\\bar{y}^{*}=11.724\\) \\[\\Lambda=\\frac{(1-0.430/7.341)^2}6+\\frac{(1-3.214/7.341)^2}5+\\frac{(1-0.825/7.341)^2}7+\\frac{(1-2.872/7.341)^2}7=0.376\\] 且 \\(\\sum_{i=1}^{t}W_{i}\\left.\\bar{y}_{i\\cdot}^{2}-\\overline{W}\\right.\\bar{y}^{*2}=1050.8069-1009.0954=43.7114\\). Welch’s test 统计量的值为 \\[F_c=\\frac{41.7114/3}{1+2\\times2\\times0.376/15}=\\frac{13.9038}{1.1003}=12.6355\\] 自由度为 \\(v_1=3,v_2=15/(3×0.376) = 13.283\\). 观察到的 \\(F_c\\) 相应的显著性概率为 \\(\\hat \\alpha=0.00035\\). 出于比较目的，通常的 \\(F\\) 统计量 \\(F_c=14.91\\)，自由度为 \\(3,25\\). Welch’s test 可以使用 SAS®GLM 通过在 MEANS 语句中指定 Welch 选项来获得。表 2.8 包含 GLM 代码，用于提供方差相等的 BF 检验和均值相等的 Welch 检验。部分重要结果见表 2.8 的第二部分。其他方差相等的检验可以通过指定 O'Brien、Levene 或 Bartlett 来获得。 表 2.8: SAS-GLM 代码提供 Brown-Forsythe 方差齐性检验和 Welch 方差齐性检验 x 检验处理均值相等的第二个程序是将检验一组处理均值 \\(\\mu_i\\) 线性组合假设的过程加以推广。 设一个假设是由 \\(r\\) 个独立的 \\(\\mu_i\\) 的线性组合组成的，例如 \\(H_{0}\\colon\\,\\sum_{i=1}^{t}c_{1i}\\mu_{i}=0,\\sum_{i=1}^{t}c_{2i}\\mu_{i}=0,\\ldots,\\sum_{i=1}^{t}c_{ri}\\mu_{i}=0\\,\\mathrm{~vs.~}H_{a}:(\\mathrm{not}\\,H_{0})\\). 设 \\(\\boldsymbol C\\) 是一个矩阵，其第 \\(k\\) 行是第 \\(k\\) 个线性组合的系数，若假定每个总体或处理的数据均服从正态分布，则处理均值向量的联合抽样分布为 \\(\\hat{\\boldsymbol{\\mu}}\\sim N[\\boldsymbol{\\mu},\\boldsymbol V]\\)，其中 \\(\\boldsymbol V\\) 是一个对角阵，其第 \\(i\\) 个对角元素为 \\(\\sigma^2_i /n_i\\). 线性组合集 \\(\\boldsymbol C \\boldsymbol \\mu\\) 的联合抽样分布为 \\(\\boldsymbol{C\\hat{\\boldsymbol{\\mu}}}\\sim N[\\boldsymbol{C\\mu},\\boldsymbol{CV}\\boldsymbol{C}^{\\prime}]\\). 与零假设的偏差导致的平方和为 \\(SSH_{0} = [\\boldsymbol C\\hat{\\boldsymbol{\\mu}}]^{\\prime}[\\boldsymbol C\\hat{\\boldsymbol V}\\boldsymbol C^{\\prime}]^{-1}[\\boldsymbol C\\hat{\\boldsymbol{\\boldsymbol \\mu}}]\\)，其渐近分布为具有 \\(r\\) 个自由度的卡方分布。近似小样本量统计量为 \\(F_c = SSH_ 0/r\\)，近似分布为 \\(F\\)，自由度为 \\(r,v\\)，其中 \\(v\\) 需要近似 (Fai and Cornelius, 1996; SAS Institute, Inc., 1999, p. 2118). 近似自由度的计算开始于对 \\(\\boldsymbol C \\hat {\\boldsymbol V} \\boldsymbol C&#39; = \\boldsymbol Q \\boldsymbol D \\boldsymbol Q&#39;\\) 执行谱分解，其中 \\(\\boldsymbol D\\) 是具有 \\(\\boldsymbol C \\hat {\\boldsymbol V} \\boldsymbol C&#39;\\) 的特征根作为对角元素的 \\(r×r\\) 对角阵，并且 \\(\\boldsymbol Q\\) 是 \\(\\boldsymbol C \\hat {\\boldsymbol V} \\boldsymbol C&#39;\\) 的对应特征向量的 \\(r×r\\) 正交矩阵。令 \\(\\boldsymbol z_k&#39;\\) 为 \\(\\boldsymbol Q \\boldsymbol C\\) 的第 \\(k\\) 行，并令 \\[\\nu_k=\\frac{2(d_k)^2}{\\boldsymbol b_k&#39;\\boldsymbol M\\boldsymbol b_k}\\] 其中 \\(d_k\\) 是 \\(\\boldsymbol D\\) 的第 \\(k\\) 个对角元素，\\(\\boldsymbol b_k\\) 包含 \\(\\boldsymbol z_k&#39;\\boldsymbol V \\boldsymbol z_k\\) 关于 \\(\\boldsymbol V\\) 中每个方差参数的偏导数在方差估计处的值，\\(\\boldsymbol M\\) 是方差向量的渐近协方差。令 \\[S=\\sum_{k=1}^r\\frac{v_k}{v_k-2}I[v_k&gt;2]\\] 其中 \\(I[v_k&gt;2]\\) 是一个指示函数，当 \\(v_k &gt; 2\\) 时值为 \\(1\\)，否则为 \\(0\\). \\(F_c\\) 分布的近似分母自由度为 \\[v=\\begin{cases}\\frac{2S}{S-r}&amp;\\mathrm{if~}S&gt;r\\\\0&amp;\\mathrm{if~}S\\leq r&amp;\\end{cases}\\] 上述过程可用于通过选择一组 \\(t - 1\\) 个线性独立的 \\(\\mu_i\\) 的对比来提供等均值假设的检验。 SAS-Mixed 程序实现了一种对分母自由度的近似，该分母自由度与分子中具有多个自由度的近似 \\(F\\) 统计量相关。SAS-Mixed 可用于拟合每个处理组方差不等的模型，或使用 REPEATED 语句并指定 GROUP = 选项。表 2.9 中的 Mixed 代码将不等方差模型拟合至表 2.1 中的数据。REPEATED 语句用于指定要为每个处理估计不同的方差（组的每个值）。三个 Estimate 语句用于提供与 2.6 节中的三个问题相对应的计算。 表 2.9: 将不等方差模型拟合到表 2.1 中的数据的 SAS-Mixed 代码 x proc mixed cl covtest data=task; class group; model errors=group/ddfm=kr; repeated/group=group; estimate “part(1)” group -1 -1 -1 3/divisor=3 cl alpha=0.05; estimate “part(2)” group 2 -1 -1 0/divisor=2 cl alpha=0.05; estimate “part(3)” group 0 1 -1 0/cl alpha=0.05; lsmeans group/diff cl; Mixed 程序的结果见表 2.10，其中协方差参数估计值是四个处理方差的估计值，拟合统计量中的 AIC 是 Akaike Information Criteria (Akaike, 1974)，模型似然比检验提供了等方差假设的检验，固定效应的 III 型检验使用第二个统计量和分母的相应近似自由度提供了等均值假设的检验，估计值包含与 2.6 节中的三个问题对应的结果，其中提供了 \\(t\\) 统计量、近似分母自由度和 \\(95\\%\\) 置信区间。表 2.11 包含了处理均值估计及其相应的标准误估计。名义自由度是与它们各自的方差相对应的自由度。表 2.11 的第二部分包含处理均值的成对比较，包括每次比较的近似分母自由度。该模型可以通过对药物1和两种药物使用一个方差，对药物2和无药物使用一种方差来简化。这可以通过定义一个变量来实现，比如T，对于药物1和两种药物都是1，对于其他两种处理是0。然后在模型指定中将T放在class语句中，并使用 Repeated/Group=T;。两个方差的估计值分别为 \\(2.4028\\) 和 \\(12.7376\\)，\\(AIC\\) 为 \\(126.4\\)，这比四方差模型的 \\(AIC\\) 值小，表明两方差模型足以描述数据。使用在模型指定中具有较少方差的模型为相应的标准误提供了更多的自由度，从而提供了关于模型中固定效应的假设的更有效的检验。 表 2.10: 将不等方差模型拟合到表 2.1 中的数据的结果 x 表 2.11: 利用不等方差模型估计药物组均值和配对比较 x 2.9 结束语 总之，为了比较所有均值，建议采用以下方法： 如果方差齐性检验在 \\(1\\%\\) 的水平上不显著，则进行通常的方差分析检验。 如果方差齐性检验在 \\(1\\%\\) 的水平上显著，则使用 Welch’s test 或混合模型检验以及相应的近似分母自由度。 如果方差齐性检验在 \\(1\\%\\) 的水平上显著，则使用 \\(AIC\\) 来确定是否可以使用更简单或更少数量的方差来充分描述数据，以增加与均值有关检验的功效。 许多教科书和文章都写过关于对数据进行转换以实现相等的处理方差，从而可以使用通常的方差分析来比较处理。由于能够建立一个不等方差模型来提供均值的标准误估计和均值的比较，许多情况下不需要使用变换。不必使用变换来实现相等方差的一个主要好处是，平均值的单位是测量单位，从而简化了解释。 本章讨论了具有异质误差的单向方差分析模型的统计分析。讨论包括确定误差方差齐性的几个统计检验，以及何时使用每个检验的建议。讨论了在发现误差方差不齐时，对不同处理的效应进行统计推断的适当程序，还回顾了说明这些程序使用的示例。 2.10 练习 原文为: heterogeneous error variances pose a much more serious problem when ignored than non-normality of the error variances，应为笔误，此处译者做了修改。↩︎ 原文为: so you are going to reject the null hypothesis more often than specified by the choice of \\(\\alpha\\).↩︎ 原文为: not too unequal.↩︎ 本文将 “subject” 统一翻译为“个体”，不论语境。↩︎ 原文分子没有 \\(\\partial\\)，应为笔误，此处已修改。↩︎ "],["chap3.html", "第 3 章 联合推断程序和多重比较 3.1 错误率 3.2 建议 3.3 最小显著差异 3.4 Fisher’s LSD Procedure 3.5 Bonferroni’s Method 3.6 Scheffé’s Procedure 3.7 Tukey–Kramer Method 3.8 模拟方法 3.9 Šidák Procedure 3.10 示例：成对比较 3.11 Dunnett’s Procedure 3.12 示例：与对照比较 3.13 多元 \\(t\\) 3.14 示例：线性独立比较 3.15 序贯拒绝方法 3.16 示例：线性相关比较 3.17 多重极差检验 3.18 Waller–Duncan Procedure 3.19 示例：成对比较的多重极差 3.20 警示 3.21 结束语 3.22 练习 参考文献", " 第 3 章 联合推断程序和多重比较 通常实验者想在同一个实验中比较多个 \\(\\mu_i\\) 的函数，导致多重检验的情况。也就是说，他们应该试图回答所有关于处理之间关系的问题。在实验或研究中包括两种以上处理的首要原因是能够估计和/或检验关于处理均值之间几种关系的假设。通常，选择处理是为了提供感兴趣的比较结构（例如参见 2.4 节中的药物实验）。在其他时候，实验者可能对将每种处理与其他所有处理进行比较感兴趣，即，进行所有成对比较。例如，当一个人比较几种小麦的产量或任何其他一组被选择用于比较研究的处理时，就是这样的情况。 在一个实验中进行多次比较时，一个值得关注的问题是，观察到的显著性差异是由于真实的差异，还是仅仅由于进行了大量的比较。进行大量的比较增加了发现看似显著但实际上并不显著的差异的机会。例如，如果一个实验者在一个实验中进行了 \\(25\\) 次独立检验，并在 \\(0.05\\) 的水平上发现了一个显著差异，那么她不应该对结果抱有太大的信心。因为平均而言，她应该预期仅凭偶然就发现 \\((0.05)(25)= 1.25\\) 个显著差异。因此，如果实验者用一个实验回答大量问题（我们认为应该这样做），那么最好有一个程序来表明这些差异是否只是偶然的结果。Fisher (1949) 提出了受保护最小显著差异 (least significant difference, LSD）程序，解决了这一问题。从那时起，许多作者对多重检验领域做出了贡献，此领域已经开发了多种设置的程序。 在本章中，讨论并比较了几种著名且常用的多重推断程序。其中一些程序主要用于检验假设，而另一些程序也可用于获得同时置信区间 (simultaneous confidence intervals)；也就是说，对于 \\(\\mu_i\\) 的一组函数，可以导出一组置信区间。对于这些置信区间，有 \\(95\\%\\) 的把握认为所有的置信区间同时 (simultaneously) 包含它们各自的 \\(\\mu_i\\) 的函数。 3.1 错误率 评估和比较多重比较程序的主要方法之一是计算错误率 (error rates)。如果给定的置信区间不包含所估计数量的真实值，则会出现错误。类似地，如果使用假设检验，那么每当真假设被拒绝或假假设没有被拒绝时，就会出现错误。接下来定义了四种错误率。 定义 3.1 ♦ 比较错误率 (comparisonwise error rate) 等于在所有分析的实验中做出的错误推断的数量与做出的推断总数的比值。 定义 3.2 ♦ 实验误差率 (experimentwise error rate, EER) 等于至少发生一次错误的实验数与分析的实验总数的比值。它是当处理之间没有差异时，在实验中至少发生一次错误的概率。EER 也称为完全零假设下的实验误差率 (experimentwise error rate under the complete null hypothesis, EERC). 定义 3.3 ♦ 族错误率 (familywise error rate, FWER) (Westfall et al, 1999) 是对一个预定的 \\(k\\) 个比较或置信区间的集合做出至少一个错误推断的概率，此 \\(k\\) 个比较或置信区间的集合称为推断族。 定义 3.4 ♦ 错误发现率 (false discovery rate, FDR)(Benjamini and Hochberg, 1995) 是被拒绝的假设中被错误拒绝的假设的预期比例。 当零假设是所有处理都同等有效时，即处理均值之间没有差异时，EER 控制错误率。但许多实验涉及一组选定的处理，其中某些处理之间存在已知差异。可能存在一个包含 \\(k\\) 个零假设 \\(H_{01},H_{02},\\cdots,H_{0k}\\) 的集合，这些是关于 \\(t\\) 个均值的假设，而不是所有均值都相等的零假设。这 \\(k\\) 个零假设被称为部分零假设 (partial null hypothesis)，并且通过使用控制 FWER 的方法来控制错误率。例如，练习2.3中的一组处理是六种糖果类型：buttons, blue choc, red choc, small choc, chocChip 和 WchocChip。在研究开始时，人们已知溶解 small choc 所需的时间远小于溶解任何其他糖果所需要的时间。零问题 (null hypothesis) 可能是：溶解 small choc 所需的时间是否等于溶解 blue choc 和 red choc 所需平均时间的一半？在这种情况下，控制 FWER 的方法是合适的，因为使用控制 EER 的方法的条件不成立；也就是说，从一开始就已知平均时间不完全相等。FDR 在遗传学中的微阵列实验中非常有用。 为了避免在单个实验中偶然发现太多显著的比较，人们常常试图在适当的时候将整个实验的错误率或 FWER 固定在某个规定的水平上，如 \\(0.05\\). 当实验者试图用一次实验回答许多问题时，控制 FWER 是一个很好的策略。 3.2 建议 多重比较问题有五种基本类型：1) 将一组处理与一个对照或标准进行比较；2) 在一组 \\(t\\) 个均值之间进行所有成对比较；3) 构造一组同时置信区间或假设的联合检验 (simultaneous confidence intervals or simultaneous tests of hypotheses)；4) 探索性实验并进行大量检验；以及 5) 数据窥探 (data snooping)，其中比较 (comparisons) 可能是数据驱动的。在前四种情况下，在数据被分析之前，比较的数量或置信区间或推入族是已知的。在最后一种情况下，没有固定的比较数量，最终的比较数量可能很大。2本章给出的建议是基于 Westfall et al. (1999), SAS Institute, Inc. (1999), and Westfall (2002) 的信息。 如果实验是探索性或发现性研究，并且结果将用于设计随访或确证性研究，则可能不需要调整多重性，因此使用 \\(t\\) 检验或基于 \\(LSD\\) 值的未调整置信区间。 使用 Dunnett’s procedure 比较一组处理和一个对照。Dunnett’s procedure 有双侧和单侧两种版本，因此可以选择一种版本来适应所考虑的情况。 对于成对比较，如果每个处理组的观察值数量相等，则使用 Tukey’s method. 如果数据不均衡 (unbalanced)，则使用模拟 (Westfall et al., 1999) 一个百分点的方法，考虑到观察值数量不等的模式。 如果线性组合的集合是线性无关的，那么多元 \\(t\\) 可以用来构造置信区间或检验假设。如果线性组合是无关的或正交的，那么多元 \\(t\\) 可以很好地工作。如果线性组合相关，则应使用包含相关结构的模拟方法，而不是使用多元 \\(t\\) 。每个处理组观察次数不等的大多数情况提供的是相关的线性组合，应使用模拟方法。 Bonferroni method 可用于构建同时置信区间或对选定数量的均值的线性组合进行检验，但如果感兴趣的组合数量很大（比如20个或更多），则 Scheffé procedure 通常会产生较短的置信区间，因此请进行检查。对于一组假设，可以有效地使用 Šidák (1967), Holm (1979), 或 Šidák–Holm 的方法。当线性组合无关时，这些边界是相当好的，但当线性组合相关时，所实现的 FWER 可能比期望的小得多。SAS®-MULTTEST 可用于对给定的一组比较进行 bootstrap 和模拟百分点，该组比较考虑了比较之间的相关性。 对于数据窥探或数据驱动的比较或假设，使用 Scheffé procedure，因为可以进行任意多的比较，并且仍然可以控制 EER 或 FWER. 对于涉及数千次比较的遗传研究等研究，请使用控制 FDR 的方法，如 Benjamini and Hochberg (1995) 提出的方法。 对于涉及与对照或安慰剂相比评估处理的安全性以确定可能的不良反应的研究，使用不校正多重检验或比较的方法。对于安全性研究，可能不需要进行多重性调整，因为发生II类错误比发生I类错误严重得多。 确定比较类型并指定所需的错误率控制水平后，选择满足这些条件的方法，该方法提供最小 \\(p\\) 值或最小临界差异或最短置信区间。 在下面的讨论中，我们将讨论每一种推荐的多重比较方法，以及第 1 章单向处理结构中其他几种常用的方法。每一种方法也可以用于更复杂的情况。本书剩余部分使用的参数 \\(v\\) 表示与 \\(\\sigma^2\\) 估计相对应的自由度。对于第 1 章的单向情况，误差自由度为 \\(v = N-t\\). 3.3 最小显著差异 LSD (least significant difference) 多重比较法可能比其他方法使用得更多，这可能是因为它是最容易应用的方法之一。它通常用于将每个处理均值与其他处理均值进行比较，但也可以用于其他比较。用于比较 \\(\\mu_i\\) 和 \\(\\mu_j\\) 的 \\(\\alpha100\\%\\)10显著性水平的 LSD 为 \\[\\begin{equation} \\mathrm{LSD}_\\alpha=t_{\\alpha/2,v}\\hat{\\sigma}\\sqrt{\\frac1{n_i}+\\frac1{n_j}} \\tag{3.1} \\end{equation}\\] 当 $|_i-j|&gt;$ 时，结论为 \\(\\mu_i\\ne \\mu_j\\). 此程序的比较错误率等于 \\(\\alpha\\). \\(\\mu_i–\\mu_j\\) 对应的 \\(100(1-\\alpha)\\%\\) 置信区间为 \\[\\begin{equation} \\hat{\\mu}_i-\\hat{\\mu}_j\\pm t_{\\alpha/2,v}{\\hat\\sigma}\\sqrt{\\frac1{n_i}+\\frac1{n_j}} \\tag{3.2} \\end{equation}\\] 如果所有样本量都相等（例如，等于 \\(n\\) ），那么单个 LSD 值可以用于所有成对比较。此时单个 \\(\\mathrm{LSD}_{\\alpha}\\) 值由下式给出 \\[\\begin{equation} \\mathrm{LSD}_\\alpha=t_{\\alpha/2,v}{\\hat\\sigma}\\sqrt{\\frac2n} \\tag{3.3} \\end{equation}\\] 假设一项研究包括 \\(t\\) 种处理均值，并且将在 \\(5\\%\\) 的显著性水平上进行所有可能的成对比较。表 3.1 显示了具有不同 \\(t\\) 值的实验的比较误差率和实验误差率。表中的信息适用于所有处理均值相等的情况。表 3.1 显示，在涉及 6 种治疗的实验中，35.8% 的时间会发现至少一个显著差异，即使所有的处理均值彼此相等。显然，如果没有一些额外的保护措施，使用 LSD 程序可能会非常危险。当存在多个感兴趣的测试或参数或参数的线性组合时，意味着存在多重性问题，应考虑一些调整以避免发现错误结果。Westfall et al. (1999) 对与多重性问题和/或多重比较问题相关的所有问题进行了极好的讨论。以下讨论试图描述那些在分析和解释设计实验结果时有用或已使用的程序。 表 3.1: LSD Procedure 的模拟错误率 x 3.4 Fisher’s LSD Procedure Fisher 的建议为上一节讨论的 LSD 程序提供了一些保护。在 Fisher’s procedure 中，LSD 检验是通过使用方程 (3.1) 在 \\(\\alpha100\\%\\) 显著性水平上进行的，但前提是 \\(H_0{:}\\,\\mu_1=\\mu_2=\\cdots=\\mu_t\\) 首先被第 1 章中讨论的 \\(F\\) 检验在该水平上拒绝。 这比直接的 LSD procedure 有了相当大的改进，因为现在实验错误率大约等于 \\(\\alpha\\). 然而有可能拒绝 \\(H_0{:}\\,\\mu_1=\\mu_2=\\cdots=\\mu_t\\) 但不拒绝任何一个 \\(H_0{:}\\,\\mu_i=\\mu_j\\)，其中 \\(i\\ne j\\). 同样地，当差异确实存在时，该程序可能无法检测到处理对之间的某些差异。换句话说，少数处理对之间可能存在差异，但其余处理的相等可能导致 \\(F\\) 检验不显著，这个过程不允许实验者在没有首先获得显著 \\(F\\) 统计量的情况下进行单个比较。此程序的另一个问题是，许多实验包含已知在处理的某些子集中存在不等均值的处理。此时预期拒绝等均值假设，LSD 将用于进行所有成对比较。如果处理的子集具有等均值，则更多的成对比较将被检测为与预期显著不同。因此，FWER 不被维持。只有当完全零假设为真时，才能推荐 Fisher’s LSD. 不建议将这两种 LSD’s procedure 用于在 \\(\\mu_i\\) 的特定对比上构建同时置信区间，因为获得的置信区间通常太窄。 上述 LSD’s procedure 中的每一个都可以推广到处理均值的几个对比。此推广为：断定 \\(\\sum_{i=1}^{t}c_{i}\\mu_{i}\\neq0\\) 如果 \\[\\begin{equation} \\left|\\sum_{i=1}^tc_i\\hat{\\mu}_i\\right|&gt;t_{\\alpha/2,v}{\\hat\\sigma}\\sqrt{\\sum_{i=1}^tc_i^2/n_i} \\tag{3.4} \\end{equation}\\] 示例见 3.10, 3.12, 3.14 和 3.16 节。 3.5 Bonferroni’s Method 虽然这个程序可能是最少使用的，但它往往是最好的。当实验者想要进行少量比较时，它特别好。每当需要控制 FWER 时，推荐使用这个程序进行有计划的比较。假设实验者想做 \\(p\\) 个这样的比较。能得出结论 \\(\\sum_{i=1}^tc_{iq}\\mu_i\\neq0,q=1,2,\\ldots,p\\)，如果 \\[\\begin{equation} \\left|\\sum_{i=1}^tc_{iq}\\hat{\\mu}_i\\right|&gt;t_{\\alpha/2p,v}{\\hat\\sigma}\\sqrt{\\sum_{i=1}^t\\frac{c_{iq}^2}{n_i}} \\tag{3.5} \\end{equation}\\] 这 \\(p\\) 个检验的 FWER \\(\\le \\alpha\\) 以及比较误差率 \\(=\\alpha/p\\). 通常 FWER 比 \\(\\alpha\\) 小得多。不幸的是，无法确定小多少。附表 A.2 中给出了选定 \\(\\alpha,p,n\\) 的 \\(t_{\\alpha/2p,v}\\) 的值。例如，如果 \\(\\alpha = 0.05,p = 5,n = 24\\)，那么从表 A.2 可以得到 \\(t_{\\alpha/2p,v}=2.80\\). 3.10, 3.12, 3.14 和 3.16 节中的示例演示了 Bonferroni’s method 的使用。表中 \\(m\\) 与这里的 \\(p\\) 是等价的。 推荐使用从 Bonferroni’s method 获得的同时置信区间，其形式为 \\[\\begin{equation} \\sum_{i=1}^tc_{iq}\\hat{\\boldsymbol{\\mu}}_i\\pm t_{\\alpha/2p,v}\\hat{\\boldsymbol\\sigma}\\sqrt{\\sum_{i=1}^t\\frac{c_{iq}^2}{n_i}},\\quad q=1,2,\\ldots,p \\tag{3.6} \\end{equation}\\] Bonferroni’s method 可应用于模型参数的任何函数集，包括方差和均值。 3.6 Scheffé’s Procedure 当实验者想要进行大量”计划外”比较时，建议使用此程序。计划外比较是实验者在计划实验时没有想到进行的比较。这些问题经常出现，因为实验结果经常建议实验者进行某些比较。当有大量计划的比较时，也可以使用该程序，但置信区间的宽度通常比其他程序宽，尽管并不总是如此。给定常数向量 \\(\\boldsymbol c\\)，考虑检验 \\(H_0{:}\\,\\sum_{i=1}^tc_i\\mu_i=0\\)。我们有 \\[\\Pr\\left\\{\\frac{\\left(\\sum_{i=1}^tc_i\\hat{{\\mu}}_i-\\sum_{i=1}^tc_i{\\mu}_i\\right)^2}{\\sum_{i=1}^tc_i^2/n_i}\\leq(t-1)F_{\\Tiny{\\alpha,t-1,v}}\\hat{\\sigma}^2\\quad\\text{ for all contrast vectors }c\\right\\}=1-\\alpha \\] 因此对于所有可能的 \\(\\mu_i\\) 与 \\(0\\) 的对比，一个 FWER \\(=\\alpha\\) 的程序如下：拒绝 \\(H_0{:}\\,\\sum_{i=1}^tc_i\\mu_i=0\\) 如果 \\[\\begin{equation} \\left|\\sum_{i=1}^tc_i\\hat{\\mu}_i\\right|&gt;\\sqrt{(t-1)F_{\\alpha,t-1,v}}{\\hat\\sigma}\\sqrt{\\sum_{i=1}^tc_i^2/n_i} \\tag{3.7} \\end{equation}\\] Scheffé’s procedure 仍然可以使用，但此时 FWER 通常会原小于 \\(\\alpha\\). 对于有限数量的比较，Bonferroni’s method 或多元 \\(t\\) 方法（适当时）通常优于（置信区间更窄或更有效） Scheffé’s procedure. 即，使用Bonferroni’s method 或多元 \\(t\\) 方法相比Scheffé’s procedure，较小的 \\(\\sum_{i=1}^tc_i\\hat \\mu_i\\) 更有可能得出 \\(\\sum_{i=1}^tc_i\\mu_i\\) 与零显著不同的结论11。然而，如果要在数据中”乱翻”，看看是否有什么显著的东西出现，那么应该使用 Scheffé’s procedure，因为这种比较实际上是计划外的比较，而不是计划内的比较。需注意 Scheffé’s procedure 不会显示任何与零显著不同的对比，除非第 1 章讨论的 \\(F\\) 检验拒绝了 \\(H_0\\colon\\,\\mu_1=\\mu_2=\\cdots=\\mu_t\\). Scheffé’s procedure 也可用来获得 \\(\\mu_i\\) 的对比的同时置信区间。所需的结果是，对于任何一组对比 \\(c_1,c_2,\\dots,\\)，可有至少 \\((1-\\alpha)100\\%\\) 的把握认为 \\(\\sum_{i=1}^tc_{iq}\\mu_i\\) 包含在下式给出的区间内 \\[\\begin{equation} \\sum_{i=1}^tc_{iq}\\hat{\\mu}_i\\pm\\sqrt{(t-1)F_{\\alpha,t-1,v}}{\\hat\\sigma}\\sqrt{\\sum_{i=1}^tc_{iq}^2/n_i}\\quad\\text{ for all }q=1,2,\\ldots \\tag{3.8} \\end{equation}\\] 如果要考虑 \\(\\mu_i\\) 所有的线性组合，而不仅仅是所有对比，则式 (3.7) 和 (3.8) 中的 \\(√[(t-1)F_{\\alpha,t-1,v}]\\) 必须替换为 \\(√[tF_{\\alpha,t,v}]\\). 示例见 3.10, 3.12 和 3.14 节。 3.7 Tukey–Kramer Method 无论 \\(n_i\\) 的值如何，都可以使用前面的程序。Tukey’s honest significant difference (HSD) procedure (Tukey, 1952, 1953; Kramer, 1956) 用于在一组均值之间进行所有成对比较。然而该程序要求相等的 \\(n_i\\). Tukey (1953) 和 Kramer (1956) 为样本量不等的情况提供了修改。Hayter (1984) 给出了 Tukey–Kramer method 提供 FWER 保护的证据，尽管如果 \\(n_i\\) 相差不大12时可以使用近似程序。对于 \\(i\\ne i&#39;\\)，Tukey–Kramer method 将拒绝 \\(H_0{:\\mu_i}=\\mu_{i&#39;}\\)，如果 \\[\\begin{equation} \\left|\\hat{\\mu}_i-\\hat{\\mu}_{i^{\\prime}}\\right|&gt;q_{\\alpha,t,v}\\sqrt{\\frac{{\\hat\\sigma}^2}2{\\left(\\frac1{n_i}+\\frac1{n_{i^{\\prime}}}\\right)}} \\tag{3.9} \\end{equation}\\] 其中 \\(q_{\\alpha,t,v}\\) 为学生化极差统计量分布的上分位数。选定 \\(\\alpha,t,v\\) 的 \\(q_{\\alpha,t,v}\\) 值在附表 A.4 中。 如果样本量都等于 \\(n\\)，对于一个对比，拒绝 \\(H_0\\colon\\sum_{i=1}^tc_i\\mu_i=0\\)，如果 \\[\\left|\\sum_{i=1}^tc_i\\hat{\\mu}_i\\right|&gt;q_{\\alpha,t,v}\\frac{\\hat\\sigma}{\\sqrt{n}}{\\left(\\frac12\\sum_{i=1}^t|c_i|\\right)}\\] 3.8 模拟方法 对于不相等的样本量问题，对于比较不是成对比较的问题，以及对于比较不是线性独立的问题，上述方法提供的 FWER 显著性水平低于所需水平。在这种情况下，可以模拟适当的一组比较的分位数。 假设对 \\(\\mu_i\\) 的 \\(p\\) 个线性组合感兴趣，例如 \\(\\sum_{i=1}^{t}c_{iq}\\mu_{i},q=1,2,\\dots,p\\). 希望有程序要么控制假设集合 \\(H_{0}\\colon\\,\\sum_{i=1}^{t}c_{iq}\\mu_{i}=0,q=1,2,\\ldots,p\\) 的 FWER，要么控制同时置信区间的 \\(\\sum_{i=1}^tc_{iq}\\mu_i\\) FWER. 这个过程是： 以与手头数据集相同的结构生成一个数据样本。如果有五个样本量为5、9、3、6和7的处理，则使用这些样本量生成数据 对生成的数据集进行分析，如同对实际数据集所做的那样，并计算 \\(p\\) 个 \\(t\\) 统计量 \\[t_q=\\frac{\\sum_{i=1}^tc_{iq}\\hat{{\\mu}}_i}{\\sqrt{\\hat{\\sigma}^2\\sum_{i=1}^tc_{iq}^2/n_i}}\\quad q=1,2,\\ldots,p\\] 计算 \\(t_q\\) 绝对值的最大值 \\(T_{s}=\\max(|t_{1}|,|t_{2}|,\\ldots,|t_{p}|)\\). 大量重复步骤 1, 2 和 3，跟踪 \\(T_s\\) 的计算值。确定 \\(T_s\\) 分布的上 \\(\\alpha100\\) 分位数，并用 \\(T_\\alpha\\) 表示该百分位数。 对于实际数据集，计算 \\(t_q,q=1,2,\\dots,p\\)，如果\\(|tq| &gt;T,q=1,2,\\dots,p\\)$则拒绝第 \\(q\\) 个假设，或者构建同时置信区间为 \\[\\sum_{i=1}^tc_{iq}\\hat{{\\mu}}_i\\pm T_\\alpha\\sqrt{{\\hat\\sigma}^2\\sum_{i=1}^tc_{iq}^2/n_i},\\quad q=1,2,\\ldots,p\\] 可以使用 Edwards and Berry (1987) 的方法来指定模拟的准确性。SAS-MULTTEST 可用于使用 bootstrap 方法获得联合推断 (Westfall et al., 1999). Bootstrap 方法超出了本书的范围。 3.9 Šidák Procedure Šidák (1967) 对 Bonferroni’s method 进行了修改，对每个比较使用了不同的分位数。该过程是为每个比较计算一个 \\(t\\) 统计量 \\[t_q=\\frac{\\sum_{i=1}^tc_{iq}\\hat{{\\mu}}_i}{\\sqrt{\\hat{\\sigma}^2\\sum_{i=1}^tc_{iq}^2/n_i}},\\quad q=1,2,\\ldots,p\\] 计算每次比较的显著性水平，并将显著性水平从最小到最大排序为 \\(p_1,p_2,\\dots p_p\\). 对于 FWER \\(=\\alpha\\)，如果 \\(p_q\\le 1-(1-\\alpha)^{1/p}\\) 或等价地 \\(\\alpha\\ge 1-(1-p_q)^p\\)，则拒绝单个比较。 3.10 示例：成对比较 1.6 节中的任务数据用于阐述上述多重比较程序的结果。表 3.2 包含 SAS-Mixed 代码，用于拟合单向均值模型，LSMeans 语句用于提取几个多重比较程序。表 3.3 包含用于提供模拟、Tukey–Kramer、Bonferroni、Šidák、Scheffé 和 \\(t\\)（未调整）方法的置信度差异或显著性差异的分位数。除了未调整的 \\(t\\)，其他方法为所有成对比较提供 \\(0.05\\) 的 I类 FWER。模拟和 Tukey–Kramer 方法 使用最小的分位数，Šidák 和 Bonferroni 方法的分位数位于中间，而 Scheffé 方法的分位数最大。表 3.4 包含了每个成对比较的关键显著性差异。任务1与4，2与4，3与4，3与5、3与6、4与5和4与6观察到的差异，\\(t\\) 或 LSD 的临界差异，这控制了比较错误率，但未控制实验错误率。只有4与5 ，4与6的比较超过了其他五种方法的临界差异，所有这些方法都提供了实验错误率的保护，未调整的 \\(t\\) 或 LSD 方法的临界差异幅度最小。模拟方法与 Tukey-Kramer 方法临界差异大小相近，但模拟方法稍小；Šidák 方法与 Bonferroni 方法临界差大小相近，但 Šidák 值稍小。正如预期的那样，Scheffé 方法临界差异最大，因为它可以控制无限次比较的 FWER，而实际仅进行了15次成对比较。用差异估计加减临界差的方法可以得到所有两两比较的联合 \\(95\\%\\) 置信区间，如 _1-_2$ 的联合 \\(95\\%\\) 置信区间为 \\(0.840 \\pm 6.526\\). 表 3.5 包含每种方法的调整的 \\(p\\) 值。\\(p\\) 值提供了与表 3.4 中 \\(5\\%\\) 差异相同的决定. 表 3.2: 使用 Proc Mixed 计算多个多重比较程序的所有成对比较 x PROC mixed DATA=EX1; CLASS TASK; MODEL PULSE20=TASK/NOINT SOLUTION; LSMEANS TASK/ DIFF CL; LSMEANS TASK/ DIFF ADJUST=TUKEY CL; LSMEANS TASK/ DIFF ADJUST=BON CL; LSMEANS TASK/ DIFF ADJUST=SCHEFFE CL; LSMEANS TASK/ DIFF ADJUST=SIDAK CL; LSMEANS TASK/ DIFF ADJUST=SIMULATE (REPORT SEED=4938371) CL; 表 3.3: 用于六个任务均值的所有成对比较的分位数 x 表 3.4: 用于比较未调整的 \\(t\\) 检验和几种多重比较程序的均值对之间差异的临界差异 x 表 3.5: 调整显著性水平以检验从六个程序中获得的 TASK 减去 _TASK 的所有成对比较的相等性，其中 \\(t\\) 对应未调整的 \\(t\\) x 3.11 Dunnett’s Procedure 一个非常有趣的例子是将所有处理与对照进行比较。这种类型的推断在安全性研究中很重要，届时将不同剂量的处理与对照或安慰剂进行比较是很有意义的。Dunnett’s test 声明处理均值 \\(\\mu_i\\) 与对照均值 \\(\\mu_0\\) 存在显著差异，如果 \\[|\\hat{\\mu}_i-\\hat{\\mu}_0|&gt;d_{\\alpha,t,v}\\sqrt{{\\hat\\sigma}^2{\\left(\\frac1{n_i}+\\frac1{n_0}\\right)}}\\] 其中 \\(d_{\\alpha,t,v}\\) 是”多对一 \\(t\\) 统计量” (“many-to-one t-statistic”)(Miller, 1967) 的上 \\(\\alpha100\\) 分位数。Dunnett’s method 控制 FWER。如果样本量不等，模拟程序可以考虑样本量结构，并可能提供更短的界限。 3.12 示例：与对照比较 1.6 节中的任务数据用于演示将每个处理与对照进行比较的过程。在本研究中，假设任务2为对照任务，其他五个任务为实验任务。表 3.6 包含 SAS-Mixed 代码，使用未调整的 \\(t\\)、Bonferroni、Dunnett、Scheffé、Šidák 和 模拟方法将所有其他任务与任务2进行比较。LSMean 语句 DIFF=CONTROL('2') 选项请求将任务2视为对照，并与研究中的其他每个任务进行比较。表 3.7 包含每种方法的 \\(95\\%\\) 分位数。Dunnett 分位数小于其他分位数（除了未调整的 \\(t\\)），模拟方法与之非常接近。目前正在进行五次比较，这决定了 Bonferroni 和 Šidák 分位数的大小。Scheffé 分位数与表 3.4 中的相同，这对于无限数量的比较非常有用。观察到的差异超过临界差异的唯一比较是将任务4与对照(任务2)进行比较。将差异估计加减表 3.8 中的临界差异，可以构建一组关于处理和对照均值之间所有差异的同时置信区间。例如，使用模拟方法，\\(\\mu_1-\\mu_2\\) 的联合 \\(95\\%\\) 置信区间为 \\(0.840 \\pm 5.765\\). 表 3.9 中列出了每种方法的调整的 \\(p\\) 值。 表 3.6: 使用 Proc Mixed 计算多个多重比较程序的所有成对比较 x PROC mixed DATA=EX1; CLASS TASK; MODEL PULSE20=TASK/NOINT; LSMEANS TASK/ DIFF=CONTROL(‘2’) CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=BON CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=DUNNETT CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=SIDAK CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=SIMULATE (REPORT SEED=4938371) CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=scheffe CL; 表 3.7: 用于比较每个任务均值与任务2（对照）均值的分位数 x 表 3.8: 未调整的 \\(t\\) 检验和五个多重比较程序中各处理组与对照组比较的临界差异 x 表 3.9: 调整显著性水平以检验 \\(H_0:\\,\\mu_i = \\mu_2\\)，从六个程序中获得，其中任务2为对照，\\(t\\) 对应于未调整的 \\(t\\) x 3.13 多元 \\(t\\) 当实验者想要考虑 \\(\\mu_i\\) 线性组合的线性无关集合时，多元 \\(t\\) 方法是一种很好的方法。重要的是，该程序不能用于线性相关的线性组合集合。这种限制阻止了使用这种方法在一组处理均值之间进行所有可能的成对比较，因为均值之间所有可能的比较的集合不是线性独立的集合。关于线性相关线性组合的讨论在本节末尾给出。如果实验者想进行 \\(p\\) 个线性独立的比较，结论为第 \\(q\\) 个比较 \\(\\sum_{i=1}^tc_{iq}\\mu_i\\neq0\\) 如果 \\[\\begin{equation} \\left|\\sum_{i=1}^tc_{iq}\\hat{\\mu}_i\\right|&gt;t_{\\alpha/2,p,v}{\\hat\\sigma}\\sqrt{\\sum_{i=1}^t\\frac{c_{iq}^2}{n_i}} \\tag{3.10} \\end{equation}\\] 其中 \\(t_{\\alpha/2,p,v}\\) 是自由度为 \\(v\\) 且相关矩阵为 \\(\\boldsymbol I_{p}\\) 的 \\(p\\) 元 \\(t\\) 分布的上 \\(\\alpha/2\\) 分位数。选定 \\(\\alpha,p,v\\) 的 \\(t_{\\alpha/2,p,v}\\) 的值在附表 A.3 中给出。基于多元 \\(t\\) 方法的同时置信区间是合适的，并且可以推荐表 A.3 中 \\(m=p\\) 的情况。 多元 \\(t\\) 方法的 FWER \\(\\le\\alpha\\)。如果线性组合 \\(\\sum_{i=1}^tc_{iq}\\hat\\mu_i\\) 在统计上独立或不相关，则 FWER 恰好 \\(=\\alpha\\)。对于一组特定的线性独立比较，多元 \\(t\\) 方法通常会给出最佳结果。如果实验者感兴趣的一组比较是线性独立的，那么多元 \\(t\\) 方法总是比 Bonferroni method 更好，也就是说，得到的置信区间会更窄。 以下结果使我们能够将多元 \\(t\\) 程序的应用扩展到一组线性相关的比较（然而，所得到的检验或置信区间并不完全令人满意）：设 \\(l_1,l_2,\\dots,l_p\\) 是 \\(\\mu_i\\) 的线性组合的线性独立集。如果 \\(|lq|\\le cq\\)，则 \\[\\left|\\sum_{i=1}^p\\lambda_ql_q\\right|\\leq\\sum_{i=1}^p\\left|\\lambda_q\\right|c_q\\] 要利用此结果，请使用以下步骤： 令 \\(l_1,l_2,\\dots,l_p\\) 是 \\(\\mu_i\\) 的线性组合的线性独立集。这个集合被表示为实验者主要感兴趣的线性组合。对于这组比较，得出结论 \\(l_q=\\sum_{i=1}^tc_{iq}\\mu_i\\) 与零显著不同，如果 \\[\\begin{equation} \\left|\\hat{l}_q\\right|&gt;t_{\\alpha/2,p,v}{\\hat\\sigma}\\sqrt{\\sum_{i=1}^tc_{iq}^2/n_i} \\tag{3.11} \\end{equation}\\] 令 \\(l^*\\) 是任何具有次要重要性的比较，即 \\(l_q,q=1,2,\\dots,p\\) 的线性组合。也就是说，对于 \\(\\lambda_q\\) 的某个集合，\\(l^*=\\sum_{q=1}^p\\1ambda_ql_q\\)。称 \\(l^*\\) 与零显著不同，如果 \\[\\begin{equation} \\left|\\hat{l}^*\\right|&gt;t_{\\alpha/2,p,\\nu}\\hat{\\boldsymbol\\sigma}\\sum_{q=1}^p\\left(\\left|\\lambda_q\\right|\\sqrt{\\sum_{i=1}^tc_{iq}^2/n_i}\\right) \\tag{3.12} \\end{equation}\\] 实验者可以在不增加 FWER 的情况下根据需要进行尽可能多的 \\(l^*\\) 比较。多元 \\(t\\) 方法的这种扩展对那些具有首要重要性的比较给出了非常有效的检验，但对那些具有次要重要性的比较则不那么有效。如 3.16 节中的示例所示。 3.14 示例：线性独立比较 表 3.10 包含 SAS-Mixed 代码，用于提供任务均值的五个线性独立对比的估计、标准误和置信区间宽度。五个对比是： \\[\\begin{aligned} &amp;\\mu_1-\\frac12(\\mu_2+\\mu_3),\\,\\frac13(\\mu_1+\\mu_2+\\mu_3)-\\frac13(\\mu_4+\\mu_5+\\mu_6) \\\\ &amp;\\mu_6-\\frac12(\\mu_4+\\mu_5),\\,\\frac12(\\mu_1+\\mu_6)-\\frac12(\\mu_4+\\mu_5) \\\\ &amp;\\frac12(\\mu_1+\\mu_6)-\\frac14(\\mu_2+\\mu_3+\\mu_4+\\mu_5) \\end{aligned}\\] 表 3.10: 使用 Proc Mixed 计算多个多重比较程序的所有成对比较 x PROC mixed DATA=EX1; CLASS TASK; MODEL PULSE20=TASK/NOINT; LSMEANS TASK/ DIFF=CONTROL(‘2’) CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=BON CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=DUNNETT CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=SIDAK CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=SIMULATE (REPORT SEED=4938371) CL; LSMEANS TASK/ DIFF=CONTROL(‘2’) ADJUST=scheffe CL; 表 3.11: 未调整的 \\(t\\) 和三种调整方法的置信区间宽度 x 表 3.11 包含使用多元 \\(t\\)、Bonferroni \\(t\\) 和 Scheffé 方法计算每个五个对比的置信区间宽度的结果。还提供了未调整的 \\(t\\)。置信区间的宽度由 2×Q×(stderr) 计算，其中 Q 表示相应程序的分位数。分位数如下：对于未调整的 \\(t\\)，\\(Q=t_{0.025,62}=1.999\\)，对于多元 \\(t\\)，\\(Q=t_{0.025,5,60=2.649\\)（表中使用了60个自由度，而不是62个自由度），对于 Bonferroni \\(t\\)，\\(Q＝t_{0.025,15,62}=2.657\\)，对于 Scheffé，\\(Q＝√(5F_{0.05,5,62}=3.437\\)。多元 \\(t\\) 的置信区间的宽度短于 Bonferroni 或 Scheffé 置信区间给出的宽度。Bonferroni \\(t\\) 置信区间仅比多元 \\(t\\)的置信区间略宽。随着比较次数的增加，Bonferronit 置信区间的宽度也会增加。如果比较次数 \\(\\le47\\) 次或更少，则 Bonferroni 置信区间比 Scheffé 方法的置信区间更短。对于 \\(&gt;47\\) 次的比较，Scheffé 置信区间比 Bonferroni 区间短。 3.15 序贯拒绝方法 前面的方法被称为单步方法，因为只需要一步就可以确定所有检验的合适临界值。每个单独的检验或置信水平都是在不参考其他检验或置信水平的情况下进行评估的。在逐步或序贯 (sequantial) 方法中，给定检验的结果取决于先前检验的结果 (Westfall et al., 1999). 这些方法可用于假设检验集。设有 \\(p\\) 个感兴趣的假设，\\(H_{0q}\\colon\\sum_{i=1}^{t}c_{iq}\\mu_{i}=0\\,\\mathrm{~vs.~}\\,H_{0q}\\colon\\sum_{i=1}^{t}c_{aq}\\mu_{i}\\neq0,q=1,2,\\ldots,p\\). 计算 \\(p\\) 个 \\(t\\) 统计量 \\[t_{q}=\\frac{\\sum_{i=1}^{t}c_{iq}\\hat{\\mu}_{i}}{\\sqrt{{\\hat\\sigma}^{2}\\sum_{i=1}^{t}c_{iq}^{2}/n_{i}}},\\quad q=1,2,\\ldots,p\\] 设 \\(p_1,p_2,\\dots,p_p\\) 表示观察到的显著性水平。接下来，将 \\(p_q\\) 从小到大排序为 \\(p_{(1)}\\le p_{(2)}\\le\\cdots p_{(p)}\\). 3.15.1 Bonferroni–Holm Method Bonferroni-Holm 方法从第一次检验的 Bonferroni 调整开始，但增加了后续检验的显著性水平 (Holm, 1979). 如果 \\(p_{(1)}&gt;\\alpha/p\\)，则无法拒绝所有假设。若 \\(p_{(1)}&lt;\\alpha/p\\)，则拒绝 \\(p_{(1)}\\) 对应的假设并将 \\(p_{(2)}\\) 与 \\(\\alpha/(p-1)\\) 比较。若 \\(p_{(2)}&gt;\\alpha/(p-1)\\)，则无法拒绝所有剩余假设。若 \\(p_{(2)}&lt;\\alpha/(p-1)\\)，则拒绝 \\(p_{(2)}\\) 对应的假设并将 \\(p_{(3)}\\) 与 \\(\\alpha/(p-2)\\) 比较。继续这个过程直到对于某个 \\(q\\)，\\(p_{(q)}&gt;\\alpha/(p-q+1)\\)，此时无法拒绝 \\(p_{(q)}\\) 对应的假设以及所有剩余假设。该方法控制 FWER，并且比 Bonferroni method 更强大，因为除了第一个比较外，有序的 \\(p\\) 值与更大的值进行比较。 3.15.2 Šidák–Holm Method Bonferroni–Holm method 中使用的 Holm 修正可以与 Šidák 方法一起使用，其中调整的 \\(p\\) 值为 \\[\\begin{aligned} \\tilde{p}_{(1)}&amp; =1-(1-p_{(1)})^k \\\\ \\tilde{p}_{(2)}&amp; =\\min[\\tilde{p}_{(1)},1-(1-p_{(2)})^{k-1}] \\\\ \\tilde{p}_{(j)}&amp; =\\min[\\tilde{p}_{(j-1)},1-(1-p_{(j)})^{k-j+1}] \\\\ \\tilde{p}_{(k)}&amp; =\\min(\\tilde{p}_{(k-1)},p_{(k)}) \\end{aligned}\\] 当比较是独立的以及涉及相关比较的大多数情况下，该方法提供了对 FWER 的控制 (Holland and Copenhaver, 1987). 3.15.3 控制 FDR 的 Benjamini 和 Hochberg Method 设感兴趣于 \\(p\\) 个比较 \\(\\sum_{i=1}^{t}c_{iq}\\mu_{i},q=1,2,\\ldots,p\\). 计算 \\(p\\) 个 \\(t\\) 统计量 \\[t_q=\\frac{\\sum_{i=1}^tc_{iq}\\hat{\\mu}_i}{\\sqrt{\\hat{\\sigma}^2\\sum_{i=1}^tc_{iq}^2/n_i}},\\quad q=1,2,\\ldots,p\\] 并令 \\(p_1,p_2,\\dots,p_p\\) 表示观察到的显著性水平。接下来，将 \\(p_q\\) 从小到大排序为 \\(p_{(1)}\\le p_{(2)}\\le\\cdots p_{(p)}\\). 控制 FDR（但不控制 FWER）的调整的 \\(p\\) 值为 \\[\\begin{aligned} \\tilde{p}_{(k)}&amp; =p_{(k)} \\\\ \\tilde{p}_{(k-1)}&amp; =\\min\\{\\tilde{p}_{(k)},[k/(k-1)]p_{(k-1)}\\} \\\\ \\tilde{p}_{(k-j)}&amp; =\\min\\{\\tilde{p}_{(k-j+1)},[k/(k-j)]p_{(k-j)}\\} \\\\ \\tilde{p}_{(1)}&amp; =\\min(\\tilde{p}_{(2)},kp_{(1)}) \\end{aligned}\\] 3.16 示例：线性相关比较 选择了八个线性相关的比较，并使用未调整的 \\(t\\)、Bonferroni \\(t\\)、Bonferroni–Holm、Šidák、Šdák–Holm 和 Benjamini–Hochberg 方法来计算调整的显著性水平。这八个比较是： \\[\\begin{aligned} &amp;\\mu_1-\\mu_2,\\mu_1-\\frac12(\\mu_2+\\mu_3),\\mu_1-\\mu_3 \\\\ &amp;\\frac13(\\mu_1+\\mu_2+\\mu_3)-\\frac13(\\mu_4+\\mu_5+\\mu_6),\\mu_4-\\mu_5 \\\\ &amp;\\mu_6-\\frac12(\\mu_4+\\mu_5),\\frac12(\\mu_1+\\mu_6)-\\frac12(\\mu_4+\\mu_5) \\\\ &amp;\\frac12(\\mu_1+\\mu_6)-\\frac14\\left(\\mu_2+\\mu_3+\\mu_4+\\mu_5\\right) \\end{aligned}\\] 表 3.12 包含 SAS-MULTTEST 代码，用于提供这些比较的调整的 \\(p\\) 值。调整的 \\(p\\) 值如表 3.13 所示。标记为 “Raw” 的列包含了未调整的 \\(p\\) 值。“Bonferroni” 列包含 Bonferronis 调整的 \\(p\\) 值。“Stepdown Bonferroni” 列包含 Bonferroni-Holm 调整的 \\(p\\) 值。“Šidák” 列包含 Šidàk 调整的 \\(p\\) 值。“StepdownŠidák”列包含 Šidèk–Holm 调整的 \\(p\\) 值。“False Discovery Rate” 列包括 Benjamini–Hochberg 调整的 \\(p\\) 值。Šidák 调整的 \\(p\\) 值通常小于 Bonferroni \\(t\\) 的 \\(p\\) 值。Stepdown Šidèk 调整的 \\(p\\) 值一般小于 stepdown Bonferronis的 \\(p\\) 值，并且小于 Šidàk 调整前的 \\(p\\) 值。Bonferroni、stepdown Bonferroni、Šidák 和 stepdown Shidák 方法提供的值大于错误发现率方法的值。错误发现率通常会在进行大量检验且对控制 FWER 不感兴趣时使用。 表 3.12: 用 Proc MULTTEST 代码同时获得八个对比的检验信息 x 表 3.13: 八个对比的原始和调整的 \\(p\\) 值 x 为了说明多元 \\(t\\) 的推广在相关比较中的应用，我们将计算关于 \\(\\mu_1 -1/2(\\mu_2 + \\mu_3)\\) 的置信区间，假定线性无关集或主要集包含 \\(\\mu_1 - \\mu_2\\) 和 \\(\\mu_1 - \\mu_3\\). 此时 \\(\\mu_1 -1/2(\\mu_2 + \\mu_3)=1/2(\\mu_1-\\mu_2)+1/2(\\mu_1-\\mu_3)\\)，而根据 3.13 节中的结果，\\(l^*=\\mu_1-1/2(\\mu_2+\\mu_3)=1/2(\\mu_1-\\mu_2)+1/2(\\mu_1-\\mu_3)\\)，且 \\(\\lambda_1=\\lambda_2=1/2\\). 用于评估 \\(l^*\\) 的临界值（根据式 (3.12)）为 \\[\\begin{aligned} t_{\\alpha/2,p,v}\\hat{\\sigma}\\sum_{q=1}^{p}\\left(\\left|\\lambda_{q}\\right|\\sqrt{\\sum_{i=1}^{t}c_{iq}^{2}/n_{i}}\\right)&amp; =(2.649)(5.559){\\left(\\left|\\frac12\\right|\\sqrt{\\frac1{13}+\\frac1{12}}+\\left|\\frac12\\right|\\sqrt{\\frac1{13}+\\frac1{10}}\\right)} \\\\ &amp;=\\frac12(5.895)+\\frac12(6.194) \\\\ &amp;\\text{=6.044} \\end{aligned}\\] 将该结果乘以 \\(2\\)，得到置信区间的宽度为 \\(12.088\\). 多元 \\(t\\)、Bonferroni \\(t\\) 和 Scheffé 方法的置信区间宽度分别为 \\(10.319,10.352\\)和 \\(13.390\\)。线性独立比较的集合称为主比较 (primary comparisonns)，主比较集合中的比较的线性函数称为次比较 (secondary comparisons). 使用式 (3.12) 为次比较提供临界差异，得到的值比作为主比较获得的值大得多，但此时宽度仍然比 Scheffé 方法提供的宽度短。因此，当使用多元 \\(t\\) 方法时，次比较远不如除 Scheffé 方法外的任何其他方法灵敏。 3.17 多重极差检验 Duncan 和 Student–Newman–Keul 的多重极差检验 (multiple range tests) 不能控制 FWER，因此不予以推荐。见 Westfall et al. (1999, p. 154) 的讨论。由于这些程序已被许多领域的研究人员广泛使用，下面将对其进行描述。 3.17.1 Student–Newman–Keul’s Method 这个方法要求 \\(n_i\\) 彼此相等；然而，只要样本量相差不大13，就可以获得良好的近似值。此时，下列公式中的变量 \\(n\\) 被 \\(n_i\\) 的调和平均值 (harmonic mean) 所代替。调和平均值由下式给出 \\[\\tilde{n}=t\\Bigg(\\frac{1}{n_{1}}+\\frac{1}{n_{2}}+\\cdots+\\frac{1}{n_{t}}\\Bigg)^{-1}\\] 该程序在所有均值相等假设下控制 EERC，但如果某些均值相等，而某些均值不相等，则无法控制 EERC. 要应用此方法，请将 \\(t\\) 个均值按升序排列为 \\(\\bar{y}_{(1)}\\leq\\bar{y}_{(2)}\\leq\\cdots\\leq\\bar{y}_{(t)}\\). 接下来，\\(t\\) 个均值的学生化极差 (Studentized range) 为 \\[\\frac{\\overline{y}_{(t)}-\\overline{y}_{(1)}}{{\\hat\\sigma}/\\sqrt{n}}\\] 并将其与临界值 \\(q_{\\alpha,t,v}\\) 比较，如果 \\[\\overline{y}_{(t)}-\\overline{y}_{(1)}\\leq\\frac{\\hat\\sigma}{\\sqrt{n}}q_{\\alpha,t,v}\\] 则得出结论，\\(t\\) 个处理均值之间没有显著差异，也不考虑进一步的检验。如果 \\[\\overline{y}_{(t)}-\\overline{y}_{(1)}&gt;\\frac{\\hat\\sigma}{\\sqrt{n}}q_{\\alpha,t,v}\\] 则得出结论，\\(\\mu_{(t)}&gt;\\mu_{(1)}\\) 或，这 \\(t\\) 个均值存在显著的极差。接下来，对两个均值子集 \\(\\{\\bar{y}_{(t)},\\bar{y}_{(t-1)},\\ldots,\\bar{y}_{(2)}\\}\\) 和 \\(\\{\\bar{y}_{(t-1)},\\bar{y}_{(t-2)},\\ldots,\\bar{y}_{(1)}\\}\\) 进行比较。将每个子集的极差与 \\([{\\hat\\sigma}/√(n)]q_{\\alpha,t-1,v}\\) 比较，如果 \\[\\bar{y}_{(t)}-\\bar{y}_{(2)}\\leq\\frac{\\hat\\sigma}{\\sqrt{n}}q_{\\alpha,t-1,v}\\] 则得出结论，在子集 \\(\\{\\mu_{(t)},\\mu_{(t-1)},\\ldots,\\mu_{(2)}\\}\\) 中，处理均值之间没有显著14差异。类似地，如果 \\[\\bar{y}_{(t-1)}-\\bar{y}_{(1)}\\leq\\frac{\\hat\\sigma}{\\sqrt{n}}q_{\\alpha,t-1,v}\\] 则得出结论，在子集 \\(\\{\\mu_{(t-1)},\\mu_{(t-2)},\\ldots,\\mu_{(1)}\\}\\) 中，处理均值之间没有显著15差异。如果以上两个结论都成立，那么我们停止在均值之间进行比较的程序，并得出结论，两个均值子集中的均值没有显著差异。 如果 \\[\\bar{y}_{(t)}-\\bar{y}_{(2)}&gt;\\frac{\\hat\\sigma}{\\sqrt{n}}q_{\\alpha,t-1,v}\\] 则得出结论 \\(\\mu_{(t)}&gt;\\mu_{(2)}\\). 如果 \\[\\bar{y}_{(t-1)}-\\bar{y}_{(1)}&gt;\\frac{\\hat\\sigma}{\\sqrt{n}}q_{\\alpha,t-1,v}\\] 则得出结论 \\(\\mu_{(t-1)}&gt;\\mu_{(1)}\\). 如果这两个结论中的任何一个成立，那么我们将在发现显著差异的子集内进行额外的比较。例如，如果前面的两个集合都包含显著差异，那么可以考虑子集 \\(\\{\\bar{y}_{(t)},\\bar{y}_{(t-1)},\\ldots,\\bar{y}_{(3)}\\},\\{\\bar{y}_{(t-1)},\\bar{y}_{(t-2)},\\ldots,\\bar{y}_{(2)}\\}\\) 和 \\(\\{\\bar{y}_{(t-2)},\\bar{y}_{(t-2)},\\ldots,\\bar{y}_{(1)}\\}\\). 将每个子集的极差与 \\([{\\hat\\sigma}/√(n)]q_{\\alpha,t-2,v}\\) 进行比较。只要前一个子集具有显著的极差，则继续检查较小的均值子集。 每次得到不显著的极差时，将所涉及的均值包括在单个组中。被分在非显著组中的均值子集以后不能被视为显著；也就是说，不应对先前分组到共同子组中的均值进行进一步检验。当所有极差检验不显著时，程序结束。被分在在同一组中的任何两个均值没有显著差异；否则，它们有显著差异。 使用 1.6 节中的任务数据示例对该方法进行说明，取 \\(\\alpha=0.05\\). 由于样本量不等，样本量的调和平均值为 \\(11.23\\). 首先按升序排列均值： Task 6 5 2 1 3 4 Mean 28.818 29.500 31.083 31.923 35.800 38.000 Rank 1 2 3 4 5 6 第一步是对六个均值的极差进行比较，将 \\(38.000-28.818=9.182\\) 与 \\[q_{0.05,6,62}\\frac{\\hat\\sigma}{\\sqrt{\\tilde{n}}}=(4.16)\\sqrt{\\frac{30.9045}{11.23}}=6.900\\] 比较。由于 \\(9.819&gt;6.90\\)，需调查两个含有 \\(t-1=5\\) 个均值的子集。此时，将 \\(35.800-28.818=6.982\\) 和 \\(38.000-29.500=8.500\\) 与 \\[q_{0.05,5,62}\\frac{\\hat\\sigma}{\\sqrt{\\tilde{n}}}=(3.98)\\sqrt{\\frac{30.9045}{11.23}}=6.593\\] 比较。由于 \\(7.619&gt;6.60,8.5&gt;6.60\\)，接着调查含有 \\(t-2=3\\) 个均值的子集，有三个这样的子集。此时，将 \\(31.923 - 28.818 = 3.105,35.800 - 29.500 = 6.300,38.0 - 31.083 = 6.917\\) 与 \\[q_{0.05,4,62}\\frac{\\hat\\sigma}{\\sqrt{\\tilde{n}}}=(3.74)\\sqrt{\\frac{30.9045}{11.23}}=6.195\\] 比较。由于 \\(3.105&lt;6.195\\)，前四个均值被分为一组。由于 \\(6.300&gt;6.195,6.917&gt;6.195\\)，剩下的四个均值组都必须进一步细分为三个均值的组。在进行下一步之前，请考虑以下示意图，说明了当前的情况，其中直线表示前四个均值为一组，并且被认为没有差异。 四个均值的第一个子集 {29.500, 31.083, 31.923, 35.800} 包含已组合在一起的两组三个均值，即 \\(29.500–31.923\\) 和 \\(28.818–31.083\\). 因此，极差 \\(31.923 - 29.500 = 2.423\\) 和 \\(31.083 - 28.818 = 2.265\\) 不与临界点进行比较。仍需比较的极差是 \\(35.800 - 31.083 = 4.717\\) 和 \\(38.0 - 31.923 = 6.077\\)；这些必须与 \\[q_{0.05,3,62}\\mathrm{~}\\frac{\\hat\\sigma}{\\sqrt{\\tilde{n}}}=(3.40)\\sqrt{\\frac{30.9045}{11.23}}=5.635\\] 比较。由于 \\(4.717 &lt; 5.635\\)，这三个均值现在被为一个组，而由于 \\(6.077 &gt; 5.635\\)，第二组必须进一步细分为每组两个均值的组。下图说明了当前情况： 只有一个尺寸为 2 的子集 {35.8, 38.0} 尚未合并到一个公共组中。将极差 \\(38.0 - 35.8 = 2.2\\) 与 \\[q_{0.05,2,62}\\frac{{\\hat\\sigma}}{\\sqrt{\\tilde{n}}}=(2.83)\\sqrt{\\frac{30.9045}{11.23}}=4.691\\] 比较。由于 \\(2.2&lt;4.69\\)，最后这两个均值被分到一组。最终的示意图为： 说明此信息的另一种方法是，如果它们出现在同一组中，则用相同的字母标记均值；如果它们出现在不同的组中，则用不同的字母标记均值。因此，任务数据均值的比较可以表示为 Task Mean 1 31.923 bc 2 31.083 bc 3 35.800 ab 4 38.000 a 5 29.500 c 6 28.818 c 3.17.2 Duncan’s New Multiple Range Method 目前，这种方法通常被称为 Duncan’s method。它是更流行的方法之一，部分原因是使用该方法通常比任何其他方法更容易找到显著差异，除了 Fisher’s LSD method。但是，虽然 Duncan’s method 控制了比较错误率，但它无法控制 FWER。此过程也需要相等的 \\(n_i\\) ，并且与上一节一样，如果对于近似过程而言样本量不太不平等，则以下公式中的变量 \\(n\\) 可以替换为 \\(\\tilde n\\). 此过程的应用类似于 Student-Newman-Keul method 的应用，不同之处在于用于比较一组 \\(p\\) 个均值的学生化极差临界点 \\(q_{\\alpha,p,v}\\) 替换为 \\(q_{\\alpha_p,p,v}\\)，其中 \\(\\alpha_p=1-(1-\\alpha)^{p-1}\\). \\(q_{\\alpha_p,p,v}\\) 的值在附表 A.5 中给出。对于上一节中的数据，此程序应用如下： 将 \\(38.000 - 28.818 = 9.182\\) 与 \\[q_{\\alpha_{6},6,62}\\frac{\\hat\\sigma}{\\sqrt{\\tilde{n}}}=(3.198)\\sqrt{\\frac{30.9045}{11.23}}=5.303\\] 比较，其中 \\(\\alpha_6=1-(1-0.05)^{6-1}=0.226\\). 六个均值的极差是显著的。 将 \\(35.800 - 28.818 = 6.982\\) 和 \\(38.000 - 29.500 = 8.500(3.143)(1.659) = 5.213\\) 与 \\[q_{\\alpha_5,5,62}\\frac{\\hat\\sigma}{\\sqrt{\\tilde{n}}}=(3.143)\\sqrt{\\frac{30.9045}{11.23}}=5.214\\] 比较，其中 \\(\\alpha_5=1-(1-0.05)^{5-1}=0.186\\). 两个极差都是显著的。 将 \\(31.923 - 28.818 = 3.105\\)，\\(35.800 - 29.500 = 6.300\\) 和 \\(38.000 - 31.083 = 6.917\\) 与 \\((3.073)(1.659) = 5.098\\) 比较。后两个极差显著，而第一个极差不显著。此时的分组为 将 \\(35.800 - 31.083 = 4.717\\)，\\(38.000 - 31.923 = 6.077\\) 与 \\((2.976)(1.659) = 4.937\\) 比较。第二个极差显著，而第一个极差不显著。现在的分组情况为： 将 \\(38.000 - 35.800 = 2.200\\) 与 \\((2.829)(1.659) = 4.693\\) 进行比较。该极差不咸猪手。最终的示意图为： 这个例子中 Student-Newman-Keul’s method 和 Duncan’s method 得出相同的图；然而，它们通常不会如此，因为他们使用学生化极差的不同分位数。Duncan’s method 使用较小的值来比较均值极差，这就是它无法控制 FWER 的原因。 3.18 Waller–Duncan Procedure 此程序不适用于大多数混乱数据的情况，因为它也需要相等的 \\(n_i\\)，但当它们不相等时，使用样本量的调和平均值来实现。包含此程序有几个原因，但主要是因为该程序不为人所知，并且因为它似乎具有一些理想的性质，Waller-Duncan procedure 使用样本数据来帮助确定是否需要保守规则（如 Tukey-Kramer）或非保守规则（如 Fisher’s LSD）来进行处理均值之间的成对比较。该程序利用 \\(F\\) 检验的计算值来检验 \\(H_{0}\\colon\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\). 如果 \\(F\\) 值很小，则样本数据往往表明均值是同质的。此时 Waller-Duncan procedure 需要样本均值的绝对差很大才能宣称显著性，从而防止太多的显著性差异。如果 \\(F\\) 值很大，则样本数据往往表明均值是不同质的。此时该程序要求样本平均值的绝对差较小来给出显著性，从而防止太少的显著性差异。Waller-Duncan procedure 要求选择一个称为错误率比 (error rate ratio) 的常数 \\(K\\)，该常数表示 I 类错误相对于 II 类错误的严重性。\\(K\\) 和 I 类错误概率之间的关系大致如下： \\(\\alpha\\) \\(K\\) 0.10 50 0.05 100 0.01 500 因此该程序的临界点取决于 \\(K,n,t\\) 和检验 \\(H_{0}\\colon\\mu_{1}=\\mu_{2}=\\cdots=\\mu_{t}\\) 的 \\(F\\) 统计量的计算值。此处未包含表格；它们在 Ott (1988) 中给出。为了使用该程序，我们计算一个 Waller–Duncan LSD，并将所有均值对与此单个 LSD 值进行比较，就像使用 Fisher’s LSD procedure 或 Tukey–Kramer HSD procedure 对待等样本量问题一样。当用户在 SAS-GLM 中请求 Means/Waller 选项时，会计算 Waller–Duncan LSD 值，并将均值分组为类似于上两节给出的图表中。 3.19 示例：成对比较的多重极差 Duncan、Student–Newman–Keul 和 Waller–Duncan 方法可以使用 SAS-GLM 的 Means 语句来完成。表 3.14 包含为任务数据集拟合单向模型的 GLM 代码，并包含 Means 语句，以提供比较六个任务均值的三种方法。表 3.15 包含 Duncan’s 多重比较法的结果。计算并呈现临界极差值，以使人们能够查看一系列均值并确定它们是否不同。例如，当该组涉及四个均值时，将该极差与 \\(5.096\\) 进行比较。均值从大到小依次列出，字母 \\(A,B,C\\) 表示显著的分组。 表 3.14: 生成 Ducan、Student–Newman–Kuels 和 Waller–Duncan 多重比较程序的程序的 GLM 代码 x PROC GLM DATA=EX1; CLASS TASK; MODEL PULSE20=TASK; MEANS TASK/DUNCAN; MEANS TASK/SNK; MEANS TASK/WALLER; 表 3.15: 使用 Duncan’s 多重比较程序的结果 x 注释: 此检验控制 I 类比较错误率，而不是实验错误率。 表 3.16 包含 Student–Newman–Keul’s method 的类似结果。如上所述，Student–Newman–Keul’s method 的临界极差值大于 Duncan’s method 的临界极差值。临界极差值的增加使得 Student–Newman–Keul’s method 能够在完全零假设（所有均值相等）下控制实验误差率，而 Duncan’s method 无法控制实验误差率。表 3.17 包含 Waller–Duncan method 的结果。最小显著性差异为 \\(4.448\\)，该值小于表 3.4 中任何未调整的 \\(t\\) 值。最小显著性差异使用样本量的调和平均值为所有比较提供一个值。最小显著性差异较小是因为 \\(F\\) 统计量的值很大，表明均值之间可能存在差异。 表 3.16: SNK 多重比较程序的结果 x 注释: 该检验在完全零假设下控制 I 类实验误差率，但在部分零假设下无法控制。 表 3.17: Waller-Duncan 多重比较程序的结果 x 注释: 该检验在加性损失和某些其他假设下能最小化贝叶斯风险。 3.20 警示 在结束本章之前，请注意，当样本量不等时，下划线或分组程序可能不一致。考虑一个示例，其中标准差的估计值为 \\(2\\)，该值基于 \\(50\\) 个自由度。样本量和样本均值为 Treatment 1 2 3 4 \\(\\hat\\mu_i\\) 39.3 40.1 42.0 43.0 \\(n_i\\) 2 25 25 2 检验均值相等假设所需的 \\(F\\) 统计量的值为 \\(4.90\\)，显著性水平为 \\(0.005\\)。将 \\(\\mu_1\\) 与 \\(\\mu_2\\)、\\(\\mu_1\\) 与 \\(\\mu_3\\)、\\(\\mu_2\\) 与 \\(\\mu_4\\) 和 \\(\\mu_3\\) 与 \\(\\mu_4\\) 进行比较的 \\(5\\%\\) LSD值为 \\((2.008)(2)√(1/2+1/25)=2.951\\). 将 \\(\\mu_1\\) 与 \\(\\mu_4\\) 进行比较的 \\(5\\%\\) LSD值为 \\((2.008)(2)√(1/2+1/2)=4.016\\)，将 \\(\\mu_2\\) 与 \\(\\mu_3\\) 进行比较的 \\(5\\%\\) LSD值则为 \\((2.008)(2)√(1/25+1/25)=1.136\\). 因此，对于这些数据，最大均值和最小均值之间的差异 \\(\\hat\\mu_1-\\hat\\mu_4=3.7\\) 不显著，而两个中间均值之间较小的差异 \\(\\hat\\mu_2-\\hat\\mu_3=1.9\\) 是显著的。我们可以通过注意到有足够的信息（足够大的样本量）来声明 \\(\\mu_2\\) 和 \\(\\mu_3\\) 之间存在统计上显著的差异，但没有足够的信息（样本量太小）来声明任何其他均值对之间存在统计上显著的差异来解释这种明显的不一致性。 3.21 结束语 在本章中，讨论了从一个实验数据集进行许多推断的程序。这样的程序是必要的，以确保观察到的处理之间的差异是由于所比较的参数函数的实际差异，而不仅仅是由于偶然性。有些程序更适合计划的比较，而另一些程序更适合数据窥探。对于具有多个变量的研究，可以使用所有均值相等的 \\(F\\) 检验来避免对某些变量进行多重比较。如果 \\(F\\) 检验在所需的 \\(\\alpha\\) 水平上不显著，则不必进行进一步的比较，但如果 \\(F\\) 检验在所需的 \\(\\alpha\\) 水平上显著，则应使用调整多重性的多重比较方法来比较均值（这不是 Fisher’s protected LSD）。最后，所讨论的多重比较和检验程序可应用于不等方差模型（在第 2 章中讨论），通过使用 SAS-Mixed 中的 LSMeans 语句来实现，其中 REPEATED 语句用于指定不等方差结构。还给出了在给定情况下使用哪种程序的建议。 3.22 练习 参考文献 Fisher, R. A. (1949). The Design and Analysis of Experiments. Oliver and Boyd, Edinburgh, UK. Westfall, P. H., Tobias, R. D., Rom, D., Wolfi nger, R. D., and Hochberg, Y. (1999). Multiple Comparisons and Multiple Tests Using the SAS System. SAS Institute, Inc., Cary, NC. Benjamini, Y. and Hochberg, Y. (1995). Controlling the false discovery rate: A practical and powerful approach to multiple testing. J. Roy. Stat. Soc. B., Methodological, 57, 289–300. SAS Institute, Inc. (1999). SAS/STAT User’s Guide, Version 8. SAS Institute, Inc., Cary, NC. Westfall, P. H. (2002). From Farms to Pharmaceuticals: Multiple Comparisons Enter the 21st Century. Proceedings of the 13th Annual Kansas State University Conference on Applied Statistics in Agriculture, G. A. Milliken, ed. Department of Statistics, Kansas State University, Manhattan, KS. Šidák, Z. (1967). Rectangular confi dence regions for the means of multivariate normal distributions. J. Am. Stat. Assoc., 62, 626–633. Holm, S. (1979). A simple sequentially rejective multiple test procedure. Scand. J. Stat., 6, 65–70. Benjamini, Y. and Hochberg, Y. (1995). Controlling the false discovery rate: A practical and powerful approach to multiple testing. J. Roy. Stat. Soc. B., Methodological, 57, 289–300. Tukey, J. W. (1952). Allowances for various types of error rates. Unpublished IMS address, Chicago, IL. Tukey, J. W. (1953). The problem of multiple comparisons. Unpublished manuscript. Kramer, C. Y. (1956). Extension of multiple range tests to group means with unequal numbers of replications. Biometrics, 12, 307–310. Edwards, D. and Berry, J. J. (1987). The effi ciency of simulation-based multiple comparisons. Biometrics, 43, 913–928. Miller, R. G. (1967). Simultaneous Statistical Inference. McGraw-Hill Inc., New York, NY. Holland, B. S. and Copenhaver, M. D. (1987). An improved sequentially rejective Bonferroni test procedure. Biometrics, 43, 417–424. Ott, L. (1988). An Introduction to Statistical Methods and Data Analysis, 3rd ed. PWS-Kent Publishng Co., Boston, MA. 原文为 100% significance level. 应为笔误。↩︎ 原文为 That is, a smaller value of \\(\\sum_{i=1}^tc_i\\hat \\mu_i\\) can often enable one to declare that \\(\\sum_{i=1}^tc_i\\mu_i\\) is significantly different from zero using Bonferroni’s method or the multivariate t-method than can be declared significant by Scheffé’s method. 为符合中文表达，此处做了适当修改。↩︎ 原文为: not too unequal.↩︎ 原文为: not too unequal.↩︎ 原文中没有 “significant” 一词，严谨起见，译者已添加。↩︎ 原文中没有 “significant” 一词，严谨起见，译者已添加。↩︎ "],["chap4.html", "第 4 章 实验设计基础 4.1 介绍基本概念 4.2 设计实验的结构 4.3 不同设计实验的示例 4.4 结束语 4.5 练习 参考文献", " 第 4 章 实验设计基础 经过适当设计和分析的实验提供了有关所使用资源的调查条件的最大信息量。本章介绍了实验者设计和分析实验时使用的概念和方法。本章讨论的基本概念是处理结构 (treatment structure) 和设计结构 (design structure)，以及重复 (replication)、区组 (block) 和实验单元 (experimental unit) 的思想。给出了设计和处理结构相结合的实例，以说明完全区组设计和不完全区组设计的概念。这些设计涉及一种尺寸的实验单元。第五章描述了实验单元尺寸的概念，并给出了涉及多于一种实验单元尺寸的各种设计。本章提出的设计结构包括完全随机化 (completely randomized, CRD)、随机完全区组 (randomized complete block, RCBD)、不完全区组 (incomplete block, IBD)和拉丁方 (Latin square, LSD)。所考虑的处理结构包括单向、双向、双向对照、部分析因和 \\(n\\) 向结构。在本一章中，介绍了具有必要的变异源和自由度的模型和方差分析表。讨论提供了确定用于计算误差平方和的变异源的方法，以及用于计算结果自由度的算法。一般来说，误差平方和是通过对观测值或经过相同处理的观测值的线性组合 (observations that are treated alike) 的比较来获得的。其他平方和的计算将在后面的章节中讨论。本章的基本方法是通过示例来演示概念。裂区 (split-plot)、重复测量 (repeated measures)、裂条区 (strip-plot) 和交叉设计 (crossover designs ) 使用不同尺寸 (size) 的实验单元的概念，并在第 5 章中进行了描述。涉及嵌套 (nesting) 的设计也在第 5 章中进行了讨论。 4.1 介绍基本概念 实验设计涉及计划实验，以便从可用资源中获得最多的信息。实验的设计应该从要达到的目的开始。应指定一个或多个主要响应变量，并充分描述实验目的和响应变量之间的联系。应解释用作实验单元的实体，并将其与实验目的联系起来。通常，在设计实验时，实验者可以控制某些被称为处理、总体或处理组合的因素。实验者通常控制要使用的实验单元的选择以及这些实验单元是否可以分组（称为区组）。典型的实验涉及要进行比较或要研究其效应的处理（或处理组合）。 在进行实验之前，必须回答几个问题： 实验的目的是什么？响应变量是什么？这是设计的一个非常重要的方面，因为必须了解生成数据的过程以及数据与目的的关系。 需研究多少种处理？处理的数量可能已经被指定，但有时应该讨论处理的选择如何与研究的目的相关。例如，一名营养学专业的学生想要设计一项研究，以确定在饼干产品中可以使用的大豆粉的最大量来代替小麦粉，这样所得的饼干中就没有大豆味了。该学生选择的饼干配方涉及用大豆粉替代 0、10、20、30、40、50、60、70、80、90 和 100% 的小麦粉。第一个问题是：“如果使用100%大豆粉，你能尝到大豆的味道吗？”因为如果你不能品尝到100%大豆粉的大豆味，那么就没有必要进行实验，如果你能品尝到大豆味，那么就没有必要在一组处理中包括100%大豆粉。我们认为尚不清楚用 20%、30%、40% 和 50% 大豆粉制成的产品是否可以品尝到大豆味。即，确定大豆粉含量为10％时无法品尝到大豆味，而大豆粉含量超过50％时则可品尝到大豆味。确定了不能品尝到含有10%大豆粉的大豆味，而可以品尝到含有超过50%大豆粉的大豆味，在将处理的选择与研究目的联系起来后，只需要最初11个处理中的5个（0、20、30、40和50%大豆粉）。0%作为小麦粉对照。这一过程大大减少了研究所需的样本数量。 每种处理需要观测多少次？这个问题与实现特定目的所需的样本量有关。 实验单元是什么？许多实验只涉及一个尺寸的实验单元。但其中涉及的重要思想是独立的重复。一些实验涉及多个尺寸的实验单元，这一概念在第 5 章中有所描述。研究人员通常认为一个实验只涉及一个尺寸的实验单元，而无法识别涉及多种尺寸的实验单元的情况。这个问题需要认真解决，如第 5 章所述。 实验者如何将处理应用于可用的实验单元，然后对响应进行观测？这个问题涉及使用随机化将处理分配给实验单元，以及在提供数据过程的其他部分中使用随机化。重要的是，随机化用于将处理分配给实验单元。在医学研究中，以随机顺序在实验室中运行样本或使用随机顺序评估受试者也很重要。 是否可以对最终设计进行分析或进行所需的比较？这可能是研究人员最重要的问题，但本书的一个主要目的是使读者能够使用更复杂的设计，并且仍然能够进行分析，以估计重要参数并检验所需的假设。 这些问题的答案不一定是直截了当的，也不能笼统地回答这些问题。希望这里讨论的想法和概念能帮助实验者收集足够的信息，为他们的研究提供答案。 为了继续，考虑一个涉及 \\(t\\) 个处理的实验，其中每个处理应用于 \\(r\\) 个不同的实验单元。令 \\(y_{ij}\\) 是分配给第 \\(i\\) 个处理的第 \\(j\\) 个实验单元观测到的响应，用于描述 \\(y_{ij}\\) 的数学模型为 \\[\\begin{equation} y_{ij}=\\mu_i+\\varepsilon_{ij}\\quad\\mathrm{for~}i=1,2,\\ldots,t,\\mathrm{~and~}j=1,2,\\ldots,r \\tag{4.1} \\end{equation}\\] 其中 \\(\\mu_i\\) 是第 \\(i\\) 个处理的响应均值的未知真实值，\\(\\varepsilon_{ij}\\) 是一个随机变量，表示由自然变异和其他可能的随机和非随机误差源引起的噪声。研究人员应尽力控制非随机误差源，包括模型误差、测量误差、观测误差和处理误差的错误指定。为了进行这个实验，研究人员必须选择 \\(rt\\) 个实验单元，然后将 \\(r\\) 个实验单元随机分配给每个处理。该过程的随机化部分对于防止处理分配中出现偏差非常重要。正是由于实验单元被随机分配给处理，随机化或置换分析 (permutation analysis) 可用于开发适当分析的理论 (Kempthorne, 1952). 关于随机化的使用，至少可以说，它可以防止在实验中引入系统偏差。如果实验者不使用随机化，则无法判断观测到的差异是由于实验单元对处理的反应差异造成的，还是由于用于将实验单元分配给处理的系统方法造成的。 实验的统计目的是比较在实验单元上观测到的处理响应。例如，如果研究人员想比较高血压化合物对人类血压的影响，那么在研究中使用小白鼠作为实验单元将无法对人类做出推断。只能对实验单元的总体进行推断，研究中使用的实验单元是代表性样本。对想要进行推断的实验单元的总体进行表征是非常重要的。研究中使用的实验单元样本必须从总体中随机选择，以对该总体进行推断。通常不可能从要纳入研究的实验单元总体中随机选择实验单元。但至少实验单元的样本必须能够代表总体或一个概念总体 (conceptual population)。例如，在对生产线进行抽样时，人们希望为研究选择的物品能够代表尚未生产的物品总体。如果生产过程没有改变，那么可以合理地假设所选物品将代表未来的物品。描述实验中使用的实验单元所代表的实验单元的总体是非常重要的。如果实验单元不代表要对其进行推断 (inference) 的实验单元的总体，则不能进行推断，相反，人们可以推测 (conjecture) 处理对未抽样总体的效应。例如，从一项涉及白鼠的研究中获得的关于高血压化合物的信息可以用来推测（而不是推断）高血压化合物对人类的效应。 当为研究选择实验单元时，当研究中使用的实验单元组是同质的 (homogeneous) 或非常相似时，可以获得更好的处理之间的比较。在许多实验中，不可能选择 \\(rt\\) 个相同的实验单元。不相同的实验单元通过 \\(\\varepsilon_{ij}\\) 导致数据中的噪声。当实验单元不是同质的或不相似时，有三种方法可以用来解释实验单元之间的差异，一种方法是测量描述实验单元之间差异的特征，如体重和年龄，并使用 Milliken and Johnson (2001) 中描述的协方差分析 (analysis of covariance)。第二种方法是将实验单元分成几组几乎相同的实验单元。几乎相同的实验单元称为同质的。在这种情况下，处理可以在组内的相似实验单元上进行比较，其中组与组之间的变异可以在分析中被解释。相似实验单元的组被称为区组 (block)。解释实验单元之间变异性的第三种方法是同时使用区组和协变量 (covariate) 的分析 。假设有 \\(r\\) 个区组，每个区组有 \\(t\\) 个实验单元，每个区组中每个处理发生一次。表示第 \\(j\\) 个区组中第 \\(i\\) 个处理的观测到的响应的模型为 \\[\\begin{equation} y_{ij}=\\mu_i+b_j+\\varepsilon_{ij}^*\\quad\\mathrm{~for~}i=1,2,\\ldots,t,\\mathrm{~and~}j=1,2,\\ldots,r \\tag{4.2} \\end{equation}\\] 对于模型 (4.2)，模型 (4.1) 中的 \\(\\varepsilon_{ij}\\)s 替换为 \\(\\varepsilon_{ij} = b_j + \\varepsilon_{ij}^*\\)；也就是说，实验单元组或区组之间的变异已被识别并从 \\(\\varepsilon_{ij}^*\\) 中分离出来，它代表区组内实验单元的变异。通过将区组效应与实验单元分离，区组内变异 (within-block variation) 可用于比较处理效应，这涉及计算处理对比 (contrasts) 的标准误估计。 两种处理（或任何处理对比）可以在没有区组效应的情况下进行比较，方法是将两种处理的响应的区组内差异 (within-block differences) 视为 \\[\\begin{aligned} y_{ij}-y_{i^{\\prime}j}&amp; =(\\mu_i+b_j+\\varepsilon_{ij}^*)-(\\mu_{i^{\\prime}}+b_j+\\varepsilon_{i^{\\prime}j}^*) \\\\ &amp;=\\mu_i-\\mu_{i^{\\prime}}+\\varepsilon_{ij}^*-\\varepsilon_{i^{\\prime}j}^* \\end{aligned}\\] 这不取决于区组效应 \\(b_j\\)。这种差异的结果是，一个区组内两种处理响应差异的变异取决于实验单元之间的区组内变异，而不是区组间变异 (between-block variation)。 实验设计的目的是选择实验材料并进行分组，以便尽可能减少实验中各组内实验单元之间的噪声或实验误差。因此，要比较处理的实验单元应该尽可能相似，这样两种处理之间的较小差异就可以被检测为显著差异。 如果有 \\(t\\) 个处理和 \\(t\\) 个实验单元，则可以进行实验，并且可以根据观测结果估计每个处理的平均值。但无法获得误差方差的估计值。只有当部分或全部处理被重复时，才能获得误差方差的估计值（与 \\(\\varepsilon_{ij}\\) 或 \\(\\varepsilon_{ij}^*\\) 相关）。处理的重复 (replications) 是对处理的独立观测。因此，一种处理的两次重复必须涉及两个实验单元。实验单元是应用了处理的实体。但处理的重复必须涉及过程，以便在每个实验单元上独立应用并观测处理。因此，假设一名研究人员想比较两种饮食对兔子生长速度的影响，并且他有 \\(10\\) 只兔子可用于研究。这个过程是将五只兔子随机分配到每种处理中。但是，如果他将分配给其中一种饮食的五只兔子放在一个笼子里，而将分配给第二种饮食的五只兔子放在另一个笼子里，而同一个笼子里的兔子则从一个普通的碗里喂食这种饮食，结果会怎样呢？每只兔子被随机分配了饮食，但由于所有五只兔子都被放入一个笼子并用一个共同的碗喂食，因此不能对兔子进行独立观测。在这种情况下，实验单元是笼子而不是单个兔子。笼子之间是独立处理的，但笼子里的兔子却不是独立处理的。因此，笼子里的兔子不提供独立的饮食重复。了解进行研究的完整过程非常重要，以便能够了解何时发生独立重复以及何时不发生。必须遵守此定义以确定实验期间何时使用重复。研究人员经常使用复制 (duplicate) 或分割样本 (split samples) 来生成两个观测结果，并将它们称为重复 (replications)，而实际上，它们实际上是子样本 (sub-samples) 或重复测量 (repeated measures)。复制项必然不会提供与独立重复项相同的信息。 假设一名研究人员想要研究某所大学男女学生的身高差异。假设大学有 \\(22,000\\) 名学生。一个过程可以是从大学学生中随机选择 \\(100\\) 名女学生和 \\(100\\) 名男学生。下一步是找到随机样本中的所有学生并测量他们的身高，从而产生 \\(100\\) 个女性身高测量值和 \\(100\\) 个男性身高测量值。要找到所有 \\(200\\) 名学生，工作量似乎很大。相反，假设研究人员选择一名女性和一名男性，并测量每人的身高 \\(100\\) 次。第二个过程产生 \\(100\\) 个女性身高测量值（本例中为一名女性）和 \\(100\\) 个男性身高测量值（本例中也是一名男性）。每个数据集都有 \\(200\\) 个观测值，但第一个过程中一个数据集内 \\(100\\) 个测量值之间的变异性 (variability) 提供了大学女生和男生之间的变异性的测量。在第二种情况下，一组中的 \\(100\\) 个测量值的变异性提供了对同一个人进行的 \\(100\\) 个测量值之间的差异的度量。第二种情况提供了有关测量过程变异性的信息（对同一个人的重复测量），但没有提供关于特定大学的女性或男性身高之间的变异性的信息。对一个人身高的独立测量不能提供对总体身高的真实变异的测量。对 \\(100\\) 名女性身高的测量提供了 \\(100\\) 次重复，而对同一个人的 \\(100\\) 次测量提供了对该人的重复测量。对同一人的这 \\(100\\) 项测量被称为重复测量或子样本，但不是重复测量。 一位面包师进行了一项实验，比较了三种防腐剂在某种类型的蛋糕产品中抑制霉菌生长的能力。面包师把每种防腐剂混合在一起烤了一个蛋糕。每立方厘米蛋糕的霉菌孢子数量是在储存 \\(9\\) 天后测量的。面包师想要 \\(10\\) 次重复的分析，所以他把每个蛋糕分成 \\(10\\) 片，并获得了每片上的孢子数量。然而，这 \\(10\\) 次测量并不是由 \\(10\\) 种单独使用的防腐剂产生的。他的子样品测得的变异是蛋糕内变异 (within-cake variation) 的指标，而不是防腐剂实验单元间变异 (experimental-unit-to-experimental-unit variation) 或蛋糕间变异 (cake-to-cake variation) 的指标。为了得到每种防腐剂的 \\(10\\) 次重复，面包师需要用每种防腐剂烘焙 \\(10\\) 个蛋糕。这些蛋糕需要相互混合并独立烘焙。将一大批蛋糕面团搅拌在一起，加入防腐剂，然后将混合物倒入 \\(10\\) 个蛋糕平底锅中，可能会更容易。这一过程提供了 \\(10\\) 个蛋糕，但这些蛋糕并不是相互独立地混合在一起的，因此它们不是独立的重复。面包师需要将 \\(10\\) 批面团与防腐剂混合，然后在不同的烤箱 （或在不同的时间）从每批面团中烘焙一个蛋糕，以获得 \\(10\\) 种防腐剂的重复。 另一个非重复的例子涉及一些研究人员所称的条状试验 (strip trial)。在农学中，条状试验包括在一行 (rows)（或行组，a group of rows）中种植给定品种的所有种子，每行（或行组）种植不同的品种。然后将行（或行组）划分为八个部分，这些部分称为重复。图 4.1 中的图表表示六个裂条区 (strip plot)，每个裂条区有四行16，并被分成八个部分表示为重复。用条状试验代替八次独立重复的优点是，研究人员不需要在条状试验中不断地将种子从一个播种箱位置换到另一个播种箱位置，而且种植计划非常简单。现在，如果她想进行精心设计的实验，她就必须根据特定的随机方案更换播种箱八次。进行这样的随机化将在随机完全区组设计结构 (randomized complete block design structure) 中提供八个区组。如果实验者像分析随机完全区组设计一样分析条状试验数据，那么她的分析将是错误的。事实上，条状试验不能用来推断品种差异，因为每个品种只有一次独立的观测。四行或裂条区是应用该品种的实验单元。在条状试验中，研究人员可以轻松地将裂条区划分为 \\(20\\) 个部分 (parts) 或 \\(100\\) 个部分；毕竟，有了更多的“复制”，人们可以根据两种均值较小差异检测出显著的结果。但是，在这些裂条 (strips) 中的每一条上进行的这些测量都不是真正的重复；相反，它们是裂条区的子样本或重复测量。因此，获得越来越多的部分无助于检验均值之间的差异。确定某个部分或观测是否是真实重复的一个检验如下：如果研究人员可以通过分裂同样轻松地获得更多“重复”，那么她就没有获得真正的重复，而是获得了子样本或重复测量。区分子样本和重复样本非常重要，因为从子样本之间估计的误差方差通常比从重复样本或实验单元之间估计的误差方差小得多。使用从子样本计算出的误差方差构建的 \\(F\\) 统计量将比应有的值大得多，导致实验者确定更多的差异，因为其统计显著性超过了应有的差异。 图 4.1: 裂条区设计示意图，其中四个行和六个品种排列在八个伪重复中 4.2 设计实验的结构 设计实验 (designed experiment) 由两个基本结构组成，能够识别和区分每个结构至关重要。在为特定设计构建适当的模型和分析之前，实验设计中使用的所有因素必须分类为属于处理结构或设计结构。以下定义和讨论用于帮助描述两种结构之间的差异。 定义 4.1 ♦ 设计实验的处理结构 (treatment structure) 由实验者选择用于研究和/或比较的一组处理、因素、处理组合或总体组成。 处理结构是根据那些要比较的因素或处理构建的，通过它们对给定响应变量的效应来测量。必须选择处理结构中的因素来实现既定的实验目的。处理结构可以是一组处理，称为单向处理结构，也可以是一组处理组合，例如双向因素安排 (arrangement) 或高阶因素安排，加上任何对照或标准处理。 定义 4.2 ♦ 设计实验的设计结构 (design structure) 包括将实验单元分组为同质组或区组。 设计实验的设计结构涉及用于形成实验单元组的因素，以便观测处理的条件尽可能统一。如果所有实验单元都非常同质，则只需要一组或一组观测，并且实验单元可以完全随机地分配给处理。这样的设计结构称为完全随机设计结构 (completely randomized design structure). 如果需要多于一组的实验单元，使得组内的单元比组间的实验单元更加同质，则设计结构涉及某种类型的区组设计。有多种因素可用于形成实验单元的区组，但是，如下所述，用于构建区组的一个或多个因素不得与处理结构中的因素发生交互 (interact). 一旦选择了处理结构和设计结构，就通过准确描述将处理结构的处理随机分配（随机化）到设计结构中的实验单元的方法来指定设计的实验。 因此，总的设计实验包括 1）处理结构的选择，2）设计结构的选择和 3）将处理结构中的处理或处理组合随机分配给设计结构中的实验单元的方法。图 4.2 显示了设计实验的两个部分。 图 4.2: 使用随机化将处理结构与设计结构相结合以形成实验总体设计的图示 总的设计实验规定了用于获得适当分析的适当模型。在构建描述设计的模型时，对设计和处理结构进行了两个基本假设。首先，假设设计结构的组成部分是随机效应，即设计中使用的区组是来自实验单元的可能区组的总体的随机样本。这一假设意味着研究人员希望对大量的实验单元进行推断。其次，假设设计结构的组成部分（或因素）与处理结构的组成部分（或因素）之间没有交互作用。换言之，假设处理之间存在的关系从一个区组到另一个区组是一致的（随机变异除外），或者换句话说，区组因素不会影响处理之间的关系。许多教科书将区组因素描述为讨厌因素 (nuisance factors)，而没有解决讨厌因素与处理结构中的因素交互作用的可能性 (Cobb, 1997). 如果可以发生这种交互作用，则这些讨厌因素必须包括在处理结构中，或者讨厌因素的值可以被视为具有不等斜率可能性的协变量 (Milliken and Johnson, 2001). 必须仔细评估可能用于构建区组的因素的选择，以防止与处理结构中的因素可能发生交互。 设计结构的选择是利用实验单元的所有可用知识，并且是独立于处理结构选择的（不要让处理结构影响不良设计结构的选择）。同样，实验者应该在不了解设计结构的情况下选择处理结构（不要让设计结构妨碍选择必要的处理集合）。在指定了适当的设计结构并选择了所需的处理结构之后，可能需要在一个或两个结构中做出一些妥协，以使它们彼此兼容，并使实验者能够进行有效的实验。 4.2.1 设计结构类型 设计结构由区组类型或将实验单元分组为同质组来确定，并由用于形成区组的因素来指定。以下是对一些常见设计结构的描述。有两种基本的设计结构，它们被描述为完全区组 (complete block) 和不完全区组 (incomplete block) 设计结构。4.3 节对几种特定设计结构进行了更详细的讨论。 完全随机设计结构 (Completely randomized design structure). 在完全随机设计结构中，假设所有实验单元都是同质的，并且实验单元完全随机地分配给处理。通常，这些处理被分配相同数量的实验单元，尽管这不是必需的。当实验单元不是同质的，并且实验者不能确定允许将它们分组到更同质的组中的因素时，也可以使用这种设计结构。当区组因素的值被用作协变量而不是使用它们来形成区组时，可以使用协方差分析 (Milliken and Johnson, 2001). 随机完全区组设计 (Randomized complete block design). 如果有 \\(t\\) 个处理，那么随机完全区组设计结构包括具有实验单元的区组，每个区组中有 \\(t\\) 个或多个实验单元。当区组尺寸 (block size) 等于或大于处理数时，有可能在每个区组内出现一组完整的处理，因此被称为随机完全区组。如果每个区组的区组尺寸恰好等于 \\(t\\)，则每个处理恰好被随机分配到每个区组内的一个实验单元。如果每个区组内有 \\(t\\) 个以上的实验单元，那么每个处理可以分配到一个实验单元，一些处理（也可能是全部）可以分配到多个实验单元。如果 \\(t=5\\) 并且区组的尺寸为 \\(8\\)，则每个处理将被分配到每个区组内的实验单元，并且其中三个处理将被分配到一个额外的实验单元以进行这些处理的总共两次重复。一种策略是制定一种区组的处理模式，其中每个处理的观测数量尽可能均衡 (balanced)。图 4.3 包含一种将五种处理分配给三个尺寸为 \\(8\\) 的区组的方法。在每个区组内，将各自的处理随机分配给该区组内的实验单元。所示的安排是一组可能的随机化。如果每个区组由 \\(c\\times t\\) 个实验单元组成，其中 \\(c\\) 是整数，则每个处理可以分配给每个区组内的 \\(c\\) 个实验单元。这也是一个随机完全区组设计结构。随机完全区组设计结构是指区组内实验单元的数量大于或等于处理数量的任何区组方案，因此可以将一整套处理分配给每个区组中的实验单元。 图 4.3: 随机完整区组设计结构，在尺寸为 \\(8\\) 的区组中包含五种处理 拉丁方设计 (Latin square design). 拉丁方设计结构由两个方向的区组组成。对于涉及 \\(t\\) 个处理的实验，\\(t^2\\) 个实验单元被安排为 \\(t\\times t\\) 的方块 (square)，其中行被称为行区组 (row blocks)，列被称为列区组 (column blocks)。因此，实验单元的这种 \\(t\\times t\\) 安排在两个方向上被分区 (blocked)：行区组和列区组。为了构建拉丁方设计结构，将处理随机分配到方块中的实验单元，使得每种处理在每一行区组中发生一次且仅发生一次，在每一行区组中发生一次且仅发生一次。参见 Cochran and Cox (1957) 以了解在行区组和列区组中的各种处理安排。两个或多个方向的区组在许多学科中很常见，特别是当实验单元出现在矩形中时（其中一个维度可能是时间），按行和列进行分区很有用。Graeco–Latin 方块可用于形成三个方向的区组 (Cochran and Cox, 1957). 不完全区组设计 (Incomplete block design)。当一个或多个区组中的处理数超过实验单元数时，即出现不完全区组设计。当这种情况发生时，每个区组中不可能出现完整的处理集，因此被称为“不完全区组”。有几种特殊的不完全区组设计结构，如均衡不完全区组 (balanced incomplete blocks) 和部分均衡不完全区组 (partially balanced incomplete blocks). 均衡不完全区组设计结构是指将处理分配给区组，使得每对处理在同一区组中出现的次数相等。当一组处理在区组内一起出现相同的次数，而其他处理在一些区组内一起出现不同的次数时，就会出现部分均衡不完全区组设计结构。第 5 章中讨论的裂区设计结构是部分不完全区组设计结构的一个示例。例 4.5 描述了一些不完全区组设计结构。 各种组合和推广 (Various combinations and generalizations). 有多种方法可以对实验单元进行分组。有时分组不满足上述定义，但仍然提供了有效的设计结构。一个例子是区组尺寸因区组而异，其中一些区组是不完全的，而另一些区组是完全的。在任何情况下，这些其他的区组方案都可以为实验者提供非常可行的设计结构，以便进行有效的实验。 4.2.2 处理结构类型 处理结构由实验者希望研究的各种处理或处理组合或因素和因素组合组成。处理结构组成部分的选择应与实验目的相关，实验目的应在研究方案或描述中具体说明。接下来描述了一些常见的处理结构类型，每一种都在 4.3 节中进行了更详细的讨论。 单向处理结构 (One-way treatment structure). 单向处理结构由一组 \\(t\\) 个处理或总体组成，其中处理之间没有假定的结构。处理之间可能存在关系，例如使用四个温度，120、130、150和160°C。如果处理是通过组合两个或多个因素构建的，则这些因素不会用于表示模型中的处理。单向处理结构可用于表示任何一组处理，当一些可能的处理组合缺失时，单向处理结构通常用于表示析因 (factorial) 处理结构。第 ?? 章使用了这种方法。 双向处理结构 (Two-way treatment structure). 双向处理结构由通过组合两个不同因素的水平 (levels) 或可能性 (possibilities) 而构建的处理集组成。所得到的处理集，称为处理组合，是通过将其中一个因素的每个可能性与另一个因素的每个可能性组合而生成的。如果第一个因素有 \\(s\\) 个可能性，第二个因素有 \\(r\\) 个可能性，该组合产生 \\(sr\\) 种处理组合。图 4.4 给出了一个双向处理结构的例子，其中因素 \\(A\\) 有三种可能性，因素 \\(B\\) 有四种可能性，交叉产生 \\(12\\) 种处理组合。 图 4.4: 双向处理结构，其中因素 \\(A\\) 有三个水平，因素 \\(B\\) 有四个水平，生成 \\(12\\) 种处理组合 析因安排处理结构 (Factorial arrangement treatment structure). 析因安排处理结构由通过组合两个或多个因素的水平而构建的处理组合的集合组成。双向处理结构是双向析因安排。三向到 \\(n\\) 向处理结构也是析因安排。\\(n\\) 向处理结构是通过组合 \\(n\\) 个因素的可能性而生成的，其中，因素分别具有 \\(s_1,s_2,\\dots,s_n\\) 个可能性，从而生成 \\(s_1\\times s_2\\times\\dots\\times s_n\\) 种处理组合。析因安排处理结构的例子散布在整本书中。 部分析因安排处理结构 (Fractional factorial arrangement treatment structure). 部分析因安排处理结构仅由析因安排处理结构中可能的处理组合的一部分或一小部分组成。有许多系统的技术来选择适当的分数 (fraction)，其中大多数取决于实验者对处理结构中各种类型因素之间交互作用的假设。一个实验可能涉及 \\(8\\) 个具有两水平的不同因素，因此总共有 \\(2^8\\) 个处理组合。研究人员可能想寻找重要的主效应和两个因素的交互作用。在这种情况下，研究中可以使用四分之一分数 (one-fourth fraction) 或64个处理组合。这样的设计通常表示为 \\(2^{8-4}\\) 部分析因安排，更多细节参见 Milliken and Johnson (1989). 拉丁方排列处理结构涉及具有 \\(n\\) 行处理，\\(n\\) 列处理和 \\(n\\) 个单元格 (cells) 处理的三向析因排列。拉丁方排列由 \\(n^3\\) 种可能的处理组合中的 \\(n^2\\) 种组成，或者是\\(n^3\\) 种可能的处理组合的 \\(1/n =(n^2/n^3)\\) 部分。部分拉丁方安排的一个可能用途是，可以假设这三个因素之间没有双向或三向交互作用。 最优设计处理结构 (Optimal design treatment structures)。对于许多实验情况，处理结构中的所有因素都是定量的，研究目的是收集数据以建立特定的线性或非线性模型。使用其中一个设计准则 (St. John and Draper, 1975) 选择的处理组合形成了最优设计。这组处理组合被称为最优设计处理结构。 具有一个或多个对照的部分安排 (Factorial arrangement with one or more controls). 用于满足实验目的的期望处理结构可以包括将多种处理结构相结合。例如，实验的处理结构可以包括将 \\(c\\) 个对照的单向处理结构与双向析因安排处理结构相结合。图 4.5 包含一种这样的处理结构，其中因素安排由两个水平的因素 \\(A\\) 和三个水平的因素 \\(B\\) 以及三个对照组成。 图 4.5: 将单向和双向处理结构组合，形成九种处理组合的处理结构用于实验 出于分析目的，所有上述处理结构始终可以被视为一种单向处理结构。特别是，当处理结构是两个或多个处理结构的复杂组合时（如图 4.5 所示），在分析结果数据时通常最好将一组处理视为单向处理结构。 裂区和重复测量设计结构由不完全区组设计结构和涉及两个或多个因素的析因安排处理结构组成。实际上，裂区和重复测量设计的设计结构和处理结构的组合产生不同尺寸的实验单元，这是一个必须解决的问题，以便获得适当的分析。这样的设计将在第 5 章讨论。 4.3 不同设计实验的示例 有大量关于用于多种类型实验的各种类型设计的已发表信息，例如， Cochra and Cox (1957), Davies (1954), Federer (1955), Hicks (1993), John (1971), Kirk (1968), Cornell (1990), Anderson and McLean (1974), Box et al. (1978), Cobb (1997), Kempthorne (1952), Laundsby and Weese (1993), Lentner and Bishop (1986), Meed (1988), Montgomery (1991) and Winer (1971). 本节包含几个示例，以演示 4.2 节中描述的设计结构和处理结构。希望这一讨论将帮助读者将这些概念应用到他们自己的实验中。在大多数情况下，通过指定设计结构的类型和处理结构的类型来命名所得到的设计实验。例如，设计的实验可以由随机完全区组设计结构中的双向处理结构组成。这种描述设计实验的方法不同于文献中通常使用的方法，但作者认为使用设计结构和处理结构是识别设计实验的最好方法。此外，这一描述还有助于构建适当的模型并进行适当的分析。针对每种实验情况，给出了相应的设计结构和处理结构，并给出了相应的模型，以及带有相应的变异源及相应自由度的的方差分析表。本节不给出平方和的计算公式，但在其他章节中提供了一些有计算的例子。本章的重点是确定误差平方和的计算方法，并确立相应的自由度。 4.3.1 示例 4.1: 饮食 一位营养学家想要研究健康饮食对体重减轻的影响。本实验的处理结构是单向分类，涉及单个因素，称为饮食，具有五个水平或五个处理。许多不同的设计结构可以用来评估饮食。如果有 \\(20\\) 个同质的人，那么可以使用完全随机设计结构，其中每种饮食被随机分配给四个人。完全随机设计结构中的单向处理结构的一个模型是 \\[\\begin{equation} y_{ij}=\\mu_i+\\varepsilon_{ij}\\quad i=1,2,\\ldots,t,j=1,2,\\ldots,n_i \\tag{4.3} \\end{equation}\\] 其中 \\(\\mu_i\\) 表示第 \\(i\\) 种处理（饮食）的均值，\\(\\varepsilon_{ij}\\) 表示随机误差。模型 (4.3) 的方差分析表见表 4.1，其中假设了 \\(\\varepsilon_{ij}\\sim \\text{i.i.d.}\\,N(0,\\sigma^2)\\). 表 4.1 包含公式 (4.3) 中模型的不同变异源及其各自的自由度。实验误差的 \\(15\\) 个自由度是从经过相同处理的人之间的变异中得到的。有四个人接受了饮食 1，提供了经过相同处理的四个人，这四个人体重减轻值之间的差异为误差提供了三个自由度。每种饮食有四个人经过相同处理。因此，五种饮食中的每种饮食的数据都有三个可供误差的自由度。如果方差相等，那么这五组三个自由度可以合并为一个涉及 \\(15\\) 个自由度的误差项。第 2 章中的方法可用于评估等方差假设的合理性。 表 4.1: 完全随机设计结构中单向处理结构的方差分析表 x 假设研究者在给定时间段内只能招募并采访五个人。让时间段成为一个区组因素，并在每个时间段内将五种饮食随机分配给一个人。该设计是随机完全区组设计结构中的单向处理结构，具有四个尺寸为五的区组。可用于描述此设计中的数据的模型是 \\[\\begin{equation} y_{ij}=\\mu_i+b_j+\\varepsilon_{ij}\\quad i=1,2,3,4,5,j=1,2,3,4 \\tag{4.4} \\end{equation}\\] 其中 \\(\\mu_i\\) 表示第 \\(i\\) 个处理（饮食）的均值，\\(b_j\\) 表示第 \\(j\\) 个区组的效应，\\(\\varepsilon_{ij}\\) 表示与分配给第 \\(j\\) 个区组中第 \\(i\\) 个处理的人相关的随机误差。模型 (4.4) 的方差分析表如表 4.2 所示。误差自由度是通过使用每个区组内处理的四个正交对比来计算的，例如， \\[\\begin{array}{ll}q_{1j}=y_{1j}-y_{2j}&amp;j=1,2,3,4\\\\q_{2j}=y_{1j}+y_{2j}-2y_{3j}&amp;j=1,2,3,4\\\\q_{3j}=y_{1j}+y_{2j}+y_{3j}-3y_{4j}&amp;j=1,2,3,4\\\\q_{4j}=y_{1j}+y_{2j}+y_{3j}+y_{4j}-4y_{5j}&amp;j=1,2,3,4\\end{array}\\] 表 4.2: 随机完全区组设计结构中单向处理结构的方差分析表，每个区组中每种处理有一次重复 x 相同 \\(i\\) 值的 \\(q_{ij}\\) 值都具有相同的均值，表明它们都经相同处理。因此，每组四个 \\(q_{ij}\\) 值的方差为误差提供了三个自由度。因此，可以将四组三个自由度合并（如果方差相等）为具有 \\(12\\) 个自由度的误差平方和。然而，\\(q_{ij}\\) 的方差并不相等，必须在合并 (pooling) 之前重新缩放。对于 \\(j = 1, 2, 3, 4\\)，方差为 \\(\\text{Var}(q_{1j}) = 2\\sigma^2,\\text{Var}(q_{2j})= 6\\sigma^2,\\text{Var}(q_{3j})= 12\\sigma^2\\) 以及 \\(\\text{Var}(q_{4j})= 20\\sigma^2\\)，因此方差为在合并之前需要将 \\(q_{ij}\\) 除以 \\(\\sigma^2\\) 的系数。实际上，这些合并的平方和提供了区组与饮食交互作用的平方和。因此，获得相似处理的方差的第二种方法是使用区组与处理的交互作用 (block-by-treatmen interaction) 来获得随机完全区组设计结构的实验误差估计。 接下来，假设没有 \\(20\\) 个同质的人，但有 \\(10\\) 个同质的男性和 \\(10\\) 个同质的女性。一种策略是使用人的性别作为区组因素，其中有两个尺寸为 \\(10\\) 的区组。可以使用随机完全区组设计结构，其中每种饮食将随机分配给两名男性和两名女性，因此每个区组中每种饮食有两次重复。随机完全区组设计结构中单向处理结构的模型为 \\[\\begin{equation} y_{ijk}=\\mu_{i}+b_{j}+\\boldsymbol{\\varepsilon}_{ijk}\\quad i=1,2,3,4,5,j=1,2,k=1,2 \\tag{4.5} \\end{equation}\\] 其中 \\(\\mu_i\\) 表示第 \\(i\\) 个处理（饮食）效应的均值，\\(b_j\\) 表示第 \\(j\\) 个区组的效应，\\(\\varepsilon_{ijk}\\) 表示与分配给第 \\(j\\) 个区组中第 \\(i\\) 个处理第 \\(k\\) 个人相关的随机误差。模型 (4.5) 的方差分析表如表 4.3 所示。有一个与设计结构或人的性别相关的自由度已从表 4.1 的误差项中删除。随机完全区组设计结构中的单向处理结构的误差项，其中每个区组中每个处理有一个观测结果，是根据区组与处理的交互作用来计算的。这种设计包括区组和每个区组中每种处理的多次观测。区组与处理的交互作用的自由度等于 \\((2-1)×(5-1)=4\\). 每个区组内每种饮食的两个观测结果的变异性提供了一个自由度。因此，在每个区组内对经相同处理的人进行比较时，有五个误差自由度，或者在两个区组内总共有 \\(10\\) 个自由度。将区组与处理的交互作用与区组内变异合并起来共提供了 \\(14\\) 个误差自由度。 表 4.3: 随机完全区组设计结构中单向处理结构的方差分析表，每个区组中每种处理有两次重复 x 在大多数情况下，人的性别不是区组因素好的选择，因为处理（这个例子为饮食）可能会与人的性别发生交互 (interact)。如果选择用于构建区组的一个或多个因素可能与处理发生交互，则该因素需要作为分层因素或在具有可能不等斜率的协方差分析中包括在处理结构中，以进行适当的分析 (Milliken and Johnson, 2001). 在这个例子中，一个人的性别必须与五种饮食相结合，以形成双向因素安排或双向处理结构。这种双向处理结构由 \\(10\\) 种处理组合组成，通过将人的两个性别水平与五个饮食水平相结合而产生。通过将人的性别从设计结构切换到处理结构，得到的设计结构是一个完全随机的设计，每个处理组合有两次重复。随机化方案是将每种饮食随机分配给两名男性和两名女性。这是与模型 (4.5) 相同的随机化方案，但具有不同的处理和设计结构。完全随机化设计结构中的双向处理结构的一个模型是均值模型： \\[\\begin{equation} y_{ijk}=\\mu_{ij}+\\varepsilon_{ijk}\\quad i=1,2,\\ldots,5,j=1,2,k=1,2 \\tag{4.6} \\end{equation}\\] 其中 \\(\\mu_{ij}\\) 表示第 \\(ij\\) 种处理组合（人的性别与饮食）的平均值，\\(\\varepsilon_{ijk}\\) 表示随机误差。有时，均值 \\(\\mu_{ij}\\) 表示为效应模型： \\[\\mu_{ij}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij}\\] 其中 \\(\\mu\\) 是总体平均值17(overall mean)，\\(\\tau_i\\) 是第 \\(i\\) 种饮食的效应，\\(\\beta_j\\) 是人的第 \\(j\\) 种性别的效应，\\(\\gamma_{ij}\\) 是交互作用效应。表 4.4 给出了模型 (4.6) 这两种 \\(\\mu_{ij}\\) 表达式的方差分析表。 表 4.4: 完全随机设计结构中双向处理结构方差分析表，包含均值模型和效应模型 x 接下来，假设饮食结构由一个对照饮食和四个饮食组成，这四个饮食由两个蛋白质水平和两个碳水化合物水平的四个组合组成，如图 4.6 所示。饮食处理结构是一种双向析因安排，当与人的性别交叉时，对照组会产生一种三向处理结构（蛋白质×碳水化合物×性别），其中有两个对照，一个对照用于男性，一个对照用于女性。设计结构是完全随机的，每个处理组合分配给两个人。可以用来描述这些数据的模型是 \\[\\begin{equation} y_{ijk}=\\mu_{ij}+\\varepsilon_{ijk}\\quad i=0,1,2,3,4,j=1,2,k=1,2 \\tag{4.7} \\end{equation}\\] 其中 \\(\\mu_{01}\\) 和 \\(\\mu_{02}\\) 表示对照组的平均值， \\(\\mu_{ij},i = 1, 2, 3, 4, j = 1, 2\\) 表示饮食与性别处理组合的平均值。表 4.5 为模型 (4.7) 的方差分析表。其中 “Control vs 22” 表示对照饮食与四种蛋白质和碳水化合物处理组合的平均值之间的比较。完整的分析最有可能使用饮食与性别的双向处理结构，并具有适当的处理均值的对比，以提供涉及蛋白质、碳水化合物、人的性别和对照的比较。这种对比的构建将在第 6 章及以后进行讨论。 表 4.5: 完全随机设计结构中三向析因安排与两个对照相结合的处理结构的方差分析表 x 图 4.6: 具有双向析因安排和一个对照的处理结构的饮食结构 4.3.2 示例 4.2: 房屋油漆 一家油漆公司想要比较四种白色房屋油漆承受环境条件的能力。实验中准备了四栋方形房屋，每栋房屋的一面朝北，因此房屋可以作为区组因素。房屋的每一面都可能暴露在不同类型的天气下，因此房屋的侧面（这里用北、南、东、西方向表示）也可以用作区组因素。由于处理数量（四种油漆）与两个区组因素的水平数相同，因此可以使用拉丁方设计结构来研究油漆。在这里，油漆可以分配到房屋的侧面，其中每种油漆可以在每个房屋上发生且仅发生一次，并且在每个方向上发生且仅发生一次。存在三种基本的拉丁方安排（参见 Cochran and Cox, 1957）。随机化过程是从三种可能的安排中随机选择一种，然后将房屋随机分配给行，将方向随机分配给列，并将油漆类型随机分配给方块中的字母。表 4.6 显示了一种将油漆分配给房屋和方向的安排。 表 4.6: 将一组处理从单向处理结构分配到拉丁方设计结构 x 本实验的设计是一种单向处理结构中的拉丁方设计结构。可以用来描述该实验数据的模型是 \\[\\begin{equation} y_{ijk}=\\mu_i+h_j+d_k+\\boldsymbol{\\varepsilon}_{ijk}\\quad i=1,2,3,4,j=1,2,3,4,k=1,2,3,4 \\tag{4.8} \\end{equation}\\] 其中 \\(\\mu_i\\) 表示第 \\(i\\) 种油漆的平均耐磨性得分，\\(h_j\\) 表示第 \\(j\\) 个房屋的效应，\\(d_k\\) 表示第 \\(k\\) 个方向的效应，\\(\\varepsilon_{ijk}\\) 表示实验单元误差。表 4.7 给出了模型 (4.8) 的方差分析表。拉丁方设计结构的误差由对比组成，这些对比测量了油漆、房屋与方向的交互作用。 表 4.7: 拉丁方处理结构中单向处理结构的方差分析表 x 接下来，假设油漆具有由 1）基础油漆，2）基础油漆 + 添加剂 I，3）基础油漆 + 添加剂 II，以及 4）基础油漆 + 添加剂 I +添加剂 II。油漆的这种结构提供了双向处理结构，其中一个因素是两个水平[无和添加一些]的添加剂 I，第二个因素是两个水平[无和添加一些]的添加剂 II。由此产生的四种处理组合见表 4.8. 表 4.8: 房屋油漆的双向处理结构示例 x 拉丁方设计结构中的双向处理结构的一个模型是 \\[\\begin{equation} y_{ijkm}=\\mu+\\gamma_i+\\beta_j+(\\gamma\\beta)_{ij}+h_k+d_m+\\varepsilon_{ijkm}\\quad i=1,2,\\quad j=1,2,\\quad k=1,2,3,4,\\quad m=1,2,3,4 \\tag{4.9} \\end{equation}\\] 其中 \\(\\gamma_i\\) 表示添加剂 I 的效应，\\(b_j\\) 表示添加剂 II 的效应，\\((gb)_{ij}\\) 表示两种添加剂之间的交互作用。表 4.9 给出了模型 (4.9) 的方差分析表。分析模型 (4.8) 和 (4.9) 的唯一区别在于，在模型 (4.9) 中，油漆具有一种结构，用于将油漆效应划分为添加剂 I、添加剂 II 以及添加剂 I 和 II 的交互作用所产生的效应。即使处理结构的分析发生了变化，与设计结构相对应的分析部分仍然不受影响。 最后，假设有八栋房屋可用，以便可以使用两种不同的拉丁方设计结构进行实验。表 4.10 显示了将油漆分配给房屋-方向组合的一种可能分配。如果油漆具有表 4.8 中的双向处理结构，则模型由下式给出 \\[\\begin{align} y_{ijkmn}&amp;=\\mu+\\gamma_i+\\beta_j+(\\gamma\\beta)_{ij}+s_k+h_{n(k)}+d_m+\\varepsilon_{ijkmn}\\\\ i&amp;=1,2,\\,j=1,2,\\,k=1,2,\\,m=1,2,3,4,\\,n=1,2,3,4 \\tag{4.10} \\end{align}\\] 其中 \\(s_k\\) 表示方块 \\(k\\) 的效应，\\(h_{n(k)}\\) 表示方块 \\(k\\) 中房屋 \\(n\\) 的效应。模型 (4.10) 的方差分析表如表 4.11 所示。 表 4.9: 拉丁方处理结构中双向处理结构的方差分析表 x 表 4.10: 在重复拉丁方设计结构中显示单向处理结构的安排 x 注释: Square 1 和 Square 2 为用于重复拉丁方设计的两个房屋分组 表 4.11: 重复拉丁方设计结构中双向处理结构的方差分析表 x 注释: Square 为用于重复拉丁方设计的房屋分组 4.3.3 示例 4.3: 钢板 当需要在两个方向上分区 (block) 时，拉丁方设计结构非常有用，但是实验者使用的每个拉丁方安排都不是拉丁方设计结构。此示例用于演示使用拉丁方安排处理结构的后果。将两种油漆添加剂组合起来，对钢板涂漆。该实验的目的是研究油漆组合保护钢材免受高温影响的能力。每种油漆添加剂有五个水平和五个温度来检查保护能力。该实验适用于拉丁方，其中添加剂 I 的水平分配给行，添加剂 II 的水平分配给列，温度水平分配给方块内的单元格。这种排列产生 \\(25\\) 种处理组合。实验单元为 \\(25\\) 块厚 \\(0.2cm\\)、面积为 \\(1 m^2\\) 的钢板。随机化过程是将 \\(25\\) 种处理组合中的一种随机分配给 \\(25\\) 张钢板中的每一张。在这种情况下，处理结构是 \\(5^3\\) 析因安排的一部分（因为它由添加剂 I × 添加剂 II × 温度的 \\(125\\) 种可能的处理组合中的 \\(25\\) 种组成），称为拉丁方安排 (Latin square arrangement) 或拉丁方处理结构 (Latin square treatment structure). 该设计结构是完全随机设计，因为处理组合完全随机地分配给钢板。由于这是部分析因，因此每个主效应与其他两个因素的两因素交互作用和三因素交互作用部分混叠 (partially aliased)（参见 Cochran and Cox, 1957, p. 245）。为了正确分析该实验设计，必须对模型中的参数做出一些假设。通常的假设是不存在双向交互作用，也不存在三向交互作用。然而，人们应该非常小心，如果没有一些先验信息（可以来自其他实验、现有文献等）表明交互作用实际上可以忽略不计，就不要做出这样的假设。表 4.12 给出了一种这样的拉丁方安排，完全随机设计结构中拉丁方处理结构的模型为 \\[\\begin{align} y_{ijk}&amp;=\\mu+\\mathrm{AI}_i+\\mathrm{AII}_j+T_k+\\varepsilon_{ijk},\\quad(i,j,k)\\in\\mathrm{Index} \\tag{4.11} \\end{align}\\] 其中 \\(\\mathrm{AI}_i\\) 表示的添加剂 I 第 \\(i\\) 个水平的效应，\\(\\mathrm{AII}_j\\) 表示添加剂 II 第 \\(j\\) 个水平的效应，\\(T_k\\) 表示温度第 \\(k\\) 个水平的效应，\\(\\mathrm{Index}\\) 表示由实验中观测到的 \\(25\\) 种处理组合组成的指数集。 表 4.12: 拉丁方安排处理结构，其中 \\(T_i\\) 表示温度第 \\(i\\) 个水平 x 如果忽略温度水平的应用，则得到的数据表是完全随机设计结构中双向处理结构的数据表，如表 4.13 所示。该双向处理结构的方差分析表见表 4.14. 该设计包括每个处理组合的一个观测结果，因此没有可用的自由度来估计误差，因为没有经过相同处理的钢板。AI 水平和 AII 水平之间的交互作用与 \\(16\\) 个自由度有关。现在，当温度包括在结构中时，由于检验温度均值相等而产生的平方和是 AI 与 AII 交互作用平方和的一部分，如表 4.15 所示。这意味着 AI 与 AII 交互作用的一部分与温度效应相同，或者说，与温度相关的四个自由度与此交互作用相关的四种自由度混叠 (aliased). 同样，与 AI 效应相关联的四个自由度与 AII 和温度交互作用的四个自由度混叠，与 AII 效应相关的四个自由度与 AI 和温度交互作用的四个自由度混叠。表 4.16 中给出了使用模型 (4.11) 的拉丁方处理结构的方差分析表。使用术语“残差” (residual) 而不是“误差” (error)，因为相应的平方和涉及误差加上可能不为零的任何交互作用效应。如果零交互作用的假设不正确，那么残差均方将过大，由此产生的 \\(F\\) 检验将过小。因此，如果实验中存在交互作用，就无法发现，并且任何其他可检测的处理效应都可能被掩盖。 表 4.13: 拉丁方安排中添加剂 I 水平和添加剂 II 水平的双向处理结构，忽略了温度水平 x 表 4.14: 拉丁方安排双向处理结构部分的方差分析表 x 表 4.15: 拉丁方安排双向处理结构部分的方差分析表，从两种添加剂的交互作用中划分出温度的变异 x 表 4.16: 拉丁方安排处理结构方差分析表 x 4.3.4 示例 4.4: 氮和钾的水平 模型和结果分析由三个基本组成部分组成：i) 处理结构，ii) 设计结构，以及 iii) 误差结构。此示例演示了如何使用三个基本组件来构建模型。一位植物育种家想要研究三种水平的氮 (N) 和四种水平的钾 (K) 的组合对其新玉米品种产量的影响。他的处理结构是双向析因安排，有 \\(12\\) 种处理组合（\\(3\\) 个水平的氮 × \\(4\\) 个水平的钾）。他有三块土地用于进行实验，他将这些土地作为区组。每个区组被分为 \\(12\\) 个部分，称为“区” (plots). 每种处理组合被随机分配到每个区组内的一个区。因此，设计结构是随机完全区组设计，因为每种处理组合在每个区组中出现一次。实验的总体设计称为随机完全区组设计结构中的双向处理结构（随机完全区组设计中的区组被一些作者称为重复 (replications)；然而，我们更喜欢将它们称为区组而不是重复，以便将它们与完全随机设计结构中的重复 (replications) 区分开来。示例 4.5 中的讨论描述了区组和重复之间的重要区别）。此示例的模型是 \\[\\begin{equation} y_{ijk}=\\mu_{ij}+b_{k}+\\boldsymbol{\\varepsilon}_{ijk}\\quad i=1,2,3,j=1,2,3,4,k=1,2,3 \\tag{4.12} \\end{equation}\\] 其中 \\(\\mu_{ij}\\) 是氮的第 \\(i\\) 个水平与钾的第 \\(j\\) 个水平的平均值，\\(b_k\\) 是第 \\(k\\) 个区组的效应，\\(\\varepsilon_{ijk}\\) 表示与每个区组内的区相关的随机误差。一般来说，通过将三种结构中的每一种结构的模型相加来构建一般模型 \\[\\begin{equation} Y= \\mathrm{treatment structure} + \\mathrm{design structure} + \\mathrm{error structure(s)} \\tag{4.13} \\end{equation}\\] 同样，相应的方差分析表也有三个部分。表 4.17 给出了模型 (4.13) 一般的方差分析表。表 4.18 给出了模型 (4.12) 的方差分析表。一般来说，必须考虑到可能存在一个以上的误差项。例如，裂区和重复测量模型有一个以上的误差项（见第 5 章）。 表 4.17: 一般模型的方差表分析 x 表 4.18: 随机完全区组设计结构中双向处理结构的方差分析表 x 4.3.5 示例 4.5: 区组和重复 在许多关于实验设计的教科书中，要么没有区分区组和重复，要么至少对这种区别存在混淆 (confusion)。包含这组示例是为了演示两个概念之间的差异，并说明处理结构与设计结构的组合可以产生实验的多个总体设计。假设研究人员想使用一个设计结构来研究单向处理结构中四种处理的效应，该设计结构有六个尺寸为二的区组（每个区组只有两个同质的实验单元）。在这种情况下，所需的设计结构是不完全区组设计。如果有足够的区组，使得每个处理对都可以在一个区组中同时进行相同次数，那么就可以使用均衡不完全区组设计结构 (Cochran and Cox, 1957). 例如，如表 4.19 所示，可以将四种处理方式分配给区组。在这种情况下，设计结构中有六个区组，每个处理重复三次。此示例用于指出区组和重复的概念是不同的，并强调区组和重复应始终保持分离。区组和重复仅在随机完全区组设计结构的情况下是等价的，其中每个处理在每个区组内观测一次且仅观测一次。不完全区组设计结构的随机化过程包括为区组编号分配区组，然后将分配给该区组的两个处理随机分配给该区组内的两个实验单元。对于表 4.19 中的示例，设计结构与六个区组相关联（见表 4.19 ），而不与由于分配过程恰好发生的三次重复相关联。表 4.19 安排的模型为 \\[\\begin{equation} y_{ij}=\\mu_i+b_j+\\boldsymbol{\\varepsilon}_{ij},\\quad\\mathrm{for~}(i,j)\\in\\mathrm{Index} \\tag{4.14} \\end{equation}\\] 其中 \\(\\mathrm{Index}=\\{(A, 1), (B, 1), (A, 2), (C, 2), (A, 3), (D, 3), (B, 4), (C, 4), (B, 5), (D, 5), (C, 6), (D, 6)\\}\\)，且对子 \\((i,j)\\) 只能取如索引集所示观测到的处理 × 区组组合的值。表 4.20 给出了模型 (4.14) 的方差分析表。与这种连通的18区组-处理 (connected block-treatment) 安排相关的自由度是如此计算的：与区组处理交互作用相关的自由度（就好像观测到了所有组合）减去空单元格的数量19。表 4.21 显示了观测到的区组-处理组合（用 “X” 表示）。有六个区组和四个处理，因此如果所有组合都存在，则区组处理交互作用将基于 \\((6-1)(4-1)=15\\) 个自由度。有 \\(12\\) 个单元格缺失，因此与误差项相关的自由度为 \\(15-12=3\\). 表 4.19: 将四种处理分配到两个实验单元的六个区组的第一种分配：提供均衡不完全区组设计结构 x 表 4.20: 表 4.19 中的均衡不完全区组设计结构的方差分析表 x 表 4.21: 区组与处理的双向结构，其中 \\(X\\) 表示观测到的组合，被填充和空缺的各有 \\(12\\) 个单元格 x 表 4.22 包含第二种分配模式，用于将四种处理分配给六个尺寸为二的区组。处理 \\(A\\) 出现在所有区组中并重复六次。处理 \\(B,C,D\\) 出现在两个区组中且每个区组提供两次重复。模型（4.14）可用于描述此数据，其中索引集为 \\[\\mathrm{Index}=\\{(A, 1), (B, 1), (A, 2), (C, 2), (A, 3), (D, 3), (A, 4), (B, 4), (A, 5), (C, 5), (A, 6), (D, 6)\\}\\] 表 4.22: 将四种处理分配给两个实验单元的六个区组，第二种分配：提供不均衡不完全区组设计结构 x 表 4.20 中的方差分析表也适用于表 4.22 中的安排。如果希望将所有四种处理相互比较，即检验 \\(\\mu_A = \\mu_B = \\mu_C = \\mu_D\\)，则表 4.19 中的安排是最优的（使用 D-最优准则；St. John and Draper, 1975）。如果希望将处理 \\(A\\) 与其他三种处理进行比较，即检验 \\(\\mu_A = \\mu_B,\\mu_A = \\mu_C,\\mu_A = \\mu_D\\)，则表 4.22 中的安排是最优的。 表 4.23 给出了将四种处理分配到六个区组的第三种方法。将处理分为两组，其中 \\(A\\) 和 \\(B\\) 一起出现在三个区组中，处理 \\(C\\) 和 \\(D\\) 一起出现在三个区组中。处理 \\(A\\) 不与处理 \\(C\\) 或 \\(D\\) 的同时出现在一个区组中。处理和区组之间的结构不连通 (not connected)，因为处理分为这两组。定义一个新的变量“组” (group) 来表示两组处理。两组之间的比较是区组 \\(1,3,5\\) 的平均值与区组 \\(2,4,6\\) 的平均值之间的比较，或者说是区组间比较 (between-block comparisons). 处理 \\(A\\) 与处理 \\(B\\) 之间的比较以及处理 \\(C\\) 与处理 \\(D\\) 之间的比较属于区组内比较 (within-block comparisons). 对于处理 \\(A\\) 和处理 \\(B\\)，处理与区组交互作用的自由度为二。同样，对于处理 \\(C\\) 和处理 \\(D\\)，处理与区组交互作用的自由度也为二。误差平方和是将这两个处理与区组交互作用的平方和（及其自由度）合并得到的。表 4.23 中的安排的方差分析表见表 4.24。区组的平方和分为组的平方和和组内嵌套的区组的平方和。各组的平方和作为误差以检验假设 \\(\\mu_A + \\mu_B = \\mu_C + \\mu_D\\)），该假设具有由处理产生的一个自由度。两组处理与区组混杂 (confounded) 在一起；也就是说，如果两组均值之间存在差异，则不知道是由于处理集之间的差异还是由于两组区组之间的差异造成的。混杂的概念与混叠 (aliasing) 的概念类似，但混叠涉及两个（或多个）项无法区分，其中两个项都来自处理结构，而混杂涉及两个项无法区分，其中一项来自处理结构，另一项来自设计结构。 表 4.23: 将四种处理分配给两个实验单元的六个区组的第三种分配：提供不连通不完全区组设计结构 x 表 4.24: 表 4.23 中的不完全区组设计方差分析表 x 表 4.19、4.22 和 4.23 中三种设计之间的差异在于如何将处理分配给区组。请记住，所有三种设计的设计结构和处理结构都是相同的，因此设计结构和处理结构并不描述实验的总体设计。还必须指定将处理结构中的处理随机分配到设计结构中的实验单元的方法。 4.3.6 示例 4.6：行区组和列区组 区组可以通过多种方式出现，拉丁方设计结构是一种同时存在行区组和列区组的设计。拉丁方设计结构有多种变化，其中行比处理或多或少（或者列比处理或多或少）（Cochran and Cox, 1957）。本示例由按行和列划分的实验单元组成，其中每行和列的交集包含多个实验单元。处理结构是双向的，因素 \\(A\\) 有两个水平，因素 \\(B\\) 有两个水平，从而产生四种处理组合。共有 \\(24\\) 个实验单元，排列成三列两行，每行列组合包含 \\(4\\) 个实验单元。将四种处理组合随机分配给每个行列组内的四个实验单元。表 4.25 显示了实验单元的处理组合（非随机）的分配。该设计结构本质上由六个尺寸为四的区组组成，但评估行区组之间和列区组之间的变异性可能很有趣，因此可以构建一个模型以包含这些因素： \\[\\begin{align} y_{ijkm}&amp;=\\mu+\\alpha_i+\\beta_j+(\\alpha\\beta)_{ij}+r_k+c_m+(rc)_{km}+\\varepsilon_{ijkm}\\\\ i&amp;=1,2,j=1,2,k=1,2,m=1,2,3 \\tag{4.15} \\end{align}\\] 其中 + i + j + (){ij} 表示因素 A 和 B 的主效应和交互作用，r_k 表示行区组效应，c_m 表示列区组效应，(rc){km} 表示行区组和列区组之间的交互作用，_{ijkm} 表示实验单元误差。模型 (4.15) 对应的方差分析表见表 4.26. 分析可能只涉及六个区组，并且可以合并由于行区组、列区组及其交互作用而产生的平方和，从而为设计结构提供五个自由度。通过设计结构与处理结构的交互作用来获得误差平方和；即通过合并 A × 行区组、A × 列区组、A × 行区组 × 列区组、B × 行区组、B × 列区组、B × 行区组 × 列区组、A × B × 行区组、A × B × 列区组，以及 A × B × 行区组 × 列区组的平方和。 表 4.25: 在设计结构中使用行区组和列区组，在处理结构中使用双向安排的设计（非随机形式） x 表 4.26: 双向处理结构的行-列设计结构方差分析表 x 通过结合各种设计结构和处理结构，还有许多其他方法可以构建设计实验。希望以上例子将使实验者能够构建所需的设计实验，构建适当的模型，并进行相应的分析。 4.4 结束语 本章介绍了实验者在设计和分析实验时可以使用的概念和方法。还介绍了设计良好的实验的基本概念。所有设计的实验都包括两个基本特征：处理结构和设计结构。这些概念通常不会在许多其他统计分析书籍中使用。了解设计实验的这两个特征之间的差异将有助于数据分析师为他们的实验选择适当的分析。在必须不与处理结构中的因素发生交互的情况下讨论了区组因素的选择。最后，必须能够识别何时有真正的重复，何时只有子样本。 4.5 练习 参考文献 Kempthorne, O. (1952). Design and Analysis of Experiments. John Wiley and Sons, New York, NY. Milliken, G. A. and Johnson, D. E. (2002). Analysis of Messy Data, Vol 3: Analysis of Covariance. Chapman and Hall/CRC, Boca Raton, FL. Cobb, G. W. (1997). Introduction to Design and Analysis of Experiments. Springer, New York, NY. Cochran, W. G., and Cox, G. M. 1957. Experimental Design. 2nd ed. John Wiley and Sons, New York, NY. Davies, O. L. 1954. Design and Analysis of Industrial Experiments. Oliver and Boyd, London, UK. Federer, W. T. (1995). Experimental Design. Macmillan, New York, NY. Hicks, Charles R. (1993). Fundamental Concepts in the Design of Experiments, 4th ed. W.B. Saunders Co., Philadelphia, PA. John, P. W. M. (1971). Statistical Design and Analysis of Experiments. John Wiley and Sons, New York, NY. Kirk, R. E. (1968). Experimental Design: Procedures for the Behavioral Sciences. Brooks/Cole, Belmont, CA. Cornell, J. A. (1990). Experiments with Mixtures: Designs, Models and Analysis of Mixture Data. John Wiley and Sons, New York, NY. Anderson, V. L. and McLean, R. A. (1974). Design of Experiments: A Realistic Approach. Marcel Dekker, New York, NY. Box, G. E. P., Hunter, W. G., and Hunter, J. S. (1978). Statistics for Experimenters. John Wiley and Sons, New York, NY. Laundsby, R. G. and Weese, D. L. (1993). Straight Talk on Designing Experiments: An Introductory Design of Experiments Reference Handbook. Launsby Consulting, Colorado Springs, CO. Lentner, M. and Bishop, T. (1986). Experimental Design and Analysis. Valley Book Company, Blacksburg, VA. Meed, R. (1988). The Design of Experiments: Statistical Principles for Practical Application. Cambridge University Press, Cambridge, UK. Montgomery, D. C. (1991). Design and Analysis of Experiments, 3rd edn. John Wiley and Sons, New York, NY. Winer, B. J. (1971). Statistical Principles in Experimental Design, 2nd ed. McGraw-Hill, New York, NY. St John, R. C. and Draper, N. R. (1975). D-Optimality for regression designs: A review. Technometrics, 17, 15. 也可译作 “排”，即图 4.1 中的竖线。↩︎ 这里的 \\(\\mu\\) 还不足以称为“总体平均值”，严谨地说是“截距”，如果对模型其他参数施加约束才可称为“总体平均值”。更多的讨论详见 Stroup (2012)，例如前言的 xxi 页以及 P.54 的 Note.↩︎ 见 6.3.2 节。↩︎ 原文：The degrees of freedom associated with this connected block–treatment arrangement are computed from the degrees of freedom associated with the block by treatment interaction as if all combinations were observed minus the number of empty cells.↩︎ "],["chap5.html", "第 5 章 多水平设计：裂区、裂条区、重复测量及其组合 5.1 识别实验单元的尺寸——四种基本设计结构 5.2 分层设计：一种多水平的设计结构 5.3 裂区设计结构：两水平设计结构 5.4 裂条区设计结构：一种无层次的多水平设计 5.5 重复测量设计 5.6 涉及嵌套因素的设计 5.7 结束语 5.8 练习", " 第 5 章 多水平设计：裂区、裂条区、重复测量及其组合 统计学家在咨询工作中并不总是有机会设计他们必须帮助构建适当分析的实验。相反，统计学家首先需要确定研究人员所采用的设计实验的类型。识别过程中的第一步也是最重要的一步是确定是否使用了不止一种尺寸 (size) 的实验单元，如果使用了，则需要识别每种尺寸的实验单元。正如在本节中显而易见的那样，每种尺寸的实验单元都将具有相关的设计结构和处理结构。在识别出不同尺寸的实验单元后，可以通过组合用于描述与每个尺寸的实验单元对应的设计结构和处理结构的模型，从而构建用于进行适当分析的模型。 5.1 识别实验单元的尺寸——四种基本设计结构 涉及一种以上尺寸的实验单元的设计结构被称为多水平设计结构 (multilevel designs structures)，并且包括裂区 (split-plot) 类型的设计结构、裂条区 (strip-plot) 设计结构、重复测量 (repeated measures) 设计结构、分层 (hierarchical) 或嵌套 (nested) 类型的设计结构以及涉及上述各种组合的设计结构。重复测量和裂区类型的设计结构是相似的，尽管用于进行分析的假设可能不同。裂区和裂条区设计结构是从农业科学发展而来的，但在包括工程和制造业在内的许多其他学科中都有使用，第 ?? 章和第 ?? 章讨论了它们的分析。重复测量设计在社会科学和生物科学中广泛使用，但在大多数领域都适用，因为随着时间的推移，评估处理效应是有意义的，其分析见第 ?? - ?? 章。嵌套处理结构不同于重复测量和裂区设计使用的处理结构，嵌套处理结构在第 ?? 章中进行了描述。 有四种基本的设计结构，而最复杂的设计结构是这些结构的组合。四种基本设计结构是完全随机设计结构 (completely randomized design structure)、随机完全区组设计结构 (randomized complete block design structure)、裂区设计结构 (split-plot design structure) 和裂条区设计结构 (strip-plot design structure). 这些基本设计结构中的每一个都有自己的分析，计算所需误差平方和的过程也是独特的。本节介绍了基本设计结构以及计算误差平方和所需的过程。讨论中使用了一个例子，其中处理结构是双向的，一个因素有两个水平，另一个因素有三个水平，设计结构涉及 18 个实验单元。 该实验包括评估纸杯蛋糕 (cupcake) 烘焙后的体积，其中有三种配方和两种烹饪温度；因此，处理结构由三种配方和两种烹饪温度的六种组合组成。希望每种处理组合重复 3 次；因此需要烘焙 18 个纸杯蛋糕。图 5.1 中的图用于演示使用完全随机设计结构的过程。该过程是将处理结构中的六种处理组合完全随机分配给设计结构中的 18 个实验单元（纸杯蛋糕）。箭头表示每个处理组合分配给三个纸杯蛋糕。通常，该过程是一次制作一个纸杯蛋糕，因此纸杯蛋糕混合和烘焙的顺序与实验单元相对应。完全随机设计结构是通过混合一批给定的配方，填充一个纸杯蛋糕形状，然后在设置为特定温度的烤箱 (oven) 中烘焙纸杯蛋糕来完成的。每个纸杯蛋糕都必须用单独一批材料制作，也就是说，每个批次的蛋糕配方只能制作一个纸杯蛋糕，并且每个纸杯蛋糕都必须在设置为特定温度的烤箱中单独烘烤。该过程需要使用 18 批蛋糕混合物和 18 次使用一个或多个烤箱来烘焙纸杯蛋糕。与完全随机设计结构相关的误差是根据相同处理的纸杯蛋糕之间的变异性计算的。根据温度组合，每个配方中有三个纸杯蛋糕，因此三个纸杯蛋糕体积的变异提供了两个测量纸杯蛋糕误差的自由度。人们应该检验六种处理组合方差的相等性（见第 2 章），如果可能的话，将六种处理组的误差估计值合并在一起，以提供 \\(12\\) 个误差自由度，用于测量相同处理的纸杯蛋糕之间的变异性。可用于描述纸杯蛋糕体积的模型为 \\[y_{ijk}=\\mu+\\tau_{i}+\\beta_{j}+(\\tau\\beta)_{ij}+\\varepsilon_{ijk},\\quad i=1,2,j=1,2,3,\\mathrm{and}\\,k=1,2,3\\] 其中 \\(y_{ijk}\\) 表示用第 \\(j\\) 个配方制作并在第 \\(i\\) 个温度下烘焙的第 \\(k\\) 个纸杯蛋糕的体积，\\(\\mu\\) 表示总平均值，\\(\\tau_i\\) 表示第 \\(i\\) 个温度的效应，\\(\\beta_j\\) 表示第 \\(j\\) 个配方的效应，\\((\\tau\\beta)_{ij}\\) 是温度与配方交互作用，以及 \\(\\varepsilon_{ijk}\\) 表示与批次、批次内的纸杯蛋糕以及不同烤箱烘焙的差异相关的变异性。表 5.1 包含了完全随机设计结构中双向处理结构模型的方差分析表，其中根据实验单元或相同处理的纸杯蛋糕的变异性计算了 12 个自由度。与处理结构相关的自由度为 5，与设计结构相关的自由度为 12 个，所有自由度均分配给误差项。表 5.1 中标有 \\(EMS\\) 的列给出了方差分析表各行的预期均方形式。函数 \\(\\phi^2(\\tau),\\phi^2(\\beta),\\phi^2(\\tau\\beta)\\) 分别表示温度主效应均值、配方主效应均值和交互作用效应的二次函数。当相应的效应不存在时，这些函数是非负的且等于零。在本章的其余部分中可以使用类似的解释。 图 5.1: 完全随机设计结构中双向处理结构的随机化 表 5.1: 完全随机设计结构中双向处理结构的方差分析表 x 第二种基本设计结构是随机完全区组设计，图 5.2 中的图表显示了将处理从处理结构分配到设计结构中的实验单元的过程。假设研究人员每天可以制作和烘焙六个纸杯蛋糕，那么实验必须持续三天，才能实现每种处理组合的三次重复。设计结构的实验单元分为三个尺寸为六的区组。接下来，处理结构中的六个处理被随机分配到每个块内的六个实验单元，如图 5.2 中的箭头所示。正如第 4 章所讨论的，随机完全区组设计结构的误差平方和是通过设计结构与处理结构交互作用来计算的，或通过处理与区组的交互作用来计算的。该设计涉及六种处理和三个区组，因此处理与区组交互作用提供了 (3 - 1)(6 - 1) = 10 个与实验误差相关的自由度。这 10 个自由度合并了区组与温度、区组与配方和区组与温度与配方的交互作用相关的自由度。可用于描述随机完全区组设计结构中这种双向处理结构的纸杯蛋糕体积的模型是 \\[y_{ijk}=\\mu+\\tau_i+\\beta_j+(\\tau\\beta)_{ij}+d_k+\\varepsilon_{ijk},\\quad i=1,2,~j=1,2,3,~\\mathrm{and~}~k=1,2,3\\] 其中 \\(d_k\\) 表示第 \\(k\\) 天的效应，即区组因素，\\(\\varepsilon_{ijk}\\) 表示与批次、批次内纸杯蛋糕相关的变异性，以及同一天内不同烤箱烘焙的变异性。表 5.2 包含随机完全区组设计结构中双向处理结构模型的方差分析表，其中有 10 个自由度是根据区组与处理组合的交互作用测量的相同处理的实验单元的变异性计算得出的。该分析具有与完全随机设计结构相同的与处理结构相关的 5 个自由度，但现在，设计结构的 12 个自由度分布在天（区组）和误差之间。表 5.2 中的 \\(\\sigma^2_{day}\\) 项表示 \\(d_k\\) 的方差，\\(k = 1, 2, 3\\). 在本章的其余部分中可以做出类似的解释。 图 5.2: 随机完全区组设计结构中双向处理结构的随机化方案 表 5.2: 随机完全区组设计结构中双向处理结构的方差分析表 x 第三种基本设计结构是裂区设计结构。这里 18 个纸杯蛋糕被分成六个尺寸为三的区组，如图 5.3 所示。由于处理结构中有六种处理组合，所有六种处理不能发生在一个区组内，因此这是一个不完全区组设计结构。三个纸杯蛋糕，每个配方各一个，将在同一烤箱中在指定温度下烘焙（前两个基本设计结构仅在一个烤箱中烘焙一个纸杯蛋糕）。图 5.3 中的图表显示处理结构分为两部分，一部分指定为纸杯蛋糕部分，另一部分指定为烤箱部分。分配给每个烤箱的尺寸为三的区组或三个纸杯蛋糕构成温度水平的实验单元。随机化程序的第一部分是将每个温度随机分配给三个烤箱或区组，如图 5.3 中从温度水平到烤箱的箭头所示。烤箱内的纸杯蛋糕是配方水平的实验单元，随机化程序是将配方水平随机分配给每个烤箱内的一个纸杯蛋糕。实验单元有两种尺寸，有两种设计和处理结构。烤箱实验单元的处理和设计结构由单向处理结构（两个温度水平）和完全随机设计结构（六个烤箱）组成。对于单个纸杯蛋糕，处理和设计结构由随机完全区组设计结构中的单向处理结构（配方的三个水平）组成，其中烤箱代表类似实验单元的区组。因此烤箱是温度的实验单元。 图 5.3: 采用完全随机整区设计结构的裂区随机化方案 这种设计结构是嵌套或分层结构，因为纸杯蛋糕嵌套在烤箱内。因此，裂区设计也是一种分层设计结构。由于实验单元有两种尺寸，因此称为多水平设计。烤箱是较大尺寸的实验单元，通常被称为整区 (whole-plot) 。纸杯蛋糕是较小尺寸的实验单元，通常称为子区 (subplot) 或裂区。 分析这种裂区设计的第一步是忽略单个纸杯蛋糕或配方，只考虑两个温度和六个烤箱。图 5.4 的显示表明，与实验单元烤箱尺寸对应的设计是完全随机设计结构中的单向处理结构。描述在每个烤箱上测量的响应的模型是 \\[y_{ik}^*=\\mu+\\tau_i+e_{ik},\\quad i=1,2,\\mathrm{~and~}k=1,2,3\\] 其中 \\(y_{ik}^*\\) 表示在分配给第 \\(i\\) 个温度的第 \\(k\\) 个烤箱上测量的响应，\\(\\varepsilon_{ik}\\) 表示与烤箱相关的误差项。表 5.3 包含烤箱模型的方差分析表。对于每种温度水平，都有三个相同处理的烤箱，因此每个温度都有两个自由度，可以测量烤箱在相同处理时的变异。如果烤箱在两个温度之间的方差相等，则可以将这两个方差合并，以提供具有四个自由度的烤箱的误差项。 图 5.4: 用于裂区设计的烤箱设计和处理结构 表 5.3: 以烤箱为实验单元忽略配方水平的完全随机设计结构中单向处理结构的方差分析表 x 分析的下一步是忽略温度水平，从而提供一种设计，该设计是随机完全区组设计结构（六个区组）中的单向处理结构（三个配方）。随机化过程如图 5.5 所示。可以用来描述纸杯蛋糕体积的模型是 \\[y_{ijk}=\\mu+\\beta_j+o_{ik}+\\varepsilon_{ijk}^*,\\quad i=1,2,\\quad j=1,2,3,\\mathrm{~and~}\\quad k=1,2,3\\] 其中 \\(o_{ik}\\) 表示区组效应或烤箱效应，\\(\\varepsilon_{ijk}^*\\) 表示与纸杯蛋糕相关的误差。方差分析表在表 5.4 中，其中残差平方和由配方与烤箱交互作用组成。如果所有烤箱都进行同样的处理，则残差平方和将提供纸杯蛋糕与纸杯蛋糕之间变异性的估计。然而，一些烤箱经受一种温度而另一些烤箱经受另一种温度；因此，配方与烤箱交互作用包括温度与配方交互作用。表 5.4 中的预期均方并不完全由该模型确定，这由表中的“?”表示。为了获得纸杯蛋糕之间的变异性，需要在设计上进行一次额外的缩简 (reduction). 只考虑那些温度为 1 的烤箱，如图 5.6 中的黑线所示。缩简设计是指随机完全区组设计结构中的单向处理结构，其中三个区组中的处理相同（温度 1），方差分析表如表 5.5 所示。配方与烤箱交互作用提供了烤箱中经相同处理的纸杯蛋糕变异的测量。该过程继续考虑第二温度下的其他三个烤箱，其中配方与烤箱交互作用提供了额外的四个自由度，用于测量纸杯蛋糕在烤箱内经相同处理时的变异。当两个温度下蛋糕的方差相等时（参见第 2 章的检验），可以将两个来源合并在一起，提供八个自由度的误差平方和以测量蛋糕的变异情况。纸杯蛋糕的误差平方和是通过计算每个温度下烤箱与配方的交互作用，并将这些交互作用在不同温度下进行合并来计算的 (computing the oven by recipe interaction within a temperature pooled across temperatures). 表 5.6 给出了最终完整的裂区方差分析表，其中配方与温度交互作用从纸杯蛋糕残差中分离出来。描述在裂区设计结构中具有完全随机设计整区设计结构的双向处理结构数据的模型是 \\[y_{ijk}=\\mu+\\tau_i+\\beta_j+(\\tau\\beta)_{ij}+o_{ik}+\\varepsilon_{ijk},\\quad i=1,2,~j=1,2,3,\\mathrm{~and~}~k=1,2,3\\] 其中 \\(o_{ik}\\) 表示温度范围内的烤箱变异，\\(\\varepsilon_{ijk}\\) 表示烤箱内纸杯蛋糕的变异。表 5.6 中仍有 5 个与处理结构相关的自由度，但与设计结构相关的 12 个自由度分布在两个误差项之间，其中有 4 个与烤箱误差分量相关的自由度和 8 个与纸杯蛋糕误差分量相关的自由度。 图 5.5: 纸杯蛋糕实验单元的随机完全区组设计结构 表 5.4: 忽略温度水平的随机完全区组设计结构中单向处理结构的方差分析表 x 图 5.6: 仅为温度1烤箱运行的部分设计结构 表 5.5: 随机完全区组设计结构中单向处理结构温度1数据的方差分析表 x 表 5.6: 完全随机整区设计结构裂区设计中双向处理结构的方差分析表 x 作为裂区设计结构的变体，假设研究人员一天内只能运行两次烤箱；因此，这些烤箱被分为三组，每组两个，研究需要三天时间才能完成。图 5.7 中的图表描述了每天向烤箱随机分配温度水平，然后随机分配每个烤箱内的配方水平。烤箱设计结构是随机完全区组设计，因此烤箱误差项通过天与温度交互作用来计算。在烤箱或整区上施加区组结构不会改变纸杯蛋糕或子区的设计结构。仍有六个尺寸为三的区组，所以分析中的纸杯蛋糕部分没有改变。描述在裂区设计结构中具有完全随机区组整区设计结构的双向处理结构纸杯蛋糕体积的模型为 \\[y_{iik}=\\mu+\\tau_i+\\beta_j+(\\tau\\beta)_{ij}+d_k+o_{ik}+\\varepsilon_{iik},\\quad i=1,2,~j=1,2,3,~\\mathrm{and~}~k=1,2,3\\] 其中 \\(d_k\\) 表示天的效应，\\(o_{ik}\\) 表示一天内的烤箱变异，\\(\\varepsilon_{ijk}\\) 表示一天内烤箱内纸杯蛋糕的变异。表 5.7 给出了与上述模型相对应的方差分析表，其中包括天、error (oven) 和 error (cupcake) 的行。 图 5.7: 具有随机完全区组全区（烤箱）设计结构的裂区设计结构图 表 5.7: 随机完全区组整区设计结构裂区设计中双向处理结构的方差分析表 x 如上所述，裂区设计结构是不完全区组设计。图 5.8 显示了每天内将处理组合分配给烤箱或区组的情况。每个区组内只能出现三种处理组合，并且事实上，在一个区组内只能出现具有相同温度水平的那些处理组合。最终的设计是部分均衡不完全区组 (partially balanced incomplete block)，其中一些处理组合总是在一个区组内一起出现，而一些处理组合永远不会在一个区组内一起出现。 图 5.8: 裂区设计结构表示为不完全区组设计结构 第四种基本设计结构是裂条区。 裂条区设计结构的构建方法是首先将实验单元排列成具有行和列的矩形，如图 5.9 所示。在此实验中，使用其中一种配方混合一批蛋糕面团，并从该批次中提取两个纸杯蛋糕。由于这批面团是由一个配方制成的，因此批次是配方水平的实验单元。其中一个纸杯蛋糕将在温度 1 下烘焙，另一个纸杯蛋糕将在温度 2 下烘焙。因此，每个烤箱将包含三个纸杯蛋糕，每个配方各有一个。烤箱是分配温度水平的实体，并且是温度水平的实验单元。 图 5.9: 纸杯蛋糕实验裂条区设计结构图 图 5.9 中矩形的列对应于蛋糕面团的批次，三种配方被随机分配到列中；也就是说，一列中的两个纸杯蛋糕都来自同一批次，该批次是配方水平的实验单元。行由三个纸杯蛋糕组成，与烤箱相对应，烤箱是温度水平的实验单元。该设计的分析可以通过考虑每种尺寸的实验单元的设计和处理结构来构建。首先，忽略配方，只考虑矩形的行，那么烤箱设计是随机完全区组设计结构中的单向处理结构。如表 5.8 所示，与烤箱对应的误差项通过矩形（或天）与温度交互作用来计算，这为 error (oven) 提供了两个自由度。接下来，忽略温度，只考虑矩形的列，那么批次设计是随机完全区组设计结构中的单向处理结构。如表 5.9 所示，与批次对应的误差项通过矩形（或天）与配方交互作用来计算，为 error (batch) 提供了四个自由度。最后，配方与温度交互作用是通过排除行效应和列效应的对比来计算的 (contrasts that are free of the row effects and free of the column effects)，使纸杯蛋糕成为交互作用比较的实验单元。配方、温度和矩形之间的交互作用提供了纸杯蛋糕误差项，在这种情况下，它有四个自由度。该设计涉及三种尺寸的实验单元，可用于描述该结构数据的模型是 \\[y_{ijk}=\\mu+\\tau_i+\\beta_j+(\\tau\\beta)_{ij}+d_k+o_{ik}+b_{jk}+\\varepsilon_{ijk},\\quad i=1,2,\\quad j=1,2,3,\\mathrm{~and~}\\quad k=1,2,3\\] 其中 \\(d_k\\) 表示矩形或天的效应，\\(o_{ik}\\) 表示矩形内的烤箱效应，\\(b_{jk}\\) 表示矩形内的批次效应，\\(\\varepsilon_{ijk}\\) 表示批次、烤箱和矩形内的纸杯蛋糕效应。裂条区模型对应的方差分析表如表 5.10 所示，其中包含了三个误差项。处理结构仍然与五个自由度相关联，而与设计结构相关的12个自由度则分配为：两个用于矩形、两个用于 error (oven)、四个用于 error (batch) 以及四个用于 error (cupcake). 裂条区设计结构是一种多水平设计，但它不是分层设计结构，因为行不嵌套在列内，列也不嵌套在行内。行和列是嵌套在矩形（或天）内的，但嵌套结构在这里就停止了。 表 5.8: 裂条区设计结构中处理结构温度部分的方差分析表 x 表 5.9: 裂条区设计结构中处理结构配方部分的方差分析表 x 表 5.10: 裂条区设计结构双向处理结构方差分析表 x 正如第 ?? 章所讨论的，与效应相对应的预期均方将指示在评估与该效应相关的假设时使用哪个误差项。一些预期均方涉及带“*”上标的方差，以表明除下标所示之外，还有其他因素影响变异性。 在向方差分析表中写入误差项的过程中，只要设计涉及一个以上尺寸的实验单元，将与误差相关的实验单元的尺寸包括在括号中，这是本书其余部分中使用的惯例。这一惯例使研究人员能够轻松地识别研究的变异来源。 更复杂的设计结构在材料和时间方面往往更加节约。对于纸杯蛋糕烘焙实验，完全随机和随机完全区组设计结构需要制作 18 批纸杯蛋糕面团，并且需要使用 18 次烤箱进行 18 次烘焙。裂区设计结构涉及 18 批蛋糕面团（每个纸杯蛋糕一批），但只需要烘焙六次。因此，与完全随机设计相比，裂区设计只使用了三分之一的时间来烘焙纸杯蛋糕。裂条区需要九批蛋糕面团和六次烘焙。裂条区设计结构只使用了一半的蛋糕面团批次和三分之一的烘焙时间。如上所述，只要能够解决必要的误差项，使用更复杂的设计结构通常可以节省时间和资源，并且是进行实验的更方便的方式。 随着在设计上施加更多的结构，与最小实验单元尺寸对应的误差自由度会减少。然而，在前面的例子中，与完全随机设计相关的误差包括烤箱、批次和纸杯蛋糕引起的变异。裂区设计有两个误差项，其中一部分误差是由于烤箱之间的变异性，另一部分是由于纸杯蛋糕之间的变异性（也包括批次间的变异性）。裂条区设计有三个误差项，其中研究中的变异性分为烤箱间的变异性、批次间的变异性和批次内纸杯蛋糕间的变异性。使用更复杂的设计结构为纸杯蛋糕误差项提供了更少的自由度，但该误差项在裂条区设计结构中被细化为纸杯蛋糕与纸杯蛋糕之间的变异性，其中涉及在完全随机和随机完全区组设计中的烤箱和批次的变异性，以及裂区设计中的批次的变异性。因此，尽管自由度较少，但并不一定意味着处理因素之间比较的功效较小，因为重要方差分量的幅度也可能减小，从而增大功效。与更简单的设计结构的误差项相比，更复杂的设计具有更少变异性来源的误差项。表 5.11 总结了与纸杯蛋糕设计的每个误差项相关的变异性来源。 表 5.11: 与纸杯蛋糕示例相关的各种设计的每个误差项的变异性来源 x 以下各节提供了几个多水平设计的示例，每个多水平设计可以表示为上述四种基本设计结构中的一种或几种的组合。能够识别对应于四种基本设计结构之一的设计部分，为确定研究中每个实验单元尺寸的误差来源提供了一种方法。能够描述模型中的所有误差项是很重要的，因为在使用软件进行适当的分析时需要这些描述。当在模型的残差或最小实验单元水平上存在重复测量或不等方差时，需要残差平方和的表达式，以便软件对适当的方差和协变量进行建模。重复测量实验的建模将需要知道如何计算残差平方和。大多数作者通过减法计算残差平方和，但当需要对残差方差和协方差建模时，减法方法是不够的。 多水平设计有两个重要特点。首先，处理结构至少由一组双向处理组合组成。将多水平设计与第 4 章中的设计区分开来的第二个特征是，在一个实验中使用了多个尺寸的实验单元。在设计结构中，每个水平都有一种尺寸的实验单元。每种尺寸的实验单元都有自己的设计结构和处理结构，并且可以通过组合每种尺寸实验单元的模型来构建模型。由于存在不止一种尺寸的实验单元，因此在分析中使用了多个误差项；也就是说，实验中每种尺寸的实验单元都有一个误差项，这也反映在模型中。 本章提供了几个例子来演示使用第 5.2 节中讨论的四个基本设计结构所需的原则，以正确识别研究中使用的设计实验。一旦实验者能够使用这些原则来识别本章中讨论的设计实验，她就能够使用它们来识别其他设计的特征。 多水平设计可以用许多不同的方式进行结构化。接下来的一系列例子用于演示识别不同尺寸实验单元的过程，然后将这些信息用于构建一个适当的模型，作为分析的基础。每个例子都包括一个方差分析表，其中列出了变异来源、自由度和预期均方（关于计算预期均方的讨论，请参见第 ??。设计结构与四个基本设计结构相关，从而可以确定误差项的形式。在对数据进行计算机分析之前，列出适当的变异来源和相应的自由度进行分析是很重要的，因为这可以很好地检查是否使用了适当的模型指定来描述数据。 5.2 分层设计：一种多水平的设计结构 社会科学中经常使用分层设计，其中个体的组形成较大尺寸的实验单元，而组内的个体是较小尺寸的实验单元。例如，一项评估五年级学生数学教学方法的研究涉及从学校系统中选择五年级学生的六个班级，并随机将两种方法中的每一种分配给其中三个班级。班级是教学方法的实验单元。确定教学方法是否对男女学生产生不同的影响是很有意义的。学生是学生性别的实验单元。个体嵌套于班级中的学生性别中，班级又嵌套于教学方法中。这项研究涉及嵌套设计结构和双向处理结构，其中有两种教学方法和两种性别的学生。可以使用以下模型来描述学生在接受其中一种教学方法后在数学测试中的得分 \\[y_{ijkm}=\\mu+\\tau_i+c_{ij}+\\beta_k+(\\tau\\beta)_{jk}+\\varepsilon_{ijkm},\\quad i=1,2,j=1,2,3,k=1,2,m=1,2,\\ldots,n_{ijk}\\] 其中 \\(y_{ijkm}\\) 为第 \\(i\\) 个方法授课的第 \\(j\\) 个班级第 \\(k\\) 个性别的第 \\(m\\) 个学生的成绩，\\(\\mu\\) 表示平均分，\\(\\tau_i\\) 表示教学方法效应，\\(c_{ij}\\) 表示第 \\(i\\) 个方法授课的第 \\(j\\) 个班级的效应， \\(\\beta_k\\) 表示第 \\(k\\) 个性别效应，\\((\\tau\\beta)_{jk}\\) 表示教学方法与性别交互作用，\\(\\varepsilon_{ijkm}\\) 表示采用某种教学方法的班级内某个性别的学生效应。上述模型的方差分析表如表 5.12 所示，其中班级和学生被假定为随机效应（见第 ?? 章）。系数 \\(k_1\\) 和 \\(k_2\\) 取决于每个班级内每个性别的学生人数（有关预期均方的评估，请参阅第 ?? 章）。该模型有两个误差项，一项针对班级，一项针对学生，这与裂区设计结构中的结构类似。因此，分层设计与裂区基本设计结构相同。 表 5.12: 分层或裂区设计结构的教学方法研究方差分析表 x 5.3 裂区设计结构：两水平设计结构 裂区设计主要用于农业、工业和生物研究，但也可以有效地用于大多数其他研究领域。裂区设计结构是具有两个或多个水平的多水平设计。裂区设计涉及两种或多种处理结构，具有不完全区组设计结构和至少两种不同尺寸的实验单元。裂区设计与重复测量设计的区别在于，处理结构中每个因素的水平可以随机应用于各种尺寸的实验单元。相反，重复测量设计涉及这样一个步骤：处理结构中至少一个因素（通常是时间）的水平不能随机分配给各个实验单元。以下示例演示了裂区设计的用途，并为识别适当的设计提供指南。 5.3.1 示例 5.1：烹饪大豆——最简单的裂区或两水平设计结构 一位实验者想要研究五种大豆对三种烹饪方法的响应。感兴趣的因变量是大豆煮熟后的嫩度和风味。实验者有一个由 15 个同质行 (rows) 组成的区域。他将五种单向处理结构中的每一种随机分配到三行，从而在完全随机设计结构中生成单向处理结构。品种被分配到行中，如图 5.10 所示；因此，行是与品种相关的实验单元。在收获时节，每行的大豆都会被放入一个盒子 (box) 中。对一行大豆（或一个盒子）进行的某些测量，行实验单元的模型是 \\[y_{ij}=\\mu_i+r_{ij},\\quad i=1,2,3,4,5,\\quad j=1,2,3\\] 其中 \\(\\mu_i\\) 表示第 \\(i\\) 个品种的平均值，\\(r_{ij}\\) 表示与分配给第 \\(j\\) 行的第 \\(i\\) 个品种相关的误差。表 5.13 给出了用于比较品种平均响应的行模型的分析或方差表。每个品种分配了三行，因此，品种内相同处理的行之间的变异性为 error (row) 提供了两个自由度。如果五个品种内的行方差相等，则将方差合并在一起以提供与 error (row) 相关的 10 个自由度。行设计是完全随机设计结构。 图 5.10: 用于将品种分配到烹饪豆实验的行的随机化方案 表 5.13: 行分析的方差分析表，以比较烹饪大豆例子中的品种 x 接下来，实验者想要检查烹饪方法。有几种可能的方法来进行这部分实验，这里讨论了两种。首先，实验者可以为种植了给定品种的三行中的每一行分配不同的烹饪方法，如图 5.11 所示。图 5.11 中的安排产生了一个完全随机设计结构中的双向处理结构，其中行是实验单元。然而，每个品种与烹饪方法的组合只有一次重复或行。因此，没有相同处理的行，这意味着并没有实验误差或行方差的度量。方差分析表的结果如表 5.14 所示。 图 5.11: 将烹饪方法分配到每个品种内的行的随机化方案，以烹饪大豆为例 表 5.14: 行分析的方差分析表，以烹饪大豆为例 x 具有零误差自由度的设计不是很理想 [尽管一些分析可以使用 Milliken &amp; Johnson, 1989; Millikan &amp; Graybill,1970; Johnson &amp; Grayboll, 1972 中讨论的双向非重复实验技术 (two-way non-replicated experiment techniques) 进行]。另一种分配烹饪方法的方式避免了零自由度问题，但确实使实验设计和分析更加复杂。 另一种方法是将每盒大豆（每行一盒）分成三批，然后将每种烹饪方法随机分配给一行中三批中的一批。由于烹饪方法被分配给一个批次 (batch)，因此烹饪方法的实验单元是一个批次。因此，该实验有两种尺寸的实验单元；行（大尺寸）是品种的实验单元，批（小尺寸）是烹饪处理的实验单元。这种分配如图 5.12 所示。 图 5.12: 将烹饪方法分配给批次的随机化过程的图表（仅显示第1行和第15行的线） 批次实验单元的处理和设计结构是随机完全区组设计结构中的单向处理结构，其中行（或盒子）是区组。表 5.15 给出了此设计批次部分的方差分析表。 表 5.15: 用于烹饪大豆示例的批次分析（忽略品种）的方差分析表 x 行的平方和包括品种的平方和加上表 5.13 中 error (row) 的平方和。如果所有行都经相同处理，则烹饪方法与行的交互作用将提供批次误差项，但一些行种植了品种 1，另一些行种植了品种 2，依此类推。因此，烹饪方法与行的交互作用包括了烹饪方法与品种的交互作用。所以，只考虑种植了品种 1 的那些行。品种 1 中的烹饪方法与行的交互作用提供了 (3-1)*(3-1)=4 个自由度，用于测量在同一行中经相同处理的批次的变异。批次误差平方和是通过在五个品种中合并烹饪方法与品种交互作用平方和而获得的 (obtained by pooling the row by cooking method interaction sum of squares within a variety across the five varieties)，从而为 error (batch) 提供 20 个自由度。描述烹饪大豆示例数据的模型如下 \\[y_{ijk}=\\mu_{ik}+r_{ij}+\\varepsilon_{ijk},\\quad i=1,2,3,4,5,j=1,2,3,k=1,2,3\\] 其中，\\(\\mu_{ik}\\) 表示通过第 \\(k\\) 种方法烹饪的第 \\(i\\) 个品种的平均值，\\(r_{ij}\\) 是分配给第 \\(i\\) 个品种的第 \\(j\\) 行的随机效应，假设其分布为 \\(N(0,\\sigma^2_{\\mathrm{row}})\\)， \\(\\varepsilon_{ijk}\\) 表示用第 \\(k\\) 种方法烹饪的第 \\(i\\) 个品种的第 \\(j\\) 行的批次的随机效应，假设其分布为 \\(N(0,\\sigma^2_{\\mathrm{batch}})\\)，还假设 \\(r_{ij}\\) 和 \\(\\varepsilon_{ijk}\\) 是独立的随机变量。 在效应模型中，均值 \\(\\mu_{ik}\\) 可表示为 \\[\\mu_{ik}=\\mu+\\upsilon_i+\\omega_k+(\\upsilon\\omega)_{ik}\\] 其中 \\(\\mu\\) 表示总体平均值，\\(\\upsilon_i\\) 表示第 \\(i\\) 个品种的效应，\\(\\omega_k\\) 表示第 \\(k\\) 种烹饪方法的效应，\\((\\upsilon\\omega)_{ik}\\) 表示品种与烹饪方法的交互作用。 \\[\\begin{aligned}y_{ijk}=&amp;\\mu+\\upsilon_i+r_{ij}\\,&amp;&amp;\\text{\\}row part of model}\\\\&amp;+\\omega_k+(\\upsilon\\omega)_{ik}+\\varepsilon_{ijk}\\,&amp;&amp;\\text{\\}batch part of model}\\end{aligned}\\] 其中模型的行部分也是模型的批次部分的区组结构。裂区设计可以分两步进行分析，先进行行分析，然后进行批次分析。当数据集均衡时，在将单个模型拟合到数据或进行两步分析过程的情况下，将获得相同的结果。表 5.16 给出了烹饪大豆例子的方差分析表，它划分了每个实验单元尺寸、行尺寸和批次尺寸的分析。行分析也是分析的批次部分的区组结构，如箭头所示。 表 5.16: 烹饪大豆实验的方差分析表，显示了每个实验单元尺寸的分析 x 大豆实验的整区或行设计结构是完全随机设计结构；因此，这被称为最简单的裂区或两水平设计结构。通常的整区设计结构通常涉及随机完全区组设计结构，如下例所示。 5.3.2 示例 5.2：磨小麦——通常的裂区或两水平设计结构 谷物碾磨实验包括在将小麦粒碾磨或研磨成小麦粉后评估各种小麦品种 (variety) 的特性。实验包括将研磨辊之间的间隙[称为辊缝 (roll gap)]设置为一个值，然后研磨每种品种的一批（按随机顺序）。接下来，将辊缝更改为另一个值，并研磨新的批次。假设研究人员希望评估三个辊缝和五个品种。因此，五个品种的三个辊缝的双向处理结构的一次重复需要 15 次轧机的运行 (runs)。一个工作日 (day) 可以完成一次重复或 15 次运行，因此需要四天时间才能获得四次重复。环境条件如湿度可能会对研磨过程产生影响，并且这些条件可能每天都不同。因此，为了帮助控制这些条件，将天用作区组因素，其中在一天内获得 15 种处理组合的一次重复。随机化过程是将三个辊隙的顺序随机分配给每天运行的一个辊缝，然后在每个辊缝内，将品种的顺序随机指定给要研磨的批次。图 5.13 显示了随机化过程，其中一天对应于一个区组，一天内的一组五次运行是整区实验单元，单次运行是子区实验单元。未显示所有将品种分配给运行的箭头，因为完整的一组线会使展示混乱不堪。整区设计结构是一个随机完全区组，有四个尺寸为三的区组。整区模型可以表示为 \\[y_{ij}=\\mu+R_i+d_j+e_{ij},\\quad i=1,2,3,j=1,2,3,4,\\mathrm{~where~}d_j\\thicksim i.i.d.\\mathrm{~N}(0,\\sigma_{\\mathrm{day}}^2)\\mathrm{~and~}e_{ij}\\thicksim i.i.d.\\mathrm{~N}(0,\\sigma_{\\mathrm{run}}^2)\\] 其中 \\(R_i\\) 表示辊缝效应，\\(d_j\\) 表示随机天效应 (random day effect)，\\(e_{ij}\\) 表示随机辊缝运行效应或整区误差。整区方差分析表如表 5.17 所示，其中运行或整区误差是通过天与辊缝交互作用计算的；也就是说，随机完全区组设计结构的误差是处理结构与设计结构的交互作用。分析的下一步是确定批次误差的来源。这是通过仅考虑具有一个辊缝（例如 1.5mm）的品种来实现的。表 5.18 中显示了用于比较 1.5mm 辊缝下品种的方差分析表。误差项是通过天与品种（或一天内的运行，因为给定的某天只进行一次运行）的交互作用来计算的，这提供了 12 个自由度来测量在一次运行中相同处理的批次如何变异。这一过程是针对其他两个辊缝设置执行的，每个设置都为批次误差提供 12 个自由度。如果这三个方差相等，那么它们可以合并到具有 36 个自由度的批次误差项中。批次误差项可以表示为 variety × day (roll gap)，也可以表示为“跨辊缝水平的品种与天交互作用” (variety by day interaction pooled across the levels of roll gap). 图 5.13: 磨粉实验随机化过程的显示 表 5.17: 磨粉实验的整区分析 x 表 5.18: 磨粉实验中辊缝为1.5mm时品种比较的方差分析 x 包含运行部分和批次部分的模型可以表示为 \\[y_{ijk}=\\mu+R_i+d_j+e_{ij}+V_k+(RV)_{ik}+\\varepsilon_{ijk},\\quad i=1,2,3,\\quad j=1,2,3,4,\\quad k=1,2,\\ldots,5,\\] 其中 \\[d_j\\thicksim i.i.d.\\mathrm{~}N(0,\\sigma_{\\mathrm{day}}^2)\\text{, }e_{ij}\\thicksim i.i.d.\\mathrm{~}N(0,\\sigma_{\\mathrm{run}}^2)\\text{, and }\\varepsilon_{ijk}\\thicksim i.i.d.\\mathrm{~}N(0,\\sigma_{\\mathrm{batch}}^2)\\] 在上述模型中，\\(R_i\\) 表示第 \\(i\\) 个辊缝效应，\\(V_k\\) 表示第 \\(k\\) 个品种效应，\\((RV)_{ik}\\) 表示辊隙与品种交互作用，\\(\\varepsilon_{ijk}\\) 表示随机批次效应。\\(\\mu+R_i+d_j+e_{ij}\\) 是模型的整区或运行部分，也是模型的子区（或模型的批次部分）的区组结构。模型的批次部分是 \\(V_k+(RV)_{ik}+\\varepsilon_{ijk}\\). 包括运行分析和批次分析的最终方差分析表如表 5.19 所示。括号和箭头表示，模型的运行部分或整区部分是模型批次部分的区组结构。如前所述，通常的裂区设计是具有随机完全区组整区设计结构的裂区设计。 表 5.19: 磨粉实验的方差分析表，显示了每个实验单元尺寸的分析 x 5.3.3 示例 5.3：烘焙面包——具有不完全块设计结构的裂区 一位烘焙科学家设计了一项研究，以评估温度对由两种不同配方制成并在三种不同温度下烘焙的面包 (bread) 体积的影响。图 5.14 显示了本实验的随机化过程。一天 (day) 只有两个烤箱 (oven) 可用，而且当天只能使用一次。每个烤箱可以容纳每种配方下的一条面包，但在一天中只能观察到三种温度中的两种。研究人员希望对每个温度进行四次重复，这意味着该研究需要在不同的六天进行。表 5.20 包含六天的温度分配。图 5.14 显示了将温度随机分配到烤箱的情况，其中天是区组，烤箱是温度水平的实验单元。烤箱设计是一种不完全区组设计结构中的单向处理结构（温度的水平）。可以用来描述每个烤箱数据的模型是 \\[y_{ij}=\\mu+T_i+d_j+o_{ij},\\quad(i,j)\\in\\{(1,1),(2,1),(1,2),(3,2),(2,3),(3,3),(1,4),(3,4),(2,5),(3,5),(1,6),(2,6)\\}\\] 其中 \\[d_j\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{day}}^2)\\quad\\mathrm{and}\\quad o_{ij}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{oven}}^2)\\] 下标 \\((i,j)\\) 在上述指标集中取值，方差分析表见表 5.21. 预期均方是根据III型平方和计算的（见第 ?? 章）。烤箱误差项是根据设计结构与处理结构交互作用 （或天与温度的交互作用）来计算的。如果观察到表 5.20 中的所有单元格，则烤箱误差将有 (3-1)(6-1)=10 个自由度，但其中六个单元格为空，从而为烤箱误差提供 10-6=4 个自由度。面包设计是一种随机完全区组设计结构中的单向处理结构（配方的水平），其中烤箱是区组。并不是所有区组都是一样的，所以考虑那些温度相同的烤箱。温度为 160°C 的处理结构部分如表 5.22 所示。表 5.22 中的设计是具有四个区组或烤箱或天的随机完全区组设计结构中的单向处理结构（两个配方）。根据 160°C 的温度数据，面包误差项有三个自由度，对应于配方与天的交互作用。160°C 下面包分析的方差分析表如表 5.23 所示。可以为每个温度计算面包误差，如果方差相等，则将三个方差合并，为 error (bread) 提供九个自由度。可以用来表示所有数据的模型是 \\[\\begin{aligned} &amp;y_{ijk}=\\mu+T_i+d_j+o_{ij}+R_k+(TR)_{ik}+\\varepsilon_{ijk} \\\\ &amp;(i,j)\\in\\{(1,1),(2,1),(1,2),(3,2),(2,3),(3,3),(1,4),(3,4),(2,5),(3,5),(1,6),(2,6)\\},k=1,2 \\end{aligned}\\] 其中 \\[d_j\\thicksim N(0,\\sigma_\\mathrm{day}^2),\\quad o_{ij}\\thicksim i.i.d.\\mathrm{~N}(0,\\sigma_\\mathrm{oven}^2)\\quad\\mathrm{and}\\quad\\varepsilon_{ijk}\\thicksim i.i.d.\\mathrm{~N}(0,\\sigma_\\mathrm{loaf}^2)\\] 图 5.14: 一天内烤箱的温度分配和烤箱内面包的配方分配，使用不完全区组整区设计结构 表 5.20: 不完全区组整区设计结构中，将温度分配到天 x 注释: X 表示当天未观测温度 表 5.21: 不完全区组设计结构的烤箱分析（忽略配方）的方差分析表，预期均方(EMS)使用III型平方和计算 x 表 5.22: 160°C 烘焙的配方设计 x 表 5.23: 不完全区组设计结构的面包分析的方差分析表（忽略温度） x 该模型的最终方差分析表见表 5.24，其中预期均方是根据III型平方和计算的。由于不完全区组整区设计结构，因此使用了III型平方和。该模型的烤箱部分为 \\(\\mu+T_i+d_j+o_{ij}\\)，这也是该模型面包部分的区组结构。模型的面包部分是 \\(R_k+(TR)_{ik}+\\varepsilon_{ijk}\\). 这个例子表明，任何类型的设计结构都可以用于实验单元的每个水平或每种尺寸。 表 5.24: 采用不完全区组整区设计结构的面包烘焙研究的完整方差分析表，预期均方(EMS)根据III型平方和计算（见第 ?? 章） x 5.3.4 示例 5.4：展示柜中的肉——复杂裂区或四水平设计 一位肉类科学家想研究三个水平的温度（temperature, T）、两个水平的包装类型（packaging, P）、四个水平的光照类型（lightning, L）和四个水平的光照强度（intensity, I）对在肉类冷却器 (cooler) 中储存七天的肉的颜色的影响。实验有六个冷却器，三种温度（1、3和5°C）分别随机分配给两个冷却器，如图 5.15 所示。 每个冷却器在一个 4×4 的网格上分为 16 个分区 (partitions)（图 5.16）。光照强度通过它们在冷却器表面上方的距离来调节，因此，一列 (column) 中的所有分区都被分配相同的光照强度。四种类型的光照随机分配到每列内的四个分区。最后，将两种包装分配给牛排，并将两种包装放入每个分区中。图 5.16 显示了这种冷却器的安排方式。 图 5.15: 展示柜研究中肉类冷却器的温度分配 图 5.16: 在展示柜研究中，为每个冷却器中的肉分配列的光照强度、分区的光照类型和半分区的包装类型 在构建适当的分析之前，必须首先正确识别实验单元的不同尺寸或实验水平。温度水平的实验单元是冷却器。冷却器设计是一种完全随机设计结构中的单向处理结构（T 或温度水平）。如果对每个冷却器进行一次测量，则响应可以通过以下方式建模 \\[y_{ij}=\\mu+T_i+c_{ij},\\quad i=1,2,3,j=1,2,\\mathrm{~and~}c_{ij}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{cooler}}^2)\\] 表 5.25 给出了冷却器模型的方差分析表，其中冷却器误差项是根据两个冷却器在一个温度内的变异、跨三种温度计算得出的 (computed from the variation of the two coolers within a temperature, pooled across the three temperatures). 因此，error (cooler) 有三个自由度。 表 5.25: 冷却器实验单元部分的模型的方差分析表 x 光照强度水平的实验单元是冷却器中四个分区所在的列。列设计由单向处理结构（I 或强度水平）组成，采用随机完全区组设计结构，具有六个区组或冷却器。如果所有冷却器都经相同处理，那么列误差项将根据强度与冷却器交互作用来计算。但有三种不同的温度，因此将分析限制在分配给 1°C 的两个冷却器上。分配给 1°C 的两个冷却器如图 5.17 所示。这时，设计是一个单向处理结构（I 的四个水平）的随机完全区组设计结构（两个冷却器）。如果对这两个冷却器的每个列进行测量，则可用于描述响应的模型为 \\[y_{1jk}=\\mu+I_k+c_{1j}+d_{1jk},\\quad j=1,2,\\,k=1,2,3,4,\\,c_{1j}\\sim i.i.d. N(0,\\sigma_{\\mathrm{cooler}}^2)\\,\\mathrm{~and~}\\,d_{1jk}\\sim i.i.d.N(0,\\sigma_{\\mathrm{colum}n}^2)\\] 列模型的方差分析表如图 5.17 所示，其中列误差项是通过强度与冷却器交互作用来计算的，提供三个自由度。对于另外两个温度重复该过程，每个温度都提供具有三个自由度的列误差项。如果这三个方差相等，则可以将它们合并到具有九个自由度的 error (column) 中。error (column) 可以用 intensity × cooler (temperature) 表示，读作“跨温度水平的强度与冷却器交互作用” (intensity by cooler interaction pooled across the levels of temperature). 图 5.17: 展示柜研究中，比较温度 1 下的强度水平以开始列分析 光照类型水平的实验单元是列的分区。分区设计是一种单向处理结构（L 的水平），采用随机完全区组设计结构，有 24 个区组，由六个冷却器的四个列组成。如果所有列都经相同处理，则分区误差项将通过光照类型与列交互作用来计算。但所有列的处理方式并不相同，因为有三种温度和四种强度水平。将结构限制为仅涉及温度为 1°C 且强度为 I1 的那些列，如图 5.18 所示。与图 5.18 相关的设计是随机完全区组设计结构（两个列，但每个列来自不同的冷却器）中的单向处理结构（光照类型的四个水平）。如果对图 5.18 中的每个分区进行一次测量，则可用于描述响应的模型为 \\[\\begin{aligned}y_{1j1m}&amp;=\\mu+L_m+d_{1j1}^*+p_{1j1m},\\quad j=1,2,m=1,2,3,4,d_{1j1}^*\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{column}}^{2^*})\\mathrm{~and}\\\\p_{1j1m}&amp;\\sim i.i.d.N(0,\\sigma_{\\mathrm{partition}}^2)\\end{aligned}\\] 其中 \\(d_{1j1}^*\\) 表示冷却器和该冷却器效果的列的组合 (the combination of cooler and column of that cooler effect). 该分区模型的方差分析表如图 5.18 所示，其中分区误差项通过光照类型与冷却器交互作用来计算，提供三个自由度。这个过程需要对 12 种温度和强度的组合进行，每种组合为 error (partition) 提供三个自由度。如果这 12 个方差相等，则可以将它们合并为一个项，为 error (partition) 提供三个自由度提供 36 个自由度。error (partition) 项可以表示为 light × intensity × cooler (temperature). 图 5.18: 展示柜研究中，比较温度 1 和强度 1 下的光照水平以开始分区分析 最后，包装水平的实验单元是半分区 (half-partitions)（或牛排）。半分区设计是一种单向处理结构（包装的水平或 P），采用随机完全区组设计结构，具有 96 个分区，由六个冷却器的四个列中的四个分区组成。如果所有分区都经相同处理，那么半分区误差项将通过包装与分区交互作用来计算。但并不是所有的分区都经相同处理，因为它们被分配到三个温度水平、四个强度水平和四个光照水平。选择分配给温度为 1°C、强度为 I1 和光照为 L1 的分区，如图 5.19 所示。如果在图 5.19 中对每块牛排或半分区进行一次测量，则可用于描述响应的模型为 \\[\\begin{aligned}y_{1j11n}&amp;=\\mu+P_n+p_{1j1n}^*+\\varepsilon_{1j11n},\\quad j=1,2,n=1,2,p_{1j1m}^*\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{partition}}^{2*})\\quad\\mathrm{and}\\\\\\varepsilon_{1j11n}&amp;\\sim i.i.d.N(0,\\sigma_{\\frac12\\text{partition}} ^ 2 ) \\end{aligned}\\] 该半分区模型的方差分析表如图 5.19 所示，其中半分区误差项通过包装与冷却器交互作用来计算，提供一个自由度。这个过程需要对 48 种温度、强度和光照的组合进行。这 48 个平方和合并在一起为 error (half-partition) 提供 48 个自由度。error (half-partition) 项可以表示为 packaging × light × intensity × cooler (temperature). 图 5.19: 展示柜研究中，比较温度 1、强度 1 和光照 1 下的包装水平以开始半分区分析 上述讨论提供了研究中的四个水平的模型：冷却器模型、列模型、分区模型和半分区模型。这些模型可以组合成一个模型，其中因素之间的交互作用被加在一起。由于基本设计结构是每个水平的裂区，因此每个水平的处理结构以及与其上一水平处理结构的交互作用都包含在模型的该水平部分中。可以用来描述数据的模型是 \\[\\begin{aligned} \\mathcal{Y}_{ijkmn}=&amp; \\mu+T_i+\\mathcal{C}_{ij} &amp;&amp;\\{\\text{cooler part of the model}\\\\ &amp;+I_k+(TI)_{ik}+d_{ijk} &amp;&amp;\\{\\text{column part of the model}\\\\ &amp;+L_m+(TL)_{im}+(IL)_{km}+(TIL)_{ikm}+p_{ijkm} &amp;&amp;\\{\\text{partition part of the model}\\\\ &amp;+P_n+(TP)_{in}+(IP)_{kn}+(TIP)_{ikn}+(LP)_{mn}+(TLP)_{imn}+(ILP)_{km}+(TILP)_{ikmn}+\\varepsilon_{ijkmn} &amp;&amp;\\{\\text{half-partition part of the model}\\\\ &amp;i=1,2,3,\\quad j=1,2,\\quad k=1,2,3,4,\\quad m=1,2,3,4,\\quad n=1,2,\\\\ &amp;c_{ij}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{cooler}}^2),\\quad d_{ijk}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{column}}^2),\\quad p_{ijkn}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{partition}}^2),\\quad \\boldsymbol{\\varepsilon}_{ijkmn}\\thicksim i.i.d.N(0,\\sigma_{\\frac12\\text{partition}} ^ 2 ) \\end{aligned}\\] 表 5.26 给出了上述模型的方差分析表，其中较大的实验单元分析也是下一个较小实验单元的区组结构。这是一个裂-裂-裂区 (split-split-split-plot) 实验模型，由四个水平（或实验单元尺寸）组成，涉及四个误差项，每个水平（或每种实验单元尺寸）对应一个。这也是一种分层设计结构，其中半分区嵌套在分区内，分区嵌套在列内，列嵌套在冷却器内。 表 5.26: 展示柜研究中复杂裂区设计完整的方差分析表 x 注释: 括号和箭头指示哪些效应形成下一个较小尺寸的实验单元的区组 5.4 裂条区设计结构：一种无层次的多水平设计 构造裂条区设计结构的过程是将实验单元排列成矩形。一组因素的水平随机分配给每个矩形的行，另一组因素的水平随机分配给每个矩形的列。因此，行是与第一组因素相关的实验单元，列是与第二组因素相关的实验单元。但因此，一行和一列的单元格或交叉点是与两组因素之间的交互作用比较相关的实验单元。通过一个例子来演示裂条区设计结构的一些用途。 5.4.1 示例 5.5：制作奶酪 一位乳制品科学家设计了一项奶酪制造研究，涉及两种脂肪水平、三种奶酪类型、两种储存温度和两种储存湿度。该实验是一个分两步进行的过程，第一步是用两种脂肪水平为每种类型的奶酪制作一批 (batch) 奶酪。每批奶酪要制成四包一磅重的奶酪块 (cheese block). 第二步是将奶酪储存在一系列环境条件下，用四周的时间使其固化。该研究的储存部分包括将每批奶酪中的一包放入一个指定储存温度和湿度的室 (chamber) 中。这个过程相当于将 24 包奶酪排列成四行六列的矩形。该列对应一批奶酪，该行对应一个环境室，如图 5.20 所示。这位奶制品科学家有四个实验室可用于研究，但他希望有四次重复。因此，通过在四个不同的月份进行实验获得了四次重复。可以通过评估每种尺寸的实验单元的处理和设计结构来构建模型并分析。室设计如图 5.21 所示，其中仅显示了四个月中每个月的温度和湿度水平。室设计是一种双向处理结构（温度水平与湿度水平），采用随机完全区组设计结构，每个月为一个区组。可用于描述在每个室中进行的测量的模型为 \\[\\begin{aligned}y_{ijk}=&amp;\\mu+T_j+H_k+(TH)_{jk}+m_i+c_{ijk},\\quad i=1,2,3,4,j=1,2,k=1,2\\\\&amp;m_i\\sim i.i.d.N(0,\\sigma_{\\mathrm{month}}^2),\\text{ and }c_{ijk}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{chamber}}^2)\\end{aligned}\\] 表 5.27 包含室模型的方差分析表，其中室误差项是处理结构与设计结构的交互作用。在处理结构中有四种处理组合，在设计结构中有四个区组；因此，室误差项基于九个自由度。error (chamber) 项是温度与月交互作用、湿度与月交互作用和温度与湿度与月交互作用项的总和。如果在 SAS-Mixed 程序中使用三向交互项，则三个交互项将合并为一个误差项。室的方差分量用星号表示，因为它也包括由于奶酪块引起的变异。月份的方差分量用星号表示，因为它还包括由于批次和奶酪区组引起的变异。 图 5.20: 采用裂条区设计结构的奶酪制作实验的随机化方案 图 5.21: 奶酪制作实验中室设计的随机化方案 表 5.27: 奶酪制作实验中室实验单元设计的方差分析 x 批次设计如图 5.22 所示，其中仅考虑了奶酪类型和脂肪百分比。批次设计是一种双向处理结构（奶酪类型水平与脂肪水平），采用随机完全区组设计结构，其中每个月为一个区组。可用于描述对每个批次进行测量的模型为 \\[\\begin{aligned}y_{imn}=&amp;\\mu+F_m+C_n+(FC)_{mn}+m_i+b_{imn},\\quad i=1,2,3,4,m=1,2,n=1,2,3,\\\\&amp;m_i\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{month}}^2)\\mathrm{~and~}b_{imn}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{batch}}^2)\\end{aligned}\\] 表 5.28 包含室模型的方差分析表，其中室误差项是处理结构与设计结构的交互作用。处理结构中有六种处理组合，设计结构中有四个区组，因此批次误差项基于 15 个自由度。error (batch) 项是月份与脂肪、月份与奶酪类型以及脂肪与奶酪类型与月份交互作用项的总和。如果在 SAS-Mixed 程序中使用三向交互项，则三个交互项将合并为一个误差项。批次的方差分量用星号表示，因为它还包括由于奶酪块引起的变异。 图 5.22: 奶酪制作实验的批设计的随机化方案。为了简化绘图，有些线没有包括在内 表 5.28: 奶酪制作实验中批次实验单元设计的方差分析 x 1 磅奶酪块是分配给室的因素和分配给批次的因素之间交互作用的实验单元。模型的奶酪块部分是 \\[\\begin{aligned}&amp;(TF)_{jm}+(TC)_{jn}+(TFC)_{jmn}+(HF)_{kn}+(HC)_{kn}+(HFC)_{kmn}+(THFC)_{jkmn}+\\varepsilon_{ijkmn}\\\\&amp;\\varepsilon_{ijkmn}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{block}}^2)\\end{aligned}\\] 该裂条区设计的模型是通过将三个实验单元的模型合并为一个模型而获得的： \\[\\begin{aligned}y_{ijk}&amp;=\\mu+m_i&amp;&amp;\\{\\text{blocking part of the model}\\\\&amp;+T_j+H_k+(TH)_{jk}+c_{ijk}&amp;&amp;\\{\\text{chamber part of the model}\\\\&amp;+F_m+C_n+(FC)_{mn}+b_{imn}&amp;&amp;\\{\\text{batch part of the model}\\\\&amp;+(TF)_{jm}+(TC)_{jn}+(TFC)_{jmn}+(HF)_{km}+(HC)_{kn}+(HFC)_{kmn}+(THFC)_{jkmn}+\\varepsilon_{ijkmn}&amp;&amp;\\{\\text{cheese block part of the model}\\\\ &amp;i=1,2,3,4,\\quad j=1,2,\\quad k=1,2,\\quad m=1,2,\\quad n=1,2,3 \\\\ &amp;m_i\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{month}}^2),\\quad c_{ijk}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{chamber}}^2),\\quad b_{imn}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{batch}}^2), \\\\ &amp;\\mathrm{and~}\\varepsilon_{ijkmn}\\sim i.i.d.N(0,\\sigma_{\\mathrm{block}}^2)\\end{aligned}\\] 表 5.29 给出了奶酪实验的方差分析表，其中各行按实验单元的尺寸进行分离。奶酪块误差项通过室处理结构与批次处理结构与设计结构的交互作用来计算，提供 (4 - 1)(6 - 1)(4 - 1) = 45 个自由度。该设计涉及三种尺寸的实验单元：室尺寸、批次尺寸和奶酪块尺寸。奶酪块嵌套在批次内，奶酪块嵌套在室内，但批次不嵌套在室内，室也不嵌套在批次内。因此，这种多层设计结构不是分层设计结构。 表 5.29: 奶酪制作实验完整的方差分析表 x 这个例子说明了与给定尺寸的实验单元相关的设计结构可以涉及任何所需的处理结构。室和批次实验单元的处理结构都是双向析因安排。 我们可以采用这样的双向析因安排：将一个对照作为其中一个实验单元的处理结构。这种先确定实验单元，然后指定每个实验单元的设计和处理结构的过程，为复杂实验提供了确定适当的设计和相应模型的一般方法。 5.5 重复测量设计 重复测量设计在许多研究领域中得到了有效的应用。这些设计包括至少两个因素的处理结构，不完全区组设计结构和至少两种实验单元尺寸。重复测量设计与裂区设计具有相同的设计结构类型，但重复测量设计与裂区类型设计的不同之处在于，一个或多个因素的水平不能随机分配给相应的实验单元。通常，时间是这样一个因素：其水平不能随机分配给个体的时间间隔。涉及时间的重复测量设计是用于纵向研究的设计。因此，重复测量设计涉及一个或多个步骤，其中不可能将某些因素的水平随机分配给其实验单元，而裂区型设计则可以在每一步使用随机化。下面的例子演示了重复测量设计的一些结构，并为正确识别设计实验提供了指导。 5.5.1 示例 5.6：马足——基本重复测量设计 这个特殊的实验引出了使用两种不同尺寸的实验单元的重复测量设计的想法。然而，如果实验者不小心，他或她可能会无意中错过有两种不同尺寸的实验单元的事实，从而导致错误的分析。 兽医有两种技术可用于融合马足 (horse feet) 骨折后的关节，她希望确定哪种技术更好。 这个实验包括取一些马，在每匹马身上折断一个关节，用两种技术中的一种进行修复，四个月后确定融合关节的强度。 她还想确定同样的技术对前足和后足是否同样有效。 由于马匹稀缺且价格昂贵，她计划在每匹马的前足上折断关节，等待其愈合，然后再在后足上折断关节，或者反过来，先折断后足后折断前足。这个愈合过程也在设计中引入了时间因素。因此，处理结构是由两种融合技术（F）、两个位置（P）和两个愈合时间（T）产生的 23 析因安排。设计结构是一个不完全区组设计，每匹马都是一个区组，每个区块（马）有两个观测值。由于区组不完全，一些处理结构信息将与区组（或马）效应混淆 (Cochran and Cox, 1957). 有多种方法可以将处理组合分配给马的双足。假设有四匹马。一个过程是为每匹马指定一种融合技术，其中前足和后足都接受相同水平的融合处理，如表 5.30 所示。 表 5.30: 马足实验处理组合的首次分配 x 注释: 两种融合技术为 \\(F_1\\) 和 \\(F_2\\)，两个时间为 \\(T_1\\) 和 \\(T_2\\)，两个位置为 \\(P_1\\) 和 \\(P_2\\) 设 \\(y_{ijkm}\\) 表示通过第 \\(i\\) 种融合技术、第 \\(j\\) 个位置、第 \\(k\\) 个时间和第 \\(m\\) 匹马获得的观测值。用于描述数据的模型是 \\[y_{ijkm}=\\mu_{ijk}+h_m+\\varepsilon_{ijkm},\\quad i=1,2,\\quad j=1,2,k=1,2,m=1,2,\\ldots,4\\] 其中 \\(\\mu_{ijk}\\) 表示第 \\(i\\) 种融合技术、第 \\(j\\) 个位置、第 \\(k\\) 个时间的平均响应，\\(h_m\\) 表示第 \\(m\\) 匹马的效应，\\(\\varepsilon_{ijkm}\\) 表示在马足上进行的测量的响应误差。在处理组合均值 \\(\\mu_{ijk}\\) 中可以进行两种类型的比较。一种类型的比较是马内 (intra-horse or within-horse) 比较，而另一种类型的比较是马间 (inter-horse or between-horse) 比较。析因效应可以定义为 \\[\\begin{aligned} \\text{Mean}&amp; =\\bar{\\mu}_{\\cdot\\cdot\\cdot} \\\\ F&amp; =\\bar{\\mu}_{1\\cdot\\cdot}-\\bar{\\mu}_{2\\cdot\\cdot},P=\\bar{\\mu}_{\\cdot1\\cdot}-\\bar{\\mu}_{\\cdot2\\cdot},T=\\bar{\\mu}_{\\cdot\\cdot1}-\\bar{\\mu}_{\\cdot\\cdot2} \\\\ F\\times P&amp; \\begin{aligned}&amp;=\\bar{\\mu}_{11\\cdot}-\\bar{\\mu}_{12\\cdot}-\\bar{\\mu}_{21\\cdot}+\\bar{\\mu}_{22\\cdot}\\end{aligned} \\\\ F\\times T&amp; =\\bar{\\mu}_{1\\cdot1}-\\bar{\\mu}_{1\\cdot2}-\\bar{\\mu}_{2\\cdot1}+\\bar{\\mu}_{2\\cdot2} \\\\ P\\times T&amp; =\\bar{\\mu}_{\\cdot11}-\\bar{\\mu}_{\\cdot12}-\\bar{\\mu}_{\\cdot21}+\\bar{\\mu}_{\\cdot22} \\\\ F\\times P\\times T&amp; =\\mu_{111}-\\mu_{112}-\\mu_{121}+\\mu_{122}-\\mu_{211}+\\mu_{212}+\\mu_{221}-\\mu_{222} \\end{aligned}\\] \\(\\mu_{ijk}\\) 的最佳估计为 \\(\\bar y_{ijk\\cdot}\\). 主效应 \\(P\\) 的最佳估计可以表示为 \\[\\begin{aligned}\\hat{P}&amp;=\\bar{y}_{\\cdot1\\cdot\\cdot}-\\bar{y}_{\\cdot2\\cdot\\cdot}\\\\&amp;=\\frac{1}{4}[({y}_{1111}-{y}_{1221})+({y}_{1122}-{y}_{1212})+({y}_{2113}-{y}_{2223})+({y}_{2124}-{y}_{2214})]\\end{aligned}\\] 这是马内比较。将上述模型的右侧替换为 \\(P\\) 中的 \\({y}_{ijkm}\\)，可以很容易地证明马内比较的合理性，这给出 \\[\\begin{aligned}\\hat{P}&amp;=\\frac14[(\\mu_{111}+h_1+\\varepsilon_{1111}-\\mu_{122}-h_1-\\varepsilon_{1221})+(\\mu_{112}+h_2+\\varepsilon_{1122}-\\mu_{121}-h_2-\\varepsilon_{1212})\\\\&amp;+(\\mu_{211}+h_3+\\varepsilon_{2113}-\\mu_{22}-h_3-\\varepsilon_{223})+(\\mu_{212}+h_4+\\varepsilon_{2124}-\\mu_{221}-h_4-\\varepsilon_{2214})]\\\\&amp;=\\bar{\\mu}_{\\cdot1}-\\bar{\\mu}_{\\cdot2}+\\frac{1}{4}[(\\varepsilon_{1111}-\\varepsilon_{1221})+(\\varepsilon_{1122}-\\varepsilon_{1212})+(\\varepsilon_{2113}-\\varepsilon_{222})+(\\varepsilon_{2124}-{\\varepsilon}_{2214})]\\end{aligned}\\] 请注意到马效应 \\(h_m\\) 从表达式中消去。\\(\\hat P\\) 的方差取决于 \\(\\varepsilon_{ijkm}\\) 的方差，而不是 \\(h_m\\) 的方差。 \\(\\hat P\\) 的方差为 \\(\\operatorname{Var}(P) = \\sigma^2_{\\varepsilon} /2\\). \\(F\\) 的最佳估计可以表示为 \\[\\begin{aligned}\\hat{F}&amp;=\\bar{y}_{1\\cdot\\cdot\\cdot}-\\bar{y}_{2\\cdot\\cdot\\cdot}\\\\&amp;=\\frac14[(y_{1111}+y_{1221})+(y_{1122}+y_{1212})-(y_{2113}+y_{2223})-(y_{2124}+y_{2214})]\\end{aligned}\\] 此估计是马间的比较；也就是说，它是马 1 和马 2 平均值与马 3 和马 4 平均值的比较，因此它取决于马效应。通过将模型右侧的 \\(F\\) 表示为 \\[\\begin{aligned} \\hat{F}&amp; =\\frac14[(\\mu_{111}+h_1+\\varepsilon_{1111}+\\mu_{122}+h_1+\\varepsilon_{1221})+(\\mu_{112}+h_2+\\varepsilon_{1122}+\\mu_{121}+h_2+\\varepsilon_{1212}) \\\\ &amp;=[\\bar{\\mu}_{\\cdot1}-\\bar{\\mu}_{\\cdot2}+\\frac14[(\\varepsilon_{1111}+\\varepsilon_{1221})+(\\varepsilon_{1122}+\\varepsilon_{1212})-(\\varepsilon_{2113}+\\varepsilon_{2223})-(\\varepsilon_{2124}+\\varepsilon_{2214})] \\\\ &amp;+\\frac12[h_1+h_2-h_3-h_4] \\end{aligned}\\] 其中涉及 \\(h_m\\)，从而此估计依赖于马效应。\\(\\hat F\\) 的方差取决于 \\(h_m\\) 的方差和 \\(\\varepsilon_{ijkm}\\) 的方差，\\(\\mathrm{Var}(\\hat{F})=\\frac{1}{2}\\left[\\sigma_{\\varepsilon}^{2}+2\\sigma_{\\mathrm{horse}}^{2}\\right]\\)。同样可以证明，\\(P,T,F\\times T,F\\times P\\) 是马内效应，而 \\(F,P\\times T,F\\times P\\times T\\) 是马间效应。由于马间效应涉及 \\(h_m\\)，因此称它们与马效应混淆 (confounded)；即 \\(F,P\\times T,F\\times P\\times T\\) 与马效应混淆。 该设计由不完全区组设计结构中的三向处理结构组成，其中每匹马是一个区组。由于一些比较是马间比较，另一些是马内（足间）比较，因此该实验涉及两种尺寸的实验单元。足是较小尺寸的实验单元，而马是较大尺寸的实验单元。模型中的 \\(h_m\\) 项代表马误差（即，经相同处理的马之间的差异引起的变异），而 \\(\\varepsilon_{ijkm}\\) 项表示足误差（即，同一匹马经相同处理的足之间的差异引起的变异）。当设计涉及不同尺寸的实验单元的实验时，最好选择那些最重要的效应，以便它们涉及较小实验单元之间的比较，并让那些最不重要的效应涉及较大实验单元之间的比较。然而，这类安排并不总是可行的。例如，如果马足实验涉及两种类型的马（例如赛马和工作马），那么马的类型就只能作为马间比较。在只有三个因素的马足实验中，实验者最感兴趣的是比较两种融合技术。表 5.30 中给出的设计使得融合效应与马效应混淆，导致融合技术均值比较的精度低于预期。表 5.31 中给出的设计实现了融合技术均值的比较，且不与马效应混淆，因此达到了使用较小实验单元（马足）的变异性来比较最重要效应的目标。 第一种安排的模型也可以用来表示第二种将处理组合分配给马或区组的数据。使用与第一种安排相同的技术，可以证明 \\(F,P,T,F\\times P\\times T\\) 效应是马内比较，\\(F\\times T,F\\times P,P\\times T\\) 效应是马间比较，这些效应与马效应混淆。上述两种设计都没有产生足够的观测值来为估计两个误差项提供任何自由度。为了获得两种类型的误差方差的一定自由度，可以使用八匹马重复表 5.31 中的设计，其中两匹马被随机分配到每组处理组合。分析仍然由两部分组成，马间分析和马内（足间）分析。将进行八次马内比较（每匹马一次），可划分为对 \\(F,T,P,F \\times P \\times T\\) 效应的估计，以及对马内误差方差的估计，该误差方差用 error (feet) 表示。将进行七此马间比较，可划分为 \\(F\\times T,F\\times P , P\\times T\\) 效应的估计，以及马间误差方差的估计，该误差方差用 error (horse) 表示。方差分析结果表显示在表 5.32 中。 表 5.31: 马足实验处理组合的第二次分配 x 表 5.32: 马间和马内方差分析表 x 这个设计的实验属于重复测量设计类型，因为每匹马都有两次测量（重复）；也就是说，对每匹马测量前足和后足，并且不能将位置水平随机分配给其实验单元。 5.5.2 示例 5.7：舒适度研究——重复测量设计 一位实验者想研究六种环境条件对人的舒适度的影响。他有六个环境室，每个环境室都可以设置不同的环境条件。该实验包括将一个人放在一个室内，然后在暴露 1、2 和 3 小时后测量他的舒适度。研究中有 36 名个体，其中 6 名个体被随机分配到每种环境中。研究人员可以在一天内从六种环境条件中获得数据，因此天被用作一个区组因素，每天将每种环境条件分配给六个室中的一个。暴露时间是研究中的一个重要因素，因此处理结构是双向的，环境水平与三个暴露时间交叉。受试者被随机分配一个从 1 到 36 的数字，其中前 6 人在第一天参与实验，以此类推。环境和人员的分配如图 5.23 所示。图 5.23 中的每个矩形代表一个人，T1、T2和T3分别代表暴露 1、2 和 3 小时后的舒适度。环境的实验单元是一个人或一个室，而时间的实验单元则是该人员“内”的1小时间隔。实际上，人被“分成”三部分，但这种设计结构被称为重复测量设计而不是裂区设计，因为暴露时间水平不能随机分配给一个人的三个 1 小时暴露时间。该设计的结构与随机完全区组整区设计结构中具有双向处理结构的通常裂区相同。对于这种重复测量设计结构，较大尺寸的实验单元（人，或整区）设计由随机完全区组设计结构（六天）中的单向处理结构（六个环境水平）组成。较小尺寸的实验单元（1 小时时间间隔，或裂区）设计是随机完全区组设计结构中的单向处理结构（三次暴露），其中每个人或室是一个区组。可以用来描述该实验数据的模型是 \\[y_{ijk}=\\mu+E_i+d_j+c_{ij}+T_k+(ET)_{ik}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,6,\\quad j=1,2,\\ldots,6,\\quad k=1,2,3\\] 其中 \\(d_j\\) 表示第 \\(j\\) 天的效应，\\(c_{ij}\\) 表示第 \\(j\\) 天用于第 \\(i\\) 个环境的室（或人）的效应，\\(\\varepsilon_{ijk}\\) 是时间间隔效应。如果对每人进行一次观测，则所得数据集将来自随机完全区组设计结构中的单向处理结构。室（或人）的误差项是通过天与环境交互作用计算的。如果比较第一种环境条件下的时间，则所得设计是随机完全区组设计结构中的单向处理结构，其中人（或室，或天）是区组因素。时间间隔误差项是根据天与时间交互作用计算的。可以为每个环境计算时间间隔的误差项，如果方差相等，则可以将其合并到时间间隔误差中。表 5.33 中给出了该重复测量设计的方差分析表。这种基本的重复测量结构与通常的裂区设计相同。 裂区模型假设 \\(d_j,c_{ij},\\varepsilon_{ijk}\\) 是独立的随机变量，方差为 \\(\\sigma^2_\\text{day},\\sigma^2_\\text{chamber},\\sigma^2_\\varepsilon\\). 重复测量设计也假设 \\(d_j,c_{ij},\\varepsilon_{ijk}\\) 是独立的随机变量，但由于 \\(\\varepsilon_{ijk}\\) 是在同一个人身上测量的，它们可以是相关的，相关结构可能需要建模，协方差结构的建模将在第 ?? 章和第 ?? 章讨论。 图 5.23: 舒适度研究的数据安排 表 5.33: 舒适度研究的方差分析表 x 将一个人分配到每个环境室的另一种方法是将六人一组分配到一个环境室并在一天内完成研究。这个分配过程似乎是一个好主意，但生成的数据集没有提供任何这样的测量：经相同处理时，室是如何变异的。室误差项不存在是因为六个人组成了环境的实验单元，因此每个环境只有一个独立的观测。如果没有室误差项，就无法评估环境对舒适度的效应。 5.5.3 示例 5.8：交叉或转换设计 一种将处理应用于个体（或对象）的比较方法，就是让个体自身作为对照，将两种或多种处理应用于同一个体。如果有两种处理方法，那么过程是先将处理 A 应用于第一个时间段并测量响应，让处理 A 的效应减弱 (diminish) 或洗脱 (wash out)，然后在第二个时间段将处理 B 应用于个体并观察对处理 B 的响应。随机化过程是构建处理序列 (sequence)（这里是先 A 后 B 和先 B 后 A），然后随机将个体或动物分配给这些序列。这种方法还可以用于植物、地块或其他对象，在将实验单元暴露于处理后，该实验单元应至少能够从第一次处理的效应中恢复一部分。 在这种比较两种处理方法的方法中，动物有两种处理分配序列——先 A 后 B 和先 B 后 A。这两个序列通常用 AB 序列和 BA 序列表示。处理结构是具有两个水平（A 和 B）的单向处理集，但由于处理按顺序应用于每个实验单元，因此生成的序列成为另一种类型的处理。因此，本实验的设计涉及双向处理结构，处理与序列交叉。 这种交叉设计是一种具有两种尺寸的实验单元的重复测量设计。将处理序列分配给个体，使个体成为更大的实验单元。观察处理的时间段或时间是较小尺寸的实验单元。较大尺寸实验单元的设计是完全随机设计结构中具有两个水平的序列（两个可能的序列）的单向处理结构。尽管可以使用任何设计结构，但最常用的是完全随机设计。较小尺寸实验单元（时间间隔）的设计是完全随机区组设计结构中的单向处理结构（两个时间段或两次处理），个体是区组。数据可按表 5.34 所示进行排列，可用于描述数据的模型为 \\[y_{ijk}=\\mu_{ik}+s_{ij}+\\varepsilon_{ijk},\\quad\\mathrm{~where~}(i,j,k)\\in I_\\text{D}{ , s _ { i j }}\\thicksim i.i.d.\\text{ N}(0,\\sigma_{\\mathrm{subject}}^2),\\mathrm{~and~}\\varepsilon_{ijk}\\thicksim i.i.d.\\text{ N}(0,\\sigma_{\\mathrm{time}}^2)\\] 其中 \\(I_D\\) 是实验中实际使用的 \\((i,j,k)\\) 三元组的指标集，\\(\\mu_{ik}\\) 表示第 \\(i\\)个序列中第\\(k\\)次处理的效应，\\(s_{ij}\\)表示分配给第\\(i\\)个序列的第\\(j\\)个受试者的随机效应，\\(\\varepsilon_{ijk}\\)表示在应用第\\(k\\)次处理的第\\(i\\)个序列的时间段中测量的随机误差。第 10 章介绍了一些交叉设计的分析。 表 5.34: 两阶段两处理交叉设计的数据安排 x 5.6 涉及嵌套因素的设计 在给定的设计中，可能在设计结构、处理结构或两个结构中都具有嵌套效应 (nested effects). 嵌套最常见于实验的设计结构中，其中较小尺寸的实验单元嵌套在较大尺寸的实验中。如果每个较大实验单元中的较小实验单元都不同，那么一个尺寸的实验单元就嵌套在另一个较大的尺寸中。当设计结构由几种不同尺寸的实验单元组成，并且存在一种排序：最小尺寸嵌套在次小尺寸内，直到次大尺寸嵌套在最大尺寸的实验单元内，这种设计也称为分层设计结构。本章前几节讨论的裂区设计和重复测量设计是这样的设计结构的良好示例：其中较小尺寸实验单元嵌套在较大尺寸实验单元内。当一个因素的水平仅与第二个因素的一个水平一起出现时，处理结构中就会出现嵌套。在这种情况下，第一个因素的水平被认为是嵌套在第二个因素的水平内。表 5.35 说明了示例 4.2 第二部分的设计结构中的嵌套，其中房屋嵌套在方块内（“X”表示房屋包含在相应的方块内）。每个方块是较大的实验单元或房屋区组，而房屋是较小的实验单元。由于第一个方块的房屋与第二个方块的房屋不同，因此房屋嵌套在方块内。这种嵌套效应通常在模型中用 \\(s_k + h_{m(k)}\\) 表示，其中 \\(s_k\\) 表示第 \\(k\\) 个方块的效应，\\(h_{m(k)}\\) 表示嵌套在第 \\(k\\) 个方块中的第 \\(m\\) 个房屋的效应。方块和方块内房屋的平方和分别用 SSSQUARE 和 SSHOUSES(SQUARES) 表示。如果模型中包含房屋而不是方块，则只有一个由房屋（SSHOUSES）引起的平方和，可以将其划分为 SSHOUSES = SSSQUARES + SSHOUSES(SQUARES)。此过程可以再进行一步，其中房屋的侧面嵌套房屋内（而房屋又嵌套在方块内）。这样，这三种尺寸的实验单元就形成了一个分层设计结构。 表 5.35: 显示嵌套在方块内的房屋的设计 x 5.6.1 示例 5.9：动物遗传学 一位动物科学家想要研究基因对羔羊生长速度的影响。她有 4 只公羊和 12 只母羊。育种结构如表 5.36 所示（“X”表示交配）。在这个例子中，每只公羊都与三只母羊交配，而这三只母羊对于每只公羊来说都是不同的。因此，母羊的水平被称为嵌套因素，母羊嵌套在公羊中。如果动物科学家对这个公羊组合和这个母羊组合的效应感兴趣，那么嵌套在公羊水平内的母羊水平就构成了一个嵌套处理结构。 表 5.36: 育种结构显示母羊嵌套在公羊中 x 当处理结构中出现嵌套时，处理结构必须至少包含两个因素。在这种情况下，嵌套因素的每个水平只与其他因素的一个或几个水平一起出现一次。接下来的两个示例演示了处理结构中的嵌套。 5.6.2 示例 5.10：大豆的生育期组 农作物大豆对于处理结构中的嵌套是一个很好的例子。大豆品种按生育期组 (maturity groups) 进行分类。在美国中西部地区种植着生育期组 4、5 和 6 的大豆品种，但某一生育期组的品种可能比另一生育期组的品种更适合特定地区。一项研究设计用于评估 8 个大豆品种，其中 2 个来自成熟期组 4，4 个来自生育期组 5，2 个来自生育期组 6。表 5.37 展示了处理结构，表明品种水平嵌套在生育期水平内。一个可以描述来自这个嵌套处理结构的数据的模型，是一个具有四个区组的随机完全区组设计结构 \\[\\begin{aligned}&amp;y_{ijk}=\\mu+M_i+V(M)_{j(i)}+b_k+\\varepsilon_{ijk},\\quad i=1,2,3,j=1,\\ldots,n_i,k=1,2,3,4\\\\&amp;b_k\\sim i.i.d.N(0,\\sigma_{\\mathrm{row}}^2),\\varepsilon_{ijk}\\sim i.i.d.N(0,\\sigma_{\\varepsilon}^2),n_1=n_3=2,\\mathrm{~and~}n_2=4.\\end{aligned}\\] 其中 \\(M_i\\) 表示第 \\(i\\) 个生育期组的效应，\\(V(M)_{j(i)}\\) 表示嵌套在第 \\(i\\) 个生育期组内的第 \\(j\\) 个品种的效应，\\(b_k\\) 表示第 \\(k\\) 个区组的效应，\\(\\varepsilon_{ijk}\\) 表示实验单元误差。表 5.38 给出了上述模型的方差分析表，其中误差项是通过品种与区组交互作用来计算的。品种与区组交互作用可以划分为：生育期组与区组交互作用+嵌套在生育期组内的品种与区组的交互作用。 表 5.37: 品种嵌套于生育期组的大豆研究的处理结构 x 表 5.38: 随机完全区组设计结构中大豆品种嵌套于生育期组的方差分析表 x 上述设计的一个问题是，由于生育期组 4 的大豆比生育期组 5 的大豆更早收获，而生育期组 5 的大豆又比生育期组 6 的大豆更早收获，因此地块 (plots) 需要在不同的时间进行收获。随机完全区组设计的一种替代方案是使用裂区设计，其中整区由生育期组形成，子区由生育期组的品种形成。裂区设计的优点是可以同时收获整区内的所有品种。随机化过程是将生育期组水平随机分配给每个整区内的地块集 (sets of plots)，然后将各自的品种随机分配给生育期组内的地块。这种裂区设计结构的模型是 \\[\\begin{aligned}y_{ijk}&amp;=\\mu+M_i+b_k+w_{ik}+V(M)_{j(i)}+\\varepsilon_{ijk},\\quad i=1,2,3,j=1,\\ldots,n_i,k=1,2,3,4\\\\b_k&amp;\\sim i.i.d.N(0,\\sigma_{\\mathrm{row}}^2),v_{ik}\\sim i.i.d.N(0,\\sigma_{\\mathrm{wplot}}^2),\\mathrm{and}\\,\\,\\varepsilon_{ijk}\\sim i.i.d.N(0,\\sigma_{\\varepsilon}^2)\\end{aligned}\\] 其中 \\(w_{ik}\\) 表示整区效应，\\(\\varepsilon_{ijk}\\) 表示子区效应。整图设计是随机完全区组设计结构中的单向处理结构（三个生育期水平），其中整区误差是根据区组与生育期交互作用计算的。子区设计由三个独立的单向处理结构组成，采用随机完全区组设计结构，每个生育期组一个。由于每个生育期组中有不同数量的品种，因此整区的尺寸不同。这种双向嵌套处理结构在裂区设计结构中的方差分析表如表 5.39 所示。 表 5.39: 裂区设计结构中大豆品种嵌套于生育期组的方差分析表 x 5.6.3 示例 5.11：飞机引擎 某飞机公司希望用三种飞机来评估七种引擎的性能。由于某些机械特性，每种飞机只能使用某些引擎。表 5.40 给出了可能的引擎-飞机配置（标记为“X”）。 表 5.40: 嵌套处理结构中可观测的引擎-飞机配置 x 如表 5.40 所示，每种引擎类型只能出现在一种飞机类型上，因此引擎水平嵌套在飞机水平内。飞机公司为七种处理组合（引擎类型与飞机类型）中的每一种制造了三架飞机。 数据收集过程是将 21 种引擎型号-飞机型号的配置随机排序，让试飞员按随机顺序驾驶飞机并测量性能特征。设 \\(y_{ijk}\\) 表示由第 \\(i\\) 种飞机型号和第 \\(j\\) 种引擎型号制成的第 \\(k\\) 架飞机的性能测量。可用于描述性能测量的均值模型为 \\[\\begin{aligned}y_{ijk}&amp;=\\mu_{ij}+p_{ijk},\\quad\\text{for }(i,j)\\in\\Theta\\text{ and }p_{ijk}\\thicksim i.i.d.N(0,\\sigma_{\\text{plane}}^2)\\end{aligned}\\] 或效应模型 \\[y_{ijk}=\\mu+A_i+E_{j(i)}+p_{ijk},\\quad\\mathrm{for~}(i,j)\\in\\Theta,\\] 其中 \\[\\Theta=\\{(1,A),(1,B),(1,C),(2,D),(2,E),(3,F),(3,G)\\}\\] 表 5.41 显示了效应模型的方差分析表。使用同一引擎类型和飞机类型的配置制造三架飞机，可计算这三架飞机性能得分的变异，并将这七种配置的性能得分变异合并在一起以计算飞机误差项 (The plane error term is computed from the variation of the performance scores of the three planes made with the same engine type and aircraft type configuration pooled across the seven configurations). 就均值模型而言，飞机平方和用于检验飞机均值的相等性，即检验原假设 \\[\\bar{\\mu}_{1\\cdot}=\\bar{\\mu}_{2\\cdot}=\\bar{\\mu}_{3\\cdot}\\] 或 \\[\\frac{{\\mu}_{1A}+{\\mu}_{1B}+{\\mu}_{1C}}3=\\frac{{\\mu}_{2D}+{\\mu}_{2E}}2=\\frac{{\\mu}_{3F}+{\\mu}_{3G}}2\\] 引擎（嵌套在飞机内）平方和用于检验原假设 \\[{\\mu}_{1A}={\\mu}_{1B}={\\mu}_{1C},\\quad{\\mu}_{2D}={\\mu}_{2E},\\quad\\mathrm{and}\\quad{\\mu}_{3F}={\\mu}_{3G}\\] 当处理结构中出现嵌套时必须非常小心，因为有这样一种执行分析的趋势：就好像存在嵌套或分层设计结构。单个飞机是本研究的唯一实验单元，即只有一个尺寸的实验单元和一个误差项。当设计结构中出现嵌套时，存在不止一个尺寸的实验单元，因此模型中存在不止一个误差项。下一个示例说明了设计结构中的嵌套。 表 5.41: 完全随机设计结构中双向嵌套处理结构的方差分析表 x 5.6.4 示例 5.12：简单的舒适度实验 为了研究温度（三个水平，分别为 18°C、21°C 和 24°C）和性别（两个水平，男性 M 和女性 F）对人员舒适度的影响，进行了一项舒适度实验。测量人的舒适度的方法有很多种，因此，在此讨论中，假设对每个人员只进行一次舒适度测量。三个温度分别随机分配给九个可用环境室 (environmental chambers) 中的三个。室 (chambers) 是温度水平的实验单元，室设计是完全随机设计结构中的单向处理结构。 18 名男性和 18 名女性被随机分配到各个室，因此每个室都分配了两名男性和两名女性。人员性别的实验单元是人员，人员设计是随机区组设计中的单向处理结构，其中室是区组。在每个区组的每个性别水平上都有两次重复。室关于温度的分配和人员关于室的分配如图 5.24 所示。 将这些人员置于环境条件 3 小时后，测量他们的舒适度。可用于描述这些数据的均值模型为 \\[y_{ijkm}=\\mu_{ik}+c_{j(i)}+p_{m(ijk)}\\quad i=1,2,3,~j=1,2,3,~k=1,2,~m=1,2\\] 其中 \\[c_{j(i)}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{chamber}}^2)\\mathrm{~and~}p_{m(ijk)}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{person}}^2)\\] 效应模型为 \\[y_{ijkm}=\\mu+T_i+c_{j(i)}+S_k+(TS)_{ik}+p_{m(ijk)}\\] 其中 \\(\\mu_{ik}\\) 表示第 \\(i\\) 个温度和第 \\(k\\) 个性别的均值，\\(c_{j(i)}\\) 是分配给第 \\(i\\) 个温度的第 \\(j\\) 个腔室的随机效应，\\(p_{m(ijk)}\\) 表示分配给第 \\(j\\) 个温度的第 \\(k\\) 个腔室的第 \\(k\\) 个性别的第 \\(m\\) 个人的随机效应，\\(T_i,S_k,(TS)_{ik}\\) 分别表示温度、性别和温度与性别交互作用的效应。 图 5.24: 将人员和温度分配给室以进行简单的舒适性实验 这个实验涉及两个层次的嵌套。首先，室嵌套在温度内。其次，同性别的人嵌套在室内。本实验的方差分析表如表 5.42 所示。性别效应和温度与性别交互作用是人员间比较 (between-person comparisons)，因此使用人员误差项来进行这些均值之间的比较。室误差项用于在温度均值之间进行比较。 表 5.42: 简单的舒适度实验嵌套设计结构的方差分析表 x 5.6.5 示例 5.13：重复测量的多地点研究 典型的农业研究涉及在多个地点 (locations) 评估处理，且通常会随着时间的推移测量响应。本研究使用三个地点对四个苜蓿品种进行评估。苜蓿是一种在生长季节收获三次或三次以上的作物，因此数据集包含重复测量。在每个地点，该设计是一个随机完全区组设计结构中的单向处理结构，具有三次重复。图 5.25 显示了每个地点品种关于地块 (plots) 的分配情况。图 5.26 是每个地点的实验单元的图形。由于一个地点的所有地块都是同时收割 (cut) 或收获 (harvest) 的，因此同一地点的所有地块在收割之间都处于相同的环境条件下。因此，重复测量的是给定地点的整个实验，而不是单个地块。图 5.26 中的一列表示一个品种被应用和收获三次的实体 (entity)，是品种的实验单元。地块的一层 (layer) 代表受环境条件影响的实体，并且是收割水平的实验单元。切割水平在所有给定地点的地块上形成裂条区结构。单元格表示在一个收割时间收获的品种单元。 图 5.25: 将苜蓿品种分配给地块以进行多地点实验 图 5.26: 在一个地点显示实验单元，用于多地点研究 表 5.43: 重复测量多地点研究的方差分析表 x 可以通过忽略层来构建列的分析，这在每个地点的随机完全区组设计结构中提供了单向处理结构。因此，列误差是通过品种与区组交互作用来计算的，其中合并了所有地点 (pooled across locations)。可以通过忽略列来构建层的分析，这在随机完全区组设计结构中提供了一种单向处理结构（收割水平），其中地点是区组。层误差项是通过收割与地点交互作用来计算的。最后，单元格是收割与品种交互作用的单元，并且单元格误差项是这样计算的：收割与品种与区组交互作用，其中合并了所有地点，再加上嵌套于地点内的收割与区组交互作用。可用于描述每个单元格响应的模型是 \\[y_{ijkm}=\\mu+l_i+b_{j(i)}+V_k+(lV)_{ik}+(bV)_{jk(i)}+C_m+(lC)_{im}+(VC)_{km}+(lVC)_{ikm}+\\varepsilon_{ijkm}\\] 其中 \\[\\begin{aligned}&amp;l_i\\thicksim N(0,\\sigma_{\\mathrm{Loc}}^2),\\quad b_{j(i)}\\thicksim N(0,\\sigma_{blk(\\mathrm{Loc})}^2),\\quad(lV)_{ik}\\thicksim N(0,\\sigma_{V*\\mathrm{Loc}}^2),\\quad(bV)_{jk(i)}\\thicksim N(0,\\sigma_{V*Blk(\\mathrm{Loc})}^2),\\\\&amp;(lC)_{im}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{C^*Loc}}^2),\\quad(lVC)_{ikn}\\thicksim i.i.d.N(0,\\sigma_{V*C *\\text{Loc}}^2),\\quad\\varepsilon_{ijkn}\\thicksim i.i.d.N(0,\\sigma_{\\mathrm{cell}}^2)\\end{aligned}\\] 该模型的假设是，将地点和嵌套在地点内的区组视为随机效应（参见第 ?? 章）。因此，所有涉及地点或嵌套在地点内的区组的交互作用也都是随机效应。在每个地点的收割水平被视为重复测量：最先是第一次收割，其次是第二次收割，最后是第三次收割。由于切割水平不能随机分配给地点内的层，因此提供了重复测量。该模型的假设是各层之间相互独立且方差相等，但由于存在重复测量，因此使用更复杂的协方差结构可能更合适。有关重复测量设计的协方差结构建模的讨论，参见第 ?? 章和第 ?? 章。该模型的方差分析表如表 5.43 所示，其中期望均方是从关于随机效应的模型假设中获得的（参见第 ?? 章）。 5.7 结束语 在本章中，考虑了几个不同尺寸的实验单元的设计结构。这些设计也称为多水平设计，一些多水平设计称为分层设计。讨论的设计类型包括裂区设计、裂条区设计、嵌套设计、重复测量设计以及它们的变体和组合。本章讨论的设计可以组合成一些非常复杂的设计。在这种情况下，确定一个合适的模型来描述数据的关键在于识别实验单元的尺寸并为每个尺寸的实验单元确定处理结构和设计结构。几乎总是这样：给定尺寸的实验单元的设计结构将是四种基本设计结构之一，并且误差平方和将使用特定基本设计结构的过程进行计算。本章的重点在于识别这样的设计以及何时和如何使用它们。涉及多于一种尺寸的实验单元的设计分析将在第 ?? 章至第 ?? 章中介绍，其中将详细讨论有关模型的假设。有关多水平设计的进一步讨论和示例，请参阅 Milliken (2003a, b) 和 Milliken et al. (1998). 5.8 练习 "],["chap6.html", "第 6 章 模型的矩阵形式 6.1 基本符号 6.2 最小二乘估计 6.3 可估性和连通的设计 6.4 关于线性模型参数的检验假设 6.5 总体边际均值 6.6 结束语 6.7 练习", " 第 6 章 模型的矩阵形式 当使用不均衡 (unbalanced) 的固定效应模型、随机效应模型或混合效应模型时，求和符号变得非常费力，有时甚至几乎无法使用。这个问题可以通过使用模型的矩阵形式表达来解决。本章讨论了模型矩阵形式的构建，并描述了如何使用矩阵获得最小二乘估计、检验假设、计算最小二乘均值或总体边际均值以及构建置信区间。在 6.3 节中讨论了可估性 (estimability) 的概念。 6.1 基本符号 模型的矩阵形式可以表示为 \\[\\begin{equation} \\underset{n\\times1}{\\boldsymbol y}=\\underset{n × p}{\\vphantom{\\boldsymbol y}\\boldsymbol X} \\,\\,\\underset{p × 1}{\\vphantom{\\boldsymbol y}\\boldsymbol \\beta}+\\underset{n × 1}{\\vphantom{\\boldsymbol y}\\boldsymbol\\varepsilon} \\tag{6.1} \\end{equation}\\] 其中 \\(\\boldsymbol y\\) 表示 \\(n \\times 1\\) 观测向量，\\(\\boldsymbol X\\) 表示 \\(n \\times p\\) 已知常数矩阵，称为设计矩阵 (designed matrix)，\\(\\boldsymbol \\beta\\) 表示 \\(p \\times 1\\) 未知参数向量，\\(\\boldsymbol \\varepsilon\\) 表示 \\(n \\times 1\\) 未观测的误差向量。第 \\(i\\) 个观测值（\\(\\boldsymbol y\\) 的第 \\(i\\) 个元素）的模型具有以下形式 \\[\\begin{equation} y_i=\\beta_0+\\beta_1x_{i1}+\\beta_2x_{i2}+\\cdots+\\beta_{p-1}x_{ip-1}+\\varepsilon_i,\\quad i=1,2,\\ldots,n \\tag{6.2} \\end{equation}\\] 用于将模型 (6.2) 表示为矩阵模型 (6.1) 的向量和矩阵是 \\[\\begin{equation} \\boldsymbol{y}=\\begin{bmatrix}y_1\\\\y_2\\\\\\vdots\\\\y_n\\end{bmatrix},\\quad\\boldsymbol{X}=\\begin{bmatrix}1&amp;x_{11}&amp;x_{12}&amp;\\cdots&amp;x_{1p-1}\\\\1&amp;x_{21}&amp;x_{22}&amp;\\cdots&amp;x_{2p-1}\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\1&amp;x_{n1}&amp;x_{n2}&amp;\\cdots&amp;x_{np-1}\\end{bmatrix},\\quad\\boldsymbol{\\beta}=\\begin{bmatrix}\\beta_0\\\\\\beta_1\\\\\\beta_2\\\\\\vdots\\\\\\beta_{p-1}\\end{bmatrix},\\quad\\mathrm{and}\\quad\\boldsymbol{\\varepsilon}=\\begin{bmatrix}\\varepsilon_1\\\\\\varepsilon_2\\\\\\vdots\\\\\\varepsilon_n\\end{bmatrix} \\tag{6.3} \\end{equation}\\] 式 (6.3) 中的矩阵可用于表示多种模型类型，包括单向模型、双向模型、析因模型和部分析因模型等设计模型以及回归模型、协方差分析模型、随机模型等。通过指定 \\(\\boldsymbol X\\) 的适当元素以及 \\(\\boldsymbol \\beta\\) 和 \\(\\boldsymbol \\varepsilon\\) 的适当假设，可以构建效应模型、混合效应模型、裂区模型、重复测量模型和随机系数回归模型。以下各节介绍了各种实验情况下的一些矩阵模型。 6.1.1 简单线性回归模型 简单线性回归模型可以表示为 \\(y_i=\\beta_0+\\beta_1x_i+\\varepsilon_i,i=1,2,\\ldots,n\\) 并且可以用矩阵形式表示为 \\[\\begin{bmatrix}y_1\\\\y_2\\\\\\vdots\\\\y_n\\end{bmatrix}=\\begin{bmatrix}1&amp;x_1\\\\1&amp;x_2\\\\\\vdots&amp;\\vdots\\\\1&amp;x_n\\end{bmatrix}\\begin{bmatrix}{\\beta}_0\\\\{\\beta}_1\\end{bmatrix}+\\begin{bmatrix}{\\varepsilon}_1\\\\{\\varepsilon}_2\\\\\\vdots\\\\{\\varepsilon}_n\\end{bmatrix}\\] \\(\\boldsymbol X\\) 中的全 1 列对应于回归模型的截距 \\(\\boldsymbol \\beta_0\\)，\\(x_i\\) 列对应于回归模型的斜率。 6.1.2 单向处理结构模型 为了在完全随机设计结构中表示具有 \\(t\\) 个处理的单向处理结构的模型，其中第 \\(i\\) 个处理有 \\(n_i\\) 个观测结果，设自变量 \\(x_{ij}\\) 定义为 \\[x_{kij}=\\begin{cases}0&amp;\\text{ if the }ij\\text{th observation is not from the }k\\text{th treatment}\\\\1&amp;\\text{ if the }ij\\text{th observation is from the }k\\text{th treatment}&amp;\\end{cases}\\] 其中 \\(i=1,2,\\cdots,t\\)，\\(j=1,2,\\cdots,n_i\\). 变量 \\(x_{kij}\\) 被称为指示变量 (indicator variable)，因为当它的值为 1 时，它表明观测结果来自处理 k. 当它的值为 0 时，它表明观测结果不来自处理 k. 均值模型 (means model) 可表示为 \\(y_{ij}={\\mu}_1x_{1ij}+{\\mu}_2x_{2ij}+\\cdots+{\\mu}_tx_{tij}+{\\varepsilon}_{ij}\\)，其中 \\(i=1,2,\\cdots,t\\)，\\(j=1,2,\\cdots,n_i\\). 或者以矩阵表示法 \\[\\begin{bmatrix}{y}_{11}\\\\{y}_{12}\\\\\\vdots\\\\{y}_{1n_1}\\\\{y}_{22}\\\\\\vdots\\\\{y}_{2{n}_2}\\\\\\vdots\\\\{y}_{t1}\\\\\\vdots\\\\{y}_{t{n}_t}\\end{bmatrix}=\\begin{bmatrix}1&amp;0&amp;\\cdots&amp;0\\\\1&amp;0&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots\\\\1&amp;0&amp;\\cdots&amp;0\\\\0&amp;1&amp;\\cdots&amp;0\\\\0&amp;1&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots\\\\0&amp;1&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;1\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;1\\end{bmatrix}\\begin{bmatrix}\\mu_1\\\\\\mu_2\\\\\\vdots\\\\\\mu_t\\end{bmatrix}+\\boldsymbol \\varepsilon\\] 均值模型通常表示为 \\(y_{ij}=\\mu_i+\\varepsilon_{ij}\\)，其中 \\(i=1,2,\\cdots,t\\)，\\(j=1,2,\\cdots,n_i\\). 效应模型 (effect model) 可表示为 \\(y_{ij}=\\mu+\\tau_1x_{1ij}+\\tau_2x_{2ij}+\\cdots+\\tau_tx_{tij}+\\varepsilon_{ij}\\)，其中 \\(i=1,2,\\cdots,t\\)，\\(j=1,2,\\cdots,n_i\\). 或者以矩阵表示法 \\[\\begin{bmatrix}{y}_{11}\\\\{y}_{12}\\\\\\vdots\\\\{y}_{1{n}_1}\\\\{y}_{21}\\\\{y}_{22}\\\\\\vdots\\\\{y}_{2{n}_2}\\\\\\vdots\\\\{y}_{t1}\\\\\\vdots\\\\{y}_{t{n}_t}\\end{bmatrix}=\\begin{bmatrix}1&amp;1&amp;0&amp;\\cdots&amp;0\\\\1&amp;1&amp;0&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots\\\\1&amp;1&amp;0&amp;\\cdots&amp;0\\\\1&amp;0&amp;1&amp;\\cdots&amp;0\\\\1&amp;0&amp;1&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots\\\\1&amp;0&amp;1&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots&amp;\\vdots\\\\1&amp;0&amp;0&amp;\\cdots&amp;1\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\1&amp;0&amp;0&amp;\\cdots&amp;1\\end{bmatrix}\\begin{bmatrix}\\mu\\\\\\tau_1\\\\\\tau_2\\\\\\vdots\\\\\\tau_t\\end{bmatrix}+\\boldsymbol \\varepsilon \\] 效应模型通常表示为 \\(y_{ij}=\\mu+\\tau_i+\\varepsilon_{ij}\\)，其中 \\(i=1,2,\\cdots,t\\)，\\(j=1,2,\\cdots,n_i\\). 均值模型和效应模型之间的区别在于，效应模型的设计矩阵包含模型截距 \\(\\mu\\) 的全 1 列，而均值模型不包含全 1 列。 6.1.3 双向处理结构模型 在完全随机化设计结构中，对于具有 \\(t\\) 行处理和 \\(b\\) 列处理的双向处理结构，模型的一种形式为 \\[\\begin{equation} y_{ijk}=\\mu_{ij}+\\varepsilon_{ijk}\\quad i=1,2,\\ldots,t,j=1,2,\\ldots,b,\\mathrm{~and~}k=1,2,\\ldots,n_{ij} \\tag{6.4} \\end{equation}\\] 式子 (6.4) 中使用的模型称为均值模型，可以用矩阵形式表示为 \\[\\begin{bmatrix}y_{111}\\\\y_{112}\\\\\\vdots\\\\y_{11n_1}\\\\y_{121}\\\\\\vdots\\\\y_{12n_2}\\\\\\vdots\\\\y_{1b1}\\\\\\vdots\\\\y_{1bn_{1b}} \\\\y_{211}\\\\\\vdots\\\\y_{21n_{21}}\\\\\\vdots\\\\y_{tb1}\\\\\\vdots\\\\y_{tbn_{tb}} \\end{bmatrix}=\\begin{bmatrix} 1&amp;0&amp;\\cdots&amp;0&amp;0&amp;\\cdots&amp;0\\\\ 1&amp;0&amp;\\cdots&amp;0&amp;0&amp;\\cdots&amp;0\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 1&amp;0&amp;\\cdots&amp;0&amp;0&amp;\\cdots&amp;0\\\\ 0&amp;1&amp;\\cdots&amp;0&amp;0&amp;\\cdots&amp;0\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 0&amp;1&amp;\\cdots&amp;0&amp;0&amp;\\cdots&amp;0\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 0&amp;0&amp;\\cdots&amp;1&amp;0&amp;\\cdots&amp;0\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 0&amp;0&amp;\\cdots&amp;1&amp;0&amp;\\cdots&amp;0\\\\ 0&amp;0&amp;\\cdots&amp;0&amp;1&amp;\\cdots&amp;0\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 0&amp;0&amp;\\cdots&amp;0&amp;1&amp;\\cdots&amp;0\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 0&amp;0&amp;\\cdots&amp;0&amp;0&amp;\\cdots&amp;1\\\\ \\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots&amp;\\vdots&amp;\\cdots&amp;\\vdots\\\\ 0&amp;0&amp;\\cdots&amp;0&amp;0&amp;\\cdots&amp;1\\end{bmatrix} \\begin{bmatrix}\\mu_{11}\\\\\\mu_{12}\\\\\\vdots\\\\\\mu_{1b}\\\\\\mu_{21}\\\\\\vdots\\\\\\mu_{tb}\\end{bmatrix} + \\boldsymbol \\varepsilon \\] 双向效应模型可表示为 \\[\\begin{equation} y_{ijk}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij}+\\varepsilon_{ijk}\\quad i=1,2,\\ldots,t,j=1,2,\\ldots,b,k=1,2,\\ldots,n_{ij} \\tag{6.5} \\end{equation}\\] 双向效应模型的矩阵形式为 \\[ \\begin{bmatrix}y_{111}\\\\y_{112}\\\\\\vdots\\\\y_{11n_1}\\\\y_{121}\\\\\\vdots\\\\y_{12n_2}\\\\\\vdots\\\\y_{1b1}\\\\\\vdots\\\\y_{1bn_{1b}} \\\\y_{211}\\\\\\vdots\\\\y_{21n_{21}}\\\\\\vdots\\\\y_{tb1}\\\\\\vdots\\\\y_{tbn_{tb}} \\end{bmatrix}=\\begin{bmatrix} 1 &amp; 0 &amp; \\cdots &amp; 0 &amp; 0 &amp; \\cdots &amp; 0 \\\\ 1 &amp; 0 &amp; \\cdots &amp; 0 &amp; 0 &amp; \\cdots &amp; 0 \\\\ \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots \\\\ 1 &amp; 0 &amp; \\cdots &amp; 0 &amp; 0 &amp; \\cdots &amp; 0 \\\\ 0 &amp; 1 &amp; \\cdots &amp; 0 &amp; 0 &amp; \\cdots &amp; 0 \\\\ \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots \\\\ 0 &amp; 1 &amp; \\cdots &amp; 0 &amp; 0 &amp; \\cdots &amp; 0 \\\\ \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots \\\\ 0 &amp; 0 &amp; \\cdots &amp; 1 &amp; 0 &amp; \\cdots &amp; 0 \\\\ \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots \\\\ 0 &amp; 0 &amp; \\cdots &amp; 1 &amp; 0 &amp; \\cdots &amp; 0 \\\\ 0 &amp; 0 &amp; \\cdots &amp; 0 &amp; 1 &amp; \\cdots &amp; 0 \\\\ \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots \\\\ 0 &amp; 0 &amp; \\cdots &amp; 0 &amp; 1 &amp; \\cdots &amp; 0 \\\\ \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots \\\\ 0 &amp; 0 &amp; \\cdots &amp; 0 &amp; 0 &amp; \\cdots &amp; 1 \\\\ \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots &amp; \\vdots &amp; \\cdots &amp; \\vdots \\\\ 0 &amp; 0 &amp; \\cdots &amp; 0 &amp; 0 &amp; \\cdots &amp; 1 \\\\ \\end{bmatrix} \\begin{bmatrix}\\mu_{11}\\\\\\mu_{12}\\\\\\vdots\\\\\\mu_{1b}\\\\\\mu_{21}\\\\\\vdots\\\\\\mu_{tb}\\end{bmatrix}+ \\boldsymbol \\varepsilon \\] 本书强调与实验设计情境相对应的模型，而不是纯粹的回归情境。接下来的两个例子将展示如何从数据结构构建这样的模型。 6.1.4 示例 6.1：双向处理结构的均值模型 表 6.1 中的信息代表了一个完全随机设计结构中的双向处理结构的数据，其中有三行处理和三列处理，每个单元格有一个或两个观测值。表 6.1 中数据的均值模型的矩阵形式为： \\[\\begin{bmatrix}3\\\\6\\\\9\\\\10\\\\2\\\\5\\\\3\\\\8\\\\4\\\\2\\\\6\\end{bmatrix}=\\begin{bmatrix} 1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0\\\\ 0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0\\\\ 0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0\\\\ 0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0\\\\ 0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0\\\\ 0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1\\end{bmatrix}\\begin{bmatrix}\\mu_{11}\\\\\\mu_{12}\\\\\\mu_{13}\\\\\\mu_{21}\\\\\\mu_{22}\\\\\\mu_{23}\\\\\\mu_{31}\\\\\\mu_{32}\\\\\\mu_{33}\\end{bmatrix}+\\boldsymbol \\varepsilon\\] 表 6.1 中数据的效应模型的矩阵形式为 \\[ \\begin{bmatrix}3\\\\6\\\\9\\\\10\\\\2\\\\5\\\\3\\\\8\\\\4\\\\2\\\\6\\end{bmatrix}=\\begin{bmatrix} 1 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\end{bmatrix} \\begin{bmatrix} \\mu_1 \\\\ \\tau_1 \\\\ \\tau_2 \\\\ \\tau_3 \\\\ \\beta_1 \\\\ \\beta_2 \\\\ \\beta_3 \\\\ \\gamma_{11} \\\\ \\gamma_{12} \\\\ \\gamma_{13} \\\\ \\gamma_{21} \\\\ \\gamma_{22} \\\\ \\gamma_{23} \\\\ \\gamma_{31} \\\\ \\gamma_{32} \\\\ \\gamma_{33} \\end{bmatrix} +\\boldsymbol \\varepsilon \\] 或 \\[\\boldsymbol y=\\boldsymbol j\\boldsymbol\\mu+\\boldsymbol X_1\\boldsymbol \\tau+\\boldsymbol X_2\\boldsymbol\\beta+\\boldsymbol X_3\\boldsymbol \\gamma+\\boldsymbol\\varepsilon \\] 其中，\\(\\boldsymbol j\\) 是与上述设计矩阵的第一列对应的 11×1 向量，\\(\\boldsymbol X_1\\) 是与第 2-4 列对应的 11×3 矩阵，\\(\\boldsymbol X_2\\) 是与第 5-7 列对应的 11×3 矩阵，\\(\\boldsymbol X_3\\) 是与以上设计矩阵的最后九列对应的 11×9 矩阵。 表 6.1: CRD 结构中双向处理结构的数据 x 其他处理和设计结构的设计矩阵也是以类似的方式构建的。幸运的是，大多数用于拟合非均衡数据结构的软件都会使用上述类型的表示形式，并在模型中指定分类效应 (categorical effects) 时自动生成设计矩阵的必要列。 6.2 最小二乘估计 一旦模型以矩阵形式指定，分析的下一步是获得参数向量 \\(\\boldsymbol \\beta\\) 的最小二乘估计 (least squares estimator)。最小二乘法可用于估计模型的参数。要使用此方法，假设模型可以表示为 \\[\\begin{equation} y_i=f(x_i;\\boldsymbol{\\beta})+\\varepsilon_i\\quad\\mathrm{~for~}i=1,2,\\ldots,n \\tag{6.6} \\end{equation}\\] 其中 \\(y_i=f(x_i;\\boldsymbol{\\beta})\\) 是由 \\(x_i\\) 表示的设计变量向量的函数，且依赖于参数向量 \\(\\boldsymbol \\beta\\). \\(\\boldsymbol \\beta\\) 的最小二乘估计通常用 \\(\\hat {\\boldsymbol \\beta}\\) 表示，它能最小化平方和 \\[\\begin{equation} SS(\\boldsymbol{\\beta})=\\sum_{i=1}^n[y_i-f(x_i;\\boldsymbol{\\beta})]^2 \\tag{6.7} \\end{equation}\\] 如果除了假设模型的形式为 (6.6) 之外，还额外假设 \\(\\varepsilon_i \\sim i.i.d\\,N(0,\\sigma^2),i＝1,2,\\cdots,n\\)，则 \\(\\boldsymbol \\beta\\) 的最小二乘估计也是最大似然估计 (maximum likelihood estimator). 例如，完全随机设计中单向处理结构的均值模型的模型函数为 \\[f(x_{ij};\\boldsymbol{\\beta})=\\mu_i,\\quad i=1,2,\\ldots,t;\\quad j=1,2,\\ldots,n_i\\] \\(\\mu_i\\) 的最小二乘估计记作 \\(\\hat \\mu_1,\\cdots,\\hat \\mu_t\\)，它们是这样的值，即能够最小化 \\[\\begin{aligned}SS({\\mu})=\\sum_{i=1}^t\\sum_{j=1}^{n_j}(y_{ij}-\\mu_i)^2\\end{aligned}\\] 完全随机设计中双向处理结构的均值模型的模型函数为 \\[f(x_{ijk};\\boldsymbol{\\beta})=\\mu_{ij}\\quad i=1,2,\\ldots,t;j=1,2,\\ldots,b;k=1,2,\\ldots,n_{ij}\\] \\(\\mu_{ij}\\) 的最小二乘估计记作 \\(\\hat \\mu_{11},\\cdots,\\hat \\mu_{tb}\\)，它们是这样的值，即能够最小化 \\[\\begin{aligned}SS({\\mu})=\\sum_{i=1}^{t}\\sum_{j=1}^{b}\\sum_{k=1}^{n_{ij}}(y_{ijk}-\\mu_{ij})^2\\end{aligned}\\] 完全随机设计中双向处理结构的效应模型的模型函数为 \\[f(x_{ijk};\\boldsymbol{\\beta})=\\mu+\\tau_i+{\\beta}_j+\\gamma_{ij},\\quad i=1,2,\\ldots,t;j=1,2,\\ldots,b;k=1,2,\\ldots,n_{ij}\\] \\(\\mu,\\tau_i,\\beta_j,\\gamma_{ij}\\) 的最小二乘估计是通过最小化下式来获得的 \\[SS(\\mu,\\tau_i,\\beta_j,\\gamma_{ij})=\\sum_{i=1}^t\\sum_{j=1}^b\\sum_{k=1}^{n_{ij}}(y_{ijk}-\\mu-\\tau_i-\\beta_j-\\gamma_{ij})^2\\] 通常，模型可以写成矩阵形式，如式 (6.1) 中的矩阵形式，并且 \\(\\boldsymbol \\beta\\) 的最小二乘估计是这样的 \\(\\hat {\\boldsymbol \\beta}\\) ，即能最小化平方和 \\[\\begin{equation} SS(\\boldsymbol\\beta)=(\\boldsymbol y-\\boldsymbol X \\boldsymbol\\beta)^{\\prime}(\\boldsymbol y-\\boldsymbol X \\boldsymbol\\beta) \\tag{6.8} \\end{equation}\\] 6.2.1 最小二乘方程组 矩阵表示和计算可用于确定能使残差平方和最小化的 \\(\\boldsymbol\\beta\\) 值。当进行最小化时，会得到一组 \\(\\hat {\\boldsymbol \\beta}\\) 必须满足的方程，这些方程被称为模型的最小二乘方程组 (least squares equations) 或正规方程组 (normal equations). 对于模型 (6.1)，正规方程组由下式给出： \\[\\begin{equation} \\boldsymbol X^{\\prime} \\boldsymbol X\\hat{\\boldsymbol{\\beta}}=\\boldsymbol X^{\\prime}\\boldsymbol{y} \\tag{6.9} \\end{equation}\\] 任何满足正规方程组的向量 \\(\\hat {\\boldsymbol \\beta}\\) 都是 \\(\\boldsymbol\\beta\\) 的最小二乘估计。对于一些模型，最小二乘估计不必是唯一的。为了帮助读者更加熟悉正规方程组，下面提供了第 6.1 节中讨论的模型的正规方程组。 单向均值模型的正规方程组为 \\[\\begin{bmatrix}n_1&amp;0&amp;\\cdots&amp;0\\\\0&amp;n_2&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;n_t\\end{bmatrix}\\begin{bmatrix}\\hat{\\mu}_1\\\\\\hat{\\mu}_2\\\\\\vdots\\\\\\hat{\\mu}_t\\end{bmatrix}=\\begin{bmatrix}y_{1\\cdot}\\\\y_{2\\cdot}\\\\\\vdots\\\\y_{t\\cdot}\\end{bmatrix}\\mathrm{~where~}y_{i\\cdot}=\\sum_{i=1}^{n_i}y_{ij}\\] 单向效应模型的正规方程组为 \\[\\begin{bmatrix}n_{\\cdot}&amp;n_1&amp;n_2&amp;\\cdots&amp;n_t\\\\n_1&amp;n_1&amp;0&amp;\\cdots&amp;0\\\\n_2&amp;0&amp;n_2&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\n_t&amp;0&amp;0&amp;\\cdots&amp;n_t\\end{bmatrix}\\begin{bmatrix}\\hat{\\mu}\\\\\\hat{\\tau}_1\\\\\\hat \\tau_2\\\\\\vdots\\\\\\hat{\\tau}_t\\end{bmatrix}=\\begin{bmatrix}y_{\\cdot\\cdot}\\\\y_{1\\cdot}\\\\y_{2\\cdot}\\\\\\vdots\\\\y_{t\\cdot}\\end{bmatrix}\\quad\\mathrm{where~}y_{\\cdot\\cdot}=\\sum_{i=1}^t\\sum_{j=1}^{n_i}y_{ij}\\quad\\mathrm{and}\\quad n_{\\cdot}=\\sum_{i=1}^tn_t\\] 使用表 6.1 中数据的双向均值模型的正规方程组为 \\[\\begin{bmatrix}2&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;0&amp;2&amp;0&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0\\\\0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0\\\\0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1\\end{bmatrix}\\begin{bmatrix}\\hat{\\mu}_{11}\\\\\\hat{\\mu}_{12}\\\\\\hat{\\mu}_{13}\\\\\\hat{\\mu}_{21}\\\\\\hat{\\mu}_{22}\\\\\\hat{\\mu}_{23}\\\\\\hat{\\mu}_{31}\\\\\\hat{\\mu}_{32}\\\\\\hat{\\mu}_{33}\\end{bmatrix}=\\begin{bmatrix}y_{11\\cdot}\\\\y_{12\\cdot}\\\\y_{13\\cdot}\\\\y_{21\\cdot}\\\\y_{22\\cdot}\\\\y_{23\\cdot}\\\\y_{31\\cdot}\\\\y_{32\\cdot}\\\\y_{33\\cdot}\\end{bmatrix}\\] 其中 \\[y_{ij\\cdot}=\\sum_{k=1}^{n_{ij}}y_{ijk}\\] 与表 6.1 中的数据相对应的双向效应模型的正规方程组为 $$$$ \\[\\begin{bmatrix} 11&amp;4&amp;4&amp;3&amp;4&amp;4&amp;3&amp;2&amp;1&amp;1&amp;1&amp;2&amp;1&amp;1&amp;1&amp;1\\\\ 4&amp;4&amp;0&amp;0&amp;2&amp;1&amp;1&amp;2&amp;1&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 4&amp;0&amp;4&amp;0&amp;1&amp;2&amp;1&amp;0&amp;0&amp;0&amp;1&amp;2&amp;1&amp;0&amp;0&amp;0\\\\ 3&amp;0&amp;0&amp;3&amp;1&amp;1&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;1&amp;1\\\\ 4&amp;2&amp;1&amp;1&amp;4&amp;0&amp;0&amp;2&amp;0&amp;0&amp;1&amp;0&amp;0&amp;1&amp;0&amp;0\\\\ 4&amp;1&amp;2&amp;1&amp;0&amp;4&amp;0&amp;0&amp;1&amp;0&amp;0&amp;2&amp;0&amp;0&amp;1&amp;0\\\\ 3&amp;1&amp;1&amp;1&amp;0&amp;0&amp;3&amp;0&amp;0&amp;1&amp;0&amp;0&amp;1&amp;0&amp;0&amp;1\\\\ 2&amp;2&amp;0&amp;0&amp;2&amp;0&amp;0&amp;2&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 1&amp;1&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 1&amp;1&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0\\\\ 2&amp;0&amp;2&amp;0&amp;0&amp;2&amp;0&amp;0&amp;0&amp;0&amp;0&amp;2&amp;0&amp;0&amp;0&amp;0\\\\ 1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0\\\\ 1&amp;0&amp;0&amp;1&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0\\\\ 1&amp;0&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;0\\\\ 1&amp;0&amp;0&amp;1&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1\\end{bmatrix} \\begin{bmatrix}\\hat\\mu\\\\\\hat\\tau_{1}\\\\\\hat{\\tau}_2\\\\\\hat\\tau_{3}\\\\\\hat\\beta_{1}\\\\\\hat\\beta_{2}\\\\\\hat\\beta_{3}\\\\\\hat\\gamma_{11}\\\\\\hat\\gamma_{12}\\\\\\hat\\gamma_{13}\\\\\\hat\\gamma_{21}\\\\\\hat\\gamma_{22}\\\\\\hat\\gamma_{23}\\\\\\hat\\gamma_{31}\\\\\\hat\\gamma_{32}\\\\\\hat\\gamma_{33}\\end{bmatrix}=\\begin{bmatrix}y_{\\cdot\\cdot\\cdot}\\\\y_{1\\cdot\\cdot}\\\\y_{2\\cdot\\cdot}\\\\y_{3\\cdot\\cdot}\\\\y_{\\cdot1\\cdot}\\\\y_{\\cdot2\\cdot}\\\\y_{\\cdot3\\cdot}\\\\y_{11\\cdot}\\\\y_{12\\cdot}\\\\y_{13\\cdot}\\\\y_{21\\cdot}\\\\y_{22\\cdot}\\\\y_{23\\cdot}\\\\y_{31\\cdot}\\\\y_{32\\cdot}\\\\y_{33\\cdot}\\end{bmatrix}\\] 其中 \\[y_{\\cdot\\cdot\\cdot}=\\sum_{i=1}^t\\sum_{j=1}^b\\sum_{k=1}^{n_{ij}}y_{ijk},\\quad y_{i\\cdot\\cdot}=\\sum_{j=1}^b\\sum_{k=1}^{n_{ij}}y_{ijk},\\quad y_{\\cdot j\\cdot}=\\sum_{i=1}^t\\sum_{k=1}^{n_{ij}}y_{ijk},\\quad\\mathrm{and}\\quad y_{ij\\cdot}=\\sum_{k=1}^{n_{ij}}y_{ijk}\\] 当 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 满秩时 (Graybill, 1976)，即 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 是非奇异的，则 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 的逆存在，并且 \\({\\boldsymbol \\beta}\\) 的最小二乘估计（方程 (6.9) 中 \\(\\hat {\\boldsymbol \\beta}\\) 的解）为 \\[\\begin{equation} \\hat {\\boldsymbol \\beta}=(\\boldsymbol X^\\prime \\boldsymbol X)^{-1}\\boldsymbol{X^{\\prime}y} \\tag{6.10} \\end{equation}\\] 当 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 是满秩时，最小二乘估计是唯一的。计算 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 的逆通常不是一项容易的任务。计算软件开发的最重要方面之一是，现在统计学家可以求超大型矩阵的逆，这在计算机出现之前是不可能的。然而，当 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 中存在某些模式时，可以利用这些模式更容易地求逆。对于单向均值模型和双向均值模型的正规方程组，\\(\\boldsymbol X^\\prime \\boldsymbol X\\) 是对角矩阵（所有对角元非零，非对角元为零），并且 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 的逆是通过简单地将每个对角元替换为其倒数来获得的。因此，单向均值模型的 \\(\\mu_i\\) 的最小二乘估计为 \\[\\begin{bmatrix}\\hat{{\\mu}}_1\\\\\\hat{{\\mu}}_2\\\\\\vdots\\\\\\hat{{\\mu}}_t\\end{bmatrix}=\\begin{bmatrix}\\frac1{n_1}&amp;0&amp;\\cdots&amp;0\\\\0&amp;\\frac1{n_2}&amp;\\cdots&amp;0\\\\\\vdots&amp;\\vdots&amp;\\ddots&amp;\\vdots\\\\0&amp;0&amp;\\cdots&amp;\\frac1{n_t}\\end{bmatrix}\\begin{bmatrix}y_{1\\cdot}\\\\y_{2\\cdot}\\\\\\vdots\\\\y_{t\\cdot}\\end{bmatrix}\\] 或等价地 \\[\\hat{\\mu}_i=\\frac{y_{i\\cdot}}{n_i}=\\bar{y}_{i\\cdot}\\quad i=1,2,\\ldots,t\\] 类似地，双向均值模型 \\(\\mu_{ij}\\) 的最小二乘估计为 \\[\\hat{\\mu}_{ij}=\\frac{y_{ij\\cdot}}{n_{ij}}=\\bar{y}_{ij\\cdot}\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,b\\] 与均值模型的正规方程组不同，效应模型的 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 是奇异的，并且 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 的逆不存在。在这种情况下，正规方程组有许多解（实际上是无穷多个最小二乘解）。效应模型被称为过度指定 (overspecified models) 或奇异模型 (sigular models)，因为与从收集的数据中可以唯一估计的参数相比，这些模型具有更多的参数。通常使用过度指定的模型，并且有几种方法可以求解其相应的正规方程组。以下讨论涉及完全随机设计结构中的双向处理结构，但类似的技术也可用于其他因素效应模型。 理论上，广义逆可用于求解关于 \\({\\boldsymbol \\beta}\\) 的正规方程组 (Graybill, 1976)，但求解过度指定模型的正规方程组的常用方法是对模型中的参数进行限制（这实际上产生了 g-inverse 解）。对模型参数施加限制可以通过多种方式实现，这里考虑其中两种方式。 6.2.2 零和限制 一种常见的技术是要求某些参数的和等于零。这种方法自方差分析之初就被用来求解正规方程组。对于使用表 6.1 中数据的双向效应模型，零和限制 (Sum-to-Zero Restrictions) 为： \\[\\begin{aligned} &amp;\\begin{aligned}\\sum_{i=1}^3\\tau_i=0,\\sum_{j=1}^3\\beta_j=0,\\sum_{i=1}^3\\gamma_{i1}=0,\\sum_{i=1}^3\\gamma_{i2}=0,\\sum_{i=1}^3\\gamma_{i3}=0\\end{aligned} \\\\ &amp;\\sum_{j=1}^3\\gamma_{1j}=0,\\sum_{j=1}^3\\gamma_{2j}=0,\\,\\text{and }\\sum_{j=1}^3\\gamma_{3j}=0 \\end{aligned}\\] 接下来，通过在考虑限制的情况下根据其他参数求解一些参数，然后将表达式替换回模型，将这些限制合并到模型中。例如，可以替换的参数有 \\[\\begin{aligned}\\tau_3&amp;=-\\tau_1-\\tau_2,\\quad\\beta_3=-\\beta_1-\\beta_2,\\quad\\gamma_{13}=-\\gamma_{11}-\\gamma_{12}\\\\\\gamma_{23}&amp;=-\\gamma_{21}-\\gamma_{22},\\quad\\gamma_{31}=-\\gamma_{11}-\\gamma_{21},\\quad\\gamma_{32}=-\\gamma_{12}-\\gamma_{22}\\\\\\gamma_{33}&amp;=-\\gamma_{13}-\\gamma_{23}=-\\gamma_{31}-\\gamma_{32}=\\gamma_{11}+\\gamma_{12}+\\gamma_{21}+\\gamma_{22}\\end{aligned}\\] 因此，替换模型中的 \\(\\tau_3,~\\beta_3,~\\gamma_{13},~\\gamma_{23},~\\gamma_{33},~\\gamma_{31}\\) 和 \\(\\gamma_{32}\\)，以获得重新参数化的模型 \\[ \\begin{bmatrix}y_{111}\\\\y_{112}\\\\y_{121}\\\\y_{131}\\\\y_{211}\\\\y_{221}\\\\y_{222}\\\\y_{231}\\\\y_{311}\\\\y_{321}\\\\y_{331}\\end{bmatrix}= \\begin{bmatrix}1&amp;1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0\\\\1&amp;1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0\\\\1&amp;1&amp;0&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0\\\\1&amp;1&amp;0&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0\\\\1&amp;1&amp;0&amp;-1&amp;-1&amp;-1&amp;-1&amp;0&amp;0\\\\1&amp;0&amp;1&amp;1&amp;0&amp;0&amp;0&amp;1&amp;0\\\\1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;1\\\\1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;1\\\\1&amp;0&amp;1&amp;-1&amp;-1&amp;0&amp;0&amp;-1&amp;-1\\\\1&amp;-1&amp;-1&amp;0&amp;0&amp;-1&amp;0&amp;-1&amp;0\\\\1&amp;-1&amp;-1&amp;0&amp;1&amp;0&amp;-1&amp;0&amp;-1\\\\1&amp;-1&amp;-1&amp;-1&amp;-1&amp;1&amp;1&amp;1&amp;1\\end{bmatrix}\\begin{bmatrix}\\mu^*\\\\\\tau_1^*\\\\\\tau_2^*\\\\\\beta_1^*\\\\\\beta_2^*\\\\\\gamma_{11}^*\\\\\\gamma_{12}^*\\\\\\gamma_{21}^*\\\\\\gamma_{22}^*\\end{bmatrix}+\\boldsymbol{\\varepsilon} \\] 其表示为 \\[\\begin{aligned}\\boldsymbol{y}=\\boldsymbol{X}^*\\boldsymbol{\\beta}^*+\\boldsymbol{\\varepsilon}\\end{aligned}\\] 表 6.1 中数据对应的零和限制正态方程的解为 \\(\\hat{\\boldsymbol{\\beta^*}}=(\\boldsymbol X^{*\\prime} \\boldsymbol X^*)^{-1}\\boldsymbol X^{*\\prime}\\boldsymbol{y}\\). 可得到 \\[\\begin{aligned} \\hat{\\boldsymbol \\beta}^{*\\prime}&amp;=[\\hat{\\mu}^*,\\hat{\\tau}_1^*,\\hat{\\tau}_2^*,\\hat{\\beta}_1^*,\\hat{\\beta}_2^*,\\hat{\\gamma}_{11}^*,\\hat{\\gamma}_{12}^*,\\hat{\\gamma}_{21}^*,\\hat{\\gamma}_{22}^*] \\\\ &amp;=[5.500,2.333,-0.833,-2.000,-0.5000,-1.333,1.667,-0.667,-0.167] \\end{aligned}\\] \\(\\boldsymbol \\beta\\) 剩余元素的估计从如下限制中获得： \\[\\begin{aligned} \\hat{{\\tau}}_3^*&amp;=-\\hat{{\\tau}}_1^*-\\hat{{\\tau}}_2^*=-1.500,\\quad\\hat{{\\beta}}_3^*=-\\hat{{\\beta}}_1^*-\\hat{{\\beta}}_2^*=2.500 \\\\ \\hat{\\gamma}_{13}^*&amp;=-\\hat{\\gamma}_{11}^*-\\hat{\\gamma}_{12}^*=-0.333,\\quad\\hat{\\gamma}_{23}^*=-\\hat{\\gamma}_{21}^*-\\hat{\\gamma}_{22}^*=0.833 \\\\ \\hat{\\gamma}_{31}^*&amp;=-\\hat{\\gamma}_{11}^*-\\hat{\\gamma}_{21}^*=2.000,\\quad\\hat{\\gamma}_{32}^*=-\\hat{\\gamma}_{12}^*-\\hat{\\gamma}_{22}^*=-1.500 \\\\ \\hat{\\gamma}_{33}^*&amp;=\\hat{\\gamma}_{11}^*+\\hat{\\gamma}_{12}^*+\\hat{\\gamma}_{21}^*+\\hat{\\gamma}_{22}^*=-0.500 \\end{aligned}\\] 关于均值模型参数 \\(\\mu_{ij}\\)，参数 \\(\\mu^*,t_i^*,\\beta_{j}^*,\\gamma^*_{ij}\\) 可以通过如下定义以满足零和限制 \\[\\mu^*=\\bar{\\mu}_{\\cdot\\cdot},\\quad\\tau_i^*=\\bar{\\mu}_{i\\cdot}-\\bar{\\mu}_{\\cdot\\cdot\\cdot},\\quad\\beta_j^*=\\bar{\\mu}_{\\cdot j}-\\bar{\\mu}_{\\cdot\\cdot\\cdot},\\quad\\mathrm{and}\\quad\\gamma_{ij}^*=\\mu_{ij}-\\bar{\\mu}_{i\\cdot}-\\bar{\\mu}_{\\cdot j}+\\bar{\\mu}_{\\cdot\\cdot}\\] 6.2.3 置零限制 另一种常用于求解双向效应模型正规方程组的重新参数化技术为，将每组中的最后一个参数设置为零 (Set-to-Zero)（选择最后一个参数是为了方便；也可以选择第一个、第二个或任何其他参数）。对于表 6.1 中数据的双向效应模型，限制为 \\[\\tau_3=0,\\beta_3=0,\\gamma_{13}=0,\\gamma_{23}=0,\\gamma_{33}=0,\\gamma_{31}=0,\\mathrm{~and~}\\gamma_{23}=0\\] 通过将上述限制条件纳入双向效应模型，得到重新参数化后的模型为 \\[\\begin{bmatrix}y_{111}\\\\y_{112}\\\\y_{121}\\\\y_{131}\\\\y_{211}\\\\y_{221}\\\\y_{222}\\\\y_{231}\\\\y_{311}\\\\y_{321}\\\\y_{331}\\end{bmatrix}=\\begin{bmatrix}1&amp;1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0\\\\1&amp;1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0\\\\1&amp;1&amp;0&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0\\\\1&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\1&amp;0&amp;1&amp;1&amp;0&amp;0&amp;0&amp;1&amp;0\\\\1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;1\\\\1&amp;0&amp;1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;1\\\\1&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\\\1&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0\\\\1&amp;0&amp;0&amp;0&amp;1&amp;0&amp;0&amp;0&amp;0\\\\1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\end{bmatrix}\\begin{bmatrix}\\mu^+\\\\\\tau_1^+\\\\\\tau_2^+\\\\\\beta_1^+\\\\\\beta_2^+\\\\\\gamma_{11}^+\\\\\\gamma_{12}^+\\\\\\gamma_{21}^+\\\\\\gamma_{22}^+\\end{bmatrix}+\\boldsymbol\\varepsilon \\] 可以表示为 \\(\\boldsymbol{y}=\\boldsymbol{X}^+\\boldsymbol{\\beta}^++\\boldsymbol{\\varepsilon}\\)。矩阵 \\(\\boldsymbol{X}^+\\) 是通过从双向效应模型完整设计矩阵 \\(\\boldsymbol X\\) 中删除与 \\(\\tau_3,\\beta_3,\\gamma_{31},\\gamma_{32},\\gamma_{33},\\gamma_{13},\\gamma_{23}\\) 对应的列而获得的。关于重新参数化模型设计矩阵的求解过程，置零限制比零和限制简单得多。置零限制对应的正规方程组的解为 \\[\\hat{\\boldsymbol{\\beta}}^+=(\\boldsymbol X^{+\\prime}\\boldsymbol X^{+})^{-1}\\boldsymbol X^{+\\prime}\\boldsymbol y\\] 可以得到 \\[\\begin{aligned} \\hat{\\boldsymbol{\\beta}}^{+\\prime}&amp; =[\\hat{{\\mu}}^+,\\hat{{\\tau}}_1^+,\\hat{{\\tau}}_2^+,\\hat{{\\beta}}_1^+,\\hat{{\\beta}}_2^+,\\hat{{\\gamma}}_{11}^+,\\hat{{\\gamma}}_{12}^+,\\hat{{\\gamma}}_{21}^+,\\hat{{\\gamma}}_{22}^+] \\\\ &amp;=[6.0,4.0,2.0,-2.0,-4.0,-3.5,3.0,-4.0,0.0] \\end{aligned}\\] 其余参数的估计是零，因为它们是由置零限制指定的，即， \\[\\hat{\\tau}_3^+=\\hat{\\beta}_3^+=\\hat{\\gamma}_{31}^+=\\hat{\\gamma}_{32}^+=\\hat{\\gamma}_{33}^+=\\hat{\\gamma}_{13}^+=\\hat{\\gamma}_{23}^+=0\\] 为了将参数置零限制条件与均值模型参数 \\(\\mu_{ij}\\) 关联起来，定义 \\(\\mu^+,t_i^+,\\beta_j^+,\\gamma_{ij}^+\\) \\[\\begin{aligned}\\mu^+=\\mu_{tb},&amp;\\,\\,\\tau_i^+=\\mu_{ib}-\\mu_{tb},\\,\\,\\beta_j^+=\\mu_{tj}-\\mu_{tb}\\,\\mathrm{~and~}\\,\\gamma_{ij}^+=\\mu_{ij}-\\mu_{tj}-\\mu_{ib}+\\mu_{tb}\\end{aligned}\\] 当 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 的不满秩时（即 \\(\\boldsymbol X^\\prime \\boldsymbol X\\) 是奇异的），正规方程组有多个可能的解。这是因为模型参数过多，即模型中的参数（在双向效应模型的情况下为 16 个）比可用数据（有 9 个数据单元，因此最多可以估计 9 个参数）能够唯一确定的参数要多。可以唯一估计的参数数量可被称为基本 (essential) 参数数量。为了应对过度参数化模型以及非唯一的最小二乘解，必须考虑可估性的概念，这是 6.3 节的主题。下一个例子将给出单向处理结构效应模型的两种可能的解。 6.2.4 示例 6.2：单向处理结构 表 6.2: 第 6.2.4 节中均值和效应模型的单向处理结构数据 x 这是一个单向处理结构的示例，在完全随机设计结构中具有四种处理。数据如表 6.2 所示。 \\(\\boldsymbol X^*\\) 矩阵是通过使用零和限制重新参数化模型来构造的；即，假设 \\(\\tau_1^*+\\tau_2^*+\\tau_3^*+\\tau_4^*=0\\). 由此产生的设计矩阵为 \\[\\boldsymbol X^*=\\begin{bmatrix} 1 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 1 &amp; 0 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 0 &amp; 1 &amp; 0 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 \\\\ 1 &amp; 0 &amp; 0 &amp; 1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ 1 &amp; -1 &amp; -1 &amp; -1 \\\\ \\end{bmatrix}\\] 零和限制模型的正规方程组为 \\[\\begin{bmatrix}26&amp;-1&amp;-3&amp;-2\\\\-1&amp;15&amp;8&amp;8\\\\-3&amp;8&amp;13&amp;8\\\\-2&amp;8&amp;8&amp;14\\end{bmatrix}\\begin{bmatrix}\\hat{\\mu}^*\\\\\\hat{\\tau}_1^*\\\\\\hat{\\tau}_2^*\\\\\\hat{\\tau}_3^*\\end{bmatrix}=\\begin{bmatrix}55.1\\\\-0.9\\\\-2.5\\\\-5.9\\end{bmatrix}\\] 零和限制模型的正规方程组相应最小二乘解为 \\[\\hat{\\boldsymbol{\\beta}}^*=\\begin{bmatrix}\\hat{{\\mu}}^*\\\\\\hat{{\\tau}}_1^*\\\\\\hat{{\\tau}}_2^*\\\\\\hat{{\\tau}}_3^*\\end{bmatrix}=\\begin{bmatrix}2.1510\\\\0.0204\\\\0.5690\\\\-0.4510\\end{bmatrix}\\] 以及 \\(\\hat{\\tau}_4^*=-\\hat{\\tau}_1^*-\\hat{\\tau}_2^*-\\hat{\\tau}_3^*=-0.1384\\). 就均值模型参数而言，零和限制参数可表示为 \\[\\mu^*=\\bar{\\mu}_{\\cdot},\\quad\\tau_1^*=\\mu_1-\\bar{\\mu}_{\\cdot},\\quad\\tau_2^*=\\mu_2-\\bar{\\mu}_{\\cdot},\\quad\\tau_3^*=\\mu_3-\\bar{\\mu}_{\\cdot},\\quad\\tau_4^*=\\mu_4-\\bar{\\mu}_{\\cdot}\\] 具有 \\(\\tau_ 4 ^+ = 0\\) 的置零限制设计矩阵 \\(\\boldsymbol X^+\\) 是通过在 \\(\\boldsymbol X^*\\) 中用“0”替换“-1”来构建的。置零限制模型的正规方程组为 \\[\\begin{bmatrix}26&amp;7&amp;5&amp;6\\\\7&amp;7&amp;0&amp;0\\\\5&amp;0&amp;5&amp;0\\\\6&amp;0&amp;0&amp;6\\end{bmatrix}\\begin{bmatrix}\\hat{{\\mu}}^+\\\\\\hat{{\\tau}}_1^+\\\\\\hat{{\\tau}}_2^+\\\\\\hat{{\\tau}}_3^+\\end{bmatrix}=\\begin{bmatrix}55.1\\\\15.2\\\\13.6\\\\10.2\\end{bmatrix}\\] 置零限制模型的最小二乘解为 \\[\\boldsymbol{\\hat{\\beta}}^+=\\begin{bmatrix}{\\hat{\\mu}}^+\\\\{\\hat{\\tau}}_1^+\\\\{\\hat{\\tau}}_2^+\\\\{\\hat{\\tau}}_3^+\\end{bmatrix}=\\begin{bmatrix}2.0125\\\\0.1589\\\\0.7075\\\\-0.3125\\end{bmatrix}\\] 且 \\(\\tau_ 4 ^+ = 0\\). 就均值模型参数而言，置零限制参数可表示为 \\[\\mu^+=\\mu_4,\\quad\\tau_1^+=\\mu_1-\\mu_4,\\quad\\tau_2^+=\\mu_2-\\mu_4,\\quad\\tau_3^+=\\mu_3-\\mu_4,\\quad\\tau_4^+=\\mu_4-\\mu_4=0\\] 需要估计的最后一个参数是总体方差 \\(\\sigma^2\\). 基于 \\(\\boldsymbol \\beta\\) 最小二乘解的 \\(\\sigma^2\\) 的估计为 \\[\\begin{align} \\hat{\\sigma}^2&amp; =\\frac{1}{n-r}(\\boldsymbol y-X\\hat{\\boldsymbol \\beta})&#39;(\\boldsymbol y-\\boldsymbol X\\hat{\\boldsymbol \\beta}) \\\\ &amp;=\\frac1{n-r}\\sum_{i=1}^n{(y_i-\\hat{\\beta}_0-\\hat{\\beta}_1x_{i1}-\\hat{\\beta}_2x_{i2}-\\cdots-\\hat{\\beta}_{p-1}x_{ip-1})^2} \\tag{6.11} \\end{align}\\] 其中 \\(r=\\operatorname{rank}(\\boldsymbol X)\\). 如果假设误差独立分布，且前四阶矩等于正态分布的前四阶矩，那么 \\(\\hat \\sigma^2\\) 是 \\(\\sigma^2\\) 的最佳二次无偏估计 (best quadratic unbiased estimate). 如果误差也服从正态分布，那么 \\(\\hat \\sigma^2\\) 是 \\(\\sigma^2\\) 的最佳无偏估计 (best unbiased estimate)，且 \\((n - r)\\hat \\sigma^2 /\\sigma^2\\) 的抽样分布是自由度为 \\(n - r\\) 的中心卡方分布。 6.3 可估性和连通的设计 当过度指定模型或非满秩模型用于实验情况时，存在许多不同的最小二乘解（实际上有无限多个解）。如果两名研究人员分析上述两个数据集，一个使用零和限制，另一个使用置零限制，他们可能会得出不同的结论。对于上一节中的双向示例，\\(\\tau_2^* = -0.833, \\tau_2^+ = 2.000\\)；因此，一位研究人员可能会说 \\(\\tau_2\\) 很可能为负，而另一位研究人员可能会说 \\(\\tau_2\\) 很可能为正——而这两种说法都是错误的。 6.3.1 可估函数 由于两位研究人员都在分析相同的数据集，因此他们似乎应该只考虑对两个重新参数化模型具有相同估计的参数或参数的函数。这种参数函数称为参数的可估函数 (estimable functions of the parameters). 定义 6.1 ♦ 参数或参数的函数 \\(f(\\boldsymbol \\beta)\\) 是可估的，当且仅当参数或参数的函数的估计值对于最小二乘解的选择是不变的；也就是说，无论使用正规方程组的哪个解，估计值都是相同的。 如果两位研究人员对参数的可估函数进行了估计，即使他们采用了两种不同的最小二乘解，他们也会得到相同的估计值。因此，他们对于参数的可估函数会得出相同的结论。对于矩阵模型，\\(\\boldsymbol \\beta\\) 的线性可估函数表现为参数向量的线性组合，如 \\(\\boldsymbol a^\\prime \\boldsymbol \\beta\\)，其中 \\(\\boldsymbol a^\\prime\\) 是一个 p × 1 的常数向量。线性函数 \\(\\boldsymbol a^\\prime \\boldsymbol \\beta\\) 是可估的，当且仅当存在向量 \\(r\\)，使得 \\(\\boldsymbol a =\\boldsymbol X ^\\prime \\boldsymbol X r\\). 每个形如 \\(\\boldsymbol x^\\prime_i \\boldsymbol \\beta\\) 的函数都是可估的，其中 \\(\\boldsymbol x^\\prime_i\\) 是 \\(\\boldsymbol X\\) 的第 \\(i\\) 行。此外，\\(\\boldsymbol x^\\prime_i \\boldsymbol \\beta\\) 的任何线性组合都是可估的函数。考虑 6.2 节中单向示例的两个解。由于每个参数 \\(\\mu,\\tau_1,\\tau_2,\\tau_3,\\tau_4\\) 都有两个不同的解，因此这些参数被认为是不可估的 (nonestimable). 但是，通过计算每种方法关于 \\(\\mu + \\tau_i\\) 的估计值，可以发现 \\[\\hat{\\mu}^*+\\hat{\\tau}_i^*=\\hat{\\mu}^++\\hat{\\tau}_i^+,\\quad i=1,2,3,4\\] 证明 \\(\\mu + \\tau_i\\) 是参数的可估函数。 \\(\\tau_i\\) 的所有对比，如差异 \\({\\tau}_1{-\\tau}_2{,\\tau}_1{-\\tau}_3{,\\tau}_2{-\\tau}_3\\) 或者 \\(\\sum_{i=1}^tc_i\\tau_i\\) 其中 \\(\\sum_{i=1}^tc_i=0\\)，可证明是单向模型的可估函数。 对于双向效应模型，一些可估函数为 \\(\\mu+\\tau_i+\\beta_j+\\gamma_{ij},\\quad\\gamma_{ij}-\\gamma_{ij^\\prime}-\\gamma_{i^\\prime j}+\\gamma_{i^\\prime j^\\prime},\\quad\\beta_j-\\beta_j+\\bar{\\gamma}_{\\cdot j}-\\bar{\\gamma}_{\\cdot j^\\prime},\\quad\\tau_i-\\tau_i+\\bar{\\gamma}_{i\\cdot}-\\bar{\\gamma}_{i^\\prime\\cdot}\\) 可估函数在第 ?? 章进行了更详细的讨论。这里需记住的重点是可估函数的定义。从数据集中进行推断时，必须只考虑可估的参数函数，因为它们是参数的函数，其估计值不依赖于选择的最小二乘解。SAS®-GLM 和 SAS®-Mixed 都会检查所请求估计的参数或参数函数是否确实是可估的。如果参数或参数函数不可估，则不提供估计值。 6.3.2 连通性 与可估函数相关的另一个概念是双向处理结构的连通性 (connectedness). 如果可以假设行处理和列处理的水平之间没有交互作用，那么可以将处理组合平均值建模为 \\[\\begin{equation} \\mu_{ij}=\\mu+\\tau_i+\\beta_j,\\quad i=1,2,\\ldots,b,j=1,2,\\ldots,t \\tag{6.12} \\end{equation}\\] 如果双向处理结构中的数据以这样的方式出现在双向单元格中，即对于模型 (6.12) 中的所有 \\(j\\ne j^\\prime\\) 以及 \\(i\\ne i^\\prime\\)，\\(\\beta_j-\\beta_{j^\\prime}\\) 和 \\(\\tau_i-\\tau_{i^\\prime}\\) 都是可估的，则该双向处理结构被称为连通的 (connected)。图 6.1 中的安排 I 是一个连通的实验，而安排 II 不是。例如，使用安排 I， \\[\\beta_1-\\beta_2=(\\mu+\\tau_1+\\beta_1)-(\\mu+\\tau_1+\\beta_5)+(\\mu+\\tau_2+\\beta_5)-(\\mu+\\tau_2+\\beta_2)\\] 我们可以得到单元格均值的线性组合，因此 \\(\\beta_1-\\beta_2\\) 是可估的。对于安排 II，没有这样的单元格均值的线性组合可以得到 \\(\\beta_1-\\beta_2\\)，因此 \\(\\beta_1-\\beta_2\\) 是不可估的。下一节将讨论关于参数的可估函数的假设检验。 图 6.1: 连通和非连通的双向处理结构 6.4 关于线性模型参数的检验假设 对于线性模型中参数线性函数的假设检验，有多种方法可以开发适当的统计量。这里使用的方法用矩阵表示法，相当于条件误差原理（第 1 章）和似然比统计量。讨论仅限于检验关于参数的可估函数的假设。特别是，考虑检验假设 \\[\\begin{equation} H_0{:\\boldsymbol{H\\beta}}=\\boldsymbol{h}\\mathrm{~vs~}H_a{:\\boldsymbol{H\\beta}}\\neq\\boldsymbol{h} \\tag{6.13} \\end{equation}\\] 其中线性组合 \\(\\boldsymbol{H\\beta}\\) 是 \\(\\boldsymbol \\beta\\) 的可估函数，\\(\\boldsymbol H\\) 是秩为 \\(q\\) 的 q × p矩阵（即，\\(\\boldsymbol H\\) 的所有行是线性无关的）。相应的检验统计量为 \\[\\begin{equation} F_c=\\frac{SSH_0/q}{\\hat{\\sigma}^2} \\tag{6.14} \\end{equation}\\] 其中 \\(\\hat \\sigma^2\\) 由式 (6.11) 给出，并且 \\[\\begin{equation} SSH_0=(\\boldsymbol H\\hat{\\boldsymbol{\\beta}}-\\boldsymbol h)^{\\prime}\\left[\\boldsymbol H(\\boldsymbol X^{\\prime}\\boldsymbol X)^{-}\\boldsymbol H^{\\prime}\\right]^{-1}(\\boldsymbol H\\hat{\\boldsymbol{\\beta}}-\\boldsymbol h) \\tag{6.15} \\end{equation}\\] 这被称为因偏离零假设而产生的平方和 (sum of squares due to deviations from the null hypothesis)（记号 “\\((\\boldsymbol X^{\\prime}\\boldsymbol X)^{-}\\)” 表示矩阵 \\(\\boldsymbol X^{\\prime}\\boldsymbol X\\) 的广义逆，Graybill, 1976）。在误差向量元素为 \\(i.i.d.\\,N(0,\\sigma^2)\\) 的假设下，\\(F_c\\) 服从自由度为 \\(q,n-r\\) 的 \\(F\\) 分布。 式 (6.13) 中的假设总是可以用重新参数模型 \\(\\boldsymbol{y}=\\boldsymbol{X}^*\\boldsymbol{\\beta}^*+\\boldsymbol \\varepsilon\\) 来等价地表述为下式，其中 \\(\\boldsymbol X^{*\\prime}\\boldsymbol X^*\\) 是非奇异的 \\[H_0{:}H^*\\boldsymbol{\\beta}^*=\\boldsymbol{h}^*\\mathrm{~vs~}H_a{:}H^*\\boldsymbol{\\beta}^*\\neq\\boldsymbol{h}^*\\] 则式 (6.15) 的 \\(SSH_0\\) 可计算为 \\[SSH_0=(\\boldsymbol H^*\\hat{\\boldsymbol{\\beta}}^*-\\boldsymbol{h}^*)^{\\prime}[\\boldsymbol H^*(\\boldsymbol X^{*\\prime}\\boldsymbol X^*)^{-1}(\\boldsymbol{H}^*{}^{\\prime}\\hat{\\boldsymbol{\\beta}}^*-\\boldsymbol{h}^*)]\\] 对于单向模型，在原始效应模型中检验假设 \\[\\begin{aligned}H_0\\colon\\tau_1=\\tau_2=\\cdots=\\tau_t\\text{ vs }H_a\\colon\\tau_i\\neq\\tau_{i&#39;}\\quad\\text{for some }i\\neq i&#39;\\end{aligned}\\] 相当于在置零重新参数化模型中检验 \\[\\begin{aligned}H_0\\colon\\tau_1^*=\\tau_2^*=&amp;\\cdots=\\tau_{t-1}^*=0\\text{ vs }H_a{:}\\tau_i^*\\neq0\\quad\\text{for some }i\\leq t\\text{ -1}\\end{aligned}\\] 对于示例 6.2 关于 \\(\\boldsymbol \\beta^*\\) 的零假设是 \\[H_0{:}\\begin{bmatrix}0&amp;1&amp;0&amp;0\\\\0&amp;0&amp;1&amp;0\\\\0&amp;0&amp;0&amp;1\\end{bmatrix}\\begin{bmatrix}\\mu^*\\\\\\tau_1^*\\\\\\tau_2^*\\\\\\tau_3^*\\end{bmatrix}=0\\quad\\mathrm{or}\\quad \\boldsymbol H^*\\boldsymbol \\beta^*=0\\] 偏离 \\(H_0\\) 而产生的平方和为 \\[SSH_0=(\\hat{\\tau}_1^*\\quad\\hat{\\tau}_1^*\\quad\\hat{\\tau}_1^*)\\,\\boldsymbol{Z}^{-1}\\begin{bmatrix}\\hat{\\tau}_1^*\\\\\\hat{\\tau}_2^*\\\\\\hat{\\tau}_3^*\\end{bmatrix}\\] 其中 \\(\\boldsymbol{Z}=\\boldsymbol{H}^*(\\boldsymbol{X}^*\\boldsymbol{&#39;}\\boldsymbol{X}^*)^{-1}\\boldsymbol{H}^*\\boldsymbol{&#39;}\\). 这是矩阵 \\((\\boldsymbol{X}^*\\boldsymbol{&#39;}\\boldsymbol{X}^*)^{-1}\\) 中与 \\(\\tau_1,\\tau_2,\\tau_3)\\) 相关的行和列的部分。 可估函数 \\(\\boldsymbol a^\\prime \\boldsymbol \\beta\\) 的一个 \\((1-\\alpha)100\\%\\) 置信区间为 \\[\\boldsymbol a^{\\prime}\\hat{\\boldsymbol \\beta}-[t_{\\alpha/2,n-p}]S_{\\boldsymbol a^{\\prime}\\hat{\\boldsymbol \\beta}}\\leq a^{\\prime}\\boldsymbol{\\beta}\\leq a^{\\prime}\\hat{\\beta}+[t_{\\alpha/2,n-p}]S_{\\boldsymbol a^{\\prime}\\hat{\\boldsymbol \\beta}}\\] 其中 \\(S_{\\boldsymbol a&#39;\\boldsymbol{\\beta}}^2=\\hat{\\sigma}^2\\boldsymbol{a&#39;}(\\boldsymbol{X&#39;}\\boldsymbol{X})^{-1}\\boldsymbol{a}\\). 通过使用第 3 章中讨论的多重比较程序，可以构造关于几个可估函数的同时置信区间 (simultaneous confidence intervals). 6.5 总体边际均值 在通过方差分析对交叉分类数据集进行分析后，实验者通常对估计特定效应或单元格均值感兴趣。总体边际均值 (population marginal means) 被定义为在特定类别上平均化的参数线性组合，就好像每个单元格中都有一个观测值一样 (Searle et al., 1980). 如果每个单元格中至少有一个观测值，那么所有的总体边际均值都是可估的，而如果某些单元格为空，则它们不一定可估。这个定义不依赖于单元格中的样本量。如果数据代表单元格的比例抽样，那么实验者可能希望考虑单元格均值的加权平均值，其中权重由样本量给出（参见第 ?? 章）。或者，可能需要使用其他加权方案来对各个单元格进行平均。本节末尾提供了一个示例，以演示不同的可能性。 对于完全随机设计的单向处理结构，第 \\(i\\) 个处理的总体边际平均值为 \\(\\mu+\\tau_i=\\mu_i\\)，并由下式估计 \\[\\widehat{\\mu+\\tau_i}=\\hat{\\mu}+\\hat{\\tau_i}\\] 其中 \\(\\hat \\mu,\\hat \\tau_i\\) 是从正规方程组的任何解得到的。这些估计值被称为总体边际均值估计 (estimated population marginal means). 对于完全随机设计中的双向处理结构，第 \\((i,j)\\) 个单元格的总体边际平均值为 \\(\\begin{aligned}\\mu_{ij}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij}\\end{aligned}\\). 第 \\(i\\) 行的总体边际均值是该行中 \\(\\mu_{ij}\\) 的平均值，或者 \\[\\bar{\\mu}_{i\\cdot}=\\sum_{j=1}^b\\frac{\\mu_{ij}}b=\\mu+\\tau_i+\\bar{\\beta}_{\\cdot}+\\bar{\\gamma}_{i\\cdot}\\] 第 \\(j\\) 列的总体边际均值是该列中 \\(\\mu_{ij}\\) 的平均值，或者 \\[\\bar{{\\mu}}_{\\cdot j}=\\sum_{i=1}^t\\frac{{\\mu}_{ij}}t={\\mu}+\\bar{{\\tau}}_{\\cdot}+{\\beta}_j+\\bar{{\\gamma}}_{\\cdot j}\\] 总体边际均值估计分别为 \\[\\begin{aligned} \\hat{{\\mu}}_{ij} &amp;=\\hat{\\mu}+\\hat{\\tau}_i+\\hat{\\beta}_j+\\hat{\\gamma}_{ij}, \\\\ \\hat{\\bar{{\\mu}}}_{i\\cdot} &amp;=\\hat{\\mu}+\\hat{\\tau}_i+\\sum_{j=1}^b\\frac{\\hat{\\beta}_j}b+\\sum_{j=1}^b\\frac{\\hat{\\gamma}_{ij}}b,\\\\ \\hat{\\bar{{\\mu}}}_{\\cdot j}&amp;=\\hat{{\\mu}}+\\sum_{i=1}^t\\frac{\\hat{{\\tau}}_i}t+\\hat{{\\beta}}_j+\\sum_{i=1}^t\\frac{\\hat{{\\gamma}}_{ij}}t \\end{aligned}\\] 这些估计对于任何可能的最小二乘解都是唯一的 \\[\\hat{\\mu},\\hat{\\tau}_1,\\hat{\\tau}_2,\\ldots,\\hat{\\tau}_t,\\hat{\\beta}_1,\\hat{\\beta}_2,\\ldots,\\hat{\\beta}_b,\\hat{\\gamma}_{11},\\hat{\\gamma}_{12},\\ldots,\\hat{\\gamma}_{tb}\\] 根据零和限制模型，表 6.1 中双向示例的总体边际平均值 \\(\\hat{\\bar\\mu}_{1\\cdot}\\) 的估计为 \\[\\begin{aligned} \\hat{\\bar{\\mu}}_{1\\cdot}&amp; =\\hat{\\mu}^*+\\hat{\\tau}_1^*+\\frac{\\hat{\\beta}_1^*+\\hat{\\beta}_2^*+\\hat{\\beta}_3^*}3+\\frac{\\hat{\\gamma}_{11}^*+\\hat{\\gamma}_{12}^*+\\hat{\\gamma}_{13}^*}3 \\\\ &amp;=5.500+2.333+\\frac{-2.000-0.500+2.500}3+\\frac{-1.333+1.667-0.333}3 \\\\ &amp;=7.833 \\end{aligned}\\] 当按预期使用置零限制的最小二乘解时，可以获得与 \\(\\hat{\\bar\\mu}_{1\\cdot}\\) 相同的值，因为 \\({\\bar\\mu}_{1\\cdot}\\) 在这个例子中是可估的。 当没有空单元格时，所有的总体边际均值都是可估的。如果有空单元格，那么任何涉及一个或多个缺失单元格的总体边际均值都是不可估的。例如，如果 \\((2,2)\\) 单元格在 2×2 处理结构中缺失，则没有关于 \\(\\mu_{22}\\) 的信息，因此 \\(\\mu_{22}\\) 是不可估的。第 2 列的总体边际均值为 \\[\\bar{\\mu}_{\\cdot 2}=\\frac{\\mu_{12}+\\mu_{22}}2\\] 由于 \\(\\bar{\\mu}_{\\cdot 2}\\) 依赖于 \\(\\mu_{22}\\)，因此 \\(\\bar{\\mu}_{\\cdot 2}\\) 是不可估的（\\(\\bar{\\mu}_{2\\cdot }\\) 也不可估）。 任何可估的总体边际均值都可以表示为重新参数化模型参数向量元素的线性组合；也就是说，对于 \\(\\boldsymbol a\\) 的适当选择，总体边际均值可以表示为 \\(\\boldsymbol a^\\prime\\boldsymbol \\beta^*\\). 总体边际均值估计的方差为 \\[\\mathrm{Var}(\\boldsymbol a^{\\prime}\\hat{\\boldsymbol{\\beta}^*})=\\sigma^2 \\boldsymbol a^{\\prime}(\\boldsymbol X^{*\\prime}\\boldsymbol X^*)^{-1}\\boldsymbol a\\] 且 \\(\\boldsymbol a^\\prime\\boldsymbol \\beta^*\\) 的标准误估计为 \\[\\widehat{s.e.}(\\boldsymbol a^{\\prime}\\hat{\\boldsymbol \\beta}^*)=\\hat{\\sigma}\\sqrt{\\boldsymbol a^{\\prime}(\\boldsymbol X^{*\\prime} \\boldsymbol X^*)^{-1}\\boldsymbol a}\\] 对于置零限制的单向模型，总体边际均值估计为 \\[\\widehat{\\mu+\\tau_i}=\\hat{\\mu}^*+\\hat{\\tau}_i^*,\\quad i=1,2,\\ldots,t-1\\] 且 \\[\\widehat{{\\mu}+{\\tau}_t}=\\hat{{\\mu}}^*\\] 这些总体边际均值估计的方差为 \\[\\mathrm{Var}(\\widehat{\\mu+\\tau_i})=\\mathrm{Var}(\\hat{\\mu}^*)+2\\mathrm{Cov}(\\hat{\\mu}^*,\\hat{\\tau}_i^*)+\\mathrm{Var}(\\hat{\\tau}_i^*)\\quad i=1,2,\\ldots,t-1\\] 且 \\[\\mathrm{Var}(\\widehat{\\mu+\\tau_t})=\\mathrm{Var}(\\hat{\\mu}^*)\\] 表 6.3: 双向处理结构的平均绩点数据 x 表 6.3 中的数据是一所学校学生样本的平均绩点 (GPA)，学生按学年和性别进行分类。双向模型 \\[y_{ijk}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij}+\\varepsilon_{ijk}\\quad i=1,2,3,4,\\quad j=1,2,\\quad k=1,2,\\ldots,n_{ij}\\] 用于描述数据，其中 \\(y_{ijk}\\) 是 GPA 值，\\(\\tau_i\\) 是第 \\(i\\) 年的效应，\\(\\beta_j\\) 是第 \\(j\\) 个性别的效应，\\(\\gamma_{ij}\\) 是交互作用效应。参数的置零最小二乘解如表 6.4 所示。对于那些置零的参数，标准误估计为零。第 \\(1\\) 学年和女性的单元格均值估计为 \\[\\hat{\\mu}_{1f}=\\hat{\\mu}+\\hat{\\tau}_1+\\hat{\\beta}_f+\\hat{\\gamma}_{1f}=3.333-0.133-0.033+0.205=3.372\\] 其余单元格均值可类似计算，如表 6.6 所示。表 6.6 和 6.7 提供了边际年份和边际性别的均值估计。 表 6.4: 双向处理结构中 GPA 数据的最小二乘解 x 表 6.5: 单元格均值及标准误估计 x 表 6.6: 跨性别水平的年份原始均值、最小二乘均值和加权平均值 x 表 6.7: 跨年份水平的女性和男性平均原始均值、最小二乘均值和加权平均值 x 原始均值 (raw measn) 是各个单元格均值的加权平均值，使用单元格中的观测数量作为权重。例如，第 1 年的原始均值或未调整的均值 (unadjusted mean) 计算为 \\[\\hat{\\bar{\\mu}}_{1\\cdot}=\\frac{7^*3.371+5^*3.200}{7+5}=3.300\\] 年份和性别效应的最小二乘均值 (least square means) 是相应单元格均值的未加权平均值，第 1 年的最小二乘均值为 \\[\\hat{\\bar{\\mu}}_{1\\cdot}=\\frac{3.371+3.200}2=3.286\\] 表 6.8: 平均成绩研究中的学生在班级中的分布 x 在论述边际年份或边际性别效应时，人们可能想要使用原始均值（根据观察到的单元格大小进行加权）或最小二乘均值（每个单元格均值具有相同的权重，就好像单元格大小相同一样）。对于设计的实验，最小二乘均值可能是人们感兴趣的均值，因为您可能设计了一个每个单元格中观测数量相等的实验，因此，即使某些数据可能缺失，提供假设单元格大小相等的边际均值估计也是一个合理的解决方案。但是，如果数据来自观察性研究，则未加权的均值可能不是人们感兴趣的边际均值。如果数据来自总体的简单随机样本，那么单元格大小可能反映了总体的比例成员结构 (proportional membership structure). 如果情况确实如此，那么原始均值或按样本量加权的均值就是感兴趣的边际均值。但如果单元格中的样本量不代表总体结构，那么最小二乘均值和原始均值都不是感兴趣的指标。当总体中的某些部分因设计或偶然原因被过度采样或采样不足时，就会出现这种现象。当已知总体结构，即每个单元格的总体比例已知时，通过使用已知的总体比例作为权重，可以获得感兴趣的边际均值。例如，假设研究每年中男性和女性的比例如表 6.8 所示。使用权重估计的第 1 年的边际均值为： \\[\\hat{\\tilde{\\mu}}_{1\\cdot}=\\frac{11^*3.371+22^*3.200}{33}=3.257\\] 使用权重对女性所有年份的边际均值估计为 \\[\\hat{\\tilde{\\mu}}_{\\cdot f}=\\frac{11^*3.371+12^*3.180+10^*3.475+8^*3.300}{41}=3.327\\] 使用权重对男性所有年份的边际均值估计为 \\[\\hat{\\tilde{\\mu}}_{\\cdot m}=\\frac{22^*3.200+14^*3.300+13^*3.267+10^*3.333}{59}=3.261\\] 计算几种调整的均值并从中选择你喜欢的值并不是问题，但有必要尽可能准确地指定总体结构中的比例，然后使用这些权重计算的边际平均估计。这可以通过允许使用 estimate 语句的软件包来完成，其中提供了所需边际均值的估计和标准误的估计。表 6.9 包含使用 SAS-GLM 程序的代码，以表 6.8 中的比例作为权重提供边际均值的估计。 表 6.9: 带 estimate 语句的SAS®-GLM代码，使用表 6.8 中的权重提供性别和年份水平的总体边际均值估计 x 6.6 结束语 本章仅供对理论背景感兴趣的人阅读，介绍了最小二乘估计程序，并讨论了可估性的重要概念。还讨论了总体边际均值的定义和估计。本章为那些想开发供自己使用的统计软件的人提供了通用公式。 6.7 练习 "],["chap7.html", "第 7 章 均衡双向处理结构 7.1 模型定义和假设 7.2 参数估计 7.3 交互作用及它们的重要性 7.4 主效应 7.5 计算机分析 7.6 结束语 7.7 练习", " 第 7 章 均衡双向处理结构 第 4 章和第 5 章讨论了如何分析实验的设计结构。本章将讨论分析实验的处理结构的方法。特别是，本章将重点分析双向交叉分类的处理结构。假设存在两组处理 \\(T_1,T_2,\\cdots,T_t\\) 和 \\(B_1,B_2,\\cdots,B_b\\). 每个 \\(T\\) 处理要与每个 \\(B\\) 处理结合，并分配给一个实验单元。为方便起见，假设实验单元完全随机地分配给处理组合。或者，假设从大量实验单元中随机抽取了一个样本，并且可以根据 \\(T_1,T_2,\\cdots,T_t\\) 和 \\(B_1,B_2,\\cdots,B_b\\) 的值将样本中的实验单元分配给不同的类别。在这两种情况下，在交叉分类的处理结构中，对总共 \\(bt\\) 个总体进行了抽样。 分析实验的处理结构和设计结构通常是独立进行的，除非是区组设计和重复测量设计，以及本书后面章节中考虑的这些设计的变体。因此，无论实验单元是分组为完全区组、均衡的不完全区组、拉丁方还是其他分组方式，处理结构的分析对于大多数标准设计来说都是相似的，几乎没有区别。由于对 \\(bt\\) 个总体进行了抽样，因此在检验等处理均值的假设时，平方和的自由度为 \\(bt-1\\)，即假设 \\(\\mu_{11}=\\mu_{12}=\\cdots=\\mu_{tb}\\). 本章考虑了处理平方和的不同划分，以检验实验者通常感兴趣的不同类型的假设。 7.1 模型定义和假设 7.1.1 均值模型 均值模型 (means model) 定义为 \\[\\begin{equation} Y_{ijk}=\\mu_{ij}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,b,\\quad k=1,2,\\ldots,n \\tag{7.1} \\end{equation}\\] 其中假设 \\(\\varepsilon_{ijk}\\sim i.i.d.N(0,\\sigma^2),i=1,2,\\ldots,t,j=1,2,\\ldots,b,k=1,2,\\ldots,n\\)，且当处理组合 \\((T_i,B_j)\\) 被分配到随机选择的实验单元时，\\(\\mu_{ij}\\) 是预期的响应。 7.1.2 效应模型 具有双向处理结构的实验中另一个常见模型称为效应模型 (effects model)，其由式 (7.1) 定义，且 \\(\\mu_{ij}\\) 替换为 \\[\\begin{equation} \\mu_{ij}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij},\\quad i=1,2,\\ldots,t,j=1,2,\\ldots,b \\tag{7.2} \\end{equation}\\] 从哲学角度看，效应模型在直觉上很有吸引力，因为它可能是基于这样的假设：\\(\\mu\\) 代表某种总体平均效应，\\(\\tau_i\\) 代表将 \\(T_i\\) 分配给实验单元后对均值的效应，\\(\\beta_j\\) 代表将 \\(B_j\\) 分配给实验单元后的效应，而 \\(\\gamma_{ij}\\) 代表同时使用 \\(T_i\\) 和 \\(B_j\\) 时可能对实验单元产生的任何额外的正面或负面效应。然而，如第 6 章所指出的，效应模型存在一些可估性问题。下面将讨论这两种模型。 7.2 参数估计 在大多数情况下，\\(\\sigma^2\\) 的估计仅来自对实验设计结构的分析。然而，在某些情况下，实验者可能能够对 \\(\\mu_{ij}\\) 或处理效果做出某些假设，这些假设可能会提供一些关于 \\(\\sigma^2\\) 的额外信息。例如，如果实验者知道 \\(\\mu_{11}=\\mu_{12}\\)，那么可以将来自均值为 \\(\\mu_{11}\\) 和 \\(\\mu_{12}\\) 的总体的样本组合起来，以提供用于估计 \\(\\sigma^2\\) 的额外自由度。在这种情况下，相应的单自由度平方和由 \\(n(\\bar{y}_{11\\cdot}-\\bar{y}_{12\\cdot})^2/2\\) 给出。 大多数实验者不会倾向于相信 \\(\\mu_{11}=\\mu_{12}\\)，但还有其他可能合适的信念 (beliefs). 其中一个信念是，两组处理的效应是加性的 (additive). 也就是说，两组处理不会发生交互 (interact). 如果这是真的，那么额外的信息将可用于估计 \\(\\sigma^2\\). 如果将 \\(bt\\) 种组合视为 \\(bt\\) 个不同的处理，则第 1 章至第 3 章中针对单向处理结构提供的所有讨论都适用于双向处理结构；也就是说，比如 \\([\\mu_{11},\\mu_{12},\\ldots,\\mu_{1b},\\ldots,\\mu_{t1},\\mu_{t2},\\ldots,\\mu_{tb}]=[\\mu_1,\\mu_{2},\\ldots,\\mu_{tb}]\\). 因此，均值模型中参数的最佳估计为 \\[\\hat{\\mu}_{ij}=\\frac1n\\sum_{k=1}^ny_{ijk}=\\bar{y}_{ij\\cdot},\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,b\\] 以及 \\[\\hat{\\sigma}^2=\\frac1{N-bt}\\sum_{ijk}(y_{ijk}-\\bar{y}_{ij\\cdot})^2\\] 其中 \\(N=nbt\\). \\(\\hat \\mu_{ij}\\) 的抽样分布为 \\(N(\\mu_{ij},\\sigma^2/n)\\)，其中 \\(i=1,2\\cdots,t,\\,j=1,2,\\cdots,b\\). 且 \\((N-bt)\\hat{\\sigma}^2/\\sigma^2\\) 的抽样分布为 \\(\\chi^2(N^-bt)\\). 另外，\\(\\hat{\\mu}_{11},\\hat{\\mu}_{12},\\ldots,\\hat{\\mu}_{tb}\\) 和 \\(\\sigma^2\\) 有独立的概率分布。 大多数情况下，实验者想要回答以下问题： \\(T\\) 处理如何影响响应？ \\(B\\) 处理如何影响响应？ 7.3 交互作用及它们的重要性 为了很好地回答上述问题，实验者必须首先确定这两组处理是否发生交互。交互作用假设 (interaction hypothesis) 可以用几种等效的方式来表述。下面给出了其中一些。 \\(H_0\\colon{{\\mu}}_{ij}-\\mu_{ij}=\\mu_{i&#39;j}-\\mu_{i&#39;j&#39;}\\) 对于所有的 \\(i\\ne i&#39;\\) 和 \\(j\\ne j&#39;\\) \\(H_0\\colon\\mu_{ij}-\\mu_{i&#39;j}=\\mu_{ij&#39;}-\\mu_{i&#39;j&#39;}\\) 对于所有的 \\(i\\ne i&#39;\\) 和 \\(j\\ne j&#39;\\) \\(H_0\\colon{\\mu_{ij}-\\mu_{i&#39;j}-\\mu_{ij&#39;}+\\mu_{i&#39;j&#39;}=0}\\) 对于所有的 \\(i\\ne i&#39;\\) 和 \\(j\\ne j&#39;\\) \\(H_0\\colon\\mu_{ij}=\\mu+\\tau_i+\\beta_j\\) 对于所有的 \\(i\\) 和 \\(j\\) 以及一些参数集 \\({\\mu},{\\tau}_1,{\\tau}_2,...,{\\tau}_t,{\\beta}_1,{\\beta}_2,\\cdots,{\\beta}_b\\) 1-4 中的每一个都意味着两组处理效应之间没有交互作用。对 1 的解释是，任何一对 B 处理之间的差异都是相同的，无论它们与哪种 T 处理相结合。类似地，对 2 的解释是，任何一对 T 处理之间的差异都是相同的，无论它们与哪种 B 处理相结合。1 和 2 在代数上都等价于 3，3 通常被称为所有可能的二乘二表格差异的集合 (the set of all possible two by two table differences). 对 4 的解释是，这两组处理的效应是加性的。如果 1-4 中的任何一个是真的，那么说明 T 处理和 B 处理之间没有相互作用。 如果两组处理不发生交互，则一组处理的效应可以如此进行最佳比较：对另一组处理的效应进行平均之后。这样的比较是最佳的，是因为平均化增加了比较两个或多个处理效应的统计功效，或者等价地，平均化对效应差异给出了尽可能短的置信区间。如果两组处理发生交互，那么一组处理效应之间的差异将依赖于与它们结合的第二组处理的水平，这会使实验分析稍微复杂一些。 7.4 主效应 如果实验者得出结论，这两组处理没有交互作用，那么关于主效应 (main effects) 的假设就可以进行检验。这些假设可以写成： \\[\\begin{aligned}H_{01}\\colon\\bar{\\mu}_{1\\cdot}=\\bar{\\mu}_{2\\cdot}=\\cdots=\\bar{\\mu}_{t\\cdot}\\quad\\text{and}\\quad H_{02}\\colon\\bar{\\mu}_{\\cdot1}=\\bar{\\mu}_{\\cdot2}=\\cdots=\\bar{\\mu}_{\\cdot b}\\end{aligned}\\] 即使实验中存在交互作用，上述两个假设仍然可以检验。然而，这两种情况对检验结果的解释将截然不同。 7.5 计算机分析 大多数统计分析包都会自动给出前两节中描述的两个主效应假设和交互作用假设的检验，前提是指定了以下形式的模型 \\[y=T\\mathrm{~}B\\mathrm{~}T\\times B\\] 大多还具有一个选项，允许用户通过使用第 3 章中讨论的一个或多个多重比较程序来相互比较主效应均值。大多数软件包还允许用户指定和检验用户自己选择的对比。如果确定两组处理发生交互，则实验者可能想要比较所有 \\(bt\\) 个处理组合两两之间的差异。如果所使用的统计包无法进行此类比较，则可以手动完成此操作。或者，如果统计分析包不允许对 \\(T\\times B\\) 单元格均值进行多重比较，通常可以通过一些技巧使其能够完成。为此，可以在数据文件中包含一个新的识别变量，使该新变量具有 \\(bt\\) 个不同的值，对应 \\(bt\\) 个处理组合。这个新变量可用于重新分析数据，作为单因素处理结构，从而得出双向单元格均值的多重比较。实验者可能还感兴趣于如何对多重检验进行调整，如第 3 章所述。 7.6 结束语 当处理以双向处理结构进行安排时，通常会检验三个基本的前提假设。其中最重要的是交互作用假设。如果没有交互作用，那么通过对其他处理水平的平均化，可以最好地比较每种处理的主效应。如果存在交互作用，那么在比较第一种处理的效应时，实验者必须小心以确定对第二种处理的水平进行平均是否有意义。通常这样做是没有意义的。 7.7 练习 "],["chap8.html", "第 8 章 案例研究：均衡双向实验的完整分析 8.1 主效应均值对比 8.2 交互对比 8.3 油漆铺路示例 8.4 分析定量处理因素 8.5 多重检验 8.6 结束语 8.7 练习", " 第 8 章 案例研究：均衡双向实验的完整分析 在上一章中，我们假设当处理 T 和处理 B 在实验中发生交互时，实验者将想要比较在处理 B 的每一种可能性下处理 T 的效应，反之亦然。在许多情况下，交互作用并非在实验中随处发生——通常只有一两种处理组合会导致交互作用。在其他情况下，一种处理的可能性可能与第二种处理的可能性发生交互，而第一种处理的所有其他可能性都不与第二种处理的任何可能性发生交互。 为了对具有交互作用的数据进行更完整的分析，确定交互作用在数据中的位置是有帮助的。例如，如果已知实验中的所有交互作用都是由处理 T 的其中一种可能性（通常是对照）引起的，那么在对处理 B 的所有可能性进行平均后，仍然可以比较处理 T 的所有其他可能性。这将导致更大功效的检验，用于比较不与处理 B 交互的处理 T 的可能性。 8.1 主效应均值对比 通常，处理 T 和处理 B 的可能性会提示进行主效应对比，这对实验者来说会特别有趣。这样的主效应对比会提示特殊类型的交互作用对比，这对实验者来说也应该很有趣。此外，这样的交互作用对比通常很容易解释。接下来定义了主效应对比和正交主效应对比。 定义 8.1 ♦ 若 \\(\\sum_{i=1}^tc_i=0\\)，则称 \\(\\bar \\mu_{i\\cdot}\\) 的线性组合 \\(\\sum_{i=1}^tc_i\\bar{\\mu}_{i\\cdot}\\) 为 T 主效应均值的一个对比 (contrast).同样，若 \\(\\sum_{i=j}^td_j=0\\)，则称 \\(\\bar \\mu_{\\cdot j}\\) 的线性组合 \\(\\sum_{j=1}^bd_j\\bar{\\mu}_{\\cdot j}\\) 为 B 主效应均值的一个对比。 定义 8.2 ♦ 若 \\(\\sum_{i=1}^tc_ic_i^{\\prime}=0\\)，则称两对比 \\(\\sum_{i=1}^tc_i\\bar{\\mu}_{i\\cdot}\\) 和 \\(\\sum_{i=1}^tc_i^\\prime \\bar{\\mu}_{i\\cdot}\\) 为 T 主效应均值的正交对比 (orthogonal contrasts). 同样，若 \\(\\sum_{j=1}^tc_jc_j^{\\prime}=0\\)，则称两对比 \\(\\sum_{j=1}^tc_j\\bar{\\mu}_{\\cdot j}\\) 和 \\(\\sum_{j=1}^tc_j^\\prime \\bar{\\mu}_{\\cdot j}\\) 为 B 主效应均值的正交对比。 现假设 \\[\\begin{aligned}S_T&amp;=\\left\\{\\sum_{i=1}^tc_{i1}\\bar{\\mu}_{i\\cdot},\\sum_{i=1}^tc_{i2}\\bar{\\mu}_{i\\cdot},\\ldots,\\sum_{i=1}^tc_{it-1}\\bar{\\mu}_{i\\cdot}\\right\\}\\end{aligned}\\] 为 T 主效应均值的一组 t-1 个正交对比，以及 \\[\\begin{aligned}S_B&amp;=\\left\\{\\sum_{j=1}^bc_{j1}\\bar{\\mu}_{\\cdot j},\\sum_{j=1}^bc_{j2}\\bar{\\mu}_{\\cdot j},\\ldots,\\sum_{j=1}^bc_{\\cdot j}\\bar{\\mu}_{j\\cdot}\\right\\}\\end{aligned}\\] 为 B 主效应均值的一组 b-1 个正交对比。\\(S_T\\) 和 \\(S_B\\) 中的每一个都表明两个主效应平方和的划分 (partitioning)。即，T 的平方和的划分定义为 \\[\\begin{equation} S_T^*=\\left\\{Q_p^2=\\frac{nb(\\sum_ic_{ip}\\bar{y}_{i\\cdot\\cdot})^2}{\\sum_ic_{ip}^2},\\quad p=1,2,\\ldots,t-1\\right\\} \\tag{8.1} \\end{equation}\\] B 的平方和的划分定义为 \\[\\begin{equation} S_B^*=\\left\\{Q_q^2=\\frac{nt(\\sum_jd_{jq}\\bar{y}_{\\cdot j\\cdot})^2}{\\sum_jd_{jq}^2},\\quad q=1,2,\\ldots,b-1\\right\\} \\tag{8.2} \\end{equation}\\] 也就是说，\\(S^*_T\\) 中的每个 \\(Q_p^2\\) 都是一个单自由度平方和，用于检验 T 主效应均值中相应的对比是否等于 0. 此外，\\(S^*_T\\) 中 t-1 个单自由度对比的总和等于用于检验 \\(H_{01}\\colon\\bar{\\mu}_{1\\cdot}=\\bar{\\mu}_{2\\cdot}=\\cdots=\\bar{\\mu}_{t\\cdot}\\) 的平方和。\\(S^*_B\\) 的元素也存在类似的情况。 不应过分强调获得基本平方和的正交划分的可取性。从数学角度看，正交划分是不错的，但从实际的角度来看可能并不那么好。通常，一组精心选择的正交对比将使实验者能够明智、清晰、完整地解释他/她的数据。然而，实验者应该真正考虑任何以及所有有意义的对比，不应过度关注所选择的对比是否正交。 8.2 交互对比 本节从双向实验中交互对比的定义开始。 若对于 \\(j=1,2,\\cdots,b\\) 有 \\(\\sum_i\\omega_{ij}=0\\) 且若对于 \\(i=1,2,\\cdots,t\\) 有 \\(\\sum_j\\omega_{ij}=0\\)，则称 \\(\\mu_{ij}\\) 的线性组合 \\(\\sum_i\\sum_j\\omega_{ij}\\mu_{ij}\\) 为一个交互对比 (interaction contrasts). 双向实验主效应中的对比产生了特殊类型的交互对比。设 \\(\\sum_{i=1}^tc_i\\bar{\\mu}_{i\\cdot}\\) 为 T 主效应均值的一个对比以及 \\(\\sum_{j=1}^bd_j\\bar{\\mu}_{\\cdot j}\\) 为 B 主效应均值的一个对比，则 \\(\\sum_i\\sum_jc_id_j{\\mu}_{i{j}}\\) 为交互对比。即，对于所有的 \\(i,j\\)，取 \\(\\omega_{ij}=c_id_j\\) 即得到一个交互对比。若 \\(\\sum_i\\sum_j\\omega_{ij}\\omega_{ij}^{\\prime}=0\\)，则两交互对比 \\(\\sum_i\\sum_j\\omega_{ij}\\mu_{ij}\\) 和 \\(\\sum_i\\sum_j\\omega_{ij}^{\\prime}\\mu_{ij}\\) 为正交交互对比 (orthogonal interaction contrasts). 两组主效应的正交对比导致交互效应的正交对比。设 \\(\\sum_{i=1}^tc_i\\bar{\\mu}_{i\\cdot}\\) 和 \\(\\sum_{i=1}^tc_i^{\\prime}\\bar{\\mu}_{i\\cdot}\\) 为 T 主效应均值的两个对比以及 \\(\\sum_{j=1}^bd_j\\bar{\\mu}_{\\cdot j}\\) 和 \\(\\sum_{j=1}^bd_j^{\\prime}\\bar{\\mu}_{\\cdot j}\\) 为 B 主效应均值的两个对比，若 \\(\\sum_{i=1}^tc_ic_i^{\\prime}=0\\) 或 \\(\\sum_{j=1}^bd_jd_j^{\\prime}=0\\)，则 \\(\\sum_i\\sum_jc_id_j\\mu_{ij}\\) 和 \\(\\sum_i\\sum_jc_i^{\\prime}d^{\\prime}_j\\mu_{ij}\\) 为正交交互对比。也就是说，如果主效应对比对中的至少一个是正交对比对，则两个交互对比将彼此正交。接下来假设 \\(S^*_T\\) 和 \\(S^*_B\\) 由 8.1 节定义，令 \\(S^*_{T\\times B}\\) 定义为 \\[\\begin{equation} S_{T\\times B}^*=\\left\\{Q_{pq}^2=\\frac{n(\\sum_i\\sum_jc_{ip}d_{jq}\\bar{y}_{ij\\cdot})^2}{\\sum_ic_i^2\\sum_jd_j^2},\\quad p=1,2,\\ldots,t-1;q=1,2,\\ldots,b-1\\right\\} \\tag{8.3} \\end{equation}\\] 则 \\(S_{T\\times B}^*\\) 定义了交互作用平方和的一个划分。也就是说，\\(\\sum_p\\sum_qQ_{pq}^2=T{\\times}B\\) 个交互作用平方和，以及式 (8.3) 中的所有 (t-1)(b-1) 个单自由度平方和具有独立的概率分布。下一节将讨论一个示例，以说明上一节中描述的思想。 8.3 油漆铺路示例 考虑表 8.1 中的实验，该实验给出了每种 paint × paving 处理组合的三次独立重复的平均值。进行这项实验是为了比较由两家不同公司生产的两种颜色的油漆 (paints) 在三种类型路面 (paving surfaces) 上的使用寿命，以周为单位。该实验的误差平方和为 455.04，具有 24 个自由度，因此 \\(\\hat \\sigma^2=18.96\\). 本实验通常的方差分析表如表 8.2 所示。 表 8.1: 油漆铺路单元格均值 x 注释: 颜色后跟随的 I 和 II 表示生产厂家，Asphalt I, Asphalt II, Concrete 表示三种类型的路面 表 8.2: 油漆铺路示例方差分析表 x 每种油漆和铺路 (paving) 处理的可能值都会在主效应中产生两组正交对比，这可能是令人感兴趣的。这些在表 8.3 中给出。这两组主效应的正交对比表明，在交互效应中存在六个正交对比。这些数据如表 8.4 所示。 表 8.3: 油漆铺路实验主效应对比 x 表 8.4: 油漆铺路数据交互作用假设 x 注释: Type 是指 asphalt vs concrete 表8.5 中给出了使用表 8.3 和 8.4 中表明的划分对这些数据进行更完整的分析。下面给出了从表 8.5 中获得三个选定对比的平方和所需的计算细节。 表 8.5: 油漆铺路实验方差分析表，包括单自由度检验 x 根据式 (8.1)，用于比较两种白色油漆均值的单自由度平方和为， \\[Q_1^2=\\frac{3\\cdot3[(1)29.0+(-1)35.0]^2}{(1)^2+(-1)^2}=162.0\\] 根据式 (8.2)，用于比较沥青 (asphalt) 和混凝土 (concrete) 的单自由度平方和为， \\[Q_2^2=\\frac{3\\cdot4[(1)(26.5)+(1)(27.5)+(-2)(29.5)]^2}{1^2+1^2+(-2)^2}=40.5\\] 根据式 (8.3)，而用于比较 type × type 交互作用的单自由度平方和为， \\[Q_3^2=\\frac{3\\left[(1)(30)+(1)(28)+(-2)(29)+(-1)(34)+(-1)(35)+(2)(36)\\right]^2}{\\left(1\\right)^2+\\left(1\\right)^2+\\left(-2\\right)^2+\\left(-1\\right)^2+\\left(-1\\right)^2+\\left(2\\right)^2}=2.25\\] 根据表 8.5 的分析，可以得出以下结论： 实验中的所有交互作用都是由两种黄色油漆在两种类型的表面上的不同作用引起的，因为其交互对比是交互作用中唯一显著的单自由度平方和。 因为我们现在知道了数据中交互作用的位置，我们可以进行以下观测： 由于沥青和油漆之间没有交互作用，因此可以在对所有油漆进行平均后对这两种沥青进行比较。该比较的 \\(F\\) 统计量的值为 \\(F=0.32\\)；因此，沥青 I 和 II 之间没有显著差异。 由于白色油漆和三种路面之间没有交互作用，因此可以在对所有路面进行平均后对两种白色涂料进行比较。该比较的 \\(F\\) 统计量值为 \\(F=8.54\\)，这表明白色油漆 II 与 I 有显著差异。从表 8.1 中我们可以看出，白色油漆 II 的持续时间更长。 尽管比较黄色油漆 I 和黄色油漆 II 的统计量是显著的（\\(F=4.45\\)），但在进行解释时必须小心，因为黄色油漆的品牌和路面类型之间存在显著的交互作用。 尽管沥青与混凝土的比较并不显著（\\(F=2.14\\)），但在进行解释时必须再次小心，因为油漆品牌和路面类型之间存在显著的交互作用。 为了完成对这些数据的分析，我们还应该检查： 沥青上的黄色油漆 I 与黄色油漆 II，即检验 \\(\\mu_{11}+\\mu_{12}-\\mu_{21}-\\mu_{22}=0\\). 混凝土上的黄色油漆 I 与黄色油漆 II. 对于黄色油漆 I，比较混凝土和沥青。 对于黄色油漆 II，比较混凝土和沥青。 三种路面上的白色油漆。 结果如表 8.6 所示。 表 8.6: 结论 3 中的假设检验 x 对表 8.6 中的结果和表 8.1 中的平均值的检查表明，1）黄色油漆 II 在沥青上明显优于黄色油漆 I，但 2）黄色油漆 I 在混凝土上明显优于黄色油漆 II；3） 黄色油漆 II 在混凝土上的持续时间明显长于在沥青上；4） 黄色油漆 II 在沥青上的持续时间明显长于在混凝土上；最后，5）白色油漆在所有三种路面上持续的时间大致相同。 我们对该示例的分析所获得的所有结果都可以使用许多统计计算包获得，如 SAS® 和 SPSS，使用它们的对比选项。其中一些程序可能要求将 12 种处理组合视为单向处理结构。 8.4 分析定量处理因素 在本节中，假设实验的两个因素的水平都是定量的 (quantitative). 在这种情况下，可以定义对比以衡量每组处理主效应均值的曲线趋势。感兴趣的趋势通常是线性的、二次的、三次的等等。相应的正交对比将主效应平方和划分为测量线性、二次、三次等等趋势的效应，然后可以用来构建交互效应的正交对比。由此产生的对比称为 Lin T × Lin B（T 的线性效应乘以 B 的线性效应）、Lin T × Quad B （T 的线性效应乘以 B 的二次效应）等等。对于 3×4 的实验，其中两种处理具有相等的间隔水平（例如，因子 T 为 5, 10, 15，因子 B 为 2, 4, 6, 8），Lin T 对比由 \\(-\\bar{\\mu}_{1\\cdot}+0\\bar \\mu_{2\\cdot}+\\bar{\\mu}_{3\\cdot}=0\\) 定义，Lin B 对比由 \\(-3\\bar{{\\mu}}_{\\cdot1}-\\bar{{\\mu}}_{\\cdot2}+\\bar{{\\mu}}_{\\cdot3}+3\\bar{{\\mu}}_{\\cdot4}=0\\). 注意，对于 Lin T 对比，在 \\(\\sum_{i=1}^3c_i\\bar{\\mu}_{i\\cdot}=0\\) 中 \\(c_1=-1,c_2=0,c_3=1\\). 对于 Lin B 对比，在 \\(\\sum_{j=1}^4d_j\\bar{\\mu}_{\\cdot j}=0\\) 中 \\(d_1=-3,d_2=-1,d_3=1,d_4=3\\). 因此 Lin T × Lin B 交互对比定义为 \\(3\\mu_{11}+\\mu_{12}-\\mu_{13}-3\\mu_{14}-3\\mu_{31}-\\mu_{32}+\\mu_{33}+3\\mu_{34}=0\\). 在正交多项式系数表中可以找到在主效应均值中用于定义这些类型的正交对比的 \\(c_i\\) 和 \\(d_j\\) 的值。参见 Beyer (1968). 表 8.7 中再现了 3×4 实验的结果。 表 8.7: 3×4 实验的正交对比系数 x 设 \\(x_1,x_2,\\cdots,x_t\\) 表示因素 T 的水平，\\(z_1,z_2,\\cdots,z_b\\) 表示因素 B 的水平。总是存在参数 \\(\\alpha_{kh},k=0,1,2,\\cdots,t-1,h=0,1,2,\\cdots,b-1\\) 使得单元格均值参数可以表示为 \\(x_i\\) 和 \\(z_j\\) 的多项式函数。也就是说，存在这样的 \\(\\alpha_{kh}\\) 使得 \\[\\begin{equation} \\mu_{ij}=\\sum_{k=0}^{t-1}\\sum_{h=0}^{b-1}\\alpha_{kh}x_i^kz_j^h \\tag{8.4} \\end{equation}\\] 展开式 (8.4)，可以得到 \\[\\begin{aligned}\\mu_{ij}=&amp;\\alpha_{00}+\\alpha_{10}x_i+\\alpha_{20}x_i^2+\\cdots+\\alpha_{t-10}x_i^{t-1}+\\alpha_{01}z_j+\\alpha_{02}z_j^2+\\cdots+\\alpha_{0b-1}z_j^{b-1}\\\\&amp;+\\alpha_{11}x_iz_j+\\alpha_{12}x_iz_j^2+\\cdots+\\alpha_{t-1b-1}x_i^{t-1}z_j^{b-1}\\end{aligned}\\] 根据方程 (8.4) 中的 \\(\\alpha_{kh}\\) 值，表 8.8 给出了对于 3×4 实验的主效应期望值和交互对比。在构建此表时，我们假设 \\(x\\) 的三个水平分别编码为 -1、0 和 1，\\(z\\) 的四个水平分别编码为 -3, -1, 1 和 3. 提供表 8.8 的目的是指出当研究这种类型的对比时，实际上正在检验哪些假设。例如，Lin T 与 Lin B 的对比检验了假设 \\(40\\alpha_{11}+328\\alpha_{13}=0\\) . 因此，如果此效应显著，那么可能是因为 \\(\\alpha_{11} ≠ 0\\) 或者 \\(\\alpha_{13} ≠ 0\\)，而不仅仅是因为 \\(\\alpha_{11} ≠ 0\\)（如许多数据分析师可能认为的那样）。 表 8.8: 3×4 实验中正交多项式的期望值 x 如果要考察正交多项式，建议先观察最高阶项的系数，然后按照降序考虑剩余项的阶数。一旦确定某个高阶项在模型中，那么所有两个分量阶数均低于该显著项的项，无论它们是否显著，也都应该被包含在模型中。例如，如果决定 \\(x^2z^2\\) 应包括在模型中，那么模型也应该包括 \\(xz^2,z^2,x^2z,x^2,xz,x,z\\). 这是因为正交多项式总是表示定量变量的编码值。因此，如果 \\(\\alpha_{22}\\) 非零，这意味着 \\[\\left(\\frac{x-h_1}{c_1}\\right)^2\\left(\\frac{z-h_2}{c_2}\\right)^2\\] 在模型中，其中 \\(\\left(\\frac{x-h_1}{c_1}\\right)\\) 和 \\(\\left(\\frac{z-h_2}{c_2}\\right)\\) 为 \\(x\\) 和 \\(z\\) 的编码值。式 \\(\\left(\\frac{x-h_1}{c_1}\\right)^2\\left(\\frac{z-h_2}{c_2}\\right)^2\\) 的展开说明项 \\(xz^2,z^2,x^2z,x^2,xz,x,z\\) 也在模型中，即使其他低阶正交多项式可能不显著。 8.5 多重检验 第 3 章中讨论的任何多重比较程序都可以使用，只需进行一些非常小的调整，就可以对双因素实验的主效应进行多重比较。调整要求将 \\(n\\) 和 \\(n_i\\) 替换为：为估计被比较的主效应均值而进行的观测总数。在本章中，B 主效应均值的样本量为 \\(nt\\)，T 主效应均值的样本量为 \\(nb\\). 我们对主效应均值多重比较的建议与第 3.2 节中给出的建议相同。第 3 章中给出的容易推广到交互对比的程序是 LSD procedure、Bonferroni’s method、多元 \\(t\\) 方法、模拟方法和 Scheffé’s procedure. 我们发现，Scheffé’s procedure 不是很令人满意，因为所需的临界点太大，程序太保守。我们对交互对比多重比较的建议如下： 对交互进行 \\(F\\) 检验。 如果 \\(F\\) 统计量显著，则使用 LSD procedure（或等价地，上一节中给出的对比程序）进行任何计划的比较。对于数据窥探和计划外比较，请使用 Johnson (1976) 给出的程序，此处不讨论。 如果交互作用的 \\(F\\) 检验不显着，实验者仍应检查她计划考虑的任何单个交互对比，但要使用多元 \\(t\\) 方法或 Bonferroni’s method. 只要所选对比是线性独立的，就使用多元 \\(t\\) 方法；否则应使用 Bonferroni’s method. 8.6 结束语 在本章中，我们通过举例介绍了从实验中获得最大信息量的方法。其中包括发现实验中交互作用发生位置的方法。了解实验中交互作用发生的位置对于确定可能提出的问题的最佳答案很有价值。本章介绍的技术应该可以帮助实验者更好地分析他们的实验。还考虑了定量处理因素的分析，包括如何确定哪些趋势可能与不同水平的处理因素有关。 8.7 练习 "],["chap9.html", "第 9 章 使用均值模型分析具有不等子类数的均衡双向处理结构 9.1 模型定义和假设 9.2 参数估计 9.3 检验所有均值是否相等 9.4 交互作用和主效应假设 9.5 总体边际均值 9.6 同时推断与多重比较 9.7 结束语 9.8 练习", " 第 9 章 使用均值模型分析具有不等子类数的均衡双向处理结构 第 7 章和第 8 章考虑了相同样本量的情况，其中每个处理组合的观测次数相同。第 ??-?? 章考虑了一些处理组合缺失的情况，但本章以及第 ??-?? 章假设观测到了每种处理组合，并且每种组合观测了多次。 9.1 模型定义和假设 如第 7.1.1 节所示，令 \\(\\mu_{ij}\\) 为当处理 T 的可能性 \\(i\\) 和处理 B 的可能性 \\(j\\) 均应用于同一实验单元时的预期响应。本章假设观测到的响应 \\(Y_{ijk}\\) 可以通过以下方式建模 \\[\\begin{equation} Y_{ijk}=\\mu_{ij}+\\varepsilon_{ijk},\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,b,k=1,2,\\ldots,n_{ij} \\tag{9.1} \\end{equation}\\] 满足理想条件 \\[\\varepsilon_{ijk}\\sim i.i.d.N(0,\\sigma^2),\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,b,\\quad k=1,2,\\ldots,n_{ij}\\] 以及对于每个 \\(i\\) 和 \\(j\\)，\\(n_{ij}&gt;0\\). 9.2 参数估计 若将 \\(bt\\) 个处理组合视为 \\(bt\\) 个不同的处理，那么第 1-3 章中讨论的单向处理结构的所有内容也适用于双向处理结构。对于不均衡的数据问题，这通常是分析数据最佳和最简单的方法。均值模型中参数的最佳估计是 \\[\\begin{equation} \\hat{\\mu}_{ij}=\\frac1{n_{ij}}\\sum_{k=1}^{n_{ij}}y_{ijk}=\\bar{y}_{ij\\cdot},i=1,2,\\ldots,t,j=1,2,\\ldots,b \\tag{9.2} \\end{equation}\\] 以及 \\[\\begin{equation} \\hat{\\sigma}^2=\\frac1{N-bt}\\sum_{ijk}(y_{ijk}-\\overline{y}_{ij\\cdot})^2 \\tag{9.3} \\end{equation}\\] 其中 \\(N=n_{\\cdot}\\). \\(\\hat \\mu_{ij},\\hat \\sigma^2\\) 的抽样分布为 \\[\\hat{\\mu}_{ij}\\thicksim N(\\mu_{ij},\\sigma^2/n_{ij})\\quad\\mathrm{for~}i=1,2,\\ldots,t,j=1,2,\\ldots,b\\] 以及 \\[(N-bt)\\hat{\\sigma}^2/\\sigma^2\\thicksim\\chi^2(N-bt)\\] 此外，所有的 \\(\\hat \\mu_{ij},\\hat \\sigma^2\\) 独立分布，像之前章节一样。 当数据不均衡时，实验者通常想回答与数据均衡时相同的问题。回想一下，这些问题是： 两组处理发生交互吗？ T 处理如何影响响应？ B 处理如何影响响应？ 根据均值模型的参数，这些问题可以表述为假设，相应的假设是： \\[\\begin{array}{l}H_{T\\times B}\\colon\\mu_{ij}-\\mu_{i&#39;j}-\\mu_{ij&#39;}+\\mu_{i&#39;j&#39;}=0&amp;\\text{ for all }i\\neq i&#39;\\text{ and }j\\neq j&#39;\\\\H_T\\colon\\bar{\\mu}_{1\\cdot}=\\bar{\\mu}_{2\\cdot}=\\cdots=\\bar{\\mu}_{t\\cdot}\\\\H_B\\colon\\bar{\\mu}_{\\cdot1}=\\bar{\\mu}_{\\cdot2}=\\cdots=\\bar{\\mu}_{\\cdot b}\\end{array}\\] 检验上述假设应被视为分析任何双向实验的第一步。通常会有明确的对比，直接解决研究人员感兴趣的其他问题。假设 \\(H_{T\\times B},H_T,H_B\\) 经常被检验，以帮助选择适当的多重比较程序来解决可能感兴趣的其他问题。 如式 7.2 所示，始终存在参数 \\(\\mu,\\tau_i,\\beta_j,\\gamma_{ij},i=1,2,\\cdots,t,j=1,2,\\cdots,b\\) 使得 \\(\\mu_{ij}\\) 可以在效应模型中表示为 \\[\\mu_{ij}=\\mu+\\tau_i+\\beta_j+\\gamma_{ij},\\quad i=1,2,\\ldots,t,\\quad j=1,2,\\ldots,b\\] 许多实验者更喜欢使用效应模型来查看处理组合方式的表示。这可能是因为许多统计学家鼓励实验者考虑这样的模型。因此，许多现有的计算机软件引导数据分析师使用效应模型的表示。本书考虑了这两类模型。本章考虑均值模型，第 ?? 章考虑效应模型。第 1.5 节和第 1.6 节介绍了计算检验统计量的不同程序。对于单向情况，所有这些方法都会产生相同的检验统计量。事实上，对于匀称的 (well-balanced) 双向实验也总是如此。然而，不均衡数据集的情况并不总是如此。匀称意味着每种处理组合都有相同数量的观测结果。本章使用矩阵程序来获取检验统计量，第 ?? 章使用模型拟合程序。 9.3 检验所有均值是否相等 考虑表 9.1 中的数据。数据来自于在完全随机设计结构中进行的小型双向处理结构实验。首先，计算表 9.1 中数据的双向单元格均值和边际均值。表 9.2 给出了这些均值，其中行边际均值 (row marginal mean) 定义为给定行单元格均值的均值，列边际均值 (column marginal mean) 定义为给定列单元格均值的均值。 表 9.1: 一个不均衡的双向实验 x 表 9.2: 表 9.2 中数据的单元平均值和边际平均值 x 应注意的是，在不均衡双向实验中，有两种不同的方法可以计算 T 均值和 B 均值。表 9.1 给出了通过行（列）综总和并除以行（列）观测数量计算得出的平均值。表 9.2 给出了分两步计算的平均值。首先计算每个 T × B 组合的单元格均值，然后计算每行和列的单元格均值。除非实验是匀称的，否则这两种方法通常会给出不同的答案。例如，表 9.1 中的 \\(T_1\\) 平均值为 22.75，而表 9.2 中的 \\(T_1\\) 平均值为 23. 因此，必须解决的一个问题是在计算处理主效应均值时应使用这两种方法中的哪一种。应使用哪种方法将在 9.5 节中讨论。 表 9.1 中数据的实验误差方差为 \\[\\hat{\\sigma}^2=\\frac1{N-bt}\\sum_{ijk}(y_{ijk}-\\overline{y}_{ij.})^2=20/10=2\\] 自由度为 \\(N-bt=16-6=10\\). 接下来，将该实验视为具有六种处理的单向处理结构，并检验所有六种处理组合均值是否彼此相等。也就是说，考虑检验 \\[\\begin{aligned}H_0\\colon\\mu_{11}=\\mu_{12}=\\mu_{13}=\\mu_{21}=\\mu_{22}=\\mu_{23}\\end{aligned}\\] 使用式 (8.1) 可得 \\[SSH_0=\\frac{60^2}3+\\frac{50^2}2+\\frac{72^2}3+\\frac{52^2}2+\\frac{69^2}3+\\frac{96^2}3-\\frac{399^2}{16}=238.9375\\] 基于 5 个自由度。因此用于检验 \\(H_0\\) 的 \\(F\\) 统计量为 \\[F_c=\\frac{238.9375/5}2=23.89\\] 在 \\(\\hat\\alpha = 0.00003\\) 水平上显著。因此，\\(H_0\\) 将被拒绝，因此六种不同处理组合均值之间存在显著差异。 9.4 交互作用和主效应假设 在上一节中，确定了六种处理组合均值之间存在显著差异。现在有必要看看差异出现在哪里。第一步，考虑表 9.1 中给出的数据是否存在显着的 T × B 交互作用并检验 \\[\\begin{aligned}H_{T\\times B}\\colon\\mu_{ij}-\\mu_{i&#39;j}-\\mu_{ij&#39;}+\\mu_{i&#39;j&#39;}=0&amp;&amp;\\text{ for all }i\\neq i&#39;&amp;\\mathrm{~and~}j\\neq j&#39;\\end{aligned}\\] 这可以通过利用第 1.4 节中讨论的矩阵程序来开发检验统计量来实现。假设 \\(H_{T\\times B}\\) 为真当且仅当 \\[\\mu_{11}-\\mu_{12}-\\mu_{21}+\\mu_{22}=0\\] 以及 \\[\\mu_{11}-\\mu_{13}-\\mu_{21}+\\mu_{23}=0\\] 反过来，这些声明为真当且仅当 \\(\\boldsymbol C\\boldsymbol \\mu=0\\)，其中 \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0&amp;-1&amp;1&amp;0\\\\1&amp;0&amp;-1&amp;-1&amp;0&amp;1\\end{bmatrix}\\quad\\mathrm{and}\\quad \\boldsymbol \\mu^{\\prime}=[\\mu_{11}~\\mu_{12}~\\mu_{13}~\\mu_{21}~\\mu_{22}~\\mu_{23}]\\] 根据式 (1.11)，由于 \\(\\boldsymbol D=\\mathrm{Diag}[1/3,1/2,1/3,1/2,1/3,1/3]\\) \\[SSH_{T \\times B}=[\\boldsymbol C\\hat{\\boldsymbol{\\mu}}]^{\\prime}[\\boldsymbol C\\boldsymbol D\\boldsymbol C^{\\prime}]^{-1}[\\boldsymbol C\\hat{\\boldsymbol{\\mu}}]=[-8\\quad2]\\begin{bmatrix}\\frac{10}6&amp;\\frac56\\\\\\frac56&amp;\\frac96\\end{bmatrix}^{-1}\\begin{bmatrix}-8\\\\2\\end{bmatrix}\\] 因此 \\(SSH_{T\\times B}=776(6/65)=71.631\\) 且基于 2 个自由度。相应的 \\(F\\) 统计量为 \\(F_c=(71.631/2)/2=17.91\\) 且基于自由度 2 和 10，在 \\(\\hat \\alpha=0.0005\\) 水平下显著。其他 \\(\\boldsymbol C\\) 矩阵也可以用来检验无交互作用的假设，但所有这些矩阵都会产生相同的检验统计量。读者可以验证这是真的。 接下来考虑检验预期行边际均值的相等性。这里出于说明目的，尽管由于显著的 T × B 交互作用，这种检验在这里可能不合适。合适的假设为 \\(H_T{:{\\bar{\\mu}}_{1\\cdot}}=\\bar{{\\mu}}_{2\\cdot}\\). 注意到 \\(H_T\\) 为真当且仅当 \\(\\boldsymbol C\\boldsymbol \\mu=\\boldsymbol 0\\)，其中 \\(\\boldsymbol C=[1\\,\\,1\\,\\,1\\,\\,-1\\,\\,-1\\,\\,-1]\\). 使用式 (1.11) 可得 \\[SSH_T=[\\boldsymbol C\\hat{\\boldsymbol{\\mu}}]^{\\prime}[\\boldsymbol C\\boldsymbol D\\boldsymbol C^{\\prime}]^{-1}[\\boldsymbol C\\hat{\\boldsymbol{\\mu}}]=[-12][14/6]^{-1}[-12]=61.714\\] 基于 1 个自由度，且相应的 \\(F\\) 统计量为 \\(F_{c}=(61.714/1)/2=30.857\\)，在 \\(\\hat \\alpha=0.00024\\) 水平下显著。也可以取 \\(\\boldsymbol C=[\\frac{1}{3}\\,\\,\\frac{1}{3}\\,\\,\\frac{1}{3}\\,\\,-\\frac{1}{3}\\,\\,-\\frac{1}{3}\\,\\,-\\frac{1}{3}]\\)。读者应该验证 \\(\\boldsymbol C\\) 的第二个选择是否会产生与上面使用的 \\(\\boldsymbol C\\) 相同的 \\(F\\) 检验统计量。 最后，考虑通过检验 \\(H_B\\colon\\bar{\\mu}_{\\cdot1}=\\bar{\\mu}_{\\cdot2}=\\bar{\\mu}_{\\cdot3}\\) 来测试预期列边际均值的相等性。注意，\\(H_B\\) 为真当且仅当 \\(\\boldsymbol C\\boldsymbol \\mu=\\boldsymbol 0\\) 时，其中 \\[\\boldsymbol C=\\begin{bmatrix}1&amp;-1&amp;0&amp;1&amp;-1&amp;0\\\\1&amp;0&amp;-1&amp;1&amp;0&amp;-1\\end{bmatrix}\\] 使用式 (1.11) 可得 \\[\\begin{aligned}SSH_B&amp;=[C\\hat{\\boldsymbol{\\mu}}]^{\\prime}[\\boldsymbol C\\boldsymbol D\\boldsymbol C^{\\prime}]^{-1}[\\boldsymbol C\\hat{\\boldsymbol{\\mu}}]=[-2\\,\\,-10]\\begin{bmatrix}\\frac{10}6&amp;\\frac56\\\\\\frac56&amp;\\frac96\\end{bmatrix}^{-1}\\begin{bmatrix}-2\\\\-10\\end{bmatrix}\\\\\\\\&amp;=[-2\\,\\,-10]\\frac6{65}\\begin{bmatrix}9&amp;-5\\\\-5&amp;10\\end{bmatrix}\\begin{bmatrix}-2\\\\-10\\end{bmatrix}=77.169\\end{aligned}\\] 基于 2 个自由度。因此，相应的 \\(F\\) 统计量为 \\(F_c=19.29\\)，在 \\(\\hat \\alpha=0.0037\\) 水平下显著。 表 9.3 中给出的方差分析表总结了上述检验。请注意，此分析结果与第 7 章讨论的均衡情形下的结果之间存在一些差异。 表 9.3: 表 9.1 中数据的方差分析表 x 对于均衡的数据，总有 \\[SS_T+SS_B+SS_{T\\times B}=SS_{\\mu_{11}=\\mu_{12}=\\cdot\\cdot\\cdot=\\mu_{23}}\\] 对于不均衡的数据通常不然。 对于均衡的数据，\\(SS_T,SS_B,SS_{T\\times B}\\) 在统计学上是独立的；对于不均衡的数据，这通常是不正确的。 人们不必过于担心 T, B 和 T × B 的平方和之和不等于检验所有均值相等的平方和，或者 T, B 和 T × B 的平方和在统计上不独立。之所以在此提出，是因为它们确实成立，而并非因为它们是必须解决的问题。 还有其他一些平方和经常与双向处理结构的分析有关，第 ?? 章将讨论其中两种常用的平方和。 9.5 总体边际均值 实验者常常对比较每个主效应的可能性感兴趣。在均衡的情况下，人们可以比较 \\(\\bar{\\mu}_{1\\cdot},\\bar{\\mu}_{2\\cdot},\\ldots,\\bar{\\mu}_{t\\cdot}\\)。如前所述，这些均值在均衡和不均衡的情况下都被称为总体边际均值。 \\(\\bar{\\mu}_{i\\cdot}\\) 的最佳估计是 \\[\\begin{equation} \\hat{\\bar{\\mu}}_{i\\cdot}=\\frac1b\\sum_{j=1}^b\\hat{\\mu}_{ij}=\\bar{\\hat{\\mu}}_{i\\cdot}\\quad i=1,2,\\ldots,t \\tag{9.4} \\end{equation}\\] \\(\\hat{\\bar{\\mu}}_{i\\cdot}\\) 的标准误估计为 \\[\\begin{equation} \\widehat{s.e.}(\\hat{\\bar{\\mu}}_{i\\cdot})=\\frac{\\hat{\\sigma}}b\\sqrt{\\sum_{j=1}^b\\frac1{n_{ij}}},\\quad i=1,2,\\ldots,t \\tag{9.5} \\end{equation}\\] \\(\\bar{\\mu}_{\\cdot j}\\) 的最佳估计是 \\[\\begin{equation} \\hat{\\bar{\\mu}}_{\\cdot j}=\\frac1t\\sum_{i=1}^t\\hat{\\mu}_{ij}=\\bar{\\hat{\\mu}}_{\\cdot j},\\quad j=1,2,\\ldots,b \\tag{9.6} \\end{equation}\\] \\[\\begin{equation} \\widehat{s.e.}(\\hat{\\bar{\\mu}}_{\\cdot j})=\\frac{\\hat{\\sigma}}t\\sqrt{\\sum_{i=1}^t\\frac1{n_{ij}}},\\quad j=1,2,\\ldots,b \\tag{9.7} \\end{equation}\\] 需注意，在不均衡数据问题中，通常 \\(\\hat{\\bar{\\mu}}_{i\\cdot}\\) 不同于 \\(\\bar y_{i\\cdot}\\) 且 \\(\\hat{\\bar{\\mu}}_{\\cdot j}\\) 不同于 \\(\\bar y_{\\cdot j}\\). 在这个例子中，\\(\\bar{y}_{1\\cdot\\cdot}=22.75,\\hat {\\bar \\mu}_{1\\cdot}=23\\). \\(\\hat{\\bar{\\mu}}_{i\\cdot},\\hat{\\bar{\\mu}}_{\\cdot j}\\) 分别为 \\(\\bar{\\mu}_{i\\cdot},\\bar{\\mu}_{\\cdot j}\\) 的无偏估计。注意到 \\(\\bar{y}_{i\\cdot\\cdot},\\bar{y}_{\\cdot j\\cdot}\\) 分别为 \\[\\tilde{\\mu}_{i\\cdot}=\\left(\\sum_{j=1}^bn_{ij}\\mu_{ij}\\right)\\Bigg/n_{i\\cdot},\\quad\\tilde{\\mu}_{\\cdot j}=\\left(\\sum_{i=1}^tn_{ij}\\mu_{ij}\\right)\\Bigg/n_{\\cdot j}\\] 的无偏估计。即，\\(\\bar{y}_{i\\cdot\\cdot}\\) 使用第 \\(i\\) 行单元格样本量作为权重，提供该行单元格均值参数加权平均的无偏估计。类似的，\\(\\bar{y}_{\\cdot j \\cdot}\\) 使用第 \\(j\\) 列单元格样本量作为权重，提供该列单元格均值参数加权平均的无偏估计。因此主效应均值的估计有两种：\\(\\hat{\\bar{\\mu}}_{i\\cdot},\\hat{\\bar{\\mu}}_{\\cdot j}\\) 和 \\(\\bar{y}_{i\\cdot\\cdot},\\bar{y}_{\\cdot j \\cdot}\\)。当使用软件包来分析数据时，确定它计算的是哪种是极其重要的。 对于表 9.1 中的数据，如表 9.2 所示，总体边际均值的估计为 \\(\\hat{\\bar{\\mu}}_{1\\cdot}=23,\\hat{\\bar{\\mu}}_{2\\cdot}=27,\\hat{\\bar{\\mu}}_{\\cdot1}=23,\\hat{\\bar{\\mu}}_{\\cdot2}=27,\\hat{\\bar{\\mu}}_{\\cdot3}=28\\). 这些估计的标准误估计为 \\[\\begin{aligned} &amp;\\widehat{s.e.}(\\hat{\\bar{\\mu}}_{1\\cdot}) =\\frac{\\sqrt{2}}3\\sqrt{\\frac13+\\frac12+\\frac13}=0.51 \\\\ &amp;\\widehat{s.e.}(\\hat{\\bar{\\mu}}_{2\\cdot}) =\\frac{\\sqrt2}3\\sqrt{\\frac12+\\frac13+\\frac13}=0.51 \\\\ &amp;\\widehat{s.e.}(\\hat{\\bar{{\\mu}}}_{\\cdot1}) =\\frac{\\sqrt{2}}2\\sqrt{\\frac13+\\frac12}=0.65 \\\\ &amp;\\widehat{s.e.}(\\hat{\\bar{\\mu}}_{\\cdot2}) =\\frac{\\sqrt2}2\\sqrt{\\frac12+\\frac13}=0.65 \\\\ &amp;\\widehat{s.e.}(\\hat{\\bar{\\mu}}_{\\cdot3}) =\\frac{\\sqrt2}2\\sqrt{\\frac13+\\frac13}=0.58 \\end{aligned}\\] 关于总体边际均值线性组合的推断，如 \\(\\sum_ic_i\\bar{\\mu}_{i\\cdot}\\) 或 \\(\\sum_jd_j\\bar{\\mu}_{\\cdot j}\\)，可以证明 \\[\\begin{equation} \\frac{\\sum_ic_i\\hat{\\bar{\\mu}}_{i\\cdot}-\\sum_ic_i\\bar{\\mu}_{i\\cdot}}{\\frac{\\hat{\\sigma}}b\\sqrt{\\sum_ic_i^2\\left(\\sum_j\\frac1{n_{ij}}\\right)}}\\thicksim t(v) \\tag{9.8} \\end{equation}\\] 以及 \\[\\begin{equation} \\frac{\\sum_jc_j\\hat{\\bar{\\mu}}_{\\cdot j}-\\sum_jc_j\\bar{\\mu}_{\\cdot j}}{\\frac{\\hat{\\sigma}}t\\sqrt{\\sum_jc_j^2\\left(\\sum_i\\frac1{n_{ij}}\\right)}}\\thicksim t(v) \\tag{9.9} \\end{equation}\\] 方程 (9.8) 和 (9.9) 中的公式可以作为方程 (1.4) 的特殊情况获得。例如，检验 \\(H_T{:{\\bar{\\mu}}_{1\\cdot}}=\\bar{{\\mu}}_{2\\cdot}\\) 的 \\(t\\) 统计量为 \\[t_c=\\frac{\\hat{\\bar{\\mu}}_{1\\cdot}-\\hat{\\bar{\\mu}}_{2\\cdot}}{\\frac\\partial b\\sqrt{\\sum_j\\frac1{n_{1j}}+\\sum_j\\frac1{n_{2j}}}}=\\frac{23-27}{\\frac{\\sqrt{2}}3\\sqrt{\\left(\\frac13+\\frac12+\\frac13\\right)+\\left(\\frac12+\\frac13+\\frac13\\right)}}=\\frac{-4}{\\frac{1.414}3\\sqrt{\\frac73}}=\\frac{-4}{0.72}=-5.55\\] 在 \\(\\hat \\alpha=0.00024\\) 水平下显著。\\(\\hat{\\bar{\\mu}}_{1\\cdot}-\\hat{\\bar{\\mu}}_{2\\cdot}\\) 的一个 95% 置信区间为 \\[\\begin{aligned} \\hat{\\bar{\\mu}}_{\\cdot1}-\\hat{\\bar{\\mu}}_{\\cdot2}\\mp t_{\\frac\\alpha2,v}\\frac{\\hat{\\sigma}}t\\sqrt{\\sum_i\\frac1{n_{i1}}+\\sum_j\\frac1{n_{i2}}}&amp; =23-24\\mp t_{.025,v}\\cdot\\frac{1.414}2\\sqrt{\\left(\\frac13+\\frac12\\right)+\\left(\\frac12+\\frac13\\right)} \\\\ &amp;=-1\\mp(2.228)(0.91)=-1\\mp2.03 \\end{aligned}\\] 9.6 同时推断与多重比较 在每个处理组合观测次数不等的双向实验中，很少有好的程序可以用于进行多重比较。如果想比较所有双向单元格均值对子，那么第 3 章中讨论的任何技术都可以简单地使用，只需将双向实验视为单向处理结构实验。在这种情况下，读者应参阅第 3.2 节中给出的建议。如果希望对总体边际均值进行多重比较，建议使用基于方程 (9.8) 和 (9.9) 的 \\(t\\) 检验。如果用于比较相应边际均值的相应 \\(F\\) 检验是显著的，则使用给定的显著性水平。如果 \\(F\\) 检验不显著，那么仍然建议使用这些 \\(t\\) 检验。然而，在这种情况下，应该使用 Bonferroni’s method，并声称只有当计算出的显著水平小于 \\(\\alpha/p\\) 时，两个总体边际均值才显著不同，其中 \\(\\alpha\\) 是选定的实验误差率，\\(p\\) 是在收集数据之前考虑的比较次数。如果确定数据中存在交互作用，那么人们可能会想要比较在其他处理的每种可能性下，某一种处理的效果。也就是说，人们可能希望将每一行内的单元格均值相互比较，并将每一列内的单元格均值相互比较。有 \\(bt(t + 1)/2 + bt(b + 1)/2\\) 个 这样的两两比较。如果比较所有均值的 \\(F\\) 检验显著，则可以对所有此类成对比较使用实际显著性水平。这种用法相当于 Fisher’s LSD 程序。如果比较所有均值的 \\(F\\) 检验不显着，则可以采用 Bonferroni’s method. 对于数据窥探和计划外比较，应该使用 Scheffé’s procedure. 9.4 节中描述的检验统计量可以通过许多统计计算包自动获得。由于这些包采用了效应模型，感兴趣的读者应该参见第 ?? 节。 9.7 结束语 本章是考虑对子类数量不等的双向处理结构进行分析的七章中的第一章。本章所介绍的分析方法是基于均值模型得出的。其中一个重要的假设是，所有处理组合至少被观测过一次。检验主效应和相互作用假设的程序是作为第一章中介绍的一般技术的特例而获得的。本章定义了总体边际均值，并给出了对总体边际均值进行推断的程序。第 ?? 章利用效应模型回答了类似的问题；然而，作者希望所有读者都能对均值模型和效应模型感到同样舒适。 9.8 练习 "],["chap29.html", "第 10 章 交叉设计的分析 10.1 定义，假设和模型 10.2 两时期/两处理交叉设计 10.3 具有两个以上时期的交叉设计 10.4 具有两种以上处理的交叉设计 10.5 小结", " 第 10 章 交叉设计的分析 交叉设计 (crossover design) 用于比较按序列给予实验单元（如动物或人）的处理。也就是说，每个实验单元按照预定的序列进行每种处理。交叉设计的目的是通过观察应用于同一实验单元的处理，消除比较处理时实验单元之间的差异。 尽管交叉设计消除了处理比较中实验单元之间的差异，但其他问题可能会以延滞 (carryover) 或残余 (residual) 效应的形式出现。例如，当首先给予处理 \\(A\\) 并且在应用处理 \\(B\\) 时其效应尚未消失，就会出现延滞效应。如果 \\(A\\) 的滞留效应 (lingering effect) 干扰了个体对处理 \\(B\\) 的响应（或正向或负向），那么处理 \\(A\\) 对处理 \\(B\\) 有残余效应。 交叉设计模型必须包含序列效应、时期效应、处理效应、延滞效应、实验单元误差项和时间间隔误差项。第一节讨论了一般模型及其假设，最后两节分别讨论了两个时期和两个以上时期两个处理的交叉设计。 在一般的交叉设计中，比较 \\(t\\) 个处理，其中在每个实验单元上观察每个处理；也就是说，这些处理以特定的序列应用于实验单元。实验者构建 \\(t\\) 个处理的 \\(s\\) 个序列，并将实验单元随机分配给第 \\(i\\) 个序列。表 10.1 包含一组可应用于实验单元的三种处理的序列。将序列分配给个体（可能的实验单元）意味着个体是序列的实验单元；将处理分配给时间间隔意味着该时间间隔是处理的实验单元。 表 10.1: 对实验单元应用三种处理（A、B 和 C）的可能序列集 x 10.1 定义，假设和模型 描述在第 \\(i\\) 个时期内分配给第 \\(j\\) 个序列的第 \\(\\ell\\) 只动物的观测结果的响应的模型为 \\[\\begin{align} y_{ijk\\ell}&amp;=\\mu+S_i+\\delta_{i\\ell}+P_j+T_k+\\varepsilon_{ijk\\ell}\\\\i&amp;=1,2,\\ldots,s,j=1,2,\\ldots,p,k=1,2,\\ldots,t,\\mathrm{~and~}\\ell=1,2,\\ldots,n_j \\tag{10.1} \\end{align}\\] 在上述模型中，\\(S_i\\) 是第 \\(i\\) 个序列的效应，\\(P_j\\) 是第 \\(j\\) 个时期的效应，\\(T_k\\) 是第 \\(k\\) 个处理的效应，其中 \\(k\\) 的值由第 \\(i\\) 个序列和第 \\(j\\) 个时期的 \\(i,j\\) 组合确定。在理想条件下，将有 \\(\\delta_{i\\ell}\\sim i.i.d.N(0,\\sigma_{\\delta}^{2}),\\varepsilon_{ijk\\ell}\\sim i.i.d.N(0,\\sigma_{\\varepsilon}^{2})\\)，并且所有 \\(\\delta_{i\\ell}\\) 和 \\(\\varepsilon_{ijk\\ell}\\) 彼此独立。 误差项 \\(\\delta_{i\\ell}\\) 和 \\(\\varepsilon_{ijk\\ell}\\) 的理想条件对于进行适当的分析非常重要。由于实验单元是随机分配给序列的，因此适当的假设是 \\(\\delta_{i\\ell}\\sim i.i.d.N(0,\\sigma_{\\delta}^{2})\\). 由于 \\(\\varepsilon_{ijk\\ell}\\) 是时间间隔的误差，并且在某种意义上是重复测量误差，因此这些误差可能不是独立分布的。上面给出的理想条件相当于假设时间时期误差的协方差阵满足复合对称条件（参见 ?? 节）。在这种情况下，可以使用通常的独立的 \\(\\delta_{i\\ell}\\) 和 \\(\\varepsilon_{ijk\\ell}\\) 方差分析方法来分析观测数据。复合对称性假设对于两时期设计是必须满足的，对于许多三时期设计也可能是满足的。时间序列误差结构可能更适合具有三个或更多时期的交叉设计，并且应该使用第 ?? 章中讨论的方法。 两时期/两处理交叉设计 (two-period/two-treatment crossover design) 在 10.2 节中描述，具有两个以上处理或两个以上时期的设计在 10.3 和 10.4 节中描述。 10.2 两时期/两处理交叉设计 考虑具有两个处理序列（\\(AB\\) 和 \\(BA\\)）的两时期/两处理交叉设计，其中 \\(AB\\) 意味着处理 \\(A\\) 在第 \\(1\\) 时期分配到一个实验单元，处理 \\(B\\) 在第 \\(2\\) 时期分配到同一实验单元。同样，\\(BA\\) 序列意味着处理 \\(B\\) 在时期 \\(1\\) 被分配到实验单元，处理 \\(A\\) 在时期 \\(2\\) 被分配给相同的实验单元。还假设有 \\(n_1\\) 个实验单元分配给 \\(AB\\) 序列，且有 \\(n_2\\) 个实验单元分配给 \\(BA\\) 序列。令观测到的响应的模型为 \\[\\begin{align} y_{ijk\\ell}&amp;=\\mu+S_i+\\delta_{i\\ell}+P_j+T_k+\\varepsilon_{ijk\\ell}\\\\i&amp;=AB,BA,~j=1,2,~k=A,B,~\\mathrm{and}~\\ell=1,2,\\ldots,n_i \\tag{10.2} \\end{align}\\] 其中下标 \\(k\\) 的值由序列 \\(i\\) 和时期 \\(j\\) 的组合确定。令 \\[\\mu_{ij}=\\mu+S_i+P_j+T_k\\] 是对应于第 \\(i\\) 个序列和第 \\(j\\) 个时期的单元均值的模型。令 \\(\\hat \\mu_{ij}\\) 为第 \\((i,j)\\) 单元格中所有观测值的观测均值。注意到 \\[\\begin{align} \\hat \\mu_{11}=\\bar y_{11\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+P_1+T_A\\\\ \\hat \\mu_{12}=\\bar y_{12\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+P_2+T_B\\\\ \\hat \\mu_{21}=\\bar y_{21\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+P_1+T_B\\\\ \\hat \\mu_{22}=\\bar y_{22\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+P_2+T_A \\tag{10.3} \\end{align}\\] 从式 (10.3) 可看出 \\[\\begin{align} \\hat {\\bar\\mu}_{1\\cdot}&amp;=\\frac{\\bar y_{11\\cdot\\cdot}+\\bar y_{12\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+\\bar P_\\cdot+\\frac{T_A+T_B}{2}\\\\ \\hat {\\bar\\mu}_{2\\cdot}&amp;=\\frac{\\bar y_{21\\cdot\\cdot}+\\bar y_{22\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+\\bar P_\\cdot+\\frac{T_A+T_B}{2}\\\\ \\hat {\\bar\\mu}_{\\cdot 1}&amp;=\\frac{\\bar y_{11\\cdot\\cdot}+\\bar y_{21\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+\\bar S_{\\cdot}+\\bar P_1+\\frac{T_A+T_B}{2}\\\\ \\hat {\\bar\\mu}_{\\cdot 2}&amp;=\\frac{\\bar y_{12\\cdot\\cdot}+\\bar y_{22\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+\\bar S_{\\cdot}+\\bar P_2+\\frac{T_A+T_B}{2} \\tag{10.4} \\end{align}\\] 另请注意，两个序列的均值差 \\(\\hat {\\bar\\mu}_{1\\cdot}-\\hat {\\bar\\mu}_{2\\cdot}\\) 估计 \\(S_{AB} - S_{BA}\\)，即两个序列参数之差。时期 \\(1\\) 和时期 \\(2\\) 的均值差 \\(\\hat {\\bar\\mu}_{\\cdot1}-\\hat {\\bar\\mu}_{\\cdot2}\\) 估计 \\(P_1 - P_2\\). 最后，为了估计两种处理之差 \\(T_A - T_B\\)，可以使用 \\((\\hat {\\bar\\mu}_{11}-\\hat {\\bar\\mu}_{12}-\\hat {\\bar\\mu}_{21}+\\hat {\\bar\\mu}_{22})/2\\) 。在理想条件下，可以证明 \\[\\begin{equation} \\begin{bmatrix}\\hat{\\mu}_{11}\\\\\\hat{\\mu}_{12}\\\\\\hat{\\mu}_{21}\\\\\\hat{\\mu}_{22}\\end{bmatrix}\\thicksim N\\left(\\begin{bmatrix}\\mu_{11}\\\\\\mu_{12}\\\\\\mu_{21}\\\\\\mu_{22}\\end{bmatrix},\\,\\begin{bmatrix}\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\delta^2}{n_1}&amp;0&amp;0\\\\\\\\\\frac{\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\epsilon^2+\\sigma_\\delta^2}{n_1}&amp;0&amp;0\\\\\\\\0&amp;0&amp;\\frac{\\sigma_\\epsilon^2+\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\delta^2}{n_2}\\\\\\\\0&amp;0&amp;\\frac{\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\epsilon^2+\\sigma_\\delta^2}{n_2}\\end{bmatrix}\\right) \\tag{10.5} \\end{equation}\\] 从式 (10.5) 可证明 \\[\\begin{aligned}&amp;\\hat{\\bar{\\mu}}_{1\\cdot}-\\hat{\\bar{\\mu}}_{2\\cdot}\\thicksim N\\bigg[S_{AB}-S_{BA},\\bigg(\\frac{\\sigma_{\\varepsilon}^{2}+2\\sigma_{\\delta}^{2}}{2}\\bigg)\\bigg(\\frac{1}{n_{1}}+\\frac{1}{n_{2}}\\bigg)\\bigg]\\\\&amp;\\hat{\\bar{\\mu}}_{\\cdot1}-\\hat{\\bar{\\mu}}_{\\cdot2}\\thicksim N\\bigg[P_1-P_2,\\frac{\\sigma_{\\varepsilon}^{2}}{2}\\bigg(\\frac{1}{n_1}+\\frac{1}{n_2}\\bigg)\\bigg]\\\\&amp;\\frac{\\hat\\mu_{11}-\\hat\\mu_{12}-\\hat\\mu_{21}+\\hat\\mu_{22}}{2}\\thicksim N\\bigg[T_A-T_B,\\frac{\\sigma_{\\varepsilon}^{2}}{2}\\bigg(\\frac{1}{n_1}+\\frac{1}{n_2}\\bigg)\\bigg]\\end{aligned}\\] 与本节讨论的两期/两处理交叉设计相对应的方差分析表的形式如表 10.2 所示。用于检验 \\(H_0: T_A = T_B\\) 的 \\(F\\) 统计量由 \\(F = TMS/WSEMS\\) 给出，其中 \\(TMS\\) 是表 10.2 中的处理均方 (treatment mean square)，\\(WSEMS\\) 是个体内误差均方 (within subject error mea square). 若 \\(F&gt;F_{\\alpha,1,n_1+n_2-2}\\) 则拒绝 \\(H_0\\). \\(T_A-T_B\\) 的 \\((1-\\alpha)100\\%\\) 置信区间由 \\[\\frac{\\hat{\\mu}_{11}-\\hat{\\mu}_{12}-\\hat{\\mu}_{21}+\\hat{\\mu}_{22}}2\\pm t_{\\alpha,v}\\sqrt{\\frac{\\hat\\sigma_{\\varepsilon}^2}2{\\left(\\frac1{n_1}+\\frac1{n_2}\\right)}}\\] 给出。其中 \\(v=n_1+n_2-n\\) 且 \\(\\hat\\sigma_\\varepsilon^2=WSEMS\\). 作为一个例子，考虑 Grizzle (1965) 使用的数据。数据如表 10.3 所示。使用表 10.4 中所示的命令通过 SAS®-GLM 程序分析数据。 表 10.2: 两期/两处理交叉实验的方差分析表 x 表 10.3: Grizzle (1965) 数据 Seq Period Trt Person Y AB 1 A 11 0.2 AB 2 B 11 1 AB 1 A 12 0 AB 2 B 12 -0.7 AB 1 A 13 -0.8 AB 2 B 13 0.2 AB 1 A 14 0.6 AB 2 B 14 1.1 AB 1 A 15 0.3 AB 2 B 15 0.4 AB 1 A 16 1.5 AB 2 B 16 1.2 BA 1 B 21 1.3 BA 2 A 21 0.9 BA 1 B 22 -2.3 BA 2 A 22 1 BA 1 B 23 0 BA 2 A 23 0.6 BA 1 B 24 -0.8 BA 2 A 24 -0.3 BA 1 B 25 -0.4 BA 2 A 25 -1 BA 1 B 26 -2.9 BA 2 A 26 1.7 BA 1 B 27 -1.9 BA 2 A 27 -0.3 BA 1 B 28 -2.9 BA 2 A 28 0.9 表 10.4: 用于分析表 10.3 中数据的 SAS-GLM 代码 x TITLE ‘CRSOVER EXAMPLE 29.1 – A TWO PERIOD/TWO TREATMENT DESIGN’; DATA GRIZ; INPUT SEQ $ PERIOD TRT $ PERSON Y; LINES; AB 1 A 11 0.2 AB 2 B 11 1.0 AB 1 A 12 0.0 AB 2 B 12 -0.7 AB 1 A 13 -0.8 AB 2 B 13 0.2 AB 1 A 14 0.6 AB 2 B 14 1.1 AB 1 A 15 0.3 AB 2 B 15 0.4 AB 1 A 16 1.5 AB 2 B 16 1.2 BA 1 B 21 1.3 BA 2 A 21 0.9 BA 1 B 22 -2.3 BA 2 A 22 1.0 BA 1 B 23 0.0 BA 2 A 23 0.6 BA 1 B 24 -0.8 BA 2 A 24 -0.3 BA 1 B 25 -0.4 BA 2 A 25 -1.0 BA 1 B 26 -2.9 BA 2 A 26 1.7 BA 1 B 27 -1.9 BA 2 A 27 -0.3 BA 1 B 28 -2.9 BA 2 A 28 0.9 ; PROC GLM; TITLE2 ‘STATISTICAL ANALYSIS USING SAS-GLM’; CLASSES SEQ TRT PERIOD PERSON; MODEL Y=SEQ PERSON(SEQ) TRT PERIOD; LSMEANS TRT/PDIFF; RANDOM PERSON(SEQ); RUN; 表 10.5 显示了模型的方差分析，并给出了 \\(WSEMS\\) 的值 \\(\\hat \\sigma_\\varepsilon^2 = 1.245\\). 表 10.6 给出了 \\(H_0:T_A = T_B\\) 的检验： 以及个体间误差均方 \\(BSEMS = \\hat \\sigma_{\\varepsilon} ^2 + 2\\hat \\sigma_{\\delta}^2 = 1.001\\). \\(H_0\\) 观察到的显著性水平为 \\(\\hat \\alpha = 0.1165\\). 表 10.7 中显示了处理 \\(A\\) 和 \\(B\\) 的最小二乘均值，以及比较处理 \\(A\\) 和处理 \\(B\\) 时观察到的显著性水平 \\(\\hat \\alpha = 0.1165\\)。方差分析表中各行的预期均方如表 10.8 所示。如果想求出双向序列×时期的估计值，可以使用表 10.9 中的命令。双向均值如表 10.10 所示。 表 10.5: 具有个体内误差均方的模型方差分析 x 表 10.6: 表 10.3 中数据的 III 型方差分析表 x 表 10.7: 处理主效应均值 x 表 10.8: 表 10.3 中数据的预期均方表 x 表 10.9: 用于分析表 10.3 中数据的 SAS-GLM 代码 x PROC GLM; TITLE2 ‘STATISTICAL ANALYSIS USING SAS-GLM’; CLASSES SEQ TRT PERIOD PERSON; MODEL Y=SEQ PERSON(SEQ) PERIOD SEQPERIOD; LSMEANS SEQPERIOD; RANDOM PERSON(SEQ); RUN; 表 10.10: 序列×时期均值 x 表 10.3 中的数据也可以使用表 10.11 中所示的命令通过 SAS Mixed 程序进行分析。由于 GLM 分析中受试者间误差均方小于受试者内误差均方，因此结果与 GLM 分析获得的结果略有不同。因此，Mixed 程序将与个体相对应的方差分量估计为 \\(\\hat \\sigma _\\delta ^2 = 0\\)，而 GLM 将使用矩准则方法估计相同的方差分量： \\[\\hat\\sigma_\\delta^2=\\frac{BSEMS-WSEMS}2=\\frac{1.005-1.245}2=\\frac{-0.240}2=-0.120\\] 目前未给出使用表 10.11 中的代码的结果，感兴趣的读者需要运行表 10.11 中的代码。 表 10.11: 用于分析表 10.3 中数据的 SAS-Mixed 代码 x PROC MIXED; TITLE2 ‘STATISTICAL ANALYSIS USING SAS-MIXED’; CLASSES SEQ TRT PERIOD PERSON; MODEL Y=SEQ PERIOD TRT; LSMEANS TRT/PDIFF; RANDOM PERSON(SEQ); RUN; PROC MIXED; TITLE2 ‘STATISTICAL ANALYSIS USING SAS-MIXED’; CLASSES SEQ TRT PERIOD PERSON; MODEL Y=SEQ PERIOD SEQPERIOD; LSMEANS SEQPERIOD; RANDOM PERSON(SEQ); RUN; 上述分析假设第一时期的处理不会影响第二时期的观测结果。接下来考虑存在延滞的情况。当存在延滞时，可以假设 \\[\\begin{align} \\hat \\mu_{11}=\\bar y_{11\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+P_1+T_A\\\\ \\hat \\mu_{12}=\\bar y_{12\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+P_2+T_B+\\lambda_A\\\\ \\hat \\mu_{21}=\\bar y_{21\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+P_1+T_B\\\\ \\hat \\mu_{22}=\\bar y_{22\\cdot\\cdot}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+P_2+T_A+\\lambda_B \\tag{10.6} \\end{align}\\] 其中 \\(\\lambda_A\\) 是序列 \\(AB\\) 的参数，对应于从时期 \\(1\\) 施加的处理 \\(A\\) 到时期 \\(2\\) 的延滞，而 \\(\\lambda_B\\) 是序列 \\(BA\\) 的参数，对应于从时期 \\(1\\) 施加的处理 \\(B\\) 到时期 \\(2\\) 的延滞。 从式 (10.6) 可看出 \\[\\begin{align} \\hat {\\bar\\mu}_{1\\cdot}&amp;=\\frac{\\bar y_{11\\cdot\\cdot}+\\bar y_{12\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+S_{AB}+\\bar P_\\cdot+\\frac{T_A+T_B}{2}+\\frac{\\lambda_A}{2}\\\\ \\hat {\\bar\\mu}_{2\\cdot}&amp;=\\frac{\\bar y_{21\\cdot\\cdot}+\\bar y_{22\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+S_{BA}+\\bar P_\\cdot+\\frac{T_A+T_B}{2}+\\frac{\\lambda_B}{2}\\\\ \\hat {\\bar\\mu}_{\\cdot 1}&amp;=\\frac{\\bar y_{11\\cdot\\cdot}+\\bar y_{21\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+\\bar S_{\\cdot}+\\bar P_1+\\frac{T_A+T_B}{2}\\\\ \\hat {\\bar\\mu}_{\\cdot 2}&amp;=\\frac{\\bar y_{12\\cdot\\cdot}+\\bar y_{22\\cdot\\cdot}}{2}\\,\\mathrm{estimates}\\,\\mu+\\bar S_{\\cdot}+\\bar P_2+\\frac{T_A+T_B}{2}+\\frac{\\lambda_A+\\lambda_B}{2} \\tag{10.7} \\end{align}\\] 当 \\(\\lambda_A\\ne \\lambda_B\\) 时，延滞就存在。也就是说，在无延滞的情况下，\\(\\lambda_A\\) 和 \\(\\lambda_B\\) 实际上不必等于零，它们只需要彼此相等。在 \\(\\lambda_A= \\lambda_B\\) 的情况下，\\(\\lambda_A\\) 和 \\(\\lambda_B\\) 与时期效应混淆 (confounded)，不需要将参数包括在模型中 (10.2) 中。在存在延滞的情况下，两个序列差的均值 \\(\\hat {\\bar\\mu}_{1\\cdot}-\\hat {\\bar\\mu}_{2\\cdot}\\) 估计 \\(S_{AB}-S_{BA}+[(\\lambda_A-\\lambda_B)/2]\\)。时期 \\(1\\) 和时期 \\(2\\) 差的均值 \\(\\hat {\\bar\\mu}_{\\cdot1}-\\hat {\\bar\\mu}_{\\cdot2}\\) 估计 \\(P_1-P_2+[(\\lambda_A+\\lambda_B)/2]\\) 。最后，\\((\\hat{\\mu}_{11}-\\hat{\\mu}_{12}-\\hat{\\mu}_{21}+\\hat{\\mu}_{22})/2\\) 估计 \\(T_A-T_B+[(\\lambda_A-\\lambda_B)/2]\\) 。在存在延滞的情况下，时期 \\(2\\) 的数据无助于估计两种处理的差异。当存在延滞时，必须通过 \\(\\hat \\mu_{11}-\\hat \\mu_{21}\\) 来估计 \\(T_A-T_B\\)，并且该估计仅取决于时期 \\(1\\) 的数据。还可以注意到，如果仅使用时期 \\(1\\) 的数据来估计处理效应，则时期 \\(1\\) 的模型可以简化为 \\[\\begin{equation} y_{k\\ell}=\\mu+T_k+\\varepsilon_{k\\ell}^*,~k=A,B,~\\mathrm{and~}~\\ell=1,2,\\ldots,n_i \\tag{10.8} \\end{equation}\\] 其中 \\(\\varepsilon_{k\\ell}^{*}=\\delta_{k\\ell}+\\varepsilon_{k\\ell}\\). 而且， \\[\\mathrm{Var}(\\hat{\\mu}_{11}-\\hat{\\mu}_{21})=(\\sigma_\\varepsilon^2+\\sigma_\\delta^2){\\left(\\frac1{n_1}+\\frac1{n_2}\\right)}\\] 表 10.12 显示了当存在延滞时，与两时期/两处理交叉设计相对应的方差分析表的形式。该表与表 10.2 具有相同的形式，除了预期均方列。 表 10.12: 两时期/两处理交叉实验的方差分析表 x 如果不存在延滞，那么个体被分配到哪个序列应该无关紧要。也就是说，从哲学上讲，\\(S_{AB}-S_{BA}\\) 应该等于零。因此，\\(F=SeqMS/BSEM\\) 给出的 \\(F\\) 统计量提供了是否存在延滞的测试。如果 \\(F&gt;F_{\\alpha,1,n1+n2-2}\\)，则可以得出结论，存在显著的延滞效应。需要注意的是，延滞检验是个体间的比较，因此该检验的功效不如基于个体内的比较。如果认为可能存在延滞效应，建议不要使用两时期/两处理的交叉设计。在某些情况下，实验者可能能够在交叉设计的两个阶段之间包括所谓的“洗脱” (wash-out) 阶段。洗脱期是指一段足够长的时间，以便在对实验单元进行第二种处理之前，第一时期中给予的处理的任何延滞效应将被消除或清除。同样极其重要的是，要注意在两时期/两处理交叉设计中的延滞问题在一些具有两个以上处理和/或两个以上时期的交叉设计中减少和/或消除。此类设计将在下一节中进行考虑。 作为可能存在延滞的两时期/两处理交叉实验的示例，再次考虑表 10.3 中显示的 Grizzle (1965) 数据。将使用 SAS-Mixed 程序（使用表 10.13 中显示的命令）分析数据。 表 10.13: 用于分析表 10.3 中数据的 SAS-Mixed 代码，当存在延滞时 x PROC MIXED; TITLE2 ‘STATISTICAL ANALYSIS USING SAS-MIXED’; CLASSES SEQ TRT PERIOD PERSON; MODEL Y=SEQ PERIOD TRT; LSMEANS TRT/PDIFF; RANDOM PERSON(SEQ); RUN; PROC MIXED; TITLE2 ‘STATISTICAL ANALYSIS USING SAS-MIXED’; CLASSES SEQ TRT PERIOD PERSON; MODEL Y=SEQ PERIOD SEQ*PERIOD; LSMEANS SEQ*PERIOD; ESTIMATE ‘A-B FROM PERIOD 1’ SEQ 1 -1 SEQ*PERIOD 1 0 -1 0; RANDOM PERSON(SEQ); RUN; 第一组 Mixed 命令用于获得延滞检验和处理效应检验（如果没有任何显著的延滞）。这些命令还给出了处理主效应均值，如果没有延滞，则可以使用该均值。第二组命令使用不同的 random 语句，以获得序列×时期双向均值，包括 ESTIMATE 选项，以便从时期 \\(1\\) 数据中获得处理效应估计值。 表 10.14: 固定效应检验 x 表 10.14 给出了对表 10.13 中第一组 Mixed 命令的固定效应的检验。请注意，序列效应在 \\(0.0665\\) 水平下显著，表明存在一些延滞的证据。还请注意，处理效应仅在 \\(0.1002\\) 水平下显著。 处理主效应平均值见表 10.15，该表还比较了两种处理平均值。 表 10.15: 处理均值及两种处理均值差的检验 x 表 10.16 给出了表 10.13 中第二组 Mixed 命令的固定效应检验。请注意，序列的检验与表 10.14 中给出的检验相同。还请注意，序列×时期的检验与表 10.14 中处理的检验相同。表 10.17 给出了序列×时期均值，表 10.18 给出了仅来自时期 \\(1\\) 数据比较两种处理的检验。表 10.18 的检查显示，在表 10.7 中给出的分析中，延滞效应明显掩盖了部分处理效应，其中假设无延滞，因为处理效应不显著，而仅使用时期 \\(1\\) 数据的比较发现处理存在显著差异。 表 10.16: 固定效应的额外检验 x 表 10.17: 序列×时期双向均值 x 表 10.18: 处理 \\(A\\) 和处理 \\(B\\)，来自时期 \\(1\\) 的估计 x 10.3 具有两个以上时期的交叉设计 当没有延滞时，具有两个以上时期和/或两个以上处理的交叉设计的统计分析是简单的。当满足个体间误差和个体内误差的理想条件时，式 (10.1) 中的模型是合适的。表 10.4，10.9，和 10.11 仍然可以用来获得有用和有趣的统计量。由于没有延滞时的分析是直接的，本节集中讨论存在延滞的情况。 考虑的第一种情况是仍然有两种处理的情况，但涉及具有三个时期的序列。一种可能性是使用两个序列 \\(ABA\\) 和 \\(BAB\\). 对于 \\(ABA\\) 序列，实验单元将在时期 \\(1\\) 接受处理 \\(A\\)，在时期 \\(2\\) 接受处理 \\(B\\)，并在时期 \\(3\\)再次接受处理 \\(A\\). \\(BAB\\) 序列将进行类似处理。另一种可能性是使用两个序列 \\(ABB\\) 和 \\(BAA\\). 第三种可能性是使用所有这四个序列。也就是说，\\(ABA\\)、\\(BAB\\)、\\(ABB\\) 和 \\(BAA\\) 都将被使用。本节重点介绍使用两个序列 \\(ABA\\) 和 \\(BAB\\) 的交叉设计。其他的可能性也可以类似地分析。 表 10.19 确定了与 \\(ABA\\) 和 \\(BAB\\) 交叉设计的序列与时期组合相关的模型参数。 表 10.19: 三时期/两处理交叉设计的单元个均值参数 x 假设 \\(n_1\\) 个个体已被分配到 \\(ABA\\) 序列，\\(n2\\) 个个体已被分配到 \\(BAB\\) 序列。令 \\(y_{ij\\ell}\\) 为在从序列 \\(i\\) 时期 \\(j\\) 的个体 \\(\\ell\\) 中观察到的响应。令 \\(\\hat\\mu _{ij} = \\bar y_{ij\\cdot} , i = 1, 2; j = 1, 2, 3\\). 在式 (10.1) 中给出的模型误差项的理想条件下，可以证明： \\[\\begin{equation} \\begin{bmatrix}\\hat{\\mu}_{11}\\\\\\hat{\\mu}_{12}\\\\\\hat{\\mu}_{13}\\\\\\hat{\\mu}_{21}\\\\\\hat{\\mu}_{22}\\\\\\hat{\\mu}_{23}\\end{bmatrix}\\sim N\\left(\\begin{bmatrix}\\mu_{11}\\\\\\mu_{12}\\\\\\mu_{13}\\\\\\mu_{21}\\\\\\mu_{21}\\\\\\mu_{23}\\end{bmatrix},\\begin{bmatrix}\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\delta^2}{n_1}&amp;0&amp;0&amp;0\\\\\\frac{\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\delta^2}{n_1}&amp;0&amp;0&amp;0\\\\\\frac{\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\delta^2}{n_1}&amp;\\frac{\\sigma_\\epsilon^2+\\sigma_\\delta^2}{n_1}&amp;0&amp;0&amp;0\\\\0&amp;0&amp;0&amp;\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\delta^2}{n_2}\\\\0&amp;0&amp;0&amp;\\frac{\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\delta^2}{n_2}\\\\0&amp;0&amp;0&amp;\\frac{\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\delta^2}{n_2}&amp;\\frac{\\sigma_\\varepsilon^2+\\sigma_\\delta^2}{n_2}\\end{bmatrix}\\right) \\tag{10.9} \\end{equation}\\] 注意到对比 $$ \\[\\begin{aligned} \\begin{aligned}\\mu_{11}-\\frac12\\mu_{12}-\\frac12\\mu_{13}-\\mu_{21}+\\frac12\\mu_{22}+\\frac12\\mu_{23}\\end{aligned}&amp; =(\\mu+S_{ABA}+P_1-T_A)-\\frac12(\\mu+S_{ABA}+P_2+T_B+\\lambda_A) \\\\ &amp;-\\frac12(\\mu+S_{ABA}+P_3+T_A+\\lambda_B)-(\\mu+S_{BAB}+P_1+T_B) \\\\ &amp;+\\frac12(\\mu+S_{BAB}+P_2+T_A+\\lambda_B)+\\frac12(\\mu+S_{BAB}+P_3+T_B+\\lambda_A) \\\\ &amp;=T_{A}-T_{B} \\end{aligned}\\] $$ 因此，即使 \\(ABA\\)、\\(BAB\\) 交叉设计中存在延滞，两种处理的直接差异也可以通过下式来估计 \\[\\begin{equation} \\hat{\\mu}_{11}-\\frac12\\hat{\\mu}_{12}-\\frac12\\hat{\\mu}_{13}-\\hat{\\mu}_{21}+\\frac12\\hat{\\mu}_{22}+\\frac12\\hat{\\mu}_{23} \\tag{10.10} \\end{equation}\\] 还注意到 \\[\\begin{equation} \\mathrm{Var}\\left(\\hat{\\mu}_{11}-\\frac12\\hat{\\mu}_{12}-\\frac12\\hat{\\mu}_{13}-\\hat{\\mu}_{21}+\\frac12\\hat{\\mu}_{22}+\\frac12\\hat{\\mu}_{23}\\right)=\\frac32\\sigma_{\\varepsilon}^2\\left(\\frac1{n_1}+\\frac1{n_2}\\right) \\tag{10.11} \\end{equation}\\] 因此，式 (10.11) 中的对比是个体内对比，其方差仅取决于 \\(\\sigma^2_\\varepsilon\\). 一个可能感兴趣的问题是如何定义处理主效应均值？一种可能性是通过对表 10.19 中接受处理 \\(A\\) 的所有单元进行平均来估计 \\(A\\) 的主效应均值。也就是说，\\(A\\) 平均值为 \\((\\mu_{11} + \\mu_{22} + \\mu_{13})/3\\)，\\(B\\) 平均值为 \\((\\mu_{21} + \\mu_{12} + \\mu_{23})/3\\)。根据表 10.19 中定义的效应模型参数，这两个函数分别等于 \\[\\begin{aligned}\\mu+\\frac23S_{ABA}+\\frac13S_{BAB}+\\bar{P}_\\cdot+T_A+\\frac13(\\lambda_B+\\lambda_A)\\\\\\mu+\\frac13S_{ABA}+\\frac23S_{BAB}+\\bar{P}_\\cdot+T_B+\\frac13(\\lambda_A+\\lambda_B)\\end{aligned}\\] 这样的定义没有意义，因为这样的 \\(A\\) 均值和 \\(B\\) 均值的差等于 \\(\\frac{1}{3}S_{ABA}-\\frac{1}{3}S_{BAB}+T_A-T_B\\)，而不等于 \\(T_A-T_B\\). 也就是说，这样定义的 \\(A\\) 均值和 \\(B\\) 均值与序列效应混叠 (aliased). \\(A\\) 主效应均值的第二个定义是 \\[\\mu+\\bar{S}_\\cdot+\\bar{P}_\\cdot+T_A+\\frac13(\\lambda_B+\\lambda_A)\\] \\(B\\) 主效应均值类似地定义为 \\[\\mu+\\bar{S}_\\cdot+\\bar{P}_\\cdot+T_B+\\frac13(\\lambda_B+\\lambda_A)\\] 这样的定义是合理的，因为第一个等于表 10.19 中单元格均值的下列线性函数 \\[\\frac23\\mu_{11}-\\frac1{12}\\mu_{12}-\\frac1{12}\\mu_{13}-\\frac13\\mu_{21}+\\frac5{12}\\mu_{22}+\\frac5{12}\\mu_{23}\\] 第二个等于 \\[-\\frac13\\mu_{11}+\\frac5{12}\\mu_{12}+\\frac5{12}\\mu_{13}+\\frac23\\mu_{21}-\\frac1{12}\\mu_{22}-\\frac1{12}\\mu_{23}\\] 此外，这两个均值之差为 \\[\\mu_{11}-\\frac12\\mu_{12}-\\frac12\\mu_{13}-\\mu_{21}+\\frac12\\mu_{22}+\\frac12\\mu_{23}=T_A-T_B\\] 请注意，这与公式 (10.10) 中给出的单元格均值对比相同。单元格均值内的对比意味着延滞效应是 \\[\\begin{equation} \\mu_{11}-\\mu_{13}-\\mu_{21}+\\mu_{23}=\\lambda_A-\\lambda_B \\tag{10.12} \\end{equation}\\] 该对比估计的方差是 \\[\\begin{equation} \\mathrm{Var}(\\hat{\\mu}_{11}-\\hat{\\mu}_{13}-\\hat{\\mu}_{21}+\\hat{\\mu}_{23})=2\\sigma_{\\varepsilon}^2\\left(\\frac1{n_1}+\\frac1{n_2}\\right) \\tag{10.13} \\end{equation}\\] 且此对比也是个体内对比。 为了举例说明，请考虑表 10.20 中的数据，其中三名个体分配给 \\(ABA\\) 序列，另外三名个体分配给 \\(BAB\\) 序列。因此 \\(n_1 = n_2 = 3\\). 读取数据并计算序列×时期单元格均值的 SAS 代码如表 10.21 所示。单元平均值如表 10.22 所示。 因此，\\(A\\) 主效应平均值的估计由下式给出 \\[\\begin{aligned} \\frac23\\hat{\\mu}_{11}&amp; -\\frac1{12}\\hat{\\mu}_{12}-\\frac1{12}\\hat{\\mu}_{13}-\\frac13\\hat{\\mu}_{21}+\\frac5{12}\\hat{\\mu}_{22}+\\frac5{12}\\hat{\\mu}_{23} \\\\ &amp;=\\frac23(24.133)-\\frac1{12}(26.533)-\\frac1{12}(23.933)-\\frac13(26.367)+\\frac5{12}(26.233)+\\frac5{12}(24.833)=24.372 \\end{aligned}\\] \\(B\\) 主效应平均值的估计由下式给出 \\[\\begin{aligned}-\\frac13\\hat{\\mu}_{11}&amp;+\\frac5{12}\\hat{\\mu}_{12}+\\frac5{12}\\hat{\\mu}_{15}+\\frac23\\hat{\\mu}_{21}-\\frac1{12}\\hat{\\mu}_{22}-\\frac1{12}\\hat{\\mu}_{23}\\\\&amp;=-\\frac13(24.133)+\\frac5{12}(26.533)+\\frac5{12}(23.933)+\\frac23(26.367)-\\frac1{12}(26.233)-\\frac1{12}(24.833)=26.306\\end{aligned}\\] 表 10.20: \\(ABA/BAB\\) 交叉实验的数据 Seq Per Trt Person Y ABA 1 A 1 25.1 ABA 2 B 1 27.6 ABA 3 A 1 24.5 ABA 1 A 2 22 ABA 2 B 2 24.3 ABA 3 A 2 21.6 ABA 1 A 3 25.3 ABA 2 B 3 27.7 ABA 3 A 3 25.7 BAB 1 B 4 25.5 BAB 2 A 4 23.7 BAB 3 B 4 24.9 BAB 1 B 5 27.4 BAB 2 A 5 27.9 BAB 3 B 5 24.6 BAB 1 B 6 26.2 BAB 2 A 6 27.1 BAB 3 B 6 25 表 10.21: 用于获取表 10.20 中数据的序列×时期单元格均值的 SAS 代码 x TITLE ‘CRSOVR EXAMPLE #29.2 AN ABA/BAB DESIGN’; DATA CRS; INPUT SEQ $ PER TRT $ PERSON Y; LINES; ABA 1 A 1 25.1 ABA 2 B 1 27.6 ABA 3 A 1 24.5 ABA 1 A 2 22.0 ABA 2 B 2 24.3 ABA 3 A 2 21.6 ABA 1 A 3 25.3 ABA 2 B 3 27.7 ABA 3 A 3 25.7 BAB 1 B 4 25.5 BAB 2 A 4 23.7 BAB 3 B 4 24.9 BAB 1 B 5 27.4 BAB 2 A 5 27.9 BAB 3 B 5 24.6 BAB 1 B 6 26.2 BAB 2 A 6 27.1 BAB 3 B 6 25.0 ; PROC MEANS; CLASS SEQ PER; VAR Y; RUN; 表 10.22: 序列×时期单元格均值 x \\(A\\) 均值与 \\(B\\) 均值之差为 \\[\\hat{\\tau}_A-\\hat{\\tau}_B=24.372-26.306=-1.934\\] 人们可以使用 SAS-Mixed 程序来估计处理均值、检验处理差异、检验延滞以及估计两处理/三时期交叉设计的方差分量。例如，为了分析表 10.20 中的数据，必须定义一个新变量来标识前一时期给予的处理。为了不消除第一时期数据，还必须为第一时期数据定义这个新变量。对于 \\(ABA\\) 序列，可以将这个新变量定义为在时期 \\(1\\)、\\(2\\) 和 \\(3\\) 中分别取值为 \\(O\\)、\\(A\\) 和 \\(B\\). 对于 \\(BAB\\) 序列，新变量将分别取值 \\(O\\)、\\(B\\) 和 \\(A\\). 表 10.23 中的 SAS 代码使用了一个名为 PRIORTRT 的新变量，该变量具有前几句中给出的属性。定义了这个新变量的数据如表 10.24 所示。可用于分析表 10.20 中数据的 SAS-Mixed 命令如表 10.25 所示。结果输出如表 10.20 至 10.29 所示。表 10.26 给出了方差分量的估计。从该表中可以看出，\\(\\sigma^2_\\delta=2.1378\\) 和 \\(\\sigma^2_\\varepsilon=0.7872\\). 表 10.27 给出了处理 \\(A\\) 和处理 \\(B\\) 之差的检验。表 10.27 中标记为 Trt 的行是检验 \\(H_{01}:\\tau_A=\\tau_B\\)，标记为 PRIORTRT 的行是检验 \\(H_{02}:\\lambda_A=\\lambda_B\\). 请注意，表 10.27 中标记为 PER 的行只有一个自由度。这可能看起来很奇怪，因为有三个时期。然而，在时期 \\(1\\) 和 \\(\\lambda_0\\) 之间存在完全混淆 (completely confounding)，因此标记为 PER 的行仅比较时期 \\(2\\) 和时期 \\(3\\). 也就是说，标记为 PER 的行检验 \\(H_{03}:P_2=P_3\\). 表 10.25 中的 CONTRAST 选项给出了一个检验统计量，将所有三个时期相互比较；即该 CONTRAST 选项检验 \\(H_{03}:P_1+\\lambda_0=P_2=P_3\\) 的结果。该选项的结果附在表 10.27 的底部。 表 10.23: 为表 10.20 中的数据创建 PRIORTRT 变量的 SAS 代码 x DATA CRS2; SET CRS; IF SEQ=‘ABA’ AND PER=2 THEN PRIORTRT=‘A’; ELSE IF SEQ=‘ABA’ AND PER=3 THEN PRIORTRT=‘B’; ELSE IF SEQ=‘BAB’ AND PER=2 THEN PRIORTRT=‘B’; ELSE IF SEQ=‘BAB’ AND PER=3 THEN PRIORTRT=‘A’; ELSE PRIORTRT=‘O’; RUN; PROC PRINT; TITLE2 ‘A PRINT OF THE DATA WITH PRIORTRT VARIABLE INCLUDED’; RUN; 表 10.24: 打印定义了 PRIORTRT 变量的新数据 x 表 10.25: 分析表 10.24 中数据的 SAS 代码 x PROC MIXED; TITLE3 ‘AN ANALYSIS USING MIXED’; CLASSES SEQ PERSON TRT PER PRIORTRT; MODEL Y=SEQ TRT PER PRIORTRT/DDFM=KR; LSMEANS TRT/PDIFF; ESTIMATE ‘TRT DIFF’ TRT 1 -1; ESTIMATE ‘CARRYOVER’ PRIORTRT 1 -1; CONTRAST ‘PERIOD DIFF’ PER 0 1 -1, PER 1 -.5 -.5 PRIORTRT -.5 -.5 1; RANDOM PERSON(SEQ); RUN; 表 10.26: 方差分量估计 x 表 10.27: 固定效应检验 x 处理主效应均值的估计值如表 10.28 所示。请注意，SAS-Mixed 程序给出的值与表 10.22 中使用主效应平均值的第二定义计算的估计值相同。表 10.25 中两个 ESTIMATE 语句的结果如表 10.29 所示。这些估计的第一个 \\(\\tau_A-\\tau_B\\) 给出了估计值的标准误估计，并给出了用于检验 \\(H_{01}:\\tau_A=\\tau_B\\) 的 \\(t\\) 统计量以及检验观察到的显著性水平。第二个 ESTIMATE 语句估计 \\(\\lambda_A-\\lambda_B\\) 给出了估计值的标准误估计，并给出了用于检验 \\(H_{02}:\\lambda_A=\\lambda_B\\) 的 \\(t\\) 统计量以及检验观察到的显著性水平。读者应注意，表 10.29 中观察到的处理差异和延滞差异的显著性水平与表 10.27 中相应的观察到的显著性水平相同。处理差异估计的标准误估计可以通过将 (10.11) 中的 \\(\\sigma_\\varepsilon^2\\) 替换为 \\(\\hat\\sigma_\\varepsilon^2\\) 来计算，即 \\[\\begin{aligned} \\widehat{\\mathrm{Var}}\\left(\\hat{\\mu}_{11}-\\frac12\\hat{\\mu}_{12}-\\frac12\\hat{\\mu}_{13}-\\hat{\\mu}_{21}+\\frac12\\hat{\\mu}_{22}+\\frac12\\hat{\\mu}_{23}\\right)&amp; =\\frac32\\hat\\sigma_\\varepsilon^2\\left(\\frac1{n_1}+\\frac1{n_2}\\right) \\\\ &amp;=\\left(\\frac32\\right)(0.7872)\\left(\\frac13+\\frac13\\right)=0.7872 \\end{aligned}\\] 因此 \\(\\hat \\tau_A-\\hat \\tau_B\\) 标准误估计为 \\(√0.7872=0.8872\\). 类似地，可以通过将方程 (10.13) 中的 \\(\\sigma_\\varepsilon^2\\) 替换为 \\(\\hat\\sigma_\\varepsilon^2\\) 并取结果的平方根，来获得 \\(\\hat \\lambda_A-\\hat \\lambda_B\\) 的标准误估计。与这些的标准误估计中的每一个相关的自由度为 \\(2(n_1+n_2-2)=8\\). 表 10.28: 处理主效应均值 x 表 10.29: 从 Estimate 选项中检验处理和延滞效应 x 10.4 具有两种以上处理的交叉设计 接下来，考虑六个序列中的三处理/三时期交叉设计。设计序列为 \\(ABC,ACB,BAC,BCA,CAB,CBA\\). 所有这六个序列都是必需的，为了获得不会与延滞混叠的处理均值的直接比较。Williams (1949) 开发的设计在延滞效应方面是均衡的。Williams 交叉设计在延滞效应方面是均衡的，其特点是每次处理后都会进行完全相同次数的其他处理。 上面给出的六序列设计是 Williams 设计。在这六个序列的设计中，每个处理（字母）跟随另一个处理两次。还要注意，虽然具有序列 \\(ABC,BCA,CAB\\) 的三序列设计是拉丁方设计，但它不是 Williams 设计。在这种设计中，\\(A\\) 后面跟着 \\(B\\) 两次，但 \\(A\\) 后面永远不会跟着 \\(C\\). 同样，\\(B\\) 后面跟着 \\(C\\) 两次，但 \\(B\\) 后面从来没有跟着 \\(A\\)；\\(C\\) 后面跟着 \\(A\\) 两次，但 \\(C\\) 后面从来没有跟着 \\(B\\)。三个时期内三种处理的 Williams 设计必须使用 \\(ABC,ACB,BAC,BCA,CAB,CBA\\) 的所有六个序列。 假设有四处理和四时期，显然，24 序列设计具有处理 \\(A,B,C,D\\) 的所有 \\(24\\) 种可能的排序，这将是一个 Williams 设计。另一种四处理四时期的 Williams 设计的序列为 \\(ABCD,BDAC,CADB,DCBA\\). 设 \\(t\\) 为交叉设计中要使用的处理数和时期数。如果 \\(t\\) 是偶数，则 Williams 设计可以用一个特殊的 \\(t×t\\) 拉丁方设计来构建，如果 \\(t\\) 是奇数，Williams 设计可以通过使用两个特殊的拉丁方设计来构建。 表 10.30 给出了三时期/三处理 Williams 设计的单元格均值参数。为了表明当存在延滞时可以估计处理差异，可以证明对于表 10.30 中的单元格均值 \\[\\begin{align} &amp;(5\\mu_{11}-2\\mu_{12}-3\\mu_{13}+4\\mu_{21}+2\\mu_{22}-6\\mu_{23}-5\\mu_{31}+2\\mu_{32}+3\\mu_{33}-4\\mu_{41}-2\\mu_{41}\\\\&amp;+6\\mu_{43}-\\mu_{51}+4\\mu_{52}-3\\mu_{53}+\\mu_{61}-4\\mu_{62}+3\\mu_{63})/24=\\tau_A-\\tau_B \\tag{10.14} \\end{align}\\] 还注意到，也可以比较延滞效应， \\[\\begin{align} &amp;(\\mu_{11}+2\\mu_{12}-3\\mu_{13}+0\\mu_{21}+2\\mu_{22}-2\\mu_{23}-\\mu_{31}-2\\mu_{32}+3\\mu_{33}+0\\mu_{41}-2\\mu_{41}\\\\&amp;+2\\mu_{43}-\\mu_{51}+0\\mu_{52}+\\mu_{53}+\\mu_{61}+0\\mu_{62}-\\mu_{63})/8=\\lambda_A-\\lambda_B \\tag{10.15} \\end{align}\\] 还可以获得简化为 \\(\\tau_A-\\tau_C\\) 和 \\(\\tau_B-\\tau_C\\) 以及 \\(\\lambda_A-\\lambda_C\\) 和 \\(\\lambda_B-\\lambda_C\\) 的单元格均值参数的类似函数。 表 10.30: 六个序列的三时期/三处理交叉设计单元格均值参数 x 例如，考虑表 10.31 中的数据。这些数据来自六个序列的三时期/三处理交叉设计。有少数个体缺失数据。使用表 10.31 中的命令创建 SAS 数据集。这些命令还创建了一个延滞参数，该参数给出了上一时期的处理值。对于第一时期，该参数的值为“O”。数据最初使用 SAS-Mixed 软件进行分析，使用表 10.33 中的命令。表 10.34 给出了个体间和个体内方差分量的估计，即，\\(\\hat\\sigma^2_\\delta = 3.2278\\) 和 \\(\\hat\\sigma^2_\\varepsilon = 0.8934\\). 表 10.31: 三时期/三处理交叉设计的数据 x 表 10.32: 分析表 10.31 中数据的 SAS 代码 x 表 10.33: 分析表 10.31 中数据的 SAS 代码 x 表 10.34: 方差分量的估计 x 表 10.35 给出了固定效应的检验。对表 10.35 的检验表明，有一个很显著处理效应（\\(p &lt; 0.0001\\)）和显著的延滞效应（\\(p = 0.0306\\)）。表 10.36 和 10.37 给予 LSMEANS 选项的结果。值得注意的是，无论是处理还是先前处理的最小二乘均值都不可估 (not estimable)。原因是 SAS-Mixed 程序生成的模型参数函数是不可估的。 例如，SAS-Mixed 程序将处理 \\(A\\) 最小二乘均值定义为 \\[\\mu+\\frac{S_{ABC}+S_{ACB}+S_{BAC}+S_{BCA}+S_{CAB}+S_{CBA}}6+\\frac{P_1+P_2+P_3}3+\\tau_A+\\frac{\\lambda_A+\\lambda_B+\\lambda_C+\\lambda_O}4\\] 该函数不可估，因为 \\(P_1\\) 和 \\(\\lambda_O\\) 在模型中彼此完全混叠，因此，它们必须具有相同的乘数。在上式中，它们不具有相同的乘数，因为 \\(P_1\\) 的乘数等于 \\(1/3\\)，而 \\(\\lambda_O\\) 的乘数等于 \\(1/4\\). 处理 \\(A\\) 最小二乘均值的更好定义为 \\[\\begin{align} \\mu&amp;+\\frac{S_{ABC}+S_{ACB}+S_{BAC}+S_{BCA}+S_{CAB}+S_{CBA}}6+\\frac{P_1+P_2+P_3}3\\\\&amp;+\\tau_A+\\frac{2\\lambda_A+2\\lambda_B+2\\lambda_C+3\\lambda_O}9 \\tag{10.16} \\end{align}\\] 在该定义中，\\(P_1\\) 和 \\(\\lambda_O\\) 的乘数均等于 \\(1/3\\). 此外，由于四个延滞参数的乘数之和必须为 \\(1\\)，因此 \\(\\lambda_A,\\lambda_B,\\lambda_C\\) 的乘数必须等于 \\(2/9\\). 式 (10.16) 中的函数是可估计。以类似的方式，可以定义处理 \\(B\\) 和处理 \\(C\\) 的最小二乘均值，并且这些平均值之间的成对差异将不包括延滞参数。 表 10.35: 固定效应的检验 x 表 10.36: 处理最小二乘均值 x 表 10.37: 处理和延滞参数之间的成对比较 x 尽管在表 10.36 中处理最小二乘均值不可估，但成对差异是可估计的，处理和延滞参数之间的成对比较见表 10.37 。从表 10.37 可以看出， \\[\\hat{\\tau}_{A}-\\hat{\\tau}_{B}=0.8195,\\hat{\\tau}_{A}-\\hat{\\tau}_{C}=-3.0861,\\mathrm{and}\\,\\hat{\\tau}_{B}-\\hat{\\tau}_{C}=-3.9056\\] 相应的观察到的显著性水平为 \\(p = 0.0041\\)、\\(p &lt; 0.0001\\) 和 \\(p &lt; 0.0001\\). 因此，所有处理均值彼此之间存在显著差异。 从表 10.37 中还可以看出， \\[\\hat{\\lambda}_A-\\hat{\\lambda}_B=-0.7706,\\hat{\\lambda}_A-\\hat{\\lambda}_C=0.1842,\\mathrm{~and~}\\hat{\\lambda}_B-\\hat{\\lambda}_C=0.9548\\] 相应的观察到的显著性水平为 \\(p = 0.0557\\)、\\(p = 0.6380\\) 和 \\(p = 0.0118\\). 因此，处理 \\(A\\) 和 \\(C\\) 的延滞效应彼此相似，且均与处理 \\(B\\) 的延滞显著不同。 表 10.38 给出了额外的 SAS 代码，该代码使用与 (10.16) 中给出的处理 \\(A\\) 相似的定义计算处理最小二乘均值。表 10.38 中 SAS 命令的结果见表 10.39. 对表 10.39 的检查表明，处理 \\(C\\) 的平均值最大，其次是处理 \\(A\\) 和 \\(B\\). 还注意到，表 10.39 中给出的处理平均值和延滞效应之间的成对比较与表 10.37 中的相应比较完全相同。 表 10.38: 计算处理可估最小二乘均值的额外 SAS 代码 x 表 10.39: 表 10.38 中给出的命令的结果 x 10.5 小结 本章考虑了交叉设计，即每个个体随着时间的推移接受一系列处理。特定个体接受的一系列特殊处理被称为序列。当使用交叉设计时，需要考虑延滞问题。如果怀疑可能存在延滞，可以在进行下一次处理之前纳入洗脱期，以尽可能减少延滞的影响。当两时期/两处理交叉设计中存在延滞时，不能使用第二个时期的数据来估计处理差异。然而，当能够使用两个以上时期和/或两种以上处理时，无论是否存在延滞，都可以获得处理差异的估计。 "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
